<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|8f167b36af4a13ba8e7fb049670076e658bfc799|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"6143b470074a73\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-3880"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-3880] NPE on a query with having clause involving a join - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-3880] NPE on a query with having clause involving a join - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-3880">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-3880" href="/jira/browse/DERBY-3880" id="key-val" rel="12404477">DERBY-3880</a></li>
                </ol>
                <h1 id="summary-val">NPE on a query with having clause involving a join</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-3880"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-3880/DERBY-3880.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-3880/DERBY-3880.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-3880/DERBY-3880.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-3880/DERBY-3880.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/minor.svg" title="Minor - Minor loss of function, or other problem where easy workaround is present." width="16"> Minor </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.4.2.0 ">10.4.2.0</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.3.3.1" title="10.3.3.1 Head of 10.3 branch">10.3.3.1</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.4.2.1" title="10.4.2.1 Head of 10.4 branch">10.4.2.1</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.5.1.1" title="10.5.1.1 build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09">10.5.1.1</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+SQL" title="SQL ">SQL</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12404477-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     Windows 2003 Server 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310090" class="item"> 
                     <div class="wrap"> 
                      <strong title="Issue &amp; fix info" class="name">Issue &amp; fix info:</strong> 
                      <div id="customfield_12310090-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310090-field"> 
                        <span>High Value Fix</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310200" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bug behavior facts" class="name">Bug behavior facts:</strong> 
                      <div id="customfield_12310200-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310200-field"> 
                        <span>Regression</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>A simple query involving a join and having clause causes a NPE. Any subsequent executions cause severe errors. It almost looks like the underlying connection was closed out.</p> 
                  <p>====</p> 
                  <p>C:\apps\derby\db-derby-10.4.2.0-bin\db-derby-10.4.2.0-bin\bin&gt;ij<br> ij version 10.4<br> ij&gt; connect 'jdbc:derby://speed:1527/ClassicModels;user=sa;password=sa<br> ';<br> ij&gt; create table t1(i int, c varchar(20));<br> 0 rows inserted/updated/deleted<br> ij&gt; create table t2(i int, c2 varchar(20), i2 int);<br> 0 rows inserted/updated/deleted<br> ij&gt; insert into t1 values(1, 'abc');<br> 1 row inserted/updated/deleted<br> ij&gt; insert into t1 values(2, 'abc');<br> 1 row inserted/updated/deleted<br> ij&gt; insert into t2 values(1, 'xyz', 10);<br> 1 row inserted/updated/deleted<br> ij&gt; insert into t2 values(1, 'aaa', 20);<br> 1 row inserted/updated/deleted<br> ij&gt; insert into t2 values(2, 'xxx', 30);<br> 1 row inserted/updated/deleted<br> ij&gt; select t1.i, avg(t2.i2) from t1 inner join t2 on (t1.i = t2.i) group by t1.i<br> having avg(t2.i2) &gt; 0;<br> ERROR XJ001: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ001, SQLERRMC: java.lang.<br> NullPointerException¶¶XJ001.U</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-3880?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-3880?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-3880?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-3880?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12392497" data-issue-id="12404477" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12392497/AggregateExpressionResultColumn.txt" draggable="true" data-downloadurl="text/plain:AggregateExpressionResultColumn.txt:https://issues.apache.org/jira/secure/attachment/12392497/AggregateExpressionResultColumn.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12392497/AggregateExpressionResultColumn.txt" title="Latest  20/Oct/08 16:50 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:AggregateExpressionResultColumn.txt:https://issues.apache.org/jira/secure/attachment/12392497/AggregateExpressionResultColumn.txt">AggregateExpressionResultColumn.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-10-20T16:50:10.160Z">20/Oct/08 16:50</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12392287" data-issue-id="12404477" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12392287/querytree_fail.txt" draggable="true" data-downloadurl="text/plain:querytree_fail.txt:https://issues.apache.org/jira/secure/attachment/12392287/querytree_fail.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12392287/querytree_fail.txt" title="Latest  16/Oct/08 20:58 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:querytree_fail.txt:https://issues.apache.org/jira/secure/attachment/12392287/querytree_fail.txt">querytree_fail.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-10-16T20:58:36.511Z">16/Oct/08 20:58</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12392286" data-issue-id="12404477" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12392286/querytree_works.txt" draggable="true" data-downloadurl="text/plain:querytree_works.txt:https://issues.apache.org/jira/secure/attachment/12392286/querytree_works.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12392286/querytree_works.txt" title="Latest  16/Oct/08 20:58 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:querytree_works.txt:https://issues.apache.org/jira/secure/attachment/12392286/querytree_works.txt">querytree_works.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-10-16T20:58:36.458Z">16/Oct/08 20:58</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12325311_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-681: Eliminate the parser's rewriting of the abstract syntax tree for queries with GROUP BY and/or HAVING clauses"> <a href="/jira/browse/DERBY-681" data-issue-key="DERBY-681" class="issue-link link-title resolution">DERBY-681</a> <span class="link-summary">Eliminate the parser's rewriting of the abstract syntax tree for queries with GROUP BY and/or HAVING clauses</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12415041_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4063: Constraint causes wrong query result when using exists"> <a href="/jira/browse/DERBY-4063" data-issue-key="DERBY-4063" class="issue-link link-title resolution">DERBY-4063</a> <span class="link-summary">Constraint causes wrong query result when using exists</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12466874_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4698: Simple query with HAVING clause crashes with NullPointerException"> <a href="/jira/browse/DERBY-4698" data-issue-key="DERBY-4698" class="issue-link link-title resolution">DERBY-4698</a> <span class="link-summary">Simple query with HAVING clause crashes with NullPointerException</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_army" rel="army" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;A B&quot;,&quot;emailAddress&quot;:&quot;qozinx@gmail.com&quot;,&quot;username&quot;:&quot;army&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="army"></span></span> A B </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_viyer" rel="viyer" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Venkateswaran Iyer&quot;,&quot;emailAddress&quot;:&quot;viyer@actuate.com&quot;,&quot;username&quot;:&quot;viyer&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="viyer"></span></span> Venkateswaran Iyer </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">1</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="17/Sep/08 00:47"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2008-09-17T00:47:28+0000">17/Sep/08 00:47</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="21/Jan/11 17:52"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-01-21T17:52:06+0000">21/Jan/11 17:52</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="06/Nov/08 17:33"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2008-11-06T17:33:31+0000">06/Nov/08 17:33</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3880?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-3880?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12631634\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12631634&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12631634\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12631634_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12631634_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/08 03:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-17T03:34:52+0000\'\u003e17\\/Sep\\/08 03:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan you please provide the complete stack trace? I ran it on trunk, but since my codeline is compiled with Sane=true, I am not running into npe, instead I am getting Assert Failures for a null object.\u003c\\/p\u003e\\n\\n\u003cp\u003eERROR XJ001: Java exception: \'ASSERT FAILED col\u003cspan class=\\\"error\\\"\u003e&#91;2&#93;\u003c\\/span\u003e  is null: org.apache.derby.shared.common.sanity.AssertFailure\'.\u003cbr\\/\u003e\\njava.sql.SQLException: Java exception: \'ASSERT FAILED col\u003cspan class=\\\"error\\\"\u003e&#91;2&#93;\u003c\\/span\u003e  is null: org.apache.derby.shared.common.sanity.AssertFailure\'.\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:244)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException (TransactionResourceImpl.java:403)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2192)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1325)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:555)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:329)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:508)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:3\u003cbr\\/\u003e\\n50)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:73)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.ij.main(ij.java:59)\u003cbr\\/\u003e\\nCaused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED col\u003cspan class=\\\"error\\\"\u003e&#91;2&#93;\u003c\\/span\u003e  is null\u003cbr\\/\u003e\\n        at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162)\u003cbr\\/\u003e\\n        at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.access.sort.MergeSort.checkColumnTypes(MergeSort.java:458)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.access.sort.MergeInserter.insert(MergeInserter.java:98)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.loadSorter(GroupedAggregateResultSet.java:308)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.openCore(GroupedAggregateResultSet.java:180)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(P\u003cbr\\/\u003e\\nrojectRestrictResultSet.java:168)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(BasicNoPutResultSetImpl.java:245)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:384)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)\u003cbr\\/\u003e\\n        ... 10 more\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12631634_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12631634_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/08 03:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-17T03:34:52+0000\'\u003e17\\/Sep\\/08 03:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can you please provide the complete stack trace? I ran it on trunk, but since my codeline is compiled with Sane=true, I am not running into npe, instead I am getting Assert Failures for a null object. \\n\\n ERROR XJ001: Java exception: \'ASSERT FAILED col &#91;2&#93;   is null: org.apache.derby.shared.common.sanity.AssertFailure\'. \\njava.sql.SQLException: Java exception: \'ASSERT FAILED col &#91;2&#93;   is null: org.apache.derby.shared.common.sanity.AssertFailure\'. \\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) \\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87) \\n        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:244) \\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException (TransactionResourceImpl.java:403) \\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) \\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2192) \\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) \\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1325) \\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625) \\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:555) \\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:329) \\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:508) \\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:3 \\n50) \\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248) \\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:215) \\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181) \\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:73) \\n        at org.apache.derby.tools.ij.main(ij.java:59) \\nCaused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED col &#91;2&#93;   is null \\n        at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162) \\n        at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147) \\n        at org.apache.derby.impl.store.access.sort.MergeSort.checkColumnTypes(MergeSort.java:458) \\n        at org.apache.derby.impl.store.access.sort.MergeInserter.insert(MergeInserter.java:98) \\n        at org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.loadSorter(GroupedAggregateResultSet.java:308) \\n        at org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.openCore(GroupedAggregateResultSet.java:180) \\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(P \\nrojectRestrictResultSet.java:168) \\n        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(BasicNoPutResultSetImpl.java:245) \\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:384) \\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235) \\n        ... 10 more              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12631857\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12631857&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12631857\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"viyer\\\" id=\\\"commentauthor_12631857_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=viyer\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"viyer\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Venkateswaran Iyer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12631857_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/08 17:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-17T17:29:57+0000\'\u003e17\\/Sep\\/08 17:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s the complete stack:\u003c\\/p\u003e\\n\\n\u003cp\u003eApache Derby Network Server - 10.4.2.0 - (689064) started and ready to accept connections on port 1527 at 2008-09-16 20:19:45.296 GMT \u003cbr\\/\u003e\\n----------------------------------------------------------------\u003cbr\\/\u003e\\n2008-09-16 20:26:34.328 GMT:\u003cbr\\/\u003e\\n Booting Derby version The Apache Software Foundation - Apache Derby - 10.4.2.0 - (689064): instance a816c00e-011c-6cd1-8f55-00004e6b54c8\u003cbr\\/\u003e\\non database directory C:\\\\apps\\\\derby\\\\db-derby-10.4.2.0-bin\\\\db-derby-10.4.2.0-bin\\\\bin\\\\ClassicModels  \u003c\\/p\u003e\\n\\n\u003cp\u003eDatabase Class Loader started - derby.database.classpath=\'\'\u003cbr\\/\u003e\\n2008-09-16 20:27:53.890 GMT Thread\u003cspan class=\\\"error\\\"\u003e&#91;DRDAConnThread_3,5,main&#93;\u003c\\/span\u003e (XID = 525), (SESSIONID = 8), (DATABASE = ClassicModels), (DRDAID = C0A82DCA.GFE0-4183842832230338175\u003c\\/p\u003e\\n{9}), Cleanup action starting\u003cbr\\/\u003e\\n2008-09-16 20:27:53.890 GMT Thread\u003cspan class=\\\"error\\\"\u003e&#91;DRDAConnThread_3,5,main&#93;\u003c\\/span\u003e (XID = 525), (SESSIONID = 8), (DATABASE = ClassicModels), (DRDAID = C0A82DCA.GFE0-4183842832230338175{9}\\n\u003cp\u003e), Failed Statement is: SELECT \\\"APP\\\".\\\"Orders\\\".\\\"orderNumber\\\", AVG( \\\"APP\\\".\\\"OrderDetails\\\".\\\"quantityOrdered\\\" )\u003cbr\\/\u003e\\nFROM (\\\"APP\\\".\\\"Orders\\\" INNER JOIN \\\"APP\\\".\\\"OrderDetails\\\" ON \\\"APP\\\".\\\"Orders\\\".\\\"orderNumber\\\" = \\\"APP\\\".\\\"OrderDetails\\\".\\\"orderNumber\\\" ) \u003cbr\\/\u003e\\nGROUP BY \\\"APP\\\".\\\"Orders\\\".\\\"orderNumber\\\"\u003cbr\\/\u003e\\nHAVING AVG( \\\"APP\\\".\\\"OrderDetails\\\".\\\"quantityOrdered\\\" ) &gt; 0\u003cbr\\/\u003e\\njava.lang.NullPointerException\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.execute.BasicSortObserver.getClone(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.execute.BasicSortObserver.insertNonDuplicateKey(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.execute.AggregateSortObserver.insertNonDuplicateKey(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.access.sort.SortBuffer.insert(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.access.sort.MergeInserter.insert(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.loadSorter(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.openCore(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)\u003cbr\\/\u003e\\nCleanup action completed\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"viyer\\\" id=\\\"commentauthor_12631857_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=viyer\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"viyer\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Venkateswaran Iyer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12631857_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/08 17:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-17T17:29:57+0000\'\u003e17\\/Sep\\/08 17:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s the complete stack: \\n\\n Apache Derby Network Server - 10.4.2.0 - (689064) started and ready to accept connections on port 1527 at 2008-09-16 20:19:45.296 GMT  \\n---------------------------------------------------------------- \\n2008-09-16 20:26:34.328 GMT: \\n Booting Derby version The Apache Software Foundation - Apache Derby - 10.4.2.0 - (689064): instance a816c00e-011c-6cd1-8f55-00004e6b54c8 \\non database directory C:\\\\apps\\\\derby\\\\db-derby-10.4.2.0-bin\\\\db-derby-10.4.2.0-bin\\\\bin\\\\ClassicModels   \\n\\n Database Class Loader started - derby.database.classpath=\'\' \\n2008-09-16 20:27:53.890 GMT Thread &#91;DRDAConnThread_3,5,main&#93;  (XID = 525), (SESSIONID = 8), (DATABASE = ClassicModels), (DRDAID = C0A82DCA.GFE0-4183842832230338175 \\n{9}), Cleanup action starting \\n2008-09-16 20:27:53.890 GMT Thread &#91;DRDAConnThread_3,5,main&#93;  (XID = 525), (SESSIONID = 8), (DATABASE = ClassicModels), (DRDAID = C0A82DCA.GFE0-4183842832230338175{9}\\n ), Failed Statement is: SELECT \\\"APP\\\".\\\"Orders\\\".\\\"orderNumber\\\", AVG( \\\"APP\\\".\\\"OrderDetails\\\".\\\"quantityOrdered\\\" ) \\nFROM (\\\"APP\\\".\\\"Orders\\\" INNER JOIN \\\"APP\\\".\\\"OrderDetails\\\" ON \\\"APP\\\".\\\"Orders\\\".\\\"orderNumber\\\" = \\\"APP\\\".\\\"OrderDetails\\\".\\\"orderNumber\\\" )  \\nGROUP BY \\\"APP\\\".\\\"Orders\\\".\\\"orderNumber\\\" \\nHAVING AVG( \\\"APP\\\".\\\"OrderDetails\\\".\\\"quantityOrdered\\\" ) &gt; 0 \\njava.lang.NullPointerException \\n\\tat org.apache.derby.impl.sql.execute.BasicSortObserver.getClone(Unknown Source) \\n\\tat org.apache.derby.impl.sql.execute.BasicSortObserver.insertNonDuplicateKey(Unknown Source) \\n\\tat org.apache.derby.impl.sql.execute.AggregateSortObserver.insertNonDuplicateKey(Unknown Source) \\n\\tat org.apache.derby.impl.store.access.sort.SortBuffer.insert(Unknown Source) \\n\\tat org.apache.derby.impl.store.access.sort.MergeInserter.insert(Unknown Source) \\n\\tat org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.loadSorter(Unknown Source) \\n\\tat org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.openCore(Unknown Source) \\n\\tat org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) \\n\\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) \\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) \\n\\tat org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source) \\n\\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) \\n\\tat org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source) \\nCleanup action completed              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12634204\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12634204&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12634204\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12634204_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12634204_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/08 17:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-24T17:12:26+0000\'\u003e24\\/Sep\\/08 17:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e This is a regression caused by \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-681\\\" title=\\\"Eliminate the parser&#39;s rewriting of the abstract syntax tree for queries with GROUP BY and\\/or HAVING clauses\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-681\\\"\u003e\u003cdel\u003eDERBY-681\u003c\\/del\u003e\u003c\\/a\u003e (svn revision 516454)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12634204_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12634204_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/08 17:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-24T17:12:26+0000\'\u003e24\\/Sep\\/08 17:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     This is a regression caused by   DERBY-681   (svn revision 516454)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12634206\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12634206&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12634206\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12634206_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12634206_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/08 17:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-24T17:13:55+0000\'\u003e24\\/Sep\\/08 17:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003elinking issue to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-681\\\" title=\\\"Eliminate the parser&#39;s rewriting of the abstract syntax tree for queries with GROUP BY and\\/or HAVING clauses\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-681\\\"\u003e\u003cdel\u003eDERBY-681\u003c\\/del\u003e\u003c\\/a\u003e since it was caused by that issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12634206_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12634206_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/08 17:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-24T17:13:55+0000\'\u003e24\\/Sep\\/08 17:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    linking issue to   DERBY-681   since it was caused by that issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12634275\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12634275&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12634275\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12634275_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12634275_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/08 20:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-24T20:22:39+0000\'\u003e24\\/Sep\\/08 20:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf I use an implicit join:\u003cbr\\/\u003e\\nselect t1.i, avg(t2.i2) from t1, t2 where ( t1.i = t2.i) group by t1.i\u003cbr\\/\u003e\\n having avg(t2.i2) &gt; 0;\u003c\\/p\u003e\\n\\n\u003cp\u003eThe query runs.  Can this be used as a workaround?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12634275_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12634275_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/08 20:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-24T20:22:39+0000\'\u003e24\\/Sep\\/08 20:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If I use an implicit join: \\nselect t1.i, avg(t2.i2) from t1, t2 where ( t1.i = t2.i) group by t1.i \\n having avg(t2.i2) &gt; 0; \\n\\n The query runs.  Can this be used as a workaround?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12634298\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12634298&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12634298\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"viyer\\\" id=\\\"commentauthor_12634298_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=viyer\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"viyer\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Venkateswaran Iyer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12634298_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/08 21:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-24T21:13:13+0000\'\u003e24\\/Sep\\/08 21:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat should work. Thanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"viyer\\\" id=\\\"commentauthor_12634298_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=viyer\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"viyer\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Venkateswaran Iyer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12634298_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/08 21:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-09-24T21:13:13+0000\'\u003e24\\/Sep\\/08 21:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That should work. Thanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12639647\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12639647&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12639647\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12639647_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12639647_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Oct\\/08 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-14T23:49:45+0000\'\u003e14\\/Oct\\/08 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Kathey Marsden - 14\\/Oct\\/08 23:57\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have a question about virtualColumnId\'s for ResultColumns versus their underlying Expressions.  I am looking in the debugger in ProjectRestrictNode generateMinion where it maps the source columns. At line 1421 we have\u003cbr\\/\u003e\\n\\t\\tint[] mapArray = resultColumns.mapSourceColumns();\u003c\\/p\u003e\\n\\n\u003cp\u003eThe second time we hit this line we get a mapArray:\u003cspan class=\\\"error\\\"\u003e&#91;3, -1, 5, -1, -1, 2, -1&#93;\u003c\\/span\u003e.  It seems that it is mapArray\u003cspan class=\\\"error\\\"\u003e&#91;2&#93;\u003c\\/span\u003e that is off.\u003cbr\\/\u003e\\nThe virtualColumnId of the the third entry of resultColumns is 3 and if I force mapArray\u003cspan class=\\\"error\\\"\u003e&#91;2&#93;\u003c\\/span\u003e to be 3 the query completes successfully and correctly.  The ResultColumn is an ##aggregate expression\u003cbr\\/\u003e\\name: ##aggregate expression\u003cbr\\/\u003e\\ntableName: T2\u003cbr\\/\u003e\\nisNameGenerated: false\u003cbr\\/\u003e\\nsourceTableName: T2\u003cbr\\/\u003e\\ntype: INTEGER\u003cbr\\/\u003e\\ncolumnDescriptor: null\u003cbr\\/\u003e\\nisGenerated: true\u003cbr\\/\u003e\\nisGeneratedForUnmatchedColumnInInsert: false\u003cbr\\/\u003e\\nisGroupingColumn: false\u003cbr\\/\u003e\\nisReferenced: true\u003cbr\\/\u003e\\nisRedundant: false\u003cbr\\/\u003e\\nvirtualColumnId: 3\u003cbr\\/\u003e\\nresultSetNumber: -1\u003cbr\\/\u003e\\ndataTypeServices: INTEGER\u003c\\/p\u003e\\n\\n\u003cp\u003eThe expression is a ColumnReference with sourceColumn virtualColumId 5\u003cbr\\/\u003e\\ncolumnName: I2\u003cbr\\/\u003e\\ntableNumber: 1\u003cbr\\/\u003e\\ncolumnNumber: 3\u003cbr\\/\u003e\\nreplacesAggregate: false\u003cbr\\/\u003e\\ntableName: T2\u003cbr\\/\u003e\\nnestingLevel: 0\u003cbr\\/\u003e\\nsourceLevel: 0\u003cbr\\/\u003e\\ndataTypeServices: null\u003c\\/p\u003e\\n\\n\u003cp\u003emapSourceColumns() gets the virtualColumnId using\u003cbr\\/\u003e\\n\\tVirtualColumnNode vcn = (VirtualColumnNode) resultColumn.getExpression();\u003cbr\\/\u003e\\n        ....\u003cbr\\/\u003e\\n        mapArray\u003cspan class=\\\"error\\\"\u003e&#91;index&#93;\u003c\\/span\u003e = vcn.getSourceColumn().getVirtualColumnId();\u003cbr\\/\u003e\\nso returns 5 in this case.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo my question is what is the relationship between the ResultColumn and the source column in this case?  Is it likely that the correct thing to do for an aggregate is return the virtualColumnId of the the ResultColumn for the aggregate or was that just a coincidence in this case?\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12639647_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12639647_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Oct\\/08 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-14T23:49:45+0000\'\u003e14\\/Oct\\/08 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Kathey Marsden - 14\\/Oct\\/08 23:57\\\"\u003eedited\u003c\\/span\u003e                   I have a question about virtualColumnId\'s for ResultColumns versus their underlying Expressions.  I am looking in the debugger in ProjectRestrictNode generateMinion where it maps the source columns. At line 1421 we have \\n\\t\\tint[] mapArray = resultColumns.mapSourceColumns(); \\n\\n The second time we hit this line we get a mapArray: &#91;3, -1, 5, -1, -1, 2, -1&#93; .  It seems that it is mapArray &#91;2&#93;  that is off. \\nThe virtualColumnId of the the third entry of resultColumns is 3 and if I force mapArray &#91;2&#93;  to be 3 the query completes successfully and correctly.  The ResultColumn is an ##aggregate expression \\name: ##aggregate expression \\ntableName: T2 \\nisNameGenerated: false \\nsourceTableName: T2 \\ntype: INTEGER \\ncolumnDescriptor: null \\nisGenerated: true \\nisGeneratedForUnmatchedColumnInInsert: false \\nisGroupingColumn: false \\nisReferenced: true \\nisRedundant: false \\nvirtualColumnId: 3 \\nresultSetNumber: -1 \\ndataTypeServices: INTEGER \\n\\n The expression is a ColumnReference with sourceColumn virtualColumId 5 \\ncolumnName: I2 \\ntableNumber: 1 \\ncolumnNumber: 3 \\nreplacesAggregate: false \\ntableName: T2 \\nnestingLevel: 0 \\nsourceLevel: 0 \\ndataTypeServices: null \\n\\n mapSourceColumns() gets the virtualColumnId using \\n\\tVirtualColumnNode vcn = (VirtualColumnNode) resultColumn.getExpression(); \\n        .... \\n        mapArray &#91;index&#93;  = vcn.getSourceColumn().getVirtualColumnId(); \\nso returns 5 in this case. \\n\\n So my question is what is the relationship between the ResultColumn and the source column in this case?  Is it likely that the correct thing to do for an aggregate is return the virtualColumnId of the the ResultColumn for the aggregate or was that just a coincidence in this case? \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12640312\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12640312&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12640312\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12640312_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12640312_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Oct\\/08 20:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-16T20:58:36+0000\'\u003e16\\/Oct\\/08 20:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI printed out the query trees for the working query versus the failing query.  The failing query uses a JoinNode and passes through the code in JoinNode.buildRCL() \u003cbr\\/\u003e\\n\\ttmpRCL.adjustVirtualColumnIds(resultColumns.size());\u003c\\/p\u003e\\n\\n\u003cp\u003eI noticed that if I remove this adjustment the query works, but it of course causes other problems with other queries, but perhaps there is something wrong with the VirtualColumnId adjustment.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe working query doesn\'t use a JoinNode and so does not pass through this code and as best I can tell does not do the same adjustment elsewhere.  I don\'t know if any of this is helpful but I thought I would mention it.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12640312_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12640312_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Oct\\/08 20:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-16T20:58:36+0000\'\u003e16\\/Oct\\/08 20:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I printed out the query trees for the working query versus the failing query.  The failing query uses a JoinNode and passes through the code in JoinNode.buildRCL()  \\n\\ttmpRCL.adjustVirtualColumnIds(resultColumns.size()); \\n\\n I noticed that if I remove this adjustment the query works, but it of course causes other problems with other queries, but perhaps there is something wrong with the VirtualColumnId adjustment. \\n\\n The working query doesn\'t use a JoinNode and so does not pass through this code and as best I can tell does not do the same adjustment elsewhere.  I don\'t know if any of this is helpful but I thought I would mention it. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12640574\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12640574&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12640574\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12640574_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12640574_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Oct\\/08 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-17T16:55:31+0000\'\u003e17\\/Oct\\/08 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKathey, thanks for providing the working version of the query (ie the one without the explicit inner join clause). It gives something to compare the failing query against.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhile trying to trace through the 2 queries, I found following discripency.\u003c\\/p\u003e\\n\\n\u003cp\u003eBoth successful query and the NPE query fo through the following code path\u003cbr\\/\u003e\\nThread \u003cspan class=\\\"error\\\"\u003e&#91;main&#93;\u003c\\/span\u003e (Suspended)\\t\u003cbr\\/\u003e\\n\\tProjectRestrictResultSet.doProjection(ExecRow) line: 514\\t\u003cbr\\/\u003e\\n\\tProjectRestrictResultSet.getNextRowCore() line: 291\\t\u003cbr\\/\u003e\\n\\tGroupedAggregateResultSet.getRowFromResultSet() line: 580\\t\u003cbr\\/\u003e\\n\\tGroupedAggregateResultSet.getNextRowFromRS() line: 566\\t\u003cbr\\/\u003e\\n\\tGroupedAggregateResultSet.loadSorter() line: 306\\t\u003cbr\\/\u003e\\n\\tGroupedAggregateResultSet.openCore() line: 180\\t\u003cbr\\/\u003e\\n\\tProjectRestrictResultSet.openCore() line: 168\\t\u003cbr\\/\u003e\\n\\tProjectRestrictResultSet(BasicNoPutResultSetImpl).open() line: 245\\t\u003cbr\\/\u003e\\n\\tGenericPreparedStatement.execute(Activation, boolean, long) line: 384\\t\u003cbr\\/\u003e\\n\\tEmbedStatement40(EmbedStatement).executeStatement(Activation, boolean, boolean) line: 1235\\t\u003cbr\\/\u003e\\n\\tEmbedStatement40(EmbedStatement).execute(String, boolean, boolean, int, int[], String[]) line: 625\\t\u003cbr\\/\u003e\\n\\tEmbedStatement40(EmbedStatement).execute(String) line: 555\\t\u003cbr\\/\u003e\\n\\tij.executeImmediate(String) line: 329\\t\u003cbr\\/\u003e\\n\\tMain.go(LocalizedInput, LocalizedOutput, Properties) line: 215\\t\u003cbr\\/\u003e\\n\\tutilMain.runScriptGuts() line: 350\\t\u003cbr\\/\u003e\\n\\tMain.main(String[]) line: 73\\t\u003cbr\\/\u003e\\n\\tutilMain.go(LocalizedInput[], LocalizedOutput, Properties) line: 248\\t\u003cbr\\/\u003e\\n\\tMain.mainCore(String[], Main) line: 181\\t\u003cbr\\/\u003e\\n\\tMain.main(String[]) line: 73\\t\u003cbr\\/\u003e\\n\\tij.main(String[]) line: 59\\t\u003c\\/p\u003e\\n\\n\u003cp\u003eBut if you examin row that results after the projection in ProjectRestrictResultSet, you will notice that the successful query has following row\u003cbr\\/\u003e\\nresult\\tValueRow  (id=212)\\t\u003c\\/p\u003e\\n{ 1, NULL, 10, NULL, NULL, 10, NULL }\\n\u003cp\u003ewhereas NPE query has following row\u003cbr\\/\u003e\\nresult\\tValueRow  (id=251)\\t\u003c\\/p\u003e\\n{ 1, NULL, null, NULL, NULL, 10, NULL }\\t\\n\\n\u003cp\u003eAs you can see, the 3rd column has value of null in NPE query whereas the successful query has value 10. Will debug more to see what causes this but thought will post this piece of information.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12640574_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12640574_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Oct\\/08 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-17T16:55:31+0000\'\u003e17\\/Oct\\/08 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Kathey, thanks for providing the working version of the query (ie the one without the explicit inner join clause). It gives something to compare the failing query against. \\n\\n While trying to trace through the 2 queries, I found following discripency. \\n\\n Both successful query and the NPE query fo through the following code path \\nThread  &#91;main&#93;  (Suspended)\\t \\n\\tProjectRestrictResultSet.doProjection(ExecRow) line: 514\\t \\n\\tProjectRestrictResultSet.getNextRowCore() line: 291\\t \\n\\tGroupedAggregateResultSet.getRowFromResultSet() line: 580\\t \\n\\tGroupedAggregateResultSet.getNextRowFromRS() line: 566\\t \\n\\tGroupedAggregateResultSet.loadSorter() line: 306\\t \\n\\tGroupedAggregateResultSet.openCore() line: 180\\t \\n\\tProjectRestrictResultSet.openCore() line: 168\\t \\n\\tProjectRestrictResultSet(BasicNoPutResultSetImpl).open() line: 245\\t \\n\\tGenericPreparedStatement.execute(Activation, boolean, long) line: 384\\t \\n\\tEmbedStatement40(EmbedStatement).executeStatement(Activation, boolean, boolean) line: 1235\\t \\n\\tEmbedStatement40(EmbedStatement).execute(String, boolean, boolean, int, int[], String[]) line: 625\\t \\n\\tEmbedStatement40(EmbedStatement).execute(String) line: 555\\t \\n\\tij.executeImmediate(String) line: 329\\t \\n\\tMain.go(LocalizedInput, LocalizedOutput, Properties) line: 215\\t \\n\\tutilMain.runScriptGuts() line: 350\\t \\n\\tMain.main(String[]) line: 73\\t \\n\\tutilMain.go(LocalizedInput[], LocalizedOutput, Properties) line: 248\\t \\n\\tMain.mainCore(String[], Main) line: 181\\t \\n\\tMain.main(String[]) line: 73\\t \\n\\tij.main(String[]) line: 59\\t \\n\\n But if you examin row that results after the projection in ProjectRestrictResultSet, you will notice that the successful query has following row \\nresult\\tValueRow  (id=212)\\t \\n{ 1, NULL, 10, NULL, NULL, 10, NULL }\\n whereas NPE query has following row \\nresult\\tValueRow  (id=251)\\t \\n{ 1, NULL, null, NULL, NULL, 10, NULL }\\t\\n\\n As you can see, the 3rd column has value of null in NPE query whereas the successful query has value 10. Will debug more to see what causes this but thought will post this piece of information.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12641062\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12641062&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12641062\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12641062_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12641062_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Oct\\/08 16:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-20T16:39:14+0000\'\u003e20\\/Oct\\/08 16:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Mamta for looking at this. I think the reason for the difference is that sourceRow has only 3 columns yet projectMapping has values  \u003cspan class=\\\"error\\\"\u003e&#91;3, -1, 5, -1, -1, 2, -1&#93;\u003c\\/span\u003e, the third entry (5) does not refer to an actual column so when we get to \u003cbr\\/\u003e\\n\\tresult.setColumn(index + 1, sourceRow.getColumn(projectMapping\u003cspan class=\\\"error\\\"\u003e&#91;index&#93;\u003c\\/span\u003e));\u003c\\/p\u003e\\n\\n\u003cp\u003eWe call ValueRow.getColumn()  which is defined as:\u003cbr\\/\u003e\\n\\tpublic DataValueDescriptor\\tgetColumn (int position) \u003c\\/p\u003e\\n{\\n\\t\\tif (position &lt;= column.length)\\n\\t\\t\\treturn column[position-1];\\n\\t\\telse\\n\\t\\t\\treturn (DataValueDescriptor)null;\\n\\t}\\n\\n\u003cp\u003eand return null because position is greater than column.length.\u003c\\/p\u003e\\n\\n\u003cp\u003eI found that projectMapping is originally generated in projectRestrictNode.generateMinion() when we call \u003cbr\\/\u003e\\n\\tint[] mapArray = resultColumns.mapSourceColumns();\u003c\\/p\u003e\\n\\n\u003cp\u003eResultColumnList. mapSourceColumns for the column in question  executes this code:\u003cbr\\/\u003e\\nelse if (resultColumn.getExpression() instanceof ColumnReference)\u003c\\/p\u003e\\n\\t\\t\\t{\\n\\t\\t\\t\\tColumnReference cr = (ColumnReference) resultColumn.getExpression();\\n                                .....\\n\\t\\t\\t\\t\\t\\/\\/ Virtual column #s are 1-based\\n\\t\\t\\t\\t\\tmapArray[index] = cr.getSource().getVirtualColumnId();\\n\\t\\t\\t}\\n\\n\\n\u003cp\u003eWhere the resultColumn looks like:\u003cbr\\/\u003e\\n\\tResultColumn  (id=72)\\t\u003cbr\\/\u003e\\n\\texposedName\\t\\\"##aggregate expression\\\"\\t\u003cbr\\/\u003e\\n\\tvirtualColumnId\\t3\\t\u003cbr\\/\u003e\\n\\texpression\\tColumnReference  (id=74)\\t\u003cbr\\/\u003e\\n\\t\\tcolumnName\\t\\\"I2\\\"\\t\u003cbr\\/\u003e\\n\\t\\tsource\\tResultColumn  (id=76)\\t\u003cbr\\/\u003e\\n\\t\\t\\texposedName\\t\\\"I2\\\"\\t\u003cbr\\/\u003e\\n\\t\\t\\tvirtualColumnId\\t5\\t\u003cbr\\/\u003e\\n\\t\\t\\texpression\\tVirtualColumnNode  (id=94)\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\tsourceColumn\\tResultColumn  (id=100)\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\texposedName\\t\\\"I2\\\"\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\tvirtualColumnId\\t2\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\texpression\\tVirtualColumnNode  (id=102)\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\tsourceColumn\\tResultColumn  (id=214)\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\texpression\\tVirtualColumnNode  (id=227)\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\tvirtualColumnId\\t2\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\tsourceColumn\\tResultColumn  (id=239)\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\\texposedName\\t\\\"I2\\\"\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\\texpression\\tBaseColumnNode  (id=251)\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tcolumnName\\t\\\"I2\\\"\\t\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tvirtualColumnId\\t2\\t\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eThe virtualColumnId of the ColumnReference under the ##aggregate expression is \u003cb\u003e5\u003c\\/b\u003e, yet there are more deeply nested VirtualColumnNode\'s with a virtualColumnId of 2 which I think is correct.  I think I need to better understand mapSourceColumns()  and the meaning of this deeply nested ResultColumn structure to understand what\'s right here.\u003c\\/p\u003e\\n\\n\u003cp\u003eKathey\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12641062_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12641062_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Oct\\/08 16:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-20T16:39:14+0000\'\u003e20\\/Oct\\/08 16:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Mamta for looking at this. I think the reason for the difference is that sourceRow has only 3 columns yet projectMapping has values   &#91;3, -1, 5, -1, -1, 2, -1&#93; , the third entry (5) does not refer to an actual column so when we get to  \\n\\tresult.setColumn(index + 1, sourceRow.getColumn(projectMapping &#91;index&#93; )); \\n\\n We call ValueRow.getColumn()  which is defined as: \\n\\tpublic DataValueDescriptor\\tgetColumn (int position)  \\n{\\n\\t\\tif (position &lt;= column.length)\\n\\t\\t\\treturn column[position-1];\\n\\t\\telse\\n\\t\\t\\treturn (DataValueDescriptor)null;\\n\\t}\\n\\n and return null because position is greater than column.length. \\n\\n I found that projectMapping is originally generated in projectRestrictNode.generateMinion() when we call  \\n\\tint[] mapArray = resultColumns.mapSourceColumns(); \\n\\n ResultColumnList. mapSourceColumns for the column in question  executes this code: \\nelse if (resultColumn.getExpression() instanceof ColumnReference) \\n\\t\\t\\t{\\n\\t\\t\\t\\tColumnReference cr = (ColumnReference) resultColumn.getExpression();\\n                                .....\\n\\t\\t\\t\\t\\t\\/\\/ Virtual column #s are 1-based\\n\\t\\t\\t\\t\\tmapArray[index] = cr.getSource().getVirtualColumnId();\\n\\t\\t\\t}\\n\\n\\n Where the resultColumn looks like: \\n\\tResultColumn  (id=72)\\t \\n\\texposedName\\t\\\"##aggregate expression\\\"\\t \\n\\tvirtualColumnId\\t3\\t \\n\\texpression\\tColumnReference  (id=74)\\t \\n\\t\\tcolumnName\\t\\\"I2\\\"\\t \\n\\t\\tsource\\tResultColumn  (id=76)\\t \\n\\t\\t\\texposedName\\t\\\"I2\\\"\\t \\n\\t\\t\\tvirtualColumnId\\t5\\t \\n\\t\\t\\texpression\\tVirtualColumnNode  (id=94)\\t \\n\\t\\t\\t\\tsourceColumn\\tResultColumn  (id=100)\\t \\n\\t\\t\\t\\t\\texposedName\\t\\\"I2\\\"\\t \\n\\t\\t\\t\\t\\tvirtualColumnId\\t2\\t \\n\\t\\t\\t\\t\\texpression\\tVirtualColumnNode  (id=102)\\t \\n\\t\\t\\t\\t\\t\\tsourceColumn\\tResultColumn  (id=214)\\t \\n\\t\\t\\t\\t\\t\\t\\texpression\\tVirtualColumnNode  (id=227)\\t \\n\\t\\t\\t\\t\\t\\t\\tvirtualColumnId\\t2\\t \\n\\t\\t\\t\\t\\t\\t\\t\\tsourceColumn\\tResultColumn  (id=239)\\t \\n\\t\\t\\t\\t\\t\\t\\t\\t\\texposedName\\t\\\"I2\\\"\\t \\n\\t\\t\\t\\t\\t\\t\\t\\t\\texpression\\tBaseColumnNode  (id=251)\\t \\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tcolumnName\\t\\\"I2\\\"\\t \\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tvirtualColumnId\\t2\\t \\n\\n\\n The virtualColumnId of the ColumnReference under the ##aggregate expression is  5 , yet there are more deeply nested VirtualColumnNode\'s with a virtualColumnId of 2 which I think is correct.  I think I need to better understand mapSourceColumns()  and the meaning of this deeply nested ResultColumn structure to understand what\'s right here. \\n\\n Kathey \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12641067\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12641067&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12641067\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12641067_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12641067_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Oct\\/08 16:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-20T16:50:10+0000\'\u003e20\\/Oct\\/08 16:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWeill it looks like the indentation for my ResultColumn summary did not show up in the comment so I am attaching a file AggregateExpressionResultColumn.txt\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12641067_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12641067_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Oct\\/08 16:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-20T16:50:10+0000\'\u003e20\\/Oct\\/08 16:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Weill it looks like the indentation for my ResultColumn summary did not show up in the comment so I am attaching a file AggregateExpressionResultColumn.txt              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12642202\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12642202&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12642202\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12642202_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12642202_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/08 17:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-23T17:05:51+0000\'\u003e23\\/Oct\\/08 17:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for your work on this, Kathey.\u003c\\/p\u003e\\n\\n\u003cp\u003eI spent some time looking at this, and there definitely seems to be something amiss with the virtual column ids for the aggregates, but I wasn\'t able to figure out what it is that\'s off.\u003c\\/p\u003e\\n\\n\u003cp\u003eYou may want to try running two queries that are as similar as possible, where one passes and the other fails, and then try to figure out what it is that\'s different between the two compilation paths. The ones I\'ve been using are:\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8211; Passes.\u003cbr\\/\u003e\\nselect t1.i, avg(t2.i2)\u003cbr\\/\u003e\\n  from t1 inner join t2 on (t1.i = t2.i)\u003cbr\\/\u003e\\n  group by t1.i having avg(t2.i) &gt; 0;\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8211; Fails.\u003cbr\\/\u003e\\nselect t1.i, avg(t2.i)\u003cbr\\/\u003e\\n  from t1 inner join t2 on (t1.i = t2.i)\u003cbr\\/\u003e\\n  group by t1.i having avg(t2.i) &gt; 0;\u003c\\/p\u003e\\n\\n\u003cp\u003eThe only difference between the two is the column that is referenced in the avg for the SELECT (t2.i2 vs t2.i).  That said, I just now also noticed the following:\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8211; Passes.\u003cbr\\/\u003e\\nselect t1.i, avg(t2.i2)\u003cbr\\/\u003e\\n  from t1 inner join t2 on (t1.i = t2.i)\u003cbr\\/\u003e\\n  group by t1.i having avg(t2.i) &gt; 0;\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8211; Passes.\u003cbr\\/\u003e\\nselect t1.i, avg(t2.i2)\u003cbr\\/\u003e\\n  from t1 inner join t2 on (t1.i = t2.i)\u003cbr\\/\u003e\\n  group by t1.i having max(t2.i) &gt; 0;\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8211; Fails.\u003cbr\\/\u003e\\nselect t1.i, avg(t2.i2)\u003cbr\\/\u003e\\n  from t1 inner join t2 on (t1.i = t2.i)\u003cbr\\/\u003e\\n  group by t1.i having avg(t2.i2) &gt; 0;\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8211; Fails.\u003cbr\\/\u003e\\nselect t1.i, avg(t2.i2)\u003cbr\\/\u003e\\n  from t1 inner join t2 on (t1.i = t2.i)\u003cbr\\/\u003e\\n  group by t1.i having min(t2.i2) &gt; 0;\u003c\\/p\u003e\\n\\n\u003cp\u003eFrom these tiny examples, it \u003cb\u003eseems\u003c\\/b\u003e that if the aggregate in the SELECT list references the same column as the aggregate in the HAVING clause, then the query fails; if they reference \u003cb\u003edifferent\u003c\\/b\u003e columns, the query passes.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat might be something to investigate further?  Without having looked at all into it (I only just now realized the apparent correlation), I think the \\\"SubstituteExpressionVisitor\\\" that is used by GroupByNode relies in some way on \\\"equivalent\\\" expressions, and then it plugs VirtualColumnNodes into the tree based on that equivalency.  I wonder if  the fact that the SELECT clause and the HAVING clause are have \\\"equivalent\\\" column references is somehow messing the virtual column ids up somewhere...?  It\'s pure speculation, but if you\'re looking for options, that might be one to pursue...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12642202_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12642202_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/08 17:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-23T17:05:51+0000\'\u003e23\\/Oct\\/08 17:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for your work on this, Kathey. \\n\\n I spent some time looking at this, and there definitely seems to be something amiss with the virtual column ids for the aggregates, but I wasn\'t able to figure out what it is that\'s off. \\n\\n You may want to try running two queries that are as similar as possible, where one passes and the other fails, and then try to figure out what it is that\'s different between the two compilation paths. The ones I\'ve been using are: \\n\\n &#8211; Passes. \\nselect t1.i, avg(t2.i2) \\n  from t1 inner join t2 on (t1.i = t2.i) \\n  group by t1.i having avg(t2.i) &gt; 0; \\n\\n &#8211; Fails. \\nselect t1.i, avg(t2.i) \\n  from t1 inner join t2 on (t1.i = t2.i) \\n  group by t1.i having avg(t2.i) &gt; 0; \\n\\n The only difference between the two is the column that is referenced in the avg for the SELECT (t2.i2 vs t2.i).  That said, I just now also noticed the following: \\n\\n &#8211; Passes. \\nselect t1.i, avg(t2.i2) \\n  from t1 inner join t2 on (t1.i = t2.i) \\n  group by t1.i having avg(t2.i) &gt; 0; \\n\\n &#8211; Passes. \\nselect t1.i, avg(t2.i2) \\n  from t1 inner join t2 on (t1.i = t2.i) \\n  group by t1.i having max(t2.i) &gt; 0; \\n\\n &#8211; Fails. \\nselect t1.i, avg(t2.i2) \\n  from t1 inner join t2 on (t1.i = t2.i) \\n  group by t1.i having avg(t2.i2) &gt; 0; \\n\\n &#8211; Fails. \\nselect t1.i, avg(t2.i2) \\n  from t1 inner join t2 on (t1.i = t2.i) \\n  group by t1.i having min(t2.i2) &gt; 0; \\n\\n From these tiny examples, it  seems  that if the aggregate in the SELECT list references the same column as the aggregate in the HAVING clause, then the query fails; if they reference  different  columns, the query passes. \\n\\n That might be something to investigate further?  Without having looked at all into it (I only just now realized the apparent correlation), I think the \\\"SubstituteExpressionVisitor\\\" that is used by GroupByNode relies in some way on \\\"equivalent\\\" expressions, and then it plugs VirtualColumnNodes into the tree based on that equivalency.  I wonder if  the fact that the SELECT clause and the HAVING clause are have \\\"equivalent\\\" column references is somehow messing the virtual column ids up somewhere...?  It\'s pure speculation, but if you\'re looking for options, that might be one to pursue...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12642243\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12642243&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12642243\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12642243_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12642243_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/08 19:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-23T19:33:30+0000\'\u003e23\\/Oct\\/08 19:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eArmy\'s observation about the SubstituteExpressionVisitor made me remember\u003cbr\\/\u003e\\nthe discussion in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3094\\\" title=\\\"Grouping of expressions causes NullPointerException\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3094\\\"\u003e\u003cdel\u003eDERBY-3094\u003c\\/del\u003e\u003c\\/a\u003e. It may not be directly related, but there is some\u003cbr\\/\u003e\\ndetailed discussion in the comments to that issue regarding various paths\u003cbr\\/\u003e\\nthrough the code in question, which might be useful. So I thought I\'d mention it.\u003c\\/p\u003e\\n\\n\u003cp\u003ePlus, although I have no reason to think this would be true, it might be interesting\u003cbr\\/\u003e\\nto try backing out the changes for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3094\\\" title=\\\"Grouping of expressions causes NullPointerException\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3094\\\"\u003e\u003cdel\u003eDERBY-3094\u003c\\/del\u003e\u003c\\/a\u003e and see if that had any affect\u003cbr\\/\u003e\\non either the repro script or on the various test cases that Army mentions.\u003c\\/p\u003e\\n\\n\u003cp\u003eHopefully this is just a red herring, and we don\'t have to drag all the complexity\u003cbr\\/\u003e\\nof \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3094\\\" title=\\\"Grouping of expressions causes NullPointerException\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3094\\\"\u003e\u003cdel\u003eDERBY-3094\u003c\\/del\u003e\u003c\\/a\u003e into this issue but hopefully it\'s also helpful for people working\u003cbr\\/\u003e\\non this issue to be aware of that history.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12642243_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12642243_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/08 19:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-23T19:33:30+0000\'\u003e23\\/Oct\\/08 19:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Army\'s observation about the SubstituteExpressionVisitor made me remember \\nthe discussion in   DERBY-3094  . It may not be directly related, but there is some \\ndetailed discussion in the comments to that issue regarding various paths \\nthrough the code in question, which might be useful. So I thought I\'d mention it. \\n\\n Plus, although I have no reason to think this would be true, it might be interesting \\nto try backing out the changes for   DERBY-3094   and see if that had any affect \\non either the repro script or on the various test cases that Army mentions. \\n\\n Hopefully this is just a red herring, and we don\'t have to drag all the complexity \\nof   DERBY-3094   into this issue but hopefully it\'s also helpful for people working \\non this issue to be aware of that history.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12643316\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12643316&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12643316\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12643316_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12643316_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Oct\\/08 19:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-28T19:34:03+0000\'\u003e28\\/Oct\\/08 19:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Army and Brian for looking at this pesky issue. With regard to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3094\\\" title=\\\"Grouping of expressions causes NullPointerException\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3094\\\"\u003e\u003cdel\u003eDERBY-3094\u003c\\/del\u003e\u003c\\/a\u003e, thank you for the write up. It was indeed most informative.  As you suggested I backed out the change for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3094\\\" title=\\\"Grouping of expressions causes NullPointerException\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3094\\\"\u003e\u003cdel\u003eDERBY-3094\u003c\\/del\u003e\u003c\\/a\u003e and found no appreciable difference in the behaviour of the queries in question in this issue.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eI looked at the SubstituteExpressionVisitor logic and don\'t think it is related. The result column in question is the one created in AggregateNode.java with the code\u003cbr\\/\u003e\\nnode = (operand == null) ?\u003cbr\\/\u003e\\n\\t\\t\\tthis.getNewNullResultExpression() :\u003cbr\\/\u003e\\n\\t\\t\\toperand;\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\treturn (ResultColumn) getNodeFactory().getNode(\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\tC_NodeTypes.RESULT_COLUMN,\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\\\"##aggregate expression\\\",\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\tnode,\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\tgetContextManager());\u003cbr\\/\u003e\\n\\t}\u003c\\/p\u003e\\n\\n\u003cp\u003ewhere it is the operand being wrapped. I do not think this column is traversed with the SubstituteExpressionVisitor.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12643316_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12643316_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Oct\\/08 19:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-28T19:34:03+0000\'\u003e28\\/Oct\\/08 19:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Army and Brian for looking at this pesky issue. With regard to   DERBY-3094  , thank you for the write up. It was indeed most informative.  As you suggested I backed out the change for   DERBY-3094   and found no appreciable difference in the behaviour of the queries in question in this issue. \\n\\n\\n I looked at the SubstituteExpressionVisitor logic and don\'t think it is related. The result column in question is the one created in AggregateNode.java with the code \\nnode = (operand == null) ? \\n\\t\\t\\tthis.getNewNullResultExpression() : \\n\\t\\t\\toperand; \\n\\n \\t\\treturn (ResultColumn) getNodeFactory().getNode( \\n\\t\\t\\t\\t\\t\\t\\t\\tC_NodeTypes.RESULT_COLUMN, \\n\\t\\t\\t\\t\\t\\t\\t\\t\\\"##aggregate expression\\\", \\n\\t\\t\\t\\t\\t\\t\\t\\tnode, \\n\\t\\t\\t\\t\\t\\t\\t\\tgetContextManager()); \\n\\t} \\n\\n where it is the operand being wrapped. I do not think this column is traversed with the SubstituteExpressionVisitor.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12644199\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12644199&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12644199\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12644199_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12644199_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Oct\\/08 03:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-31T03:16:12+0000\'\u003e31\\/Oct\\/08 03:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI looked a bit more at this issue and I think I\'ve discovered at least part of the problem.  A query like:\u003c\\/p\u003e\\n\\n\u003cp\u003e  select t1.i, avg(t2.i)\u003cbr\\/\u003e\\n    from t1 inner join t2 on (t1.i = t2.i)\u003cbr\\/\u003e\\n    group by t1.i having avg(t2.i) &gt; 0;\u003c\\/p\u003e\\n\\n\u003cp\u003ehas two aggregates in it, which means the compile time query tree has two AggregateNodes, each of which has an \\\"operand\\\" that is a column reference.  The result column to which the operand points is determined at bind time, and in this case the result column \\\"t2.i\\\" points to a bind-time JoinNode.  The JoinNode\'s bind-time result column list is simply a concatenation of the result column lists from its operands.  In our example, the query specifies T1 followed by T2, so the JoinNode\'s bind-time RCL is: \u003c\\/p\u003e\\n{ T1.i, T1.c, T2.i, T2.c2, T2.i2 }\\n\u003cp\u003e.  Notice how, with respect to this list, the position of \\\"t2.i\\\" is \\\"3\\\".  So when we bind the AggregateNodes, each of them ends up with an operand that is a ColumnReference which points to the \\\"t2.i\\\" column of the bind-time JoinNode, which in turn has virtual column id of \\\"3\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eAfter binding is complete we start optimization, the first phase of which is preprocessing.  As part of SelectNode preprocessing we look at the FromList to see if there are any JoinNodes that can be flattened.  In the above query the JoinNode \u003cb\u003ecan\u003c\\/b\u003e be flattened, which means it effectively disappears.  That in turn means that any result columns in the SELECT list have to be updated to reflect the fact that they no longer point to the JoinNode; instead, they point directly to the underlying base tables.  The process of flattening the JoinNode and updating the SelectNode\'s result column list begins with the following call in SelectNode.preprocess():\u003c\\/p\u003e\\n\\n\u003cp\u003e    \\/\\/ Flatten any flattenable FromSubquerys or JoinNodes\u003cbr\\/\u003e\\n    fromList.flattenFromTables(resultColumns, \u003cbr\\/\u003e\\n        wherePredicates, \u003cbr\\/\u003e\\n        whereSubquerys,\u003cbr\\/\u003e\\n      groupByList);\u003c\\/p\u003e\\n\\n\u003cp\u003eNotice how we pass the SelectNode\'s RCL into the flattenFromTables method, but we do \u003cb\u003enot\u003c\\/b\u003e pass the HAVING clause.  Long story short, the AggregateNode in the SelectNode\'s RCL is properly updated to reflect the removal of the JoinNode--but the AggregateNode in the HAVING clause continues to point to a result column from the now-useless JoinNode.  The \u003cb\u003ereal\u003c\\/b\u003e column to which the Aggregate should be pointing is actually buried \u003cb\u003ebeneath\u003c\\/b\u003e the JoinNode\'s ResultColumn, so the aggregate\'s operand should have been remapped to point to the buried column. (And indeed, that\'s exactly what happens with the aggregate in the SelectNode\'s RCL.)\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen optimization is done and we modify the tree, result columns are updated to reflect the final join order and also to remove any un-referenced columns.  But since the HAVING aggregate node is still pointing to the unused JoinNode result column, it doesn\'t see any changes--it continues to point to a ResultColumn that has a virtual column id of \\\"3\\\" and which points to a JoinNode that is no longer valid.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe final query plan inclues a \u003cb\u003enew\u003c\\/b\u003e JoinNode between T1 and T2, and that JoinNode\'s RCL only contains columns which are referenced in the query.  Thus the execution-time JoinNode result column list is, for the above query, \u003c\\/p\u003e\\n{ T1.i, T2.i }\\n\u003cp\u003e.  Note how it only has TWO columns in it, not five like the bind-time JoinNode.  So when it comes time to execute the query, the aggregate in the having clause ends up pointing to column \\\"3\\\" of the new JoinNode\'s RCL, and since that doesn\'t exist, the column value is set to null (as Kathey noted in earlier comments).  Attempts to reference that column for GROUP BY sorting, then, result in the NPE.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reason the same query works if the two aggregates reference two \u003cem\u003edifferent\u003c\\/em\u003e columns in T2 has nothing to do with equivalence-\u003cdel\u003ethat was a red herring, sorry for the miscue.  The reason the query passes appears to have something to do with referenced columns\u003c\\/del\u003e-esp. the SelectNode (which includes the Select RCL and the Having clause) then references TWO columns from T2 plus ONE column from T1, leading to THREE columns in the execution JoinNode\'s RCL: \u003c\\/p\u003e\\n{ T1.i, T2.i, T2.i2 }\\n\u003cp\u003e.  So now the RCL has three columns instead of two, which means the result column in the HAVING aggregate, which still has the INCORRECT virtual id of \\\"3\\\", accidentally points to a valid column, and thus the query passes--but that was just chance, the code is still technically wrong.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis also explains why the original query passes if the user does NOT specify \\\"inner join\\\".  The inclusion of \\\"inner join\\\" leads to the creation of the bind-time JoinNode between T1 and T2, against which the aggregates are then bound.  In preprocessing we realize the JoinNode is useless so we flatten it out of the query, and that causes the aforementioned problem.  But if the query does not have \\\"inner join\\\", the bind-time JoinNode is never created, which means both aggregate nodes already point directly to the underlying base tables.  Throughout optimization and query generation the base table result columns are properly updated, which means both aggregates end up pointing to the correct place, and all is well.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo all of that said, I think the fix for this problem is to somehow ensure that the HAVING clause\'s AggregateNode is correctly remapped when\\/if necessary, esp. if it points to a JoinNode that has been flattened out.  I happened to notice that, when the JoinNode is flattened, all of its result columns are marked as \\\"redundant\\\" as part of the flattening process (see JoinNode.flatten()).  So the quick (and possibly NOT complete) fix that I found was to add an \\\"if\\\" statement to the getNewExpressionResultColumn() method of AggregateNode.java.  That method is called as part of \\\"modification of access paths\\\"-\u003cdel\u003ei.e. after optimization has completed\u003c\\/del\u003e-and is used for creating the result column that will ultimately be used for aggregate input at execution time.  I found that if I added logic to remap the Aggregate\'s operand (if it\'s a column reference), then the posted query starts running without error:\u003c\\/p\u003e\\n\\n\u003cp\u003eIndex: java\\/engine\\/org\\/apache\\/derby\\/impl\\/sql\\/compile\\/AggregateNode.java\u003cbr\\/\u003e\\n===================================================================\u003cbr\\/\u003e\\n&#8212; java\\/engine\\/org\\/apache\\/derby\\/impl\\/sql\\/compile\\/AggregateNode.java    (revision 707244)\u003cbr\\/\u003e\\n+++ java\\/engine\\/org\\/apache\\/derby\\/impl\\/sql\\/compile\\/AggregateNode.java    (working copy)\u003cbr\\/\u003e\\n@@ -539,6 +539,26 @@\u003cbr\\/\u003e\\n                        this.getNewNullResultExpression() :\u003cbr\\/\u003e\\n                        operand;\u003c\\/p\u003e\\n\\n\u003cp\u003e +        \\/* The operand for this aggregate node was initialized at bind\u003cbr\\/\u003e\\n +         * time.  Between then and now it\'s possible that certain changes\u003cbr\\/\u003e\\n +         * have been made to the query tree which affect this operand. In\u003cbr\\/\u003e\\n +         * particular, if the operand was pointing to a result column in\u003cbr\\/\u003e\\n +         * a JoinNode and then that JoinNode was flattened during pre-\u003cbr\\/\u003e\\n +         * processing, all of the references to that JoinNode--including\u003cbr\\/\u003e\\n +         * this aggregate\'s operand--need to be updated to reflect the\u003cbr\\/\u003e\\n +         * fact that the Join Node no longer exists.  So check to see if\u003cbr\\/\u003e\\n +         * the operand is a column reference, and if so, make a call to\u003cbr\\/\u003e\\n +         * remap it to its underlying expression.  If nothing has happened\u003cbr\\/\u003e\\n +         * then this will be a no-op; but if something has changed to void\u003cbr\\/\u003e\\n +         * out the result column to which the operand points, the result\u003cbr\\/\u003e\\n +         * column will be marked \\\"redundant\\\" and the following call should\u003cbr\\/\u003e\\n +         * remap as appropriate. \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3880\\\" title=\\\"NPE on a query with having clause involving a join\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3880\\\"\u003e\u003cdel\u003eDERBY-3880\u003c\\/del\u003e\u003c\\/a\u003e.\u003cbr\\/\u003e\\n +         *\\/\u003cbr\\/\u003e\\n +        if (operand instanceof ColumnReference)\u003cbr\\/\u003e\\n +        \u003c\\/p\u003e\\n{\\n +            ((ColumnReference)operand).remapColumnReferencesToExpressions();\\n +        }\\n\u003cp\u003e +\u003cbr\\/\u003e\\n            return (ResultColumn) getNodeFactory().getNode(\u003cbr\\/\u003e\\n                                                                C_NodeTypes.RESULT_COLUMN,\u003cbr\\/\u003e\\n                                                                \\\"##aggregate expression\\\",\u003c\\/p\u003e\\n\\n\u003cp\u003eI didn\'t run any other tests, and I admit that this change may not be sufficient (or it may be too general), but it does cause the reported query to run without error, so at the very least it demonstrates the problem.  There could very well be a better way to fix it...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12644199_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12644199_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Oct\\/08 03:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-31T03:16:12+0000\'\u003e31\\/Oct\\/08 03:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I looked a bit more at this issue and I think I\'ve discovered at least part of the problem.  A query like: \\n\\n   select t1.i, avg(t2.i) \\n    from t1 inner join t2 on (t1.i = t2.i) \\n    group by t1.i having avg(t2.i) &gt; 0; \\n\\n has two aggregates in it, which means the compile time query tree has two AggregateNodes, each of which has an \\\"operand\\\" that is a column reference.  The result column to which the operand points is determined at bind time, and in this case the result column \\\"t2.i\\\" points to a bind-time JoinNode.  The JoinNode\'s bind-time result column list is simply a concatenation of the result column lists from its operands.  In our example, the query specifies T1 followed by T2, so the JoinNode\'s bind-time RCL is:  \\n{ T1.i, T1.c, T2.i, T2.c2, T2.i2 }\\n .  Notice how, with respect to this list, the position of \\\"t2.i\\\" is \\\"3\\\".  So when we bind the AggregateNodes, each of them ends up with an operand that is a ColumnReference which points to the \\\"t2.i\\\" column of the bind-time JoinNode, which in turn has virtual column id of \\\"3\\\". \\n\\n After binding is complete we start optimization, the first phase of which is preprocessing.  As part of SelectNode preprocessing we look at the FromList to see if there are any JoinNodes that can be flattened.  In the above query the JoinNode  can  be flattened, which means it effectively disappears.  That in turn means that any result columns in the SELECT list have to be updated to reflect the fact that they no longer point to the JoinNode; instead, they point directly to the underlying base tables.  The process of flattening the JoinNode and updating the SelectNode\'s result column list begins with the following call in SelectNode.preprocess(): \\n\\n     \\/\\/ Flatten any flattenable FromSubquerys or JoinNodes \\n    fromList.flattenFromTables(resultColumns,  \\n        wherePredicates,  \\n        whereSubquerys, \\n      groupByList); \\n\\n Notice how we pass the SelectNode\'s RCL into the flattenFromTables method, but we do  not  pass the HAVING clause.  Long story short, the AggregateNode in the SelectNode\'s RCL is properly updated to reflect the removal of the JoinNode--but the AggregateNode in the HAVING clause continues to point to a result column from the now-useless JoinNode.  The  real  column to which the Aggregate should be pointing is actually buried  beneath  the JoinNode\'s ResultColumn, so the aggregate\'s operand should have been remapped to point to the buried column. (And indeed, that\'s exactly what happens with the aggregate in the SelectNode\'s RCL.) \\n\\n When optimization is done and we modify the tree, result columns are updated to reflect the final join order and also to remove any un-referenced columns.  But since the HAVING aggregate node is still pointing to the unused JoinNode result column, it doesn\'t see any changes--it continues to point to a ResultColumn that has a virtual column id of \\\"3\\\" and which points to a JoinNode that is no longer valid. \\n\\n The final query plan inclues a  new  JoinNode between T1 and T2, and that JoinNode\'s RCL only contains columns which are referenced in the query.  Thus the execution-time JoinNode result column list is, for the above query,  \\n{ T1.i, T2.i }\\n .  Note how it only has TWO columns in it, not five like the bind-time JoinNode.  So when it comes time to execute the query, the aggregate in the having clause ends up pointing to column \\\"3\\\" of the new JoinNode\'s RCL, and since that doesn\'t exist, the column value is set to null (as Kathey noted in earlier comments).  Attempts to reference that column for GROUP BY sorting, then, result in the NPE. \\n\\n The reason the same query works if the two aggregates reference two  different  columns in T2 has nothing to do with equivalence- that was a red herring, sorry for the miscue.  The reason the query passes appears to have something to do with referenced columns -esp. the SelectNode (which includes the Select RCL and the Having clause) then references TWO columns from T2 plus ONE column from T1, leading to THREE columns in the execution JoinNode\'s RCL:  \\n{ T1.i, T2.i, T2.i2 }\\n .  So now the RCL has three columns instead of two, which means the result column in the HAVING aggregate, which still has the INCORRECT virtual id of \\\"3\\\", accidentally points to a valid column, and thus the query passes--but that was just chance, the code is still technically wrong. \\n\\n This also explains why the original query passes if the user does NOT specify \\\"inner join\\\".  The inclusion of \\\"inner join\\\" leads to the creation of the bind-time JoinNode between T1 and T2, against which the aggregates are then bound.  In preprocessing we realize the JoinNode is useless so we flatten it out of the query, and that causes the aforementioned problem.  But if the query does not have \\\"inner join\\\", the bind-time JoinNode is never created, which means both aggregate nodes already point directly to the underlying base tables.  Throughout optimization and query generation the base table result columns are properly updated, which means both aggregates end up pointing to the correct place, and all is well. \\n\\n So all of that said, I think the fix for this problem is to somehow ensure that the HAVING clause\'s AggregateNode is correctly remapped when\\/if necessary, esp. if it points to a JoinNode that has been flattened out.  I happened to notice that, when the JoinNode is flattened, all of its result columns are marked as \\\"redundant\\\" as part of the flattening process (see JoinNode.flatten()).  So the quick (and possibly NOT complete) fix that I found was to add an \\\"if\\\" statement to the getNewExpressionResultColumn() method of AggregateNode.java.  That method is called as part of \\\"modification of access paths\\\"- i.e. after optimization has completed -and is used for creating the result column that will ultimately be used for aggregate input at execution time.  I found that if I added logic to remap the Aggregate\'s operand (if it\'s a column reference), then the posted query starts running without error: \\n\\n Index: java\\/engine\\/org\\/apache\\/derby\\/impl\\/sql\\/compile\\/AggregateNode.java \\n=================================================================== \\n&#8212; java\\/engine\\/org\\/apache\\/derby\\/impl\\/sql\\/compile\\/AggregateNode.java    (revision 707244) \\n+++ java\\/engine\\/org\\/apache\\/derby\\/impl\\/sql\\/compile\\/AggregateNode.java    (working copy) \\n@@ -539,6 +539,26 @@ \\n                        this.getNewNullResultExpression() : \\n                        operand; \\n\\n  +        \\/* The operand for this aggregate node was initialized at bind \\n +         * time.  Between then and now it\'s possible that certain changes \\n +         * have been made to the query tree which affect this operand. In \\n +         * particular, if the operand was pointing to a result column in \\n +         * a JoinNode and then that JoinNode was flattened during pre- \\n +         * processing, all of the references to that JoinNode--including \\n +         * this aggregate\'s operand--need to be updated to reflect the \\n +         * fact that the Join Node no longer exists.  So check to see if \\n +         * the operand is a column reference, and if so, make a call to \\n +         * remap it to its underlying expression.  If nothing has happened \\n +         * then this will be a no-op; but if something has changed to void \\n +         * out the result column to which the operand points, the result \\n +         * column will be marked \\\"redundant\\\" and the following call should \\n +         * remap as appropriate.   DERBY-3880  . \\n +         *\\/ \\n +        if (operand instanceof ColumnReference) \\n +         \\n{\\n +            ((ColumnReference)operand).remapColumnReferencesToExpressions();\\n +        }\\n  + \\n            return (ResultColumn) getNodeFactory().getNode( \\n                                                                C_NodeTypes.RESULT_COLUMN, \\n                                                                \\\"##aggregate expression\\\", \\n\\n I didn\'t run any other tests, and I admit that this change may not be sufficient (or it may be too general), but it does cause the reported query to run without error, so at the very least it demonstrates the problem.  There could very well be a better way to fix it...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12644393\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12644393&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12644393\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12644393_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12644393_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Oct\\/08 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-31T18:40:32+0000\'\u003e31\\/Oct\\/08 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Army for the great explanation and patch proposal.  I\'ll give it a try.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12644393_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12644393_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Oct\\/08 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-31T18:40:32+0000\'\u003e31\\/Oct\\/08 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Army for the great explanation and patch proposal.  I\'ll give it a try.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12644992\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12644992&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12644992\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12644992_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12644992_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/08 16:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-04T16:35:45+0000\'\u003e04\\/Nov\\/08 16:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eArmy\'s patch passes regression tests.  I\'ll add a test and commit, then backport to 10.4 and 10.3. Thanks Army!\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12644992_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12644992_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/08 16:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-04T16:35:45+0000\'\u003e04\\/Nov\\/08 16:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Army\'s patch passes regression tests.  I\'ll add a test and commit, then backport to 10.4 and 10.3. Thanks Army! \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12645520\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12645520&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12645520\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12645520_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12645520_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/08 17:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-06T17:33:31+0000\'\u003e06\\/Nov\\/08 17:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe fix has been committed to trunk, 10.4 and 10.3.  Giving Army the point since he came up with the fix.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12645520_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12645520_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/08 17:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-06T17:33:31+0000\'\u003e06\\/Nov\\/08 17:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The fix has been committed to trunk, 10.4 and 10.3.  Giving Army the point since he came up with the fix.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12646605\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12646605&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12646605\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12646605_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12646605_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/08 17:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-11T17:19:07+0000\'\u003e11\\/Nov\\/08 17:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Army, Kathey, sorry it took me a while to read through Army\'s excellent description of 30-Oct\u003c\\/p\u003e\\n\\n\u003cp\u003eI have a couple questions that came to mind while I was studying Army\'s notes:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) Army says  \\\"so the JoinNode\'s bind-time RCL is: \u003c\\/p\u003e\\n{ T1.i, T1.c, T2.i, T2.c2, T2.i2 }\\n\u003cp\u003e\\\" but I don\'t\u003cbr\\/\u003e\\nsee how that is, if the query is \u003c\\/p\u003e\\n\\n\u003cp\u003e      select t1.i, avg(t2.i)\u003cbr\\/\u003e\\n          from t1 inner join t2 on (t1.i = t2.i)\u003cbr\\/\u003e\\n          group by t1.i having avg(t2.i) &gt; 0; \u003c\\/p\u003e\\n\\n\u003cp\u003eIs it possible that the query Army was analyzing was actually \\\"on (t1.c = t2.c2)\\\" ? Otherwise,\u003cbr\\/\u003e\\nI\'m having trouble seeing why T1.c and T2.c2 are in the join node\'s RCL. \u003c\\/p\u003e\\n\\n\u003cp\u003e2) While I was reading Army\'s writeup, I anticipated that I was going to see a fix which\u003cbr\\/\u003e\\ninvolved passing the HAVING clause expressions to fromList.flattenFromTables() so that\u003cbr\\/\u003e\\nit could properly maintain the ColumnReference data in the HAVING clause during flattening. \u003c\\/p\u003e\\n\\n\u003cp\u003eBut it seems like the essence of Army\'s fix is to observe that we don\'t need to maintain\u003cbr\\/\u003e\\nthe ColumnReference instances inside of AggregateNode instances because we can\u003cbr\\/\u003e\\nalways go back at the end of optimization and re-construct the ColumnReference info.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis seems very nice, because I\'ve seen numerous problems over the past several\u003cbr\\/\u003e\\nyears which involved situations where we lost track of the ColumnReference\'s table\u003cbr\\/\u003e\\nand column pointers during the compilation and optimization processing. That code\u003cbr\\/\u003e\\noverall seems very tricky and trouble-prone. I could track down the actual JIRA id\'s\u003cbr\\/\u003e\\nif you wish; they involved GROUP BY and ORDER BY analysis, which is similar, but\u003cbr\\/\u003e\\ncertainly not identical, to HAVING clause analysis.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo now I\'m wondering: if it\'s true that we can figure out the proper ColumnReference\u003cbr\\/\u003e\\ninformation at the \u003cb\u003eend\u003c\\/b\u003e of the optimization process, and don\'t have to maintain\u003cbr\\/\u003e\\nthat data during the compilation\\/optimzation process, then perhaps we shouldn\'t be\u003cbr\\/\u003e\\ndoing it at all, but rather should simply wait til optimization is complete, then fix-up all\u003cbr\\/\u003e\\nthe ColumnReferences in the tree at the end.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat is, if it\'s safe to allow the ColumnReference in the aggregate of a HAVING clause\u003cbr\\/\u003e\\nto \\\"decay\\\" (become in-accurate) during optimization, and then fix it up at the end,\u003cbr\\/\u003e\\nwhy do we have to re-map the ColumnReference information for the SELECT\'s RCL?\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd similarly could we avoid having to \\\"fix-up\\\" the GROUP BY and ORDER BY clauses?\u003c\\/p\u003e\\n\\n\u003cp\u003eOr is it only safe to allow HAVING clause ColumnReference instances to diverge\u003cbr\\/\u003e\\nfrom reality for short periods, because they are fundamentally different from the\u003cbr\\/\u003e\\naggregate nodes in the select RCL?\u003c\\/p\u003e\\n\\n\u003cp\u003e3) Army says \\\"the compile time query tree has two AggregateNodes\\\". I\'ve noticed\u003cbr\\/\u003e\\nthis myself. In fact, while looking at somewhat similar situations, I\'ve noticed that\u003cbr\\/\u003e\\n(I think) the actual code that is generated to execute the query may contain\u003cbr\\/\u003e\\nmultiple computations of the same expressions. That is, when this query runs,\u003cbr\\/\u003e\\nis it true that we are actually going to \u003cb\u003ecompute\u003c\\/b\u003e AVG(t2.i) twice? We\'ll only do\u003cbr\\/\u003e\\none pass over the data, of course, but we\'ll have two running-total values that\u003cbr\\/\u003e\\nare redundantly accumulating the t2.i sub-totals as we go?\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve been wondering if maybe there is some sort of fundamental \\\"common sub-expression\u003cbr\\/\u003e\\ndetection\\\" which the Derby compilation system is not performing, such that it\u003cbr\\/\u003e\\ndoesn\'t recognize when two parts of a query are actually computing the same\u003cbr\\/\u003e\\nresult, and so we end up generating a query which performs more computation\u003cbr\\/\u003e\\nthan is needed, redundantly computing values multiple times in situations where\u003cbr\\/\u003e\\nthey are mentioned multiple times.\u003c\\/p\u003e\\n\\n\u003cp\u003eI noticed this in studying GROUP BY queries, where if the GROUP BY clause\u003cbr\\/\u003e\\ncontained an expression, and that expression matched a similar expression\u003cbr\\/\u003e\\nin the SELECT list, the resulting query seemed to compute the expression twice,\u003cbr\\/\u003e\\nwhen it would have been adequate to compute it only once.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not intending to \\\"hijack the thread\\\" with any of these questions; I\'m extremely\u003cbr\\/\u003e\\nhappy that we\'ve solved this problem and that the query now runs correctly.\u003cbr\\/\u003e\\nI\'m just trying to improve my understanding of Derby internals by taking this\u003cbr\\/\u003e\\nopportunity to ask a few questions about parts of this issue that puzzled me.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks VERY much to Army and Kathey for all the hard work they did on this problem!\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12646605_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12646605_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/08 17:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-11T17:19:07+0000\'\u003e11\\/Nov\\/08 17:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Army, Kathey, sorry it took me a while to read through Army\'s excellent description of 30-Oct \\n\\n I have a couple questions that came to mind while I was studying Army\'s notes: \\n\\n 1) Army says  \\\"so the JoinNode\'s bind-time RCL is:  \\n{ T1.i, T1.c, T2.i, T2.c2, T2.i2 }\\n \\\" but I don\'t \\nsee how that is, if the query is  \\n\\n       select t1.i, avg(t2.i) \\n          from t1 inner join t2 on (t1.i = t2.i) \\n          group by t1.i having avg(t2.i) &gt; 0;  \\n\\n Is it possible that the query Army was analyzing was actually \\\"on (t1.c = t2.c2)\\\" ? Otherwise, \\nI\'m having trouble seeing why T1.c and T2.c2 are in the join node\'s RCL.  \\n\\n 2) While I was reading Army\'s writeup, I anticipated that I was going to see a fix which \\ninvolved passing the HAVING clause expressions to fromList.flattenFromTables() so that \\nit could properly maintain the ColumnReference data in the HAVING clause during flattening.  \\n\\n But it seems like the essence of Army\'s fix is to observe that we don\'t need to maintain \\nthe ColumnReference instances inside of AggregateNode instances because we can \\nalways go back at the end of optimization and re-construct the ColumnReference info. \\n\\n This seems very nice, because I\'ve seen numerous problems over the past several \\nyears which involved situations where we lost track of the ColumnReference\'s table \\nand column pointers during the compilation and optimization processing. That code \\noverall seems very tricky and trouble-prone. I could track down the actual JIRA id\'s \\nif you wish; they involved GROUP BY and ORDER BY analysis, which is similar, but \\ncertainly not identical, to HAVING clause analysis. \\n\\n So now I\'m wondering: if it\'s true that we can figure out the proper ColumnReference \\ninformation at the  end  of the optimization process, and don\'t have to maintain \\nthat data during the compilation\\/optimzation process, then perhaps we shouldn\'t be \\ndoing it at all, but rather should simply wait til optimization is complete, then fix-up all \\nthe ColumnReferences in the tree at the end. \\n\\n That is, if it\'s safe to allow the ColumnReference in the aggregate of a HAVING clause \\nto \\\"decay\\\" (become in-accurate) during optimization, and then fix it up at the end, \\nwhy do we have to re-map the ColumnReference information for the SELECT\'s RCL? \\n\\n And similarly could we avoid having to \\\"fix-up\\\" the GROUP BY and ORDER BY clauses? \\n\\n Or is it only safe to allow HAVING clause ColumnReference instances to diverge \\nfrom reality for short periods, because they are fundamentally different from the \\naggregate nodes in the select RCL? \\n\\n 3) Army says \\\"the compile time query tree has two AggregateNodes\\\". I\'ve noticed \\nthis myself. In fact, while looking at somewhat similar situations, I\'ve noticed that \\n(I think) the actual code that is generated to execute the query may contain \\nmultiple computations of the same expressions. That is, when this query runs, \\nis it true that we are actually going to  compute  AVG(t2.i) twice? We\'ll only do \\none pass over the data, of course, but we\'ll have two running-total values that \\nare redundantly accumulating the t2.i sub-totals as we go? \\n\\n I\'ve been wondering if maybe there is some sort of fundamental \\\"common sub-expression \\ndetection\\\" which the Derby compilation system is not performing, such that it \\ndoesn\'t recognize when two parts of a query are actually computing the same \\nresult, and so we end up generating a query which performs more computation \\nthan is needed, redundantly computing values multiple times in situations where \\nthey are mentioned multiple times. \\n\\n I noticed this in studying GROUP BY queries, where if the GROUP BY clause \\ncontained an expression, and that expression matched a similar expression \\nin the SELECT list, the resulting query seemed to compute the expression twice, \\nwhen it would have been adequate to compute it only once. \\n\\n I\'m not intending to \\\"hijack the thread\\\" with any of these questions; I\'m extremely \\nhappy that we\'ve solved this problem and that the query now runs correctly. \\nI\'m just trying to improve my understanding of Derby internals by taking this \\nopportunity to ask a few questions about parts of this issue that puzzled me. \\n\\n Thanks VERY much to Army and Kathey for all the hard work they did on this problem! \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12646775\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12646775&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12646775\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12646775_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12646775_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/08 01:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-12T01:47:39+0000\'\u003e12\\/Nov\\/08 01:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Bryan,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for your interest in this issue.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Army says \\\"so the JoinNode\'s bind-time RCL is: \u003c\\/p\u003e\\n{ T1.i, T1.c, T2.i, T2.c2, T2.i2 }\\\" but I don\'t\u003cbr\\/\u003e\\n&gt; see how that is \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e I\'m having trouble seeing why T1.c and T2.c2 are in the join node\'s RCL.\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nI think the key observation here is in the sentence immediately preceding the one that you quoted, namely:\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n  The JoinNode\'s bind-time result column list is simply a concatenation of the result column\u003cbr\\/\u003e\\n  lists from its operands.\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nDue to the specification of \\\"inner join\\\" the parser will create a parse-time JoinNode whose left operand is a FromBaseTable representing T1 and whose right operand is a FromBaseTable representing T2.  Note how neither operand has a ProjectRestrictNode above it, which in turn means we will \u003cb\u003enot\u003c\\/b\u003e project out any columns (at this point).  Thus the FromBaseTable for T1 has an RCL with \u003cb\u003eALL\u003c\\/b\u003e of T1\'s columns in it, and the FromBaseTable for T2 has an RCL with \u003cb\u003eALL\u003c\\/b\u003e of T2\'s columns in it.  The fact that some columns are never referenced in the query has no effect on the RCLs for the FromBaseTables at this point in binding.\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nTo verify, you can put a breakpoint in JoinNode.buildRCL() and, when the breakpoint hits, look at the leftOperand and rightOperand.  They will both be FromBaseTables and the RCLs will have all columns that exist in the underlying base tables.  So the JoinNode\'s RCL then becomes a concatenation of all columns from T1 and all columns from T2, hence { T1.i, T1.c, T2.i, T2.c2, T2.i2 }\\n\u003cp\u003e--even though T1.c and T2.c2 are never referenced in the query.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I anticipated that I was going to see a fix which involved passing the HAVING clause\u003cbr\\/\u003e\\n&gt; expressions to fromList.flattenFromTables() so that it could properly maintain the\u003cbr\\/\u003e\\n&gt; ColumnReference data in the HAVING clause during flattening. \u003c\\/p\u003e\\n\\n\u003cp\u003eTo be honest, I think you\'re absolutely right: that seems like a more robust approach to the problem.  See below...\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; if it\'s safe to allow the ColumnReference in the aggregate of a HAVING clause\u003cbr\\/\u003e\\n&gt; to \\\"decay\\\" (become in-accurate) during optimization, and then fix it up at the end,\u003cbr\\/\u003e\\n&gt; why do we have to re-map the ColumnReference information for the SELECT\'s\u003cbr\\/\u003e\\n&gt; RCL?\u003c\\/p\u003e\\n\\n\u003cp\u003eGood question.  I do not think it is generally safe to assume that a temporarily inaccurate ColumnReference is going to be okay.  The vast majority of the ColumnReference remapping that occurs during optimization happens in order to support the pushing of predicates down the tree and\\/or to allow the insertion of query tree nodes into an existing tree.  In both cases the column reference is being remapped from one valid ResultColumn to another valid ResultColumn.  In other words, we can\'t just look at the ColumnReference after optimization has finished and say \\\"pick the only one that\'s valid\\\", because there could be an arbitrarily long chain of ResultColumns, VirtualColumnNodes, and ColumnReferences, all of which are valid and referenceable by different parts of the query tree.  The only way to know which one is the \\\"right\\\" one for a given ColumnReference is to remap (or un-remap) in \\\"real time\\\"--ex. when we push\\/pull a predicate, we have to remap its column reference as part of the push\\/pull.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat said, the fact that a post-optimization remapping of the HAVING aggregate\'s ColumnReference corrected the problem was a pleasant surprise to me, as I too was more inclined to believe that, by then, it would be too late.  But I made the change, saw that it made sense and that it fixed the immediate problem, and that\'s what I posted.  Having done so, I think it\'s worth it to echo the final few sentences from that same comment, namely:\u003c\\/p\u003e\\n\\n\u003cp\u003e  I admit that this change may not be sufficient (or it may be too general), but it does\u003cbr\\/\u003e\\n  cause the reported query to run without error, so at the very least it demonstrates\u003cbr\\/\u003e\\n  the problem. There could very well be a better way to fix it...\u003c\\/p\u003e\\n\\n\u003cp\u003eI posted a quick fix to demonstrate the problem and stopped there.  Kathey was kind enough to pick it up and take it to completion.  But at a higher level, I think you\'re right: there\'s probably a better (and safer) way to fix this bug, and your suggestion that such a fix would involve passing the HAVING clause expressions to fromList.flattenFromTables() seems like a good one to me...\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I\'ve noticed that (I think) the actual code that is generated to execute the query may\u003cbr\\/\u003e\\n&gt; contain multiple computations of the same expressions. That is, when this query\u003cbr\\/\u003e\\n&gt; runs, is it true that we are actually going to \u003cb\u003ecompute\u003c\\/b\u003e AVG(t2.i) twice?\u003c\\/p\u003e\\n\\n\u003cp\u003eI have not looked at this in any detail, but I believe the answer is \\\"Yes\\\", at least based on the tracing I was doing when I was trying to track down the cause of this issue.  But I wasn\'t specifically investigating that particular behavior at the time, so it\'s possible I missed something...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12646775_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12646775_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/08 01:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-12T01:47:39+0000\'\u003e12\\/Nov\\/08 01:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Bryan, \\n\\n Thanks for your interest in this issue. \\n\\n &gt; Army says \\\"so the JoinNode\'s bind-time RCL is:  \\n{ T1.i, T1.c, T2.i, T2.c2, T2.i2 }\\\" but I don\'t \\n&gt; see how that is  &#91;...&#93;  I\'m having trouble seeing why T1.c and T2.c2 are in the join node\'s RCL. \\n \\nI think the key observation here is in the sentence immediately preceding the one that you quoted, namely: \\n \\n  The JoinNode\'s bind-time result column list is simply a concatenation of the result column \\n  lists from its operands. \\n \\nDue to the specification of \\\"inner join\\\" the parser will create a parse-time JoinNode whose left operand is a FromBaseTable representing T1 and whose right operand is a FromBaseTable representing T2.  Note how neither operand has a ProjectRestrictNode above it, which in turn means we will  not  project out any columns (at this point).  Thus the FromBaseTable for T1 has an RCL with  ALL  of T1\'s columns in it, and the FromBaseTable for T2 has an RCL with  ALL  of T2\'s columns in it.  The fact that some columns are never referenced in the query has no effect on the RCLs for the FromBaseTables at this point in binding. \\n \\nTo verify, you can put a breakpoint in JoinNode.buildRCL() and, when the breakpoint hits, look at the leftOperand and rightOperand.  They will both be FromBaseTables and the RCLs will have all columns that exist in the underlying base tables.  So the JoinNode\'s RCL then becomes a concatenation of all columns from T1 and all columns from T2, hence { T1.i, T1.c, T2.i, T2.c2, T2.i2 }\\n --even though T1.c and T2.c2 are never referenced in the query. \\n\\n &gt; I anticipated that I was going to see a fix which involved passing the HAVING clause \\n&gt; expressions to fromList.flattenFromTables() so that it could properly maintain the \\n&gt; ColumnReference data in the HAVING clause during flattening.  \\n\\n To be honest, I think you\'re absolutely right: that seems like a more robust approach to the problem.  See below... \\n\\n &gt; if it\'s safe to allow the ColumnReference in the aggregate of a HAVING clause \\n&gt; to \\\"decay\\\" (become in-accurate) during optimization, and then fix it up at the end, \\n&gt; why do we have to re-map the ColumnReference information for the SELECT\'s \\n&gt; RCL? \\n\\n Good question.  I do not think it is generally safe to assume that a temporarily inaccurate ColumnReference is going to be okay.  The vast majority of the ColumnReference remapping that occurs during optimization happens in order to support the pushing of predicates down the tree and\\/or to allow the insertion of query tree nodes into an existing tree.  In both cases the column reference is being remapped from one valid ResultColumn to another valid ResultColumn.  In other words, we can\'t just look at the ColumnReference after optimization has finished and say \\\"pick the only one that\'s valid\\\", because there could be an arbitrarily long chain of ResultColumns, VirtualColumnNodes, and ColumnReferences, all of which are valid and referenceable by different parts of the query tree.  The only way to know which one is the \\\"right\\\" one for a given ColumnReference is to remap (or un-remap) in \\\"real time\\\"--ex. when we push\\/pull a predicate, we have to remap its column reference as part of the push\\/pull. \\n\\n That said, the fact that a post-optimization remapping of the HAVING aggregate\'s ColumnReference corrected the problem was a pleasant surprise to me, as I too was more inclined to believe that, by then, it would be too late.  But I made the change, saw that it made sense and that it fixed the immediate problem, and that\'s what I posted.  Having done so, I think it\'s worth it to echo the final few sentences from that same comment, namely: \\n\\n   I admit that this change may not be sufficient (or it may be too general), but it does \\n  cause the reported query to run without error, so at the very least it demonstrates \\n  the problem. There could very well be a better way to fix it... \\n\\n I posted a quick fix to demonstrate the problem and stopped there.  Kathey was kind enough to pick it up and take it to completion.  But at a higher level, I think you\'re right: there\'s probably a better (and safer) way to fix this bug, and your suggestion that such a fix would involve passing the HAVING clause expressions to fromList.flattenFromTables() seems like a good one to me... \\n\\n &gt; I\'ve noticed that (I think) the actual code that is generated to execute the query may \\n&gt; contain multiple computations of the same expressions. That is, when this query \\n&gt; runs, is it true that we are actually going to  compute  AVG(t2.i) twice? \\n\\n I have not looked at this in any detail, but I believe the answer is \\\"Yes\\\", at least based on the tracing I was doing when I was trying to track down the cause of this issue.  But I wasn\'t specifically investigating that particular behavior at the time, so it\'s possible I missed something...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12646804\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3880?focusedCommentId=12646804&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12646804\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12646804_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12646804_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/08 05:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-12T05:22:48+0000\'\u003e12\\/Nov\\/08 05:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Army!\u003c\\/p\u003e\\n\\n\u003cp\u003eI had overlooked your explanation about the construction of the JoinNode RCL; thanks\u003cbr\\/\u003e\\nfor the clarification. I worked through JoinNode.buildRCL and I see exactly what you mean:\u003c\\/p\u003e\\n\\n\u003cp\u003e                \\/* Now we append the propagated RCL from the right to the one from\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003ethe left and call it our own.\u003cbr\\/\u003e\\n                 *\\/\u003cbr\\/\u003e\\n                resultColumns.nondestructiveAppend(tmpRCL);\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIt seems like it would be worth following up some more on the other topics; I\'ll see about\u003cbr\\/\u003e\\nfiling them as separate JIRA issues so we can pursue them down the line.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks again not only for the fix, but even better for helping me understand how it works.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12646804_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12646804_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/08 05:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-11-12T05:22:48+0000\'\u003e12\\/Nov\\/08 05:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Army! \\n\\n I had overlooked your explanation about the construction of the JoinNode RCL; thanks \\nfor the clarification. I worked through JoinNode.buildRCL and I see exactly what you mean: \\n\\n                 \\/* Now we append the propagated RCL from the right to the one from \\n \\n\\t the left and call it our own. \\n                 *\\/ \\n                resultColumns.nondestructiveAppend(tmpRCL); \\n \\n\\n\\n It seems like it would be worth following up some more on the other topics; I\'ll see about \\nfiling them as separate JIRA issues so we can pursue them down the line. \\n\\n Thanks again not only for the fix, but even better for helping me understand how it works.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520239554243"> 
    <input type="hidden" title="jira.request.server.time" value="240"> 
    <input type="hidden" title="jira.request.id" value="525x94395763x1"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="3"> 
    <input type="hidden" title="db.reads.time.in.ms" value="37"> 
    <input type="hidden" title="db.conns.time.in.ms" value="43"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 525x94395763x1
	          REQUEST TIMESTAMP : [05/Mar/2018:08:45:54 +0000]
	               REQUEST TIME : 0.2400
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 3

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=26, elapsedTotal=37691355, elapsedMin=664828, elapsedMax=12934065, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=30, elapsedTotal=43737646, elapsedMin=691477, elapsedMax=12959975, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>