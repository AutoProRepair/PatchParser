<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|ea8dcce63f5b25692c294812b6fb515521060cee|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"4cc739a8081b33\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-5367"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-5367] Stale data retrieved when using new collation=TERRITORY_BASED:PRIMARY feature - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-5367] Stale data retrieved when using new collation=TERRITORY_BASED:PRIMARY feature - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-5367">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-5367" href="/jira/browse/DERBY-5367" id="key-val" rel="12516862">DERBY-5367</a></li>
                </ol>
                <h1 id="summary-val">Stale data retrieved when using new collation=TERRITORY_BASED:PRIMARY feature</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-5367"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-5367/DERBY-5367.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-5367/DERBY-5367.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-5367/DERBY-5367.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-5367/DERBY-5367.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/critical.svg" title="Critical - Crashes, loss of data, severe memory leak." width="16"> Critical </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.8.1.2 First release on the 10.8 branch">10.8.1.2</span>, <span title="10.9.1.0 First release on the 10.9 branch">10.9.1.0</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.8.2.2" title="10.8.2.2 second release on the 10.8 branch">10.8.2.2</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.9.1.0" title="10.9.1.0 First release on the 10.9 branch">10.9.1.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+Store" title="Store ">Store</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12516862-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     Mac OS X, Windows 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310200" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bug behavior facts" class="name">Bug behavior facts:</strong> 
                      <div id="customfield_12310200-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310200-field"> 
                        <span>Data corruption</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Our product recently upgraded to version 10.8.1.2 in order to take advantage of the new 'case-insensitive' mode offered by Derby in the form of the "collation=TERRITORY_BASED:PRIMARY" connection parameter.</p> 
                  <p>Unfortunately, we have run into an issue whereby stale data appears to be retrieved from an index, even though the data in the table itself has changed.</p> 
                  <p>You can see this issue in the IJ session below. The database in question was created using this Java parameter when invoking IJ:</p> 
                  <p>-Dij.database=jdbc:derby:test;create=true;collation=TERRITORY_BASED:PRIMARY</p> 
                  <p>Here is the IJ session:</p> 
                  <p>CONNECTION0* - jdbc:derby:test</p> 
                  <ul> 
                   <li>= current connection</li> 
                  </ul> 
                  <p>ij&gt; CREATE TABLE tag (<br> tag_id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,<br> tag VARCHAR(255) NOT NULL,<br> CONSTRAINT tag_pk PRIMARY KEY (tag_id),<br> CONSTRAINT tag_tag_unique UNIQUE (tag)<br> );<br> 0 rows inserted/updated/deleted</p> 
                  <p>ij&gt; – first insert a value 'Test', note the upper-case 'T' in 'Test'<br> ij&gt; INSERT INTO tag (tag) VALUES ('Test');<br> 1 row inserted/updated/deleted</p> 
                  <p>ij&gt; SELECT * FROM tag;<br> TAG_ID |TAG <br> --------------------------------------------------------------------------------------------------------------------------------------------<br> 1 |Test </p> 
                  <p>1 row selected</p> 
                  <p>ij&gt; – Now delete the row<br> ij&gt; DELETE FROM tag WHERE tag='Test';<br> 1 row inserted/updated/deleted</p> 
                  <p>ij&gt; – You could run another SELECT here to verify it is gone, but it is.</p> 
                  <p>ij&gt; – Now insert a new value 'test', note the lower-case 't' in 'test'<br> ij&gt; INSERT INTO tag (tag) VALUES ('test');<br> 1 row inserted/updated/deleted</p> 
                  <p>ij&gt; – Now verify that the table contains only the lower-case version: 'test'<br> ij&gt; SELECT * FROM tag;<br> TAG_ID |TAG <br> --------------------------------------------------------------------------------------------------------------------------------------------<br> 2 |test </p> 
                  <p>1 row selected</p> 
                  <p>ij&gt; – Now, here is the bug.<br> ij&gt; SELECT tag FROM tag;<br> TAG <br> --------------------------------------------------------------------------------------------------------------------------------<br> Test </p> 
                  <p>1 row selected<br> ij&gt; </p> 
                  <p>Note in the last SELECT we specify the 'tag' column specifically. When we 'SELECT *', Derby performs a table-scan and the result is correct. However, when we 'SELECT tag', Derby appears to use the index created for the 'tag_tag_unique' unique constraint. As an optimization Derby, like many databases, will use values directly from the index in the case where the index covers all requested columns.</p> 
                  <p>The bigger question is, why doesn't the DELETE action cause the entry in the tag_tag_unique index to be deleted? Is this a further optimization? If so, it is imperative that the index at least be updated when the new value is inserted.</p> 
                  <p>This is rather a severe bug for us that causes stale data to be returned.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-5367?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-5367?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-5367?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-5367?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12490246" data-issue-id="12516862" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12490246/derby-5367-1a-update_row_fully.diff" draggable="true" data-downloadurl="text/x-diff:derby-5367-1a-update_row_fully.diff:https://issues.apache.org/jira/secure/attachment/12490246/derby-5367-1a-update_row_fully.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12490246/derby-5367-1a-update_row_fully.diff" title="Latest  12/Aug/11 13:56 - Kristian Waagan" draggable="true" data-downloadurl="text/x-diff:derby-5367-1a-update_row_fully.diff:https://issues.apache.org/jira/secure/attachment/12490246/derby-5367-1a-update_row_fully.diff">derby-5367-1a-update_row_fully.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-08-12T13:56:59.324Z">12/Aug/11 13:56</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12490427" data-issue-id="12516862" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12490427/derby-5367-1b-update_row_fully.diff" draggable="true" data-downloadurl="text/x-patch:derby-5367-1b-update_row_fully.diff:https://issues.apache.org/jira/secure/attachment/12490427/derby-5367-1b-update_row_fully.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12490427/derby-5367-1b-update_row_fully.diff" title="Latest  15/Aug/11 13:14 - Kristian Waagan" draggable="true" data-downloadurl="text/x-patch:derby-5367-1b-update_row_fully.diff:https://issues.apache.org/jira/secure/attachment/12490427/derby-5367-1b-update_row_fully.diff">derby-5367-1b-update_row_fully.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-08-15T13:14:24.483Z">15/Aug/11 13:14</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12490428" data-issue-id="12516862" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12490428/derby-5367-1b-update_row_fully.stat" draggable="true" data-downloadurl="application/octet-stream:derby-5367-1b-update_row_fully.stat:https://issues.apache.org/jira/secure/attachment/12490428/derby-5367-1b-update_row_fully.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12490428/derby-5367-1b-update_row_fully.stat" title="Latest  15/Aug/11 13:14 - Kristian Waagan" draggable="true" data-downloadurl="application/octet-stream:derby-5367-1b-update_row_fully.stat:https://issues.apache.org/jira/secure/attachment/12490428/derby-5367-1b-update_row_fully.stat">derby-5367-1b-update_row_fully.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-08-15T13:14:24.494Z">15/Aug/11 13:14</time>
                   </dd>
                   <dd class="attachment-size">
                    0.3 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12492647" data-issue-id="12516862" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12492647/derby-5367-2a-minimal_fix.diff" draggable="true" data-downloadurl="text/x-patch:derby-5367-2a-minimal_fix.diff:https://issues.apache.org/jira/secure/attachment/12492647/derby-5367-2a-minimal_fix.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12492647/derby-5367-2a-minimal_fix.diff" title="Latest  01/Sep/11 18:55 - Kristian Waagan" draggable="true" data-downloadurl="text/x-patch:derby-5367-2a-minimal_fix.diff:https://issues.apache.org/jira/secure/attachment/12492647/derby-5367-2a-minimal_fix.diff">derby-5367-2a-minimal_fix.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-09-01T18:55:49.299Z">01/Sep/11 18:55</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12493805" data-issue-id="12516862" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12493805/derby-5367-3a-update_field_by_field_preview.diff" draggable="true" data-downloadurl="text/x-diff:derby-5367-3a-update_field_by_field_preview.diff:https://issues.apache.org/jira/secure/attachment/12493805/derby-5367-3a-update_field_by_field_preview.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12493805/derby-5367-3a-update_field_by_field_preview.diff" title="Latest  09/Sep/11 16:39 - Kristian Waagan" draggable="true" data-downloadurl="text/x-diff:derby-5367-3a-update_field_by_field_preview.diff:https://issues.apache.org/jira/secure/attachment/12493805/derby-5367-3a-update_field_by_field_preview.diff">derby-5367-3a-update_field_by_field_preview.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-09-09T16:39:52.660Z">09/Sep/11 16:39</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12494109" data-issue-id="12516862" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12494109/derby-5367-4a-fix_with_optimization_improved.diff" draggable="true" data-downloadurl="text/x-diff:derby-5367-4a-fix_with_optimization_improved.diff:https://issues.apache.org/jira/secure/attachment/12494109/derby-5367-4a-fix_with_optimization_improved.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12494109/derby-5367-4a-fix_with_optimization_improved.diff" title="Latest  12/Sep/11 20:14 - Kristian Waagan" draggable="true" data-downloadurl="text/x-diff:derby-5367-4a-fix_with_optimization_improved.diff:https://issues.apache.org/jira/secure/attachment/12494109/derby-5367-4a-fix_with_optimization_improved.diff">derby-5367-4a-fix_with_optimization_improved.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-09-12T20:14:07.175Z">12/Sep/11 20:14</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12496117" data-issue-id="12516862" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12496117/derby-5367-4b-fix_with_optimization_improved.diff" draggable="true" data-downloadurl="application/octet-stream:derby-5367-4b-fix_with_optimization_improved.diff:https://issues.apache.org/jira/secure/attachment/12496117/derby-5367-4b-fix_with_optimization_improved.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12496117/derby-5367-4b-fix_with_optimization_improved.diff" title="Latest  22/Sep/11 14:09 - Kristian Waagan" draggable="true" data-downloadurl="application/octet-stream:derby-5367-4b-fix_with_optimization_improved.diff:https://issues.apache.org/jira/secure/attachment/12496117/derby-5367-4b-fix_with_optimization_improved.diff">derby-5367-4b-fix_with_optimization_improved.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-09-22T14:09:55.161Z">22/Sep/11 14:09</time>
                   </dd>
                   <dd class="attachment-size">
                    21 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12496193" data-issue-id="12516862" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12496193/derby-5367-4c-fix_with_optimization_improved.diff" draggable="true" data-downloadurl="text/x-diff:derby-5367-4c-fix_with_optimization_improved.diff:https://issues.apache.org/jira/secure/attachment/12496193/derby-5367-4c-fix_with_optimization_improved.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12496193/derby-5367-4c-fix_with_optimization_improved.diff" title="Latest  22/Sep/11 22:53 - Kristian Waagan" draggable="true" data-downloadurl="text/x-diff:derby-5367-4c-fix_with_optimization_improved.diff:https://issues.apache.org/jira/secure/attachment/12496193/derby-5367-4c-fix_with_optimization_improved.diff">derby-5367-4c-fix_with_optimization_improved.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-09-22T22:53:05.664Z">22/Sep/11 22:53</time>
                   </dd>
                   <dd class="attachment-size">
                    22 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_kristwaa" rel="kristwaa" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Kristian Waagan&quot;,&quot;emailAddress&quot;:&quot;kristwaa@apache.org&quot;,&quot;username&quot;:&quot;kristwaa&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="kristwaa"></span></span> Kristian Waagan </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_brettw" rel="brettw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Brett Wooldridge&quot;,&quot;emailAddress&quot;:&quot;brett.wooldridge@gmail.com&quot;,&quot;username&quot;:&quot;brettw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="brettw"></span></span> Brett Wooldridge </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">2</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="02/Aug/11 05:45"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-08-02T05:45:09+0000">02/Aug/11 05:45</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="17/Jun/13 09:19"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-06-17T09:19:15+0000">17/Jun/13 09:19</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="24/Sep/11 14:24"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-09-24T14:24:26+0000">24/Sep/11 14:24</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-5367?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-5367?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13083007\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13083007&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13083007\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13083007_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13083007_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/11 08:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-11T08:24:17+0000\'\u003e11\\/Aug\\/11 08:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eVerified the repro on trunk (Solaris 11 Express).\u003cbr\\/\u003e\\nReset the urgency flag, that\'s for the release manager to specify.\u003c\\/p\u003e\\n\\n\u003cp\u003eCompressing the table makes the problem go away - this further strengthen the suspicion about a corrupted index.\u003cbr\\/\u003e\\nThe bug is also seen when issuing a delete without a where-clause.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13083007_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13083007_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/11 08:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-11T08:24:17+0000\'\u003e11\\/Aug\\/11 08:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Verified the repro on trunk (Solaris 11 Express). \\nReset the urgency flag, that\'s for the release manager to specify. \\n\\n Compressing the table makes the problem go away - this further strengthen the suspicion about a corrupted index. \\nThe bug is also seen when issuing a delete without a where-clause.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13083033\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13083033&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13083033\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13083033_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13083033_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/11 09:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-11T09:34:11+0000\'\u003e11\\/Aug\\/11 09:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Kristian Waagan - 11\\/Aug\\/11 09:37\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTurns out the problem here is the insert into the index (see BTreeController.doIns).\u003cbr\\/\u003e\\nThere is optimization code in there to undelete a deleted row in a unique index if the \\\"same\\\" row is inserted again before the row has been purged. This assumes that the fields that are part of the key are equal, but this assumption may be broken when using collations.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe insert code is smart enough to update the row location of the index row, but it doesn\'t understand that the value stored in the base row has changed.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not very familiar with this code, so I\'d like to get some feedback from more knowledgeable people.\u003cbr\\/\u003e\\nTo me these possible solutions come to mind:\u003cbr\\/\u003e\\n a) Deoptimize insert - always insert a new index row.\u003cbr\\/\u003e\\n b) Make conglomerate code aware of collations and take appropriate actions after comparing the new and the old value(s)\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t know what consequences the proposed solutions bring to the table.\u003cbr\\/\u003e\\nA quick and dirty fix of the code (where I updated the key field) made the repro pass.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13083033_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13083033_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/11 09:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-11T09:34:11+0000\'\u003e11\\/Aug\\/11 09:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Kristian Waagan - 11\\/Aug\\/11 09:37\\\"\u003eedited\u003c\\/span\u003e                   Turns out the problem here is the insert into the index (see BTreeController.doIns). \\nThere is optimization code in there to undelete a deleted row in a unique index if the \\\"same\\\" row is inserted again before the row has been purged. This assumes that the fields that are part of the key are equal, but this assumption may be broken when using collations. \\n\\n The insert code is smart enough to update the row location of the index row, but it doesn\'t understand that the value stored in the base row has changed. \\n\\n I\'m not very familiar with this code, so I\'d like to get some feedback from more knowledgeable people. \\nTo me these possible solutions come to mind: \\n a) Deoptimize insert - always insert a new index row. \\n b) Make conglomerate code aware of collations and take appropriate actions after comparing the new and the old value(s) \\n\\n I don\'t know what consequences the proposed solutions bring to the table. \\nA quick and dirty fix of the code (where I updated the key field) made the repro pass.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13083165\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13083165&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13083165\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_13083165_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13083165_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/11 15:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-11T15:28:03+0000\'\u003e11\\/Aug\\/11 15:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think we would want to avoid turning off the optimization if we don\'t have to. \u003cbr\\/\u003e\\nBut is there a way to know what collations are \\\"safe\\\"? I think our default collation uses binary UTF comparisons, so those should be ok, cf. \u003ca href=\\\"http:\\/\\/db.apache.org\\/derby\\/docs\\/10.8\\/devguide\\/cdevcollation.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/db.apache.org\\/derby\\/docs\\/10.8\\/devguide\\/cdevcollation.html\u003c\\/a\u003e . Perhaps you can determine if non-default collation is active and only deoptimize (or do an extra compare to determine if de-opt\'ing needed) for those cases.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_13083165_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13083165_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/11 15:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-11T15:28:03+0000\'\u003e11\\/Aug\\/11 15:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think we would want to avoid turning off the optimization if we don\'t have to.  \\nBut is there a way to know what collations are \\\"safe\\\"? I think our default collation uses binary UTF comparisons, so those should be ok, cf.  http:\\/\\/db.apache.org\\/derby\\/docs\\/10.8\\/devguide\\/cdevcollation.html  . Perhaps you can determine if non-default collation is active and only deoptimize (or do an extra compare to determine if de-opt\'ing needed) for those cases.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13084133\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13084133&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13084133\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13084133_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13084133_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Aug\\/11 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-12T13:56:59+0000\'\u003e12\\/Aug\\/11 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching patch 1a, which replaces\\/updates the whole row if a deleted row is reused and collations are enabled.\u003c\\/p\u003e\\n\\n\u003cp\u003ePatch ready for discussion and review.\u003cbr\\/\u003e\\nIt passed the regression tests and the bug demonstrated by the repro is addressed. I don\'t really expect to commit this one, but it demonstrates one possible solution.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13084133_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13084133_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Aug\\/11 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-12T13:56:59+0000\'\u003e12\\/Aug\\/11 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching patch 1a, which replaces\\/updates the whole row if a deleted row is reused and collations are enabled. \\n\\n Patch ready for discussion and review. \\nIt passed the regression tests and the bug demonstrated by the repro is addressed. I don\'t really expect to commit this one, but it demonstrates one possible solution.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13084804\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13084804&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13084804\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13084804_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13084804_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/11 08:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-14T08:23:46+0000\'\u003e14\\/Aug\\/11 08:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Kristian.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have reviewed and tested the patch, and can\'t find any issues with it.  It seems like the minimal patch to existing code that would fix the bug.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13084804_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13084804_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/11 08:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-14T08:23:46+0000\'\u003e14\\/Aug\\/11 08:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Kristian. \\n\\n I have reviewed and tested the patch, and can\'t find any issues with it.  It seems like the minimal patch to existing code that would fix the bug.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13085073\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13085073&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13085073\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13085073_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13085073_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/11 13:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-15T13:14:24+0000\'\u003e15\\/Aug\\/11 13:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for testing and reviewing the patch, Brett.\u003cbr\\/\u003e\\nI will work hard to have a fix committed in time for the upcoming 10.8.2-release, but I\'d still like to get a comment from one of the store experts.\u003cbr\\/\u003e\\nThe store is tricky, and maybe there are other places in the code that isn\'t prepared for collations.\u003c\\/p\u003e\\n\\n\u003cp\u003eAttaching patch 1b, with the following changes:\u003cbr\\/\u003e\\n o moved the check for collated types inside the sp.resultExact block. A further change may be to remove the instance variables altogether.\u003cbr\\/\u003e\\n o added a regression test in CollationTest2.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere might be room for improvement in the wording (both comments and method-names), since my vocabulary related to collations is rather thin \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e Also, I believe we are applying a collation order even when there is no territory specified, so DVD.isCollatedType is maybe confusing?\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother question:\u003cbr\\/\u003e\\nThe block above the one where I applied the fix deals with the case where also the row location is the same.\u003cbr\\/\u003e\\nWhen does this case happen, and is it guaranteed that the row values are correct even when a (non-default) collation is being used?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13085073_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13085073_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/11 13:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-15T13:14:24+0000\'\u003e15\\/Aug\\/11 13:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for testing and reviewing the patch, Brett. \\nI will work hard to have a fix committed in time for the upcoming 10.8.2-release, but I\'d still like to get a comment from one of the store experts. \\nThe store is tricky, and maybe there are other places in the code that isn\'t prepared for collations. \\n\\n Attaching patch 1b, with the following changes: \\n o moved the check for collated types inside the sp.resultExact block. A further change may be to remove the instance variables altogether. \\n o added a regression test in CollationTest2. \\n\\n There might be room for improvement in the wording (both comments and method-names), since my vocabulary related to collations is rather thin   Also, I believe we are applying a collation order even when there is no territory specified, so DVD.isCollatedType is maybe confusing? \\n\\n Another question: \\nThe block above the one where I applied the fix deals with the case where also the row location is the same. \\nWhen does this case happen, and is it guaranteed that the row values are correct even when a (non-default) collation is being used?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13092984\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13092984&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13092984\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13092984_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13092984_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/11 17:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-29T17:21:32+0000\'\u003e29\\/Aug\\/11 17:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have not looked at patch yet.  First some answers to previous questions.  \u003c\\/p\u003e\\n\\n\u003cp\u003eAs to the following:\u003cbr\\/\u003e\\na) Deoptimize insert - always insert a new index row. \u003c\\/p\u003e\\n\\n\u003cp\u003eThis would be a bad idea.  Algorithms in the btree depend on every leaf row in the tree being unique, whether the rows are deleted or not.   There are 2 cases\u003cbr\\/\u003e\\nto consider: unique and non-unique btrees.  In the case of non-unique btrees each leaf row is made unique by including the trailing row location as part of the whole key.  In the case of unique btrees the keys should be unique not including the row location, and thus the search algo\'s don\'t include it as part of the key.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe kinds of things that depend on this may include the following:\u003cbr\\/\u003e\\no the various binary searches on the leafs assume a single unique final destination, if the code allows for multiple duplicate leafs then I think you might randomly end up in the middle of a list of keys depending on binary search, and the code does not expect to get to a destination and \\\"backup\\\" to beginning of\u003cbr\\/\u003e\\na list. \u003cbr\\/\u003e\\no the check for inserting a duplicate error assumes the binary search will get to exactly the ONE row that matches depending on unique vs non-unique\u003cbr\\/\u003e\\nparameters.  I think bugs will arise if there are more than one matching row.  \u003c\\/p\u003e\\n\\n\u003cp\u003eAs to following question:\u003cbr\\/\u003e\\n&gt;The block above the one where I applied the fix deals with the case where also the row location is the same.\u003cbr\\/\u003e\\n&gt;When does this case happen, and is it guaranteed that the row values are correct even when a (non-default) collation is being used? \u003cbr\\/\u003e\\nLogically the code should handle this as Derby theoretically allows for reusable record ids.  In practice heap pages are marked to not allow them, so \u003cbr\\/\u003e\\ni don;t think this is a normal event.  It might happen as part of particular paths through crash recovery where we do logical undo vs. physical undo on\u003cbr\\/\u003e\\nbtree pages. \u003c\\/p\u003e\\n\\n\u003cp\u003eI am not sure about the question about non-default collation.  At high level I believe it should work and the store should just count on the result \u003cbr\\/\u003e\\nof the collation code doing the compare.  If it says 2 different things are the same then it should just treat them as the same.\u003c\\/p\u003e\\n\\n\u003cp\u003eNext I will look at patch.  Sorry about delay - have been out and away from list for awhile.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13092984_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13092984_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/11 17:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-29T17:21:32+0000\'\u003e29\\/Aug\\/11 17:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have not looked at patch yet.  First some answers to previous questions.   \\n\\n As to the following: \\na) Deoptimize insert - always insert a new index row.  \\n\\n This would be a bad idea.  Algorithms in the btree depend on every leaf row in the tree being unique, whether the rows are deleted or not.   There are 2 cases \\nto consider: unique and non-unique btrees.  In the case of non-unique btrees each leaf row is made unique by including the trailing row location as part of the whole key.  In the case of unique btrees the keys should be unique not including the row location, and thus the search algo\'s don\'t include it as part of the key. \\n\\n The kinds of things that depend on this may include the following: \\no the various binary searches on the leafs assume a single unique final destination, if the code allows for multiple duplicate leafs then I think you might randomly end up in the middle of a list of keys depending on binary search, and the code does not expect to get to a destination and \\\"backup\\\" to beginning of \\na list.  \\no the check for inserting a duplicate error assumes the binary search will get to exactly the ONE row that matches depending on unique vs non-unique \\nparameters.  I think bugs will arise if there are more than one matching row.   \\n\\n As to following question: \\n&gt;The block above the one where I applied the fix deals with the case where also the row location is the same. \\n&gt;When does this case happen, and is it guaranteed that the row values are correct even when a (non-default) collation is being used?  \\nLogically the code should handle this as Derby theoretically allows for reusable record ids.  In practice heap pages are marked to not allow them, so  \\ni don;t think this is a normal event.  It might happen as part of particular paths through crash recovery where we do logical undo vs. physical undo on \\nbtree pages.  \\n\\n I am not sure about the question about non-default collation.  At high level I believe it should work and the store should just count on the result  \\nof the collation code doing the compare.  If it says 2 different things are the same then it should just treat them as the same. \\n\\n Next I will look at patch.  Sorry about delay - have been out and away from list for awhile.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13093016\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13093016&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13093016\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13093016_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13093016_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/11 17:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-29T17:54:13+0000\'\u003e29\\/Aug\\/11 17:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI looked at the patch, and I am leaning toward it is not worth putting in the special case code for collation.  I think it would be better if you just got rid of the optimization of only updating the row location, and just do the whole row update in the case of matching row always.  I think this path is not a very normal path and better to make the code \u003cbr\\/\u003e\\nsimple and not make the fast insert path for all inserts deal with checking for collation or not.   Extra benefit is we will get better testing with one code path\u003cbr\\/\u003e\\nand can optimize later if we need to.\u003c\\/p\u003e\\n\\n\u003cp\u003eDo leave a comment why you are not doing the optimization, as it will seem strange without at least a reference to collation and why 2 things that compare the same might not actually be same value.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI do agree that in general the fix is the right one, in that you need to update the whole row rather than part in the collation case.\u003c\\/p\u003e\\n\\n\u003cp\u003eEither as part of this fix or log another jira I do believe the other block that handles all fields being the same also should be fixed.  I posted a guess at those code paths, but to be sure probably easiest is to add a stack trace dump to standard out and run the full test suite.  Again I think it would be reasonable to \u003cbr\\/\u003e\\njust remove the optimization always and do a full update with a comment.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13093016_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13093016_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/11 17:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-29T17:54:13+0000\'\u003e29\\/Aug\\/11 17:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I looked at the patch, and I am leaning toward it is not worth putting in the special case code for collation.  I think it would be better if you just got rid of the optimization of only updating the row location, and just do the whole row update in the case of matching row always.  I think this path is not a very normal path and better to make the code  \\nsimple and not make the fast insert path for all inserts deal with checking for collation or not.   Extra benefit is we will get better testing with one code path \\nand can optimize later if we need to. \\n\\n Do leave a comment why you are not doing the optimization, as it will seem strange without at least a reference to collation and why 2 things that compare the same might not actually be same value.   \\n\\n I do agree that in general the fix is the right one, in that you need to update the whole row rather than part in the collation case. \\n\\n Either as part of this fix or log another jira I do believe the other block that handles all fields being the same also should be fixed.  I posted a guess at those code paths, but to be sure probably easiest is to add a stack trace dump to standard out and run the full test suite.  Again I think it would be reasonable to  \\njust remove the optimization always and do a full update with a comment.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13093057\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13093057&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13093057\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13093057_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13093057_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/11 18:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-29T18:25:16+0000\'\u003e29\\/Aug\\/11 18:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ea comment on the caching of the work to determine if any collation fields exist.  The current patch optimizes this on a per open conglomerate basis.\u003cbr\\/\u003e\\nAbsolute performance would be best if users did all their inserts in one open, but many do not.  A better place to optimize this would be at compile\u003cbr\\/\u003e\\ntime, this is the usual place to push these kinds of optimizations in Derby.  I have not done work in this area for quite awhile, but the DynamicCompiledOpenConglomInfo of OpenBTree is the place to do such compile time optimizations.  If changes are done in this area it is important to bump the version number to invalidate existing compiled stored plans.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs I suggested I think it would be best to first check in a simple unoptimized fix, and then if necessary do the optimization based on measured\u003cbr\\/\u003e\\nperf diffs in the future. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13093057_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13093057_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/11 18:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-08-29T18:25:16+0000\'\u003e29\\/Aug\\/11 18:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    a comment on the caching of the work to determine if any collation fields exist.  The current patch optimizes this on a per open conglomerate basis. \\nAbsolute performance would be best if users did all their inserts in one open, but many do not.  A better place to optimize this would be at compile \\ntime, this is the usual place to push these kinds of optimizations in Derby.  I have not done work in this area for quite awhile, but the DynamicCompiledOpenConglomInfo of OpenBTree is the place to do such compile time optimizations.  If changes are done in this area it is important to bump the version number to invalidate existing compiled stored plans. \\n\\n As I suggested I think it would be best to first check in a simple unoptimized fix, and then if necessary do the optimization based on measured \\nperf diffs in the future.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13095531\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13095531&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13095531\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13095531_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13095531_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/11 18:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-01T18:54:51+0000\'\u003e01\\/Sep\\/11 18:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Mike.\u003c\\/p\u003e\\n\\n\u003cp\u003eFirst, I wrote a very simple micro-benchmark. It ran an insert followed by a delete on a table with a primary key in a loop.\u003cbr\\/\u003e\\nWith 30 seconds warm up, 60 seconds steady state and the average of three runs per codebase I ended up with a performance degradation of around 3.6% (insane build, using in-memory back end). I\'ll run this with the disk-based back end later, but first I have another issue to deal with - so these number may be invalid after all...\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the simplest fix possible, which is to replace the updateFieldAtSlot with updateAtSlot, I\'m getting a total of 33 errors in suites.All. I didn\'t see these when I tested the first patch, probably because the failing tests aren\'t using collations so the new code was never run in these tests. Here\'s what the core exception looks like, which can be reproduced by running lang.AlterTableTest (need only dropColumn + for instance testJira3175):\u003cbr\\/\u003e\\njava.lang.ArrayIndexOutOfBoundsException: -1\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.data.BasePage.getHeaderAtSlot(BasePage.java:1881)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.data.StoredPage.storeRecordForUpdate(StoredPage.java:7316)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.data.StoredPage.storeRecord(StoredPage.java:7185)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.data.UpdateOperation.undoMe(UpdateOperation.java:201)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.data.PhysicalUndoOperation.doMe(PhysicalUndoOperation.java:147)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.log.FileLogger.logAndUndo(FileLogger.java:533)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.xact.Xact.logAndUndo(Xact.java:374)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.log.FileLogger.undo(FileLogger.java:1015)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.raw.xact.Xact.abort(Xact.java:952)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.access.RAMTransaction.abort(RAMTransaction.java:1985)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.doRollback(GenericLanguageConnectionContext.java:1767)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.userRollback(GenericLanguageConnectionContext.java:1675)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.rollback(TransactionResourceImpl.java:245)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedConnection.rollback(EmbedConnection.java:1838)\u003cbr\\/\u003e\\n        at org.apache.derbyTesting.junit.JDBC.cleanup(JDBC.java:224)\u003cbr\\/\u003e\\n        at org.apache.derbyTesting.junit.BaseJDBCTestCase.tearDown(BaseJDBCTestCase.java:408)\u003c\\/p\u003e\\n\\n\u003cp\u003eI do see that there are some differences related to undo-logic for the two method calls, but that may very well be a red herring. The problem does seem to be related to logging and transactions.\u003cbr\\/\u003e\\nSo, there\'s obviously something I don\'t understand here... I\'ll continue digging tomorrow - any hints would be helpful \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13095531_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13095531_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/11 18:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-01T18:54:51+0000\'\u003e01\\/Sep\\/11 18:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Mike. \\n\\n First, I wrote a very simple micro-benchmark. It ran an insert followed by a delete on a table with a primary key in a loop. \\nWith 30 seconds warm up, 60 seconds steady state and the average of three runs per codebase I ended up with a performance degradation of around 3.6% (insane build, using in-memory back end). I\'ll run this with the disk-based back end later, but first I have another issue to deal with - so these number may be invalid after all... \\n\\n With the simplest fix possible, which is to replace the updateFieldAtSlot with updateAtSlot, I\'m getting a total of 33 errors in suites.All. I didn\'t see these when I tested the first patch, probably because the failing tests aren\'t using collations so the new code was never run in these tests. Here\'s what the core exception looks like, which can be reproduced by running lang.AlterTableTest (need only dropColumn + for instance testJira3175): \\njava.lang.ArrayIndexOutOfBoundsException: -1 \\n        at org.apache.derby.impl.store.raw.data.BasePage.getHeaderAtSlot(BasePage.java:1881) \\n        at org.apache.derby.impl.store.raw.data.StoredPage.storeRecordForUpdate(StoredPage.java:7316) \\n        at org.apache.derby.impl.store.raw.data.StoredPage.storeRecord(StoredPage.java:7185) \\n        at org.apache.derby.impl.store.raw.data.UpdateOperation.undoMe(UpdateOperation.java:201) \\n        at org.apache.derby.impl.store.raw.data.PhysicalUndoOperation.doMe(PhysicalUndoOperation.java:147) \\n        at org.apache.derby.impl.store.raw.log.FileLogger.logAndUndo(FileLogger.java:533) \\n        at org.apache.derby.impl.store.raw.xact.Xact.logAndUndo(Xact.java:374) \\n        at org.apache.derby.impl.store.raw.log.FileLogger.undo(FileLogger.java:1015) \\n        at org.apache.derby.impl.store.raw.xact.Xact.abort(Xact.java:952) \\n        at org.apache.derby.impl.store.access.RAMTransaction.abort(RAMTransaction.java:1985) \\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.doRollback(GenericLanguageConnectionContext.java:1767) \\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.userRollback(GenericLanguageConnectionContext.java:1675) \\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.rollback(TransactionResourceImpl.java:245) \\n        at org.apache.derby.impl.jdbc.EmbedConnection.rollback(EmbedConnection.java:1838) \\n        at org.apache.derbyTesting.junit.JDBC.cleanup(JDBC.java:224) \\n        at org.apache.derbyTesting.junit.BaseJDBCTestCase.tearDown(BaseJDBCTestCase.java:408) \\n\\n I do see that there are some differences related to undo-logic for the two method calls, but that may very well be a red herring. The problem does seem to be related to logging and transactions. \\nSo, there\'s obviously something I don\'t understand here... I\'ll continue digging tomorrow - any hints would be helpful                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13095533\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13095533&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13095533\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13095533_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13095533_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/11 18:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-01T18:55:49+0000\'\u003e01\\/Sep\\/11 18:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching patch 2a, which produces the errors mentioned in the above comment.\u003cbr\\/\u003e\\nNot for commit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13095533_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13095533_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/11 18:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-01T18:55:49+0000\'\u003e01\\/Sep\\/11 18:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching patch 2a, which produces the errors mentioned in the above comment. \\nNot for commit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13100322\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13100322&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13100322\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13100322_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100322_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T13:53:13+0000\'\u003e08\\/Sep\\/11 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNote to self that the new test should specify the English locale (there may not be a collation for the locale specified\\/used by the user).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13100322_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100322_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T13:53:13+0000\'\u003e08\\/Sep\\/11 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Note to self that the new test should specify the English locale (there may not be a collation for the locale specified\\/used by the user).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13100597\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13100597&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13100597\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13100597_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100597_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 19:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T19:11:35+0000\'\u003e08\\/Sep\\/11 19:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003enot sure what is going on.   Did you run the tests in SANE mode at all?  That -1 sometimes is indicative of some sort of page corruption with something overwriting something else.  Sometimes the SANE code will give a different more obvious error.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13100597_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100597_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 19:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T19:11:35+0000\'\u003e08\\/Sep\\/11 19:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    not sure what is going on.   Did you run the tests in SANE mode at all?  That -1 sometimes is indicative of some sort of page corruption with something overwriting something else.  Sometimes the SANE code will give a different more obvious error.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13100606\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13100606&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13100606\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13100606_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100606_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 19:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T19:18:07+0000\'\u003e08\\/Sep\\/11 19:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eon the benchmark, i assume that was your original patch.  3.6% seems high to me.  I understand that using in memory this is likely the worst case.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13100606_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100606_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 19:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T19:18:07+0000\'\u003e08\\/Sep\\/11 19:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    on the benchmark, i assume that was your original patch.  3.6% seems high to me.  I understand that using in memory this is likely the worst case.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13100632\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13100632&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13100632\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13100632_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100632_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 19:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T19:41:08+0000\'\u003e08\\/Sep\\/11 19:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think the problem is that updateAtSlot interface can not be used in btree\'s in general.   It only supports physical undo which means that the row must be in exactly the same spot on the page as it was originally.  It is used in a couple of places in the btree code on the control row (ie. the row that is always in slot 0).  But otherwise rows move around in btrees and that is the purpose of the logical undo logic.  Updates of rows in btrees are always done as deletes followed by inserts.  But that does not help in this special case.  The updateFieldAtSlot interface does support logical undo.  \u003c\\/p\u003e\\n\\n\u003cp\u003eOff hand seems like we could:\u003cbr\\/\u003e\\n1) write a updateAtSlot that does logical undo.  Before this it was not needed because an update of btree row would never \\\"know\\\" that it was going back to the same slot, so it was always cleaner to just do the delete and insert.  I would be willing to help with this, let me know.  \u003c\\/p\u003e\\n\\n\u003cp\u003e2) a little ugly but might be interesting as a quick fix to see if it works is that you could do updateFieldAtSlot for each field in the row.\u003c\\/p\u003e\\n\\n\u003cp\u003eI will think about this over night and see if I can come up with anything simpler.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13100632_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100632_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 19:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T19:41:08+0000\'\u003e08\\/Sep\\/11 19:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think the problem is that updateAtSlot interface can not be used in btree\'s in general.   It only supports physical undo which means that the row must be in exactly the same spot on the page as it was originally.  It is used in a couple of places in the btree code on the control row (ie. the row that is always in slot 0).  But otherwise rows move around in btrees and that is the purpose of the logical undo logic.  Updates of rows in btrees are always done as deletes followed by inserts.  But that does not help in this special case.  The updateFieldAtSlot interface does support logical undo.   \\n\\n Off hand seems like we could: \\n1) write a updateAtSlot that does logical undo.  Before this it was not needed because an update of btree row would never \\\"know\\\" that it was going back to the same slot, so it was always cleaner to just do the delete and insert.  I would be willing to help with this, let me know.   \\n\\n 2) a little ugly but might be interesting as a quick fix to see if it works is that you could do updateFieldAtSlot for each field in the row. \\n\\n I will think about this over night and see if I can come up with anything simpler.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13100662\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13100662&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13100662\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13100662_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100662_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 20:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T20:17:44+0000\'\u003e08\\/Sep\\/11 20:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for that information, Mike!\u003c\\/p\u003e\\n\\n\u003cp\u003eI have written a patch for option 2 already, and suites.All ran without failure (sane build). I\'ll run derbyall too, and run a first simple performance experiment. I suppose the performance degradation will become worse with the number of key fields.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother option would be to combine 2 with an improved version of what I did in my first patch - only update the full row if the data types in the key are collation sensitive.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have no experience in the area of option 1, so I will probably be unable to get something working before Monday...\u003c\\/p\u003e\\n\\n\u003cp\u003eFYI, I saw the -1 with a sane build. The record isn\'t found and the store (I don\'t remember the method name) returns -1 as the slot.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13100662_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100662_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 20:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T20:17:44+0000\'\u003e08\\/Sep\\/11 20:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for that information, Mike! \\n\\n I have written a patch for option 2 already, and suites.All ran without failure (sane build). I\'ll run derbyall too, and run a first simple performance experiment. I suppose the performance degradation will become worse with the number of key fields. \\n\\n Another option would be to combine 2 with an improved version of what I did in my first patch - only update the full row if the data types in the key are collation sensitive. \\n\\n I have no experience in the area of option 1, so I will probably be unable to get something working before Monday... \\n\\n FYI, I saw the -1 with a sane build. The record isn\'t found and the store (I don\'t remember the method name) returns -1 as the slot.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13100709\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13100709&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13100709\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13100709_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100709_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T21:25:13+0000\'\u003e08\\/Sep\\/11 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ederbyall passed too.\u003cbr\\/\u003e\\nInitial perf numbers seems to be comparable with the previous ones when using the in-memory back end.\u003cbr\\/\u003e\\nI\'ll start some longer runs tomorrow with the on-disk back end and upload the test code.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13100709_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100709_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T21:25:13+0000\'\u003e08\\/Sep\\/11 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    derbyall passed too. \\nInitial perf numbers seems to be comparable with the previous ones when using the in-memory back end. \\nI\'ll start some longer runs tomorrow with the on-disk back end and upload the test code.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13100756\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13100756&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13100756\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13100756_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100756_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 22:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T22:35:20+0000\'\u003e08\\/Sep\\/11 22:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor benchmarks it seems like we would like to know results for 2 different types of benchmarks.  The worst case for this code would be primary key insert and delete repeated using the same key.  I think that is what you are doing.  Then also just a normal mix of insert\\/delete.  The question I would be trying to understand is it worth the overhead to the \\\"normal\\\" path to know if we can then optimize for the worst case path.  Basically 3.6% degredation for that worst case which I don\'t think is a normal usage pattern may be ok.  What I don\'t want to see is\u003cbr\\/\u003e\\nslowdown is \\\"normal\\\" case which I think we might have seen with patch 1 that did work in normal path to optimize the worst case path.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think option 2 is a reasonable approach for a bug fix to existing codelines.  Seems safe to me, and a good first step.  And doing it not \u003cbr\\/\u003e\\nspecial cased gets us full testing that caught the previous problem with the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith more thought I don\'t think we should do option 1.  I think it might make sense to log a future project for the trunk to look into just going ahead a purging the deleted row and then retrying the insert.  Whie we have the latch we may just want to purge all committed deleted rows\u003cbr\\/\u003e\\nin a similar fashion to what we do previous to splitting the page.\u003cbr\\/\u003e\\nThe problem is that purge is tricky in that it has to be committed while holding the latch on the page, you can\'t just call it in-line in the current\u003cbr\\/\u003e\\ncode.  And you have to make sure that if you fork a transaction that parent is not conflicting with child to do the purge, otherwise might loop\u003cbr\\/\u003e\\nforever.  The purge will also address the RESOLVE in the code right now (since that comment was written HeapRowLocations are now variable in size based on CompressedNumber) .  And with the specific issue that is causing this issue it is also\u003cbr\\/\u003e\\npossible that updating \\\"equal\\\" fields might need more space given that different characters and chacter sequences can be \\\"equal\\\".  So the\u003cbr\\/\u003e\\nproblem is even possibly worse for the collation problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13100756_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13100756_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/11 22:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-08T22:35:20+0000\'\u003e08\\/Sep\\/11 22:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For benchmarks it seems like we would like to know results for 2 different types of benchmarks.  The worst case for this code would be primary key insert and delete repeated using the same key.  I think that is what you are doing.  Then also just a normal mix of insert\\/delete.  The question I would be trying to understand is it worth the overhead to the \\\"normal\\\" path to know if we can then optimize for the worst case path.  Basically 3.6% degredation for that worst case which I don\'t think is a normal usage pattern may be ok.  What I don\'t want to see is \\nslowdown is \\\"normal\\\" case which I think we might have seen with patch 1 that did work in normal path to optimize the worst case path. \\n\\n I think option 2 is a reasonable approach for a bug fix to existing codelines.  Seems safe to me, and a good first step.  And doing it not  \\nspecial cased gets us full testing that caught the previous problem with the patch. \\n\\n With more thought I don\'t think we should do option 1.  I think it might make sense to log a future project for the trunk to look into just going ahead a purging the deleted row and then retrying the insert.  Whie we have the latch we may just want to purge all committed deleted rows \\nin a similar fashion to what we do previous to splitting the page. \\nThe problem is that purge is tricky in that it has to be committed while holding the latch on the page, you can\'t just call it in-line in the current \\ncode.  And you have to make sure that if you fork a transaction that parent is not conflicting with child to do the purge, otherwise might loop \\nforever.  The purge will also address the RESOLVE in the code right now (since that comment was written HeapRowLocations are now variable in size based on CompressedNumber) .  And with the specific issue that is causing this issue it is also \\npossible that updating \\\"equal\\\" fields might need more space given that different characters and chacter sequences can be \\\"equal\\\".  So the \\nproblem is even possibly worse for the collation problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13101316\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13101316&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13101316\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13101316_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13101316_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Sep\\/11 16:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-09T16:39:52+0000\'\u003e09\\/Sep\\/11 16:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching patch 3a, which I\'m running tests with.\u003c\\/p\u003e\\n\\n\u003cp\u003eCan you specify in some more detail what you mean with a normal mix of insert\\/delete?\u003c\\/p\u003e\\n\\n\u003cp\u003eI have started the first batch of tests for the simple case - insert and delete the same key over and over again.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13101316_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13101316_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Sep\\/11 16:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-09T16:39:52+0000\'\u003e09\\/Sep\\/11 16:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching patch 3a, which I\'m running tests with. \\n\\n Can you specify in some more detail what you mean with a normal mix of insert\\/delete? \\n\\n I have started the first batch of tests for the simple case - insert and delete the same key over and over again.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13102566\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13102566&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13102566\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13102566_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13102566_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/11 11:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-12T11:41:00+0000\'\u003e12\\/Sep\\/11 11:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Kristian Waagan - 12\\/Sep\\/11 11:41\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have run two simple benchmarks. The first one I cannot post the source code for, but it populates the database and then it starts deleting and inserting records. Here I saw around 7% performance decrease with the proposed fix.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll attach the source for the other benchmark. It is very simple, and only inserts and deletes the same record over and over again. The insert and delete is done as one transaction.\u003cbr\\/\u003e\\nI ran with 60 s warmup and 300 s steady-state, ten runs per configuration. Unless stated otherwise, all settings are default. I just rounded the final numbers.\u003cbr\\/\u003e\\nExplanation for the \\\"bad\\\" runs follows further down.\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8212; single column key\u003cbr\\/\u003e\\nclean, auto on: 637 tps\u003cbr\\/\u003e\\nd5367, auto on: 557 tps\u003cbr\\/\u003e\\n==&gt; -12,5%\u003c\\/p\u003e\\n\\n\u003cp\u003eclean, auto off: 3560 tps (5 \\\"bad\\\" runs)\u003cbr\\/\u003e\\nd5367, auto off: 2874 tps (3 \\\"bad\\\" runs)\u003cbr\\/\u003e\\n==&gt; -19.5%\u003cbr\\/\u003e\\n(commit interval 5k)\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8212; composite key, three columns\u003cbr\\/\u003e\\nclean, auto on: 551 tps\u003cbr\\/\u003e\\nd5367, auto on: 382 tps\u003cbr\\/\u003e\\n==&gt; -30%\u003c\\/p\u003e\\n\\n\u003cp\u003eclean, auto off: 2799 tps (1 \\\"bad\\\" runs)\u003cbr\\/\u003e\\nd5367, auto off: 1671 tps (0 \\\"bad\\\" runs)\u003cbr\\/\u003e\\n==&gt; -40%\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8212; max checkpoint interval and log switch interval (single column key)\u003cbr\\/\u003e\\nclean, auto off: 6272 tps (3 \\\"bad\\\" runs)\u003cbr\\/\u003e\\nd5367, auto off: 4908 tps (0 \\\"bad\\\" runs)\u003cbr\\/\u003e\\n==&gt; -21,5%\u003c\\/p\u003e\\n\\n\u003cp\u003eI tested the checkpoint interval and log switch settings because I saw runs with huge performance drops with the default settings. I wasn\'t able to get rid of these entirely. What I saw was runs with auto-commit off whose performance dropped roughly to the performance of the runs with auto-commit on. I haven\'t investigated further, but I\'d like to know if the drops are limited duration events, or if the performance drop is permanent.\u003cbr\\/\u003e\\nThe numbers above are for worst case scenarios.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m currently testing an alternative patch to see how performance is affected when we optimize to avoid updating all fields when there are no collated types in the conglomerate. This has the drawback that concerned Mike - there will be multiple code paths and the new code executed for collated types only will be a lot less tested.\u003cbr\\/\u003e\\nThis can be optimized further for composite keys, but that part is not high priority for me right now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13102566_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13102566_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/11 11:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-12T11:41:00+0000\'\u003e12\\/Sep\\/11 11:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Kristian Waagan - 12\\/Sep\\/11 11:41\\\"\u003eedited\u003c\\/span\u003e                   I have run two simple benchmarks. The first one I cannot post the source code for, but it populates the database and then it starts deleting and inserting records. Here I saw around 7% performance decrease with the proposed fix. \\n\\n I\'ll attach the source for the other benchmark. It is very simple, and only inserts and deletes the same record over and over again. The insert and delete is done as one transaction. \\nI ran with 60 s warmup and 300 s steady-state, ten runs per configuration. Unless stated otherwise, all settings are default. I just rounded the final numbers. \\nExplanation for the \\\"bad\\\" runs follows further down. \\n\\n &#8212; single column key \\nclean, auto on: 637 tps \\nd5367, auto on: 557 tps \\n==&gt; -12,5% \\n\\n clean, auto off: 3560 tps (5 \\\"bad\\\" runs) \\nd5367, auto off: 2874 tps (3 \\\"bad\\\" runs) \\n==&gt; -19.5% \\n(commit interval 5k) \\n\\n &#8212; composite key, three columns \\nclean, auto on: 551 tps \\nd5367, auto on: 382 tps \\n==&gt; -30% \\n\\n clean, auto off: 2799 tps (1 \\\"bad\\\" runs) \\nd5367, auto off: 1671 tps (0 \\\"bad\\\" runs) \\n==&gt; -40% \\n\\n &#8212; max checkpoint interval and log switch interval (single column key) \\nclean, auto off: 6272 tps (3 \\\"bad\\\" runs) \\nd5367, auto off: 4908 tps (0 \\\"bad\\\" runs) \\n==&gt; -21,5% \\n\\n I tested the checkpoint interval and log switch settings because I saw runs with huge performance drops with the default settings. I wasn\'t able to get rid of these entirely. What I saw was runs with auto-commit off whose performance dropped roughly to the performance of the runs with auto-commit on. I haven\'t investigated further, but I\'d like to know if the drops are limited duration events, or if the performance drop is permanent. \\nThe numbers above are for worst case scenarios. \\n\\n I\'m currently testing an alternative patch to see how performance is affected when we optimize to avoid updating all fields when there are no collated types in the conglomerate. This has the drawback that concerned Mike - there will be multiple code paths and the new code executed for collated types only will be a lot less tested. \\nThis can be optimized further for composite keys, but that part is not high priority for me right now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13102991\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13102991&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13102991\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13102991_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13102991_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/11 20:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-12T20:14:07+0000\'\u003e12\\/Sep\\/11 20:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching patch 4a, which takes another approach when it comes to optimizing the code. The old\\/current code will be run on indexes which don\'t have collated types, whereas the for indexes with collated types all fields will be updated (one by one).\u003c\\/p\u003e\\n\\n\u003cp\u003eHopefully, one should see identical performance in the normal case with this patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith collated types performance will drop as indicated in the performance results I posted above (worst case). It might be possible to trade CPU for IO, i.e. to compare the values before deciding to update the field. One can also avoid updating fields that aren\'t collated (only relevant for composite keys).\u003c\\/p\u003e\\n\\n\u003cp\u003ePatch ready for review.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13102991_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13102991_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/11 20:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-12T20:14:07+0000\'\u003e12\\/Sep\\/11 20:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching patch 4a, which takes another approach when it comes to optimizing the code. The old\\/current code will be run on indexes which don\'t have collated types, whereas the for indexes with collated types all fields will be updated (one by one). \\n\\n Hopefully, one should see identical performance in the normal case with this patch. \\n\\n With collated types performance will drop as indicated in the performance results I posted above (worst case). It might be possible to trade CPU for IO, i.e. to compare the values before deciding to update the field. One can also avoid updating fields that aren\'t collated (only relevant for composite keys). \\n\\n Patch ready for review.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13103485\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13103485&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13103485\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13103485_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13103485_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/11 09:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-13T09:18:25+0000\'\u003e13\\/Sep\\/11 09:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBrett, do you have an idea of how often the insert-delete-insert pattern is executed in your application(s)? (on tables with an index, with or without collation)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13103485_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13103485_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/11 09:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-13T09:18:25+0000\'\u003e13\\/Sep\\/11 09:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Brett, do you have an idea of how often the insert-delete-insert pattern is executed in your application(s)? (on tables with an index, with or without collation)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13108026\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13108026&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13108026\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13108026_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13108026_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/11 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-19T17:52:58+0000\'\u003e19\\/Sep\\/11 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMike, what\'s your take on a fix along the lines of patch 4a?\u003cbr\\/\u003e\\nI\'d have to run the same sets of benchmarks on non-collated database, first but if those results are looking okay I lean towards a commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t have a good sense of how often this code will be run, so it\'s hard for me to say if we should just not optimize this at all. Judging by the performance numbers only, I would definitely do the optimization.\u003c\\/p\u003e\\n\\n\u003cp\u003eI want to see a fix for this issue shortly, such that people affected can run off the head of 10.8 with their own build if they want to do so (with the risks associated of course).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13108026_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13108026_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/11 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-19T17:52:58+0000\'\u003e19\\/Sep\\/11 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mike, what\'s your take on a fix along the lines of patch 4a? \\nI\'d have to run the same sets of benchmarks on non-collated database, first but if those results are looking okay I lean towards a commit. \\n\\n I don\'t have a good sense of how often this code will be run, so it\'s hard for me to say if we should just not optimize this at all. Judging by the performance numbers only, I would definitely do the optimization. \\n\\n I want to see a fix for this issue shortly, such that people affected can run off the head of 10.8 with their own build if they want to do so (with the risks associated of course).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13108310\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13108310&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13108310\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13108310_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13108310_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/11 01:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-20T01:22:44+0000\'\u003e20\\/Sep\\/11 01:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKristian,\u003c\\/p\u003e\\n\\n\u003cp\u003eWith respect to this particular case (collation), the insert-delete-insert pattern is strictly based on user input.  How this was discovered was that a user created a \\\"tag\\\" on an entity in our system (eg. \'cisco\'), realized they had mistyped, deleted \'cisco\', and added \'Cisco\'.  This resulted in the lower-case \'cisco\' coming back (because of this bug).  So to answer you question, with respect to this bug, I would classify it as \\\"low frequency\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, obviously, insert-delete-insert patterns are fairly common in general.  Any system that collects information in an automated fashion (news feeds, network data, seismic data, etc.) might delete a bunch of old rows and insert new rows with greater frequency.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo tell you the truth, because of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4279\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4279\u003c\\/a\u003e, I\'ve abandoned this \\\"pattern\\\" almost completely in Derby.  Whenever I need to delete a bunch of rows (\'bunch\' being tens of) and insert a new batch in the same transaction, because of 4279, I now have to instead mark rows deleted (with an UPDATE statement) and then insert new rows.  Deletion of marked rows is handled later via a scheduled deletion job.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat of course is an aside (4279), but I\'m surprised you can actually run your benchmark without running into it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13108310_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13108310_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/11 01:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-20T01:22:44+0000\'\u003e20\\/Sep\\/11 01:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Kristian, \\n\\n With respect to this particular case (collation), the insert-delete-insert pattern is strictly based on user input.  How this was discovered was that a user created a \\\"tag\\\" on an entity in our system (eg. \'cisco\'), realized they had mistyped, deleted \'cisco\', and added \'Cisco\'.  This resulted in the lower-case \'cisco\' coming back (because of this bug).  So to answer you question, with respect to this bug, I would classify it as \\\"low frequency\\\". \\n\\n However, obviously, insert-delete-insert patterns are fairly common in general.  Any system that collects information in an automated fashion (news feeds, network data, seismic data, etc.) might delete a bunch of old rows and insert new rows with greater frequency. \\n\\n To tell you the truth, because of  https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4279 , I\'ve abandoned this \\\"pattern\\\" almost completely in Derby.  Whenever I need to delete a bunch of rows (\'bunch\' being tens of) and insert a new batch in the same transaction, because of 4279, I now have to instead mark rows deleted (with an UPDATE statement) and then insert new rows.  Deletion of marked rows is handled later via a scheduled deletion job. \\n\\n That of course is an aside (4279), but I\'m surprised you can actually run your benchmark without running into it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13109000\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13109000&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13109000\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_13109000_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13109000_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/11 21:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-20T21:11:12+0000\'\u003e20\\/Sep\\/11 21:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf I understand this correctly the optimization is the old code (already well tested) which would still apply for non-collated dbs. So, the new code would only apply for the (already buggy) collated code path. If so, it seems justified to me to have the optimization. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_13109000_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13109000_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/11 21:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-20T21:11:12+0000\'\u003e20\\/Sep\\/11 21:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If I understand this correctly the optimization is the old code (already well tested) which would still apply for non-collated dbs. So, the new code would only apply for the (already buggy) collated code path. If so, it seems justified to me to have the optimization.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13112159\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13112159&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13112159\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13112159_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13112159_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Sep\\/11 22:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-21T22:08:46+0000\'\u003e21\\/Sep\\/11 22:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have reviewed the most recent patch.  Here are comments, none of which I would say should hold up a commit:\u003c\\/p\u003e\\n\\n\u003cp\u003eo I much prefer the current optimization as now it is a compile time decision.  I still would prefer if non-collated db\'s did not have to march through\u003cbr\\/\u003e\\n   all the collumns and calculate if the row has collated columns on every compile.  I might have pushed the work up to language by adding an\u003cbr\\/\u003e\\n   argument to OpenConglomerateScratchSpace to pass in hasCollatedTypes.  That would make most sense if the calling level has a better\u003cbr\\/\u003e\\n   understanding of the collation state of the DB and\\/or table and could avoid the calculation.\u003c\\/p\u003e\\n\\n\u003cp\u003eo I believe you said it, but just want to verify that you ran at least one set of tests where all tests went through the proposed collation code path just\u003cbr\\/\u003e\\n   to make sure it was tested once.  My guess is that the new codepath you are adding is probably not tested at all, without adding some new tests.\u003cbr\\/\u003e\\n   Seems like you should at least add some version of the test case from the bug report.\u003c\\/p\u003e\\n\\n\u003cp\u003eo I think the following is also a bug for same reason as you are working on - but not sure how to force the code path, but happy to have it as a separate JIRA - let me know if I should report it:\u003cbr\\/\u003e\\n if (this.getConglomerate().nKeyFields ==\u003cbr\\/\u003e\\n     this.getConglomerate().nUniqueColumns)\u003c\\/p\u003e\\n {\\n     \\/\\/ The row that we found deleted is exactly the new ro\\n     targetleaf.page.deleteAtSlot(\\n         insert_slot, false, this.btree_undo);\\n\\n     break;\\n }\\n\\n\u003cp\u003eo longer term I think that we should not be doing the update at all, and instead doing purges.  I think that will solve some of the possible out of space issues.  But I think there are self deadlocking issues there so I am in favor of your approach especially for back porting to existing releases.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13112159_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13112159_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Sep\\/11 22:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-21T22:08:46+0000\'\u003e21\\/Sep\\/11 22:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have reviewed the most recent patch.  Here are comments, none of which I would say should hold up a commit: \\n\\n o I much prefer the current optimization as now it is a compile time decision.  I still would prefer if non-collated db\'s did not have to march through \\n   all the collumns and calculate if the row has collated columns on every compile.  I might have pushed the work up to language by adding an \\n   argument to OpenConglomerateScratchSpace to pass in hasCollatedTypes.  That would make most sense if the calling level has a better \\n   understanding of the collation state of the DB and\\/or table and could avoid the calculation. \\n\\n o I believe you said it, but just want to verify that you ran at least one set of tests where all tests went through the proposed collation code path just \\n   to make sure it was tested once.  My guess is that the new codepath you are adding is probably not tested at all, without adding some new tests. \\n   Seems like you should at least add some version of the test case from the bug report. \\n\\n o I think the following is also a bug for same reason as you are working on - but not sure how to force the code path, but happy to have it as a separate JIRA - let me know if I should report it: \\n if (this.getConglomerate().nKeyFields == \\n     this.getConglomerate().nUniqueColumns) \\n {\\n     \\/\\/ The row that we found deleted is exactly the new ro\\n     targetleaf.page.deleteAtSlot(\\n         insert_slot, false, this.btree_undo);\\n\\n     break;\\n }\\n\\n o longer term I think that we should not be doing the update at all, and instead doing purges.  I think that will solve some of the possible out of space issues.  But I think there are self deadlocking issues there so I am in favor of your approach especially for back porting to existing releases.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13112604\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13112604&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13112604\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13112604_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13112604_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/11 14:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-22T14:09:55+0000\'\u003e22\\/Sep\\/11 14:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMike,\u003c\\/p\u003e\\n\\n\u003cp\u003eMy replies below, to your comments above.\u003c\\/p\u003e\\n\\n\u003cp\u003e o I\'ve changed this a bit again, see patch 4b.\u003cbr\\/\u003e\\n   I now detect if there are columns with other collations than UCS BASIC\u003cbr\\/\u003e\\n   when the conglomerate is created or opened. By tacking on to\u003cbr\\/\u003e\\n   ConglomerateUtil.readCollationIdArray this comes almost for free (need\u003cbr\\/\u003e\\n   one more boolean field in the conglom classes though), and we just have\u003cbr\\/\u003e\\n   to iterate through the ids once upon creation.\u003cbr\\/\u003e\\n   Derby always has to do an if on hasCollatedTypes(). This could maybe be\u003cbr\\/\u003e\\n   made final with some refactoring (not sure if that would matter though).\u003c\\/p\u003e\\n\\n\u003cp\u003e o Yes, the new test I wrote, based on the bug report, will be included.\u003cbr\\/\u003e\\n   It is now part of patch 4b.\u003cbr\\/\u003e\\n   There are no other tests stressing this piece of code in suites.All.\u003c\\/p\u003e\\n\\n\u003cp\u003e o Please report this. It looked suspicious to me the first time I saw it,\u003cbr\\/\u003e\\n   but I don\'t have the knowledge to add any more context.\u003cbr\\/\u003e\\n   FYI, the test jdbciapi.SURQueryMixTest triggers that piece of code.\u003cbr\\/\u003e\\n   (SUR = scrollable updatable resultset)\u003c\\/p\u003e\\n\\n\u003cp\u003e o Noted. It would be good to log a JIRA for this if not already done.\u003c\\/p\u003e\\n\\n\u003cp\u003eNow that it looks like there might be another RC, I\'d like to get a fix for\u003cbr\\/\u003e\\nthis issue included. Unfortunately, I\'ll be away next week. I\'ll commit this\u003cbr\\/\u003e\\ntomorrow if I don\'t get any pushback before then.\u003cbr\\/\u003e\\nIf I commit and things go awry, back out the fix (it will be a single commit only).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13112604_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13112604_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/11 14:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-22T14:09:55+0000\'\u003e22\\/Sep\\/11 14:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mike, \\n\\n My replies below, to your comments above. \\n\\n  o I\'ve changed this a bit again, see patch 4b. \\n   I now detect if there are columns with other collations than UCS BASIC \\n   when the conglomerate is created or opened. By tacking on to \\n   ConglomerateUtil.readCollationIdArray this comes almost for free (need \\n   one more boolean field in the conglom classes though), and we just have \\n   to iterate through the ids once upon creation. \\n   Derby always has to do an if on hasCollatedTypes(). This could maybe be \\n   made final with some refactoring (not sure if that would matter though). \\n\\n  o Yes, the new test I wrote, based on the bug report, will be included. \\n   It is now part of patch 4b. \\n   There are no other tests stressing this piece of code in suites.All. \\n\\n  o Please report this. It looked suspicious to me the first time I saw it, \\n   but I don\'t have the knowledge to add any more context. \\n   FYI, the test jdbciapi.SURQueryMixTest triggers that piece of code. \\n   (SUR = scrollable updatable resultset) \\n\\n  o Noted. It would be good to log a JIRA for this if not already done. \\n\\n Now that it looks like there might be another RC, I\'d like to get a fix for \\nthis issue included. Unfortunately, I\'ll be away next week. I\'ll commit this \\ntomorrow if I don\'t get any pushback before then. \\nIf I commit and things go awry, back out the fix (it will be a single commit only).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13112991\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13112991&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13112991\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13112991_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13112991_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/11 22:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-22T22:53:05+0000\'\u003e22\\/Sep\\/11 22:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching patch 4c. The only difference from 4b is an extra assert in OpenConglomerateScratchSpace.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13112991_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13112991_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/11 22:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-22T22:53:05+0000\'\u003e22\\/Sep\\/11 22:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching patch 4c. The only difference from 4b is an extra assert in OpenConglomerateScratchSpace.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13112996\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13112996&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13112996\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13112996_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13112996_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/11 22:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-22T22:55:34+0000\'\u003e22\\/Sep\\/11 22:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted patch 4c to trunk with revision 1174436.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13112996_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13112996_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/11 22:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-22T22:55:34+0000\'\u003e22\\/Sep\\/11 22:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed patch 4c to trunk with revision 1174436.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13113232\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13113232&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13113232\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13113232_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13113232_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/11 07:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-23T07:53:40+0000\'\u003e23\\/Sep\\/11 07:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTests ran cleanly on 10.8 (with the fixed merged from trunk), with the exception of this error in testConcurrentInvalidation(org.apache.derbyTesting.functionTests.tests.lang.TruncateTableTest):\u003cbr\\/\u003e\\nHelper thread failed\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\nFri Sep 23 01:19:36 CEST 2011 Thread\u003cspan class=\\\"error\\\"\u003e&#91;DRDAConnThread_77,5,derby.daemons&#93;\u003c\\/span\u003e (XID = 24553), (SESSIONID = 31), (DATABASE = dbsqlauth), (DRDAID = \\uFFFD\\uFFFD\\uFFFD\\uFFFD\\uFFFD\\uFFFD\\uFFFD\\uFFFD.\\uFFFD\\uFFFD-808957766332849398\u003c\\/p\u003e\\n{3}\\n\u003cp\u003e), Failed Statement is: select * from d4275\u003cbr\\/\u003e\\nERROR XSAI2: The conglomerate (4,448) requested does not exist.\u003cbr\\/\u003e\\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.access.heap.HeapConglomerateFactory.readConglomerate(HeapConglomerateFactory.java:254)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.access.RAMAccessManager.conglomCacheFind(RAMAccessManager.java:482)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.access.RAMTransaction.findExistingConglomerate(RAMTransaction.java:394)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.store.access.RAMTransaction.getDynamicCompiledConglomInfo(RAMTransaction.java:692)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.TableScanResultSet.openCore(TableScanResultSet.java:245)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.openCore(BulkTableScanResultSet.java:248)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(BasicNoPutResultSetImpl.java:255)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1686)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(EmbedPreparedStatement.java:1341)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.drda.DRDAStatement.execute(DRDAStatement.java:706)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:866)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:295)\u003cbr\\/\u003e\\nCleanup action completed\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eI plan to backport the fix on Saturday.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13113232_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13113232_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/11 07:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-23T07:53:40+0000\'\u003e23\\/Sep\\/11 07:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Tests ran cleanly on 10.8 (with the fixed merged from trunk), with the exception of this error in testConcurrentInvalidation(org.apache.derbyTesting.functionTests.tests.lang.TruncateTableTest): \\nHelper thread failed \\n... \\nFri Sep 23 01:19:36 CEST 2011 Thread &#91;DRDAConnThread_77,5,derby.daemons&#93;  (XID = 24553), (SESSIONID = 31), (DATABASE = dbsqlauth), (DRDAID = \\uFFFD\\uFFFD\\uFFFD\\uFFFD\\uFFFD\\uFFFD\\uFFFD\\uFFFD.\\uFFFD\\uFFFD-808957766332849398 \\n{3}\\n ), Failed Statement is: select * from d4275 \\nERROR XSAI2: The conglomerate (4,448) requested does not exist. \\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286) \\n        at org.apache.derby.impl.store.access.heap.HeapConglomerateFactory.readConglomerate(HeapConglomerateFactory.java:254) \\n        at org.apache.derby.impl.store.access.RAMAccessManager.conglomCacheFind(RAMAccessManager.java:482) \\n        at org.apache.derby.impl.store.access.RAMTransaction.findExistingConglomerate(RAMTransaction.java:394) \\n        at org.apache.derby.impl.store.access.RAMTransaction.getDynamicCompiledConglomInfo(RAMTransaction.java:692) \\n        at org.apache.derby.impl.sql.execute.TableScanResultSet.openCore(TableScanResultSet.java:245) \\n        at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.openCore(BulkTableScanResultSet.java:248) \\n        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(BasicNoPutResultSetImpl.java:255) \\n        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436) \\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317) \\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242) \\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1686) \\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(EmbedPreparedStatement.java:1341) \\n        at org.apache.derby.impl.drda.DRDAStatement.execute(DRDAStatement.java:706) \\n        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:866) \\n        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:295) \\nCleanup action completed \\n\\n\\n I plan to backport the fix on Saturday.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13113813\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13113813&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13113813\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13113813_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13113813_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/11 22:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-23T22:28:24+0000\'\u003e23\\/Sep\\/11 22:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ei reviewed the latest patch and it looks good to me.  I agree that overhead should be basically \\\"free\\\" now with the code working off the\u003cbr\\/\u003e\\nstored conglomerate info and not having to recalculate it.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt is great that your test case both tries the newly created conglomerate and shuts down the database and restarts testing the read conglomerate\u003cbr\\/\u003e\\nfrom disk case.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13113813_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13113813_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/11 22:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-23T22:28:24+0000\'\u003e23\\/Sep\\/11 22:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    i reviewed the latest patch and it looks good to me.  I agree that overhead should be basically \\\"free\\\" now with the code working off the \\nstored conglomerate info and not having to recalculate it. \\n\\n It is great that your test case both tries the newly created conglomerate and shuts down the database and restarts testing the read conglomerate \\nfrom disk case. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13113985\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13113985&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13113985\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13113985_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13113985_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/11 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-24T14:24:26+0000\'\u003e24\\/Sep\\/11 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted to 10.8 with revision 1175171 (the fix went in with revision 1174436 on trunk).\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t expect more work on this issue now, but there seems to be related work in this area of Derby.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13113985_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13113985_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/11 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-24T14:24:26+0000\'\u003e24\\/Sep\\/11 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed to 10.8 with revision 1175171 (the fix went in with revision 1174436 on trunk). \\n\\n I don\'t expect more work on this issue now, but there seems to be related work in this area of Derby.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13685174\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5367?focusedCommentId=13685174&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13685174\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13685174_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13685174_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jun\\/13 09:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-06-17T09:19:15+0000\'\u003e17\\/Jun\\/13 09:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;bulk update&#93;\u003c\\/span\u003e Close all resolved issues that haven\'t been updated for more than one year.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13685174_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13685174_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jun\\/13 09:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-06-17T09:19:15+0000\'\u003e17\\/Jun\\/13 09:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;bulk update&#93;  Close all resolved issues that haven\'t been updated for more than one year.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520240304921"> 
    <input type="hidden" title="jira.request.server.time" value="201"> 
    <input type="hidden" title="jira.request.id" value="538x94420148x12"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="10"> 
    <input type="hidden" title="db.reads.time.in.ms" value="29"> 
    <input type="hidden" title="db.conns.time.in.ms" value="34"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 538x94420148x12
	          REQUEST TIMESTAMP : [05/Mar/2018:08:58:24 +0000]
	               REQUEST TIME : 0.2010
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 10

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=17, elapsedTotal=29465878, elapsedMin=516399, elapsedMax=12552546, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=21, elapsedTotal=34664024, elapsedMin=380977, elapsedMax=12590623, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>