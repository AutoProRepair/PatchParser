<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|10dec49aa030490e71c74d605064547a7234ddaa|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"115ee78b778f55\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-6879"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-6879] Engine deadlock between XA timeout handling and cleanupOnError - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-6879] Engine deadlock between XA timeout handling and cleanupOnError - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-6879">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-6879" href="/jira/browse/DERBY-6879" id="key-val" rel="12954263">DERBY-6879</a></li>
                </ol>
                <h1 id="summary-val">Engine deadlock between XA timeout handling and cleanupOnError</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-6879"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-6879/DERBY-6879.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-6879/DERBY-6879.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-6879/DERBY-6879.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-6879/DERBY-6879.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.10.2.0 candidate for Second release for 10.10 branch">10.10.2.0</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.13.1.0" title="10.13.1.0 Candidate for 10.13 release, not released">10.13.1.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+Services" title="Services ">Services</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12954263-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     Solaris 10.5 on Oracle M5000 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310200" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bug behavior facts" class="name">Bug behavior facts:</strong> 
                      <div id="customfield_12310200-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310200-field"> 
                        <span>Crash</span>, 
                        <span>Data corruption</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310250" class="item"> 
                     <div class="wrap"> 
                      <strong title="Flags" class="name">Flags:</strong> 
                      <div id="customfield_12310250-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310250-field"> 
                        <span>Patch</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Deadlock between XA timer cleanup task and the ContextManager.cleanupOnError</p> 
                  <p>Found one Java-level deadlock:<br> =============================<br> "DRDAConnThread_34":<br> waiting to lock monitor 0x0000000104b14d18 (object 0xfffffffd9090f058, a org.apache.derby.jdbc.XATransactionState),<br> which is held by "Timer-0"<br> "Timer-0":<br> waiting to lock monitor 0x00000001038b96e8 (object 0xfffffffd9090d8b0, a org.apache.derby.impl.jdbc.EmbedConnection40),<br> which is held by "DRDAConnThread_34"</p> 
                  <p>Java stack information for the threads listed above:<br> ===================================================<br> "DRDAConnThread_34":<br> at org.apache.derby.jdbc.XATransactionState.cleanupOnError(Unknown Source)</p> 
                  <ul class="alternate" type="square"> 
                   <li>waiting to lock &lt;0xfffffffd9090f058&gt; (a org.apache.derby.jdbc.XATransactionState)<br> at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(Unknown Source)<br> at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(Unknown Source)<br> at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)<br> at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)<br> at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)<br> at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)</li> 
                   <li>locked &lt;0xfffffffd9090d8b0&gt; (a org.apache.derby.impl.jdbc.EmbedConnection40)<br> at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)<br> at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source)<br> at org.apache.derby.iapi.jdbc.BrokeredPreparedStatement.execute(Unknown Source)<br> at org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source)<br> at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTTobjects(Unknown Source)<br> at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTT(Unknown Source)<br> at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)<br> at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)<br> "Timer-0":<br> at org.apache.derby.impl.jdbc.EmbedConnection.xa_rollback(Unknown Source)</li> 
                   <li>waiting to lock &lt;0xfffffffd9090d8b0&gt; (a org.apache.derby.impl.jdbc.EmbedConnection40)<br> at org.apache.derby.jdbc.XATransactionState.cancel(Unknown Source)</li> 
                   <li>locked &lt;0xfffffffd9090f058&gt; (a org.apache.derby.jdbc.XATransactionState)<br> at org.apache.derby.jdbc.XATransactionState$CancelXATransactionTask.run(Unknown Source)<br> at java.util.TimerThread.mainLoop(Timer.java:555)<br> at java.util.TimerThread.run(Timer.java:505)</li> 
                  </ul> 
                  <p>Found 1 deadlock.</p> 
                  <p>This deadlock caused Derby to create 18000 transaction recovery logs because of the XA transaction that did not cleanup in the timeout. Rebooting the system would cause a 50 hour boot up time to process the transaction logs so recovery had to be done by going to a backup database before the issue occurred.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-6879?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-6879?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-6879?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-6879?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12816294" data-issue-id="12954263" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12816294/derby-6879-2016-07-05.diff" draggable="true" data-downloadurl="application/octet-stream:derby-6879-2016-07-05.diff:https://issues.apache.org/jira/secure/attachment/12816294/derby-6879-2016-07-05.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12816294/derby-6879-2016-07-05.diff" title="Latest  05/Jul/16 20:34 - Brett Bergquist" draggable="true" data-downloadurl="application/octet-stream:derby-6879-2016-07-05.diff:https://issues.apache.org/jira/secure/attachment/12816294/derby-6879-2016-07-05.diff">derby-6879-2016-07-05.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-07-05T20:34:38.851Z">05/Jul/16 20:34</time>
                   </dd>
                   <dd class="attachment-size">
                    29 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12816821" data-issue-id="12954263" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12816821/derby-6879-2016-07-08.diff" draggable="true" data-downloadurl="application/octet-stream:derby-6879-2016-07-08.diff:https://issues.apache.org/jira/secure/attachment/12816821/derby-6879-2016-07-08.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12816821/derby-6879-2016-07-08.diff" title="Latest  08/Jul/16 13:18 - Brett Bergquist" draggable="true" data-downloadurl="application/octet-stream:derby-6879-2016-07-08.diff:https://issues.apache.org/jira/secure/attachment/12816821/derby-6879-2016-07-08.diff">derby-6879-2016-07-08.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-07-08T13:18:15.267Z">08/Jul/16 13:18</time>
                   </dd>
                   <dd class="attachment-size">
                    29 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12818485" data-issue-id="12954263" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12818485/derby-6879-2016-07-17.diff" draggable="true" data-downloadurl="application/octet-stream:derby-6879-2016-07-17.diff:https://issues.apache.org/jira/secure/attachment/12818485/derby-6879-2016-07-17.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12818485/derby-6879-2016-07-17.diff" title="Latest  18/Jul/16 00:49 - Brett Bergquist" draggable="true" data-downloadurl="application/octet-stream:derby-6879-2016-07-17.diff:https://issues.apache.org/jira/secure/attachment/12818485/derby-6879-2016-07-17.diff">derby-6879-2016-07-17.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-07-18T00:49:56.548Z">18/Jul/16 00:49</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12813568" data-issue-id="12954263" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12813568/derby-6879-test.diff" draggable="true" data-downloadurl="application/octet-stream:derby-6879-test.diff:https://issues.apache.org/jira/secure/attachment/12813568/derby-6879-test.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12813568/derby-6879-test.diff" title="Latest  26/Jun/16 19:24 - Brett Bergquist" draggable="true" data-downloadurl="application/octet-stream:derby-6879-test.diff:https://issues.apache.org/jira/secure/attachment/12813568/derby-6879-test.diff">derby-6879-test.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-06-26T19:24:13.747Z">26/Jun/16 19:24</time>
                   </dd>
                   <dd class="attachment-size">
                    24 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12818713" data-issue-id="12954263" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12818713/diff-0717-ignore-whitespace.diff" draggable="true" data-downloadurl="text/x-patch:diff-0717-ignore-whitespace.diff:https://issues.apache.org/jira/secure/attachment/12818713/diff-0717-ignore-whitespace.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12818713/diff-0717-ignore-whitespace.diff" title="Latest  19/Jul/16 00:16 - Bryan Pendleton" draggable="true" data-downloadurl="text/x-patch:diff-0717-ignore-whitespace.diff:https://issues.apache.org/jira/secure/attachment/12818713/diff-0717-ignore-whitespace.diff">diff-0717-ignore-whitespace.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-07-19T00:16:06.642Z">19/Jul/16 00:16</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12816295" data-issue-id="12954263" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12816295/svnstatus.txt" draggable="true" data-downloadurl="text/plain:svnstatus.txt:https://issues.apache.org/jira/secure/attachment/12816295/svnstatus.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12816295/svnstatus.txt" title="Latest  05/Jul/16 20:34 - Brett Bergquist" draggable="true" data-downloadurl="text/plain:svnstatus.txt:https://issues.apache.org/jira/secure/attachment/12816295/svnstatus.txt">svnstatus.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-07-05T20:34:38.856Z">05/Jul/16 20:34</time>
                   </dd>
                   <dd class="attachment-size">
                    0.4 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12818415" data-issue-id="12954263" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12818415/testFail.zip" draggable="true" data-downloadurl="application/zip:testFail.zip:https://issues.apache.org/jira/secure/attachment/12818415/testFail.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-zip" title="Zip Archive"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12818415/testFail.zip" title="Latest  16/Jul/16 18:28 - Bryan Pendleton" draggable="true" data-downloadurl="application/zip:testFail.zip:https://issues.apache.org/jira/secure/attachment/12818415/testFail.zip">testFail.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-07-16T18:28:39.585Z">16/Jul/16 18:28</time>
                   </dd>
                   <dd class="attachment-size">
                    455 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_bbergquist" rel="bbergquist" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Brett Bergquist&quot;,&quot;emailAddress&quot;:&quot;brett@thebergquistfamily.com&quot;,&quot;username&quot;:&quot;bbergquist&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="bbergquist"></span></span> Brett Bergquist </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_bbergquist" rel="bbergquist" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Brett Bergquist&quot;,&quot;emailAddress&quot;:&quot;brett@thebergquistfamily.com&quot;,&quot;username&quot;:&quot;bbergquist&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="bbergquist"></span></span> Brett Bergquist </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">4</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="29/Mar/16 11:04"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-03-29T11:04:08+0000">29/Mar/16 11:04</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="09/Aug/16 00:04"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-08-09T00:04:33+0000">09/Aug/16 00:04</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="09/Aug/16 00:04"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-08-09T00:04:32+0000">09/Aug/16 00:04</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-6879?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-6879?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-15215851\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15215851&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15215851\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15215851_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15215851_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 11:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T11:07:11+0000\'\u003e29\\/Mar\\/16 11:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am examining the locking pattern to determine a different locking pattern to eliminate the deadlock.  Initially it looks like the timer task should grab the lock on the connection before locking the XATransactionState.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15215851_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15215851_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 11:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T11:07:11+0000\'\u003e29\\/Mar\\/16 11:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am examining the locking pattern to determine a different locking pattern to eliminate the deadlock.  Initially it looks like the timer task should grab the lock on the connection before locking the XATransactionState. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15342733\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15342733&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15342733\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15342733_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15342733_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jun\\/16 21:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-21T21:19:05+0000\'\u003e21\\/Jun\\/16 21:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIn XATransactionState.java, we have:\u003c\\/p\u003e\\n\\n\u003cp\u003e        \\/**\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eRuns the cancel task of the global transaction\u003cbr\\/\u003e\\n         *\\/\u003cbr\\/\u003e\\n        public void run() \\n\u003cdiv class=\\\"error\\\"\u003e\u003cspan class=\\\"error\\\"\u003eUnknown macro: {            try {\\n                    xaState.cancel(MessageId.CONN_XA_TRANSACTION_TIMED_OUT);\\n            } catch (Throwable th) {\\n                Monitor.logThrowable(th);\\n            }\u003cbr\\/\u003e\\n        }\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nand the \\\"cancel\\\" method looks like:\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n    synchronized void cancel(String messageId) throws XAException {\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\n            try {\\n                conn.xa_rollback();\\n            } catch (SQLException sqle) {\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nand the \\\"xa_rollback\\\" method looks like:\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n\\tpublic final void xa_rollback() throws SQLException {\u003cbr\\/\u003e\\n\\t\\tsynchronized (getConnectionSynchronization())\u003cbr\\/\u003e\\n\\t\\t{\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nSo when the timer expires, the lock pattern is to lock the XATransactionState and then the EmbedConnection object.   \u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nWhen an exception such as a lock timeout occurs when using a XA transaction and cleanupOnError code is called, the call stack looks like:\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n\\\"DRDAConnThread_3\\\" #15 prio=5 os_prio=64 tid=0x0000000103d5b000 nid=0x19 waiting for monitor entry \u003cspan class=\\\"error\\\"\u003e&#91;0xffffffff1a9fe000&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\n   java.lang.Thread.State: BLOCKED (on object monitor)\u003cbr\\/\u003e\\n\\tat org.apache.derby.jdbc.XATransactionState.cleanupOnError(XATransactionState.java:155)\u003cbr\\/\u003e\\n\\t- waiting to lock &lt;0xffffffff4d0aead8&gt; (a org.apache.derby.jdbc.XATransactionState)\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:343)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:461)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:344)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2400)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:85)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1437)\u003cbr\\/\u003e\\n\\t- locked &lt;0xffffffff4d01b698&gt; (a org.apache.derby.impl.jdbc.EmbedConnection40)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:711)\u003cbr\\/\u003e\\n\\t- locked &lt;0xffffffff4d01b698&gt; (a org.apache.derby.impl.jdbc.EmbedConnection40)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeLargeUpdate(EmbedStatement.java:190)\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.jdbc.BrokeredStatement.executeLargeUpdate(BrokeredStatement.java:633)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThread.java:5393)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:759)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:295)\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nSo here the lock pattern is locking the EmbedConnection40 (which is an EmbedConnection) and then the XATransactionState.   \u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nSo we have just the opposite pattern and a deadlock occurs.   \u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nI have been able to get this to reproduce in a test application.   Using a normal non-XA connection, I query and lock many (10000) rows in a large table.   Using a separate XA connection, I try to delete those same rows.  I have \\\"derby.jdbc.xaTransactionTimeout=30\\\" in my derby.properties to have a very short transaction timeout.  I have the \\\"derby.locks.waitTimeout=60\\\" in my derby.properties.\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nWhen I run the test application, it locks up the 10000 rows in one transaction that is not committed through the first non-XA connection.   The second XA connection tries to delete these rows.  Since the \\\"derby.jdbc.xaTransactionTimeout\\\" is 30 seconds, the XA transaction is going to timeout at 30 seconds, but the \\\"derby.locks.waitTimeout\\\" is going to cause the XA transaction to try wait for 60 seconds to obtain the locks that it needs. \u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nThe timeout of the XA transaction is going to cause a SQLTransactionRollbackException to be recognized on the XA connection and it will try to then call the cleanup code.   But alas, the EmbedConnection is locked and it will try to lock the XATransactionState in the cleanup code and the XATransactionState is lock in the timeout task and will attempt to call \\\"xa_rollback\\\" on the XA connection.  Deadlock.\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nI have a simple workaround and that is to change\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n        \\/**\u003cbr\\/\u003e\\n         * Runs the cancel task of the global transaction\u003cbr\\/\u003e\\n         *\\/\u003cbr\\/\u003e\\n        public void run() {\u003cbr\\/\u003e\\n            try {                    xaState.cancel(MessageId.CONN_XA_TRANSACTION_TIMED_OUT);            } catch (Throwable th) {\\n                Monitor.logThrowable(th);\\n            }\u003cbr\\/\u003e\\n        }\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nto\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n        public void run() {\u003cbr\\/\u003e\\n            try {\u003cbr\\/\u003e\\n                synchronized (xaState.conn) {\\n                    xaState.cancel(MessageId.CONN_XA_TRANSACTION_TIMED_OUT);\\n                }\u003cbr\\/\u003e\\n            } catch (Throwable th) {                Monitor.logThrowable(th);            }        }\u003c\\/span\u003e \u003c\\/div\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThis changes the timeout task to first lock on the connection and then XATransactionState.   \u003c\\/p\u003e\\n\\n\u003cp\u003eI would actually prefer to somehow add a new method to \\\"EmbedConnection\\\" that would acquire its lock which would then call back into XATransactionState.cancel to perform the cancel which would also change the lock pattern, but I am struggling to find out how to get from an EmbedConnection back to the XATransactionState.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15342733_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15342733_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jun\\/16 21:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-21T21:19:05+0000\'\u003e21\\/Jun\\/16 21:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    In XATransactionState.java, we have: \\n\\n         \\/** \\n \\n\\t Runs the cancel task of the global transaction \\n         *\\/ \\n        public void run() \\n  Unknown macro: {            try {\\n                    xaState.cancel(MessageId.CONN_XA_TRANSACTION_TIMED_OUT);\\n            } catch (Throwable th) {\\n                Monitor.logThrowable(th);\\n            } \\n        } \\n \\nand the \\\"cancel\\\" method looks like: \\n \\n    synchronized void cancel(String messageId) throws XAException { \\n... \\n            try {\\n                conn.xa_rollback();\\n            } catch (SQLException sqle) { \\n \\nand the \\\"xa_rollback\\\" method looks like: \\n \\n\\tpublic final void xa_rollback() throws SQLException { \\n\\t\\tsynchronized (getConnectionSynchronization()) \\n\\t\\t{ \\n \\nSo when the timer expires, the lock pattern is to lock the XATransactionState and then the EmbedConnection object.    \\n \\nWhen an exception such as a lock timeout occurs when using a XA transaction and cleanupOnError code is called, the call stack looks like: \\n \\n\\\"DRDAConnThread_3\\\" #15 prio=5 os_prio=64 tid=0x0000000103d5b000 nid=0x19 waiting for monitor entry  &#91;0xffffffff1a9fe000&#93;  \\n   java.lang.Thread.State: BLOCKED (on object monitor) \\n\\tat org.apache.derby.jdbc.XATransactionState.cleanupOnError(XATransactionState.java:155) \\n\\t- waiting to lock &lt;0xffffffff4d0aead8&gt; (a org.apache.derby.jdbc.XATransactionState) \\n\\tat org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:343) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:461) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:344) \\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2400) \\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:85) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1437) \\n\\t- locked &lt;0xffffffff4d01b698&gt; (a org.apache.derby.impl.jdbc.EmbedConnection40) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:711) \\n\\t- locked &lt;0xffffffff4d01b698&gt; (a org.apache.derby.impl.jdbc.EmbedConnection40) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeLargeUpdate(EmbedStatement.java:190) \\n\\tat org.apache.derby.iapi.jdbc.BrokeredStatement.executeLargeUpdate(BrokeredStatement.java:633) \\n\\tat org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThread.java:5393) \\n\\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:759) \\n\\tat org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:295) \\n \\nSo here the lock pattern is locking the EmbedConnection40 (which is an EmbedConnection) and then the XATransactionState.    \\n \\nSo we have just the opposite pattern and a deadlock occurs.    \\n \\nI have been able to get this to reproduce in a test application.   Using a normal non-XA connection, I query and lock many (10000) rows in a large table.   Using a separate XA connection, I try to delete those same rows.  I have \\\"derby.jdbc.xaTransactionTimeout=30\\\" in my derby.properties to have a very short transaction timeout.  I have the \\\"derby.locks.waitTimeout=60\\\" in my derby.properties. \\n \\nWhen I run the test application, it locks up the 10000 rows in one transaction that is not committed through the first non-XA connection.   The second XA connection tries to delete these rows.  Since the \\\"derby.jdbc.xaTransactionTimeout\\\" is 30 seconds, the XA transaction is going to timeout at 30 seconds, but the \\\"derby.locks.waitTimeout\\\" is going to cause the XA transaction to try wait for 60 seconds to obtain the locks that it needs.  \\n \\nThe timeout of the XA transaction is going to cause a SQLTransactionRollbackException to be recognized on the XA connection and it will try to then call the cleanup code.   But alas, the EmbedConnection is locked and it will try to lock the XATransactionState in the cleanup code and the XATransactionState is lock in the timeout task and will attempt to call \\\"xa_rollback\\\" on the XA connection.  Deadlock. \\n \\nI have a simple workaround and that is to change \\n \\n        \\/** \\n         * Runs the cancel task of the global transaction \\n         *\\/ \\n        public void run() { \\n            try {                    xaState.cancel(MessageId.CONN_XA_TRANSACTION_TIMED_OUT);            } catch (Throwable th) {\\n                Monitor.logThrowable(th);\\n            } \\n        } \\n \\nto \\n \\n        public void run() { \\n            try { \\n                synchronized (xaState.conn) {\\n                    xaState.cancel(MessageId.CONN_XA_TRANSACTION_TIMED_OUT);\\n                } \\n            } catch (Throwable th) {                Monitor.logThrowable(th);            }        }    \\n \\n\\n\\n This changes the timeout task to first lock on the connection and then XATransactionState.    \\n\\n I would actually prefer to somehow add a new method to \\\"EmbedConnection\\\" that would acquire its lock which would then call back into XATransactionState.cancel to perform the cancel which would also change the lock pattern, but I am struggling to find out how to get from an EmbedConnection back to the XATransactionState. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15345486\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15345486&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15345486\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15345486_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15345486_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/16 00:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-23T00:39:06+0000\'\u003e23\\/Jun\\/16 00:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Brett, thanks for all the time and effort on this!\u003c\\/p\u003e\\n\\n\u003cp\u003eThe evidence seems indisputable, and your analysis and explanation seem airtight.\u003c\\/p\u003e\\n\\n\u003cp\u003eI agree with your conclusion that CancelXATransactionTask.run needs to lock the\u003cbr\\/\u003e\\nconnection before it calls the xaState.cancel method.\u003c\\/p\u003e\\n\\n\u003cp\u003eI guess that your remaining questions boil down to:\u003cbr\\/\u003e\\n1) How can we clean up the proposed change so that the locking on the connection\u003cbr\\/\u003e\\nis a bit more elegantly encapsulated in the EmbedConnection class, and\u003cbr\\/\u003e\\n2) How can we wrap all this up to get it committed\u003c\\/p\u003e\\n\\n\u003cp\u003eTaking the second question first, it seems like your testing approach is a pretty\u003cbr\\/\u003e\\ngood one. Is it conceivable that you could package that up as a new test case\u003cbr\\/\u003e\\nfor the existing XA suites? Perhaps lowering the lock timeout so that the\u003cbr\\/\u003e\\ntest runs slightly faster?\u003c\\/p\u003e\\n\\n\u003cp\u003eW.r.t. the coding aspect of expressing the synchronization point, would it\u003cbr\\/\u003e\\nhelp to provide a new interface here?\u003c\\/p\u003e\\n\\n\u003cp\u003eFor example, could we make a \\\"Cancelable\\\" interface, with a single method\u003cbr\\/\u003e\\nnamed \\\"cancel( MessageId msg )\\\". Then we could make XATransactionState\u003cbr\\/\u003e\\nimplement Cancelable, and we could add a new method to EmbedConnection\u003cbr\\/\u003e\\nalong the lines of:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e void cancel( Canceable c, MessageId m ) {\\n        c.cancel( m );\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eand then CancelXATransactionTask.run turns into\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e void run() {\\n        \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n            xaState.conn.cancel( xaState, MessageId.CONN_XA_TRANSACTION_TIMED_OUT ); \\n        } \u003cspan class=\\\"code-keyword\\\"\u003ecatch\u003c\\/span\u003e ( Throwable th ) { Monitor.logThrowable(th); }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI hope this is all making (some) sense.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15345486_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15345486_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/16 00:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-23T00:39:06+0000\'\u003e23\\/Jun\\/16 00:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Brett, thanks for all the time and effort on this! \\n\\n The evidence seems indisputable, and your analysis and explanation seem airtight. \\n\\n I agree with your conclusion that CancelXATransactionTask.run needs to lock the \\nconnection before it calls the xaState.cancel method. \\n\\n I guess that your remaining questions boil down to: \\n1) How can we clean up the proposed change so that the locking on the connection \\nis a bit more elegantly encapsulated in the EmbedConnection class, and \\n2) How can we wrap all this up to get it committed \\n\\n Taking the second question first, it seems like your testing approach is a pretty \\ngood one. Is it conceivable that you could package that up as a new test case \\nfor the existing XA suites? Perhaps lowering the lock timeout so that the \\ntest runs slightly faster? \\n\\n W.r.t. the coding aspect of expressing the synchronization point, would it \\nhelp to provide a new interface here? \\n\\n For example, could we make a \\\"Cancelable\\\" interface, with a single method \\nnamed \\\"cancel( MessageId msg )\\\". Then we could make XATransactionState \\nimplement Cancelable, and we could add a new method to EmbedConnection \\nalong the lines of: \\n  \\n      synchronized  void cancel( Canceable c, MessageId m ) {\\n        c.cancel( m );\\n    }\\n \\n  \\n and then CancelXATransactionTask.run turns into \\n  \\n      public  void run() {\\n         try  {\\n            xaState.conn.cancel( xaState, MessageId.CONN_XA_TRANSACTION_TIMED_OUT ); \\n        }  catch  ( Throwable th ) { Monitor.logThrowable(th); }\\n \\n  \\n\\n I hope this is all making (some) sense.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15346247\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15346247&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15346247\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15346247_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15346247_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/16 10:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-23T10:44:01+0000\'\u003e23\\/Jun\\/16 10:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI like your suggestion for the Cancelable which \\\"feels\\\" right in having the control be from the Embed connection.  I will pursue that.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs for testing, the condition can be replicated simply and quickly:\u003c\\/p\u003e\\n\\n\u003cp\u003e1. Set the \\\"derby.locks.waitTimeout\\\" so some value.\u003cbr\\/\u003e\\n2. Set the \\\"derby.jdbc.xaTransactionTimeout\\\" to a value less than \\\"derby.locks.waitTimeout\\\" (in my last test, I used 60 second and 30 seconds but these could easily be 20 seconds and 10 seconds).\u003cbr\\/\u003e\\n3. Lock a table exclusively in one statement with autoCommit disabled using a non-XA connection\u003cbr\\/\u003e\\n4. Try to lock the same table exclusively with another statement using a XA connection\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat I am having trouble with is detecting the actual Java deadlock.   Normally I use \\\"jstack\\\" to determine such.  I looked through the test cases and don\'t see any such usage but may have missed it.  Any ideas in this area for the test case will be appreciated.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15346247_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15346247_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/16 10:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-23T10:44:01+0000\'\u003e23\\/Jun\\/16 10:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I like your suggestion for the Cancelable which \\\"feels\\\" right in having the control be from the Embed connection.  I will pursue that. \\n\\n As for testing, the condition can be replicated simply and quickly: \\n\\n 1. Set the \\\"derby.locks.waitTimeout\\\" so some value. \\n2. Set the \\\"derby.jdbc.xaTransactionTimeout\\\" to a value less than \\\"derby.locks.waitTimeout\\\" (in my last test, I used 60 second and 30 seconds but these could easily be 20 seconds and 10 seconds). \\n3. Lock a table exclusively in one statement with autoCommit disabled using a non-XA connection \\n4. Try to lock the same table exclusively with another statement using a XA connection \\n\\n What I am having trouble with is detecting the actual Java deadlock.   Normally I use \\\"jstack\\\" to determine such.  I looked through the test cases and don\'t see any such usage but may have missed it.  Any ideas in this area for the test case will be appreciated. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15346607\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15346607&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15346607\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15346607_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15346607_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/16 15:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-23T15:26:49+0000\'\u003e23\\/Jun\\/16 15:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think I can write up a test using the capability in the ThreadMXBean.  This has the ability to look for deadlocks.  I am looking at the current tests to see how this might be done.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15346607_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15346607_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/16 15:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-23T15:26:49+0000\'\u003e23\\/Jun\\/16 15:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think I can write up a test using the capability in the ThreadMXBean.  This has the ability to look for deadlocks.  I am looking at the current tests to see how this might be done.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15347036\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15347036&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15347036\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15347036_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15347036_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/16 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-23T19:35:14+0000\'\u003e23\\/Jun\\/16 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Brett Bergquist - 27\\/Jun\\/16 00:02\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am questioning if this is the final correct answer.  In this one case, the cleanUpOnError is being called by connection that is executing a statement so the locking is connection and then XATransactionState.  When a timeout occurs, the locking is XATransactionState and then the connection.  When both occur at the same time the deadlock occurs.  My proposed fix handles this situation.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere is other possibilities.   So for example, code calls XAResource.commit.   This has the locking pattern of XATransactionState and then  connection.   So if the timeout were to occur during this time, then there would now be a deadlock here because the proposed solution is going to lock the connection and then the XATransacttionState.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe original deadlock problem can only occur if the XATransactionState.cleanupOnError is called while the connection is locked and executing and a cleanup needs to be performed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15347036_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15347036_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/16 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-23T19:35:14+0000\'\u003e23\\/Jun\\/16 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Brett Bergquist - 27\\/Jun\\/16 00:02\\\"\u003eedited\u003c\\/span\u003e                   I am questioning if this is the final correct answer.  In this one case, the cleanUpOnError is being called by connection that is executing a statement so the locking is connection and then XATransactionState.  When a timeout occurs, the locking is XATransactionState and then the connection.  When both occur at the same time the deadlock occurs.  My proposed fix handles this situation. \\n\\n There is other possibilities.   So for example, code calls XAResource.commit.   This has the locking pattern of XATransactionState and then  connection.   So if the timeout were to occur during this time, then there would now be a deadlock here because the proposed solution is going to lock the connection and then the XATransacttionState. \\n\\n The original deadlock problem can only occur if the XATransactionState.cleanupOnError is called while the connection is locked and executing and a cleanup needs to be performed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15350206\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15350206&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15350206\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15350206_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350206_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/16 19:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-26T19:24:13+0000\'\u003e26\\/Jun\\/16 19:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is a patch that adds a test for this issue.  Once the test is applied, then the XATest suite will fail as the added test will trigger a Java level deadlock in Derby. \u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch also adds a DeadlockWatchdog.java class that is used by the new test to detect the Java level deadlock and exit the test using System.exit(1) so that the test run does not hang.\u003c\\/p\u003e\\n\\n\u003cp\u003eOnce \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-6879\\\" title=\\\"Engine deadlock between XA timeout handling and cleanupOnError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-6879\\\"\u003e\u003cdel\u003eDERBY-6879\u003c\\/del\u003e\u003c\\/a\u003e is fixed then the deadlock will no longer occur and the XATest suite will pass.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15350206_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350206_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/16 19:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-26T19:24:13+0000\'\u003e26\\/Jun\\/16 19:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is a patch that adds a test for this issue.  Once the test is applied, then the XATest suite will fail as the added test will trigger a Java level deadlock in Derby.  \\n\\n The patch also adds a DeadlockWatchdog.java class that is used by the new test to detect the Java level deadlock and exit the test using System.exit(1) so that the test run does not hang. \\n\\n Once   DERBY-6879   is fixed then the deadlock will no longer occur and the XATest suite will pass.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15350236\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15350236&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15350236\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15350236_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350236_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/16 20:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-26T20:54:32+0000\'\u003e26\\/Jun\\/16 20:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI downloaded and applied the patch successfully, and tried running XATest. Here\'s what I see:\u003c\\/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003ejunit-single:\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Running org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Watchdog failed: java.security.AccessControlException: access denied\u003cbr\\/\u003e\\n (\\\"java.lang.management.ManagementPermission\\\" \\\"monitor\\\")\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Running org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0 sec\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Test org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest FAILED (crashed)\u003c\\/p\u003e\u003c\\/blockquote\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15350236_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350236_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/16 20:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-26T20:54:32+0000\'\u003e26\\/Jun\\/16 20:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I downloaded and applied the patch successfully, and tried running XATest. Here\'s what I see: \\n \\n junit-single: \\n     &#91;junit&#93;  Running org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest \\n     &#91;junit&#93;  Watchdog failed: java.security.AccessControlException: access denied \\n (\\\"java.lang.management.ManagementPermission\\\" \\\"monitor\\\") \\n     &#91;junit&#93;  Running org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest \\n     &#91;junit&#93;  Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0 sec \\n     &#91;junit&#93;  Test org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest FAILED (crashed)               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15350269\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15350269&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15350269\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15350269_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350269_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/16 22:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-26T22:04:13+0000\'\u003e26\\/Jun\\/16 22:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBrian I just downloaded the trunk fresh on my Mac (I developed the patch on Windows 7) and downloaded and applied the patch and ran:\u003c\\/p\u003e\\n\\n\u003cp\u003eant -Dderby.junit.testclass=org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest junit-clean all buildjars junit-single junit-html\u003c\\/p\u003e\\n\\n\u003cp\u003eand it worked for me.  This is the tail end of that run:\u003c\\/p\u003e\\n\\n\u003cp\u003e...\u003cbr\\/\u003e\\njunit-single:\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Running org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Deadlock detected\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Running org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0 sec\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Test org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest FAILED (crashed)\u003c\\/p\u003e\\n\\n\u003cp\u003ejunit-init-nocp:\u003c\\/p\u003e\\n\\n\u003cp\u003ejunit-init:\u003c\\/p\u003e\\n\\n\u003cp\u003eemit-junit-classpath-jars:\u003cbr\\/\u003e\\n     \u003cspan class=\\\"error\\\"\u003e&#91;echo&#93;\u003c\\/span\u003e Running with jars: \\/Users\\/brett\\/Development\\/svn\\/derby\\/trunk\\/jars\\/sane\u003cbr\\/\u003e\\n     \u003cspan class=\\\"error\\\"\u003e&#91;echo&#93;\u003c\\/span\u003e CLASSPATH (environment variable): ${env.CLASSPATH}\u003c\\/p\u003e\\n\\n\u003cp\u003eemit-junit-classpath:\u003c\\/p\u003e\\n\\n\u003cp\u003ejunit-sysinfo:\u003c\\/p\u003e\\n\\n\u003cp\u003ejunit-html:\u003c\\/p\u003e\\n\\n\u003cp\u003e...\u003c\\/p\u003e\\n\\n\u003cp\u003eSo maybe there is an environmental issue.  I am using\u003c\\/p\u003e\\n\\n\u003cp\u003eBretts-MacBook-Pro:trunk brett$ java -version\u003cbr\\/\u003e\\njava version \\\"1.8.0_92\\\"\u003cbr\\/\u003e\\nJava(TM) SE Runtime Environment (build 1.8.0_92-b14)\u003cbr\\/\u003e\\nJava HotSpot(TM) 64-Bit Server VM (build 25.92-b14, mixed mode)\u003cbr\\/\u003e\\nBretts-MacBook-Pro:trunk brett$ \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15350269_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350269_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/16 22:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-26T22:04:13+0000\'\u003e26\\/Jun\\/16 22:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Brian I just downloaded the trunk fresh on my Mac (I developed the patch on Windows 7) and downloaded and applied the patch and ran: \\n\\n ant -Dderby.junit.testclass=org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest junit-clean all buildjars junit-single junit-html \\n\\n and it worked for me.  This is the tail end of that run: \\n\\n ... \\njunit-single: \\n     &#91;junit&#93;  Running org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest \\n     &#91;junit&#93;  Deadlock detected \\n     &#91;junit&#93;  Running org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest \\n     &#91;junit&#93;  Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0 sec \\n     &#91;junit&#93;  Test org.apache.derbyTesting.functionTests.tests.jdbcapi.XATest FAILED (crashed) \\n\\n junit-init-nocp: \\n\\n junit-init: \\n\\n emit-junit-classpath-jars: \\n      &#91;echo&#93;  Running with jars: \\/Users\\/brett\\/Development\\/svn\\/derby\\/trunk\\/jars\\/sane \\n      &#91;echo&#93;  CLASSPATH (environment variable): ${env.CLASSPATH} \\n\\n emit-junit-classpath: \\n\\n junit-sysinfo: \\n\\n junit-html: \\n\\n ... \\n\\n So maybe there is an environmental issue.  I am using \\n\\n Bretts-MacBook-Pro:trunk brett$ java -version \\njava version \\\"1.8.0_92\\\" \\nJava(TM) SE Runtime Environment (build 1.8.0_92-b14) \\nJava HotSpot(TM) 64-Bit Server VM (build 25.92-b14, mixed mode) \\nBretts-MacBook-Pro:trunk brett$  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15350279\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15350279&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15350279\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15350279_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350279_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/16 22:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-26T22:33:24+0000\'\u003e26\\/Jun\\/16 22:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe error that you got is the error that happens without the \u003c\\/p\u003e\\n\\n\u003cp\u003e permission java.lang.management.ManagementPermission \\\"monitor\\\";\u003c\\/p\u003e\\n\\n\u003cp\u003ein \u003c\\/p\u003e\\n\\n\u003cp\u003e.\\/java\\/testing\\/org\\/apache\\/derbyTesting\\/functionTests\\/tests\\/jdbcapi\\/XATest.policy\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15350279_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350279_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/16 22:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-26T22:33:24+0000\'\u003e26\\/Jun\\/16 22:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The error that you got is the error that happens without the  \\n\\n  permission java.lang.management.ManagementPermission \\\"monitor\\\"; \\n\\n in  \\n\\n .\\/java\\/testing\\/org\\/apache\\/derbyTesting\\/functionTests\\/tests\\/jdbcapi\\/XATest.policy              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15350303\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15350303&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15350303\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15350303_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350303_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/16 00:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-27T00:16:06+0000\'\u003e27\\/Jun\\/16 00:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAfter examining the code for quite some time and still not completely understanding the context stack, I believe that the best solution is in XATransactionState to always synchronize on the connection first and then the XATransactionState instance for all of the methods that interact with the connection.  My reasoning is that it will be very difficult to change the locking pattern whereby an EmbedConnection is executing a SQL statement where the connection is synchronized on when executing a statement, and then detects an error and the context stack is processed calling cleanupOnError (which in XATransactionState is going to synchronize on the XATransactionState.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo if that locking pattern cannot be changed, the XATransactionState locking pattern needs to be changed to first synchronize on the connection and then on the XATransactionState.  But all synchronization needs to be changed to that pattern so that another possible deadlock is not introduced.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15350303_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350303_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/16 00:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-27T00:16:06+0000\'\u003e27\\/Jun\\/16 00:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    After examining the code for quite some time and still not completely understanding the context stack, I believe that the best solution is in XATransactionState to always synchronize on the connection first and then the XATransactionState instance for all of the methods that interact with the connection.  My reasoning is that it will be very difficult to change the locking pattern whereby an EmbedConnection is executing a SQL statement where the connection is synchronized on when executing a statement, and then detects an error and the context stack is processed calling cleanupOnError (which in XATransactionState is going to synchronize on the XATransactionState. \\n\\n So if that locking pattern cannot be changed, the XATransactionState locking pattern needs to be changed to first synchronize on the connection and then on the XATransactionState.  But all synchronization needs to be changed to that pattern so that another possible deadlock is not introduced.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15350325\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15350325&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15350325\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15350325_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350325_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/16 01:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-27T01:32:56+0000\'\u003e27\\/Jun\\/16 01:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree, it\'s as though the policy isn\'t being deployed as part of the test.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo be honest, the mechanism that the test harness uses for custom policies\u003cbr\\/\u003e\\nlike these is a bit murky to me.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn my previous experiment, I was running with classes. So I ran \'ant buildjars\'\u003cbr\\/\u003e\\nand then ran the test again, and it worked perfectly.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo then I ran \'ant cleanjars\', and ran the test again, and it got the\u003cbr\\/\u003e\\nsecurity policy problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo maybe it\'s a build error on my part, but it seems like something about\u003cbr\\/\u003e\\nthe policy is causing it not to be picked up in all cases on my machine.\u003c\\/p\u003e\\n\\n\u003cp\u003eBy the way, when I did \'ant buildjars\', I had to run \'ant refreshjardriftcheck\',\u003cbr\\/\u003e\\nbecause the new DeadlockWatchdog class in derbyTesting.jar was noticed by the\u003cbr\\/\u003e\\njar drift detector. I think that\'s unrelated to why I was getting the\u003cbr\\/\u003e\\nsecurity policy error in the non-jar configuration, but I mention it anyway.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15350325_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15350325_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/16 01:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-27T01:32:56+0000\'\u003e27\\/Jun\\/16 01:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree, it\'s as though the policy isn\'t being deployed as part of the test. \\n\\n To be honest, the mechanism that the test harness uses for custom policies \\nlike these is a bit murky to me. \\n\\n In my previous experiment, I was running with classes. So I ran \'ant buildjars\' \\nand then ran the test again, and it worked perfectly. \\n\\n So then I ran \'ant cleanjars\', and ran the test again, and it got the \\nsecurity policy problem. \\n\\n So maybe it\'s a build error on my part, but it seems like something about \\nthe policy is causing it not to be picked up in all cases on my machine. \\n\\n By the way, when I did \'ant buildjars\', I had to run \'ant refreshjardriftcheck\', \\nbecause the new DeadlockWatchdog class in derbyTesting.jar was noticed by the \\njar drift detector. I think that\'s unrelated to why I was getting the \\nsecurity policy error in the non-jar configuration, but I mention it anyway.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15355255\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15355255&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15355255\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15355255_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15355255_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jun\\/16 13:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-29T13:45:00+0000\'\u003e29\\/Jun\\/16 13:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy thoughts about always synchronizing on the connection first will not work.  It does fix the immediate problem, but now when XA transaction is going to be to be timed out, the \\\"cancel\\\" waits for the connection to be able to be synchronized.  If the connection is executing a long running SQL statement, then the cancel actually waits for the completion before the \\\"cancel\\\" attempts to cancel.  So while it does solve the deadlock, it introduces another anomaly and as such is not the correct solution.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15355255_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15355255_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jun\\/16 13:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-06-29T13:45:00+0000\'\u003e29\\/Jun\\/16 13:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My thoughts about always synchronizing on the connection first will not work.  It does fix the immediate problem, but now when XA transaction is going to be to be timed out, the \\\"cancel\\\" waits for the connection to be able to be synchronized.  If the connection is executing a long running SQL statement, then the cancel actually waits for the completion before the \\\"cancel\\\" attempts to cancel.  So while it does solve the deadlock, it introduces another anomaly and as such is not the correct solution.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15362702\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15362702&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15362702\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15362702_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15362702_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/16 16:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-05T16:16:55+0000\'\u003e05\\/Jul\\/16 16:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have attached a revised patch with an updated test case and the resolution of the issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe final solution I came up with was to modify XATransactionState.cancel.   The change removes the method level synchronization and instead synchronizes on the instance for handle the cancelling and rollback work against the XATransactionState, releases the synchronization state and performs the connection level rollback (which synchronizes on the connection), and then again synchronizes on the XATransactionState to return the connection.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe change ensure that XATransactionState.cancel does not hold a lock on the XATransactionState instance while waiting for the lock on the EmbedConnection.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15362702_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15362702_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/16 16:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-05T16:16:55+0000\'\u003e05\\/Jul\\/16 16:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have attached a revised patch with an updated test case and the resolution of the issue. \\n\\n The final solution I came up with was to modify XATransactionState.cancel.   The change removes the method level synchronization and instead synchronizes on the instance for handle the cancelling and rollback work against the XATransactionState, releases the synchronization state and performs the connection level rollback (which synchronizes on the connection), and then again synchronizes on the XATransactionState to return the connection. \\n\\n The change ensure that XATransactionState.cancel does not hold a lock on the XATransactionState instance while waiting for the lock on the EmbedConnection.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15362707\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15362707&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15362707\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15362707_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15362707_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/16 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-05T16:19:01+0000\'\u003e05\\/Jul\\/16 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe patch also makes the CancelXATransactionTask.cancel and the CancelXATransactionTask.run methods synchronized.  Without this there is the possibility that the \\\"xaState\\\" could become null within \\\"cancel\\\" but be accessed within \\\"run\\\" and a NPE could occur.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15362707_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15362707_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/16 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-05T16:19:01+0000\'\u003e05\\/Jul\\/16 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The patch also makes the CancelXATransactionTask.cancel and the CancelXATransactionTask.run methods synchronized.  Without this there is the possibility that the \\\"xaState\\\" could become null within \\\"cancel\\\" but be accessed within \\\"run\\\" and a NPE could occur.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15363096\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15363096&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15363096\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15363096_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15363096_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/16 19:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-05T19:39:36+0000\'\u003e05\\/Jul\\/16 19:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe patch was no good so I removed it.   I will upload another shortly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15363096_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15363096_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/16 19:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-05T19:39:36+0000\'\u003e05\\/Jul\\/16 19:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The patch was no good so I removed it.   I will upload another shortly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15363176\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15363176&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15363176\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15363176_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15363176_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/16 20:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-05T20:34:38+0000\'\u003e05\\/Jul\\/16 20:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe patch \\\"derby-6897-2016-07-05.diff\\\" is now ready for review.  I had an issue with EOL with the previous incarnation of the patch that I deleted.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI also attached the output of the \\\"svn status\\\" to show the files modified\\/added.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15363176_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15363176_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/16 20:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-05T20:34:38+0000\'\u003e05\\/Jul\\/16 20:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The patch \\\"derby-6897-2016-07-05.diff\\\" is now ready for review.  I had an issue with EOL with the previous incarnation of the patch that I deleted.   \\n\\n I also attached the output of the \\\"svn status\\\" to show the files modified\\/added.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15364860\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15364860&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15364860\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15364860_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15364860_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Jul\\/16 18:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-06T18:41:13+0000\'\u003e06\\/Jul\\/16 18:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAll tests passed with this patch in place for me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15364860_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15364860_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Jul\\/16 18:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-06T18:41:13+0000\'\u003e06\\/Jul\\/16 18:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    All tests passed with this patch in place for me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15365542\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15365542&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15365542\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15365542_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15365542_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jul\\/16 03:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-07T03:31:01+0000\'\u003e07\\/Jul\\/16 03:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Brett, thanks for the patch, and for the detailed explanation of your thinking on this.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t really feel qualified to offer very deep comments on your patch, but here are\u003cbr\\/\u003e\\na few cursory comments:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) I believe we generally don\'t include @author tags in our code in Derby. Assuming that\'s\u003cbr\\/\u003e\\n   OK, maybe you could remove that tag?\u003c\\/p\u003e\\n\\n\u003cp\u003e2) It seems like the change to derbyTesting.jar.lastcontents is bigger than it needs to\u003cbr\\/\u003e\\n   be; it looks like the contents of that file got sorted differently and so org.apache.derby\u003cbr\\/\u003e\\n   classes ended up in a different order relative to org.apache.derbyTesting. I wonder\u003cbr\\/\u003e\\n   if that\'s an artifact of the platform you are working on &#8211; do you use Windows?\u003c\\/p\u003e\\n\\n\u003cp\u003e3) I think that there is also a \'insane\' version of derbyTesting.jar.lastcontents, which\u003cbr\\/\u003e\\n   needs to have the same trivial change as the \'sane\' version &#8211; that is, DeadlockWatchdog.class\u003cbr\\/\u003e\\n   needs to be added there, too.\u003c\\/p\u003e\\n\\n\u003cp\u003e4) It seems like, at around line 410 of XATransactionState.java, you added braces\u003cbr\\/\u003e\\n   around the call to Monitor.logTextMessage. Was that just a stylistic thing? Or is\u003cbr\\/\u003e\\n   there a deeper change there that I\'m not understanding?\u003c\\/p\u003e\\n\\n\u003cp\u003eIs there any other particular review you feel would be useful at this point? Assuming\u003cbr\\/\u003e\\nthat I can successfully apply your patch, and build and run the tests, is there more\u003cbr\\/\u003e\\nwork that you think is needed prior to commiting your change?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15365542_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15365542_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jul\\/16 03:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-07T03:31:01+0000\'\u003e07\\/Jul\\/16 03:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Brett, thanks for the patch, and for the detailed explanation of your thinking on this. \\n\\n I don\'t really feel qualified to offer very deep comments on your patch, but here are \\na few cursory comments: \\n\\n 1) I believe we generally don\'t include @author tags in our code in Derby. Assuming that\'s \\n   OK, maybe you could remove that tag? \\n\\n 2) It seems like the change to derbyTesting.jar.lastcontents is bigger than it needs to \\n   be; it looks like the contents of that file got sorted differently and so org.apache.derby \\n   classes ended up in a different order relative to org.apache.derbyTesting. I wonder \\n   if that\'s an artifact of the platform you are working on &#8211; do you use Windows? \\n\\n 3) I think that there is also a \'insane\' version of derbyTesting.jar.lastcontents, which \\n   needs to have the same trivial change as the \'sane\' version &#8211; that is, DeadlockWatchdog.class \\n   needs to be added there, too. \\n\\n 4) It seems like, at around line 410 of XATransactionState.java, you added braces \\n   around the call to Monitor.logTextMessage. Was that just a stylistic thing? Or is \\n   there a deeper change there that I\'m not understanding? \\n\\n Is there any other particular review you feel would be useful at this point? Assuming \\nthat I can successfully apply your patch, and build and run the tests, is there more \\nwork that you think is needed prior to commiting your change?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15367630\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15367630&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15367630\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15367630_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15367630_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jul\\/16 12:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-08T12:57:31+0000\'\u003e08\\/Jul\\/16 12:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI will update the patch Brian.\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"1\\\" snuck in there via my IDE.\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"2\\\" I am working on windows and the change to \\\"derbyTesting.jar.lastcontents\\\" was done by running the ANT target \\\"refreshjardriftcheck\\\" which was prompted when it saw the new DeadlockWatchdog.class\\\".   So any re-ordering was done by that target, possibly because of being developed on Windows.   I can manually fix that file so only have the DeadlockWatchdog.class being added.\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"3\\\" Is there some document on the \\\"sane\\\" versus \\\"insane\\\" builds?   I understand what they are doing and by looking at the \\\"build.xml\\\" I see how to trigger each, but I can only find one reference in the \\\"BUILDING.html\\\".   There seems to me to be a lot of \\\"magic\\\" on building\\/testing that I found as an impediment to contributing.\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"4\' the IDE snuck this in when reformatting this section according to my coding guidelines. Looking through the history of the code when I was comparing the source from 10.10.2.0 to the trunk I braces being removed for no apparent reason.   On the change between revisions 1364916 and 1364917, I see a brace being added for a bare \\\"if\\\".   \u003c\\/p\u003e\\n\\n\u003cp\u003ePersonally since doing software development since 1984, I have come to the conclusion that having the braces always has no downside and always has an upside when code is added to an \\\"if\\\" (it ensures that the code is added to content of the \\\"if\\\" and you don\'t have to add anything else).  Also according to the coding standard referenced on\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/wiki.apache.org\\/db-derby\\/DerbyContributorChecklist\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/wiki.apache.org\\/db-derby\\/DerbyContributorChecklist\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ewhich links to:\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/www.oracle.com\\/technetwork\\/java\\/javase\\/documentation\\/codeconventions-142311.html#449\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.oracle.com\\/technetwork\\/java\\/javase\\/documentation\\/codeconventions-142311.html#449\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ehaving the \\\"braces\\\" is according to the coding standards.  I will remove the added braces however.   \u003c\\/p\u003e\\n\\n\u003cp\u003eAs far as further review, just a sanity check on the change is good.  \u003c\\/p\u003e\\n\\n\u003cp\u003eThe original problem to be solved is that a connection in that is performing a XA transaction that discovers an error that must be cleaned up is going to have a lock on a EmbedConnection and will then require a lock on the XATransactionState and if the same XA transaction times out (because of the XA transaction timer value) while the original XA transaction is being worked, then the timeout handling is going to have a lock on the XATransactionState and then require a lock on the EmbedConnection, triggering the deadlock.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe change in the patch fixes this problem is the smallest way that I know of by altering the locking on the XATransactionState when invoked via the timeout by removing the synchronization on the \\\"cancel\\\" method and inline synchronizing on the \\\"XATransactionState\\\" to while its internals are being altered, then releasing the lock to allow the EmbedConnection.rollback to be invoked without the lock and finally acquiring the lock again to finish cleaning up the \\\"XATransactionState\\\".\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15367630_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15367630_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jul\\/16 12:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-08T12:57:31+0000\'\u003e08\\/Jul\\/16 12:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I will update the patch Brian. \\n\\n \\\"1\\\" snuck in there via my IDE. \\n\\n \\\"2\\\" I am working on windows and the change to \\\"derbyTesting.jar.lastcontents\\\" was done by running the ANT target \\\"refreshjardriftcheck\\\" which was prompted when it saw the new DeadlockWatchdog.class\\\".   So any re-ordering was done by that target, possibly because of being developed on Windows.   I can manually fix that file so only have the DeadlockWatchdog.class being added. \\n\\n \\\"3\\\" Is there some document on the \\\"sane\\\" versus \\\"insane\\\" builds?   I understand what they are doing and by looking at the \\\"build.xml\\\" I see how to trigger each, but I can only find one reference in the \\\"BUILDING.html\\\".   There seems to me to be a lot of \\\"magic\\\" on building\\/testing that I found as an impediment to contributing. \\n\\n \\\"4\' the IDE snuck this in when reformatting this section according to my coding guidelines. Looking through the history of the code when I was comparing the source from 10.10.2.0 to the trunk I braces being removed for no apparent reason.   On the change between revisions 1364916 and 1364917, I see a brace being added for a bare \\\"if\\\".    \\n\\n Personally since doing software development since 1984, I have come to the conclusion that having the braces always has no downside and always has an upside when code is added to an \\\"if\\\" (it ensures that the code is added to content of the \\\"if\\\" and you don\'t have to add anything else).  Also according to the coding standard referenced on \\n\\n  http:\\/\\/wiki.apache.org\\/db-derby\\/DerbyContributorChecklist  \\n\\n which links to: \\n\\n  http:\\/\\/www.oracle.com\\/technetwork\\/java\\/javase\\/documentation\\/codeconventions-142311.html#449  \\n\\n having the \\\"braces\\\" is according to the coding standards.  I will remove the added braces however.    \\n\\n As far as further review, just a sanity check on the change is good.   \\n\\n The original problem to be solved is that a connection in that is performing a XA transaction that discovers an error that must be cleaned up is going to have a lock on a EmbedConnection and will then require a lock on the XATransactionState and if the same XA transaction times out (because of the XA transaction timer value) while the original XA transaction is being worked, then the timeout handling is going to have a lock on the XATransactionState and then require a lock on the EmbedConnection, triggering the deadlock. \\n\\n The change in the patch fixes this problem is the smallest way that I know of by altering the locking on the XATransactionState when invoked via the timeout by removing the synchronization on the \\\"cancel\\\" method and inline synchronizing on the \\\"XATransactionState\\\" to while its internals are being altered, then releasing the lock to allow the EmbedConnection.rollback to be invoked without the lock and finally acquiring the lock again to finish cleaning up the \\\"XATransactionState\\\".              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15367656\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15367656&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15367656\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15367656_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15367656_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jul\\/16 13:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-08T13:18:15+0000\'\u003e08\\/Jul\\/16 13:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew patch file attached that fixes the issues that Brian mentioned in his review.  I also added a couple of comments to the \\\"cancel\\\" method to indicate the new synchronization change and reference to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-6879\\\" title=\\\"Engine deadlock between XA timeout handling and cleanupOnError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-6879\\\"\u003e\u003cdel\u003eDERBY-6879\u003c\\/del\u003e\u003c\\/a\u003e of what the change is for.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15367656_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15367656_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jul\\/16 13:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-08T13:18:15+0000\'\u003e08\\/Jul\\/16 13:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New patch file attached that fixes the issues that Brian mentioned in his review.  I also added a couple of comments to the \\\"cancel\\\" method to indicate the new synchronization change and reference to   DERBY-6879   of what the change is for.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15367687\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15367687&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15367687\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15367687_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15367687_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jul\\/16 13:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-08T13:39:40+0000\'\u003e08\\/Jul\\/16 13:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Brett!\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m no fan of brace or whitespace wars, either, sorry if I left that impression. I was\u003cbr\\/\u003e\\nsimply doing a close reading and trying to make sure I didn\'t overlook anything.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe note in BUILDING.html is the only doc I know of w.r.t. sane vs insane. From a\u003cbr\\/\u003e\\ncoding point of view, a sane build causes code like:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e            \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (SanityManager.DEBUG) {\\n                SanityManager.ASSERT(stream != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e);\\n            }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eto actually do something, while in an insane build that code is neutered, and\u003cbr\\/\u003e\\nin fact with modern compilers is essentially eliminated entirely. If you compare\u003cbr\\/\u003e\\nthe file size of the class files and jars in a sane build vs an insane build, you\u003cbr\\/\u003e\\nshould see a non-trivial difference, and test runs should have different elapsed\u003cbr\\/\u003e\\ntimes, too.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt sounds like you\'re ready to go. I\'ll get to work on commiting this patch soon,\u003cbr\\/\u003e\\nprobably this weekend.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15367687_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15367687_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jul\\/16 13:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-08T13:39:40+0000\'\u003e08\\/Jul\\/16 13:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Brett! \\n\\n I\'m no fan of brace or whitespace wars, either, sorry if I left that impression. I was \\nsimply doing a close reading and trying to make sure I didn\'t overlook anything. \\n\\n The note in BUILDING.html is the only doc I know of w.r.t. sane vs insane. From a \\ncoding point of view, a sane build causes code like: \\n  \\n              if  (SanityManager.DEBUG) {\\n                SanityManager.ASSERT(stream !=  null );\\n            }\\n \\n  \\n to actually do something, while in an insane build that code is neutered, and \\nin fact with modern compilers is essentially eliminated entirely. If you compare \\nthe file size of the class files and jars in a sane build vs an insane build, you \\nshould see a non-trivial difference, and test runs should have different elapsed \\ntimes, too. \\n\\n It sounds like you\'re ready to go. I\'ll get to work on commiting this patch soon, \\nprobably this weekend.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15368764\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15368764&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15368764\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15368764_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15368764_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/16 00:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-09T00:05:06+0000\'\u003e09\\/Jul\\/16 00:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1751977 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\" class=\\\"user-hover\\\" rel=\\\"bryanpendleton\\\"\u003eBryan Pendleton\u003c\\/a\u003e in branch \'code\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1751977\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1751977\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-6879\\\" title=\\\"Engine deadlock between XA timeout handling and cleanupOnError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-6879\\\"\u003e\u003cdel\u003eDERBY-6879\u003c\\/del\u003e\u003c\\/a\u003e: Engine deadlock between XA timeout handling and cleanupOnError\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch was contributed by Brett Bergquist (brett at thebergquistfamily dot com)\u003c\\/p\u003e\\n\\n\u003cp\u003eThe original problem to be solved is that a connection that is performing a\u003cbr\\/\u003e\\nXA transaction that discovers an error that must be cleaned up is going to\u003cbr\\/\u003e\\nhave a lock on a EmbedConnection and will then require a lock on the\u003cbr\\/\u003e\\nXATransactionState.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd if the same XA transaction times out (because of the XA transaction\u003cbr\\/\u003e\\ntimer value) while the original XA transaction is being worked, then the\u003cbr\\/\u003e\\ntimeout handling is going to have a lock on the XATransactionState and then\u003cbr\\/\u003e\\nrequire a lock on the EmbedConnection, triggering the deadlock.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe change in the patch fixes this problem by altering the locking on\u003cbr\\/\u003e\\nthe XATransactionState when invoked via the timeout by removing the\u003cbr\\/\u003e\\nsynchronization on the \\\"cancel\\\" method and instead using inline\u003cbr\\/\u003e\\nsynchronization on the \\\"XATransactionState\\\" while its internals are being\u003cbr\\/\u003e\\naltered.\u003c\\/p\u003e\\n\\n\u003cp\u003eThen, it releases the XATransactionState lock to allow the\u003cbr\\/\u003e\\nEmbedConnection.rollback method to be invoked without the lock.\u003c\\/p\u003e\\n\\n\u003cp\u003eFinally, it acquires the lock again to finish cleaning up the XATransactionState.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15368764_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15368764_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/16 00:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-09T00:05:06+0000\'\u003e09\\/Jul\\/16 00:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1751977 from  Bryan Pendleton  in branch \'code\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1751977  ] \\n\\n   DERBY-6879  : Engine deadlock between XA timeout handling and cleanupOnError \\n\\n This patch was contributed by Brett Bergquist (brett at thebergquistfamily dot com) \\n\\n The original problem to be solved is that a connection that is performing a \\nXA transaction that discovers an error that must be cleaned up is going to \\nhave a lock on a EmbedConnection and will then require a lock on the \\nXATransactionState. \\n\\n And if the same XA transaction times out (because of the XA transaction \\ntimer value) while the original XA transaction is being worked, then the \\ntimeout handling is going to have a lock on the XATransactionState and then \\nrequire a lock on the EmbedConnection, triggering the deadlock. \\n\\n The change in the patch fixes this problem by altering the locking on \\nthe XATransactionState when invoked via the timeout by removing the \\nsynchronization on the \\\"cancel\\\" method and instead using inline \\nsynchronization on the \\\"XATransactionState\\\" while its internals are being \\naltered. \\n\\n Then, it releases the XATransactionState lock to allow the \\nEmbedConnection.rollback method to be invoked without the lock. \\n\\n Finally, it acquires the lock again to finish cleaning up the XATransactionState.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15368768\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15368768&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15368768\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15368768_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15368768_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/16 00:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-09T00:06:51+0000\'\u003e09\\/Jul\\/16 00:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI had no further suggestions to offer after re-reading Brett\'s latest patch,\u003cbr\\/\u003e\\nand all of my test results were clean, so I\'ve committed the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you for this contribution, Brett! And, more importantly, thanks\u003cbr\\/\u003e\\nagain for all the hard work to diagnose the problem, build new test cases\u003cbr\\/\u003e\\nand testing infrastructure, and really going the extra distance to contribute\u003cbr\\/\u003e\\nas thorough an improvement as this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15368768_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15368768_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/16 00:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-09T00:06:51+0000\'\u003e09\\/Jul\\/16 00:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I had no further suggestions to offer after re-reading Brett\'s latest patch, \\nand all of my test results were clean, so I\'ve committed the patch. \\n\\n Thank you for this contribution, Brett! And, more importantly, thanks \\nagain for all the hard work to diagnose the problem, build new test cases \\nand testing infrastructure, and really going the extra distance to contribute \\nas thorough an improvement as this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15368858\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15368858&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15368858\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15368858_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15368858_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/16 01:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-09T01:25:33+0000\'\u003e09\\/Jul\\/16 01:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1751978 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\" class=\\\"user-hover\\\" rel=\\\"bryanpendleton\\\"\u003eBryan Pendleton\u003c\\/a\u003e in branch \'code\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1751978\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1751978\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-6879\\\" title=\\\"Engine deadlock between XA timeout handling and cleanupOnError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-6879\\\"\u003e\u003cdel\u003eDERBY-6879\u003c\\/del\u003e\u003c\\/a\u003e: Engine deadlock between XA timeout handling and cleanupOnError\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch was contributed by Brett Bergquist (brett at thebergquistfamily dot com)\u003c\\/p\u003e\\n\\n\u003cp\u003eThe original problem to be solved is that a connection that is performing a\u003cbr\\/\u003e\\nXA transaction that discovers an error that must be cleaned up is going to\u003cbr\\/\u003e\\nhave a lock on a EmbedConnection and will then require a lock on the\u003cbr\\/\u003e\\nXATransactionState.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd if the same XA transaction times out (because of the XA transaction\u003cbr\\/\u003e\\ntimer value) while the original XA transaction is being worked, then the\u003cbr\\/\u003e\\ntimeout handling is going to have a lock on the XATransactionState and then\u003cbr\\/\u003e\\nrequire a lock on the EmbedConnection, triggering the deadlock.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe change in the patch fixes this problem by altering the locking on\u003cbr\\/\u003e\\nthe XATransactionState when invoked via the timeout by removing the\u003cbr\\/\u003e\\nsynchronization on the \\\"cancel\\\" method and instead using inline\u003cbr\\/\u003e\\nsynchronization on the \\\"XATransactionState\\\" while its internals are being\u003cbr\\/\u003e\\naltered.\u003c\\/p\u003e\\n\\n\u003cp\u003eThen, it releases the XATransactionState lock to allow the\u003cbr\\/\u003e\\nEmbedConnection.rollback method to be invoked without the lock.\u003c\\/p\u003e\\n\\n\u003cp\u003eFinally, it acquires the lock again to finish cleaning up the XATransactionState.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15368858_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15368858_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/16 01:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-09T01:25:33+0000\'\u003e09\\/Jul\\/16 01:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1751978 from  Bryan Pendleton  in branch \'code\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1751978  ] \\n\\n   DERBY-6879  : Engine deadlock between XA timeout handling and cleanupOnError \\n\\n This patch was contributed by Brett Bergquist (brett at thebergquistfamily dot com) \\n\\n The original problem to be solved is that a connection that is performing a \\nXA transaction that discovers an error that must be cleaned up is going to \\nhave a lock on a EmbedConnection and will then require a lock on the \\nXATransactionState. \\n\\n And if the same XA transaction times out (because of the XA transaction \\ntimer value) while the original XA transaction is being worked, then the \\ntimeout handling is going to have a lock on the XATransactionState and then \\nrequire a lock on the EmbedConnection, triggering the deadlock. \\n\\n The change in the patch fixes this problem by altering the locking on \\nthe XATransactionState when invoked via the timeout by removing the \\nsynchronization on the \\\"cancel\\\" method and instead using inline \\nsynchronization on the \\\"XATransactionState\\\" while its internals are being \\naltered. \\n\\n Then, it releases the XATransactionState lock to allow the \\nEmbedConnection.rollback method to be invoked without the lock. \\n\\n Finally, it acquires the lock again to finish cleaning up the XATransactionState.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15368860\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15368860&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15368860\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15368860_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15368860_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/16 01:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-09T01:26:06+0000\'\u003e09\\/Jul\\/16 01:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHad to do follow-on commit 1751978 because I forgot to \'svn add\'\u003cbr\\/\u003e\\nthe two new files. Mea culpa.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15368860_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15368860_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/16 01:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-09T01:26:06+0000\'\u003e09\\/Jul\\/16 01:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Had to do follow-on commit 1751978 because I forgot to \'svn add\' \\nthe two new files. Mea culpa.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15380886\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15380886&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15380886\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15380886_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15380886_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/16 18:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-16T18:28:39+0000\'\u003e16\\/Jul\\/16 18:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Brett,\u003c\\/p\u003e\\n\\n\u003cp\u003eWhile running the overall suite overnight I had a test failure\u003cbr\\/\u003e\\nwith the new test. I zipped up the output and attached it as\u003cbr\\/\u003e\\n\'testFail.zip\'.\u003c\\/p\u003e\\n\\n\u003cp\u003eCan you see anything in there that explains what happened?\u003c\\/p\u003e\\n\\n\u003cp\u003ethanks,\u003c\\/p\u003e\\n\\n\u003cp\u003ebryan\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15380886_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15380886_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/16 18:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-16T18:28:39+0000\'\u003e16\\/Jul\\/16 18:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Brett, \\n\\n While running the overall suite overnight I had a test failure \\nwith the new test. I zipped up the output and attached it as \\n\'testFail.zip\'. \\n\\n Can you see anything in there that explains what happened? \\n\\n thanks, \\n\\n bryan              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15380914\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15380914&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15380914\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15380914_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15380914_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/16 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-16T19:49:11+0000\'\u003e16\\/Jul\\/16 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe exception is a XAER_DUPID being reported from line 1271 on XaTest.java which looks like:\u003c\\/p\u003e\\n\\n\u003cp\u003e        \\/\\/ Get a second connection and global xact\u003cbr\\/\u003e\\n        \\/\\/ and try to select causing lock timeout\u003cbr\\/\u003e\\n        XAConnection xaconn2 = xads.getXAConnection();\u003cbr\\/\u003e\\n        XAResource xar2 = xaconn2.getXAResource();\u003cbr\\/\u003e\\n        xar2.setTransactionTimeout(2);\u003cbr\\/\u003e\\n        Xid xid2 = XATestUtil.getXid(6879, 11, 51);\u003cbr\\/\u003e\\n        Connection conn2 = xaconn2.getConnection();\u003cbr\\/\u003e\\n        \\/\\/ Set to serializable so we get lock timeout\u003cbr\\/\u003e\\n        conn2.setTransactionIsolation(Connection.TRANSACTION_SERIALIZABLE);\u003cbr\\/\u003e\\n        xar2.start(xid2, XAResource.TMNOFLAGS);\u003c\\/p\u003e\\n\\n\u003cp\u003eSo the \\\"xar2.start\\\" is the one failing with a duplicate XID.   I don\'t know how this could happen unless the test were being run twice at the same time.   Not that this code is before anything that triggers the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-6879\\\" title=\\\"Engine deadlock between XA timeout handling and cleanupOnError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-6879\\\"\u003e\u003cdel\u003eDERBY-6879\u003c\\/del\u003e\u003c\\/a\u003e issue.  It is just creating and starting a XA transaction with a specific XID.   \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15380914_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15380914_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/16 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-16T19:49:11+0000\'\u003e16\\/Jul\\/16 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The exception is a XAER_DUPID being reported from line 1271 on XaTest.java which looks like: \\n\\n         \\/\\/ Get a second connection and global xact \\n        \\/\\/ and try to select causing lock timeout \\n        XAConnection xaconn2 = xads.getXAConnection(); \\n        XAResource xar2 = xaconn2.getXAResource(); \\n        xar2.setTransactionTimeout(2); \\n        Xid xid2 = XATestUtil.getXid(6879, 11, 51); \\n        Connection conn2 = xaconn2.getConnection(); \\n        \\/\\/ Set to serializable so we get lock timeout \\n        conn2.setTransactionIsolation(Connection.TRANSACTION_SERIALIZABLE); \\n        xar2.start(xid2, XAResource.TMNOFLAGS); \\n\\n So the \\\"xar2.start\\\" is the one failing with a duplicate XID.   I don\'t know how this could happen unless the test were being run twice at the same time.   Not that this code is before anything that triggers the   DERBY-6879   issue.  It is just creating and starting a XA transaction with a specific XID.                 \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15380926\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15380926&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15380926\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15380926_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15380926_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/16 20:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-16T20:11:49+0000\'\u003e16\\/Jul\\/16 20:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBrian, it looks like there is a timing issue in XATransactionState.cancel with the new code.\u003c\\/p\u003e\\n\\n\u003cp\u003e       if (needsRollback) {\u003cbr\\/\u003e\\n            \\/\\/ While the rollback is performed on the connection, \u003cbr\\/\u003e\\n            \\/\\/  this XATransactionState is ont synchronized to work around \u003cbr\\/\u003e\\n            \\/\\/  the issue reported in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-6879\\\" title=\\\"Engine deadlock between XA timeout handling and cleanupOnError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-6879\\\"\u003e\u003cdel\u003eDERBY-6879\u003c\\/del\u003e\u003c\\/a\u003e\u003cbr\\/\u003e\\n            try \u003c\\/p\u003e\\n{\\n                \\/\\/ Rollback the global transaction\\n                conn.xa_rollback();\\n            }\\n\u003cp\u003e catch (SQLException sqle) \u003c\\/p\u003e\\n{\\n                XAException ex = new XAException(XAException.XAER_RMERR);\\n                ex.initCause(sqle);\\n                throw ex;\\n            }\\n\u003cp\u003e        }\u003c\\/p\u003e\\n\\n\u003cp\u003eThe \\\"conn.xa_rollback\\\" is throwing a SQL exception.  \u003c\\/p\u003e\\n\\n\u003cp\u003eFor now, I think we should rollback the patch and disable this test until I can reproduce this issue consistently and debug it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15380926_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15380926_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/16 20:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-16T20:11:49+0000\'\u003e16\\/Jul\\/16 20:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Brian, it looks like there is a timing issue in XATransactionState.cancel with the new code. \\n\\n        if (needsRollback) { \\n            \\/\\/ While the rollback is performed on the connection,  \\n            \\/\\/  this XATransactionState is ont synchronized to work around  \\n            \\/\\/  the issue reported in   DERBY-6879   \\n            try  \\n{\\n                \\/\\/ Rollback the global transaction\\n                conn.xa_rollback();\\n            }\\n  catch (SQLException sqle)  \\n{\\n                XAException ex = new XAException(XAException.XAER_RMERR);\\n                ex.initCause(sqle);\\n                throw ex;\\n            }\\n         } \\n\\n The \\\"conn.xa_rollback\\\" is throwing a SQL exception.   \\n\\n For now, I think we should rollback the patch and disable this test until I can reproduce this issue consistently and debug it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15380976\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15380976&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15380976\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15380976_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15380976_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/16 22:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-16T22:58:43+0000\'\u003e16\\/Jul\\/16 22:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGood, I\'m glad you have a theory to consider.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t see any need to rollback your previous work just yet. It\'s only in main,\u003cbr\\/\u003e\\nnot in any released builds, and so it\'s only being seen by developers like us who\u003cbr\\/\u003e\\nare building and working with main.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m happy to leave the code as it is while we think about the issues for the time being.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe intermittent test failure is not causing anyone any problems that I am aware of.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15380976_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15380976_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/16 22:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-16T22:58:43+0000\'\u003e16\\/Jul\\/16 22:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Good, I\'m glad you have a theory to consider. \\n\\n I don\'t see any need to rollback your previous work just yet. It\'s only in main, \\nnot in any released builds, and so it\'s only being seen by developers like us who \\nare building and working with main. \\n\\n I\'m happy to leave the code as it is while we think about the issues for the time being. \\n\\n The intermittent test failure is not causing anyone any problems that I am aware of.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15381594\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15381594&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15381594\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15381594_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15381594_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/16 00:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-18T00:46:09+0000\'\u003e18\\/Jul\\/16 00:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI was able to get this to reproduce periodically by causing stress on my test system while running the tests over and over.   \u003c\\/p\u003e\\n\\n\u003cp\u003eThere is a timing issue that is opened up because of the lack of synchronization on the XATransactionState inside of \'cancel\' while calling the \\\"conn.rollback\\\".  \u003c\\/p\u003e\\n\\n\u003cp\u003e I have taken a different approach for a fix.  \u003c\\/p\u003e\\n\\n\u003cp\u003eThe problem occurs if a timeout occurs calling \\\"cancel\\\" and if an error occurs on the clients connection causing the \\\"cleanupOnError\\\" to be called at the same time.  Recognizing this, the patch in the \\\"cancel\\\" method checks to see if the \\\"cleanUpOnError\\\" is being invoked and if so, the cancel is skipped.  This makes sense as if \\\"cleanupOnError\\\" is being called, then the transaction will end anyways as there the error handling code on the client is being processed, so it does not need to be cancelled.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch also adds a check in the \\\"cleanupOnError\\\" method to check to see if the \\\"cancel\\\" is being invoked.  If so, then the cleanup on the XATransactionState by this method is skipped.   this makes sense as if the transaction is being cancelled, then there is no need to mark the XATransactionState with the cleanup error information.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch also disassociates the XID from ResourceAdapter earlier in the \\\"cancel\\\".   The logic behind this is that once the \\\"cancel\\\" starts processing any client code that access the XA transaction, really should not see the XA transaction.   So a call to  \\\"XATransaction.end\\\" for example, after the XA transaction times out and is cancelled, the client code is going to received a XAException.XAER_NOTA.   Note that this is not a change in except in timing of where the XID is removed in \\\"cancel\\\" in that it previously was done at the end of \\\"cancel\\\" and now it is being done in the beginning of \\\"cancel\\\".  This eliminate any possibly that client code can access a XA transaction after it is starting to be cancelled.  Also note that this does not change the error that a client would receive if the XA transaction were cancelled and then seconds later after the cancel completed, the client were to access the XA transaction; it would receive a XAException.XAER_NOTA.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch creates a new private static class that is used to track if \\\"cancel\\\" or \\\"cleanupOnError\\\" has been invoked.  The methods are synchronized so that there is no timing issue on checking and recording the state.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15381594_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15381594_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/16 00:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-18T00:46:09+0000\'\u003e18\\/Jul\\/16 00:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I was able to get this to reproduce periodically by causing stress on my test system while running the tests over and over.    \\n\\n There is a timing issue that is opened up because of the lack of synchronization on the XATransactionState inside of \'cancel\' while calling the \\\"conn.rollback\\\".   \\n\\n  I have taken a different approach for a fix.   \\n\\n The problem occurs if a timeout occurs calling \\\"cancel\\\" and if an error occurs on the clients connection causing the \\\"cleanupOnError\\\" to be called at the same time.  Recognizing this, the patch in the \\\"cancel\\\" method checks to see if the \\\"cleanUpOnError\\\" is being invoked and if so, the cancel is skipped.  This makes sense as if \\\"cleanupOnError\\\" is being called, then the transaction will end anyways as there the error handling code on the client is being processed, so it does not need to be cancelled. \\n\\n The patch also adds a check in the \\\"cleanupOnError\\\" method to check to see if the \\\"cancel\\\" is being invoked.  If so, then the cleanup on the XATransactionState by this method is skipped.   this makes sense as if the transaction is being cancelled, then there is no need to mark the XATransactionState with the cleanup error information. \\n\\n The patch also disassociates the XID from ResourceAdapter earlier in the \\\"cancel\\\".   The logic behind this is that once the \\\"cancel\\\" starts processing any client code that access the XA transaction, really should not see the XA transaction.   So a call to  \\\"XATransaction.end\\\" for example, after the XA transaction times out and is cancelled, the client code is going to received a XAException.XAER_NOTA.   Note that this is not a change in except in timing of where the XID is removed in \\\"cancel\\\" in that it previously was done at the end of \\\"cancel\\\" and now it is being done in the beginning of \\\"cancel\\\".  This eliminate any possibly that client code can access a XA transaction after it is starting to be cancelled.  Also note that this does not change the error that a client would receive if the XA transaction were cancelled and then seconds later after the cancel completed, the client were to access the XA transaction; it would receive a XAException.XAER_NOTA. \\n\\n The patch creates a new private static class that is used to track if \\\"cancel\\\" or \\\"cleanupOnError\\\" has been invoked.  The methods are synchronized so that there is no timing issue on checking and recording the state. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15381596\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15381596&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15381596\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15381596_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15381596_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/16 00:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-18T00:49:56+0000\'\u003e18\\/Jul\\/16 00:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe patch that fixes the issue.   I have run all tests in the \\\"rg.apache.derbyTesting.functionTests.tests.jdbcapi._Suite\\\" over and over while stressing the system.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI will run the full test suite now and update but I believe that there will be no issues as the XATransactionState is only accessed by tests in this suite.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15381596_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15381596_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/16 00:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-18T00:49:56+0000\'\u003e18\\/Jul\\/16 00:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The patch that fixes the issue.   I have run all tests in the \\\"rg.apache.derbyTesting.functionTests.tests.jdbcapi._Suite\\\" over and over while stressing the system.   \\n\\n I will run the full test suite now and update but I believe that there will be no issues as the XATransactionState is only accessed by tests in this suite.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15382101\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15382101&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15382101\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15382101_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15382101_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/16 11:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-18T11:22:55+0000\'\u003e18\\/Jul\\/16 11:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBoth the junit based and the old test harness tests passed with no errors.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15382101_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15382101_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/16 11:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-18T11:22:55+0000\'\u003e18\\/Jul\\/16 11:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Both the junit based and the old test harness tests passed with no errors.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15383354\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15383354&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15383354\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15383354_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15383354_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/16 00:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-19T00:16:06+0000\'\u003e19\\/Jul\\/16 00:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI found the 07-17 diff to be a bit hard to concentrate on,\u003cbr\\/\u003e\\nbecause the re-indentation of some code led to a large\u003cbr\\/\u003e\\ndiff file. Attached \'diff-0717-ignore-whitespace.diff\' is\u003cbr\\/\u003e\\nthe result of doing \'svn diff -x -w\' after applying the\u003cbr\\/\u003e\\n\'derby-6879-2016-07-17.diff\'; it is significantly smaller\u003cbr\\/\u003e\\nand might help anyone who is looking at this diff.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15383354_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15383354_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/16 00:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-19T00:16:06+0000\'\u003e19\\/Jul\\/16 00:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I found the 07-17 diff to be a bit hard to concentrate on, \\nbecause the re-indentation of some code led to a large \\ndiff file. Attached \'diff-0717-ignore-whitespace.diff\' is \\nthe result of doing \'svn diff -x -w\' after applying the \\n\'derby-6879-2016-07-17.diff\'; it is significantly smaller \\nand might help anyone who is looking at this diff.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15383536\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15383536&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15383536\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15383536_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15383536_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/16 03:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-19T03:55:38+0000\'\u003e19\\/Jul\\/16 03:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1753333 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\" class=\\\"user-hover\\\" rel=\\\"bryanpendleton\\\"\u003eBryan Pendleton\u003c\\/a\u003e in branch \'code\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1753333\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1753333\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-6879\\\" title=\\\"Engine deadlock between XA timeout handling and cleanupOnError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-6879\\\"\u003e\u003cdel\u003eDERBY-6879\u003c\\/del\u003e\u003c\\/a\u003e: Engine deadlock between XA timeout handling and cleanupOnError\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch was contributed by Brett Bergquist (brett at thebergquistfamily dot com)\u003c\\/p\u003e\\n\\n\u003cp\u003eThis change is a follow-up to revision 1751977.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe problem with that revision occurs if a timeout occurs calling \\\"cancel\\\"\u003cbr\\/\u003e\\nand if an error occurs on the clients connection causing the \\\"cleanupOnError\\\"\u003cbr\\/\u003e\\nto be called at the same time.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis change creates a new private static class that is used to track if\u003cbr\\/\u003e\\n\\\"cancel\\\" or \\\"cleanupOnError\\\" has been invoked. The methods are synchronized\u003cbr\\/\u003e\\nso that there is no timing issue on checking and recording the state.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15383536_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15383536_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/16 03:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-19T03:55:38+0000\'\u003e19\\/Jul\\/16 03:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1753333 from  Bryan Pendleton  in branch \'code\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1753333  ] \\n\\n   DERBY-6879  : Engine deadlock between XA timeout handling and cleanupOnError \\n\\n This patch was contributed by Brett Bergquist (brett at thebergquistfamily dot com) \\n\\n This change is a follow-up to revision 1751977. \\n\\n The problem with that revision occurs if a timeout occurs calling \\\"cancel\\\" \\nand if an error occurs on the clients connection causing the \\\"cleanupOnError\\\" \\nto be called at the same time. \\n\\n This change creates a new private static class that is used to track if \\n\\\"cancel\\\" or \\\"cleanupOnError\\\" has been invoked. The methods are synchronized \\nso that there is no timing issue on checking and recording the state.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15383540\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15383540&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15383540\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15383540_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15383540_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/16 03:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-19T03:57:42+0000\'\u003e19\\/Jul\\/16 03:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI read through the patch, and also built it and ran the jdbcapi tests myself multiple times.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have no additional improvements to suggest, so I committed the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eBrett, thanks for the quick follow-up.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15383540_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15383540_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/16 03:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-07-19T03:57:42+0000\'\u003e19\\/Jul\\/16 03:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I read through the patch, and also built it and ran the jdbcapi tests myself multiple times. \\n\\n I have no additional improvements to suggest, so I committed the patch. \\n\\n Brett, thanks for the quick follow-up.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15411301\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15411301&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15411301\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_15411301_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15411301_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/16 05:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-08-08T05:14:35+0000\'\u003e08\\/Aug\\/16 05:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi. What\'s the state of this issue now? It\'s still reported as unresolved and unassigned by JIRA.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_15411301_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15411301_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/16 05:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-08-08T05:14:35+0000\'\u003e08\\/Aug\\/16 05:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi. What\'s the state of this issue now? It\'s still reported as unresolved and unassigned by JIRA.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15411923\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15411923&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15411923\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15411923_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15411923_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/16 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-08-08T15:05:10+0000\'\u003e08\\/Aug\\/16 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t know the proper procedure on this Kristian.   All of the code is complete and been committed by Bryan and it there have been no issues in the regression tests that I know of.  Also, I have put a patched version of this into our production environments and there have been no issues there either.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think it is ready to be marked as resolved.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_15411923_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15411923_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/16 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-08-08T15:05:10+0000\'\u003e08\\/Aug\\/16 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t know the proper procedure on this Kristian.   All of the code is complete and been committed by Bryan and it there have been no issues in the regression tests that I know of.  Also, I have put a patched version of this into our production environments and there have been no issues there either. \\n\\n I think it is ready to be marked as resolved.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15412692\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-6879?focusedCommentId=15412692&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15412692\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15412692_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15412692_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/16 00:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-08-09T00:04:33+0000\'\u003e09\\/Aug\\/16 00:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the reminder, Kristian. As Brett noted, we\'ve completed\u003cbr\\/\u003e\\nall the intended work for this issue. Marking resolved as fixed in 10.13.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_15412692_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15412692_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/16 00:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-08-09T00:04:33+0000\'\u003e09\\/Aug\\/16 00:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the reminder, Kristian. As Brett noted, we\'ve completed \\nall the intended work for this issue. Marking resolved as fixed in 10.13.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520241117959"> 
    <input type="hidden" title="jira.request.server.time" value="249"> 
    <input type="hidden" title="jira.request.id" value="551x94451389x7"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="44"> 
    <input type="hidden" title="db.conns.time.in.ms" value="50"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 551x94451389x7
	          REQUEST TIMESTAMP : [05/Mar/2018:09:11:57 +0000]
	               REQUEST TIME : 0.2490
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=18, elapsedTotal=44122197, elapsedMin=584233, elapsedMax=15618061, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=22, elapsedTotal=50282959, elapsedMin=590836, elapsedMax=15764365, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>