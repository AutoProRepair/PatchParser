<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|62908d69c2b9a2b18b5309aa715598c76e2e26b7|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"68d59fc62d1485\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-3980"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-3980] Conflicting select then update with REPEATABLE_READ gives lock timeout instead of deadlock - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-3980] Conflicting select then update with REPEATABLE_READ gives lock timeout instead of deadlock - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-3980">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-3980" href="/jira/browse/DERBY-3980" id="key-val" rel="12410236">DERBY-3980</a></li>
                </ol>
                <h1 id="summary-val">Conflicting select then update with REPEATABLE_READ gives lock timeout instead of deadlock</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-3980"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-3980/DERBY-3980.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-3980/DERBY-3980.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-3980/DERBY-3980.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-3980/DERBY-3980.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.1.3.1 ">10.1.3.1</span>, <span title="10.2.2.0 ">10.2.2.0</span>, <span title="10.3.3.0 ">10.3.3.0</span>, <span title="10.4.2.0 ">10.4.2.0</span>, <span title="10.5.1.1 build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09">10.5.1.1</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.5.3.2" title="10.5.3.2 Head of 10.5 branch - version bump for DERBY-4835">10.5.3.2</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.6.2.4" title="10.6.2.4 Head of 10.6 branch as of 2014-01-13">10.6.2.4</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.7.1.4" title="10.7.1.4 Head of 10.7 branch as of 2010-11-29">10.7.1.4</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.8.1.2" title="10.8.1.2 First release on the 10.8 branch">10.8.1.2</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+Services" title="Services ">Services</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <ul class="labels" id="labels-12410236-value"> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+derby_triage10_5_2" title="derby_triage10_5_2"><span>derby_triage10_5_2</span></a></li> 
                    </ul> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310050" class="item"> 
                     <div class="wrap"> 
                      <strong title="Urgency" class="name">Urgency:</strong> 
                      <div id="customfield_12310050-val" class="value type-select" data-fieldtype="select" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        Normal 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310090" class="item"> 
                     <div class="wrap"> 
                      <strong title="Issue &amp; fix info" class="name">Issue &amp; fix info:</strong> 
                      <div id="customfield_12310090-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310090-field"> 
                        <span>High Value Fix</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>The attached program TryTimeout.java should detect a deadlock but instead throws a lock timeout exception. The program has two threads that attempt:</p> 
                  <p> threadConnection.setAutoCommit(false);<br> /* set isolation level to repeatable read */<br> threadConnection.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);</p> 
                  <p> ResultSet rs = stmt.executeQuery("select * from t where i = 456");<br> while (rs.next());<br> stmt.executeUpdate("update t set i = 456 where i = 456");<br> threadConnection.commit();</p> 
                  <p>This gives SQLState 40001 (deadlock) with DB2 but a lock timeout with Derby.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-3980?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-3980?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-3980?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-3980?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12395610" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395610/derby.log" draggable="true" data-downloadurl="text/plain:derby.log:https://issues.apache.org/jira/secure/attachment/12395610/derby.log"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395610/derby.log" title="Latest  09/Dec/08 01:01 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:derby.log:https://issues.apache.org/jira/secure/attachment/12395610/derby.log">derby.log</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-09T01:01:01.298Z">09/Dec/08 01:01</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12395665" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395665/derby.log.10_1" draggable="true" data-downloadurl="application/octet-stream:derby.log.10_1:https://issues.apache.org/jira/secure/attachment/12395665/derby.log.10_1"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395665/derby.log.10_1" title="Latest  09/Dec/08 18:33 - Kathey Marsden" draggable="true" data-downloadurl="application/octet-stream:derby.log.10_1:https://issues.apache.org/jira/secure/attachment/12395665/derby.log.10_1">derby.log.10_1</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-09T18:33:19.486Z">09/Dec/08 18:33</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12395956" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395956/derby-3980_javadoc_and_test_diff.txt" draggable="true" data-downloadurl="text/plain:derby-3980_javadoc_and_test_diff.txt:https://issues.apache.org/jira/secure/attachment/12395956/derby-3980_javadoc_and_test_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395956/derby-3980_javadoc_and_test_diff.txt" title="Latest  12/Dec/08 18:13 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:derby-3980_javadoc_and_test_diff.txt:https://issues.apache.org/jira/secure/attachment/12395956/derby-3980_javadoc_and_test_diff.txt">derby-3980_javadoc_and_test_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-12T18:13:20.094Z">12/Dec/08 18:13</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12473564" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12473564/derby-3980-1a.diff" draggable="true" data-downloadurl="text/x-patch:derby-3980-1a.diff:https://issues.apache.org/jira/secure/attachment/12473564/derby-3980-1a.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12473564/derby-3980-1a.diff" title="Latest  14/Mar/11 14:04 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/x-patch:derby-3980-1a.diff:https://issues.apache.org/jira/secure/attachment/12473564/derby-3980-1a.diff">derby-3980-1a.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-03-14T14:04:31.812Z">14/Mar/11 14:04</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12395666" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395666/javacore.20081209.092827.9800.txt" draggable="true" data-downloadurl="text/plain:javacore.20081209.092827.9800.txt:https://issues.apache.org/jira/secure/attachment/12395666/javacore.20081209.092827.9800.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395666/javacore.20081209.092827.9800.txt" title="Latest  09/Dec/08 18:33 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:javacore.20081209.092827.9800.txt:https://issues.apache.org/jira/secure/attachment/12395666/javacore.20081209.092827.9800.txt">javacore.20081209.092827.9800.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-09T18:33:19.552Z">09/Dec/08 18:33</time>
                   </dd>
                   <dd class="attachment-size">
                    177 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12396116" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12396116/LiveLockTest_diff.txt" draggable="true" data-downloadurl="text/plain:LiveLockTest_diff.txt:https://issues.apache.org/jira/secure/attachment/12396116/LiveLockTest_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12396116/LiveLockTest_diff.txt" title="Latest  15/Dec/08 19:11 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:LiveLockTest_diff.txt:https://issues.apache.org/jira/secure/attachment/12396116/LiveLockTest_diff.txt">LiveLockTest_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-15T19:11:04.171Z">15/Dec/08 19:11</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12396344" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12396344/LiveLockTest_with_Deadlock_look_diff.txt" draggable="true" data-downloadurl="text/plain:LiveLockTest_with_Deadlock_look_diff.txt:https://issues.apache.org/jira/secure/attachment/12396344/LiveLockTest_with_Deadlock_look_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12396344/LiveLockTest_with_Deadlock_look_diff.txt" title="Latest  17/Dec/08 20:50 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:LiveLockTest_with_Deadlock_look_diff.txt:https://issues.apache.org/jira/secure/attachment/12396344/LiveLockTest_with_Deadlock_look_diff.txt">LiveLockTest_with_Deadlock_look_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-17T20:50:15.804Z">17/Dec/08 20:50</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12396225" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12396225/LockTimeoutWithInserts.java" draggable="true" data-downloadurl="text/x-java:LockTimeoutWithInserts.java:https://issues.apache.org/jira/secure/attachment/12396225/LockTimeoutWithInserts.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12396225/LockTimeoutWithInserts.java" title="Latest  16/Dec/08 19:08 - Kathey Marsden" draggable="true" data-downloadurl="text/x-java:LockTimeoutWithInserts.java:https://issues.apache.org/jira/secure/attachment/12396225/LockTimeoutWithInserts.java">LockTimeoutWithInserts.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-16T19:08:49.867Z">16/Dec/08 19:08</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12395613" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395613/TryTimeout.java" draggable="true" data-downloadurl="text/x-java:TryTimeout.java:https://issues.apache.org/jira/secure/attachment/12395613/TryTimeout.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395613/TryTimeout.java" title="Latest  09/Dec/08 01:03 - Kathey Marsden" draggable="true" data-downloadurl="text/x-java:TryTimeout.java:https://issues.apache.org/jira/secure/attachment/12395613/TryTimeout.java">TryTimeout.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-09T01:03:44.221Z">09/Dec/08 01:03</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12395770" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395770/TryTimeout2.java" draggable="true" data-downloadurl="text/x-java:TryTimeout2.java:https://issues.apache.org/jira/secure/attachment/12395770/TryTimeout2.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395770/TryTimeout2.java" title="Latest  10/Dec/08 23:12 - Kathey Marsden" draggable="true" data-downloadurl="text/x-java:TryTimeout2.java:https://issues.apache.org/jira/secure/attachment/12395770/TryTimeout2.java">TryTimeout2.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-10T23:12:57.595Z">10/Dec/08 23:12</time>
                   </dd>
                   <dd class="attachment-size">
                    9 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12395875" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395875/TryTimeout2.out.10_1.deadlock" draggable="true" data-downloadurl="application/octet-stream:TryTimeout2.out.10_1.deadlock:https://issues.apache.org/jira/secure/attachment/12395875/TryTimeout2.out.10_1.deadlock"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395875/TryTimeout2.out.10_1.deadlock" title="Latest  11/Dec/08 21:08 - Kathey Marsden" draggable="true" data-downloadurl="application/octet-stream:TryTimeout2.out.10_1.deadlock:https://issues.apache.org/jira/secure/attachment/12395875/TryTimeout2.out.10_1.deadlock">TryTimeout2.out.10_1.deadlock</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-11T21:08:41.705Z">11/Dec/08 21:08</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12395856" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395856/TryTimeout2.out.10_1.deadlock" draggable="true" data-downloadurl="application/octet-stream:TryTimeout2.out.10_1.deadlock:https://issues.apache.org/jira/secure/attachment/12395856/TryTimeout2.out.10_1.deadlock"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395856/TryTimeout2.out.10_1.deadlock" title=" 11/Dec/08 18:06 - Kathey Marsden" draggable="true" data-downloadurl="application/octet-stream:TryTimeout2.out.10_1.deadlock:https://issues.apache.org/jira/secure/attachment/12395856/TryTimeout2.out.10_1.deadlock">TryTimeout2.out.10_1.deadlock</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-11T18:06:59.826Z">11/Dec/08 18:06</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12395874" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395874/TryTimeout2.out.10_1.locktimeout" draggable="true" data-downloadurl="application/octet-stream:TryTimeout2.out.10_1.locktimeout:https://issues.apache.org/jira/secure/attachment/12395874/TryTimeout2.out.10_1.locktimeout"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395874/TryTimeout2.out.10_1.locktimeout" title="Latest  11/Dec/08 21:08 - Kathey Marsden" draggable="true" data-downloadurl="application/octet-stream:TryTimeout2.out.10_1.locktimeout:https://issues.apache.org/jira/secure/attachment/12395874/TryTimeout2.out.10_1.locktimeout">TryTimeout2.out.10_1.locktimeout</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-11T21:08:41.589Z">11/Dec/08 21:08</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12395857" data-issue-id="12410236" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12395857/TryTimeout2.out.10_1.locktimeout" draggable="true" data-downloadurl="application/octet-stream:TryTimeout2.out.10_1.locktimeout:https://issues.apache.org/jira/secure/attachment/12395857/TryTimeout2.out.10_1.locktimeout"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12395857/TryTimeout2.out.10_1.locktimeout" title=" 11/Dec/08 18:06 - Kathey Marsden" draggable="true" data-downloadurl="application/octet-stream:TryTimeout2.out.10_1.locktimeout:https://issues.apache.org/jira/secure/attachment/12395857/TryTimeout2.out.10_1.locktimeout">TryTimeout2.out.10_1.locktimeout</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-12-11T18:06:59.882Z">11/Dec/08 18:06</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="is duplicated by">
                   is duplicated by
                  </dt> 
                  <dd id="internal-12499864_12310000"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5073: Derby deadlocks without recourse on simultaneous correlated subqueries"> <a href="/jira/browse/DERBY-5073" data-issue-key="DERBY-5073" class="issue-link link-title resolution">DERBY-5073</a> <span class="link-summary">Derby deadlocks without recourse on simultaneous correlated subqueries</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12372507_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-2877: Print the entire lock list when a deadlock occurs and deadlock tracing is on"> <a href="/jira/browse/DERBY-2877" data-issue-key="DERBY-2877" class="issue-link link-title resolution">DERBY-2877</a> <span class="link-summary">Print the entire lock list when a deadlock occurs and deadlock tracing is on</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12501519_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-5137: Enable or remove Derby3980DeadlockTest"> <a href="/jira/browse/DERBY-5137" data-issue-key="DERBY-5137" class="issue-link link-title">DERBY-5137</a> <span class="link-summary">Enable or remove Derby3980DeadlockTest</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_knutanders" rel="knutanders" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Knut Anders Hatlen&quot;,&quot;emailAddress&quot;:&quot;knut.hatlen@oracle.com&quot;,&quot;username&quot;:&quot;knutanders&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="knutanders"></span></span> Knut Anders Hatlen </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_kmarsden" rel="kmarsden" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Kathey Marsden&quot;,&quot;emailAddress&quot;:&quot;kmarsdenderby@sbcglobal.net&quot;,&quot;username&quot;:&quot;kmarsden&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="kmarsden"></span></span> Kathey Marsden </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="09/Dec/08 01:00"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2008-12-09T01:00:11+0000">09/Dec/08 01:00</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="19/Apr/11 12:38"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-04-19T12:38:40+0000">19/Apr/11 12:38</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="14/Mar/11 16:47"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-03-14T16:47:21+0000">14/Mar/11 16:47</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3980?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-3980?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12654881\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12654881&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12654881\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12654881_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12654881_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/08 18:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-09T18:33:19+0000\'\u003e09\\/Dec\\/08 18:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching the 10.1 derby.log which shows two waiters instead of one.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso attaching the javacore from the trunk run as the threads are waiting to show where they are waiting.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12654881_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12654881_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/08 18:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-09T18:33:19+0000\'\u003e09\\/Dec\\/08 18:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching the 10.1 derby.log which shows two waiters instead of one. \\n\\n Also attaching the javacore from the trunk run as the threads are waiting to show where they are waiting. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12654884\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12654884&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12654884\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12654884_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12654884_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/08 18:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-09T18:38:12+0000\'\u003e09\\/Dec\\/08 18:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooking at the error log there are a few wierd things:\u003cbr\\/\u003e\\n1) I would expect to see 2 waiting locks.  \u003cbr\\/\u003e\\n2) Given that it should be repeatable read, and there is no index I would expect the lock list to contain row locks for\u003cbr\\/\u003e\\n     every row in the table.  Maybe it would useful to dump the lock table after the select using the lock vti just to see if\u003cbr\\/\u003e\\n     it matches.  Maybe this will lead to whether the issue is the actual lock table, or just some issue with contruction the\u003cbr\\/\u003e\\n     error message.  (1, 9) is likely the row in question.  The other rows are likely (1, 6), (1,7), and (1,8).  The id\'s before\u003cbr\\/\u003e\\n     6 are reserved for special use so real rows start at 6 and increase.  \u003cbr\\/\u003e\\n3) Just to be complete it would be good to verify that both threads are in a wait state in the lock, I would just dump the\u003cbr\\/\u003e\\n     stacks using signal or cntrl key depending on jvm while it is stalled.  I looked at program and can\'t imagine anything else \u003cbr\\/\u003e\\n     going on.\u003cbr\\/\u003e\\n4) Anyone who wants to look at this one, the code is pretty isolated.  The interesting code is in \u003cbr\\/\u003e\\nopensource\\/java\\/engine\\/org\\/apache\\/derby\\/impl\\/services\\/locks\\/LockSet.java\u003c\\/p\u003e\\n\\n\u003cp\u003e5) some debugging steps I would take would include:\u003cbr\\/\u003e\\n    o verify if a deadlock search is being made or not?\u003cbr\\/\u003e\\n    o run in sane mode and turn on the SanityManager.DEBUG_ON(\\\"DeadlockTrace\\\") flag.\u003cbr\\/\u003e\\n    o If a deadlock search is being made, use the sanity code to dump out the lock table when the deadlock search is done and\u003cbr\\/\u003e\\n       misses the deadlock.\u003cbr\\/\u003e\\n    o see if the bug still happens if there is only 1 row in the table.\u003c\\/p\u003e\\n\\n\u003cp\u003eERROR 40XL2: A lock could not be obtained within the time requested.  The lockTable dump is: \u003cbr\\/\u003e\\n2008-12-09 00:50:40.640 GMT\u003cbr\\/\u003e\\nXID       |TYPE         |MODE|LOCKCOUNT|LOCKNAME                                                                        |STATE|TABLETYPE \\/ LOCKOBJ                   |INDEXNAME \\/ CONTAINER_ID \\/ (MODE for LATCH only)  |TABLENAME \\/ CONGLOM_ID                |\u003cbr\\/\u003e\\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003e\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003e\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003eThe following row is the victim ***\u003cbr\\/\u003e\\n186       |ROW          |U   |0        |(1,9)                                                                           |WAIT |T                                     |NULL                                              |T                                     |\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003eThe above row is the victim ***\u003cbr\\/\u003e\\n184       |ROW          |S   |1        |(1,9)                                                                           |GRANT|T                                     |NULL                                              |T                                     |\u003cbr\\/\u003e\\n186       |ROW          |S   |1        |(1,9)                                                                           |GRANT|T                                     |NULL                                              |T                                     |\u003cbr\\/\u003e\\n184       |ROW          |U   |1        |(1,9)                                                                           |GRANT|T                                     |NULL                                              |T                                     |\u003cbr\\/\u003e\\n184       |TABLE        |IS  |1        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |\u003cbr\\/\u003e\\n186       |TABLE        |IS  |1        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |\u003cbr\\/\u003e\\n184       |TABLE        |IX  |2        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |\u003cbr\\/\u003e\\n186       |TABLE        |IX  |2        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |\u003cbr\\/\u003e\\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12654884_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12654884_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/08 18:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-09T18:38:12+0000\'\u003e09\\/Dec\\/08 18:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looking at the error log there are a few wierd things: \\n1) I would expect to see 2 waiting locks.   \\n2) Given that it should be repeatable read, and there is no index I would expect the lock list to contain row locks for \\n     every row in the table.  Maybe it would useful to dump the lock table after the select using the lock vti just to see if \\n     it matches.  Maybe this will lead to whether the issue is the actual lock table, or just some issue with contruction the \\n     error message.  (1, 9) is likely the row in question.  The other rows are likely (1, 6), (1,7), and (1,8).  The id\'s before \\n     6 are reserved for special use so real rows start at 6 and increase.   \\n3) Just to be complete it would be good to verify that both threads are in a wait state in the lock, I would just dump the \\n     stacks using signal or cntrl key depending on jvm while it is stalled.  I looked at program and can\'t imagine anything else  \\n     going on. \\n4) Anyone who wants to look at this one, the code is pretty isolated.  The interesting code is in  \\nopensource\\/java\\/engine\\/org\\/apache\\/derby\\/impl\\/services\\/locks\\/LockSet.java \\n\\n 5) some debugging steps I would take would include: \\n    o verify if a deadlock search is being made or not? \\n    o run in sane mode and turn on the SanityManager.DEBUG_ON(\\\"DeadlockTrace\\\") flag. \\n    o If a deadlock search is being made, use the sanity code to dump out the lock table when the deadlock search is done and \\n       misses the deadlock. \\n    o see if the bug still happens if there is only 1 row in the table. \\n\\n ERROR 40XL2: A lock could not be obtained within the time requested.  The lockTable dump is:  \\n2008-12-09 00:50:40.640 GMT \\nXID       |TYPE         |MODE|LOCKCOUNT|LOCKNAME                                                                        |STATE|TABLETYPE \\/ LOCKOBJ                   |INDEXNAME \\/ CONTAINER_ID \\/ (MODE for LATCH only)  |TABLENAME \\/ CONGLOM_ID                | \\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \\n \\n\\t \\n\\t \\n\\t\\t \\n\\t\\t \\n\\t\\t\\t The following row is the victim *** \\n186       |ROW          |U   |0        |(1,9)                                                                           |WAIT |T                                     |NULL                                              |T                                     | \\n\\t\\t\\t The above row is the victim *** \\n184       |ROW          |S   |1        |(1,9)                                                                           |GRANT|T                                     |NULL                                              |T                                     | \\n186       |ROW          |S   |1        |(1,9)                                                                           |GRANT|T                                     |NULL                                              |T                                     | \\n184       |ROW          |U   |1        |(1,9)                                                                           |GRANT|T                                     |NULL                                              |T                                     | \\n184       |TABLE        |IS  |1        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     | \\n186       |TABLE        |IS  |1        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     | \\n184       |TABLE        |IX  |2        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     | \\n186       |TABLE        |IX  |2        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     | \\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \\n\\t\\t \\n\\t\\t \\n\\t \\n\\t \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12654886\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12654886&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12654886\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12654886_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12654886_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/08 18:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-09T18:42:23+0000\'\u003e09\\/Dec\\/08 18:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt may also be interesting to see if this is somehow related to U lock vs. X lock.  A similar test to one posted but changing the update to a delete would be interesting.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12654886_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12654886_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/08 18:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-09T18:42:23+0000\'\u003e09\\/Dec\\/08 18:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It may also be interesting to see if this is somehow related to U lock vs. X lock.  A similar test to one posted but changing the update to a delete would be interesting.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655216\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655216&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655216\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655216_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655216_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/08 14:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-10T14:13:00+0000\'\u003e10\\/Dec\\/08 14:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI pursued some of Mike\'s debugging steps.\u003cbr\\/\u003e\\n    o verify if a deadlock search is being made or not?\u003cbr\\/\u003e\\n        The code enters Deadlock.look() so if that means it is doing a deadlock search then we are.\u003cbr\\/\u003e\\n    o run in sane mode and turn on the SanityManager.DEBUG_ON(\\\"DeadlockTrace\\\") flag.\u003cbr\\/\u003e\\n       I set this but don\'t see any output difference.  In my calling program I just called    SanityManager.DEBUG_ON(\\\"DeadlockTrace\\\").\u003cbr\\/\u003e\\n       Am I doing something wrong?\u003cbr\\/\u003e\\n    o If a deadlock search is being made, use the sanity code to dump out the lock table when the deadlock search is done and\u003cbr\\/\u003e\\n       misses the deadlock.\u003cbr\\/\u003e\\n      Haven\'t tried this yet.\u003cbr\\/\u003e\\n    o see if the bug still happens if there is only 1 row in the table. \u003cbr\\/\u003e\\n     It still happens with one row.\u003cbr\\/\u003e\\n    o see if it still happens with a delete\u003cbr\\/\u003e\\n     The same problem exists with delete.\u003cbr\\/\u003e\\n   o verify two threads are waiting on lock with &lt;ctrl&gt; break.\u003cbr\\/\u003e\\n      Here are the two traces with the program set to do a delete instead of update.\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Native Method)\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Object.java:231)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/daemon\\/BasicDaemon.rest(BasicDaemon.java:571)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/daemon\\/BasicDaemon.run(BasicDaemon.java:388)\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Thread.run(Thread.java:803)\u003cbr\\/\u003e\\n3XMTHREADINFO      \\\"Thread-5\\\" (TID:0x4203EC00, sys_thread_t:0x42286868, state:CW, native ID:0x00001D94) prio=5\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Native Method)\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Object.java:231)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ActiveLock.waitForGrant(ActiveLock.java:118)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ConcurrentLockSet.lockObject(ConcurrentLockSet.java:463(Compiled Code))\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/AbstractPool.lockObject(AbstractPool.java:119)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ConcurrentPool.lockObject(ConcurrentPool.java:28)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/raw\\/xact\\/RowLocking3.lockRecordForRead(RowLocking3.java:187)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/conglomerate\\/OpenConglomerate.lockPositionForRead(OpenConglomerate.java:436)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/conglomerate\\/GenericScanController.fetchRows(GenericScanController.java:683)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/heap\\/HeapScan.fetchNext(HeapScan.java:240)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/TableScanResultSet.getNextRowCore(TableScanResultSet.java:680)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:255)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DeleteResultSet.setup(DeleteResultSet.java:252)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DeleteResultSet.open(DeleteResultSet.java:136)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/GenericPreparedStatement.execute(GenericPreparedStatement.java:297)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.executeStatement(EmbedStatement.java:1235)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.execute(EmbedStatement.java:625)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.executeUpdate(EmbedStatement.java:175)\u003cbr\\/\u003e\\n4XESTACKTRACE          at TryTimeout.threadWorker(TryTimeout.java:125)\u003cbr\\/\u003e\\n4XESTACKTRACE          at TryTimeout.access$000(TryTimeout.java:5)\u003cbr\\/\u003e\\n4XESTACKTRACE          at TryTimeout$1.run(TryTimeout.java:69)\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Thread.run(Thread.java:803)\u003cbr\\/\u003e\\n3XMTHREADINFO      \\\"Thread-6\\\" (TID:0x4203F000, sys_thread_t:0x42286ABC, state:CW, native ID:0x00001C5C) prio=5\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Native Method)\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Object.java:231)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ActiveLock.waitForGrant(ActiveLock.java:118)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ConcurrentLockSet.lockObject(ConcurrentLockSet.java:463(Compiled Code))\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/AbstractPool.lockObject(AbstractPool.java:119)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ConcurrentPool.lockObject(ConcurrentPool.java:28)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/raw\\/xact\\/RowLocking3.lockRecordForWrite(RowLocking3.java:248)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/conglomerate\\/OpenConglomerate.lockPositionForWrite(OpenConglomerate.java:541)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/conglomerate\\/GenericConglomerateController.delete(GenericConglomerateController.java:179)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/RowChangerImpl.deleteRow(RowChangerImpl.java:478)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DeleteResultSet.collectAffectedRows(DeleteResultSet.java:405)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DeleteResultSet.open(DeleteResultSet.java:137)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/GenericPreparedStatement.execute(GenericPreparedStatement.java:297)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.executeStatement(EmbedStatement.java:1235)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.execute(EmbedStatement.java:625)\u003cbr\\/\u003e\\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.executeUpdate(EmbedStatement.java:175)\u003cbr\\/\u003e\\n4XESTACKTRACE          at TryTimeout.threadWorker(TryTimeout.java:125)\u003cbr\\/\u003e\\n4XESTACKTRACE          at TryTimeout.access$000(TryTimeout.java:5)\u003cbr\\/\u003e\\n4XESTACKTRACE          at TryTimeout$1.run(TryTimeout.java:69)\u003cbr\\/\u003e\\n4XESTACKTRACE          at java\\/lang\\/Thread.run(Thread.java:803)\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655216_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655216_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/08 14:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-10T14:13:00+0000\'\u003e10\\/Dec\\/08 14:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I pursued some of Mike\'s debugging steps. \\n    o verify if a deadlock search is being made or not? \\n        The code enters Deadlock.look() so if that means it is doing a deadlock search then we are. \\n    o run in sane mode and turn on the SanityManager.DEBUG_ON(\\\"DeadlockTrace\\\") flag. \\n       I set this but don\'t see any output difference.  In my calling program I just called    SanityManager.DEBUG_ON(\\\"DeadlockTrace\\\"). \\n       Am I doing something wrong? \\n    o If a deadlock search is being made, use the sanity code to dump out the lock table when the deadlock search is done and \\n       misses the deadlock. \\n      Haven\'t tried this yet. \\n    o see if the bug still happens if there is only 1 row in the table.  \\n     It still happens with one row. \\n    o see if it still happens with a delete \\n     The same problem exists with delete. \\n   o verify two threads are waiting on lock with &lt;ctrl&gt; break. \\n      Here are the two traces with the program set to do a delete instead of update. \\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Native Method) \\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Object.java:231) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/daemon\\/BasicDaemon.rest(BasicDaemon.java:571) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/daemon\\/BasicDaemon.run(BasicDaemon.java:388) \\n4XESTACKTRACE          at java\\/lang\\/Thread.run(Thread.java:803) \\n3XMTHREADINFO      \\\"Thread-5\\\" (TID:0x4203EC00, sys_thread_t:0x42286868, state:CW, native ID:0x00001D94) prio=5 \\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Native Method) \\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Object.java:231) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ActiveLock.waitForGrant(ActiveLock.java:118) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ConcurrentLockSet.lockObject(ConcurrentLockSet.java:463(Compiled Code)) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/AbstractPool.lockObject(AbstractPool.java:119) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ConcurrentPool.lockObject(ConcurrentPool.java:28) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/raw\\/xact\\/RowLocking3.lockRecordForRead(RowLocking3.java:187) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/conglomerate\\/OpenConglomerate.lockPositionForRead(OpenConglomerate.java:436) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/conglomerate\\/GenericScanController.fetchRows(GenericScanController.java:683) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/heap\\/HeapScan.fetchNext(HeapScan.java:240) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/TableScanResultSet.getNextRowCore(TableScanResultSet.java:680) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:255) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DeleteResultSet.setup(DeleteResultSet.java:252) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DeleteResultSet.open(DeleteResultSet.java:136) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/GenericPreparedStatement.execute(GenericPreparedStatement.java:297) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.executeStatement(EmbedStatement.java:1235) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.execute(EmbedStatement.java:625) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.executeUpdate(EmbedStatement.java:175) \\n4XESTACKTRACE          at TryTimeout.threadWorker(TryTimeout.java:125) \\n4XESTACKTRACE          at TryTimeout.access$000(TryTimeout.java:5) \\n4XESTACKTRACE          at TryTimeout$1.run(TryTimeout.java:69) \\n4XESTACKTRACE          at java\\/lang\\/Thread.run(Thread.java:803) \\n3XMTHREADINFO      \\\"Thread-6\\\" (TID:0x4203F000, sys_thread_t:0x42286ABC, state:CW, native ID:0x00001C5C) prio=5 \\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Native Method) \\n4XESTACKTRACE          at java\\/lang\\/Object.wait(Object.java:231) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ActiveLock.waitForGrant(ActiveLock.java:118) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ConcurrentLockSet.lockObject(ConcurrentLockSet.java:463(Compiled Code)) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/AbstractPool.lockObject(AbstractPool.java:119) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/services\\/locks\\/ConcurrentPool.lockObject(ConcurrentPool.java:28) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/raw\\/xact\\/RowLocking3.lockRecordForWrite(RowLocking3.java:248) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/conglomerate\\/OpenConglomerate.lockPositionForWrite(OpenConglomerate.java:541) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/store\\/access\\/conglomerate\\/GenericConglomerateController.delete(GenericConglomerateController.java:179) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/RowChangerImpl.deleteRow(RowChangerImpl.java:478) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DeleteResultSet.collectAffectedRows(DeleteResultSet.java:405) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/execute\\/DeleteResultSet.open(DeleteResultSet.java:137) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/sql\\/GenericPreparedStatement.execute(GenericPreparedStatement.java:297) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.executeStatement(EmbedStatement.java:1235) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.execute(EmbedStatement.java:625) \\n4XESTACKTRACE          at org\\/apache\\/derby\\/impl\\/jdbc\\/EmbedStatement.executeUpdate(EmbedStatement.java:175) \\n4XESTACKTRACE          at TryTimeout.threadWorker(TryTimeout.java:125) \\n4XESTACKTRACE          at TryTimeout.access$000(TryTimeout.java:5) \\n4XESTACKTRACE          at TryTimeout$1.run(TryTimeout.java:69) \\n4XESTACKTRACE          at java\\/lang\\/Thread.run(Thread.java:803) \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655324\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655324&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655324\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655324_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655324_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/08 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-10T19:23:06+0000\'\u003e10\\/Dec\\/08 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI got the extra DeadlockTrace output  on by putting this in my derby.properties.\u003cbr\\/\u003e\\nderby.debug.true=DeadlockTrace\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655324_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655324_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/08 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-10T19:23:06+0000\'\u003e10\\/Dec\\/08 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I got the extra DeadlockTrace output  on by putting this in my derby.properties. \\nderby.debug.true=DeadlockTrace \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655393\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655393&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655393\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655393_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655393_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/08 22:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-10T22:37:47+0000\'\u003e10\\/Dec\\/08 22:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am debugging this on 10.1 since at least there the Lock table showed two waiters on lock timeout.\u003cbr\\/\u003e\\nI changed the test case a bit to have one of the threads sleep for 10 seconds after the select and also to have the program dump the lock table every ten seconds.  I found that after adding the sleep I usually get a deadlock instead of the timeout.\u003cbr\\/\u003e\\nExpected exception:A lock could not be obtained due to a deadlock, cycle of locks and waiters is:\u003cbr\\/\u003e\\nLock : ROW, T, (1,7)\u003cbr\\/\u003e\\n  Waiting XID : \u003c\\/p\u003e\\n{254, U}\\n\u003cp\u003e , DB2ADMIN, delete from t  where i = 456\u003cbr\\/\u003e\\n  Granted XID : \u003c\\/p\u003e\\n{256, S}\u003cbr\\/\u003e\\nLock : ROW, T, (1,7)\u003cbr\\/\u003e\\n  Waiting XID : {256, X} , DB2ADMIN, delete from t  where i = 456\u003cbr\\/\u003e\\n  Granted XID : {256, S}\\n\u003cp\u003e , \u003c\\/p\u003e\\n{254, S}\\n\\n\u003cp\u003ebut still I sometimes get the lock timeout.  I also saw that at the time of deadlock checking, the lock tables for both the lock timeout run and the deadlock run show the same lock table which should deadlock.\u003cbr\\/\u003e\\nxid     |username|trantype|type    |cnt|mode|tabname     |lockname  |state|status\u003cbr\\/\u003e\\n---------------------------------------------------------------------------------\u003cbr\\/\u003e\\n279     |UserTran|TABLE   |1  |IS  |T           |Tablelock |GRANT|ACTIVE\u003cbr\\/\u003e\\n281     |UserTran|TABLE   |1  |IS  |T           |Tablelock |GRANT|ACTIVE\u003cbr\\/\u003e\\n279     |UserTran|TABLE   |2  |IX  |T           |Tablelock |GRANT|ACTIVE\u003cbr\\/\u003e\\n281     |UserTran|TABLE   |2  |IX  |T           |Tablelock |GRANT|ACTIVE\u003cbr\\/\u003e\\n279     |UserTran|ROW     |1  |S   |T           |(1,7)     |GRANT|ACTIVE\u003cbr\\/\u003e\\n281     |UserTran|ROW     |1  |S   |T           |(1,7)     |GRANT|ACTIVE\u003cbr\\/\u003e\\n279     |UserTran|ROW     |0  |U   |T           |(1,7)     |WAIT|ACTIVE\u003cbr\\/\u003e\\n281     |UserTran|ROW     |1  |U   |T           |(1,7)     |GRANT|ACTIVE\u003cbr\\/\u003e\\n281     |UserTran|ROW     |0  |X   |T           |(1,7)     |WAIT|ACTIVE\u003c\\/p\u003e\\n\\n\u003cp\u003eMike mentioned to me that he thought it might be a problem with both threads doing the deadlock check at the same time, but  it seems like with the sleep that couldn\'t be the problem.  Let me know if you would like me to post the updated program.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655393_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655393_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/08 22:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-10T22:37:47+0000\'\u003e10\\/Dec\\/08 22:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am debugging this on 10.1 since at least there the Lock table showed two waiters on lock timeout. \\nI changed the test case a bit to have one of the threads sleep for 10 seconds after the select and also to have the program dump the lock table every ten seconds.  I found that after adding the sleep I usually get a deadlock instead of the timeout. \\nExpected exception:A lock could not be obtained due to a deadlock, cycle of locks and waiters is: \\nLock : ROW, T, (1,7) \\n  Waiting XID :  \\n{254, U}\\n  , DB2ADMIN, delete from t  where i = 456 \\n  Granted XID :  \\n{256, S} \\nLock : ROW, T, (1,7) \\n  Waiting XID : {256, X} , DB2ADMIN, delete from t  where i = 456 \\n  Granted XID : {256, S}\\n  ,  \\n{254, S}\\n\\n but still I sometimes get the lock timeout.  I also saw that at the time of deadlock checking, the lock tables for both the lock timeout run and the deadlock run show the same lock table which should deadlock. \\nxid     |username|trantype|type    |cnt|mode|tabname     |lockname  |state|status \\n--------------------------------------------------------------------------------- \\n279     |UserTran|TABLE   |1  |IS  |T           |Tablelock |GRANT|ACTIVE \\n281     |UserTran|TABLE   |1  |IS  |T           |Tablelock |GRANT|ACTIVE \\n279     |UserTran|TABLE   |2  |IX  |T           |Tablelock |GRANT|ACTIVE \\n281     |UserTran|TABLE   |2  |IX  |T           |Tablelock |GRANT|ACTIVE \\n279     |UserTran|ROW     |1  |S   |T           |(1,7)     |GRANT|ACTIVE \\n281     |UserTran|ROW     |1  |S   |T           |(1,7)     |GRANT|ACTIVE \\n279     |UserTran|ROW     |0  |U   |T           |(1,7)     |WAIT|ACTIVE \\n281     |UserTran|ROW     |1  |U   |T           |(1,7)     |GRANT|ACTIVE \\n281     |UserTran|ROW     |0  |X   |T           |(1,7)     |WAIT|ACTIVE \\n\\n Mike mentioned to me that he thought it might be a problem with both threads doing the deadlock check at the same time, but  it seems like with the sleep that couldn\'t be the problem.  Let me know if you would like me to post the updated program.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655411\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655411&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655411\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655411_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655411_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/08 23:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-10T23:12:57+0000\'\u003e10\\/Dec\\/08 23:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is the updated program in case someone is interested, TryTimeout2.java . Changes from TryTimeout.java are\u003cbr\\/\u003e\\n1) Second thread sleeps for 10 second after select.\u003cbr\\/\u003e\\n2) Only has one row in the table.\u003cbr\\/\u003e\\n3) Does delete instead of update.\u003cbr\\/\u003e\\n4) Starts a thread that shows a lock table dump every 10 seconds.\u003cbr\\/\u003e\\n5) This one fails sometimes with deadlock and sometimes with lock timeout.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655411_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655411_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/08 23:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-10T23:12:57+0000\'\u003e10\\/Dec\\/08 23:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is the updated program in case someone is interested, TryTimeout2.java . Changes from TryTimeout.java are \\n1) Second thread sleeps for 10 second after select. \\n2) Only has one row in the table. \\n3) Does delete instead of update. \\n4) Starts a thread that shows a lock table dump every 10 seconds. \\n5) This one fails sometimes with deadlock and sometimes with lock timeout. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655583\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655583&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655583\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12655583_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655583_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 09:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T09:36:38+0000\'\u003e11\\/Dec\\/08 09:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust a guess here, since I haven\'t checked the details. In the inner\u003cbr\\/\u003e\\nfor loop of Deadlock.look(), there\'s some code to prevent false\u003cbr\\/\u003e\\npositives for self-deadlocks:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \\/\\/ We could be seeing a situation here like\u003cbr\\/\u003e\\n    \\/\\/ Granted T1\u003c\\/p\u003e\\n{S}, T2{S}\\n\u003cp\u003e    \\/\\/ Waiting T1\u003c\\/p\u003e\\n{X}\\n\u003cp\u003e - deadlock checking on this\u003cbr\\/\u003e\\n    \\/\\/\u003cbr\\/\u003e\\n    \\/\\/ In this case it\'s not a deadlock, although it\u003cbr\\/\u003e\\n    \\/\\/ depends on the locking policy of the Lockable. E.g.\u003cbr\\/\u003e\\n    .\u003cbr\\/\u003e\\n    .\u003cbr\\/\u003e\\n    .\u003cbr\\/\u003e\\n    if (lock.canSkip) \u003c\\/p\u003e\\n{\\n        \\/\\/ not a deadlock ...\\n        chain.push(space); \\/\\/ set up as rollback() expects.\\n\\n        rollback(chain);\\n        continue outer;\\n    }\\n\\n\u003cp\u003eI\'m wondering if this perhaps is too broad. Both the transactions that\u003cbr\\/\u003e\\nare waiting for the X lock already have a shared lock on the row, so\u003cbr\\/\u003e\\nthey\'ll both have lock.canSkip==true. We may be giving up finding a\u003cbr\\/\u003e\\ndeadlock along that path too early.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12655583_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655583_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 09:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T09:36:38+0000\'\u003e11\\/Dec\\/08 09:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just a guess here, since I haven\'t checked the details. In the inner \\nfor loop of Deadlock.look(), there\'s some code to prevent false \\npositives for self-deadlocks: \\n\\n     \\/\\/ We could be seeing a situation here like \\n    \\/\\/ Granted T1 \\n{S}, T2{S}\\n     \\/\\/ Waiting T1 \\n{X}\\n  - deadlock checking on this \\n    \\/\\/ \\n    \\/\\/ In this case it\'s not a deadlock, although it \\n    \\/\\/ depends on the locking policy of the Lockable. E.g. \\n    . \\n    . \\n    . \\n    if (lock.canSkip)  \\n{\\n        \\/\\/ not a deadlock ...\\n        chain.push(space); \\/\\/ set up as rollback() expects.\\n\\n        rollback(chain);\\n        continue outer;\\n    }\\n\\n I\'m wondering if this perhaps is too broad. Both the transactions that \\nare waiting for the X lock already have a shared lock on the row, so \\nthey\'ll both have lock.canSkip==true. We may be giving up finding a \\ndeadlock along that path too early.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655720\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655720&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655720\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655720_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655720_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 18:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T18:06:59+0000\'\u003e11\\/Dec\\/08 18:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI did the runs with some additional  println\'s.  \u003cbr\\/\u003e\\n1) Upon entering Deadlock.look, I print:\u003cbr\\/\u003e\\nSystem.out.println(Thread.currentThread().getName() + \\\" Deadlock look\\\");\u003cbr\\/\u003e\\n        System.out.println(set.toDebugString());\u003cbr\\/\u003e\\n2) Upon entering the block of code Knut mentioned I print  \u003cbr\\/\u003e\\n   if (lock.canSkip) {\u003cbr\\/\u003e\\n                System.out.println(\\\"rollback(chain). Not a deadlock\\\");\u003c\\/p\u003e\\n\\n\u003cp\u003eHere is the output of the run with deadlock TryTimeout2.out.10_1.deadlock and the run with timeout TryTimeout2.out.10_1.locktimeout.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn both cases it first does a Deadlock.look for Thread0 which does not detect any deadlocks.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn the Deadlock.look for Thread1  we see it pass through the \\\"Not a deadlock\\\" line for the deadlock case, not the lock timeout case, which is the reverse of what I would expect if that code were the problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat I do notice is that always when we deadlock the lock\u003cspan class=\\\"error\\\"\u003e&#91;0&#93;\u003c\\/span\u003e and lock\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e  of the Thread1 LockControl objects are in the reverse order from the timeout run.  Perhaps there is some problem in the logic when they are ordered in this way.\u003c\\/p\u003e\\n\\n\u003cp\u003eA few general things I don\'t understand. Sorry for my newbieness.\u003c\\/p\u003e\\n\\n\u003cp\u003e1) Why did we not detect the deadlock when Thread0 did Deadlock.look()?  The locks were the same at that point.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) Why in the timeout case do we do a second Deadlock.look on Thread0?\u003c\\/p\u003e\\n\\n\u003cp\u003e3) Should the order of the LockControl objects matter?\u003c\\/p\u003e\\n\\n\u003cp\u003e4) Could someone give me a high level description of the arguments to Deadlock.look()\u003cbr\\/\u003e\\nstatic Object[] look(SinglePool factory, LockSet set, LockControl control, ActiveLock startingLock, byte deadlockWake) {\u003cbr\\/\u003e\\nThere is no javadoc.  I would be happy to add some if someone could post the information here.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655720_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655720_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 18:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T18:06:59+0000\'\u003e11\\/Dec\\/08 18:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I did the runs with some additional  println\'s.   \\n1) Upon entering Deadlock.look, I print: \\nSystem.out.println(Thread.currentThread().getName() + \\\" Deadlock look\\\"); \\n        System.out.println(set.toDebugString()); \\n2) Upon entering the block of code Knut mentioned I print   \\n   if (lock.canSkip) { \\n                System.out.println(\\\"rollback(chain). Not a deadlock\\\"); \\n\\n Here is the output of the run with deadlock TryTimeout2.out.10_1.deadlock and the run with timeout TryTimeout2.out.10_1.locktimeout. \\n\\n In both cases it first does a Deadlock.look for Thread0 which does not detect any deadlocks. \\n\\n On the Deadlock.look for Thread1  we see it pass through the \\\"Not a deadlock\\\" line for the deadlock case, not the lock timeout case, which is the reverse of what I would expect if that code were the problem. \\n\\n What I do notice is that always when we deadlock the lock &#91;0&#93;  and lock &#91;1&#93;   of the Thread1 LockControl objects are in the reverse order from the timeout run.  Perhaps there is some problem in the logic when they are ordered in this way. \\n\\n A few general things I don\'t understand. Sorry for my newbieness. \\n\\n 1) Why did we not detect the deadlock when Thread0 did Deadlock.look()?  The locks were the same at that point. \\n\\n 2) Why in the timeout case do we do a second Deadlock.look on Thread0? \\n\\n 3) Should the order of the LockControl objects matter? \\n\\n 4) Could someone give me a high level description of the arguments to Deadlock.look() \\nstatic Object[] look(SinglePool factory, LockSet set, LockControl control, ActiveLock startingLock, byte deadlockWake) { \\nThere is no javadoc.  I would be happy to add some if someone could post the information here.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655725\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655725&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655725\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12655725_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655725_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 18:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T18:34:49+0000\'\u003e11\\/Dec\\/08 18:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t have answers, but more questions.  It looks like there are also timing bugs going on.  It might help if the program dumped more timing information along with print outs.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor the timeout case, ignoring that it should be a deadlock, it seems like we should see a timeout after 60 seconds for Thread0 and then a timeout for Thread1 after 70 seconds, but it looks like they both timeout at the same time.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12655725_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655725_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 18:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T18:34:49+0000\'\u003e11\\/Dec\\/08 18:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t have answers, but more questions.  It looks like there are also timing bugs going on.  It might help if the program dumped more timing information along with print outs. \\n\\n For the timeout case, ignoring that it should be a deadlock, it seems like we should see a timeout after 60 seconds for Thread0 and then a timeout for Thread1 after 70 seconds, but it looks like they both timeout at the same time.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655746\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655746&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655746\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12655746_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655746_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 19:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T19:16:50+0000\'\u003e11\\/Dec\\/08 19:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehow about this as start for the javadoc:\u003cbr\\/\u003e\\n    \\/**\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eDo a deadlock search.\u003c\\/li\u003e\\n\\t\u003cli\u003e&lt;p&gt;\u003c\\/li\u003e\\n\\t\u003cli\u003eWalk through the graph of all locks and search for cycles among\u003c\\/li\u003e\\n\\t\u003cli\u003ethe waiting lock requests which would indicate a deadlock.  A simple\u003c\\/li\u003e\\n\\t\u003cli\u003edeadlock cycle is where the granted locks of waiting compatibility\u003c\\/li\u003e\\n\\t\u003cli\u003espace A is blocking compatibility space B and space B holds locks causing\u003c\\/li\u003e\\n\\t\u003cli\u003espace A to wait.\u003c\\/li\u003e\\n\\t\u003cli\u003e&lt;p&gt;\u003c\\/li\u003e\\n\\t\u003cli\u003eWould be nice to get a better high level description of deadlock\u003c\\/li\u003e\\n\\t\u003cli\u003esearch.\u003c\\/li\u003e\\n\\t\u003cli\u003e&lt;p&gt;\u003cbr\\/\u003e\\n     *\u003c\\/li\u003e\\n\\t\u003cli\u003e@return The identifier to be used to open the conglomerate later.\u003cbr\\/\u003e\\n     *\u003c\\/li\u003e\\n\\t\u003cli\u003e@param factory       The locking system factory\u003c\\/li\u003e\\n\\t\u003cli\u003e@param set           The complete lock table. A lock table is a hash\u003c\\/li\u003e\\n\\t\u003cli\u003etable keyed by a Lockable and with a LockControl as\u003c\\/li\u003e\\n\\t\u003cli\u003ethe data element.\u003c\\/li\u003e\\n\\t\u003cli\u003e@param control       A LockControl contains a reference to the item being\u003c\\/li\u003e\\n\\t\u003cli\u003elocked and doubly linked lists for the granted locks\u003c\\/li\u003e\\n\\t\u003cli\u003eand the waiting locks.  The passed in value is the\u003c\\/li\u003e\\n\\t\u003cli\u003elock that the caller was waiting on when woken up\u003c\\/li\u003e\\n\\t\u003cli\u003eto do the deadlock check.\u003c\\/li\u003e\\n\\t\u003cli\u003e@param startingLock  represents the specific waiting lock request that\u003c\\/li\u003e\\n\\t\u003cli\u003ethe caller has been waiting on, before just being\u003c\\/li\u003e\\n\\t\u003cli\u003ewoken up to do this search.\u003c\\/li\u003e\\n\\t\u003cli\u003e@deadlockWake        Either Constants.WAITING_LOCK_IN_WAIT, or\u003c\\/li\u003e\\n\\t\u003cli\u003eConstants.WAITING_LOCK_DEADLOCK.  I am not sure\u003c\\/li\u003e\\n\\t\u003cli\u003eabout this one.\u003cbr\\/\u003e\\n     *\u003c\\/li\u003e\\n\\t\u003cli\u003e@exception  StandardException  Standard exception policy.\u003cbr\\/\u003e\\n     **\\/\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12655746_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655746_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 19:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T19:16:50+0000\'\u003e11\\/Dec\\/08 19:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    how about this as start for the javadoc: \\n    \\/** \\n \\n\\t Do a deadlock search. \\n\\t &lt;p&gt; \\n\\t Walk through the graph of all locks and search for cycles among \\n\\t the waiting lock requests which would indicate a deadlock.  A simple \\n\\t deadlock cycle is where the granted locks of waiting compatibility \\n\\t space A is blocking compatibility space B and space B holds locks causing \\n\\t space A to wait. \\n\\t &lt;p&gt; \\n\\t Would be nice to get a better high level description of deadlock \\n\\t search. \\n\\t &lt;p&gt; \\n     * \\n\\t @return The identifier to be used to open the conglomerate later. \\n     * \\n\\t @param factory       The locking system factory \\n\\t @param set           The complete lock table. A lock table is a hash \\n\\t table keyed by a Lockable and with a LockControl as \\n\\t the data element. \\n\\t @param control       A LockControl contains a reference to the item being \\n\\t locked and doubly linked lists for the granted locks \\n\\t and the waiting locks.  The passed in value is the \\n\\t lock that the caller was waiting on when woken up \\n\\t to do the deadlock check. \\n\\t @param startingLock  represents the specific waiting lock request that \\n\\t the caller has been waiting on, before just being \\n\\t woken up to do this search. \\n\\t @deadlockWake        Either Constants.WAITING_LOCK_IN_WAIT, or \\n\\t Constants.WAITING_LOCK_DEADLOCK.  I am not sure \\n\\t about this one. \\n     * \\n\\t @exception  StandardException  Standard exception policy. \\n     **\\/ \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655765\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655765&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655765\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12655765_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655765_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 20:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T20:21:41+0000\'\u003e11\\/Dec\\/08 20:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; 1) Why did we not detect the deadlock when Thread0 did Deadlock.look()? The locks were the same at that point.\u003cbr\\/\u003e\\nTo me this looks like another instance of the bug.  Either thread searching should find the deadlock once they have both gone \u003cbr\\/\u003e\\ninto waiting, which I believe is the case here.  I believe knut\'s comment on canSkip may be relevant.  I still don\'t understand the\u003cbr\\/\u003e\\ncode using skip.  \u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; 3) Should the order of the LockControl objects matter? \u003cbr\\/\u003e\\nIf things are working right deadlock detection should find it no matter what, the order though might change which one is picked as victim.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12655765_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655765_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 20:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T20:21:41+0000\'\u003e11\\/Dec\\/08 20:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; 1) Why did we not detect the deadlock when Thread0 did Deadlock.look()? The locks were the same at that point. \\nTo me this looks like another instance of the bug.  Either thread searching should find the deadlock once they have both gone  \\ninto waiting, which I believe is the case here.  I believe knut\'s comment on canSkip may be relevant.  I still don\'t understand the \\ncode using skip.   \\n\\n &gt; 3) Should the order of the LockControl objects matter?  \\nIf things are working right deadlock detection should find it no matter what, the order though might change which one is picked as victim.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655772\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655772&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655772\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655772_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655772_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 21:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T21:08:41+0000\'\u003e11\\/Dec\\/08 21:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMaybe the ordering was a red herring. Here is another run with timestamps and also with printing out index:\\\" + index +\\\" chain.size():\\\" + chain.size() + \\\" chain.indexOf(grants):\\\" + chain.indexOf(grants) before we evaluate whether to skip.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere the order of the LockSet  is the same for both runs.  \u003c\\/p\u003e\\n\\n\u003cp\u003eThe timestamp for the exceptions in the output is off because the exceptions are accumulated and then print, but the derby.log does show the two lock timeout exceptions with almost the  same timestamp so there does seem to be a bug there. \u003cbr\\/\u003e\\nI will try to make a simpler test case and file a bug for that.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12655772_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655772_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 21:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T21:08:41+0000\'\u003e11\\/Dec\\/08 21:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Maybe the ordering was a red herring. Here is another run with timestamps and also with printing out index:\\\" + index +\\\" chain.size():\\\" + chain.size() + \\\" chain.indexOf(grants):\\\" + chain.indexOf(grants) before we evaluate whether to skip. \\n\\n Here the order of the LockSet  is the same for both runs.   \\n\\n The timestamp for the exceptions in the output is off because the exceptions are accumulated and then print, but the derby.log does show the two lock timeout exceptions with almost the  same timestamp so there does seem to be a bug there.  \\nI will try to make a simpler test case and file a bug for that. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12655791\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12655791&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12655791\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12655791_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655791_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 22:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T22:23:45+0000\'\u003e11\\/Dec\\/08 22:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve stared at the code below and am not clear what it is trying to do.  Main questions are\u003cbr\\/\u003e\\nis it just trying to catch self waits?\u003cbr\\/\u003e\\nand why is canSkip useful to call, what is the code counting on canSkip to tell it?\u003c\\/p\u003e\\n\\n\u003cp\u003eThe case in question, posed as the below comment is:\u003cbr\\/\u003e\\nGranted T0(S), T1(S), T0(U)\u003cbr\\/\u003e\\nWaiting T0(X)\u003cbr\\/\u003e\\nWaiting T1(U)\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat is the expected value of canSkip for the 2 waiting locks.  Looking at the code I think both are going to have canSkip\u003cbr\\/\u003e\\nset to true to indicate that it is ok to grant them in front of other waiting locks, because the space already holds a lock that\u003cbr\\/\u003e\\nis blocking the waiting locks - but only if they are compatible with all other space granted locks.\u003c\\/p\u003e\\n\\n\u003cp\u003e                if (index != -1) {\u003c\\/p\u003e\\n\\n\u003cp\u003e                    \\/\\/ We could be seeing a situation here like\u003cbr\\/\u003e\\n                    \\/\\/ Granted T1\u003c\\/p\u003e\\n{S}, T2{S}\\n\u003cp\u003e                    \\/\\/ Waiting T1\u003c\\/p\u003e\\n{X}\\n\u003cp\u003e - deadlock checking on this\u003cbr\\/\u003e\\n                    \\/\\/\u003cbr\\/\u003e\\n                    \\/\\/ In this case it\'s not a deadlock, although it\u003cbr\\/\u003e\\n                    \\/\\/ depends on the locking policy of the Lockable. E.g.\u003cbr\\/\u003e\\n                    \\/\\/ Granted T1(latch)\u003cbr\\/\u003e\\n                    \\/\\/ Waiting T1(latch)\u003cbr\\/\u003e\\n                    \\/\\/  is a deadlock.\u003cbr\\/\u003e\\n                    \\/\\/\u003c\\/p\u003e\\n\\n\u003cp\u003e                    if ((index == (chain.size() - 1)) ||\u003cbr\\/\u003e\\n                        ((index == (chain.size() - 2))\u003cbr\\/\u003e\\n                        &amp;&amp; (index == (chain.indexOf(grants) - 1)))) {\u003c\\/p\u003e\\n\\n\u003cp\u003e                        \\/\\/ potential self deadlock, but probably not!\u003cbr\\/\u003e\\n                        ActiveLock lock = (ActiveLock) waiters.get(space);\u003c\\/p\u003e\\n\\n\u003cp\u003e                        if (lock.canSkip) \u003c\\/p\u003e\\n{\\n                            \\/\\/ not a deadlock ...\\n                            chain.push(space); \\/\\/ set up as rollback() expects.\\n\\n                            rollback(chain);\\n                            continue outer;\\n                        }\\n\u003cp\u003e                    }\u003c\\/p\u003e\\n\\n\u003cp\u003e                    return Deadlock.handle(factory, chain, index, waiters, deadl\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12655791_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12655791_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/08 22:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-11T22:23:45+0000\'\u003e11\\/Dec\\/08 22:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve stared at the code below and am not clear what it is trying to do.  Main questions are \\nis it just trying to catch self waits? \\nand why is canSkip useful to call, what is the code counting on canSkip to tell it? \\n\\n The case in question, posed as the below comment is: \\nGranted T0(S), T1(S), T0(U) \\nWaiting T0(X) \\nWaiting T1(U) \\n\\n What is the expected value of canSkip for the 2 waiting locks.  Looking at the code I think both are going to have canSkip \\nset to true to indicate that it is ok to grant them in front of other waiting locks, because the space already holds a lock that \\nis blocking the waiting locks - but only if they are compatible with all other space granted locks. \\n\\n                 if (index != -1) { \\n\\n                     \\/\\/ We could be seeing a situation here like \\n                    \\/\\/ Granted T1 \\n{S}, T2{S}\\n                     \\/\\/ Waiting T1 \\n{X}\\n  - deadlock checking on this \\n                    \\/\\/ \\n                    \\/\\/ In this case it\'s not a deadlock, although it \\n                    \\/\\/ depends on the locking policy of the Lockable. E.g. \\n                    \\/\\/ Granted T1(latch) \\n                    \\/\\/ Waiting T1(latch) \\n                    \\/\\/  is a deadlock. \\n                    \\/\\/ \\n\\n                     if ((index == (chain.size() - 1)) || \\n                        ((index == (chain.size() - 2)) \\n                        &amp;&amp; (index == (chain.indexOf(grants) - 1)))) { \\n\\n                         \\/\\/ potential self deadlock, but probably not! \\n                        ActiveLock lock = (ActiveLock) waiters.get(space); \\n\\n                         if (lock.canSkip)  \\n{\\n                            \\/\\/ not a deadlock ...\\n                            chain.push(space); \\/\\/ set up as rollback() expects.\\n\\n                            rollback(chain);\\n                            continue outer;\\n                        }\\n                     } \\n\\n                     return Deadlock.handle(factory, chain, index, waiters, deadl              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12656088\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12656088&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12656088\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12656088_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12656088_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/08 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-12T18:13:20+0000\'\u003e12\\/Dec\\/08 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a trunk patch derby-3980_javadoc_and_test_diff.txt to update the javadoc as Mike suggested and to add a test for this issue which of course currently fails. The test should be ready to add into the suite once the issue is fixed.  Ran javadoc build and saw no warnings.  I\'ll check this in later this afternoon.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12656088_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12656088_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/08 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-12T18:13:20+0000\'\u003e12\\/Dec\\/08 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a trunk patch derby-3980_javadoc_and_test_diff.txt to update the javadoc as Mike suggested and to add a test for this issue which of course currently fails. The test should be ready to add into the suite once the issue is fixed.  Ran javadoc build and saw no warnings.  I\'ll check this in later this afternoon. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12656090\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12656090&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12656090\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12656090_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12656090_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/08 18:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-12T18:14:20+0000\'\u003e12\\/Dec\\/08 18:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ei am wondering if the problem is that lock manager not beeing able to tell the difference for the purpose of deadlock detection\u003cbr\\/\u003e\\nthe case of a waitor on a waitor because of live lock, and a waitor on a waitor because both are blocked.  lockSkip may come into\u003cbr\\/\u003e\\nit.   In this case I think lockSkip is getting set for both waitors, which properly means it is ok for them to skip waitors as they already\u003cbr\\/\u003e\\nhold a lock blocking waitors, but they can\'t get granted now.   \u003c\\/p\u003e\\n\\n\\n\u003cp\u003egranted: T0(S), T1(S), T0(U)\u003cbr\\/\u003e\\nwaiting:  T1(U), T0(X)\u003c\\/p\u003e\\n\\n\u003cp\u003eI think at least in the lastest repro which does 2 deadlock scans something is going wrong during 1st search which misses\u003cbr\\/\u003e\\nthe deadlock with respect to waiting on waitors case.  The problem comes when\u003cbr\\/\u003e\\nwe get to I think T0(X) which is marked waiting on a waitor.  For this we get to the \\\"waiting on a waitor\\\" part of the deadlock search and\u003cbr\\/\u003e\\nit does not push anything on the stack.  Seems like it should push whatever granted locks are incompatible with it. It just changes \u003cbr\\/\u003e\\nthe current search compatibility space to be the waitor space, which may be fine if it is just waiting for waitors in front of it to get \u003cbr\\/\u003e\\ngranted and there is not current incompatible lock.  \u003c\\/p\u003e\\n\\n\u003cp\u003ewe need to make sure any fix does not start giving back false positives for livelock type waits.  The test suite really has almost no\u003cbr\\/\u003e\\ntesting for dealock\\/livelock cases, probably should add some as part of this fix.  The problem in the past has been depending on\u003cbr\\/\u003e\\ntiming it is sometimes hard to guarantee which waiting thread gets the deadlock in a system independent way.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12656090_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12656090_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/08 18:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-12T18:14:20+0000\'\u003e12\\/Dec\\/08 18:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    i am wondering if the problem is that lock manager not beeing able to tell the difference for the purpose of deadlock detection \\nthe case of a waitor on a waitor because of live lock, and a waitor on a waitor because both are blocked.  lockSkip may come into \\nit.   In this case I think lockSkip is getting set for both waitors, which properly means it is ok for them to skip waitors as they already \\nhold a lock blocking waitors, but they can\'t get granted now.    \\n\\n\\n granted: T0(S), T1(S), T0(U) \\nwaiting:  T1(U), T0(X) \\n\\n I think at least in the lastest repro which does 2 deadlock scans something is going wrong during 1st search which misses \\nthe deadlock with respect to waiting on waitors case.  The problem comes when \\nwe get to I think T0(X) which is marked waiting on a waitor.  For this we get to the \\\"waiting on a waitor\\\" part of the deadlock search and \\nit does not push anything on the stack.  Seems like it should push whatever granted locks are incompatible with it. It just changes  \\nthe current search compatibility space to be the waitor space, which may be fine if it is just waiting for waitors in front of it to get  \\ngranted and there is not current incompatible lock.   \\n\\n we need to make sure any fix does not start giving back false positives for livelock type waits.  The test suite really has almost no \\ntesting for dealock\\/livelock cases, probably should add some as part of this fix.  The problem in the past has been depending on \\ntiming it is sometimes hard to guarantee which waiting thread gets the deadlock in a system independent way.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12656157\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12656157&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12656157\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12656157_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12656157_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/08 20:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-12T20:39:36+0000\'\u003e12\\/Dec\\/08 20:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Kathey Marsden - 12\\/Dec\\/08 21:52\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Mike for the tips and recommending tests.  I am studying the code but must admit I am still a bit baffled by it all.\u003cbr\\/\u003e\\nI do think I can help by writing regression tests, so we can feel confident in the fix when we get one.   I\'ll write one for the simple deadlock case that I know works and  I\'d like to write a test for the live lock scenario.  Do I just need three  threads,  2 doing a repeated staggered select and another trying to get in and do an update?\u003c\\/p\u003e\\n\\n\u003cp\u003eAre there any other tests that would be good?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks\u003c\\/p\u003e\\n\\n\u003cp\u003eKathey\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12656157_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12656157_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/08 20:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-12T20:39:36+0000\'\u003e12\\/Dec\\/08 20:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Kathey Marsden - 12\\/Dec\\/08 21:52\\\"\u003eedited\u003c\\/span\u003e                   Thanks Mike for the tips and recommending tests.  I am studying the code but must admit I am still a bit baffled by it all. \\nI do think I can help by writing regression tests, so we can feel confident in the fix when we get one.   I\'ll write one for the simple deadlock case that I know works and  I\'d like to write a test for the live lock scenario.  Do I just need three  threads,  2 doing a repeated staggered select and another trying to get in and do an update? \\n\\n Are there any other tests that would be good? \\n\\n Thanks \\n\\n Kathey              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12656700\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12656700&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12656700\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12656700_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12656700_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Dec\\/08 19:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-15T19:11:04+0000\'\u003e15\\/Dec\\/08 19:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is a test that test for live lock.  I would appreciate it if someone could review to make sure I am testing the right thing.  I have\u003cbr\\/\u003e\\nSelectThread1 - starts right away.\u003cbr\\/\u003e\\nfor 10 tries {\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eselect * from t;\u003cbr\\/\u003e\\n   -wait 3 seconds\u003c\\/li\u003e\\n\\t\u003cli\u003ecommit\u003cbr\\/\u003e\\n}\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eSelectThread2 \u003cbr\\/\u003e\\nWait 1 second then the same as SelectThread1&gt;\u003c\\/p\u003e\\n\\n\u003cp\u003eUpdateThread\u003cbr\\/\u003e\\nWait 2 seconds\u003cbr\\/\u003e\\nUPDATE T SET I = 456 where I = 456\u003c\\/p\u003e\\n\\n\u003cp\u003eDeadlock timeout set to 5 seconds\u003cbr\\/\u003e\\nLock timeout set to 10 seconds.\u003c\\/p\u003e\\n\\n\u003cp\u003eMakes sure the update goes through without exception.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12656700_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12656700_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Dec\\/08 19:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-15T19:11:04+0000\'\u003e15\\/Dec\\/08 19:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is a test that test for live lock.  I would appreciate it if someone could review to make sure I am testing the right thing.  I have \\nSelectThread1 - starts right away. \\nfor 10 tries { \\n \\n\\t select * from t; \\n   -wait 3 seconds \\n\\t commit \\n} \\n \\n\\n\\n SelectThread2  \\nWait 1 second then the same as SelectThread1&gt; \\n\\n UpdateThread \\nWait 2 seconds \\nUPDATE T SET I = 456 where I = 456 \\n\\n Deadlock timeout set to 5 seconds \\nLock timeout set to 10 seconds. \\n\\n Makes sure the update goes through without exception.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12657118\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12657118&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12657118\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12657118_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657118_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/08 19:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-16T19:08:49+0000\'\u003e16\\/Dec\\/08 19:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am attaching an old user case which should show a deadlock but gives lock timeouts.  I think it is just the same as \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3980\\\" title=\\\"Conflicting select then update with REPEATABLE_READ gives lock timeout instead of deadlock\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3980\\\"\u003e\u003cdel\u003eDERBY-3980\u003c\\/del\u003e\u003c\\/a\u003e except with inserts instead of deletes or updates, so I don\'t think it warrants another test.  Posting it here so it can be tried with the fix once there is one and perhaps someone else will see something worthwhile adding to the tests.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12657118_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657118_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/08 19:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-16T19:08:49+0000\'\u003e16\\/Dec\\/08 19:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am attaching an old user case which should show a deadlock but gives lock timeouts.  I think it is just the same as   DERBY-3980   except with inserts instead of deletes or updates, so I don\'t think it warrants another test.  Posting it here so it can be tried with the fix once there is one and perhaps someone else will see something worthwhile adding to the tests. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12657138\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12657138&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12657138\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12657138_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657138_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/08 19:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-16T19:57:41+0000\'\u003e16\\/Dec\\/08 19:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe test looks OK to me. It tests what its class javadoc says (that the two readers don\'t starve the writer). But wasn\'t the point actually to test that the deadlock detection doesn\'t incorrectly report it as a deadlock? I\'m not sure if deadlock detection will be performed in this case. If I understand the description of the test correctly, the update thread will be granted the exclusive lock after two seconds, but deadlock detection is not performed unless it needs to wait more than five seconds.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome minor nits:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThis code in selectWorker() doesn\'t do anything:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e+            if (delay &gt; 0)\u003cbr\\/\u003e\\n+                ;\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThe while loop in selectWorker() checks the exit condition twice, here\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e+            while (!isUpdateDone() &amp;&amp; tries &lt;= 10) {\u003c\\/p\u003e\\n\\n\u003cp\u003eand here\u003c\\/p\u003e\\n\\n\u003cp\u003e+                if (tries == 10)\u003cbr\\/\u003e\\n+                    fail(\\\"Update did not occur after 10 selects\\\");\u003c\\/p\u003e\\n\\n\u003cp\u003eThe first check has no effect currently, and it should probably be removed so that one later doesn\'t disable the last check by accident if one decides to change to some other number of iterations and forgets to update one of the places.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12657138_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657138_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/08 19:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-16T19:57:41+0000\'\u003e16\\/Dec\\/08 19:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The test looks OK to me. It tests what its class javadoc says (that the two readers don\'t starve the writer). But wasn\'t the point actually to test that the deadlock detection doesn\'t incorrectly report it as a deadlock? I\'m not sure if deadlock detection will be performed in this case. If I understand the description of the test correctly, the update thread will be granted the exclusive lock after two seconds, but deadlock detection is not performed unless it needs to wait more than five seconds. \\n\\n Some minor nits: \\n\\n \\n\\t This code in selectWorker() doesn\'t do anything: \\n \\n\\n\\n +            if (delay &gt; 0) \\n+                ; \\n\\n \\n\\t The while loop in selectWorker() checks the exit condition twice, here \\n \\n\\n\\n +            while (!isUpdateDone() &amp;&amp; tries &lt;= 10) { \\n\\n and here \\n\\n +                if (tries == 10) \\n+                    fail(\\\"Update did not occur after 10 selects\\\"); \\n\\n The first check has no effect currently, and it should probably be removed so that one later doesn\'t disable the last check by accident if one decides to change to some other number of iterations and forgets to update one of the places.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12657165\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12657165&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12657165\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12657165_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657165_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/08 21:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-16T21:14:41+0000\'\u003e16\\/Dec\\/08 21:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Knut for looking at the patch.  I committed  revision 727147 for the changes you recommended.  The test for deadlock detection I checked in was Derby3980DeadlockTest.  That test currently fails with a lock timeout, so is not part of the suite.\u003c\\/p\u003e\\n\\n\u003cp\u003eI added LiveLockTest because Mike suggested that we add a test for the live lock scenario as part of this issue, so we make sure we don\'t regress. Perhaps it would have been clearer to open a separate issue.  I hope I understood live lock correctly and that\'s what\'s being tested with LiveLockTest.  If not,  I\'ll try to make another shot at it when I get back from holiday in a few weeks time.  Hopefully  the mysteries of Deadlock.look() will be unlocked during that time and this issue can be resolved. If so the test Derby3980DeadlockTest should be enabled.\u003c\\/p\u003e\\n\\n\u003cp\u003eKathey\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12657165_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657165_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/08 21:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-16T21:14:41+0000\'\u003e16\\/Dec\\/08 21:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Knut for looking at the patch.  I committed  revision 727147 for the changes you recommended.  The test for deadlock detection I checked in was Derby3980DeadlockTest.  That test currently fails with a lock timeout, so is not part of the suite. \\n\\n I added LiveLockTest because Mike suggested that we add a test for the live lock scenario as part of this issue, so we make sure we don\'t regress. Perhaps it would have been clearer to open a separate issue.  I hope I understood live lock correctly and that\'s what\'s being tested with LiveLockTest.  If not,  I\'ll try to make another shot at it when I get back from holiday in a few weeks time.  Hopefully  the mysteries of Deadlock.look() will be unlocked during that time and this issue can be resolved. If so the test Derby3980DeadlockTest should be enabled. \\n\\n Kathey \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12657204\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12657204&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12657204\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12657204_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657204_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/08 22:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-16T22:44:47+0000\'\u003e16\\/Dec\\/08 22:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI understood Mike\'s comment as that we should make sure a livelock wasn\'t detected as a deadlock (false positive) after we make the changes, which means we would have to run deadlock detection on a possible livelock situation in order to test it. I have problems seeing how changes to the deadlock detection algorithm could cause a regression in a test that doesn\'t exercise that algorithm. But I agree that it\'s good to have this test too. Just shortening the deadlock timeout or increasing the time the select threads hold the locks would additionally make it test the deadlock detection algorithm, though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12657204_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657204_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/08 22:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-16T22:44:47+0000\'\u003e16\\/Dec\\/08 22:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I understood Mike\'s comment as that we should make sure a livelock wasn\'t detected as a deadlock (false positive) after we make the changes, which means we would have to run deadlock detection on a possible livelock situation in order to test it. I have problems seeing how changes to the deadlock detection algorithm could cause a regression in a test that doesn\'t exercise that algorithm. But I agree that it\'s good to have this test too. Just shortening the deadlock timeout or increasing the time the select threads hold the locks would additionally make it test the deadlock detection algorithm, though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12657547\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12657547&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12657547\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12657547_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657547_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/08 20:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-17T20:50:15+0000\'\u003e17\\/Dec\\/08 20:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is the updated patch where I confirmed we enter Deadlock.look(). I made the sleep 25 seconds and used the default deadlock and wait timeouts.  I tried just adjusting the deadlock timeout down to achieve the same result, but found we were never entering Deadlock.look(). There seems to be a problem  with the timeout values at least when set low.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12657547_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12657547_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/08 20:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-17T20:50:15+0000\'\u003e17\\/Dec\\/08 20:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is the updated patch where I confirmed we enter Deadlock.look(). I made the sleep 25 seconds and used the default deadlock and wait timeouts.  I tried just adjusting the deadlock timeout down to achieve the same result, but found we were never entering Deadlock.look(). There seems to be a problem  with the timeout values at least when set low.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12658687\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12658687&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12658687\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12658687_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12658687_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/08 22:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-22T22:11:18+0000\'\u003e22\\/Dec\\/08 22:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDo you see the problem with low timeout values if you change the nesting order of the CleanDatabaseTestSetup and the DatabasePropertyTestSetup? Many tests set the timeouts to even lower values (typically 2 seconds deadlock timeout and 4 seconds wait timeout).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12658687_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12658687_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/08 22:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-22T22:11:18+0000\'\u003e22\\/Dec\\/08 22:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Do you see the problem with low timeout values if you change the nesting order of the CleanDatabaseTestSetup and the DatabasePropertyTestSetup? Many tests set the timeouts to even lower values (typically 2 seconds deadlock timeout and 4 seconds wait timeout).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12658710\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12658710&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12658710\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12658710_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12658710_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/08 23:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-22T23:09:02+0000\'\u003e22\\/Dec\\/08 23:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think I see now why we have a problem with a lower deadlock timeout. Since the updater is supposed to be granted the lock after two seconds, we need to set the deadlock timeout to one second in order to trigger the deadlock detection. However, just before the updater has waited for one second, the first select thread releases its lock and wakes up all waiters. This early wakeup makes the updater check if it can obtain the lock, which it can\'t, but it won\'t do a deadlock check. It then goes back to sleep for another second, but before it wakes up to perform deadlock detection, it is granted the lock. (It looks like we allow five early wakeups before we reduce the time to wait for a deadlock. So for each early wakeup, the deadlock timeout is effectively increased. This is probably a good way to do it, since early wakeups indicate that it\'s probably not a deadlock yet.)\u003c\\/p\u003e\\n\\n\u003cp\u003eEasy workaround: Set the deadlock timeout to 1 second, and make the select threads hold the locks for 4 seconds instead of 3 seconds. Then the update thread will wait for two seconds before it gets the early wakeup (because the first select thread releases the lock), and by that time it will already have performed deadlock detection.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12658710_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12658710_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/08 23:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-22T23:09:02+0000\'\u003e22\\/Dec\\/08 23:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think I see now why we have a problem with a lower deadlock timeout. Since the updater is supposed to be granted the lock after two seconds, we need to set the deadlock timeout to one second in order to trigger the deadlock detection. However, just before the updater has waited for one second, the first select thread releases its lock and wakes up all waiters. This early wakeup makes the updater check if it can obtain the lock, which it can\'t, but it won\'t do a deadlock check. It then goes back to sleep for another second, but before it wakes up to perform deadlock detection, it is granted the lock. (It looks like we allow five early wakeups before we reduce the time to wait for a deadlock. So for each early wakeup, the deadlock timeout is effectively increased. This is probably a good way to do it, since early wakeups indicate that it\'s probably not a deadlock yet.) \\n\\n Easy workaround: Set the deadlock timeout to 1 second, and make the select threads hold the locks for 4 seconds instead of 3 seconds. Then the update thread will wait for two seconds before it gets the early wakeup (because the first select thread releases the lock), and by that time it will already have performed deadlock detection.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12662182\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12662182&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12662182\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12662182_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12662182_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/09 00:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-01-09T00:00:31+0000\'\u003e09\\/Jan\\/09 00:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Knut for figuring out how to set the sleep and deadlock timeout. I made the changes you suggested.  Although we are now going through deadlock detection, I am still not entirely sure I am  testing the scenario Mike was worried about.  If you or Mike have any suggestions on more test scenarios, please let me know and I will add them.   I think I will abandon staring at the deadlock detection code for a while.    I hope someone that understands this code better than I will fix this bug.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12662182_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12662182_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/09 00:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-01-09T00:00:31+0000\'\u003e09\\/Jan\\/09 00:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Knut for figuring out how to set the sleep and deadlock timeout. I made the changes you suggested.  Although we are now going through deadlock detection, I am still not entirely sure I am  testing the scenario Mike was worried about.  If you or Mike have any suggestions on more test scenarios, please let me know and I will add them.   I think I will abandon staring at the deadlock detection code for a while.    I hope someone that understands this code better than I will fix this bug.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12726961\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=12726961&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12726961\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12726961_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12726961_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jul\\/09 13:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-07-03T13:33:50+0000\'\u003e03\\/Jul\\/09 13:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTriaged for 10.5.2. Changed component to Services, since that\'s where the deadlock detection code is located.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12726961_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12726961_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jul\\/09 13:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-07-03T13:33:50+0000\'\u003e03\\/Jul\\/09 13:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Triaged for 10.5.2. Changed component to Services, since that\'s where the deadlock detection code is located.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13006414\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=13006414&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13006414\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13006414_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006414_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 14:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T14:04:31+0000\'\u003e14\\/Mar\\/11 14:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a patch for this issue. It\'s essentially the same patch as the 1b patch attached to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-5073\\\" title=\\\"Derby deadlocks without recourse on simultaneous correlated subqueries\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-5073\\\"\u003e\u003cdel\u003eDERBY-5073\u003c\\/del\u003e\u003c\\/a\u003e, only that the code has been re-indented to account for the extra nesting level added in that patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch also adds a regression test with a test case both for this issue and for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-5073\\\" title=\\\"Derby deadlocks without recourse on simultaneous correlated subqueries\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-5073\\\"\u003e\u003cdel\u003eDERBY-5073\u003c\\/del\u003e\u003c\\/a\u003e. The test cases fail with a lock timeout without the fix and pass (get the expected deadlock exception) with the fix.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m running the regression test suites on the patch now and intend to commit it to trunk if the tests pass.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13006414_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006414_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 14:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T14:04:31+0000\'\u003e14\\/Mar\\/11 14:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a patch for this issue. It\'s essentially the same patch as the 1b patch attached to   DERBY-5073  , only that the code has been re-indented to account for the extra nesting level added in that patch. \\n\\n The patch also adds a regression test with a test case both for this issue and for   DERBY-5073  . The test cases fail with a lock timeout without the fix and pass (get the expected deadlock exception) with the fix. \\n\\n I\'m running the regression test suites on the patch now and intend to commit it to trunk if the tests pass.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13006419\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=13006419&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13006419\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_13006419_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006419_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 14:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T14:15:14+0000\'\u003e14\\/Mar\\/11 14:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWow! Now that\'s a test case! \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eSeriously, though, the new tests look excellent; they\'re commented very\u003cbr\\/\u003e\\nwell, and the code is clearly written. There\'s no easy way to write deadlock\u003cbr\\/\u003e\\ntest cases; your effort here should lead the way and make it easier for\u003cbr\\/\u003e\\npeople to write additional deadlock test cases in the future. Thanks very\u003cbr\\/\u003e\\nmuch for taking the time to do so.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s too bad we can\'t set the deadlock timeout to less than a second. Nowadays,\u003cbr\\/\u003e\\nthat\'s an eternity on a modern computer.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_13006419_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006419_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 14:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T14:15:14+0000\'\u003e14\\/Mar\\/11 14:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Wow! Now that\'s a test case!   \\n\\n Seriously, though, the new tests look excellent; they\'re commented very \\nwell, and the code is clearly written. There\'s no easy way to write deadlock \\ntest cases; your effort here should lead the way and make it easier for \\npeople to write additional deadlock test cases in the future. Thanks very \\nmuch for taking the time to do so. \\n\\n It\'s too bad we can\'t set the deadlock timeout to less than a second. Nowadays, \\nthat\'s an eternity on a modern computer. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13006505\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=13006505&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13006505\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13006505_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006505_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 16:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T16:47:21+0000\'\u003e14\\/Mar\\/11 16:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Bryan. I take that as a +1, then. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eCommitted revision 1081455.\u003c\\/p\u003e\\n\\n\u003cp\u003eI agree with your comment about sub-second deadlock timeouts. Actually, one may even consider doing deadlock detection every time a lock cannot be granted immediately. I wouldn\'t think that it would be too expensive, though I\'ve never measured the cost of the deadlock detection, and if you have to wait for a lock, you\'ve lost performance-wise in any case, so one might just as well do the extra check. But that\'s another JIRA issue, I guess...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13006505_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006505_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 16:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T16:47:21+0000\'\u003e14\\/Mar\\/11 16:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Bryan. I take that as a +1, then.   \\n\\n Committed revision 1081455. \\n\\n I agree with your comment about sub-second deadlock timeouts. Actually, one may even consider doing deadlock detection every time a lock cannot be granted immediately. I wouldn\'t think that it would be too expensive, though I\'ve never measured the cost of the deadlock detection, and if you have to wait for a lock, you\'ve lost performance-wise in any case, so one might just as well do the extra check. But that\'s another JIRA issue, I guess...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13008698\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3980?focusedCommentId=13008698&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13008698\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13008698_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13008698_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Mar\\/11 00:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-19T00:25:55+0000\'\u003e19\\/Mar\\/11 00:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eClosing this issue. Thank you Knut for the great fix and figuring out the tricky deadlock code.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13008698_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13008698_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Mar\\/11 00:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-19T00:25:55+0000\'\u003e19\\/Mar\\/11 00:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Closing this issue. Thank you Knut for the great fix and figuring out the tricky deadlock code.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520239607589"> 
    <input type="hidden" title="jira.request.server.time" value="268"> 
    <input type="hidden" title="jira.request.id" value="526x94397591x1"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="3"> 
    <input type="hidden" title="db.reads.time.in.ms" value="41"> 
    <input type="hidden" title="db.conns.time.in.ms" value="49"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 526x94397591x1
	          REQUEST TIMESTAMP : [05/Mar/2018:08:46:47 +0000]
	               REQUEST TIME : 0.2680
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 3

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=23, elapsedTotal=41191017, elapsedMin=578443, elapsedMax=11826656, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=27, elapsedTotal=49451892, elapsedMin=641120, elapsedMax=11863766, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>