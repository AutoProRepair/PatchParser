<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|5f6a0c57734a2be7225fa96ec4959ac81362e936|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"4ad1d4d712660a\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-2911"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-2911] Implement a buffer manager using java.util.concurrent classes - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-2911] Implement a buffer manager using java.util.concurrent classes - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-2911">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-2911" href="/jira/browse/DERBY-2911" id="key-val" rel="12373154">DERBY-2911</a></li>
                </ol>
                <h1 id="summary-val">Implement a buffer manager using java.util.concurrent classes</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-2911"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-2911/DERBY-2911.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-2911/DERBY-2911.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-2911/DERBY-2911.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-2911/DERBY-2911.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/minor.svg" title="Minor - Minor loss of function, or other problem where easy workaround is present." width="16"> Minor </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.4.1.3 ">10.4.1.3</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.4.1.3" title="10.4.1.3 ">10.4.1.3</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+Services" title="Services ">Services</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12373154-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310200" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bug behavior facts" class="name">Bug behavior facts:</strong> 
                      <div id="customfield_12310200-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310200-field"> 
                        <span>Performance</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>There are indications that the buffer manager is a bottleneck for some types of multi-user load. For instance, Anders Morken wrote this in a comment on <a href="https://issues.apache.org/jira/browse/DERBY-1704" title="Allow more concurrency in the lock manager" class="issue-link" data-issue-key="DERBY-1704"><del>DERBY-1704</del></a>: "With a separate table and index for each thread (to remove latch contention and lock waits from the equation) we (...) found that org.apache.derby.impl.services.cache.Clock.find()/release() caused about 5 times more contention than the synchronization in LockSet.lockObject() and LockSet.unlock(). That might be an indicator of where to apply the next push".</p> 
                  <p>It would be interesting to see the scalability and performance of a buffer manager which exploits the concurrency utilities added in Java SE 5.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-2911?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-2911?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-2911?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-2911?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12369173" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12369173/cleaner.diff" draggable="true" data-downloadurl="application/x-subversion-stat:cleaner.diff:https://issues.apache.org/jira/secure/attachment/12369173/cleaner.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12369173/cleaner.diff" title="Latest  08/Nov/07 13:43 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/x-subversion-stat:cleaner.diff:https://issues.apache.org/jira/secure/attachment/12369173/cleaner.diff">cleaner.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-08T13:43:25.521Z">08/Nov/07 13:43</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12369172" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12369172/cleaner.tar" draggable="true" data-downloadurl="application/x-tar:cleaner.tar:https://issues.apache.org/jira/secure/attachment/12369172/cleaner.tar"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12369172/cleaner.tar" title="Latest  08/Nov/07 13:43 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/x-tar:cleaner.tar:https://issues.apache.org/jira/secure/attachment/12369172/cleaner.tar">cleaner.tar</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-08T13:43:25.317Z">08/Nov/07 13:43</time>
                   </dd>
                   <dd class="attachment-size">
                    16 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12365012" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12365012/d2911-1.diff" draggable="true" data-downloadurl="text/plain:d2911-1.diff:https://issues.apache.org/jira/secure/attachment/12365012/d2911-1.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12365012/d2911-1.diff" title="Latest  03/Sep/07 14:07 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-1.diff:https://issues.apache.org/jira/secure/attachment/12365012/d2911-1.diff">d2911-1.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-03T14:07:35.743Z">03/Sep/07 14:07</time>
                   </dd>
                   <dd class="attachment-size">
                    25 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12365013" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12365013/d2911-1.stat" draggable="true" data-downloadurl="text/plain:d2911-1.stat:https://issues.apache.org/jira/secure/attachment/12365013/d2911-1.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12365013/d2911-1.stat" title="Latest  03/Sep/07 14:07 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-1.stat:https://issues.apache.org/jira/secure/attachment/12365013/d2911-1.stat">d2911-1.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-03T14:07:35.894Z">03/Sep/07 14:07</time>
                   </dd>
                   <dd class="attachment-size">
                    0.3 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12371430" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12371430/d2911-10.diff" draggable="true" data-downloadurl="text/plain:d2911-10.diff:https://issues.apache.org/jira/secure/attachment/12371430/d2911-10.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12371430/d2911-10.diff" title="Latest  11/Dec/07 13:57 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-10.diff:https://issues.apache.org/jira/secure/attachment/12371430/d2911-10.diff">d2911-10.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-12-11T13:57:09.732Z">11/Dec/07 13:57</time>
                   </dd>
                   <dd class="attachment-size">
                    16 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12371431" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12371431/d2911-10.stat" draggable="true" data-downloadurl="text/plain:d2911-10.stat:https://issues.apache.org/jira/secure/attachment/12371431/d2911-10.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12371431/d2911-10.stat" title="Latest  11/Dec/07 13:57 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-10.stat:https://issues.apache.org/jira/secure/attachment/12371431/d2911-10.stat">d2911-10.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-12-11T13:57:09.896Z">11/Dec/07 13:57</time>
                   </dd>
                   <dd class="attachment-size">
                    0.2 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12371661" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12371661/d2911-11.diff" draggable="true" data-downloadurl="text/plain:d2911-11.diff:https://issues.apache.org/jira/secure/attachment/12371661/d2911-11.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12371661/d2911-11.diff" title="Latest  14/Dec/07 10:37 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-11.diff:https://issues.apache.org/jira/secure/attachment/12371661/d2911-11.diff">d2911-11.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-12-14T10:37:39.341Z">14/Dec/07 10:37</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12377613" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12377613/d2911-12.diff" draggable="true" data-downloadurl="text/plain:d2911-12.diff:https://issues.apache.org/jira/secure/attachment/12377613/d2911-12.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12377613/d2911-12.diff" title="Latest  11/Mar/08 13:28 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-12.diff:https://issues.apache.org/jira/secure/attachment/12377613/d2911-12.diff">d2911-12.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-03-11T13:28:13.954Z">11/Mar/08 13:28</time>
                   </dd>
                   <dd class="attachment-size">
                    11 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12377698" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12377698/d2911-13.diff" draggable="true" data-downloadurl="text/plain:d2911-13.diff:https://issues.apache.org/jira/secure/attachment/12377698/d2911-13.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12377698/d2911-13.diff" title="Latest  12/Mar/08 14:42 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-13.diff:https://issues.apache.org/jira/secure/attachment/12377698/d2911-13.diff">d2911-13.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-03-12T14:42:45.157Z">12/Mar/08 14:42</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12378718" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12378718/d2911-14.diff" draggable="true" data-downloadurl="application/x-subversion-stat:d2911-14.diff:https://issues.apache.org/jira/secure/attachment/12378718/d2911-14.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12378718/d2911-14.diff" title="Latest  27/Mar/08 13:55 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/x-subversion-stat:d2911-14.diff:https://issues.apache.org/jira/secure/attachment/12378718/d2911-14.diff">d2911-14.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-03-27T13:55:52.925Z">27/Mar/08 13:55</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12378719" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12378719/d2911-15.diff" draggable="true" data-downloadurl="application/x-subversion-stat:d2911-15.diff:https://issues.apache.org/jira/secure/attachment/12378719/d2911-15.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12378719/d2911-15.diff" title="Latest  27/Mar/08 13:55 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/x-subversion-stat:d2911-15.diff:https://issues.apache.org/jira/secure/attachment/12378719/d2911-15.diff">d2911-15.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-03-27T13:55:52.942Z">27/Mar/08 13:55</time>
                   </dd>
                   <dd class="attachment-size">
                    9 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12365085" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12365085/d2911-2.diff" draggable="true" data-downloadurl="text/plain:d2911-2.diff:https://issues.apache.org/jira/secure/attachment/12365085/d2911-2.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12365085/d2911-2.diff" title="Latest  04/Sep/07 14:48 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-2.diff:https://issues.apache.org/jira/secure/attachment/12365085/d2911-2.diff">d2911-2.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-04T14:48:10.313Z">04/Sep/07 14:48</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12365173" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12365173/d2911-3.diff" draggable="true" data-downloadurl="text/plain:d2911-3.diff:https://issues.apache.org/jira/secure/attachment/12365173/d2911-3.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12365173/d2911-3.diff" title="Latest  05/Sep/07 13:40 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-3.diff:https://issues.apache.org/jira/secure/attachment/12365173/d2911-3.diff">d2911-3.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-05T13:40:37.156Z">05/Sep/07 13:40</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12366171" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12366171/d2911-4.diff" draggable="true" data-downloadurl="text/plain:d2911-4.diff:https://issues.apache.org/jira/secure/attachment/12366171/d2911-4.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12366171/d2911-4.diff" title="Latest  19/Sep/07 09:51 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-4.diff:https://issues.apache.org/jira/secure/attachment/12366171/d2911-4.diff">d2911-4.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-19T09:51:59.880Z">19/Sep/07 09:51</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12366292" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12366292/d2911-5.diff" draggable="true" data-downloadurl="text/plain:d2911-5.diff:https://issues.apache.org/jira/secure/attachment/12366292/d2911-5.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12366292/d2911-5.diff" title="Latest  20/Sep/07 15:01 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-5.diff:https://issues.apache.org/jira/secure/attachment/12366292/d2911-5.diff">d2911-5.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-20T15:01:58.816Z">20/Sep/07 15:01</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12366658" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12366658/d2911-6.diff" draggable="true" data-downloadurl="text/plain:d2911-6.diff:https://issues.apache.org/jira/secure/attachment/12366658/d2911-6.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12366658/d2911-6.diff" title="Latest  27/Sep/07 12:05 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-6.diff:https://issues.apache.org/jira/secure/attachment/12366658/d2911-6.diff">d2911-6.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-27T12:05:30.003Z">27/Sep/07 12:05</time>
                   </dd>
                   <dd class="attachment-size">
                    24 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12366659" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12366659/d2911-6.stat" draggable="true" data-downloadurl="text/plain:d2911-6.stat:https://issues.apache.org/jira/secure/attachment/12366659/d2911-6.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12366659/d2911-6.stat" title="Latest  27/Sep/07 12:05 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-6.stat:https://issues.apache.org/jira/secure/attachment/12366659/d2911-6.stat">d2911-6.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-27T12:05:31.587Z">27/Sep/07 12:05</time>
                   </dd>
                   <dd class="attachment-size">
                    0.4 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12366922" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12366922/d2911-7.diff" draggable="true" data-downloadurl="application/octet-stream:d2911-7.diff:https://issues.apache.org/jira/secure/attachment/12366922/d2911-7.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12366922/d2911-7.diff" title="Latest  02/Oct/07 13:56 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/octet-stream:d2911-7.diff:https://issues.apache.org/jira/secure/attachment/12366922/d2911-7.diff">d2911-7.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-10-02T13:56:08.463Z">02/Oct/07 13:56</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12367637" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12367637/d2911-7a.diff" draggable="true" data-downloadurl="application/x-download:d2911-7a.diff:https://issues.apache.org/jira/secure/attachment/12367637/d2911-7a.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12367637/d2911-7a.diff" title="Latest  12/Oct/07 13:53 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/x-download:d2911-7a.diff:https://issues.apache.org/jira/secure/attachment/12367637/d2911-7a.diff">d2911-7a.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-10-12T13:53:21.962Z">12/Oct/07 13:53</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12370817" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12370817/d2911-9.diff" draggable="true" data-downloadurl="text/plain:d2911-9.diff:https://issues.apache.org/jira/secure/attachment/12370817/d2911-9.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12370817/d2911-9.diff" title="Latest  03/Dec/07 10:33 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-9.diff:https://issues.apache.org/jira/secure/attachment/12370817/d2911-9.diff">d2911-9.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-12-03T10:33:24.870Z">03/Dec/07 10:33</time>
                   </dd>
                   <dd class="attachment-size">
                    20 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12370818" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12370818/d2911-9.stat" draggable="true" data-downloadurl="text/plain:d2911-9.stat:https://issues.apache.org/jira/secure/attachment/12370818/d2911-9.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12370818/d2911-9.stat" title="Latest  03/Dec/07 10:33 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-9.stat:https://issues.apache.org/jira/secure/attachment/12370818/d2911-9.stat">d2911-9.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-12-03T10:33:24.983Z">03/Dec/07 10:33</time>
                   </dd>
                   <dd class="attachment-size">
                    0.3 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12376701" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12376701/d2911-enable.diff" draggable="true" data-downloadurl="text/x-patch:d2911-enable.diff:https://issues.apache.org/jira/secure/attachment/12376701/d2911-enable.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12376701/d2911-enable.diff" title="Latest  28/Feb/08 08:15 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/x-patch:d2911-enable.diff:https://issues.apache.org/jira/secure/attachment/12376701/d2911-enable.diff">d2911-enable.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-28T08:15:57.617Z">28/Feb/08 08:15</time>
                   </dd>
                   <dd class="attachment-size">
                    1.0 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12365837" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12365837/d2911-entry-javadoc.diff" draggable="true" data-downloadurl="text/plain:d2911-entry-javadoc.diff:https://issues.apache.org/jira/secure/attachment/12365837/d2911-entry-javadoc.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12365837/d2911-entry-javadoc.diff" title="Latest  14/Sep/07 10:13 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-entry-javadoc.diff:https://issues.apache.org/jira/secure/attachment/12365837/d2911-entry-javadoc.diff">d2911-entry-javadoc.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-14T10:13:30.657Z">14/Sep/07 10:13</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12365001" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12365001/d2911perf.java" draggable="true" data-downloadurl="text/x-java:d2911perf.java:https://issues.apache.org/jira/secure/attachment/12365001/d2911perf.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12365001/d2911perf.java" title="Latest  03/Sep/07 10:06 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/x-java:d2911perf.java:https://issues.apache.org/jira/secure/attachment/12365001/d2911perf.java">d2911perf.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-03T10:06:09.352Z">03/Sep/07 10:06</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12364760" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12364760/d2911-unused.diff" draggable="true" data-downloadurl="text/plain:d2911-unused.diff:https://issues.apache.org/jira/secure/attachment/12364760/d2911-unused.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12364760/d2911-unused.diff" title="Latest  29/Aug/07 11:50 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-unused.diff:https://issues.apache.org/jira/secure/attachment/12364760/d2911-unused.diff">d2911-unused.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-08-29T11:50:44.615Z">29/Aug/07 11:50</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12364761" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12364761/d2911-unused.stat" draggable="true" data-downloadurl="text/plain:d2911-unused.stat:https://issues.apache.org/jira/secure/attachment/12364761/d2911-unused.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12364761/d2911-unused.stat" title="Latest  29/Aug/07 11:50 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:d2911-unused.stat:https://issues.apache.org/jira/secure/attachment/12364761/d2911-unused.stat">d2911-unused.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-08-29T11:50:44.830Z">29/Aug/07 11:50</time>
                   </dd>
                   <dd class="attachment-size">
                    0.7 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12369667" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12369667/derby-2911-8.diff" draggable="true" data-downloadurl="application/x-subversion-stat:derby-2911-8.diff:https://issues.apache.org/jira/secure/attachment/12369667/derby-2911-8.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12369667/derby-2911-8.diff" title="Latest  16/Nov/07 15:22 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/x-subversion-stat:derby-2911-8.diff:https://issues.apache.org/jira/secure/attachment/12369667/derby-2911-8.diff">derby-2911-8.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-16T15:22:54.939Z">16/Nov/07 15:22</time>
                   </dd>
                   <dd class="attachment-size">
                    18 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12369668" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12369668/derby-2911-8.stat" draggable="true" data-downloadurl="application/x-subversion-stat:derby-2911-8.stat:https://issues.apache.org/jira/secure/attachment/12369668/derby-2911-8.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12369668/derby-2911-8.stat" title="Latest  16/Nov/07 15:22 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/x-subversion-stat:derby-2911-8.stat:https://issues.apache.org/jira/secure/attachment/12369668/derby-2911-8.stat">derby-2911-8.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-16T15:22:55.114Z">16/Nov/07 15:22</time>
                   </dd>
                   <dd class="attachment-size">
                    0.4 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12373096" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12373096/perftest.diff" draggable="true" data-downloadurl="text/plain:perftest.diff:https://issues.apache.org/jira/secure/attachment/12373096/perftest.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12373096/perftest.diff" title="Latest  14/Jan/08 16:00 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:perftest.diff:https://issues.apache.org/jira/secure/attachment/12373096/perftest.diff">perftest.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-01-14T16:00:43.735Z">14/Jan/08 16:00</time>
                   </dd>
                   <dd class="attachment-size">
                    47 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12374562" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12374562/perftest.pdf" draggable="true" data-downloadurl="application/pdf:perftest.pdf:https://issues.apache.org/jira/secure/attachment/12374562/perftest.pdf" file-preview-id="12374562" file-preview-title="perftest.pdf" file-preview-type="document"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-pdf" title="PDF File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12374562/perftest.pdf" title="Latest  01/Feb/08 15:51 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/pdf:perftest.pdf:https://issues.apache.org/jira/secure/attachment/12374562/perftest.pdf" file-preview-id="12374562" file-preview-title="perftest.pdf" file-preview-type="document">perftest.pdf</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-01T15:51:27.303Z">01/Feb/08 15:51</time>
                   </dd>
                   <dd class="attachment-size">
                    74 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12373097" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12373097/perftest.stat" draggable="true" data-downloadurl="text/plain:perftest.stat:https://issues.apache.org/jira/secure/attachment/12373097/perftest.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12373097/perftest.stat" title="Latest  14/Jan/08 16:00 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:perftest.stat:https://issues.apache.org/jira/secure/attachment/12373097/perftest.stat">perftest.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-01-14T16:00:47.154Z">14/Jan/08 16:00</time>
                   </dd>
                   <dd class="attachment-size">
                    1.0 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12374561" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12374561/perftest2.diff" draggable="true" data-downloadurl="text/plain:perftest2.diff:https://issues.apache.org/jira/secure/attachment/12374561/perftest2.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12374561/perftest2.diff" title="Latest  01/Feb/08 15:51 - Knut Anders Hatlen" draggable="true" data-downloadurl="text/plain:perftest2.diff:https://issues.apache.org/jira/secure/attachment/12374561/perftest2.diff">perftest2.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-01T15:51:27.086Z">01/Feb/08 15:51</time>
                   </dd>
                   <dd class="attachment-size">
                    47 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12366751" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12366751/perftest6.pdf" draggable="true" data-downloadurl="application/pdf:perftest6.pdf:https://issues.apache.org/jira/secure/attachment/12366751/perftest6.pdf" file-preview-id="12366751" file-preview-title="perftest6.pdf" file-preview-type="document"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-pdf" title="PDF File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12366751/perftest6.pdf" title="Latest  28/Sep/07 15:54 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/pdf:perftest6.pdf:https://issues.apache.org/jira/secure/attachment/12366751/perftest6.pdf" file-preview-id="12366751" file-preview-title="perftest6.pdf" file-preview-type="document">perftest6.pdf</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-09-28T15:54:47.997Z">28/Sep/07 15:54</time>
                   </dd>
                   <dd class="attachment-size">
                    89 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12369774" data-issue-id="12373154" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12369774/poisson_patch8.tar" draggable="true" data-downloadurl="application/x-tar:poisson_patch8.tar:https://issues.apache.org/jira/secure/attachment/12369774/poisson_patch8.tar"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12369774/poisson_patch8.tar" title="Latest  19/Nov/07 10:29 - Knut Anders Hatlen" draggable="true" data-downloadurl="application/x-tar:poisson_patch8.tar:https://issues.apache.org/jira/secure/attachment/12369774/poisson_patch8.tar">poisson_patch8.tar</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-19T10:29:56.355Z">19/Nov/07 10:29</time>
                   </dd>
                   <dd class="attachment-size">
                    20 kB
                   </dd>
                   <dd class="attachment-author">
                    Knut Anders Hatlen
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12389818_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-3479: Changed/unexpected query plan when running test 'lang/predicatePushdown.sql'"> <a href="/jira/browse/DERBY-3479" data-issue-key="DERBY-3479" class="issue-link link-title resolution">DERBY-3479</a> <span class="link-summary">Changed/unexpected query plan when running test 'lang/predicatePushdown.sql'</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12325504_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-698:  Use Java 5 concurrent collections for better concurrency (rather than synchronized collections)"> <a href="/jira/browse/DERBY-698" data-issue-key="DERBY-698" class="issue-link link-title resolution">DERBY-698</a> <span class="link-summary"> Use Java 5 concurrent collections for better concurrency (rather than synchronized collections)</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12379282_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-3092: Use java.util.concurrent in TransactionTable to improve scalability"> <a href="/jira/browse/DERBY-3092" data-issue-key="DERBY-3092" class="issue-link link-title resolution">DERBY-3092</a> <span class="link-summary">Use java.util.concurrent in TransactionTable to improve scalability</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_knutanders" rel="knutanders" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Knut Anders Hatlen&quot;,&quot;emailAddress&quot;:&quot;knut.hatlen@oracle.com&quot;,&quot;username&quot;:&quot;knutanders&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="knutanders"></span></span> Knut Anders Hatlen </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_knutanders" rel="knutanders" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Knut Anders Hatlen&quot;,&quot;emailAddress&quot;:&quot;knut.hatlen@oracle.com&quot;,&quot;username&quot;:&quot;knutanders&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="knutanders"></span></span> Knut Anders Hatlen </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">1</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">1</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="06/Jul/07 09:51"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-07-06T09:51:48+0000">06/Jul/07 09:51</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="29/Jun/09 14:07"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2009-06-29T14:07:10+0000">29/Jun/09 14:07</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="01/Apr/08 09:05"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2008-04-01T09:05:58+0000">01/Apr/08 09:05</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-2911?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-2911?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12523242\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12523242&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12523242\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12523242_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523242_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Aug\\/07 13:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-28T13:57:08+0000\'\u003e28\\/Aug\\/07 13:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am interested in working on this issue. What I would like to\u003cbr\\/\u003e\\nachieve, is to make it possible for different threads to access the\u003cbr\\/\u003e\\nbuffer manager without blocking each other, as long as they request\u003cbr\\/\u003e\\ndifferent objects and the requested objects are present in the\u003cbr\\/\u003e\\ncache. (That is, I think it is OK that accesses to the same object or\u003cbr\\/\u003e\\naccesses that need to fetch an object into the cache might have to\u003cbr\\/\u003e\\nwait for each other, as they do in the current buffer manager.)\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are two ways to achieve this:\u003c\\/p\u003e\\n\\n\u003cp\u003e  1) Rewrite the old buffer manager (Clock) so that it allows more\u003cbr\\/\u003e\\n     concurrent access (possibly splitting the HashMap and changing\u003cbr\\/\u003e\\n     the synchronization model for Clock\\/CachedItem)\u003c\\/p\u003e\\n\\n\u003cp\u003e  2) Write a new buffer manager which uses the concurrency utilities\u003cbr\\/\u003e\\n     in newer Java versions (ConcurrentHashMap, ReentrantLock and\u003cbr\\/\u003e\\n     friends)\u003c\\/p\u003e\\n\\n\u003cp\u003eI like option 2 best myself, mostly because it allows us to reuse the\u003cbr\\/\u003e\\nwheel (concurrency utils) rather than reinventing it. The downside is\u003cbr\\/\u003e\\nthat the old implementation must be kept in the code as long as we\u003cbr\\/\u003e\\nsupport JVMs without the concurrency utilities (JDK 1.4 and\u003cbr\\/\u003e\\nFoundation). Because of the clearly defined interface (CacheManager)\u003cbr\\/\u003e\\nfor the buffer manager, adding an alternative implementation should be\u003cbr\\/\u003e\\ntransparent to the rest of the Derby code, though.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we decide to go for option 2, I will try to implement it\u003cbr\\/\u003e\\nincrementally with these steps\u003c\\/p\u003e\\n\\n\u003cp\u003e  1) Implement a buffer manager with no replacement policy (that is,\u003cbr\\/\u003e\\n     it ignores the maximum size and never throws data out). After\u003cbr\\/\u003e\\n     this step, the buffer manager should allow concurrent access for\u003cbr\\/\u003e\\n     all threads that request different objects.\u003c\\/p\u003e\\n\\n\u003cp\u003e  2) Implement the replacement policy. After this step, the buffer\u003cbr\\/\u003e\\n     manager should be able to throw out objects that have not been\u003cbr\\/\u003e\\n     used for some time, and thereby avoid growing bigger than the\u003cbr\\/\u003e\\n     maximum size.\u003c\\/p\u003e\\n\\n\u003cp\u003e  3) Enable the new buffer manager by default for JDK 1.5 and higher.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn step 2, I think I will stick to the clock algorithm that we\u003cbr\\/\u003e\\ncurrently use. Last year, a Google Summer of Code student investigated\u003cbr\\/\u003e\\ndifferent replacement algorithms for Derby. Although changing the\u003cbr\\/\u003e\\nreplacement algorithm is out of the scope of this issue, he suggested\u003cbr\\/\u003e\\nsome changes to make it easier to switch replacement algorithm. I will\u003cbr\\/\u003e\\nsee if I can get some ideas from his work.\u003c\\/p\u003e\\n\\n\u003cp\u003eComments to this plan would be appreciated.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12523242_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523242_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Aug\\/07 13:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-28T13:57:08+0000\'\u003e28\\/Aug\\/07 13:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am interested in working on this issue. What I would like to \\nachieve, is to make it possible for different threads to access the \\nbuffer manager without blocking each other, as long as they request \\ndifferent objects and the requested objects are present in the \\ncache. (That is, I think it is OK that accesses to the same object or \\naccesses that need to fetch an object into the cache might have to \\nwait for each other, as they do in the current buffer manager.) \\n\\n There are two ways to achieve this: \\n\\n   1) Rewrite the old buffer manager (Clock) so that it allows more \\n     concurrent access (possibly splitting the HashMap and changing \\n     the synchronization model for Clock\\/CachedItem) \\n\\n   2) Write a new buffer manager which uses the concurrency utilities \\n     in newer Java versions (ConcurrentHashMap, ReentrantLock and \\n     friends) \\n\\n I like option 2 best myself, mostly because it allows us to reuse the \\nwheel (concurrency utils) rather than reinventing it. The downside is \\nthat the old implementation must be kept in the code as long as we \\nsupport JVMs without the concurrency utilities (JDK 1.4 and \\nFoundation). Because of the clearly defined interface (CacheManager) \\nfor the buffer manager, adding an alternative implementation should be \\ntransparent to the rest of the Derby code, though. \\n\\n If we decide to go for option 2, I will try to implement it \\nincrementally with these steps \\n\\n   1) Implement a buffer manager with no replacement policy (that is, \\n     it ignores the maximum size and never throws data out). After \\n     this step, the buffer manager should allow concurrent access for \\n     all threads that request different objects. \\n\\n   2) Implement the replacement policy. After this step, the buffer \\n     manager should be able to throw out objects that have not been \\n     used for some time, and thereby avoid growing bigger than the \\n     maximum size. \\n\\n   3) Enable the new buffer manager by default for JDK 1.5 and higher. \\n\\n In step 2, I think I will stick to the clock algorithm that we \\ncurrently use. Last year, a Google Summer of Code student investigated \\ndifferent replacement algorithms for Derby. Although changing the \\nreplacement algorithm is out of the scope of this issue, he suggested \\nsome changes to make it easier to switch replacement algorithm. I will \\nsee if I can get some ideas from his work. \\n\\n Comments to this plan would be appreciated.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12523256\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12523256&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12523256\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"djd\\\" id=\\\"commentauthor_12523256_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=djd\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"djd\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel John Debrunner\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523256_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Aug\\/07 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-28T15:17:49+0000\'\u003e28\\/Aug\\/07 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'d say option 2 is best.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"djd\\\" id=\\\"commentauthor_12523256_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=djd\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"djd\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel John Debrunner\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523256_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Aug\\/07 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-28T15:17:49+0000\'\u003e28\\/Aug\\/07 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'d say option 2 is best.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12523288\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12523288&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12523288\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12523288_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523288_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Aug\\/07 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-28T17:34:16+0000\'\u003e28\\/Aug\\/07 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWould a particular instantiation of the engine ever have more than\u003cbr\\/\u003e\\none buffer manager at a time? How (and why) would a user choose\u003cbr\\/\u003e\\none buffer manager implementation versus the other? Would it\u003cbr\\/\u003e\\nbe as simple as:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eif this is JDK 1.5+, we always unconditionally use the new one\u003c\\/li\u003e\\n\\t\u003cli\u003eif this is JDK 1.4, we always unconditionally use the old one\u003cbr\\/\u003e\\nOr is there some other reason that a user would want to override this?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12523288_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523288_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Aug\\/07 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-28T17:34:16+0000\'\u003e28\\/Aug\\/07 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Would a particular instantiation of the engine ever have more than \\none buffer manager at a time? How (and why) would a user choose \\none buffer manager implementation versus the other? Would it \\nbe as simple as: \\n \\n\\t if this is JDK 1.5+, we always unconditionally use the new one \\n\\t if this is JDK 1.4, we always unconditionally use the old one \\nOr is there some other reason that a user would want to override this? \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12523478\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12523478&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12523478\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12523478_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523478_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/07 06:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-29T06:48:08+0000\'\u003e29\\/Aug\\/07 06:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for your comments, Dan and Bryan.\u003c\\/p\u003e\\n\\n\u003cp\u003eI was thinking about using Derby\'s module loader, which would basically do what Bryan says. With JDK 1.4 or J2ME, the old one is used, and with JDK 1.5+ the new one. It is possible to override the default by specifying -Dderby.module.cacheManager=org.apache.derby... on the command line, but only when using sane builds, I think. Except for the obvious case where there is a bug in the new implementation, I don\'t think users would want to override it. The one thing I can think of, is if the old implementation performs better for a certain load\\/configuration.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12523478_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523478_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/07 06:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-29T06:48:08+0000\'\u003e29\\/Aug\\/07 06:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for your comments, Dan and Bryan. \\n\\n I was thinking about using Derby\'s module loader, which would basically do what Bryan says. With JDK 1.4 or J2ME, the old one is used, and with JDK 1.5+ the new one. It is possible to override the default by specifying -Dderby.module.cacheManager=org.apache.derby... on the command line, but only when using sane builds, I think. Except for the obvious case where there is a bug in the new implementation, I don\'t think users would want to override it. The one thing I can think of, is if the old implementation performs better for a certain load\\/configuration.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12523549\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12523549&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12523549\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12523549_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523549_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/07 11:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-29T11:50:44+0000\'\u003e29\\/Aug\\/07 11:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI noticed that some of the methods in CacheFactory\\/CacheManager are not used. As a first step before starting on a new cache manager, I would like to remove those methods from the interfaces (but I will leave the actual implementations in Clock untouched for now). This way we can avoid having two implementations of something that\'s never used. We can always implement some of the methods later, if we ever need them, but I think it is better to wait until the need arises, rather than to guess now what we might need in the future.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe methods that are not used, are:\u003c\\/p\u003e\\n\\n\u003cp\u003e  CacheFactory.newSizedCacheManager()\u003cbr\\/\u003e\\n  CacheManager.getMaximumSize()\u003cbr\\/\u003e\\n  CacheManager.resize()\u003cbr\\/\u003e\\n  CacheManager.containsKey()\u003cbr\\/\u003e\\n  CacheManager.setUsed()\u003cbr\\/\u003e\\n  CacheManager.getNumberInUse()\u003cbr\\/\u003e\\n  CacheManager.getCacheStats()\u003cbr\\/\u003e\\n  CacheManager.resetCacheStats()\u003cbr\\/\u003e\\n  CacheManager.scan()\u003c\\/p\u003e\\n\\n\u003cp\u003egetCacheStats() and resetCacheStats() are called by other methods (simple forwarding methods), but those methods are never called. The attached patch (d2911-unused) removes all the unused methods, including the methods that call getCacheStats() and resetCacheStats(). suites.All passed. I have also started a derbyall run which has not completed yet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12523549_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523549_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/07 11:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-29T11:50:44+0000\'\u003e29\\/Aug\\/07 11:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I noticed that some of the methods in CacheFactory\\/CacheManager are not used. As a first step before starting on a new cache manager, I would like to remove those methods from the interfaces (but I will leave the actual implementations in Clock untouched for now). This way we can avoid having two implementations of something that\'s never used. We can always implement some of the methods later, if we ever need them, but I think it is better to wait until the need arises, rather than to guess now what we might need in the future. \\n\\n The methods that are not used, are: \\n\\n   CacheFactory.newSizedCacheManager() \\n  CacheManager.getMaximumSize() \\n  CacheManager.resize() \\n  CacheManager.containsKey() \\n  CacheManager.setUsed() \\n  CacheManager.getNumberInUse() \\n  CacheManager.getCacheStats() \\n  CacheManager.resetCacheStats() \\n  CacheManager.scan() \\n\\n getCacheStats() and resetCacheStats() are called by other methods (simple forwarding methods), but those methods are never called. The attached patch (d2911-unused) removes all the unused methods, including the methods that call getCacheStats() and resetCacheStats(). suites.All passed. I have also started a derbyall run which has not completed yet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12523782\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12523782&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12523782\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12523782_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523782_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Aug\\/07 07:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-30T07:08:22+0000\'\u003e30\\/Aug\\/07 07:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted d2911-unused.diff with revision 571055.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12523782_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12523782_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Aug\\/07 07:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-08-30T07:08:22+0000\'\u003e30\\/Aug\\/07 07:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed d2911-unused.diff with revision 571055.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12524488\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12524488&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12524488\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524488_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524488_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/07 10:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-03T10:06:09+0000\'\u003e03\\/Sep\\/07 10:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have written a small test which can be used to measure performance improvements in this issue. It is a multi-threaded test which performs primary-key lookups. Each thread has its own table to work on to avoid contention on latches (which is a scalability issue separate from the one we\'re trying to solve in this JIRA issue).\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s a standalone Java program for now since our JUnit framework doesn\'t support multi-threaded tests yet, as far as I can see. To run the test, use this command line:\u003c\\/p\u003e\\n\\n\u003cp\u003e  java d2911perf &lt;DB-URL&gt; &lt;THREADS&gt; &lt;WARMUP&gt; &lt;COLLECT&gt;\u003c\\/p\u003e\\n\\n\u003cp\u003eThe test will have a warm-up phase of &lt;WARMUP&gt; seconds and collect results for &lt;COLLECT&gt; seconds.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524488_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524488_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/07 10:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-03T10:06:09+0000\'\u003e03\\/Sep\\/07 10:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have written a small test which can be used to measure performance improvements in this issue. It is a multi-threaded test which performs primary-key lookups. Each thread has its own table to work on to avoid contention on latches (which is a scalability issue separate from the one we\'re trying to solve in this JIRA issue). \\n\\n It\'s a standalone Java program for now since our JUnit framework doesn\'t support multi-threaded tests yet, as far as I can see. To run the test, use this command line: \\n\\n   java d2911perf &lt;DB-URL&gt; &lt;THREADS&gt; &lt;WARMUP&gt; &lt;COLLECT&gt; \\n\\n The test will have a warm-up phase of &lt;WARMUP&gt; seconds and collect results for &lt;COLLECT&gt; seconds.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12524519\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12524519&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12524519\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524519_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524519_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/07 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-03T14:07:35+0000\'\u003e03\\/Sep\\/07 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is a partial implementation of a new buffer manager. It adds a class called ConcurrentCache, which implements the CacheManager interface and keeps the cached objects in a ConcurrentHashMap. It also adds ConcurrentCacheFactory, which creates instances of the new cache, and CacheEntry, which represents an entry in the cache and uses a ReentrantLock to protect its internal state from concurrent accesses.\u003c\\/p\u003e\\n\\n\u003cp\u003eCurrently, only basic operations like find, release, release, remove and clean have been implemented. There is no replacement algorithm, which basically means that the cache doesn\'t have a defined maximum size. I managed to run the attached performance test with the patch (manually edited modules.properties to load the new buffer manager). It showed promising results. With 100 threads on a machine with eight CPUs, the throughput was almost doubled. With fewer threads (or fewer CPUs) there was of course less improvement. I didn\'t notice any performance loss for the single-threaded case, though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524519_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524519_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/07 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-03T14:07:35+0000\'\u003e03\\/Sep\\/07 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is a partial implementation of a new buffer manager. It adds a class called ConcurrentCache, which implements the CacheManager interface and keeps the cached objects in a ConcurrentHashMap. It also adds ConcurrentCacheFactory, which creates instances of the new cache, and CacheEntry, which represents an entry in the cache and uses a ReentrantLock to protect its internal state from concurrent accesses. \\n\\n Currently, only basic operations like find, release, release, remove and clean have been implemented. There is no replacement algorithm, which basically means that the cache doesn\'t have a defined maximum size. I managed to run the attached performance test with the patch (manually edited modules.properties to load the new buffer manager). It showed promising results. With 100 threads on a machine with eight CPUs, the throughput was almost doubled. With fewer threads (or fewer CPUs) there was of course less improvement. I didn\'t notice any performance loss for the single-threaded case, though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12524541\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12524541&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12524541\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12524541_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524541_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/07 15:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-03T15:21:27+0000\'\u003e03\\/Sep\\/07 15:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIs there something about our JUnit framework that inhibits multi-threaded tests?\u003cbr\\/\u003e\\nI\'m not sure why JUnit would know or care how many threads you used.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12524541_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524541_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/07 15:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-03T15:21:27+0000\'\u003e03\\/Sep\\/07 15:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Is there something about our JUnit framework that inhibits multi-threaded tests? \\nI\'m not sure why JUnit would know or care how many threads you used.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12524559\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12524559&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12524559\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12524559_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524559_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/07 17:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-03T17:10:14+0000\'\u003e03\\/Sep\\/07 17:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think the main issue is that the JUnit framework (for instance the runner) is not aware of threads spawned from the test method.\u003cbr\\/\u003e\\nIf you don\'t code the waiting for the spawned threads into your test method, JUnit will just complete and continue\\/exit - possibly terminating your threads if the test is the last test to be run. \u003cbr\\/\u003e\\nSecond, you don\'t have any reporting, monitoring or controlling capabilities for the threads.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you write your test method appropriately (some approaches used are Thread.join() or features from the java.util.concurrent package in Java SE 5.0), I think you would be okay. You would just not have any \\\"support functions\\\" from the framework, and would have to do everything yourself.\u003cbr\\/\u003e\\nThere are also a few libraries for writing multithreaded JUnit tests out there (GroboUtils, the TestDecorator approach, maybe more?).\u003c\\/p\u003e\\n\\n\u003cp\u003eOther test frameworks, for instance TestNG, have the possibility to specify how many parallel threads that are running a test method (not to be mixed up with the support to run tests in parallel, taking things like dependencies into account). It is not quite clear to me how success\\/failure is measured, or how the timeout feature is implemented.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12524559_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524559_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/07 17:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-03T17:10:14+0000\'\u003e03\\/Sep\\/07 17:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think the main issue is that the JUnit framework (for instance the runner) is not aware of threads spawned from the test method. \\nIf you don\'t code the waiting for the spawned threads into your test method, JUnit will just complete and continue\\/exit - possibly terminating your threads if the test is the last test to be run.  \\nSecond, you don\'t have any reporting, monitoring or controlling capabilities for the threads. \\n\\n If you write your test method appropriately (some approaches used are Thread.join() or features from the java.util.concurrent package in Java SE 5.0), I think you would be okay. You would just not have any \\\"support functions\\\" from the framework, and would have to do everything yourself. \\nThere are also a few libraries for writing multithreaded JUnit tests out there (GroboUtils, the TestDecorator approach, maybe more?). \\n\\n Other test frameworks, for instance TestNG, have the possibility to specify how many parallel threads that are running a test method (not to be mixed up with the support to run tests in parallel, taking things like dependencies into account). It is not quite clear to me how success\\/failure is measured, or how the timeout feature is implemented.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12524690\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12524690&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12524690\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524690_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524690_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/07 11:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-04T11:39:54+0000\'\u003e04\\/Sep\\/07 11:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI was primarily referring to the performance test framework (JDBCPerfTestCase) which makes it very easy to write single-threaded performance tests, but currently doesn\'t support writing multi-threaded tests. I\'m sure there\'s nothing that prevents us from writing multi-threaded tests provided that we address the challenges summarized by Kristian.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524690_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524690_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/07 11:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-04T11:39:54+0000\'\u003e04\\/Sep\\/07 11:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I was primarily referring to the performance test framework (JDBCPerfTestCase) which makes it very easy to write single-threaded performance tests, but currently doesn\'t support writing multi-threaded tests. I\'m sure there\'s nothing that prevents us from writing multi-threaded tests provided that we address the challenges summarized by Kristian.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12524706\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12524706&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12524706\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524706_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524706_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/07 12:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-04T12:27:53+0000\'\u003e04\\/Sep\\/07 12:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSince the code added by the patch is disabled, there should be little risk of breaking something. I therefore committed it with revision 572645. We would need the classes and the stubs regardless of whether there are comments to the implementation, I think. And you should of course feel free to test it and comment on it.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe simplest way to test it, is to edit the derby.module.cacheManager property in modules.property so that it points to ConcurrentCacheFactory instead of ClockFactory, and recompile. I made that change myself and ran the full JUnit test suite. There was a total of 19 test cases failing (17 errors + 2 failures). Most of them failed because CacheManager.values() is not implemented (used by a VTI). I\'ll investigate the other failures, but it seems at least some of them are caused by the lack of replacement policy so that objects are left in the cache when the test expects them to have been thrown out.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524706_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524706_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/07 12:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-04T12:27:53+0000\'\u003e04\\/Sep\\/07 12:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Since the code added by the patch is disabled, there should be little risk of breaking something. I therefore committed it with revision 572645. We would need the classes and the stubs regardless of whether there are comments to the implementation, I think. And you should of course feel free to test it and comment on it. \\n\\n The simplest way to test it, is to edit the derby.module.cacheManager property in modules.property so that it points to ConcurrentCacheFactory instead of ClockFactory, and recompile. I made that change myself and ran the full JUnit test suite. There was a total of 19 test cases failing (17 errors + 2 failures). Most of them failed because CacheManager.values() is not implemented (used by a VTI). I\'ll investigate the other failures, but it seems at least some of them are caused by the lack of replacement policy so that objects are left in the cache when the test expects them to have been thrown out.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12524745\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12524745&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12524745\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524745_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524745_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/07 14:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-04T14:48:10+0000\'\u003e04\\/Sep\\/07 14:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe attached patch (d2911-2.diff) implements the values() method. With this patch, I only see 13 failures in the JUnit tests. All of the failures are in StatementPlanCacheTest and fail with \\\"expect plan to \u003cspan class=\\\"error\\\"\u003e&#91;be&#93;\u003c\\/span\u003e thrown out\\\". These failures are expected until the replacement policy is in place.\u003c\\/p\u003e\\n\\n\u003cp\u003eCommitted revision 572693.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12524745_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524745_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/07 14:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-04T14:48:10+0000\'\u003e04\\/Sep\\/07 14:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The attached patch (d2911-2.diff) implements the values() method. With this patch, I only see 13 failures in the JUnit tests. All of the failures are in StatementPlanCacheTest and fail with \\\"expect plan to  &#91;be&#93;  thrown out\\\". These failures are expected until the replacement policy is in place. \\n\\n Committed revision 572693.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12524802\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12524802&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12524802\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mkhettry\\\" id=\\\"commentauthor_12524802_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mkhettry\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mkhettry\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Manish Khettry\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524802_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/07 17:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-04T17:53:38+0000\'\u003e04\\/Sep\\/07 17:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne thought on the ConcurrentCache class. Since this is a Java 5 class,  is it possbie to use generics? In this case something like:\u003c\\/p\u003e\\n\\n\u003cp\u003eConcurrentCache&lt;K&gt; {\u003cbr\\/\u003e\\n  private final ConcurrentHashMap&lt;K, CacheEntry&gt; cache;\u003cbr\\/\u003e\\n}\u003c\\/p\u003e\\n\\n\u003cp\u003eI realize that most of (or all) the time, users of this class will be pre jdk 5 classes and this may not buy us all that much but it is still worth doing I think. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mkhettry\\\" id=\\\"commentauthor_12524802_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mkhettry\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mkhettry\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Manish Khettry\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12524802_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/07 17:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-04T17:53:38+0000\'\u003e04\\/Sep\\/07 17:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One thought on the ConcurrentCache class. Since this is a Java 5 class,  is it possbie to use generics? In this case something like: \\n\\n ConcurrentCache&lt;K&gt; { \\n  private final ConcurrentHashMap&lt;K, CacheEntry&gt; cache; \\n} \\n\\n I realize that most of (or all) the time, users of this class will be pre jdk 5 classes and this may not buy us all that much but it is still worth doing I think.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12525012\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12525012&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12525012\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12525012_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12525012_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Sep\\/07 08:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-05T08:19:16+0000\'\u003e05\\/Sep\\/07 08:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Manish, that\'s a great suggestion, but since the objects in the cache need to implement the Cacheable interface and Cacheable.getIdentity() returns an Object, we\'re kind of locked into declaring the hash key as Object. We could work around that problem by casting the identity to the parametrized type K, like\u003c\\/p\u003e\\n\\n\u003cp\u003e    K key = (K) cacheable.getIdentity();\u003cbr\\/\u003e\\n    cache.remove(key);\u003c\\/p\u003e\\n\\n\u003cp\u003ebut that\'ll give us a compile-time warning about an unchecked cast. So until the interfaces that we need to work with are rewritten using generics, I think it\'s best not to parametrize the key type.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12525012_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12525012_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Sep\\/07 08:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-05T08:19:16+0000\'\u003e05\\/Sep\\/07 08:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Manish, that\'s a great suggestion, but since the objects in the cache need to implement the Cacheable interface and Cacheable.getIdentity() returns an Object, we\'re kind of locked into declaring the hash key as Object. We could work around that problem by casting the identity to the parametrized type K, like \\n\\n     K key = (K) cacheable.getIdentity(); \\n    cache.remove(key); \\n\\n but that\'ll give us a compile-time warning about an unchecked cast. So until the interfaces that we need to work with are rewritten using generics, I think it\'s best not to parametrize the key type.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12525094\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12525094&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12525094\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12525094_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12525094_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Sep\\/07 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-05T13:40:37+0000\'\u003e05\\/Sep\\/07 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is a patch (d2911-3.diff) which implements the shutdown method (more code will probably have to go in there when we have a replacement policy and a background writer). The shutdown method ensures that new calls to find() and findCached() return null (and also create() since that\'s how it was implemented in Clock, although the CacheManager interface doesn\'t require that) by setting a volatile boolean flag. It also calls cleanAll() and ageOut() as demanded by CacheManager.shutdown()\'s javadoc (Clock actually calls ageOut() both before and after cleanAll(), but I fail to see why that should make any difference).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12525094_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12525094_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Sep\\/07 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-05T13:40:37+0000\'\u003e05\\/Sep\\/07 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is a patch (d2911-3.diff) which implements the shutdown method (more code will probably have to go in there when we have a replacement policy and a background writer). The shutdown method ensures that new calls to find() and findCached() return null (and also create() since that\'s how it was implemented in Clock, although the CacheManager interface doesn\'t require that) by setting a volatile boolean flag. It also calls cleanAll() and ageOut() as demanded by CacheManager.shutdown()\'s javadoc (Clock actually calls ageOut() both before and after cleanAll(), but I fail to see why that should make any difference).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12525096\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12525096&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12525096\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12525096_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12525096_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Sep\\/07 13:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-05T13:44:29+0000\'\u003e05\\/Sep\\/07 13:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted revision 572953.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12525096_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12525096_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Sep\\/07 13:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-05T13:44:29+0000\'\u003e05\\/Sep\\/07 13:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed revision 572953.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12525706\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12525706&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12525706\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12525706_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12525706_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/07 13:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-07T13:19:54+0000\'\u003e07\\/Sep\\/07 13:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe next step is to implement the replacement algorithm. As I said\u003cbr\\/\u003e\\nearlier, I will use the clock algorithm as the old buffer manager\u003cbr\\/\u003e\\ndoes, but separate the implementation of the buffer manager and the\u003cbr\\/\u003e\\nreplacement algorithm to make it easier to switch to or experiment\u003cbr\\/\u003e\\nwith other algorithms.\u003c\\/p\u003e\\n\\n\u003cp\u003eI was thinking that we could have an interface for the replacement\u003cbr\\/\u003e\\npolicy that would look similar to this:\u003c\\/p\u003e\\n\\n\u003cp\u003einterface ReplacementPolicy {\u003cbr\\/\u003e\\n  Callback insertEntry(CacheEntry e);\u003cbr\\/\u003e\\n  interface Callback \u003c\\/p\u003e\\n{\\n    void access();\\n    void free();\\n  }\\n\u003cp\u003e}\u003c\\/p\u003e\\n\\n\u003cp\u003eSo when ConcurrentCache needs to insert a new entry, it would call\u003cbr\\/\u003e\\nReplacementPolicy.insertEntry() which would find free space (or make\u003cbr\\/\u003e\\nroom) for the new entry. With the clock algorithm, this means moving\u003cbr\\/\u003e\\nthe clock handle until a not recently used entry is found, and\u003cbr\\/\u003e\\npossibly cleaning dirty entries or increasing the size of the\u003cbr\\/\u003e\\nclock. insertEntry() would return a callback object, which\u003cbr\\/\u003e\\nConcurrentCache could use to notify the replacement policy about\u003cbr\\/\u003e\\nevents. Callback.access() would be used to notify that someone\u003cbr\\/\u003e\\naccessed the object, so that it for instance could be marked as\u003cbr\\/\u003e\\nrecently used in the clock, and Callback.free() would mark the entry\u003cbr\\/\u003e\\nas unused\\/invalid and make it available for reuse.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12525706_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12525706_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/07 13:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-07T13:19:54+0000\'\u003e07\\/Sep\\/07 13:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The next step is to implement the replacement algorithm. As I said \\nearlier, I will use the clock algorithm as the old buffer manager \\ndoes, but separate the implementation of the buffer manager and the \\nreplacement algorithm to make it easier to switch to or experiment \\nwith other algorithms. \\n\\n I was thinking that we could have an interface for the replacement \\npolicy that would look similar to this: \\n\\n interface ReplacementPolicy { \\n  Callback insertEntry(CacheEntry e); \\n  interface Callback  \\n{\\n    void access();\\n    void free();\\n  }\\n } \\n\\n So when ConcurrentCache needs to insert a new entry, it would call \\nReplacementPolicy.insertEntry() which would find free space (or make \\nroom) for the new entry. With the clock algorithm, this means moving \\nthe clock handle until a not recently used entry is found, and \\npossibly cleaning dirty entries or increasing the size of the \\nclock. insertEntry() would return a callback object, which \\nConcurrentCache could use to notify the replacement policy about \\nevents. Callback.access() would be used to notify that someone \\naccessed the object, so that it for instance could be marked as \\nrecently used in the clock, and Callback.free() would mark the entry \\nas unused\\/invalid and make it available for reuse.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12526718\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12526718&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12526718\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12526718_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12526718_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/07 09:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-12T09:12:46+0000\'\u003e12\\/Sep\\/07 09:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSome observations on the replacement algorithm in the current buffer\u003cbr\\/\u003e\\nmanager:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) If it is known that there is at least one invalid entry in the\u003cbr\\/\u003e\\ncache, the normal clock rotation algorithm (which scans no more than\u003cbr\\/\u003e\\n20% of the cache) is bypassed and a scan which may go through the\u003cbr\\/\u003e\\nentire cache is performed instead. (The rationale is that we will\u003cbr\\/\u003e\\navoid growing the cache if we don\'t have to.) This is probably OK\u003cbr\\/\u003e\\nsince invalid objects should be rare (normally present only after DROP\u003cbr\\/\u003e\\nTABLE or similar). However, because objects that are about to be\u003cbr\\/\u003e\\ninserted into the cache are regarded as invalid but kept so that they\u003cbr\\/\u003e\\ncan\'t actually be reused by someone else yet, the old buffer manager\u003cbr\\/\u003e\\nhas suffered from starting these scans too frequently (see\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-704\\\" title=\\\"Large page cache kills initial performance\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-704\\\"\u003e\u003cdel\u003eDERBY-704\u003c\\/del\u003e\u003c\\/a\u003e).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe new buffer manager should try to avoid this problem by only\u003cbr\\/\u003e\\nstarting a scan for invalid objects if it knows that there are items\u003cbr\\/\u003e\\nthat have been invalidated by removal.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) When the clock is rotated and the hand sweeps over an unkept, not\u003cbr\\/\u003e\\nrecently used and dirty object, the global synchronization is dropped\u003cbr\\/\u003e\\nand the object is cleaned. After cleaning the object, the global\u003cbr\\/\u003e\\nsynchronization is re-obtained, but then some other thread may have\u003cbr\\/\u003e\\nmoved the clock hand past the cleaned object while the first thread\u003cbr\\/\u003e\\ndidn\'t hold the global synchronization lock. In that case, the first\u003cbr\\/\u003e\\nthread has cleaned an object but is not allowed to reuse its\u003cbr\\/\u003e\\nentry. Perhaps it\'s just a theoretical problem, but this could mean\u003cbr\\/\u003e\\nthat some threads have to write multiple dirty pages to disk before\u003cbr\\/\u003e\\nthey are allowed to insert a new one into the cache.\u003c\\/p\u003e\\n\\n\u003cp\u003eSince the new buffer manager uses synchronization with finer\u003cbr\\/\u003e\\ngranularity, it should avoid this problem by keeping the\u003cbr\\/\u003e\\nsynchronization lock while the object is being cleaned. Then it knows\u003cbr\\/\u003e\\nthat the entry can be reused as soon as the object has been cleaned.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12526718_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12526718_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/07 09:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-12T09:12:46+0000\'\u003e12\\/Sep\\/07 09:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Some observations on the replacement algorithm in the current buffer \\nmanager: \\n\\n 1) If it is known that there is at least one invalid entry in the \\ncache, the normal clock rotation algorithm (which scans no more than \\n20% of the cache) is bypassed and a scan which may go through the \\nentire cache is performed instead. (The rationale is that we will \\navoid growing the cache if we don\'t have to.) This is probably OK \\nsince invalid objects should be rare (normally present only after DROP \\nTABLE or similar). However, because objects that are about to be \\ninserted into the cache are regarded as invalid but kept so that they \\ncan\'t actually be reused by someone else yet, the old buffer manager \\nhas suffered from starting these scans too frequently (see \\n  DERBY-704  ). \\n\\n The new buffer manager should try to avoid this problem by only \\nstarting a scan for invalid objects if it knows that there are items \\nthat have been invalidated by removal. \\n\\n 2) When the clock is rotated and the hand sweeps over an unkept, not \\nrecently used and dirty object, the global synchronization is dropped \\nand the object is cleaned. After cleaning the object, the global \\nsynchronization is re-obtained, but then some other thread may have \\nmoved the clock hand past the cleaned object while the first thread \\ndidn\'t hold the global synchronization lock. In that case, the first \\nthread has cleaned an object but is not allowed to reuse its \\nentry. Perhaps it\'s just a theoretical problem, but this could mean \\nthat some threads have to write multiple dirty pages to disk before \\nthey are allowed to insert a new one into the cache. \\n\\n Since the new buffer manager uses synchronization with finer \\ngranularity, it should avoid this problem by keeping the \\nsynchronization lock while the object is being cleaned. Then it knows \\nthat the entry can be reused as soon as the object has been cleaned.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12527441\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12527441&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12527441\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12527441_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12527441_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/07 10:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-14T10:13:30+0000\'\u003e14\\/Sep\\/07 10:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch d2911-entry-javadoc.diff extends the class javadoc for CacheEntry with descriptions of its different states. I also changed a note in the javadoc which said that one thread could only hold the lock on one CacheEntry at a time to prevent deadlocks. Since the replacement algorithm probably needs to hold the lock on two entries at a time (the entry that is about to be inserted and the entry that is to be evicted), I loosened the single-lock-per-thread requirement. Now the javadoc says that it is OK to hold the lock on two different CacheEntry objects, as long as the first entry to be locked is in the uninitialized state and the second entry is not in the uninitialized state. By enforcing a strict order for obtaining the locks, concurrent threads won\'t run into deadlocks with each other.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12527441_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12527441_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/07 10:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-14T10:13:30+0000\'\u003e14\\/Sep\\/07 10:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch d2911-entry-javadoc.diff extends the class javadoc for CacheEntry with descriptions of its different states. I also changed a note in the javadoc which said that one thread could only hold the lock on one CacheEntry at a time to prevent deadlocks. Since the replacement algorithm probably needs to hold the lock on two entries at a time (the entry that is about to be inserted and the entry that is to be evicted), I loosened the single-lock-per-thread requirement. Now the javadoc says that it is OK to hold the lock on two different CacheEntry objects, as long as the first entry to be locked is in the uninitialized state and the second entry is not in the uninitialized state. By enforcing a strict order for obtaining the locks, concurrent threads won\'t run into deadlocks with each other.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12527445\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12527445&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12527445\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12527445_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12527445_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/07 10:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-14T10:22:42+0000\'\u003e14\\/Sep\\/07 10:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted the javadoc patch with revision 575607.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12527445_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12527445_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/07 10:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-14T10:22:42+0000\'\u003e14\\/Sep\\/07 10:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed the javadoc patch with revision 575607.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12528713\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12528713&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12528713\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528713_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528713_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 09:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T09:50:13+0000\'\u003e19\\/Sep\\/07 09:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a patch (d2911-4.diff) which makes a couple of small changes to ConcurrentCache.java:\u003c\\/p\u003e\\n\\n\u003cp\u003e  1) Make findFreeCacheable() take the CacheEntry as a parameter call setCacheable() on the entry instead of returning a Cacheable. When the replacement algorithm is implemented, findFreeCacheable() is going to need the CacheEntry reference in order to insert the entry into the replacement policy\'s internal data structure (e.g., clock).\u003c\\/p\u003e\\n\\n\u003cp\u003e  2) Make removeEntry() take a key (object identity) instead of a CacheEntry so that it also can be used to remove entries from the cache when setIdentity\\/createIdentity failed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528713_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528713_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 09:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T09:50:13+0000\'\u003e19\\/Sep\\/07 09:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a patch (d2911-4.diff) which makes a couple of small changes to ConcurrentCache.java: \\n\\n   1) Make findFreeCacheable() take the CacheEntry as a parameter call setCacheable() on the entry instead of returning a Cacheable. When the replacement algorithm is implemented, findFreeCacheable() is going to need the CacheEntry reference in order to insert the entry into the replacement policy\'s internal data structure (e.g., clock). \\n\\n   2) Make removeEntry() take a key (object identity) instead of a CacheEntry so that it also can be used to remove entries from the cache when setIdentity\\/createIdentity failed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12528717\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12528717&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12528717\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528717_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528717_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 09:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T09:51:59+0000\'\u003e19\\/Sep\\/07 09:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eReattaching with \\\"grant license...\\\"\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528717_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528717_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 09:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T09:51:59+0000\'\u003e19\\/Sep\\/07 09:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Reattaching with \\\"grant license...\\\"              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12528719\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12528719&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12528719\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528719_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528719_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 09:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T09:59:10+0000\'\u003e19\\/Sep\\/07 09:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted d2911-4 with revision 577224.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528719_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528719_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 09:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T09:59:10+0000\'\u003e19\\/Sep\\/07 09:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed d2911-4 with revision 577224.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12528750\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12528750&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12528750\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528750_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528750_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 13:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T13:00:37+0000\'\u003e19\\/Sep\\/07 13:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSome thoughts about replacement algorithm and synchronization:\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the old cache manager, one basically had a global synchronization lock that every user of the cache needed to obtain before entering the manager. One advantage of that approach is that there can\'t be deadlocks as long as there\'s only one lock. With the more fine-grained synchronization in the new buffer manager, one need to be careful not to introduce the risk of deadlocks.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe current implementation of ConcurrentCache should not be deadlock prone, since each thread never has locked more than one entry in the cache. When the replacement algorithm is implemented it will be more complex, as there will be other data structures that we need to lock.\u003c\\/p\u003e\\n\\n\u003cp\u003eTake for instance insertion of a new item into the cache. Then we at least need to synchronize on (A) the entry to insert, (B) the clock data structure, and (C) the entry to evict from the cache. In a previous comment, I mentioned that it is OK to lock two entries if the first one is about to be inserted and the second one is already in the cache, so locking C while holding the lock on A is OK. But allowing C to be locked while holding the lock on both A and B, would be problematic. If someone calls CacheManager.remove(), we first need to lock the entry that is about to be removed, and then lock the clock data structure to actually remove the entry. This would mean that we obtain the synchronization locks in the order C-&gt;B, which could potentially lead to deadlocks if the insertion of entries had the lock order A-&gt;B-&gt;C.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo solve this, I think we would have to break up the A-&gt;B-&gt;C lock chain somehow. What comes to mind, is that we could unlock B before we lock C, and then reobtain the lock on B after we have locked C. That would leave an open window for others to modify the relationship between B and C for a short while, so we would have to revalidate that what we thought we knew is still true.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo instead of doing this\u003c\\/p\u003e\\n\\n\u003cp\u003elock A (entry to insert)\u003cbr\\/\u003e\\n--&gt;lock B (clock)\u003cbr\\/\u003e\\n----&gt;fetch C (entry to evict) from B\u003cbr\\/\u003e\\n----&gt;lock C\u003cbr\\/\u003e\\n------&gt;reuse Cacheable from C in A\u003cbr\\/\u003e\\n------&gt;remove C from B\u003cbr\\/\u003e\\n------&gt;unlock C\u003cbr\\/\u003e\\n----&gt;insert A into B\u003cbr\\/\u003e\\n----&gt;unlock B\u003cbr\\/\u003e\\n--&gt;unlock A\u003cbr\\/\u003e\\nreturn\u003c\\/p\u003e\\n\\n\u003cp\u003ewe could do this\u003c\\/p\u003e\\n\\n\u003cp\u003elock A (entry to insert)\u003cbr\\/\u003e\\n--&gt;lock B (clock)\u003cbr\\/\u003e\\n----&gt;fetch C (entry to evict)\u003cbr\\/\u003e\\n----&gt;unlock B\u003cbr\\/\u003e\\n--&gt;lock C\u003cbr\\/\u003e\\n----&gt;validate that no one else evicted C after we unlocked B (otherwise retry the preceding steps)\u003cbr\\/\u003e\\n----&gt;reuse Cacheable from C in A\u003cbr\\/\u003e\\n----&gt;lock B\u003cbr\\/\u003e\\n------&gt;remove C from B\u003cbr\\/\u003e\\n------&gt;unlock B\u003cbr\\/\u003e\\n----&gt;unlock C\u003cbr\\/\u003e\\n--&gt;unlock A\u003cbr\\/\u003e\\nreturn\u003c\\/p\u003e\\n\\n\u003cp\u003eThis way we break down the A-&gt;B-&gt;C locking into the sequences A-&gt;B and by A-&gt;C-&gt;B, none of which conflict with the B-&gt;C locking required by CacheFactory.remove().\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528750_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528750_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 13:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T13:00:37+0000\'\u003e19\\/Sep\\/07 13:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Some thoughts about replacement algorithm and synchronization: \\n\\n In the old cache manager, one basically had a global synchronization lock that every user of the cache needed to obtain before entering the manager. One advantage of that approach is that there can\'t be deadlocks as long as there\'s only one lock. With the more fine-grained synchronization in the new buffer manager, one need to be careful not to introduce the risk of deadlocks. \\n\\n The current implementation of ConcurrentCache should not be deadlock prone, since each thread never has locked more than one entry in the cache. When the replacement algorithm is implemented it will be more complex, as there will be other data structures that we need to lock. \\n\\n Take for instance insertion of a new item into the cache. Then we at least need to synchronize on (A) the entry to insert, (B) the clock data structure, and (C) the entry to evict from the cache. In a previous comment, I mentioned that it is OK to lock two entries if the first one is about to be inserted and the second one is already in the cache, so locking C while holding the lock on A is OK. But allowing C to be locked while holding the lock on both A and B, would be problematic. If someone calls CacheManager.remove(), we first need to lock the entry that is about to be removed, and then lock the clock data structure to actually remove the entry. This would mean that we obtain the synchronization locks in the order C-&gt;B, which could potentially lead to deadlocks if the insertion of entries had the lock order A-&gt;B-&gt;C. \\n\\n To solve this, I think we would have to break up the A-&gt;B-&gt;C lock chain somehow. What comes to mind, is that we could unlock B before we lock C, and then reobtain the lock on B after we have locked C. That would leave an open window for others to modify the relationship between B and C for a short while, so we would have to revalidate that what we thought we knew is still true. \\n\\n So instead of doing this \\n\\n lock A (entry to insert) \\n--&gt;lock B (clock) \\n----&gt;fetch C (entry to evict) from B \\n----&gt;lock C \\n------&gt;reuse Cacheable from C in A \\n------&gt;remove C from B \\n------&gt;unlock C \\n----&gt;insert A into B \\n----&gt;unlock B \\n--&gt;unlock A \\nreturn \\n\\n we could do this \\n\\n lock A (entry to insert) \\n--&gt;lock B (clock) \\n----&gt;fetch C (entry to evict) \\n----&gt;unlock B \\n--&gt;lock C \\n----&gt;validate that no one else evicted C after we unlocked B (otherwise retry the preceding steps) \\n----&gt;reuse Cacheable from C in A \\n----&gt;lock B \\n------&gt;remove C from B \\n------&gt;unlock B \\n----&gt;unlock C \\n--&gt;unlock A \\nreturn \\n\\n This way we break down the A-&gt;B-&gt;C locking into the sequences A-&gt;B and by A-&gt;C-&gt;B, none of which conflict with the B-&gt;C locking required by CacheFactory.remove().              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12528768\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12528768&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12528768\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12528768_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528768_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 13:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T13:57:00+0000\'\u003e19\\/Sep\\/07 13:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e Makes sense to me. The last sentence should probably read:\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"This way we break down the A-&gt;B-&gt;C locking into the sequences A-&gt;B and by A-&gt;C-&gt;B, none of which conflict with the C-&gt;B locking required by CacheFactory.remove().\\\" \u003cbr\\/\u003e\\ni.e.\u003cbr\\/\u003e\\n(C-&gt;B instead of B-&gt;C) ?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12528768_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528768_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 13:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T13:57:00+0000\'\u003e19\\/Sep\\/07 13:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Makes sense to me. The last sentence should probably read: \\n\\n \\\"This way we break down the A-&gt;B-&gt;C locking into the sequences A-&gt;B and by A-&gt;C-&gt;B, none of which conflict with the C-&gt;B locking required by CacheFactory.remove().\\\"  \\ni.e. \\n(C-&gt;B instead of B-&gt;C) ?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12528771\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12528771&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12528771\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528771_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528771_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T14:07:49+0000\'\u003e19\\/Sep\\/07 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Dag! You\'re quite right, it should have said C-&gt;B.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12528771_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12528771_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/07 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-19T14:07:49+0000\'\u003e19\\/Sep\\/07 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Dag! You\'re quite right, it should have said C-&gt;B.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12529019\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12529019&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12529019\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12529019_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12529019_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/07 08:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-20T08:05:08+0000\'\u003e20\\/Sep\\/07 08:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI manually enabled the new buffer manager in modules.properties and ran suites.All + derbyall. The number of test cases failing in suites.All is now 7, of which 6 are expected failures in StatementPlanCacheTest mentioned in a previous comment. The last JUnit failure is in ImportExportTest:client:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) ImportExportTest:clientjava.sql.SQLException: Limitation: Record cannot be updated or inserted due to lack of space on the page. Use the parameters derby.storage.pageSize and\\/or derby.storage.pageReservedSpace to work around this limitation.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn derbyall, 8 tests failed:\u003c\\/p\u003e\\n\\n\u003cp\u003ederbyall\\/derbyall.fail:unit\\/cacheService.unit\u003cbr\\/\u003e\\nderbyall\\/storeall\\/storeall.fail:store\\/rollForwardRecovery.sql\u003cbr\\/\u003e\\nderbyall\\/storeall\\/storeall.fail:store\\/backupRestore1.java\u003cbr\\/\u003e\\nderbyall\\/storeall\\/storeall.fail:store\\/OnlineBackupTest1.java\u003cbr\\/\u003e\\nderbyall\\/storeall\\/storeall.fail:unit\\/T_RawStoreFactory.unit\u003cbr\\/\u003e\\nderbyall\\/storeall\\/storeall.fail:unit\\/T_b2i.unit\u003cbr\\/\u003e\\nderbyall\\/storeall\\/storeall.fail:unit\\/recoveryTest.unit\u003cbr\\/\u003e\\nderbyall\\/storeall\\/storeall.fail:store\\/RecoveryAfterBackup.java\u003c\\/p\u003e\\n\\n\u003cp\u003eAll the failures in derbyall seem to happen because entries are left in the cache in an invalid state if Cacheable.setIdentity() or Cacheable.createIdentity() throws a StandardException. I will fix this by removing the entries whose identity cannot be set\\/created.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12529019_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12529019_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/07 08:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-20T08:05:08+0000\'\u003e20\\/Sep\\/07 08:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I manually enabled the new buffer manager in modules.properties and ran suites.All + derbyall. The number of test cases failing in suites.All is now 7, of which 6 are expected failures in StatementPlanCacheTest mentioned in a previous comment. The last JUnit failure is in ImportExportTest:client: \\n\\n 1) ImportExportTest:clientjava.sql.SQLException: Limitation: Record cannot be updated or inserted due to lack of space on the page. Use the parameters derby.storage.pageSize and\\/or derby.storage.pageReservedSpace to work around this limitation. \\n\\n In derbyall, 8 tests failed: \\n\\n derbyall\\/derbyall.fail:unit\\/cacheService.unit \\nderbyall\\/storeall\\/storeall.fail:store\\/rollForwardRecovery.sql \\nderbyall\\/storeall\\/storeall.fail:store\\/backupRestore1.java \\nderbyall\\/storeall\\/storeall.fail:store\\/OnlineBackupTest1.java \\nderbyall\\/storeall\\/storeall.fail:unit\\/T_RawStoreFactory.unit \\nderbyall\\/storeall\\/storeall.fail:unit\\/T_b2i.unit \\nderbyall\\/storeall\\/storeall.fail:unit\\/recoveryTest.unit \\nderbyall\\/storeall\\/storeall.fail:store\\/RecoveryAfterBackup.java \\n\\n All the failures in derbyall seem to happen because entries are left in the cache in an invalid state if Cacheable.setIdentity() or Cacheable.createIdentity() throws a StandardException. I will fix this by removing the entries whose identity cannot be set\\/created.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12529129\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12529129&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12529129\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12529129_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12529129_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/07 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-20T15:02:00+0000\'\u003e20\\/Sep\\/07 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe attached patch (d2911-5.diff) fixes the problem with invalid entries being left in the cache if Cacheable.setIdentity()\\/createIdentity() fails. Most of the derbyall failures went away. I\'m rerunning the tests now to see if this change introduces any new failures.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12529129_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12529129_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/07 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-20T15:02:00+0000\'\u003e20\\/Sep\\/07 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The attached patch (d2911-5.diff) fixes the problem with invalid entries being left in the cache if Cacheable.setIdentity()\\/createIdentity() fails. Most of the derbyall failures went away. I\'m rerunning the tests now to see if this change introduces any new failures.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12529330\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12529330&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12529330\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12529330_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12529330_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Sep\\/07 07:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-21T07:55:32+0000\'\u003e21\\/Sep\\/07 07:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted d2911-5 with revision 578006.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen I reran suites.All and derbyall with the new buffer manager enabled after applying this patch, I only saw the expected failures in suites.All and two failures in derbyall.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo find out which of the failures that are to be expected when the buffer manager has no replacement algorithm, I ran the regression tests with the old buffer manager modified so that the replacement algorithm wasn\'t used (that is, I hard coded the Clock.maximumSize to Integer.MAX_VALUE). Then I saw the same failures in suites.All, but only one failure in derbyall. That leaves us with one \\\"unexplained\\\" error: unit\\/T_RawStoreFactory.unit which runs out of time.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12529330_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12529330_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Sep\\/07 07:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-21T07:55:32+0000\'\u003e21\\/Sep\\/07 07:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed d2911-5 with revision 578006. \\n\\n When I reran suites.All and derbyall with the new buffer manager enabled after applying this patch, I only saw the expected failures in suites.All and two failures in derbyall. \\n\\n To find out which of the failures that are to be expected when the buffer manager has no replacement algorithm, I ran the regression tests with the old buffer manager modified so that the replacement algorithm wasn\'t used (that is, I hard coded the Clock.maximumSize to Integer.MAX_VALUE). Then I saw the same failures in suites.All, but only one failure in derbyall. That leaves us with one \\\"unexplained\\\" error: unit\\/T_RawStoreFactory.unit which runs out of time.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12529945\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12529945&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12529945\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12529945_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12529945_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/07 19:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-24T19:05:27+0000\'\u003e24\\/Sep\\/07 19:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt seems like the failure in unit\\/T_RawStoreFactory.unit is to be expected too. Hard coding Clock.maximumSize to Integer.MAX_VALUE didn\'t disable all parts of the replacement algorithm. Clock.findFreeItem() would still reuse invalid entries instead of allocating new ones. When I also disabled the reuse of invalid entries, the test failed with Clock as well.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12529945_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12529945_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/07 19:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-24T19:05:27+0000\'\u003e24\\/Sep\\/07 19:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It seems like the failure in unit\\/T_RawStoreFactory.unit is to be expected too. Hard coding Clock.maximumSize to Integer.MAX_VALUE didn\'t disable all parts of the replacement algorithm. Clock.findFreeItem() would still reuse invalid entries instead of allocating new ones. When I also disabled the reuse of invalid entries, the test failed with Clock as well.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12530696\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12530696&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12530696\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12530696_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12530696_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Sep\\/07 12:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-27T12:05:31+0000\'\u003e27\\/Sep\\/07 12:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a new patch (d2911-6.diff) which implements a replacement algorithm using the interface and synchronization model described in the previous comments. The main part of the patch is the new ClockPolicy class and its rotateClock() method. I have done my best to state all requirements about synchronization and lock order in comments, so I hope it is possible for others to understand the code...\u003c\\/p\u003e\\n\\n\u003cp\u003eI manually edited modules.properties to enable the new buffer manager and ran the full regression test suite. suites.All ran successfully, whereas derbyall had one failure. The failure in derbyall was unit\\/T_RawStoreFactory.unit which has been mentioned before. This is an expected failure until reuse of invalid entries has been enabled for caches whose size is smaller than the maximum size.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have not run any performance tests on this last patch, but I will do so. The performance test attached to this issue doesn\'t test the replacement algorithm since it creates just a small database. I will therefore see if I can run some other tests with different buffer sizes and also test it with update load, for instance using the test client attached to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1961\\\" title=\\\"Investigate resource usage for different types of load on an in-memory database\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1961\\\"\u003e\u003cdel\u003eDERBY-1961\u003c\\/del\u003e\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat\'s left to do:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ereuse Cacheable from invalid entries instead of growing the clock when size &lt; maxSize (will fix the failure in unit\\/T_RawStoreFactory.unit)\u003c\\/li\u003e\\n\\t\u003cli\u003eimplement a background cleaner\u003c\\/li\u003e\\n\\t\u003cli\u003eshrink the cache if it exceeds the maximum size\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12530696_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12530696_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Sep\\/07 12:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-27T12:05:31+0000\'\u003e27\\/Sep\\/07 12:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a new patch (d2911-6.diff) which implements a replacement algorithm using the interface and synchronization model described in the previous comments. The main part of the patch is the new ClockPolicy class and its rotateClock() method. I have done my best to state all requirements about synchronization and lock order in comments, so I hope it is possible for others to understand the code... \\n\\n I manually edited modules.properties to enable the new buffer manager and ran the full regression test suite. suites.All ran successfully, whereas derbyall had one failure. The failure in derbyall was unit\\/T_RawStoreFactory.unit which has been mentioned before. This is an expected failure until reuse of invalid entries has been enabled for caches whose size is smaller than the maximum size. \\n\\n I have not run any performance tests on this last patch, but I will do so. The performance test attached to this issue doesn\'t test the replacement algorithm since it creates just a small database. I will therefore see if I can run some other tests with different buffer sizes and also test it with update load, for instance using the test client attached to   DERBY-1961  . \\n\\n What\'s left to do: \\n \\n\\t reuse Cacheable from invalid entries instead of growing the clock when size &lt; maxSize (will fix the failure in unit\\/T_RawStoreFactory.unit) \\n\\t implement a background cleaner \\n\\t shrink the cache if it exceeds the maximum size \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12530942\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12530942&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12530942\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12530942_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12530942_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Sep\\/07 08:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-28T08:37:33+0000\'\u003e28\\/Sep\\/07 08:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI checked in the v6 patch with revision 580252. The new buffer manager is still disabled by default. To test it out, you need to edit modules.properties and replace ClockFactory with ConcurrentCacheFactory.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have run some performance tests with various types of load. The results look promising. I will come back with the details later.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12530942_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12530942_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Sep\\/07 08:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-28T08:37:33+0000\'\u003e28\\/Sep\\/07 08:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I checked in the v6 patch with revision 580252. The new buffer manager is still disabled by default. To test it out, you need to edit modules.properties and replace ClockFactory with ConcurrentCacheFactory. \\n\\n I have run some performance tests with various types of load. The results look promising. I will come back with the details later.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12531061\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12531061&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12531061\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12531061_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12531061_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Sep\\/07 15:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-28T15:54:48+0000\'\u003e28\\/Sep\\/07 15:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI mentioned that I ran some performance tests with the new buffer manager after patch #6. Here\'s a pdf (perftest6.pdf) with the details for those interested in graphs and numbers. I have used the test client attached to this issue and the one attached to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1961\\\" title=\\\"Investigate resource usage for different types of load on an in-memory database\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1961\\\"\u003e\u003cdel\u003eDERBY-1961\u003c\\/del\u003e\u003c\\/a\u003e, so there are numbers for single-record select operations, update operations and two-way joins. To test the replacement algorithm, I varied the page cache size from 40 up to 40000.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe tests were run both on an AMD Opteron with two 2.4 GHz CPUs, and on a Sun Fire T2000, 1.0 GHz with 8 cores\\/32 hardware threads.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe test client attached to this issue was used to show the scalability of the buffer manager. The \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1961\\\" title=\\\"Investigate resource usage for different types of load on an in-memory database\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1961\\\"\u003e\u003cdel\u003eDERBY-1961\u003c\\/del\u003e\u003c\\/a\u003e client was used primarily to test the replacement algorithm, since that client scales poorly because of latch contention on the root node of the B-tree (all threads work on the same table).\u003c\\/p\u003e\\n\\n\u003cp\u003eFor the details, see the pdf, but I\'m pasting the conclusion here:\u003c\\/p\u003e\\n\\n\u003chr \\/\u003e\\n\u003cp\u003eFor most of the loads used in these tests, the new buffer manager performs as good as or better than the old buffer manager. There was one exception: single-record update on Opteron with page cache size 40000. That test was not conclusive, though, as the single run which had highest throughput in that configuration was the new buffer manager with 60 concurrent clients. Overall, the new buffer manager seems to increase the performance.\u003c\\/p\u003e\\n\\n\u003cp\u003eNote that the new buffer manager does not yet implement a background cleaner, which is supposed to increase the likelihood of finding a clean page to evict and thereby making the page replacement algorithm more effective. It is not clear to me whether the existence of a background cleaner affects the performance of these tests.\u003c\\/p\u003e\\n\u003chr \\/\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12531061_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12531061_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Sep\\/07 15:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-09-28T15:54:48+0000\'\u003e28\\/Sep\\/07 15:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I mentioned that I ran some performance tests with the new buffer manager after patch #6. Here\'s a pdf (perftest6.pdf) with the details for those interested in graphs and numbers. I have used the test client attached to this issue and the one attached to   DERBY-1961  , so there are numbers for single-record select operations, update operations and two-way joins. To test the replacement algorithm, I varied the page cache size from 40 up to 40000. \\n\\n The tests were run both on an AMD Opteron with two 2.4 GHz CPUs, and on a Sun Fire T2000, 1.0 GHz with 8 cores\\/32 hardware threads. \\n\\n The test client attached to this issue was used to show the scalability of the buffer manager. The   DERBY-1961   client was used primarily to test the replacement algorithm, since that client scales poorly because of latch contention on the root node of the B-tree (all threads work on the same table). \\n\\n For the details, see the pdf, but I\'m pasting the conclusion here: \\n\\n \\n For most of the loads used in these tests, the new buffer manager performs as good as or better than the old buffer manager. There was one exception: single-record update on Opteron with page cache size 40000. That test was not conclusive, though, as the single run which had highest throughput in that configuration was the new buffer manager with 60 concurrent clients. Overall, the new buffer manager seems to increase the performance. \\n\\n Note that the new buffer manager does not yet implement a background cleaner, which is supposed to increase the likelihood of finding a clean page to evict and thereby making the page replacement algorithm more effective. It is not clear to me whether the existence of a background cleaner affects the performance of these tests. \\n              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12531521\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12531521&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12531521\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12531521_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12531521_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Oct\\/07 14:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-01T14:35:39+0000\'\u003e01\\/Oct\\/07 14:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t understand why unit\\/T_RawStoreFactory.unit fails. Or to be more specific, I don\'t understand the connection between the failure and the buffer manager. The failure is caused by some pages not being freed (that is, marked as free in the alloc page) on a rollback to savepoint in T_RawStoreFactory.P042(). What\'s strange is that\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewith Clock (old buffer manager) it works fine\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhen the scan for invalid items to reuse in Clock.findFreeItem() is commented out, it fails\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewith unmodified Clock, and all test cases except P042() commented out, it fails\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eSo it seems like the result of P042 is somehow dependent on the contents of the page cache (or perhaps the container cache?) when the test case starts, which is strange both because I thought the alloc page didn\'t care whether a page was in the cache or not, and because the test case creates a new container at the beginning so that none of the pages used in the test should be present in the cache anyway.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12531521_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12531521_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Oct\\/07 14:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-01T14:35:39+0000\'\u003e01\\/Oct\\/07 14:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t understand why unit\\/T_RawStoreFactory.unit fails. Or to be more specific, I don\'t understand the connection between the failure and the buffer manager. The failure is caused by some pages not being freed (that is, marked as free in the alloc page) on a rollback to savepoint in T_RawStoreFactory.P042(). What\'s strange is that \\n\\n \\n\\t with Clock (old buffer manager) it works fine \\n \\n\\n\\n \\n\\t when the scan for invalid items to reuse in Clock.findFreeItem() is commented out, it fails \\n \\n\\n\\n \\n\\t with unmodified Clock, and all test cases except P042() commented out, it fails \\n \\n\\n\\n So it seems like the result of P042 is somehow dependent on the contents of the page cache (or perhaps the container cache?) when the test case starts, which is strange both because I thought the alloc page didn\'t care whether a page was in the cache or not, and because the test case creates a new container at the beginning so that none of the pages used in the test should be present in the cache anyway.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12531802\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12531802&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12531802\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12531802_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12531802_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Oct\\/07 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-02T13:56:08+0000\'\u003e02\\/Oct\\/07 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a new patch (d2911-7.diff) which implements reuse of free holder objects if the maximum size of the cache has not been reached (it only touches one file - ClockPolicy.java). The patch fixes the failure in unit\\/T_RawStoreFactory.unit. I have also started the full regression test suite.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe failure in T_RawStoreFactory is still a mystery to me. I ended up with scanning for free items backwards from the end of the clock. If the scan started from the beginning, the test would fail. I suspect that either the test does not test what it\'s supposed to test, or perhaps there is a bug somewhere, but since I see the same failure if I change the scan direction in the old buffer manager, I\'m confident that the buffer manager is not the problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12531802_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12531802_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Oct\\/07 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-02T13:56:08+0000\'\u003e02\\/Oct\\/07 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a new patch (d2911-7.diff) which implements reuse of free holder objects if the maximum size of the cache has not been reached (it only touches one file - ClockPolicy.java). The patch fixes the failure in unit\\/T_RawStoreFactory.unit. I have also started the full regression test suite. \\n\\n The failure in T_RawStoreFactory is still a mystery to me. I ended up with scanning for free items backwards from the end of the clock. If the scan started from the beginning, the test would fail. I suspect that either the test does not test what it\'s supposed to test, or perhaps there is a bug somewhere, but since I see the same failure if I change the scan direction in the old buffer manager, I\'m confident that the buffer manager is not the problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12534027\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12534027&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12534027\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12534027_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12534027_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Oct\\/07 12:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-11T12:40:26+0000\'\u003e11\\/Oct\\/07 12:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNow that the mystery with the failure in T_RawStoreFactory is solved (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3099\\\" title=\\\"Possible bug in interaction with buffer manager causing pages not to be freed on rollback to savepoint\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3099\\\"\u003e\u003cdel\u003eDERBY-3099\u003c\\/del\u003e\u003c\\/a\u003e), I\'ll update the d2911-7 patch so that it scans for unused entries from the beginning of the clock.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12534027_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12534027_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Oct\\/07 12:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-11T12:40:26+0000\'\u003e11\\/Oct\\/07 12:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Now that the mystery with the failure in T_RawStoreFactory is solved (  DERBY-3099  ), I\'ll update the d2911-7 patch so that it scans for unused entries from the beginning of the clock.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12534293\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12534293&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12534293\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12534293_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12534293_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/07 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-12T13:53:22+0000\'\u003e12\\/Oct\\/07 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe attached patch 7a replaces patch 7. It implements reuse of free entries when the cache is smaller than its max size. What\'s changed is that the scan for reusable entries is performed by rotateClock() instead of a separate method. This means that we will also try to reuse free entries when the cache is full and we know there is at least one free entry, even though we didn\'t find a free or evictable entry after scanning 20% of the cache.\u003c\\/p\u003e\\n\\n\u003cp\u003eDerbyall and suites.All both ran cleanly with the new buffer manager enabled in modules.properties.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12534293_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12534293_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/07 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-12T13:53:22+0000\'\u003e12\\/Oct\\/07 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The attached patch 7a replaces patch 7. It implements reuse of free entries when the cache is smaller than its max size. What\'s changed is that the scan for reusable entries is performed by rotateClock() instead of a separate method. This means that we will also try to reuse free entries when the cache is full and we know there is at least one free entry, even though we didn\'t find a free or evictable entry after scanning 20% of the cache. \\n\\n Derbyall and suites.All both ran cleanly with the new buffer manager enabled in modules.properties.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12535162\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12535162&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12535162\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12535162_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12535162_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Oct\\/07 06:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-16T06:51:21+0000\'\u003e16\\/Oct\\/07 06:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted d2911-7a with revision 585060.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12535162_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12535162_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Oct\\/07 06:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-16T06:51:21+0000\'\u003e16\\/Oct\\/07 06:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed d2911-7a with revision 585060.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12536700\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12536700&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12536700\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12536700_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12536700_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Oct\\/07 15:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-22T15:06:18+0000\'\u003e22\\/Oct\\/07 15:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have not implemented a background cleaner for the new buffer manager yet. I will try to implement one that resembles the existing one as much as possible. My understanding is that the background cleaner can be invoked either to clean dirty pages in front of the clock hand, or to shrink the cache if it has grown bigger than its max size. The cleaner is invoked by rotateClock() when it detects that a page needs to be clean (but rotateClock() will clean that page itself), or when it detects that the cache is too large. It then scans the cache, starting right in front of the clock hand, until it finds a page to clean. During the scan, it evicts clean and not recently used pages if the cache needs to shrink. The scan stops when at least one of the following conditions are satisfied:\u003c\\/p\u003e\\n\\n\u003cp\u003e  a) a page has been cleaned\u003cbr\\/\u003e\\n  b) it has seen that 5% of the pages in the cache are clean\u003cbr\\/\u003e\\n  c) it has visited 10% of the pages in the cache\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not sure whether the restriction imposed by condition a, that the background cleaner never cleans more than one page per invocation, is intended or not. Before I started reading the code, I expected the background cleaner to be more aggressive and clean at least a couple of pages before it went back to sleep. In fact, it looks like the intention at some point was that it should requeue itself after writing out the page, as seen by this return statement in Clock.performWork(boolean):\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\tneedService = true;\u003cbr\\/\u003e\\n\\t\\treturn Serviceable.REQUEUE; \\/\\/ return is actually ignored.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reason why the return value is ignored, is that BasicDaemon never requeues a request when the Serviceable is a subscriber. This sounds reasonable, since a subscriber would normally be serviced again later anyway. The background cleaner is however subscribed in onDemandOnly mode, so it won\'t be serviced until it puts a new request in the queue itself.\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes anyone have any details on how the background cleaner is intended to work?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12536700_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12536700_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Oct\\/07 15:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-22T15:06:18+0000\'\u003e22\\/Oct\\/07 15:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have not implemented a background cleaner for the new buffer manager yet. I will try to implement one that resembles the existing one as much as possible. My understanding is that the background cleaner can be invoked either to clean dirty pages in front of the clock hand, or to shrink the cache if it has grown bigger than its max size. The cleaner is invoked by rotateClock() when it detects that a page needs to be clean (but rotateClock() will clean that page itself), or when it detects that the cache is too large. It then scans the cache, starting right in front of the clock hand, until it finds a page to clean. During the scan, it evicts clean and not recently used pages if the cache needs to shrink. The scan stops when at least one of the following conditions are satisfied: \\n\\n   a) a page has been cleaned \\n  b) it has seen that 5% of the pages in the cache are clean \\n  c) it has visited 10% of the pages in the cache \\n\\n I\'m not sure whether the restriction imposed by condition a, that the background cleaner never cleans more than one page per invocation, is intended or not. Before I started reading the code, I expected the background cleaner to be more aggressive and clean at least a couple of pages before it went back to sleep. In fact, it looks like the intention at some point was that it should requeue itself after writing out the page, as seen by this return statement in Clock.performWork(boolean): \\n\\n \\t\\tneedService = true; \\n\\t\\treturn Serviceable.REQUEUE; \\/\\/ return is actually ignored. \\n\\n The reason why the return value is ignored, is that BasicDaemon never requeues a request when the Serviceable is a subscriber. This sounds reasonable, since a subscriber would normally be serviced again later anyway. The background cleaner is however subscribed in onDemandOnly mode, so it won\'t be serviced until it puts a new request in the queue itself. \\n\\n Does anyone have any details on how the background cleaner is intended to work?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12539551\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12539551&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12539551\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dyret\\\" id=\\\"commentauthor_12539551_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dyret\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dyret\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dyre Tjeldvoll\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12539551_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/07 09:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-02T09:45:12+0000\'\u003e02\\/Nov\\/07 09:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Knut, \u003c\\/p\u003e\\n\\n\u003cp\u003eYour interpretation seems reasonable to me. Have you tried\u003cbr\\/\u003e\\nlifting restriction a), so that the background cleaner is allowed\u003cbr\\/\u003e\\nto clean more than one page? Is there a reason not to let the\u003cbr\\/\u003e\\nbackground cleaner re-queue itself?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dyret\\\" id=\\\"commentauthor_12539551_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dyret\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dyret\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dyre Tjeldvoll\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12539551_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/07 09:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-02T09:45:12+0000\'\u003e02\\/Nov\\/07 09:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Knut,  \\n\\n Your interpretation seems reasonable to me. Have you tried \\nlifting restriction a), so that the background cleaner is allowed \\nto clean more than one page? Is there a reason not to let the \\nbackground cleaner re-queue itself?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12539575\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12539575&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12539575\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12539575_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12539575_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/07 13:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-02T13:02:37+0000\'\u003e02\\/Nov\\/07 13:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Have you tried lifting restriction a), so that the background cleaner is allowed to clean more than one page?\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran a small experiment with the test client attached to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1961\\\" title=\\\"Investigate resource usage for different types of load on an in-memory database\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1961\\\"\u003e\u003cdel\u003eDERBY-1961\u003c\\/del\u003e\u003c\\/a\u003e (single-record update transactions), but I couldn\'t see much difference between the runs which had a background cleaner and those which didn\'t have one. I also tried to make the background cleaner write 10 pages instead of 1, but that didn\'t help either. Now, the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1961\\\" title=\\\"Investigate resource usage for different types of load on an in-memory database\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1961\\\"\u003e\u003cdel\u003eDERBY-1961\u003c\\/del\u003e\u003c\\/a\u003e test client uses a relatively small DB (~10MB, I think), and since we don\'t sync after we write a page, I guess most writes only go to the file system cache and are fairly quick. I could try to rerun the experiment with a database that\'s much larger than the physical RAM and see if there\'s a noticeable difference then.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Is there a reason not to let the background cleaner re-queue itself?\u003c\\/p\u003e\\n\\n\u003cp\u003eOnly if the background cleaner slows things down, but then it would be better to disable it alltogether. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI think I\'ll just try to make the new background cleaner behave the same way as the old one (or as close as possible) for now. If we find out later that the current behaviour is not optimal, it shouldn\'t take much work to change it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12539575_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12539575_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/07 13:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-02T13:02:37+0000\'\u003e02\\/Nov\\/07 13:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Have you tried lifting restriction a), so that the background cleaner is allowed to clean more than one page? \\n\\n I ran a small experiment with the test client attached to   DERBY-1961   (single-record update transactions), but I couldn\'t see much difference between the runs which had a background cleaner and those which didn\'t have one. I also tried to make the background cleaner write 10 pages instead of 1, but that didn\'t help either. Now, the   DERBY-1961   test client uses a relatively small DB (~10MB, I think), and since we don\'t sync after we write a page, I guess most writes only go to the file system cache and are fairly quick. I could try to rerun the experiment with a database that\'s much larger than the physical RAM and see if there\'s a noticeable difference then. \\n\\n &gt; Is there a reason not to let the background cleaner re-queue itself? \\n\\n Only if the background cleaner slows things down, but then it would be better to disable it alltogether.   \\n\\n I think I\'ll just try to make the new background cleaner behave the same way as the old one (or as close as possible) for now. If we find out later that the current behaviour is not optimal, it shouldn\'t take much work to change it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12540462\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12540462&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12540462\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12540462_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540462_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/07 15:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-06T15:48:54+0000\'\u003e06\\/Nov\\/07 15:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNow I have tested the buffer manager and background cleaner on a larger\u003cbr\\/\u003e\\ndatabase. I used the test client from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1961\\\" title=\\\"Investigate resource usage for different types of load on an in-memory database\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1961\\\"\u003e\u003cdel\u003eDERBY-1961\u003c\\/del\u003e\u003c\\/a\u003e and turned up the\u003cbr\\/\u003e\\ntable size so that the table took ~14GB and the index ~2GB. I ran the\u003cbr\\/\u003e\\ntest on a dual-CPU AMD Opteron with 2 GB RAM, two SCSI disks (one for\u003cbr\\/\u003e\\nlog and one for data) with the write cache disabled. \u003c\\/p\u003e\\n\\n\u003cp\u003eWith single-record select operations (random primary key lookups)\u003cbr\\/\u003e\\nthere was no difference between the two buffer managers, and there was\u003cbr\\/\u003e\\nno difference between running with or without the background\u003cbr\\/\u003e\\nwriter. Both observations were as expected (there should be no\u003cbr\\/\u003e\\ndifference between the two buffer managers since the performance was\u003cbr\\/\u003e\\ndisk bound and they use the same replacement algorithm, and the\u003cbr\\/\u003e\\nbackground cleaner shouldn\'t have any effect on read-only load). The\u003cbr\\/\u003e\\ntests were repeated with page cache size 1000 (4MB), 10000 (40MB) and\u003cbr\\/\u003e\\n100000 (400MB), with from 1 up to 100 concurrent connections.\u003c\\/p\u003e\\n\\n\u003cp\u003eRunning with single-record update load (random primary key lookup +\u003cbr\\/\u003e\\nupdate of string column not part of the primary key), there wasn\'t any\u003cbr\\/\u003e\\nobservable effect of the background cleaner on that load\u003cbr\\/\u003e\\neither. However, when comparing the two buffer manager against each\u003cbr\\/\u003e\\nother, it seemed that Clock consistently had 3-5% higher throughput\u003cbr\\/\u003e\\nthan ConcurrentCache when the number of concurrent connections\u003cbr\\/\u003e\\nexceeded 5-10. These results were seen both when the page cache size\u003cbr\\/\u003e\\nwas 4MB and when it was 40MB. When it was 400MB, there was no\u003cbr\\/\u003e\\nobservable difference.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo for some reason, it seems like the old buffer manager works better\u003cbr\\/\u003e\\nwhen there\'s a combination of high eviction rate and many dirty pages\u003cbr\\/\u003e\\n(and the db working set is so large that I\\/O operations normally go to\u003cbr\\/\u003e\\ndisk rather than FS buffer). I found that observation a little\u003cbr\\/\u003e\\nstrange, since the performance for this kind of load should be almost\u003cbr\\/\u003e\\nexclusively dependent on the page replacement algorithm, which is\u003cbr\\/\u003e\\nsupposed to be identical in the two buffer managers. The only thing I\u003cbr\\/\u003e\\nknow is different, is what I mentioned in one of my previous comments:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; 2) When the clock is rotated and the hand sweeps over an unkept, not\u003cbr\\/\u003e\\n&gt; recently used and dirty object, the global synchronization is\u003cbr\\/\u003e\\n&gt; dropped and the object is cleaned. After cleaning the object, the\u003cbr\\/\u003e\\n&gt; global synchronization is re-obtained, but then some other thread\u003cbr\\/\u003e\\n&gt; may have moved the clock hand past the cleaned object while the\u003cbr\\/\u003e\\n&gt; first thread didn\'t hold the global synchronization lock. In that\u003cbr\\/\u003e\\n&gt; case, the first thread has cleaned an object but is not allowed to\u003cbr\\/\u003e\\n&gt; reuse its entry. Perhaps it\'s just a theoretical problem, but this\u003cbr\\/\u003e\\n&gt; could mean that some threads have to write multiple dirty pages to\u003cbr\\/\u003e\\n&gt; disk before they are allowed to insert a new one into the cache.\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; Since the new buffer manager uses synchronization with finer\u003cbr\\/\u003e\\n&gt; granularity, it should avoid this problem by keeping the\u003cbr\\/\u003e\\n&gt; synchronization lock while the object is being cleaned. Then it\u003cbr\\/\u003e\\n&gt; knows that the entry can be reused as soon as the object has been\u003cbr\\/\u003e\\n&gt; cleaned.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo it seems we are hitting the behaviour described above. Because the\u003cbr\\/\u003e\\nwrites are likely to go to disk (not only to the file system cache), it\u003cbr\\/\u003e\\nis very likely that the clock hand is moved past the page being\u003cbr\\/\u003e\\nwritten, so that the cleaned page is not evicted, and the thread that\u003cbr\\/\u003e\\ncleaned it has to keep searching for an evictable page.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo verify that this was the cause of the difference in performance, I\u003cbr\\/\u003e\\nchanged ConcurrentCache\\/ClockPolicy so that it would always continue\u003cbr\\/\u003e\\nthe search after it had cleaned a page (that is, the user thread would\u003cbr\\/\u003e\\nclean the page and wait until it had been cleaned, but it would not\u003cbr\\/\u003e\\nevict the page). With this change, the performance of ConcurrentCache\u003cbr\\/\u003e\\nmatched Clock in all the above mentioned tests, with no observable\u003cbr\\/\u003e\\ndifference. Intuitively, I would say that the change would make the\u003cbr\\/\u003e\\nuser threads perform unnecessary work (cleaning pages that they\u003cbr\\/\u003e\\nwouldn\'t use, at least not until the clock hand has rotated another\u003cbr\\/\u003e\\nfull round). However, it seems that there\'s some pipe-lining effect or\u003cbr\\/\u003e\\nsomething that makes it more efficient.\u003c\\/p\u003e\\n\\n\u003cp\u003eI found this observation quite interesting. It\'s kind of like the user\u003cbr\\/\u003e\\nthreads are working as background cleaners for each other. I\'ll do\u003cbr\\/\u003e\\nsome more experimenting and see if I can trick the background cleaner\u003cbr\\/\u003e\\ninto doing the same work. I was thinking that instead of forcing the\u003cbr\\/\u003e\\nuser thread to wait for the page to be cleaned and then continue, it\u003cbr\\/\u003e\\ncould delegate the cleaning to the background cleaner since they won\'t\u003cbr\\/\u003e\\nuse the page anyway and shouldn\'t have to wait.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12540462_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540462_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/07 15:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-06T15:48:54+0000\'\u003e06\\/Nov\\/07 15:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Now I have tested the buffer manager and background cleaner on a larger \\ndatabase. I used the test client from   DERBY-1961   and turned up the \\ntable size so that the table took ~14GB and the index ~2GB. I ran the \\ntest on a dual-CPU AMD Opteron with 2 GB RAM, two SCSI disks (one for \\nlog and one for data) with the write cache disabled.  \\n\\n With single-record select operations (random primary key lookups) \\nthere was no difference between the two buffer managers, and there was \\nno difference between running with or without the background \\nwriter. Both observations were as expected (there should be no \\ndifference between the two buffer managers since the performance was \\ndisk bound and they use the same replacement algorithm, and the \\nbackground cleaner shouldn\'t have any effect on read-only load). The \\ntests were repeated with page cache size 1000 (4MB), 10000 (40MB) and \\n100000 (400MB), with from 1 up to 100 concurrent connections. \\n\\n Running with single-record update load (random primary key lookup + \\nupdate of string column not part of the primary key), there wasn\'t any \\nobservable effect of the background cleaner on that load \\neither. However, when comparing the two buffer manager against each \\nother, it seemed that Clock consistently had 3-5% higher throughput \\nthan ConcurrentCache when the number of concurrent connections \\nexceeded 5-10. These results were seen both when the page cache size \\nwas 4MB and when it was 40MB. When it was 400MB, there was no \\nobservable difference. \\n\\n So for some reason, it seems like the old buffer manager works better \\nwhen there\'s a combination of high eviction rate and many dirty pages \\n(and the db working set is so large that I\\/O operations normally go to \\ndisk rather than FS buffer). I found that observation a little \\nstrange, since the performance for this kind of load should be almost \\nexclusively dependent on the page replacement algorithm, which is \\nsupposed to be identical in the two buffer managers. The only thing I \\nknow is different, is what I mentioned in one of my previous comments: \\n\\n &gt; 2) When the clock is rotated and the hand sweeps over an unkept, not \\n&gt; recently used and dirty object, the global synchronization is \\n&gt; dropped and the object is cleaned. After cleaning the object, the \\n&gt; global synchronization is re-obtained, but then some other thread \\n&gt; may have moved the clock hand past the cleaned object while the \\n&gt; first thread didn\'t hold the global synchronization lock. In that \\n&gt; case, the first thread has cleaned an object but is not allowed to \\n&gt; reuse its entry. Perhaps it\'s just a theoretical problem, but this \\n&gt; could mean that some threads have to write multiple dirty pages to \\n&gt; disk before they are allowed to insert a new one into the cache. \\n&gt; \\n&gt; Since the new buffer manager uses synchronization with finer \\n&gt; granularity, it should avoid this problem by keeping the \\n&gt; synchronization lock while the object is being cleaned. Then it \\n&gt; knows that the entry can be reused as soon as the object has been \\n&gt; cleaned. \\n\\n So it seems we are hitting the behaviour described above. Because the \\nwrites are likely to go to disk (not only to the file system cache), it \\nis very likely that the clock hand is moved past the page being \\nwritten, so that the cleaned page is not evicted, and the thread that \\ncleaned it has to keep searching for an evictable page. \\n\\n To verify that this was the cause of the difference in performance, I \\nchanged ConcurrentCache\\/ClockPolicy so that it would always continue \\nthe search after it had cleaned a page (that is, the user thread would \\nclean the page and wait until it had been cleaned, but it would not \\nevict the page). With this change, the performance of ConcurrentCache \\nmatched Clock in all the above mentioned tests, with no observable \\ndifference. Intuitively, I would say that the change would make the \\nuser threads perform unnecessary work (cleaning pages that they \\nwouldn\'t use, at least not until the clock hand has rotated another \\nfull round). However, it seems that there\'s some pipe-lining effect or \\nsomething that makes it more efficient. \\n\\n I found this observation quite interesting. It\'s kind of like the user \\nthreads are working as background cleaners for each other. I\'ll do \\nsome more experimenting and see if I can trick the background cleaner \\ninto doing the same work. I was thinking that instead of forcing the \\nuser thread to wait for the page to be cleaned and then continue, it \\ncould delegate the cleaning to the background cleaner since they won\'t \\nuse the page anyway and shouldn\'t have to wait.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541049\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12541049&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541049\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12541049_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541049_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Nov\\/07 13:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-08T13:43:25+0000\'\u003e08\\/Nov\\/07 13:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have experimented a little more with the mentioned update load on a\u003cbr\\/\u003e\\nlarge (~16GB) database. What I tried, was to change the rotateClock()\u003cbr\\/\u003e\\nmethod in the new buffer manager so that when it found a dirty and\u003cbr\\/\u003e\\nnot-recently used page, it put the page in a queue which the\u003cbr\\/\u003e\\nbackground writer would process, and go to the next page without\u003cbr\\/\u003e\\nwaiting for the previous page to be written. If the queue grew larger\u003cbr\\/\u003e\\nthan 1\\/10 of the maximum cache size (because the background thread\u003cbr\\/\u003e\\ncouldn\'t clean the pages fast enough to keep up with the user\u003cbr\\/\u003e\\nthreads), the user thread would however clean the page itself instead\u003cbr\\/\u003e\\nof putting the page in the queue.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe attached patch (cleaner.diff) shows this approach. (Note that this\u003cbr\\/\u003e\\npatch is only for testing. It doesn\'t actually use Derby\'s daemon\u003cbr\\/\u003e\\nthread, but a separate thread that just sits and listens to an\u003cbr\\/\u003e\\nArrayBlockingQueue.) I tested it with the update load and page cache\u003cbr\\/\u003e\\nsize 1000, 10000 and 100000, and it seemed to have as good as or\u003cbr\\/\u003e\\nbetter throughput than the old buffer manager in all of these\u003cbr\\/\u003e\\ntests. (Graphs showing the results are contained in the cleaner.tar\u003cbr\\/\u003e\\narchive.)\u003c\\/p\u003e\\n\\n\u003cp\u003eTo me this sounds like a good way to use the background thread, as it\u003cbr\\/\u003e\\noffloads the user threads so that they don\'t need to wait for\u003cbr\\/\u003e\\npotentially slow I\\/O operations. One might of course say that it\'s not\u003cbr\\/\u003e\\nideal, as it cleans pages right behind the clock hand instead of right\u003cbr\\/\u003e\\nin front of it. However, the pages that are cleaned have not been used\u003cbr\\/\u003e\\nduring the last full round on the clock, so it is less likely that\u003cbr\\/\u003e\\nthey will be used on the next round as well, and therefore they\'ll\u003cbr\\/\u003e\\nprobably stay eligible for eviction. Also, if the background cleaner\u003cbr\\/\u003e\\nworks on pages right in front of the hand, it is quite likely that if\u003cbr\\/\u003e\\nit finds a page to write, the user threads will catch up with it and\u003cbr\\/\u003e\\npass it while it\'s performing the I\\/O operation, so that it\u003cbr\\/\u003e\\neffectively ends up cleaning behind the clock hand anyway.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf there are no objections or other good ideas, I will try to use the\u003cbr\\/\u003e\\napproach in cleaner.diff and integrate it with Derby\'s own background\u003cbr\\/\u003e\\nthread.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12541049_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541049_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Nov\\/07 13:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-08T13:43:25+0000\'\u003e08\\/Nov\\/07 13:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have experimented a little more with the mentioned update load on a \\nlarge (~16GB) database. What I tried, was to change the rotateClock() \\nmethod in the new buffer manager so that when it found a dirty and \\nnot-recently used page, it put the page in a queue which the \\nbackground writer would process, and go to the next page without \\nwaiting for the previous page to be written. If the queue grew larger \\nthan 1\\/10 of the maximum cache size (because the background thread \\ncouldn\'t clean the pages fast enough to keep up with the user \\nthreads), the user thread would however clean the page itself instead \\nof putting the page in the queue. \\n\\n The attached patch (cleaner.diff) shows this approach. (Note that this \\npatch is only for testing. It doesn\'t actually use Derby\'s daemon \\nthread, but a separate thread that just sits and listens to an \\nArrayBlockingQueue.) I tested it with the update load and page cache \\nsize 1000, 10000 and 100000, and it seemed to have as good as or \\nbetter throughput than the old buffer manager in all of these \\ntests. (Graphs showing the results are contained in the cleaner.tar \\narchive.) \\n\\n To me this sounds like a good way to use the background thread, as it \\noffloads the user threads so that they don\'t need to wait for \\npotentially slow I\\/O operations. One might of course say that it\'s not \\nideal, as it cleans pages right behind the clock hand instead of right \\nin front of it. However, the pages that are cleaned have not been used \\nduring the last full round on the clock, so it is less likely that \\nthey will be used on the next round as well, and therefore they\'ll \\nprobably stay eligible for eviction. Also, if the background cleaner \\nworks on pages right in front of the hand, it is quite likely that if \\nit finds a page to write, the user threads will catch up with it and \\npass it while it\'s performing the I\\/O operation, so that it \\neffectively ends up cleaning behind the clock hand anyway. \\n\\n If there are no objections or other good ideas, I will try to use the \\napproach in cleaner.diff and integrate it with Derby\'s own background \\nthread.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541262\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12541262&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541262\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jorgenlo\\\" id=\\\"commentauthor_12541262_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jorgenlo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jorgenlo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e J\\u00F8rgen L\\u00F8land\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541262_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/07 09:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-09T09:03:58+0000\'\u003e09\\/Nov\\/07 09:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Knut,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for providing these nice graphs; they make it much easier to understand the effects of the new buffer manager. The results are dramatic in many of the illustrated cases!\u003c\\/p\u003e\\n\\n\u003cp\u003eIntuitively, I would say that your plan of using a more aggressive background cleaner sounds good since user threads are not using the pages they have cleaned (although I don\'t understand why not using that page is better). The graphs also clearly indicate that this approach is better than letting the user thread do the job.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne question: what happens if the clock rotates too fast and reaches a synchronized (due to I\\/O) page? Will it have to wait for the synchronization to be lifted, or can the clock jump to the next page somehow? Since the background cleaner is used to write most of the pages, it (the background cleaner) could potentially be far behind the clock if I understand this correctly. If the clock is unnecessarily blocked by I\\/O it\'s game over \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eOn a side note - why are performance tests in Derby performed with back-to-back transactions rather than using a more realistic (i.e., Poisson distributed) load? Poisson is normally used to simulate the transaction arrival rate from many independent clients \u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e. In your case, I think the background cleaner could perform even better with this (more realistic) workload since it would be scheduled in the short periods with slightly fewer active transactions.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e \u003ca href=\\\"http:\\/\\/en.wikipedia.org\\/wiki\\/Poisson_process\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/en.wikipedia.org\\/wiki\\/Poisson_process\u003c\\/a\u003e\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jorgenlo\\\" id=\\\"commentauthor_12541262_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jorgenlo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jorgenlo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e J\\u00F8rgen L\\u00F8land\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541262_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/07 09:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-09T09:03:58+0000\'\u003e09\\/Nov\\/07 09:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Knut, \\n\\n Thanks for providing these nice graphs; they make it much easier to understand the effects of the new buffer manager. The results are dramatic in many of the illustrated cases! \\n\\n Intuitively, I would say that your plan of using a more aggressive background cleaner sounds good since user threads are not using the pages they have cleaned (although I don\'t understand why not using that page is better). The graphs also clearly indicate that this approach is better than letting the user thread do the job. \\n\\n One question: what happens if the clock rotates too fast and reaches a synchronized (due to I\\/O) page? Will it have to wait for the synchronization to be lifted, or can the clock jump to the next page somehow? Since the background cleaner is used to write most of the pages, it (the background cleaner) could potentially be far behind the clock if I understand this correctly. If the clock is unnecessarily blocked by I\\/O it\'s game over   \\n\\n On a side note - why are performance tests in Derby performed with back-to-back transactions rather than using a more realistic (i.e., Poisson distributed) load? Poisson is normally used to simulate the transaction arrival rate from many independent clients  &#91;1&#93; . In your case, I think the background cleaner could perform even better with this (more realistic) workload since it would be scheduled in the short periods with slightly fewer active transactions. \\n\\n  &#91;1&#93;   http:\\/\\/en.wikipedia.org\\/wiki\\/Poisson_process  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541291\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12541291&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541291\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12541291_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541291_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/07 11:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-09T11:09:56+0000\'\u003e09\\/Nov\\/07 11:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi J\\u00F8rgen,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for taking the time to comment on this issue.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; One question: what happens if the clock rotates too fast and reaches a synchronized (due to I\\/O) page? Will it have to wait for the synchronization to be lifted, or can the clock jump to the next page somehow?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt will have to wait, and that may quite likely have happened in the runs with a small page cache. It would indeed be interesting to see how the performance is affected if we allowed the clock to jump to the next page in that case. By the way, that\'s what the old buffer manager does, but for reasons mentioned in a previous comment (simplicity of implementation and less likelihood of blocking because of finer sync granularity) ConcurrentCache doesn\'t. Based on the results for update load on large db, I think it\'s a good idea to run some tests to see if that was a good design decision. It shouldn\'t be too hard to make that change.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; why are performance tests in Derby performed with back-to-back transactions rather than using a more realistic (i.e., Poisson distributed) load?\u003c\\/p\u003e\\n\\n\u003cp\u003eNo particular reason, I think. And I think it\'s a very good idea to try with a Poisson distribution or similar, especially to test the background cleaner. If you know any open source test clients that could be used, I\'d be more than happy to try them out. Otherwise, I may see if I can write one myself.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12541291_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541291_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/07 11:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-09T11:09:56+0000\'\u003e09\\/Nov\\/07 11:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi J\\u00F8rgen, \\n\\n Thanks for taking the time to comment on this issue. \\n\\n &gt; One question: what happens if the clock rotates too fast and reaches a synchronized (due to I\\/O) page? Will it have to wait for the synchronization to be lifted, or can the clock jump to the next page somehow? \\n\\n It will have to wait, and that may quite likely have happened in the runs with a small page cache. It would indeed be interesting to see how the performance is affected if we allowed the clock to jump to the next page in that case. By the way, that\'s what the old buffer manager does, but for reasons mentioned in a previous comment (simplicity of implementation and less likelihood of blocking because of finer sync granularity) ConcurrentCache doesn\'t. Based on the results for update load on large db, I think it\'s a good idea to run some tests to see if that was a good design decision. It shouldn\'t be too hard to make that change. \\n\\n &gt; why are performance tests in Derby performed with back-to-back transactions rather than using a more realistic (i.e., Poisson distributed) load? \\n\\n No particular reason, I think. And I think it\'s a very good idea to try with a Poisson distribution or similar, especially to test the background cleaner. If you know any open source test clients that could be used, I\'d be more than happy to try them out. Otherwise, I may see if I can write one myself.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541304\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12541304&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541304\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jorgenlo\\\" id=\\\"commentauthor_12541304_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jorgenlo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jorgenlo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e J\\u00F8rgen L\\u00F8land\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541304_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/07 12:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-09T12:38:37+0000\'\u003e09\\/Nov\\/07 12:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCould this be used?\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/commons.apache.org\\/sandbox\\/performance\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/commons.apache.org\\/sandbox\\/performance\\/\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jorgenlo\\\" id=\\\"commentauthor_12541304_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jorgenlo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jorgenlo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e J\\u00F8rgen L\\u00F8land\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541304_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/07 12:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-09T12:38:37+0000\'\u003e09\\/Nov\\/07 12:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Could this be used? \\n\\n  http:\\/\\/commons.apache.org\\/sandbox\\/performance\\/               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541729\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12541729&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541729\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12541729_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541729_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/07 10:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-12T10:22:06+0000\'\u003e12\\/Nov\\/07 10:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; One question: what happens if the clock rotates too fast and reaches\u003cbr\\/\u003e\\n&gt; a synchronized (due to I\\/O) page? Will it have to wait for the\u003cbr\\/\u003e\\n&gt; synchronization to be lifted, or can the clock jump to the next page\u003cbr\\/\u003e\\n&gt; somehow? Since the background cleaner is used to write most of the\u003cbr\\/\u003e\\n&gt; pages, it (the background cleaner) could potentially be far behind\u003cbr\\/\u003e\\n&gt; the clock if I understand this correctly. If the clock is\u003cbr\\/\u003e\\n&gt; unnecessarily blocked by I\\/O it\'s game over \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI made a change so that instead of cleaning the page while holding the\u003cbr\\/\u003e\\nsynchronization on the cache entry, the keep count was incremented (to\u003cbr\\/\u003e\\nensure that the page wouldn\'t get evicted) and the synchronization was\u003cbr\\/\u003e\\ndropped. This didn\'t change anything, though. And thinking more about\u003cbr\\/\u003e\\nit, that makes sense, since if the clock rotates too fast, there won\'t\u003cbr\\/\u003e\\nbe evictable pages and it\'s game over anyway...\u003c\\/p\u003e\\n\\n\u003cp\u003eThat said, I think it\'s a good idea to drop the synchronization while\u003cbr\\/\u003e\\ncleaning since it will increase the concurrency (although not by much,\u003cbr\\/\u003e\\nsince the synchronization is much more fine-grained than in Clock). I\u003cbr\\/\u003e\\nthink I\'ll keep it as it is for now and do a cleanup of it later.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother potential concurrency improvement for the replacement\u003cbr\\/\u003e\\nalgorithm is to protect the clock with a\u003cbr\\/\u003e\\njava.util.concurrent.locks.ReadWriteLock instead of synchronization on\u003cbr\\/\u003e\\nthe clock. Then we don\'t have to lock the clock structure exclusively\u003cbr\\/\u003e\\nunless the clock needs to grow or shrink.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12541729_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541729_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/07 10:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-12T10:22:06+0000\'\u003e12\\/Nov\\/07 10:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; One question: what happens if the clock rotates too fast and reaches \\n&gt; a synchronized (due to I\\/O) page? Will it have to wait for the \\n&gt; synchronization to be lifted, or can the clock jump to the next page \\n&gt; somehow? Since the background cleaner is used to write most of the \\n&gt; pages, it (the background cleaner) could potentially be far behind \\n&gt; the clock if I understand this correctly. If the clock is \\n&gt; unnecessarily blocked by I\\/O it\'s game over   \\n\\n I made a change so that instead of cleaning the page while holding the \\nsynchronization on the cache entry, the keep count was incremented (to \\nensure that the page wouldn\'t get evicted) and the synchronization was \\ndropped. This didn\'t change anything, though. And thinking more about \\nit, that makes sense, since if the clock rotates too fast, there won\'t \\nbe evictable pages and it\'s game over anyway... \\n\\n That said, I think it\'s a good idea to drop the synchronization while \\ncleaning since it will increase the concurrency (although not by much, \\nsince the synchronization is much more fine-grained than in Clock). I \\nthink I\'ll keep it as it is for now and do a cleanup of it later. \\n\\n Another potential concurrency improvement for the replacement \\nalgorithm is to protect the clock with a \\njava.util.concurrent.locks.ReadWriteLock instead of synchronization on \\nthe clock. Then we don\'t have to lock the clock structure exclusively \\nunless the clock needs to grow or shrink.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541737\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12541737&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541737\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12541737_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541737_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/07 10:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-12T10:54:51+0000\'\u003e12\\/Nov\\/07 10:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Intuitively, I would say that your plan of using a more aggressive\u003cbr\\/\u003e\\n&gt; background cleaner sounds good since user threads are not using the\u003cbr\\/\u003e\\n&gt; pages they have cleaned (although I don\'t understand why not using\u003cbr\\/\u003e\\n&gt; that page is better).\u003c\\/p\u003e\\n\\n\u003cp\u003eI also have a hard time understanding why not using the page after\u003cbr\\/\u003e\\nwriting it out is better, but I think it may be a result of a\u003cbr\\/\u003e\\ndouble-buffering effect together with the file system cache. When a\u003cbr\\/\u003e\\npage is not necessarily evicted after it has been cleaned (the\u003cbr\\/\u003e\\nbehaviour of Clock in trunk), a user thread may clean multiple pages\u003cbr\\/\u003e\\nbefore it is able to evict a page. That could lead to more clustered\u003cbr\\/\u003e\\nwrites and, since the writes go via the fs cache and not directly to\u003cbr\\/\u003e\\nthe disk, it might increase the probability of the fs cache being able\u003cbr\\/\u003e\\nto clean more pages in one single disk operation.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo test this, I reran the tests with direct I\\/O enabled on the data\u003cbr\\/\u003e\\ndisk (which disables the fs cache). I still saw that all approaches\u003cbr\\/\u003e\\nwhich frequently ended up not evicting the pages they had cleaned had\u003cbr\\/\u003e\\nabout the same performance as Clock in trunk. What had changed was\u003cbr\\/\u003e\\nthat evicting the pages that had been cleaned, seemed to be slightly\u003cbr\\/\u003e\\nbetter than not evicting them.\u003c\\/p\u003e\\n\\n\u003cp\u003eSince not evicting the pages is what most closely resembles the\u003cbr\\/\u003e\\nbehaviour of the current buffer manager, and it sounds more likely\u003cbr\\/\u003e\\nthat users have the fs cache enabled than disabled, I think I\'ll go\u003cbr\\/\u003e\\nfor that solution. Also, the more aggressive background cleaner seems\u003cbr\\/\u003e\\nto perform better then the old one, so I\'ll try to come up with a\u003cbr\\/\u003e\\npatch which combines those two approaches.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12541737_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541737_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/07 10:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-12T10:54:51+0000\'\u003e12\\/Nov\\/07 10:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Intuitively, I would say that your plan of using a more aggressive \\n&gt; background cleaner sounds good since user threads are not using the \\n&gt; pages they have cleaned (although I don\'t understand why not using \\n&gt; that page is better). \\n\\n I also have a hard time understanding why not using the page after \\nwriting it out is better, but I think it may be a result of a \\ndouble-buffering effect together with the file system cache. When a \\npage is not necessarily evicted after it has been cleaned (the \\nbehaviour of Clock in trunk), a user thread may clean multiple pages \\nbefore it is able to evict a page. That could lead to more clustered \\nwrites and, since the writes go via the fs cache and not directly to \\nthe disk, it might increase the probability of the fs cache being able \\nto clean more pages in one single disk operation. \\n\\n To test this, I reran the tests with direct I\\/O enabled on the data \\ndisk (which disables the fs cache). I still saw that all approaches \\nwhich frequently ended up not evicting the pages they had cleaned had \\nabout the same performance as Clock in trunk. What had changed was \\nthat evicting the pages that had been cleaned, seemed to be slightly \\nbetter than not evicting them. \\n\\n Since not evicting the pages is what most closely resembles the \\nbehaviour of the current buffer manager, and it sounds more likely \\nthat users have the fs cache enabled than disabled, I think I\'ll go \\nfor that solution. Also, the more aggressive background cleaner seems \\nto perform better then the old one, so I\'ll try to come up with a \\npatch which combines those two approaches.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12543103\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12543103&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12543103\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12543103_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543103_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/07 15:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-16T15:22:55+0000\'\u003e16\\/Nov\\/07 15:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a new patch (derby-2911-8.diff) which implements the\u003cbr\\/\u003e\\nbackground cleaner as discussed earlier.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch adds a class called BackgroundCleaner. This class implements\u003cbr\\/\u003e\\nthe Serviceable interface and subscribes to the cache manager\'s daemon\u003cbr\\/\u003e\\nservice. When a user thread finds an object that needs to be cleaned,\u003cbr\\/\u003e\\nit gives it to BackgroundCleaner, which cleans the object in the\u003cbr\\/\u003e\\ndaemon service\'s thread instead of the user thread. BackgroundCleaner\u003cbr\\/\u003e\\nkeeps the objects it needs to clean in a queue with a maximum size of\u003cbr\\/\u003e\\n1\\/10 of the cache size. (There is no particular reason for choosing\u003cbr\\/\u003e\\nexactly 1\\/10, it just sounded not too big and not too small. Anyway,\u003cbr\\/\u003e\\nit\'s basically just an array pointing to objects already in the cache,\u003cbr\\/\u003e\\nso it\'s memory footprint will be small compared to the rest of the\u003cbr\\/\u003e\\ncache.) If the queue is full when the background cleaner receives a\u003cbr\\/\u003e\\nrequest from a user thread, the user thread will have to clean the\u003cbr\\/\u003e\\nobject itself.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also incorporated J\\u00F8rgen\'s suggestion about releasing\u003cbr\\/\u003e\\nsynchronization lock on the entry while it is being cleaned. This also\u003cbr\\/\u003e\\nled to a small change in how the checkpoint would write the\u003cbr\\/\u003e\\npages. Basically, when the checkpoint or the replacement algorithm\u003cbr\\/\u003e\\ncleans an object, it will increase the entry\'s keep count (without\u003cbr\\/\u003e\\nmarking it as recently used) to prevent eviction, and release the\u003cbr\\/\u003e\\nsynchronization lock on the entry. When the sync lock has been\u003cbr\\/\u003e\\nreleased, the object is written, and finally the sync lock is\u003cbr\\/\u003e\\nre-obtained so that the keep count can be decremented.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe javadoc comment for Clock.useDaemonService() says the following\u003cbr\\/\u003e\\nabout multi-threading: \\\"MT - synchronization provided by caller\\\". The\u003cbr\\/\u003e\\ninterface (CacheManager) does not say anything about this, but I added\u003cbr\\/\u003e\\na similar comment in the interface javadoc, and used that guarantee to\u003cbr\\/\u003e\\navoid the need for synchronization when accessing the reference\u003cbr\\/\u003e\\nassigned in ConcurrentCache.useDaemonService(). (Currently, this\u003cbr\\/\u003e\\nmethod is only used when the database is booted, so I believe the\u003cbr\\/\u003e\\ncomment in Clock is correct.)\u003c\\/p\u003e\\n\\n\u003cp\u003eDerbyall and suites.All ran cleanly on Solaris 10 and Sun JDK 6 when I\u003cbr\\/\u003e\\nmanually enabled the new buffer manager in modules.properties. As for\u003cbr\\/\u003e\\nthe previous patches, this patch does not affect any code used by\u003cbr\\/\u003e\\ndefault in Derby.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12543103_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543103_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/07 15:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-16T15:22:55+0000\'\u003e16\\/Nov\\/07 15:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a new patch (derby-2911-8.diff) which implements the \\nbackground cleaner as discussed earlier. \\n\\n The patch adds a class called BackgroundCleaner. This class implements \\nthe Serviceable interface and subscribes to the cache manager\'s daemon \\nservice. When a user thread finds an object that needs to be cleaned, \\nit gives it to BackgroundCleaner, which cleans the object in the \\ndaemon service\'s thread instead of the user thread. BackgroundCleaner \\nkeeps the objects it needs to clean in a queue with a maximum size of \\n1\\/10 of the cache size. (There is no particular reason for choosing \\nexactly 1\\/10, it just sounded not too big and not too small. Anyway, \\nit\'s basically just an array pointing to objects already in the cache, \\nso it\'s memory footprint will be small compared to the rest of the \\ncache.) If the queue is full when the background cleaner receives a \\nrequest from a user thread, the user thread will have to clean the \\nobject itself. \\n\\n I also incorporated J\\u00F8rgen\'s suggestion about releasing \\nsynchronization lock on the entry while it is being cleaned. This also \\nled to a small change in how the checkpoint would write the \\npages. Basically, when the checkpoint or the replacement algorithm \\ncleans an object, it will increase the entry\'s keep count (without \\nmarking it as recently used) to prevent eviction, and release the \\nsynchronization lock on the entry. When the sync lock has been \\nreleased, the object is written, and finally the sync lock is \\nre-obtained so that the keep count can be decremented. \\n\\n The javadoc comment for Clock.useDaemonService() says the following \\nabout multi-threading: \\\"MT - synchronization provided by caller\\\". The \\ninterface (CacheManager) does not say anything about this, but I added \\na similar comment in the interface javadoc, and used that guarantee to \\navoid the need for synchronization when accessing the reference \\nassigned in ConcurrentCache.useDaemonService(). (Currently, this \\nmethod is only used when the database is booted, so I believe the \\ncomment in Clock is correct.) \\n\\n Derbyall and suites.All ran cleanly on Solaris 10 and Sun JDK 6 when I \\nmanually enabled the new buffer manager in modules.properties. As for \\nthe previous patches, this patch does not affect any code used by \\ndefault in Derby.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12543105\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12543105&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12543105\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12543105_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543105_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/07 15:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-16T15:29:13+0000\'\u003e16\\/Nov\\/07 15:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Could this be used?\u003cbr\\/\u003e\\n&gt; \u003ca href=\\\"http:\\/\\/commons.apache.org\\/sandbox\\/performance\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/commons.apache.org\\/sandbox\\/performance\\/\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks J\\u00F8rgen, that looks very useful. It turned out that it didn\'t take too many code lines to make the existing test generate Poisson distributed load, so I wrote a small test client myself. I\'ll come back with the code and the numbers later.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12543105_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543105_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/07 15:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-16T15:29:13+0000\'\u003e16\\/Nov\\/07 15:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Could this be used? \\n&gt;  http:\\/\\/commons.apache.org\\/sandbox\\/performance\\/  \\n\\n Thanks J\\u00F8rgen, that looks very useful. It turned out that it didn\'t take too many code lines to make the existing test generate Poisson distributed load, so I wrote a small test client myself. I\'ll come back with the code and the numbers later.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12543514\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12543514&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12543514\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12543514_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543514_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/07 10:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-19T10:29:56+0000\'\u003e19\\/Nov\\/07 10:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003epoisson_patch8.tar contains the code I used to run Poisson distributed single-record updates on a 16GB database. It also contains graphs showing the average response times with derby.storage.pageCacheSize 1000 and 10000, comparing trunk and ConcurrentCache with patch #8. As predicted by J\\u00F8rgen, this test shows more clearly the advantages of the new background cleaner. It seems clear that the old buffer manager collapse (that is, its response times grow quickly) at a significantly lower number of requests per second with this load.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12543514_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543514_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/07 10:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-19T10:29:56+0000\'\u003e19\\/Nov\\/07 10:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    poisson_patch8.tar contains the code I used to run Poisson distributed single-record updates on a 16GB database. It also contains graphs showing the average response times with derby.storage.pageCacheSize 1000 and 10000, comparing trunk and ConcurrentCache with patch #8. As predicted by J\\u00F8rgen, this test shows more clearly the advantages of the new background cleaner. It seems clear that the old buffer manager collapse (that is, its response times grow quickly) at a significantly lower number of requests per second with this load.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12543524\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12543524&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12543524\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12543524_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543524_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/07 11:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-19T11:14:08+0000\'\u003e19\\/Nov\\/07 11:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted patch #8 with revision 596265.\u003c\\/p\u003e\\n\\n\u003cp\u003eNow the only thing that is not implemented, is shrinking the clock when it has exceeded its maximum size (this happens if no evictable items are found by rotateClock()). The old buffer manager would delegate the shrinking to its daemon service from rotateClock() if it had a daemon service. If it didn\'t have a daemon service, it would do the work itself from release(). I think we should try the same approach for ConcurrentCache.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12543524_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543524_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/07 11:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-19T11:14:08+0000\'\u003e19\\/Nov\\/07 11:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed patch #8 with revision 596265. \\n\\n Now the only thing that is not implemented, is shrinking the clock when it has exceeded its maximum size (this happens if no evictable items are found by rotateClock()). The old buffer manager would delegate the shrinking to its daemon service from rotateClock() if it had a daemon service. If it didn\'t have a daemon service, it would do the work itself from release(). I think we should try the same approach for ConcurrentCache.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12547783\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12547783&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12547783\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12547783_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547783_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Dec\\/07 10:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-03T10:33:25+0000\'\u003e03\\/Dec\\/07 10:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a new patch (d2911-9) which implements shrinking of the\u003cbr\\/\u003e\\nclock when it has exceeded the maximum size. The shrinking is\u003cbr\\/\u003e\\nperformed in the background cleaner if the cache has one, and in the\u003cbr\\/\u003e\\nuser thread otherwise.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, Clock has a method called trimToSize() which tries to remove as\u003cbr\\/\u003e\\nmany invalid entries as possible (even if the cache is smaller than\u003cbr\\/\u003e\\nthe maximum size). It is called from ageOut(), discard() and\u003cbr\\/\u003e\\nperformWork(), but it doesn\'t do anything unless all of these\u003cbr\\/\u003e\\nconditions are satisfied:\u003c\\/p\u003e\\n\\n\u003cp\u003e  1) the method must have been called at least as many times as 1\\/8 of\u003cbr\\/\u003e\\n  the number of elements in the cache\u003c\\/p\u003e\\n\\n\u003cp\u003e  2) the cache must not contain less than 32 elements\u003c\\/p\u003e\\n\\n\u003cp\u003e  3) more than 25% of the elements in the cache must be invalid\u003c\\/p\u003e\\n\\n\u003cp\u003eThis doesn\'t happen very often (according to the code coverage report at\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/people.apache.org\\/~fuzzylogic\\/codecoverage\\/529822\\/_files\\/21f.html#25\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/people.apache.org\\/~fuzzylogic\\/codecoverage\\/529822\\/_files\\/21f.html#25\u003c\\/a\u003e\u003cbr\\/\u003e\\nit doesn\'t happen at all in our test runs), so I\'m not sure it adds\u003cbr\\/\u003e\\nenough value to justify the extra complexity. However, to keep things\u003cbr\\/\u003e\\nas close to the old implementation as possible, I added such a method\u003cbr\\/\u003e\\nto the new buffer manager too. There is one small difference, though:\u003cbr\\/\u003e\\nThe old buffer manager would first move all invalid elements to the\u003cbr\\/\u003e\\nend of the ArrayList, before the elements were removed from the\u003cbr\\/\u003e\\nlist. While it is possibly more efficient, this operation is performed\u003cbr\\/\u003e\\nso infrequently that it\'s hardly worth the effort to optimize\u003cbr\\/\u003e\\nit. Also, the old buffer manager would lock the entire cache while\u003cbr\\/\u003e\\ndoing this, so it knew that the elements were still invalid after it\u003cbr\\/\u003e\\nhad moved them to the end of the list. The new buffer manager only\u003cbr\\/\u003e\\nlocks one element at a time, so it doesn\'t know that the elements will\u003cbr\\/\u003e\\nstay invalid after they have been moved to the end of the\u003cbr\\/\u003e\\nlist. Therefore, I chose to implement the method as a simple scan\u003cbr\\/\u003e\\nwhich removed invalid entries as it found them.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eI successfully ran derbyall and suites.All with the new buffer manager\u003cbr\\/\u003e\\nenabled in modules.properties.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12547783_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547783_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Dec\\/07 10:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-03T10:33:25+0000\'\u003e03\\/Dec\\/07 10:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a new patch (d2911-9) which implements shrinking of the \\nclock when it has exceeded the maximum size. The shrinking is \\nperformed in the background cleaner if the cache has one, and in the \\nuser thread otherwise. \\n\\n Also, Clock has a method called trimToSize() which tries to remove as \\nmany invalid entries as possible (even if the cache is smaller than \\nthe maximum size). It is called from ageOut(), discard() and \\nperformWork(), but it doesn\'t do anything unless all of these \\nconditions are satisfied: \\n\\n   1) the method must have been called at least as many times as 1\\/8 of \\n  the number of elements in the cache \\n\\n   2) the cache must not contain less than 32 elements \\n\\n   3) more than 25% of the elements in the cache must be invalid \\n\\n This doesn\'t happen very often (according to the code coverage report at \\n http:\\/\\/people.apache.org\\/~fuzzylogic\\/codecoverage\\/529822\\/_files\\/21f.html#25  \\nit doesn\'t happen at all in our test runs), so I\'m not sure it adds \\nenough value to justify the extra complexity. However, to keep things \\nas close to the old implementation as possible, I added such a method \\nto the new buffer manager too. There is one small difference, though: \\nThe old buffer manager would first move all invalid elements to the \\nend of the ArrayList, before the elements were removed from the \\nlist. While it is possibly more efficient, this operation is performed \\nso infrequently that it\'s hardly worth the effort to optimize \\nit. Also, the old buffer manager would lock the entire cache while \\ndoing this, so it knew that the elements were still invalid after it \\nhad moved them to the end of the list. The new buffer manager only \\nlocks one element at a time, so it doesn\'t know that the elements will \\nstay invalid after they have been moved to the end of the \\nlist. Therefore, I chose to implement the method as a simple scan \\nwhich removed invalid entries as it found them. \\n\\n\\n I successfully ran derbyall and suites.All with the new buffer manager \\nenabled in modules.properties.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12547789\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12547789&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12547789\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12547789_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547789_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Dec\\/07 10:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-03T10:53:49+0000\'\u003e03\\/Dec\\/07 10:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think there is another issue similar to the one J\\u00F8rgen commented on\u003cbr\\/\u003e\\nabout holding the lock on an entry while writing it to disk.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen an entry is fetched into the cache (either with create() or\u003cbr\\/\u003e\\nfind()), the old buffer manager would release the lock on the cache\u003cbr\\/\u003e\\nbefore running createIdentity()\\/setIdentity(). I assumed it released\u003cbr\\/\u003e\\nthe lock because it didn\'t want to block the entire cache while\u003cbr\\/\u003e\\nperforming what could be time consuming operations. I have now found\u003cbr\\/\u003e\\nanother reason for releasing the lock: When a new container is\u003cbr\\/\u003e\\ncreated, the call to createIdentity() will look at data in other\u003cbr\\/\u003e\\ncontainers and therefore reenter the container cache. If we hold the\u003cbr\\/\u003e\\nlock on the entry that is being created, we can possibly run into a\u003cbr\\/\u003e\\ndeadlock when the container cache is reentered. Will try to come up\u003cbr\\/\u003e\\nwith a fix.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12547789_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547789_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Dec\\/07 10:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-03T10:53:49+0000\'\u003e03\\/Dec\\/07 10:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think there is another issue similar to the one J\\u00F8rgen commented on \\nabout holding the lock on an entry while writing it to disk. \\n\\n When an entry is fetched into the cache (either with create() or \\nfind()), the old buffer manager would release the lock on the cache \\nbefore running createIdentity()\\/setIdentity(). I assumed it released \\nthe lock because it didn\'t want to block the entire cache while \\nperforming what could be time consuming operations. I have now found \\nanother reason for releasing the lock: When a new container is \\ncreated, the call to createIdentity() will look at data in other \\ncontainers and therefore reenter the container cache. If we hold the \\nlock on the entry that is being created, we can possibly run into a \\ndeadlock when the container cache is reentered. Will try to come up \\nwith a fix.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12548976\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12548976&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12548976\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12548976_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12548976_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 10:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T10:14:46+0000\'\u003e06\\/Dec\\/07 10:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted d2911-9.diff with revision 601680.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12548976_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12548976_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 10:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T10:14:46+0000\'\u003e06\\/Dec\\/07 10:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed d2911-9.diff with revision 601680.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12550447\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12550447&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12550447\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12550447_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12550447_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/07 13:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-11T13:57:09+0000\'\u003e11\\/Dec\\/07 13:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a new patch (d2911-10). This patch addresses the potential deadlock issue if user code (i.e., Cacheable.setIdentity() or Cacheable.createIdentity()) reenters the cache. It makes the callers of setIdentity()\\/createIdentity() release the ReentrantLock on the cache entry before calling one of those methods. Other threads that want to access the object in that entry therefore have to wait until the identity has been set, whereas threads scanning the cache (e.g., checkpoint or clock rotation) skip the entry instead of waiting since they just see an invalid\\/kept entry.\u003c\\/p\u003e\\n\\n\u003cp\u003eAll the regression tests passed when I enabled ConcurrentCache in modules.properties.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12550447_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12550447_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/07 13:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-11T13:57:09+0000\'\u003e11\\/Dec\\/07 13:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a new patch (d2911-10). This patch addresses the potential deadlock issue if user code (i.e., Cacheable.setIdentity() or Cacheable.createIdentity()) reenters the cache. It makes the callers of setIdentity()\\/createIdentity() release the ReentrantLock on the cache entry before calling one of those methods. Other threads that want to access the object in that entry therefore have to wait until the identity has been set, whereas threads scanning the cache (e.g., checkpoint or clock rotation) skip the entry instead of waiting since they just see an invalid\\/kept entry. \\n\\n All the regression tests passed when I enabled ConcurrentCache in modules.properties.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12550855\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12550855&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12550855\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12550855_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12550855_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/07 07:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-12T07:01:29+0000\'\u003e12\\/Dec\\/07 07:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted d2911-10.diff with revision 603491.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12550855_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12550855_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/07 07:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-12T07:01:29+0000\'\u003e12\\/Dec\\/07 07:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed d2911-10.diff with revision 603491.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12551749\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12551749&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12551749\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12551749_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12551749_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Dec\\/07 10:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-14T10:37:39+0000\'\u003e14\\/Dec\\/07 10:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a new patch which (d2911-11) which makes the new buffer manager use the initialSize parameter in CacheFactory.newCacheManager(). It only uses the parameter to specify the initial capacity of the ConcurrentHashMap in ConcurrentCache and the ArrayList in ClockPolicy. The interface actually says that we should create enough holder objects to hold that number of objects, but that\'s not what the old buffer manager does. I have logged an issue \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3275\\\" title=\\\"Mismatch between comments and actual use of initialSize parameter in CacheFactory and Clock\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3275\\\"\u003e\u003cdel\u003eDERBY-3275\u003c\\/del\u003e\u003c\\/a\u003e for making the code and the comments match.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12551749_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12551749_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Dec\\/07 10:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-14T10:37:39+0000\'\u003e14\\/Dec\\/07 10:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a new patch which (d2911-11) which makes the new buffer manager use the initialSize parameter in CacheFactory.newCacheManager(). It only uses the parameter to specify the initial capacity of the ConcurrentHashMap in ConcurrentCache and the ArrayList in ClockPolicy. The interface actually says that we should create enough holder objects to hold that number of objects, but that\'s not what the old buffer manager does. I have logged an issue   DERBY-3275   for making the code and the comments match.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12551766\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12551766&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12551766\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12551766_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12551766_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Dec\\/07 11:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-14T11:14:25+0000\'\u003e14\\/Dec\\/07 11:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted d2911-11.diff with revision 604153.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think that means that all the functionality of the old buffer manager is also implemented in the new buffer manager.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn an earlier comment, I mentioned that we might see more concurrency when the eviction frequency is high if we replace the synchronization  lock on the ArrayList in ClockPolicy with a ReadWriteLock. I made quick patch and ran a couple of tests, but I couldn\'t see any significant improvement, so I\'ll just leave it as it is for now. If it later turns out to be a bottleneck, it\'ll be very simple to change it.\u003c\\/p\u003e\\n\\n\u003cp\u003eI plan to rerun the tests I ran earlier on different hardware and with different page cache sizes to see if we still have the performance gains we had then, and also to see if there is some load\\/configuration where the performance is worse with the new buffer manager. I will post the results once I have them.\u003c\\/p\u003e\\n\\n\u003cp\u003eI would appreciate it if someone would review the code. The new buffer manager does not share any code with the old buffer manager, and it is completely contained in these files in the impl\\/services\\/cache directory:\u003c\\/p\u003e\\n\\n\u003cp\u003e  ConcurrentCacheFactory.java - implementation of the CacheFactory interface and contains only a single factory method to create a  ConcurrentCache instance\u003c\\/p\u003e\\n\\n\u003cp\u003e  ConcurrentCache.java - the CacheManager implementation. This class contains the code needed to insert, find, release and remove items in the cache, and it is build around a ConcurrentHashMap\u003c\\/p\u003e\\n\\n\u003cp\u003e  CacheEntry.java - wrapper\\/holder object for objects in the cache. This object contains some state for the entry (keep count, validity, etc), and code which enables fine-grained synchronization (ReentrantLock on entry level instead of synchronization on cache level as in the old buffer manager)\u003c\\/p\u003e\\n\\n\u003cp\u003e  ReplacementPolicy.java\\/ClockPolicy.java - interface and implementation of the replacement algorithm, that is the algorithm that is used to evict objects from the cache to make room for new objects when the cache is full\u003c\\/p\u003e\\n\\n\u003cp\u003e  BackgroundCleaner.java - a Serviceable that is used by the cache manager to perform asynchronous I\\/O or other background tasks\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12551766_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12551766_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Dec\\/07 11:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-14T11:14:25+0000\'\u003e14\\/Dec\\/07 11:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed d2911-11.diff with revision 604153. \\n\\n I think that means that all the functionality of the old buffer manager is also implemented in the new buffer manager. \\n\\n In an earlier comment, I mentioned that we might see more concurrency when the eviction frequency is high if we replace the synchronization  lock on the ArrayList in ClockPolicy with a ReadWriteLock. I made quick patch and ran a couple of tests, but I couldn\'t see any significant improvement, so I\'ll just leave it as it is for now. If it later turns out to be a bottleneck, it\'ll be very simple to change it. \\n\\n I plan to rerun the tests I ran earlier on different hardware and with different page cache sizes to see if we still have the performance gains we had then, and also to see if there is some load\\/configuration where the performance is worse with the new buffer manager. I will post the results once I have them. \\n\\n I would appreciate it if someone would review the code. The new buffer manager does not share any code with the old buffer manager, and it is completely contained in these files in the impl\\/services\\/cache directory: \\n\\n   ConcurrentCacheFactory.java - implementation of the CacheFactory interface and contains only a single factory method to create a  ConcurrentCache instance \\n\\n   ConcurrentCache.java - the CacheManager implementation. This class contains the code needed to insert, find, release and remove items in the cache, and it is build around a ConcurrentHashMap \\n\\n   CacheEntry.java - wrapper\\/holder object for objects in the cache. This object contains some state for the entry (keep count, validity, etc), and code which enables fine-grained synchronization (ReentrantLock on entry level instead of synchronization on cache level as in the old buffer manager) \\n\\n   ReplacementPolicy.java\\/ClockPolicy.java - interface and implementation of the replacement algorithm, that is the algorithm that is used to evict objects from the cache to make room for new objects when the cache is full \\n\\n   BackgroundCleaner.java - a Serviceable that is used by the cache manager to perform asynchronous I\\/O or other background tasks              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12558644\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12558644&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12558644\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12558644_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12558644_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/08 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-01-14T16:00:53+0000\'\u003e14\\/Jan\\/08 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe attached patch merges the test clients used previously in this issue and places them under org.apache.derbyTesting.perf.clients. With the class Runner in that package, one can start each of the tests from the command line and configure which type of load generator (back-to-back or Poisson) to use.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am currently running tests which compare the performance of ConcurrentCache and Clock on one dual-CPU machine and on one 8-CPU machine. I\'ll post the results once I have them.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12558644_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12558644_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/08 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-01-14T16:00:53+0000\'\u003e14\\/Jan\\/08 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The attached patch merges the test clients used previously in this issue and places them under org.apache.derbyTesting.perf.clients. With the class Runner in that package, one can start each of the tests from the command line and configure which type of load generator (back-to-back or Poisson) to use. \\n\\n I am currently running tests which compare the performance of ConcurrentCache and Clock on one dual-CPU machine and on one 8-CPU machine. I\'ll post the results once I have them.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12564805\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12564805&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12564805\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12564805_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12564805_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/08 15:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-01T15:51:27+0000\'\u003e01\\/Feb\\/08 15:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI finally got around to look at the results from the tests I had running. Sorry for the delay.\u003c\\/p\u003e\\n\\n\u003cp\u003eAttached is a diff (perftest2.diff) with an updated version of the performance tests that I used (the load that were supposed to resemble the d2911perf class attached to this issue, was changed so that it matched d2911perf more closely, and this change also simplified the code a bit), and a pdf (perftest.pdf) which summarizes the findings. Nothing new there, actually, the results were pretty consistent with the results that have been posted here earlier. The new buffer manager performs significantly better than the old one when there\'s no other contention point (like the log device or the root node in the B-tree) and there are multiple CPUs\\/cores, and a little better than or equal to the old buffer manager in cases where there is another contention point.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12564805_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12564805_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/08 15:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-01T15:51:27+0000\'\u003e01\\/Feb\\/08 15:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I finally got around to look at the results from the tests I had running. Sorry for the delay. \\n\\n Attached is a diff (perftest2.diff) with an updated version of the performance tests that I used (the load that were supposed to resemble the d2911perf class attached to this issue, was changed so that it matched d2911perf more closely, and this change also simplified the code a bit), and a pdf (perftest.pdf) which summarizes the findings. Nothing new there, actually, the results were pretty consistent with the results that have been posted here earlier. The new buffer manager performs significantly better than the old one when there\'s no other contention point (like the log device or the root node in the B-tree) and there are multiple CPUs\\/cores, and a little better than or equal to the old buffer manager in cases where there is another contention point.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12566586\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12566586&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12566586\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12566586_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12566586_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/08 13:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-07T13:28:23+0000\'\u003e07\\/Feb\\/08 13:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eChecked in the performance tests with revision 619404.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12566586_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12566586_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/08 13:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-07T13:28:23+0000\'\u003e07\\/Feb\\/08 13:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Checked in the performance tests with revision 619404.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12571358\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12571358&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12571358\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"oysteing\\\" id=\\\"commentauthor_12571358_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=oysteing\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"oysteing\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e \\u00D8ystein Gr\\u00F8vlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571358_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Feb\\/08 11:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-22T11:05:02+0000\'\u003e22\\/Feb\\/08 11:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have looked at the code introduced in this JIRA for a new cache\u003cbr\\/\u003e\\nmanager, and think it looks very good.  I have only found one small issue\u003cbr\\/\u003e\\nrelated to correctness (4e), but I have some minor comments\\/questions on\u003cbr\\/\u003e\\nthe organization of the code:\u003c\\/p\u003e\\n\\n\u003cp\u003e1. ConcurrentCache:\u003c\\/p\u003e\\n\\n\u003cp\u003e   a. What is the significant difference between removeEntry and\u003cbr\\/\u003e\\n      evictEntry?  At first, I thought it was that evictEntry set the\u003cbr\\/\u003e\\n      Cacheable to null, but then I discovered that removeEntry does\u003cbr\\/\u003e\\n      the same through its call to CacheEntry#free.  So I guess the\u003cbr\\/\u003e\\n      only difference is that removeEntry will include a call to\u003cbr\\/\u003e\\n      ReplacementPolicy#Callback#free. I am not sure I understand why\u003cbr\\/\u003e\\n      this should be avoided for evictEntry.  If both methods are\u003cbr\\/\u003e\\n      needed, the first sentences of their javadoc should be different\u003cbr\\/\u003e\\n      in order to be able to make a distinction when reading the\u003cbr\\/\u003e\\n      javadoc summary.\u003c\\/p\u003e\\n\\n\u003cp\u003e   b. To me, the organization of find and create methods for entries\u003cbr\\/\u003e\\n      and cacheables are a bit confusing.  It seems to me that it would\u003cbr\\/\u003e\\n      be easier to understand if it was based on basic methods for\u003cbr\\/\u003e\\n      get\\/find and create, that just did what it said it did, and then\u003cbr\\/\u003e\\n      created the more advanced operations like\u003cbr\\/\u003e\\n      findAndCreateIfNotFound on top of that.  Is this done for\u003cbr\\/\u003e\\n      efficiency reasons?  Especially, the findOrCreateObject method\u003cbr\\/\u003e\\n      is a bit confusing since it uses a parameter to change behavior\u003cbr\\/\u003e\\n      from findAndCreateIfNotFound to createAndFlagErrorIfFound.\u003cbr\\/\u003e\\n      Would it be possible to create two separate methods here?  At\u003cbr\\/\u003e\\n      least, I think the javadoc for the create parameter needs to\u003cbr\\/\u003e\\n      describe exactly what will occur.   \u003c\\/p\u003e\\n\\n\u003cp\u003e   c. findOrCreateObject: The create parameter will determine whether\u003cbr\\/\u003e\\n      setIdentify and not createIdentify will be called when an object\u003cbr\\/\u003e\\n      is not found in the cache.  Is this difference just an issue of\u003cbr\\/\u003e\\n      whether createParameter has been provided, or is there something\u003cbr\\/\u003e\\n      more that distinguishes these to cases?\u003c\\/p\u003e\\n\\n\u003cp\u003e   d. findCached\\/release: Comments states that one \\\"don\'t need to call\u003cbr\\/\u003e\\n      getEntry()\\\", but I guess the points is that it would be harmful\u003cbr\\/\u003e\\n      to call getEntry?  \u003c\\/p\u003e\\n\\n\u003cp\u003e2. CacheEntry:\u003c\\/p\u003e\\n\\n\u003cp\u003e   a. lockWhenIdentityIsSet: I do not feel the name really describes\u003cbr\\/\u003e\\n      what the method is doing.  lockAndBlockUntilIdentityIsSet would\u003cbr\\/\u003e\\n      be more descriptive.  Maybe you can come up with an even better\u003cbr\\/\u003e\\n      (and shorter) name.\u003c\\/p\u003e\\n\\n\u003cp\u003e3. ReplacementPolicy:\u003c\\/p\u003e\\n\\n\u003cp\u003e   a. The Callback returned by insertEntry seems currently not to be\u003cbr\\/\u003e\\n      in use.  In what situations may it be used?\u003c\\/p\u003e\\n\\n\u003cp\u003e4. ClockPolicy:\u003c\\/p\u003e\\n\\n\u003cp\u003e   a. grow: Instead of requiring that the caller synchronize, why not\u003cbr\\/\u003e\\n      synchronize within the method?  (Like is done for several other\u003cbr\\/\u003e\\n      methods, eg., moveHand)\u003c\\/p\u003e\\n\\n\u003cp\u003e   b. rotateClock:  The concept of a small cache (&lt;20 entries) is that\u003cbr\\/\u003e\\n      relevant for any currently used caches in Derby?  It seems a bit\u003cbr\\/\u003e\\n      strange to check 38 items when there are 19 entries, but only 4\u003cbr\\/\u003e\\n      items if there are 20 entries.  But maybe it is not that\u003cbr\\/\u003e\\n      relevant with respect to the cache sizes used in Derby?\u003c\\/p\u003e\\n\\n\u003cp\u003e   c. rotateClock:  I think it would be good if some of the discussion\u003cbr\\/\u003e\\n      in the JIRA about why it is not using the entries it has\u003cbr\\/\u003e\\n      cleaned, would be reflected in comments.\u003c\\/p\u003e\\n\\n\u003cp\u003e   d. shrinkMe: javadoc for return is incomplete\u003c\\/p\u003e\\n\\n\u003cp\u003e   e. shrinkMe: I think there is an off-by-one error for the call on\u003cbr\\/\u003e\\n      clock.get.  If pos==size-1 when entering the synchronized block,\u003cbr\\/\u003e\\n      one will do get(size) which I guess would give\u003cbr\\/\u003e\\n      ArrayIndexOutOfBoundsException. Also, the first element of clock\u003cbr\\/\u003e\\n      will never be inspected since index will never be 0.\u003c\\/p\u003e\\n\\n\u003cp\u003e   f. shrinkMe: The code to determine whether an item could be evicted\u003cbr\\/\u003e\\n      is the same as for rotateClock.  Could this code be refactored\u003cbr\\/\u003e\\n      into a common method?  (isEvictable() or something like that)\u003c\\/p\u003e\\n\\n\u003cp\u003e   g. trimMe: This method contains a lot of heuristics that I guess\u003cbr\\/\u003e\\n      you have inherited from the old clock implementation.  If you\u003cbr\\/\u003e\\n      have got any insight into why the particular values are chosen,\u003cbr\\/\u003e\\n      if would be good if you could comment on that.  (I notice that\u003cbr\\/\u003e\\n      the criteria for being a small cache is not the same here as in\u003cbr\\/\u003e\\n      rotateClock.)\u003c\\/p\u003e\\n\\n\u003cp\u003e   h. Maybe some of the numeric constants used for heuristics in this\u003cbr\\/\u003e\\n      class should be defined as named constants?\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e5. BackgroundCleaner: \u003c\\/p\u003e\\n\\n\u003cp\u003e   a. I am not sure the statement \\\"used by ConcurrentCache so that it\u003cbr\\/\u003e\\n      doesn\'t have to wait for clean operations to finish\\\" covers the\u003cbr\\/\u003e\\n      purpose.  Clean operations on ConcurrentCache does not use the\u003cbr\\/\u003e\\n      background cleaner.  It is find operations on ConcurrentCache\u003cbr\\/\u003e\\n      that will invoke the cleaner.  In addition, the background\u003cbr\\/\u003e\\n      cleaner does not help a given find operation, it just makes\u003cbr\\/\u003e\\n      future operation more likely to find an item that can be reused.\u003c\\/p\u003e\\n\\n\u003cp\u003e   b. serviceImmediately:  As far as I can tell this method is not\u003cbr\\/\u003e\\n      relevant since it is not used by BasicDaemon.  Maybe that should\u003cbr\\/\u003e\\n      be indicated?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"oysteing\\\" id=\\\"commentauthor_12571358_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=oysteing\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"oysteing\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e \\u00D8ystein Gr\\u00F8vlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571358_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Feb\\/08 11:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-22T11:05:02+0000\'\u003e22\\/Feb\\/08 11:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have looked at the code introduced in this JIRA for a new cache \\nmanager, and think it looks very good.  I have only found one small issue \\nrelated to correctness (4e), but I have some minor comments\\/questions on \\nthe organization of the code: \\n\\n 1. ConcurrentCache: \\n\\n    a. What is the significant difference between removeEntry and \\n      evictEntry?  At first, I thought it was that evictEntry set the \\n      Cacheable to null, but then I discovered that removeEntry does \\n      the same through its call to CacheEntry#free.  So I guess the \\n      only difference is that removeEntry will include a call to \\n      ReplacementPolicy#Callback#free. I am not sure I understand why \\n      this should be avoided for evictEntry.  If both methods are \\n      needed, the first sentences of their javadoc should be different \\n      in order to be able to make a distinction when reading the \\n      javadoc summary. \\n\\n    b. To me, the organization of find and create methods for entries \\n      and cacheables are a bit confusing.  It seems to me that it would \\n      be easier to understand if it was based on basic methods for \\n      get\\/find and create, that just did what it said it did, and then \\n      created the more advanced operations like \\n      findAndCreateIfNotFound on top of that.  Is this done for \\n      efficiency reasons?  Especially, the findOrCreateObject method \\n      is a bit confusing since it uses a parameter to change behavior \\n      from findAndCreateIfNotFound to createAndFlagErrorIfFound. \\n      Would it be possible to create two separate methods here?  At \\n      least, I think the javadoc for the create parameter needs to \\n      describe exactly what will occur.    \\n\\n    c. findOrCreateObject: The create parameter will determine whether \\n      setIdentify and not createIdentify will be called when an object \\n      is not found in the cache.  Is this difference just an issue of \\n      whether createParameter has been provided, or is there something \\n      more that distinguishes these to cases? \\n\\n    d. findCached\\/release: Comments states that one \\\"don\'t need to call \\n      getEntry()\\\", but I guess the points is that it would be harmful \\n      to call getEntry?   \\n\\n 2. CacheEntry: \\n\\n    a. lockWhenIdentityIsSet: I do not feel the name really describes \\n      what the method is doing.  lockAndBlockUntilIdentityIsSet would \\n      be more descriptive.  Maybe you can come up with an even better \\n      (and shorter) name. \\n\\n 3. ReplacementPolicy: \\n\\n    a. The Callback returned by insertEntry seems currently not to be \\n      in use.  In what situations may it be used? \\n\\n 4. ClockPolicy: \\n\\n    a. grow: Instead of requiring that the caller synchronize, why not \\n      synchronize within the method?  (Like is done for several other \\n      methods, eg., moveHand) \\n\\n    b. rotateClock:  The concept of a small cache (&lt;20 entries) is that \\n      relevant for any currently used caches in Derby?  It seems a bit \\n      strange to check 38 items when there are 19 entries, but only 4 \\n      items if there are 20 entries.  But maybe it is not that \\n      relevant with respect to the cache sizes used in Derby? \\n\\n    c. rotateClock:  I think it would be good if some of the discussion \\n      in the JIRA about why it is not using the entries it has \\n      cleaned, would be reflected in comments. \\n\\n    d. shrinkMe: javadoc for return is incomplete \\n\\n    e. shrinkMe: I think there is an off-by-one error for the call on \\n      clock.get.  If pos==size-1 when entering the synchronized block, \\n      one will do get(size) which I guess would give \\n      ArrayIndexOutOfBoundsException. Also, the first element of clock \\n      will never be inspected since index will never be 0. \\n\\n    f. shrinkMe: The code to determine whether an item could be evicted \\n      is the same as for rotateClock.  Could this code be refactored \\n      into a common method?  (isEvictable() or something like that) \\n\\n    g. trimMe: This method contains a lot of heuristics that I guess \\n      you have inherited from the old clock implementation.  If you \\n      have got any insight into why the particular values are chosen, \\n      if would be good if you could comment on that.  (I notice that \\n      the criteria for being a small cache is not the same here as in \\n      rotateClock.) \\n\\n    h. Maybe some of the numeric constants used for heuristics in this \\n      class should be defined as named constants? \\n\\n\\n 5. BackgroundCleaner:  \\n\\n    a. I am not sure the statement \\\"used by ConcurrentCache so that it \\n      doesn\'t have to wait for clean operations to finish\\\" covers the \\n      purpose.  Clean operations on ConcurrentCache does not use the \\n      background cleaner.  It is find operations on ConcurrentCache \\n      that will invoke the cleaner.  In addition, the background \\n      cleaner does not help a given find operation, it just makes \\n      future operation more likely to find an item that can be reused. \\n\\n    b. serviceImmediately:  As far as I can tell this method is not \\n      relevant since it is not used by BasicDaemon.  Maybe that should \\n      be indicated?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12571390\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12571390&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12571390\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12571390_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571390_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Feb\\/08 12:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-22T12:57:46+0000\'\u003e22\\/Feb\\/08 12:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for reviewing the code, \\u00D8ystein! Those are very good comments and questions. I\'ll study them more in detail and try to come up with answers over the weekend. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12571390_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571390_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Feb\\/08 12:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-22T12:57:46+0000\'\u003e22\\/Feb\\/08 12:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for reviewing the code, \\u00D8ystein! Those are very good comments and questions. I\'ll study them more in detail and try to come up with answers over the weekend.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12572924\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12572924&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12572924\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12572924_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12572924_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/08 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-27T15:00:11+0000\'\u003e27\\/Feb\\/08 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve gone through the comments and questions. Please find my\u003cbr\\/\u003e\\nresponses below. Regarding the correctness error (4e), I think the\u003cbr\\/\u003e\\ncode is actually correct, but it could have been clearer.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe new buffer manager isn\'t enabled in the build yet. Should the\u003cbr\\/\u003e\\nissues mentioned by \\u00D8ystein be resolved first, or would it be OK to\u003cbr\\/\u003e\\nenable it first and do the reorganization and improvements later?\u003c\\/p\u003e\\n\\n\u003cp\u003eResponses to \\u00D8ystein\'s questions\\/comments:\u003c\\/p\u003e\\n\\n\u003cp\u003e1. ConcurrentCache\u003c\\/p\u003e\\n\\n\u003cp\u003ea) Difference between evictEntry() and removeEntry().\u003c\\/p\u003e\\n\\n\u003cp\u003eI think you are right that the only significant difference is that\u003cbr\\/\u003e\\nremoveEntry() calls free() whereas evictEntry() doesn\'t. Calling\u003cbr\\/\u003e\\nfree() from evictEntry() wouldn\'t be correct in the current code,\u003cbr\\/\u003e\\nthough. free() is called to notify the replacement policy that the\u003cbr\\/\u003e\\nCacheable contained in the entry can be reused. When evictEntry() is\u003cbr\\/\u003e\\ncalled, we\'re either in the process of reusing the Cacheable (in which\u003cbr\\/\u003e\\ncase we don\'t want to first mark it as reusable so that others can\u003cbr\\/\u003e\\ngrab it, and then try to reobtain it and possibly reuse it), or we\'re\u003cbr\\/\u003e\\nshrinking the cache (in which case making it reusable would mean that\u003cbr\\/\u003e\\nthe cache doesn\'t shrink).\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll see if I can find a clever way to merge the two methods, or at\u003cbr\\/\u003e\\nleast improve the comments and perhaps the names of the methods.\u003c\\/p\u003e\\n\\n\u003cp\u003eb) Organization of find and create methods.\u003c\\/p\u003e\\n\\n\u003cp\u003eI guess it is possible to split them into two or three basic methods\u003cbr\\/\u003e\\nand build the public methods on top of them. However, I\'m not sure\u003cbr\\/\u003e\\nit\'s a good idea to remove the create flag. findOrCreateObject() is a\u003cbr\\/\u003e\\nfairly large method, and the check of the create flag is a very small\u003cbr\\/\u003e\\npart of it. If the create flag were removed, it would mean that we\u003cbr\\/\u003e\\nhave to duplicate a most of the logic in that method. But if we split\u003cbr\\/\u003e\\nthe logic into more basic methods, it will hopefully be easier to\u003cbr\\/\u003e\\nunderstand how the create flag affects each of the basic methods.\u003c\\/p\u003e\\n\\n\u003cp\u003ec) findOrCreateObject(): create vs createParameter\u003c\\/p\u003e\\n\\n\u003cp\u003ecreate can be true even if createParameter is null, so I don\'t think\u003cbr\\/\u003e\\ncreate can be skipped. The distinction between setIdentity() and\u003cbr\\/\u003e\\ncreateIdentity() comes from the Cacheable interface and can\'t be\u003cbr\\/\u003e\\nchanged without modifying the existing buffer manager and the store as\u003cbr\\/\u003e\\nwell.\u003c\\/p\u003e\\n\\n\u003cp\u003ed) findCached()\\/release(): get() vs getEntry()\u003c\\/p\u003e\\n\\n\u003cp\u003eYou\'re right, it is not harmful to call getEntry() in terms of\u003cbr\\/\u003e\\ncorrectness, but it\'s slightly more expensive. I will update the\u003cbr\\/\u003e\\ncomments to make this clearer.\u003c\\/p\u003e\\n\\n\u003cp\u003e2. CacheEntry\u003c\\/p\u003e\\n\\n\u003cp\u003ea) Misleading name: lockWhenIdentityIsSet()\u003c\\/p\u003e\\n\\n\u003cp\u003eYour suggestion lockAndBlockUntilIdentityIsSet() does match more\u003cbr\\/\u003e\\nclosely the calls in the method (lock() + await()), but since await()\u003cbr\\/\u003e\\nwill release the lock until it wakes up, I think the original name\u003cbr\\/\u003e\\ndescribes better how the locking and blocking is perceived from\u003cbr\\/\u003e\\noutside the method. Perhaps waitUntilIdentityIsSetAndLock() is a\u003cbr\\/\u003e\\nbetter name? Of course, better comments in the method would also help.\u003c\\/p\u003e\\n\\n\u003cp\u003e3. ReplacementPolicy\u003c\\/p\u003e\\n\\n\u003cp\u003ea) Return value from insertEntry() isn\'t used.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe return value isn\'t needed since the replacement policy will link\u003cbr\\/\u003e\\nthe CacheEntry and the Callback internally by calling\u003cbr\\/\u003e\\nCacheEntry.setCallback(). Will change the method so that it\'s void.\u003c\\/p\u003e\\n\\n\u003cp\u003e4. ClockPolicy\u003c\\/p\u003e\\n\\n\u003cp\u003ea) Why not synchronize inside grow()?\u003c\\/p\u003e\\n\\n\u003cp\u003eOne of the callers needs the synchronization for more than just the\u003cbr\\/\u003e\\ncall to grow() and therefore needs the synchronized block anyway, so I\u003cbr\\/\u003e\\nfelt it was more consistent if all (both) callers used an explicit\u003cbr\\/\u003e\\nsynchronization block. (It also avoided double synchronization for\u003cbr\\/\u003e\\nthat caller.) The other methods you mention are supposed to be atomic,\u003cbr\\/\u003e\\nand are not intended to be called from within a larger block\u003cbr\\/\u003e\\nsynchronized on the same object.\u003c\\/p\u003e\\n\\n\u003cp\u003eb) Handling of small cache sizes in rotateClock().\u003c\\/p\u003e\\n\\n\u003cp\u003eI agree that this is a bit strange. The logic is copied from\u003cbr\\/\u003e\\nClock.rotateClock(), by the way. I believe you are correct that it\'s\u003cbr\\/\u003e\\nnot relevant for the (default) cache sizes currently used (none is\u003cbr\\/\u003e\\nsmaller than 32). Perhaps it would be better to simplify it and just\u003cbr\\/\u003e\\nsay itemsToCheck = Math.max(20, ...) or something (the number 20 is\u003cbr\\/\u003e\\narbitrary).\u003c\\/p\u003e\\n\\n\u003cp\u003ec) Add more comments about why cleaned entries are not reused.\u003c\\/p\u003e\\n\\n\u003cp\u003eWill update the comments with more details from the JIRA discussion.\u003c\\/p\u003e\\n\\n\u003cp\u003ed) Incomplete @return tag for shrinkMe().\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks, fixed in revision 631225.\u003c\\/p\u003e\\n\\n\u003cp\u003ee) Off-by-one error in shrinkMe().\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think there is an off-by-one error, since we use the old value\u003cbr\\/\u003e\\nof pos, not the one that has been increased by one. I guess it\'s a bit\u003cbr\\/\u003e\\nconfusing to use the postfix increment operator and store away the old\u003cbr\\/\u003e\\nvalue on the same line in the code. Perhaps it would be clearer if the\u003cbr\\/\u003e\\ncode were reordered from\u003c\\/p\u003e\\n\\n\u003cp\u003e                index = pos++;\u003cbr\\/\u003e\\n                h = clock.get(index);\u003c\\/p\u003e\\n\\n\u003cp\u003eto\u003c\\/p\u003e\\n\\n\u003cp\u003e                h = clock.get(pos);\u003cbr\\/\u003e\\n                index = pos;\u003cbr\\/\u003e\\n                pos++;\u003c\\/p\u003e\\n\\n\u003cp\u003eOr perhaps I misunderstood what you meant?\u003c\\/p\u003e\\n\\n\u003cp\u003ef) Factor out common code for evicting entries in rotateClock() and\u003cbr\\/\u003e\\nshrinkMe().\u003c\\/p\u003e\\n\\n\u003cp\u003eWill do that.\u003c\\/p\u003e\\n\\n\u003cp\u003eg) Comment on the heuristics in trimMe().\u003c\\/p\u003e\\n\\n\u003cp\u003eAs you quite correctly guessed, the heuristics have been taken from\u003cbr\\/\u003e\\nthe old clock implementation (Clock.trimToSize()), and I don\'t know\u003cbr\\/\u003e\\nwhy they were chosen.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat strikes me with the heuristics, is that they seem to do their\u003cbr\\/\u003e\\nbest to prevent this method from ever doing anything (which can also\u003cbr\\/\u003e\\nbe seen in the code coverage reports). Also, I don\'t see very much\u003cbr\\/\u003e\\nvalue in shrinking a cache that already is smaller than the max\u003cbr\\/\u003e\\nsize. If someone needs it, the correct way would be to reduce the max\u003cbr\\/\u003e\\nsize of the cache, I think. Perhaps it would be better just to remove\u003cbr\\/\u003e\\nit? Seems like it\'s much complexity for little added value.\u003c\\/p\u003e\\n\\n\u003cp\u003eh) Naming constants used in heuristic\u003c\\/p\u003e\\n\\n\u003cp\u003eProbably a good idea. Will do that.\u003c\\/p\u003e\\n\\n\u003cp\u003e5. BackgroundCleaner\u003c\\/p\u003e\\n\\n\u003cp\u003ea) Misleading class javadoc\u003c\\/p\u003e\\n\\n\u003cp\u003eWill fix that comment.\u003c\\/p\u003e\\n\\n\u003cp\u003eb) Comment that serviceImmediately() isn\'t used by BasicDaemon\u003c\\/p\u003e\\n\\n\u003cp\u003eCould do that. Now, BackgroundCleaner doesn\'t know that it\'s being\u003cbr\\/\u003e\\nserviced by a BasicDaemon, so I\'m not sure whether or not it\'s\u003cbr\\/\u003e\\nBackgroundCleaner\'s concern that the method is not being used by\u003cbr\\/\u003e\\nBasicDaemon. If another implementation of DaemonService is used\u003cbr\\/\u003e\\n(that\'s not controlled by the cache implementation), the returned\u003cbr\\/\u003e\\nvalue may become relevant.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12572924_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12572924_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/08 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-27T15:00:11+0000\'\u003e27\\/Feb\\/08 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve gone through the comments and questions. Please find my \\nresponses below. Regarding the correctness error (4e), I think the \\ncode is actually correct, but it could have been clearer. \\n\\n The new buffer manager isn\'t enabled in the build yet. Should the \\nissues mentioned by \\u00D8ystein be resolved first, or would it be OK to \\nenable it first and do the reorganization and improvements later? \\n\\n Responses to \\u00D8ystein\'s questions\\/comments: \\n\\n 1. ConcurrentCache \\n\\n a) Difference between evictEntry() and removeEntry(). \\n\\n I think you are right that the only significant difference is that \\nremoveEntry() calls free() whereas evictEntry() doesn\'t. Calling \\nfree() from evictEntry() wouldn\'t be correct in the current code, \\nthough. free() is called to notify the replacement policy that the \\nCacheable contained in the entry can be reused. When evictEntry() is \\ncalled, we\'re either in the process of reusing the Cacheable (in which \\ncase we don\'t want to first mark it as reusable so that others can \\ngrab it, and then try to reobtain it and possibly reuse it), or we\'re \\nshrinking the cache (in which case making it reusable would mean that \\nthe cache doesn\'t shrink). \\n\\n I\'ll see if I can find a clever way to merge the two methods, or at \\nleast improve the comments and perhaps the names of the methods. \\n\\n b) Organization of find and create methods. \\n\\n I guess it is possible to split them into two or three basic methods \\nand build the public methods on top of them. However, I\'m not sure \\nit\'s a good idea to remove the create flag. findOrCreateObject() is a \\nfairly large method, and the check of the create flag is a very small \\npart of it. If the create flag were removed, it would mean that we \\nhave to duplicate a most of the logic in that method. But if we split \\nthe logic into more basic methods, it will hopefully be easier to \\nunderstand how the create flag affects each of the basic methods. \\n\\n c) findOrCreateObject(): create vs createParameter \\n\\n create can be true even if createParameter is null, so I don\'t think \\ncreate can be skipped. The distinction between setIdentity() and \\ncreateIdentity() comes from the Cacheable interface and can\'t be \\nchanged without modifying the existing buffer manager and the store as \\nwell. \\n\\n d) findCached()\\/release(): get() vs getEntry() \\n\\n You\'re right, it is not harmful to call getEntry() in terms of \\ncorrectness, but it\'s slightly more expensive. I will update the \\ncomments to make this clearer. \\n\\n 2. CacheEntry \\n\\n a) Misleading name: lockWhenIdentityIsSet() \\n\\n Your suggestion lockAndBlockUntilIdentityIsSet() does match more \\nclosely the calls in the method (lock() + await()), but since await() \\nwill release the lock until it wakes up, I think the original name \\ndescribes better how the locking and blocking is perceived from \\noutside the method. Perhaps waitUntilIdentityIsSetAndLock() is a \\nbetter name? Of course, better comments in the method would also help. \\n\\n 3. ReplacementPolicy \\n\\n a) Return value from insertEntry() isn\'t used. \\n\\n The return value isn\'t needed since the replacement policy will link \\nthe CacheEntry and the Callback internally by calling \\nCacheEntry.setCallback(). Will change the method so that it\'s void. \\n\\n 4. ClockPolicy \\n\\n a) Why not synchronize inside grow()? \\n\\n One of the callers needs the synchronization for more than just the \\ncall to grow() and therefore needs the synchronized block anyway, so I \\nfelt it was more consistent if all (both) callers used an explicit \\nsynchronization block. (It also avoided double synchronization for \\nthat caller.) The other methods you mention are supposed to be atomic, \\nand are not intended to be called from within a larger block \\nsynchronized on the same object. \\n\\n b) Handling of small cache sizes in rotateClock(). \\n\\n I agree that this is a bit strange. The logic is copied from \\nClock.rotateClock(), by the way. I believe you are correct that it\'s \\nnot relevant for the (default) cache sizes currently used (none is \\nsmaller than 32). Perhaps it would be better to simplify it and just \\nsay itemsToCheck = Math.max(20, ...) or something (the number 20 is \\narbitrary). \\n\\n c) Add more comments about why cleaned entries are not reused. \\n\\n Will update the comments with more details from the JIRA discussion. \\n\\n d) Incomplete @return tag for shrinkMe(). \\n\\n Thanks, fixed in revision 631225. \\n\\n e) Off-by-one error in shrinkMe(). \\n\\n I don\'t think there is an off-by-one error, since we use the old value \\nof pos, not the one that has been increased by one. I guess it\'s a bit \\nconfusing to use the postfix increment operator and store away the old \\nvalue on the same line in the code. Perhaps it would be clearer if the \\ncode were reordered from \\n\\n                 index = pos++; \\n                h = clock.get(index); \\n\\n to \\n\\n                 h = clock.get(pos); \\n                index = pos; \\n                pos++; \\n\\n Or perhaps I misunderstood what you meant? \\n\\n f) Factor out common code for evicting entries in rotateClock() and \\nshrinkMe(). \\n\\n Will do that. \\n\\n g) Comment on the heuristics in trimMe(). \\n\\n As you quite correctly guessed, the heuristics have been taken from \\nthe old clock implementation (Clock.trimToSize()), and I don\'t know \\nwhy they were chosen. \\n\\n What strikes me with the heuristics, is that they seem to do their \\nbest to prevent this method from ever doing anything (which can also \\nbe seen in the code coverage reports). Also, I don\'t see very much \\nvalue in shrinking a cache that already is smaller than the max \\nsize. If someone needs it, the correct way would be to reduce the max \\nsize of the cache, I think. Perhaps it would be better just to remove \\nit? Seems like it\'s much complexity for little added value. \\n\\n h) Naming constants used in heuristic \\n\\n Probably a good idea. Will do that. \\n\\n 5. BackgroundCleaner \\n\\n a) Misleading class javadoc \\n\\n Will fix that comment. \\n\\n b) Comment that serviceImmediately() isn\'t used by BasicDaemon \\n\\n Could do that. Now, BackgroundCleaner doesn\'t know that it\'s being \\nserviced by a BasicDaemon, so I\'m not sure whether or not it\'s \\nBackgroundCleaner\'s concern that the method is not being used by \\nBasicDaemon. If another implementation of DaemonService is used \\n(that\'s not controlled by the cache implementation), the returned \\nvalue may become relevant.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12573178\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12573178&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12573178\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12573178_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573178_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/08 08:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-28T08:15:57+0000\'\u003e28\\/Feb\\/08 08:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s the patch (d2911-enable.diff) that\'s needed if we want to enable the new buffer manager for Java version 1.5 and higher. It only changes a couple of lines in modules.properties to make sure the correct classes are loaded when the database is booted. It doesn\'t change anything for 1.4 or Java ME, so they\'ll still use the old buffer manager.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12573178_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573178_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/08 08:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-28T08:15:57+0000\'\u003e28\\/Feb\\/08 08:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s the patch (d2911-enable.diff) that\'s needed if we want to enable the new buffer manager for Java version 1.5 and higher. It only changes a couple of lines in modules.properties to make sure the correct classes are loaded when the database is booted. It doesn\'t change anything for 1.4 or Java ME, so they\'ll still use the old buffer manager.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12573179\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12573179&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12573179\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"oysteing\\\" id=\\\"commentauthor_12573179_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=oysteing\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"oysteing\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e \\u00D8ystein Gr\\u00F8vlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573179_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/08 08:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-28T08:32:59+0000\'\u003e28\\/Feb\\/08 08:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree that we should just go ahead and enable the buffer manager.  The issues I raised can be addressed later.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"oysteing\\\" id=\\\"commentauthor_12573179_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=oysteing\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"oysteing\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e \\u00D8ystein Gr\\u00F8vlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573179_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/08 08:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-28T08:32:59+0000\'\u003e28\\/Feb\\/08 08:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree that we should just go ahead and enable the buffer manager.  The issues I raised can be addressed later.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12573230\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12573230&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12573230\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12573230_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573230_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/08 11:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-28T11:17:45+0000\'\u003e28\\/Feb\\/08 11:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks \\u00D8ystein. I checked in d2911-enable.diff with revision 631930. I have tested it with derbyall and suites.All on 1.6, and with suites.All on 1.4.2 and 1.5 (Sun\'s JVMs on Solaris 10).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12573230_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573230_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/08 11:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-28T11:17:45+0000\'\u003e28\\/Feb\\/08 11:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks \\u00D8ystein. I checked in d2911-enable.diff with revision 631930. I have tested it with derbyall and suites.All on 1.6, and with suites.All on 1.4.2 and 1.5 (Sun\'s JVMs on Solaris 10).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12576992\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12576992&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12576992\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12576992_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12576992_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/08 14:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-10T14:03:11+0000\'\u003e10\\/Mar\\/08 14:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI improved some comments in revision 635556 to address 1a and 1d.\u003c\\/p\u003e\\n\\n\u003cp\u003e1b and 1c were addressed in revision 635183 as part of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3493\\\" title=\\\"stress.multi times out waiting on testers with blocked testers waiting on the same statement\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3493\\\"\u003e\u003cdel\u003eDERBY-3493\u003c\\/del\u003e\u003c\\/a\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12576992_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12576992_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/08 14:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-10T14:03:11+0000\'\u003e10\\/Mar\\/08 14:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I improved some comments in revision 635556 to address 1a and 1d. \\n\\n 1b and 1c were addressed in revision 635183 as part of   DERBY-3493  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12577030\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12577030&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12577030\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577030_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577030_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/08 15:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-10T15:21:06+0000\'\u003e10\\/Mar\\/08 15:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eImproved some more comments in revision 635577. This should address 4c, 5a and 5b.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577030_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577030_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/08 15:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-10T15:21:06+0000\'\u003e10\\/Mar\\/08 15:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Improved some more comments in revision 635577. This should address 4c, 5a and 5b.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12577441\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12577441&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12577441\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577441_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577441_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/08 13:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-11T13:28:14+0000\'\u003e11\\/Mar\\/08 13:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching d2911-12.diff which addresses \\u00D8ystein\'s comments 3a, 4a (indirectly, since that code was removed), 4b and 4f. It makes ReplacementPolicy.insertEntry() void since the return value is not used, it simplifies the handling of small caches in ClockPolicy.rotateClock(), and it factors out common code in ClockPolicy.rotateClock() and ClockPolicy.shrinkMe(). This patch is not supposed to change the behaviour in any way.\u003c\\/p\u003e\\n\\n\u003cp\u003esuites.All ran cleanly. I have also started derbyall and I will report back if it fails.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577441_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577441_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/08 13:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-11T13:28:14+0000\'\u003e11\\/Mar\\/08 13:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching d2911-12.diff which addresses \\u00D8ystein\'s comments 3a, 4a (indirectly, since that code was removed), 4b and 4f. It makes ReplacementPolicy.insertEntry() void since the return value is not used, it simplifies the handling of small caches in ClockPolicy.rotateClock(), and it factors out common code in ClockPolicy.rotateClock() and ClockPolicy.shrinkMe(). This patch is not supposed to change the behaviour in any way. \\n\\n suites.All ran cleanly. I have also started derbyall and I will report back if it fails.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12577460\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12577460&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12577460\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577460_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577460_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/08 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-11T14:29:43+0000\'\u003e11\\/Mar\\/08 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAll tests passed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577460_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577460_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/08 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-11T14:29:43+0000\'\u003e11\\/Mar\\/08 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    All tests passed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12577755\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12577755&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12577755\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577755_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577755_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Mar\\/08 08:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-12T08:25:02+0000\'\u003e12\\/Mar\\/08 08:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted revision 636247.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577755_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577755_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Mar\\/08 08:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-12T08:25:02+0000\'\u003e12\\/Mar\\/08 08:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed revision 636247.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12577861\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12577861&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12577861\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577861_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577861_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Mar\\/08 14:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-12T14:42:45+0000\'\u003e12\\/Mar\\/08 14:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a patch (d2911-13) which addresses 2a and 4h. I have started the regression tests suite.\u003c\\/p\u003e\\n\\n\u003cp\u003e2a: Instead of inventing a new name for lockWhenIdentityIsSet(), I created a new method waitUntilIdentityIsSet() and let the callers first invoke lock() and then waitUntilIdentityIsSet(). I think that makes the code clearer.\u003c\\/p\u003e\\n\\n\u003cp\u003e4h: I created named constants for the numeric constants in rotateClock() and shrinkMe(). I didn\'t make any changes to trimMe(), since I\'m wondering if it\'s best just to remove it.\u003c\\/p\u003e\\n\\n\u003cp\u003eAfter this patch, I think it\'s only 4g (explain the heuristics in ClockPolicy.trimMe()) that hasn\'t been addressed. I believe that trimMe() in reality is dead code (supported by the fact that its predecessor Clock.trimToSize() is always a no-op in the regression tests according to the test coverage reports), and a better and more reliable solution for the problem it tries to solve, is to reduce the cache size. Unless someone comes up with a situation where Clock.trimToSize() and ClockPolicy.trimMe() provide valuable functionality, I\'m inclined to remove the latter.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12577861_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12577861_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Mar\\/08 14:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-12T14:42:45+0000\'\u003e12\\/Mar\\/08 14:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a patch (d2911-13) which addresses 2a and 4h. I have started the regression tests suite. \\n\\n 2a: Instead of inventing a new name for lockWhenIdentityIsSet(), I created a new method waitUntilIdentityIsSet() and let the callers first invoke lock() and then waitUntilIdentityIsSet(). I think that makes the code clearer. \\n\\n 4h: I created named constants for the numeric constants in rotateClock() and shrinkMe(). I didn\'t make any changes to trimMe(), since I\'m wondering if it\'s best just to remove it. \\n\\n After this patch, I think it\'s only 4g (explain the heuristics in ClockPolicy.trimMe()) that hasn\'t been addressed. I believe that trimMe() in reality is dead code (supported by the fact that its predecessor Clock.trimToSize() is always a no-op in the regression tests according to the test coverage reports), and a better and more reliable solution for the problem it tries to solve, is to reduce the cache size. Unless someone comes up with a situation where Clock.trimToSize() and ClockPolicy.trimMe() provide valuable functionality, I\'m inclined to remove the latter.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12578189\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12578189&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12578189\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12578189_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12578189_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Mar\\/08 08:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-13T08:48:47+0000\'\u003e13\\/Mar\\/08 08:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted revision 636670.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12578189_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12578189_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Mar\\/08 08:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-13T08:48:47+0000\'\u003e13\\/Mar\\/08 08:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed revision 636670.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12582651\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12582651&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12582651\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12582651_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12582651_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/08 13:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-27T13:55:52+0000\'\u003e27\\/Mar\\/08 13:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching two new patches for review:\u003c\\/p\u003e\\n\\n\u003cp\u003ed2911-14.diff - rewrites the part of ClockPolicy.shrinkMe() that \\u00D8ystein mentioned in his comment 4e. It is not supposed to change the behaviour, only make the relationship between the variables pos and index clearer.\u003c\\/p\u003e\\n\\n\u003cp\u003ed2911-15.diff - removes the method ClockPolicy.trimeMe() since it\'s only adding complexity and doesn\'t have any real value (I think).\u003c\\/p\u003e\\n\\n\u003cp\u003eDerbyall and suites.All ran cleanly (except ManagementMBeanTest which has failed for some time in the nightly regression tests too).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12582651_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12582651_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/08 13:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-27T13:55:52+0000\'\u003e27\\/Mar\\/08 13:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching two new patches for review: \\n\\n d2911-14.diff - rewrites the part of ClockPolicy.shrinkMe() that \\u00D8ystein mentioned in his comment 4e. It is not supposed to change the behaviour, only make the relationship between the variables pos and index clearer. \\n\\n d2911-15.diff - removes the method ClockPolicy.trimeMe() since it\'s only adding complexity and doesn\'t have any real value (I think). \\n\\n Derbyall and suites.All ran cleanly (except ManagementMBeanTest which has failed for some time in the nightly regression tests too).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12583453\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12583453&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12583453\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12583453_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12583453_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/08 15:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-30T15:04:05+0000\'\u003e30\\/Mar\\/08 15:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted d2911-14.diff with revision 642752.\u003cbr\\/\u003e\\nCommitted d2911-15.diff with revision 642755.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think all comments have been addressed now, and I\'m not planning any more patches on this issue. Some of the patches have only been committed to trunk (revisions 635577, 636247, 636670, 642752 and 642755). None of them needs to go to the 10.4 branch, but unless there are objections, I\'ll merge them to minimize the difference between trunk and the branch (which makes it easier to map stack traces from bug reports against 10.4 to the code in trunk).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12583453_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12583453_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/08 15:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-30T15:04:05+0000\'\u003e30\\/Mar\\/08 15:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed d2911-14.diff with revision 642752. \\nCommitted d2911-15.diff with revision 642755. \\n\\n I think all comments have been addressed now, and I\'m not planning any more patches on this issue. Some of the patches have only been committed to trunk (revisions 635577, 636247, 636670, 642752 and 642755). None of them needs to go to the 10.4 branch, but unless there are objections, I\'ll merge them to minimize the difference between trunk and the branch (which makes it easier to map stack traces from bug reports against 10.4 to the code in trunk).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12583468\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12583468&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12583468\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12583468_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12583468_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/08 17:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-30T17:35:13+0000\'\u003e30\\/Mar\\/08 17:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think it is a good idea to merge the changes to the 10.4 branch before the release candidate is produced.\u003cbr\\/\u003e\\n+1 from me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12583468_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12583468_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/08 17:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-30T17:35:13+0000\'\u003e30\\/Mar\\/08 17:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think it is a good idea to merge the changes to the 10.4 branch before the release candidate is produced. \\n+1 from me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12584067\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2911?focusedCommentId=12584067&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12584067\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12584067_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12584067_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/08 09:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-04-01T09:05:58+0000\'\u003e01\\/Apr\\/08 09:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMerged the latest changes (rev. 635556, 635577, 636247, 636670, 642752, 642755) to 10.4 and committed revision 643327.\u003c\\/p\u003e\\n\\n\u003cp\u003eMarking the issue as resolved (with fix version 10.4.0.0 since almost all the code went in before the 10.4 branch was cut).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12584067_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12584067_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/08 09:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-04-01T09:05:58+0000\'\u003e01\\/Apr\\/08 09:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Merged the latest changes (rev. 635556, 635577, 636247, 636670, 642752, 642755) to 10.4 and committed revision 643327. \\n\\n Marking the issue as resolved (with fix version 10.4.0.0 since almost all the code went in before the 10.4 branch was cut).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516198314612"> 
    <input type="hidden" title="jira.request.server.time" value="927"> 
    <input type="hidden" title="jira.request.id" value="851x7489252x2"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="3"> 
    <input type="hidden" title="db.reads.time.in.ms" value="78"> 
    <input type="hidden" title="db.conns.time.in.ms" value="88"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 851x7489252x2
	          REQUEST TIMESTAMP : [17/Jan/2018:14:11:54 +0000]
	               REQUEST TIME : 0.9270
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 3

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=35, elapsedTotal=78281040, elapsedMin=799711, elapsedMax=17232883, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=39, elapsedTotal=88769183, elapsedMin=867143, elapsedMax=17410760, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>