<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|f19cd3c05578d8ed5ea648bed5133b33d39d914d|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"99967d50e97395\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-3926"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-3926] Incorrect ORDER BY caused by index - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-3926] Incorrect ORDER BY caused by index - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-3926">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-3926" href="/jira/browse/DERBY-3926" id="key-val" rel="12407399">DERBY-3926</a></li>
                </ol>
                <h1 id="summary-val">Incorrect ORDER BY caused by index</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-3926"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-3926/DERBY-3926.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-3926/DERBY-3926.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-3926/DERBY-3926.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-3926/DERBY-3926.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.1.3.3 Head of 10.1 branch. Maintenance version bump for sps update ">10.1.3.3</span>, <span title="10.2.2.1 Head of 10.2 branch">10.2.2.1</span>, <span title="10.3.3.1 Head of 10.3 branch">10.3.3.1</span>, <span title="10.4.2.0 ">10.4.2.0</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.1.3.3" title="10.1.3.3 Head of 10.1 branch. Maintenance version bump for sps update ">10.1.3.3</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.2.2.1" title="10.2.2.1 Head of 10.2 branch">10.2.2.1</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.3.3.1" title="10.3.3.1 Head of 10.3 branch">10.3.3.1</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.4.2.1" title="10.4.2.1 Head of 10.4 branch">10.4.2.1</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.5.2.0" title="10.5.2.0 10.5.2 Release July 30 2009 (794445) Now deprecated">10.5.2.0</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.6.1.0" title="10.6.1.0 Feature release">10.6.1.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+SQL" title="SQL ">SQL</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12407399-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     Checked into 10.3. This will still go to 10.2 and 10.1
                    <br> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310050" class="item"> 
                     <div class="wrap"> 
                      <strong title="Urgency" class="name">Urgency:</strong> 
                      <div id="customfield_12310050-val" class="value type-select" data-fieldtype="select" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        Normal 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310090" class="item"> 
                     <div class="wrap"> 
                      <strong title="Issue &amp; fix info" class="name">Issue &amp; fix info:</strong> 
                      <div id="customfield_12310090-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310090-field"> 
                        <span>High Value Fix</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310200" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bug behavior facts" class="name">Bug behavior facts:</strong> 
                      <div id="customfield_12310200-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310200-field"> 
                        <span>Wrong query result</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>I think I found a bug in Derby that is triggered by an index on a large column: VARCHAR(1024). I know it is generally not a good idea to have an index on such a large column.</p> 
                  <p>I have a table (table2) with a column "value", my query orders on this column but the result is not sorted. It is sorted if I remove the index on that column.</p> 
                  <p>The output of the attached script is as follows (results should be ordered on the middle column):<br> ID |VALUE |VALUE<br> ----------------------------------------------<br> 2147483653 |000002 |21857<br> 2147483654 |000003 |21857<br> 4294967297 |000001 |21857</p> 
                  <p>While I would expect:<br> ID |VALUE |VALUE<br> ----------------------------------------------<br> 4294967297 |000001 |21857<br> 2147483653 |000002 |21857<br> 2147483654 |000003 |21857</p> 
                  <p>This is the definition:<br> CREATE TABLE table1 (id BIGINT NOT NULL, PRIMARY KEY(id));<br> CREATE INDEX key1 ON table1(id);<br> CREATE TABLE table2 (id BIGINT NOT NULL, name VARCHAR(40) NOT NULL, value VARCHAR(1024), PRIMARY KEY(id, name));<br> CREATE UNIQUE INDEX key2 ON table2(id, name);<br> CREATE INDEX key3 ON table2(value);</p> 
                  <p>This is the query:<br> SELECT table1.id, m0.value, m1.value<br> FROM table1, table2 m0, table2 m1<br> WHERE table1.id=m0.id<br> AND m0.name='PageSequenceId'<br> AND table1.id=m1.id<br> AND m1.name='PostComponentId'<br> AND m1.value='21857'<br> ORDER BY m0.value;</p> 
                  <p>The bug can be reproduced by just executing the attached script with the ij-tool.<br> Note that the result of the query becomes correct when enough data is changed. This prevented me from creating a smaller example.</p> 
                  <p>See the attached file "derby-reproduce.zip" for sysinfo, derby.log and script.sql.</p> 
                  <p>Michael Segel pointed out:<br> "It looks like its hitting the index ordering on id,name from table 2 and is ignoring the order by clause."</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-3926?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-3926?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-3926?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-3926?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12407375" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12407375/d3926_repro.sql" draggable="true" data-downloadurl="text/x-sql:d3926_repro.sql:https://issues.apache.org/jira/secure/attachment/12407375/d3926_repro.sql"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12407375/d3926_repro.sql" title="Latest  06/May/09 16:28 - A B" draggable="true" data-downloadurl="text/x-sql:d3926_repro.sql:https://issues.apache.org/jira/secure/attachment/12407375/d3926_repro.sql">d3926_repro.sql</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-06T16:28:30.145Z">06/May/09 16:28</time>
                   </dd>
                   <dd class="attachment-size">
                    0.6 kB
                   </dd>
                   <dd class="attachment-author">
                    A B
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12411115" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12411115/derby-3926_10.3_mergeattempt.txt" draggable="true" data-downloadurl="text/plain:derby-3926_10.3_mergeattempt.txt:https://issues.apache.org/jira/secure/attachment/12411115/derby-3926_10.3_mergeattempt.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12411115/derby-3926_10.3_mergeattempt.txt" title="Latest  18/Jun/09 17:56 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:derby-3926_10.3_mergeattempt.txt:https://issues.apache.org/jira/secure/attachment/12411115/derby-3926_10.3_mergeattempt.txt">derby-3926_10.3_mergeattempt.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-06-18T17:56:57.351Z">18/Jun/09 17:56</time>
                   </dd>
                   <dd class="attachment-size">
                    53 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12407795" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12407795/DERBY3926_notforcheckin_patch1_051109_diff.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_notforcheckin_patch1_051109_diff.txt:https://issues.apache.org/jira/secure/attachment/12407795/DERBY3926_notforcheckin_patch1_051109_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12407795/DERBY3926_notforcheckin_patch1_051109_diff.txt" title="Latest  11/May/09 17:25 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_notforcheckin_patch1_051109_diff.txt:https://issues.apache.org/jira/secure/attachment/12407795/DERBY3926_notforcheckin_patch1_051109_diff.txt">DERBY3926_notforcheckin_patch1_051109_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-11T17:25:32.368Z">11/May/09 17:25</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12407796" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12407796/DERBY3926_notforcheckin_patch1_051109_stat.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_notforcheckin_patch1_051109_stat.txt:https://issues.apache.org/jira/secure/attachment/12407796/DERBY3926_notforcheckin_patch1_051109_stat.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12407796/DERBY3926_notforcheckin_patch1_051109_stat.txt" title="Latest  11/May/09 17:25 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_notforcheckin_patch1_051109_stat.txt:https://issues.apache.org/jira/secure/attachment/12407796/DERBY3926_notforcheckin_patch1_051109_stat.txt">DERBY3926_notforcheckin_patch1_051109_stat.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-11T17:25:32.395Z">11/May/09 17:25</time>
                   </dd>
                   <dd class="attachment-size">
                    0.7 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12407816" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12407816/DERBY3926_notforcheckin_patch2_051109_diff.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_notforcheckin_patch2_051109_diff.txt:https://issues.apache.org/jira/secure/attachment/12407816/DERBY3926_notforcheckin_patch2_051109_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12407816/DERBY3926_notforcheckin_patch2_051109_diff.txt" title="Latest  11/May/09 20:51 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_notforcheckin_patch2_051109_diff.txt:https://issues.apache.org/jira/secure/attachment/12407816/DERBY3926_notforcheckin_patch2_051109_diff.txt">DERBY3926_notforcheckin_patch2_051109_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-11T20:51:40.243Z">11/May/09 20:51</time>
                   </dd>
                   <dd class="attachment-size">
                    9 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12408262" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12408262/DERBY3926_patch3_051509_diff.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_patch3_051509_diff.txt:https://issues.apache.org/jira/secure/attachment/12408262/DERBY3926_patch3_051509_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12408262/DERBY3926_patch3_051509_diff.txt" title="Latest  15/May/09 16:36 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_patch3_051509_diff.txt:https://issues.apache.org/jira/secure/attachment/12408262/DERBY3926_patch3_051509_diff.txt">DERBY3926_patch3_051509_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-15T16:36:31.344Z">15/May/09 16:36</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12408263" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12408263/DERBY3926_patch3_051509_stat.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_patch3_051509_stat.txt:https://issues.apache.org/jira/secure/attachment/12408263/DERBY3926_patch3_051509_stat.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12408263/DERBY3926_patch3_051509_stat.txt" title="Latest  15/May/09 16:36 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_patch3_051509_stat.txt:https://issues.apache.org/jira/secure/attachment/12408263/DERBY3926_patch3_051509_stat.txt">DERBY3926_patch3_051509_stat.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-15T16:36:31.387Z">15/May/09 16:36</time>
                   </dd>
                   <dd class="attachment-size">
                    0.3 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12408558" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12408558/DERBY3926_patch4_051519_diff.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_patch4_051519_diff.txt:https://issues.apache.org/jira/secure/attachment/12408558/DERBY3926_patch4_051519_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12408558/DERBY3926_patch4_051519_diff.txt" title="Latest  20/May/09 06:17 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_patch4_051519_diff.txt:https://issues.apache.org/jira/secure/attachment/12408558/DERBY3926_patch4_051519_diff.txt">DERBY3926_patch4_051519_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-20T06:17:48.928Z">20/May/09 06:17</time>
                   </dd>
                   <dd class="attachment-size">
                    12 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12408559" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12408559/DERBY3926_patch4_051519_stat.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_patch4_051519_stat.txt:https://issues.apache.org/jira/secure/attachment/12408559/DERBY3926_patch4_051519_stat.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12408559/DERBY3926_patch4_051519_stat.txt" title="Latest  20/May/09 06:17 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_patch4_051519_stat.txt:https://issues.apache.org/jira/secure/attachment/12408559/DERBY3926_patch4_051519_stat.txt">DERBY3926_patch4_051519_stat.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-20T06:17:48.931Z">20/May/09 06:17</time>
                   </dd>
                   <dd class="attachment-size">
                    0.3 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12409186" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12409186/DERBY3926_patch5_052709_diff.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_patch5_052709_diff.txt:https://issues.apache.org/jira/secure/attachment/12409186/DERBY3926_patch5_052709_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12409186/DERBY3926_patch5_052709_diff.txt" title="Latest  27/May/09 16:58 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_patch5_052709_diff.txt:https://issues.apache.org/jira/secure/attachment/12409186/DERBY3926_patch5_052709_diff.txt">DERBY3926_patch5_052709_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-27T16:58:38.846Z">27/May/09 16:58</time>
                   </dd>
                   <dd class="attachment-size">
                    15 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12409187" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12409187/DERBY3926_patch5_052709_stat.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_patch5_052709_stat.txt:https://issues.apache.org/jira/secure/attachment/12409187/DERBY3926_patch5_052709_stat.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12409187/DERBY3926_patch5_052709_stat.txt" title="Latest  27/May/09 16:58 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_patch5_052709_stat.txt:https://issues.apache.org/jira/secure/attachment/12409187/DERBY3926_patch5_052709_stat.txt">DERBY3926_patch5_052709_stat.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-05-27T16:58:38.885Z">27/May/09 16:58</time>
                   </dd>
                   <dd class="attachment-size">
                    0.5 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12409853" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12409853/DERBY3926_patch6_060309_diff.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_patch6_060309_diff.txt:https://issues.apache.org/jira/secure/attachment/12409853/DERBY3926_patch6_060309_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12409853/DERBY3926_patch6_060309_diff.txt" title="Latest  04/Jun/09 06:26 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_patch6_060309_diff.txt:https://issues.apache.org/jira/secure/attachment/12409853/DERBY3926_patch6_060309_diff.txt">DERBY3926_patch6_060309_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-06-04T06:26:45.301Z">04/Jun/09 06:26</time>
                   </dd>
                   <dd class="attachment-size">
                    54 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12409854" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12409854/DERBY3926_patch6_060309_stat.txt" draggable="true" data-downloadurl="text/plain:DERBY3926_patch6_060309_stat.txt:https://issues.apache.org/jira/secure/attachment/12409854/DERBY3926_patch6_060309_stat.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12409854/DERBY3926_patch6_060309_stat.txt" title="Latest  04/Jun/09 06:26 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:DERBY3926_patch6_060309_stat.txt:https://issues.apache.org/jira/secure/attachment/12409854/DERBY3926_patch6_060309_stat.txt">DERBY3926_patch6_060309_stat.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-06-04T06:26:45.338Z">04/Jun/09 06:26</time>
                   </dd>
                   <dd class="attachment-size">
                    0.9 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12392976" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12392976/derby-reproduce.zip" draggable="true" data-downloadurl="application/zip:derby-reproduce.zip:https://issues.apache.org/jira/secure/attachment/12392976/derby-reproduce.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-zip" title="Zip Archive"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12392976/derby-reproduce.zip" title="Latest  29/Oct/08 08:58 - Tars Joris" draggable="true" data-downloadurl="application/zip:derby-reproduce.zip:https://issues.apache.org/jira/secure/attachment/12392976/derby-reproduce.zip">derby-reproduce.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-10-29T08:58:10.304Z">29/Oct/08 08:58</time>
                   </dd>
                   <dd class="attachment-size">
                    15 kB
                   </dd>
                   <dd class="attachment-author">
                    Tars Joris
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12406701" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12406701/script3.sql" draggable="true" data-downloadurl="text/plain:script3.sql:https://issues.apache.org/jira/secure/attachment/12406701/script3.sql"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12406701/script3.sql" title="Latest  28/Apr/09 21:49 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:script3.sql:https://issues.apache.org/jira/secure/attachment/12406701/script3.sql">script3.sql</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-04-28T21:49:46.001Z">28/Apr/09 21:49</time>
                   </dd>
                   <dd class="attachment-size">
                    392 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12406808" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12406808/script3WithUserFriendlyIndexNames.sql" draggable="true" data-downloadurl="text/plain:script3WithUserFriendlyIndexNames.sql:https://issues.apache.org/jira/secure/attachment/12406808/script3WithUserFriendlyIndexNames.sql"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12406808/script3WithUserFriendlyIndexNames.sql" title="Latest  29/Apr/09 18:12 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:script3WithUserFriendlyIndexNames.sql:https://issues.apache.org/jira/secure/attachment/12406808/script3WithUserFriendlyIndexNames.sql">script3WithUserFriendlyIndexNames.sql</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-04-29T18:12:09.476Z">29/Apr/09 18:12</time>
                   </dd>
                   <dd class="attachment-size">
                    392 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12406494" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12406494/test-script.zip" draggable="true" data-downloadurl="application/x-zip-compressed:test-script.zip:https://issues.apache.org/jira/secure/attachment/12406494/test-script.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12406494/test-script.zip" title="Latest  27/Apr/09 07:22 - Tars Joris" draggable="true" data-downloadurl="application/x-zip-compressed:test-script.zip:https://issues.apache.org/jira/secure/attachment/12406494/test-script.zip">test-script.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-04-27T07:22:46.106Z">27/Apr/09 07:22</time>
                   </dd>
                   <dd class="attachment-size">
                    13 kB
                   </dd>
                   <dd class="attachment-author">
                    Tars Joris
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12411542" data-issue-id="12407399" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12411542/wisconsin_10.1_result.zip" draggable="true" data-downloadurl="application/x-zip-compressed:wisconsin_10.1_result.zip:https://issues.apache.org/jira/secure/attachment/12411542/wisconsin_10.1_result.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12411542/wisconsin_10.1_result.zip" title="Latest  23/Jun/09 14:51 - Kathey Marsden" draggable="true" data-downloadurl="application/x-zip-compressed:wisconsin_10.1_result.zip:https://issues.apache.org/jira/secure/attachment/12411542/wisconsin_10.1_result.zip">wisconsin_10.1_result.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-06-23T14:51:23.323Z">23/Jun/09 14:51</time>
                   </dd>
                   <dd class="attachment-size">
                    149 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="depends upon">
                   depends upon
                  </dt> 
                  <dd id="internal-12411288_10001"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-3997: ORDER BY causes column to be returned"> <a href="/jira/browse/DERBY-3997" data-issue-key="DERBY-3997" class="issue-link link-title resolution">DERBY-3997</a> <span class="link-summary">ORDER BY causes column to be returned</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12417446_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4105: NPE when the attached reproducible script is run using ij."> <a href="/jira/browse/DERBY-4105" data-issue-key="DERBY-4105" class="issue-link link-title resolution">DERBY-4105</a> <span class="link-summary">NPE when the attached reproducible script is run using ij.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12425987_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4240: An index cause SQL ORDER BY can't return correct result"> <a href="/jira/browse/DERBY-4240" data-issue-key="DERBY-4240" class="issue-link link-title resolution">DERBY-4240</a> <span class="link-summary">An index cause SQL ORDER BY can't return correct result</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12431975_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4331: Join returns results in wrong order"> <a href="/jira/browse/DERBY-4331" data-issue-key="DERBY-4331" class="issue-link link-title resolution">DERBY-4331</a> <span class="link-summary">Join returns results in wrong order</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12640488_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-6148: Wrong sort elimination when using permuted join order"> <a href="/jira/browse/DERBY-6148" data-issue-key="DERBY-6148" class="issue-link link-title resolution">DERBY-6148</a> <span class="link-summary">Wrong sort elimination when using permuted join order</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_mamtas" rel="mamtas" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Mamta A. Satoor&quot;,&quot;emailAddress&quot;:&quot;msatoor@gmail.com&quot;,&quot;username&quot;:&quot;mamtas&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mamtas"></span></span> Mamta A. Satoor </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_tjoris" rel="tjoris" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Tars Joris&quot;,&quot;emailAddress&quot;:&quot;tars.joris@inventivedesigners.com&quot;,&quot;username&quot;:&quot;tjoris&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="tjoris"></span></span> Tars Joris </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="29/Oct/08 08:56"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2008-10-29T08:56:57+0000">29/Oct/08 08:56</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="16/May/13 06:53"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-05-16T06:53:30+0000">16/May/13 06:53</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="12/Aug/09 16:23"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2009-08-12T16:23:08+0000">12/Aug/09 16:23</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3926?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-3926?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12643442\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12643442&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12643442\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tjoris\\\" id=\\\"commentauthor_12643442_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tjoris\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tjoris\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tars Joris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12643442_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Oct\\/08 08:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-29T08:58:10+0000\'\u003e29\\/Oct\\/08 08:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ederby.log\u003cbr\\/\u003e\\noutput.txt\u003cbr\\/\u003e\\nscript.sql\u003cbr\\/\u003e\\nsysinfo.txt\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tjoris\\\" id=\\\"commentauthor_12643442_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tjoris\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tjoris\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tars Joris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12643442_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Oct\\/08 08:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-10-29T08:58:10+0000\'\u003e29\\/Oct\\/08 08:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    derby.log \\noutput.txt \\nscript.sql \\nsysinfo.txt              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12658240\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12658240&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12658240\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"stan\\\" id=\\\"commentauthor_12658240_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=stan\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"stan\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stan Bradbury\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12658240_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/08 01:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-20T01:03:32+0000\'\u003e20\\/Dec\\/08 01:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI verified the report then dropped and recreated the index key3.  The records ordered properly after that.  Go figure...??  With the newly created cardinality statistics it may be the correct index is selected this time but the original results are still wrong.\u003c\\/p\u003e\\n\\n\u003cp\u003eij&gt; SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 WHERE tab\u003cbr\\/\u003e\\nER BY m0.value;\u003cbr\\/\u003e\\nID                  |VALUE\u003cbr\\/\u003e\\n----------------------------------------------------------------------------------\u003cbr\\/\u003e\\n------------------------------------------------------------------------------\u003cbr\\/\u003e\\n2147483653          |000002\u003cbr\\/\u003e\\n2147483654          |000003\u003cbr\\/\u003e\\n4294967297          |000001\u003cbr\\/\u003e\\n3 rows selected\u003c\\/p\u003e\\n\\n\u003cp\u003eij&gt; drop index key3;\u003cbr\\/\u003e\\n0 rows inserted\\/updated\\/deleted\u003c\\/p\u003e\\n\\n\u003cp\u003eij&gt; SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 WHERE\u003cbr\\/\u003e\\ntable1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND\u003cbr\\/\u003e\\nm1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value;\u003cbr\\/\u003e\\nID                  |VALUE\u003cbr\\/\u003e\\n------------------------------------------------------------------------------------\u003cbr\\/\u003e\\n------------------------------------------------------------------------------\u003cbr\\/\u003e\\n4294967297          |000001\u003cbr\\/\u003e\\n2147483653          |000002\u003cbr\\/\u003e\\n2147483654          |000003\u003cbr\\/\u003e\\n3 rows selected\u003c\\/p\u003e\\n\\n\u003cp\u003eij&gt; CREATE INDEX key3 ON table2(value);\u003cbr\\/\u003e\\n0 rows inserted\\/updated\\/deleted\u003cbr\\/\u003e\\nij&gt; SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 WHERE\u003cbr\\/\u003e\\ntable1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND\u003cbr\\/\u003e\\nm1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value;\u003cbr\\/\u003e\\nID                  |VALUE\u003cbr\\/\u003e\\n------------------------------------------------------------------------------------\u003cbr\\/\u003e\\n------------------------------------------------------------------------------\u003cbr\\/\u003e\\n4294967297          |000001\u003cbr\\/\u003e\\n2147483653          |000002\u003cbr\\/\u003e\\n2147483654          |000003\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e3 rows selected\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"stan\\\" id=\\\"commentauthor_12658240_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=stan\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"stan\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stan Bradbury\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12658240_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/08 01:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-12-20T01:03:32+0000\'\u003e20\\/Dec\\/08 01:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I verified the report then dropped and recreated the index key3.  The records ordered properly after that.  Go figure...??  With the newly created cardinality statistics it may be the correct index is selected this time but the original results are still wrong. \\n\\n ij&gt; SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 WHERE tab \\nER BY m0.value; \\nID                  |VALUE \\n---------------------------------------------------------------------------------- \\n------------------------------------------------------------------------------ \\n2147483653          |000002 \\n2147483654          |000003 \\n4294967297          |000001 \\n3 rows selected \\n\\n ij&gt; drop index key3; \\n0 rows inserted\\/updated\\/deleted \\n\\n ij&gt; SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 WHERE \\ntable1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND \\nm1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value; \\nID                  |VALUE \\n------------------------------------------------------------------------------------ \\n------------------------------------------------------------------------------ \\n4294967297          |000001 \\n2147483653          |000002 \\n2147483654          |000003 \\n3 rows selected \\n\\n ij&gt; CREATE INDEX key3 ON table2(value); \\n0 rows inserted\\/updated\\/deleted \\nij&gt; SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 WHERE \\ntable1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND \\nm1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value; \\nID                  |VALUE \\n------------------------------------------------------------------------------------ \\n------------------------------------------------------------------------------ \\n4294967297          |000001 \\n2147483653          |000002 \\n2147483654          |000003 \\n\\n\\n 3 rows selected              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12683974\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12683974&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12683974\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12683974_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12683974_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 18:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T18:21:26+0000\'\u003e20\\/Mar\\/09 18:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran the reporducible test case with couple different releases of Derby and noticed following\u003cbr\\/\u003e\\n1)on trunk, if I quit out of the ij session which does the setup and runs the query with incorrect results, and then start a new session and run the query again it returns correct result. I didn\'t have to drop and recreate the index for it to work. The plan used in the 2 cases for the query are different\u003cbr\\/\u003e\\n2)I found the same behavior in 10.2 codeline\u003cbr\\/\u003e\\n3)With 10.1 codeline, I ran into npe when trying to run the setup script. Not sure what is going on there. I will enter a jira entry for the 10.1 behavior.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12683974_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12683974_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 18:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T18:21:26+0000\'\u003e20\\/Mar\\/09 18:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran the reporducible test case with couple different releases of Derby and noticed following \\n1)on trunk, if I quit out of the ij session which does the setup and runs the query with incorrect results, and then start a new session and run the query again it returns correct result. I didn\'t have to drop and recreate the index for it to work. The plan used in the 2 cases for the query are different \\n2)I found the same behavior in 10.2 codeline \\n3)With 10.1 codeline, I ran into npe when trying to run the setup script. Not sure what is going on there. I will enter a jira entry for the 10.1 behavior.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12683990\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12683990&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12683990\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12683990_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12683990_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T19:00:48+0000\'\u003e20\\/Mar\\/09 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe query plan when the incorrect results are returned is as follows\u003cbr\\/\u003e\\nStatement Name:\u003cbr\\/\u003e\\n        null\u003cbr\\/\u003e\\nStatement Text:\u003cbr\\/\u003e\\n        SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 W\u003cbr\\/\u003e\\nHERE table1.id=m0.id AND\u003cbr\\/\u003e\\nm0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m\u003cbr\\/\u003e\\n1.value=\'21857\' ORDER BY\u003cbr\\/\u003e\\nm0.value\u003cbr\\/\u003e\\nParse Time: 0\u003cbr\\/\u003e\\nBind Time: 0\u003cbr\\/\u003e\\nOptimize Time: 0\u003cbr\\/\u003e\\nGenerate Time: 0\u003cbr\\/\u003e\\nCompile Time: 0\u003cbr\\/\u003e\\nExecute Time: 0\u003cbr\\/\u003e\\nBegin Compilation Timestamp : null\u003cbr\\/\u003e\\nEnd Compilation Timestamp : null\u003cbr\\/\u003e\\nBegin Execution Timestamp : null\u003cbr\\/\u003e\\nEnd Execution Timestamp : null\u003cbr\\/\u003e\\nStatement Execution Plan Text:\u003cbr\\/\u003e\\nProject-Restrict ResultSet (10):\u003cbr\\/\u003e\\nNumber of opens = 1\u003cbr\\/\u003e\\nRows seen = 3\u003cbr\\/\u003e\\nRows filtered = 0\u003cbr\\/\u003e\\nrestriction = false\u003cbr\\/\u003e\\nprojection = true\u003cbr\\/\u003e\\n        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n        open time (milliseconds) = 0\u003cbr\\/\u003e\\n        next time (milliseconds) = 0\u003cbr\\/\u003e\\n        close time (milliseconds) = 0\u003cbr\\/\u003e\\n        restriction time (milliseconds) = 0\u003cbr\\/\u003e\\n        projection time (milliseconds) = 0\u003cbr\\/\u003e\\n        optimizer estimated row count:            0.00\u003cbr\\/\u003e\\n        optimizer estimated cost:            3.52\u003c\\/p\u003e\\n\\n\u003cp\u003eSource result set:\u003cbr\\/\u003e\\n        Nested Loop Join ResultSet:\u003cbr\\/\u003e\\n        Number of opens = 1\u003cbr\\/\u003e\\n        Rows seen from the left = 168\u003cbr\\/\u003e\\n        Rows seen from the right = 3\u003cbr\\/\u003e\\n        Rows filtered = 0\u003cbr\\/\u003e\\n        Rows returned = 3\u003cbr\\/\u003e\\n                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                optimizer estimated row count:            0.00\u003cbr\\/\u003e\\n                optimizer estimated cost:            3.52\u003c\\/p\u003e\\n\\n\u003cp\u003e        Left result set:\u003cbr\\/\u003e\\n                Nested Loop Join ResultSet:\u003cbr\\/\u003e\\n                Number of opens = 1\u003cbr\\/\u003e\\n                Rows seen from the left = 3\u003cbr\\/\u003e\\n                Rows seen from the right = 168\u003cbr\\/\u003e\\n                Rows filtered = 0\u003cbr\\/\u003e\\n                Rows returned = 168\u003cbr\\/\u003e\\n                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                        optimizer estimated row count:            0.00\u003cbr\\/\u003e\\n                        optimizer estimated cost:            3.52\u003c\\/p\u003e\\n\\n\u003cp\u003e                Left result set:\u003cbr\\/\u003e\\n                        Project-Restrict ResultSet (5):\u003cbr\\/\u003e\\n                        Number of opens = 1\u003cbr\\/\u003e\\n                        Rows seen = 3\u003cbr\\/\u003e\\n                        Rows filtered = 0\u003cbr\\/\u003e\\n                        restriction = true\u003cbr\\/\u003e\\n                        projection = true\u003cbr\\/\u003e\\n                                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                restriction time (milliseconds) = 0\u003cbr\\/\u003e\\n                                projection time (milliseconds) = 0\u003cbr\\/\u003e\\n                                optimizer estimated row count:            0.00\u003cbr\\/\u003e\\n                                optimizer estimated cost:            3.52\u003c\\/p\u003e\\n\\n\u003cp\u003e                        Source result set:\u003cbr\\/\u003e\\n                                Index Row to Base Row ResultSet for TABLE2:\u003cbr\\/\u003e\\n                                Number of opens = 1\u003cbr\\/\u003e\\n                                Rows seen = 3\u003cbr\\/\u003e\\n                                Columns accessed from heap = \u003c\\/p\u003e\\n{0, 1, 2}\u003cbr\\/\u003e\\n                                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        optimizer estimated row count:  0.00\u003cbr\\/\u003e\\n                                        optimizer estimated cost:            3.52\u003cbr\\/\u003e\\n                                        Index Scan ResultSet for TABLE2 using index KEY3 at read committed isolation level using share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                                        Number of opens = 1\u003cbr\\/\u003e\\n                                        Rows seen = 3\u003cbr\\/\u003e\\n                                        Rows filtered = 0\u003cbr\\/\u003e\\n                                        Fetch Size = 1\u003cbr\\/\u003e\\n                                                constructor time (milliseconds)= 0\u003cbr\\/\u003e\\n                                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time in milliseconds\\/row =0\u003cbr\\/\u003e\\n                                        scan information:\u003cbr\\/\u003e\\n                                                Bit set of columns fetched=All\u003cbr\\/\u003e\\n                                                Number of columns fetched=2\u003cbr\\/\u003e\\n                                                Number of deleted rows visited=0\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                                                Number of pages visited=2\u003cbr\\/\u003e\\n                                                Number of rows qualified=3\u003cbr\\/\u003e\\n                                                Number of rows visited=4\u003cbr\\/\u003e\\n                                                Scan type=btree\u003cbr\\/\u003e\\n                                                Tree height=-1\u003cbr\\/\u003e\\n                                                start position:\u003cbr\\/\u003e\\n        &gt;= on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                                                stop position:\u003cbr\\/\u003e\\n        &gt; on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                                                qualifiers:None\u003cbr\\/\u003e\\n                                                optimizer estimated row count:        0.00\u003cbr\\/\u003e\\n                                                optimizer estimated cost:     3.52\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                Right result set:\u003cbr\\/\u003e\\n                        Project-Restrict ResultSet (8):\u003cbr\\/\u003e\\n                        Number of opens = 3\u003cbr\\/\u003e\\n                        Rows seen = 8688\u003cbr\\/\u003e\\n                        Rows filtered = 8520\u003cbr\\/\u003e\\n                        restriction = true\u003cbr\\/\u003e\\n                        projection = true\u003cbr\\/\u003e\\n                                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                restriction time (milliseconds) = 0\u003cbr\\/\u003e\\n                                projection time (milliseconds) = 0\u003cbr\\/\u003e\\n                                optimizer estimated row count:            0.00\u003cbr\\/\u003e\\n                                optimizer estimated cost:            0.00\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                        Source result set:\u003cbr\\/\u003e\\n                                Index Row to Base Row ResultSet for TABLE2:\u003cbr\\/\u003e\\n                                Number of opens = 3\u003cbr\\/\u003e\\n                                Rows seen = 8688\u003cbr\\/\u003e\\n                                Columns accessed from heap = {0, 1, 2}\\n\u003cp\u003e                                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        optimizer estimated row count:  0.00\u003cbr\\/\u003e\\n                                        optimizer estimated cost:            0.00\u003c\\/p\u003e\\n\\n\u003cp\u003e                                        Index Scan ResultSet for TABLE2 using index KEY3 at read committed isolation level using share row locking chosen by the\u003cbr\\/\u003e\\n optimizer\u003cbr\\/\u003e\\n                                        Number of opens = 3\u003cbr\\/\u003e\\n                                        Rows seen = 8688\u003cbr\\/\u003e\\n                                        Rows filtered = 0\u003cbr\\/\u003e\\n                                        Fetch Size = 1\u003cbr\\/\u003e\\n                                                constructor time (milliseconds)= 0\u003cbr\\/\u003e\\n                                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time in milliseconds\\/row =0\u003c\\/p\u003e\\n\\n\u003cp\u003e                                        scan information:\u003cbr\\/\u003e\\n                                                Bit set of columns fetched=\u003c\\/p\u003e\\n{1}\\n\u003cp\u003e                                                Number of columns fetched=1\u003cbr\\/\u003e\\n                                                Number of deleted rows visited=0\u003c\\/p\u003e\\n\\n\u003cp\u003e                                                Number of pages visited=12\u003cbr\\/\u003e\\n                                                Number of rows qualified=8688\u003cbr\\/\u003e\\n                                                Number of rows visited=8688\u003cbr\\/\u003e\\n                                                Scan type=btree\u003cbr\\/\u003e\\n                                                Tree height=2\u003cbr\\/\u003e\\n                                                start position:        None\u003cbr\\/\u003e\\n                                                stop position:        None\u003cbr\\/\u003e\\n                                                qualifiers:None\u003cbr\\/\u003e\\n                                                optimizer estimated row count:          0.00\u003cbr\\/\u003e\\n                                                optimizer estimated cost:     0.00\u003c\\/p\u003e\\n\\n\\n\\n\u003cp\u003e        Right result set:\u003cbr\\/\u003e\\n                Table Scan ResultSet for TABLE1 at read committed isolation level using instantaneous share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                Number of opens = 168\u003cbr\\/\u003e\\n                Rows seen = 3\u003cbr\\/\u003e\\n                Rows filtered = 0\u003cbr\\/\u003e\\n                Fetch Size = 16\u003cbr\\/\u003e\\n                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time in milliseconds\\/row = 0\u003c\\/p\u003e\\n\\n\u003cp\u003e                scan information:\u003cbr\\/\u003e\\n                        Bit set of columns fetched=All\u003cbr\\/\u003e\\n                        Number of columns fetched=1\u003cbr\\/\u003e\\n                        Number of pages visited=1\u003cbr\\/\u003e\\n                        Number of rows qualified=3\u003cbr\\/\u003e\\n                        Number of rows visited=9408\u003cbr\\/\u003e\\n                        Scan type=heap\u003cbr\\/\u003e\\n                        start position:\u003cbr\\/\u003e\\nnull                    stop position:\u003cbr\\/\u003e\\nnull                    qualifiers:\u003cbr\\/\u003e\\nColumn\u003cspan class=\\\"error\\\"\u003e&#91;0&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;0&#93;\u003c\\/span\u003e Id: 0\u003cbr\\/\u003e\\nOperator: =\u003cbr\\/\u003e\\nOrdered nulls: false\u003cbr\\/\u003e\\nUnknown return value: false\u003cbr\\/\u003e\\nNegate comparison result: false\u003cbr\\/\u003e\\nColumn\u003cspan class=\\\"error\\\"\u003e&#91;0&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e Id: 0\u003cbr\\/\u003e\\nOperator: =\u003cbr\\/\u003e\\nOrdered nulls: false\u003cbr\\/\u003e\\nUnknown return value: false\u003cbr\\/\u003e\\nNegate comparison result: false\u003c\\/p\u003e\\n\\n\u003cp\u003e                        optimizer estimated row count:            0.00\u003cbr\\/\u003e\\n                        optimizer estimated cost:            0.00\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12683990_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12683990_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T19:00:48+0000\'\u003e20\\/Mar\\/09 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The query plan when the incorrect results are returned is as follows \\nStatement Name: \\n        null \\nStatement Text: \\n        SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 W \\nHERE table1.id=m0.id AND \\nm0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m \\n1.value=\'21857\' ORDER BY \\nm0.value \\nParse Time: 0 \\nBind Time: 0 \\nOptimize Time: 0 \\nGenerate Time: 0 \\nCompile Time: 0 \\nExecute Time: 0 \\nBegin Compilation Timestamp : null \\nEnd Compilation Timestamp : null \\nBegin Execution Timestamp : null \\nEnd Execution Timestamp : null \\nStatement Execution Plan Text: \\nProject-Restrict ResultSet (10): \\nNumber of opens = 1 \\nRows seen = 3 \\nRows filtered = 0 \\nrestriction = false \\nprojection = true \\n        constructor time (milliseconds) = 0 \\n        open time (milliseconds) = 0 \\n        next time (milliseconds) = 0 \\n        close time (milliseconds) = 0 \\n        restriction time (milliseconds) = 0 \\n        projection time (milliseconds) = 0 \\n        optimizer estimated row count:            0.00 \\n        optimizer estimated cost:            3.52 \\n\\n Source result set: \\n        Nested Loop Join ResultSet: \\n        Number of opens = 1 \\n        Rows seen from the left = 168 \\n        Rows seen from the right = 3 \\n        Rows filtered = 0 \\n        Rows returned = 3 \\n                constructor time (milliseconds) = 0 \\n                open time (milliseconds) = 0 \\n                next time (milliseconds) = 0 \\n                close time (milliseconds) = 0 \\n                optimizer estimated row count:            0.00 \\n                optimizer estimated cost:            3.52 \\n\\n         Left result set: \\n                Nested Loop Join ResultSet: \\n                Number of opens = 1 \\n                Rows seen from the left = 3 \\n                Rows seen from the right = 168 \\n                Rows filtered = 0 \\n                Rows returned = 168 \\n                        constructor time (milliseconds) = 0 \\n                        open time (milliseconds) = 0 \\n                        next time (milliseconds) = 0 \\n                        close time (milliseconds) = 0 \\n                        optimizer estimated row count:            0.00 \\n                        optimizer estimated cost:            3.52 \\n\\n                 Left result set: \\n                        Project-Restrict ResultSet (5): \\n                        Number of opens = 1 \\n                        Rows seen = 3 \\n                        Rows filtered = 0 \\n                        restriction = true \\n                        projection = true \\n                                constructor time (milliseconds) = 0 \\n                                open time (milliseconds) = 0 \\n                                next time (milliseconds) = 0 \\n                                close time (milliseconds) = 0 \\n                                restriction time (milliseconds) = 0 \\n                                projection time (milliseconds) = 0 \\n                                optimizer estimated row count:            0.00 \\n                                optimizer estimated cost:            3.52 \\n\\n                         Source result set: \\n                                Index Row to Base Row ResultSet for TABLE2: \\n                                Number of opens = 1 \\n                                Rows seen = 3 \\n                                Columns accessed from heap =  \\n{0, 1, 2} \\n                                        constructor time (milliseconds) = 0 \\n                                        open time (milliseconds) = 0 \\n                                        next time (milliseconds) = 0 \\n                                        close time (milliseconds) = 0 \\n                                        optimizer estimated row count:  0.00 \\n                                        optimizer estimated cost:            3.52 \\n                                        Index Scan ResultSet for TABLE2 using index KEY3 at read committed isolation level using share row locking chosen by the optimizer \\n                                        Number of opens = 1 \\n                                        Rows seen = 3 \\n                                        Rows filtered = 0 \\n                                        Fetch Size = 1 \\n                                                constructor time (milliseconds)= 0 \\n                                                open time (milliseconds) = 0 \\n                                                next time (milliseconds) = 0 \\n                                                close time (milliseconds) = 0 \\n                                                next time in milliseconds\\/row =0 \\n                                        scan information: \\n                                                Bit set of columns fetched=All \\n                                                Number of columns fetched=2 \\n                                                Number of deleted rows visited=0 \\n \\n                                                Number of pages visited=2 \\n                                                Number of rows qualified=3 \\n                                                Number of rows visited=4 \\n                                                Scan type=btree \\n                                                Tree height=-1 \\n                                                start position: \\n        &gt;= on first 1 column(s). \\n        Ordered null semantics on the following columns: \\n \\n                                                stop position: \\n        &gt; on first 1 column(s). \\n        Ordered null semantics on the following columns: \\n \\n                                                qualifiers:None \\n                                                optimizer estimated row count:        0.00 \\n                                                optimizer estimated cost:     3.52 \\n \\n \\n                Right result set: \\n                        Project-Restrict ResultSet (8): \\n                        Number of opens = 3 \\n                        Rows seen = 8688 \\n                        Rows filtered = 8520 \\n                        restriction = true \\n                        projection = true \\n                                constructor time (milliseconds) = 0 \\n                                open time (milliseconds) = 0 \\n                                next time (milliseconds) = 0 \\n                                close time (milliseconds) = 0 \\n                                restriction time (milliseconds) = 0 \\n                                projection time (milliseconds) = 0 \\n                                optimizer estimated row count:            0.00 \\n                                optimizer estimated cost:            0.00 \\n \\n                        Source result set: \\n                                Index Row to Base Row ResultSet for TABLE2: \\n                                Number of opens = 3 \\n                                Rows seen = 8688 \\n                                Columns accessed from heap = {0, 1, 2}\\n                                         constructor time (milliseconds) = 0 \\n                                        open time (milliseconds) = 0 \\n                                        next time (milliseconds) = 0 \\n                                        close time (milliseconds) = 0 \\n                                        optimizer estimated row count:  0.00 \\n                                        optimizer estimated cost:            0.00 \\n\\n                                         Index Scan ResultSet for TABLE2 using index KEY3 at read committed isolation level using share row locking chosen by the \\n optimizer \\n                                        Number of opens = 3 \\n                                        Rows seen = 8688 \\n                                        Rows filtered = 0 \\n                                        Fetch Size = 1 \\n                                                constructor time (milliseconds)= 0 \\n                                                open time (milliseconds) = 0 \\n                                                next time (milliseconds) = 0 \\n                                                close time (milliseconds) = 0 \\n                                                next time in milliseconds\\/row =0 \\n\\n                                         scan information: \\n                                                Bit set of columns fetched= \\n{1}\\n                                                 Number of columns fetched=1 \\n                                                Number of deleted rows visited=0 \\n\\n                                                 Number of pages visited=12 \\n                                                Number of rows qualified=8688 \\n                                                Number of rows visited=8688 \\n                                                Scan type=btree \\n                                                Tree height=2 \\n                                                start position:        None \\n                                                stop position:        None \\n                                                qualifiers:None \\n                                                optimizer estimated row count:          0.00 \\n                                                optimizer estimated cost:     0.00 \\n\\n\\n\\n         Right result set: \\n                Table Scan ResultSet for TABLE1 at read committed isolation level using instantaneous share row locking chosen by the optimizer \\n                Number of opens = 168 \\n                Rows seen = 3 \\n                Rows filtered = 0 \\n                Fetch Size = 16 \\n                        constructor time (milliseconds) = 0 \\n                        open time (milliseconds) = 0 \\n                        next time (milliseconds) = 0 \\n                        close time (milliseconds) = 0 \\n                        next time in milliseconds\\/row = 0 \\n\\n                 scan information: \\n                        Bit set of columns fetched=All \\n                        Number of columns fetched=1 \\n                        Number of pages visited=1 \\n                        Number of rows qualified=3 \\n                        Number of rows visited=9408 \\n                        Scan type=heap \\n                        start position: \\nnull                    stop position: \\nnull                    qualifiers: \\nColumn &#91;0&#93;  &#91;0&#93;  Id: 0 \\nOperator: = \\nOrdered nulls: false \\nUnknown return value: false \\nNegate comparison result: false \\nColumn &#91;0&#93;  &#91;1&#93;  Id: 0 \\nOperator: = \\nOrdered nulls: false \\nUnknown return value: false \\nNegate comparison result: false \\n\\n                         optimizer estimated row count:            0.00 \\n                        optimizer estimated cost:            0.00              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12683992\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12683992&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12683992\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12683992_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12683992_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T19:03:27+0000\'\u003e20\\/Mar\\/09 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe query plan when the correct results are returned is as follows\u003cbr\\/\u003e\\nStatement Name:\u003cbr\\/\u003e\\n        null\u003cbr\\/\u003e\\nStatement Text:\u003cbr\\/\u003e\\n        SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 W\u003cbr\\/\u003e\\nHERE table1.id=m0.id AND\u003cbr\\/\u003e\\nm0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m\u003cbr\\/\u003e\\n1.value=\'21857\' ORDER BY\u003cbr\\/\u003e\\nm0.value\u003cbr\\/\u003e\\nParse Time: 0\u003cbr\\/\u003e\\nBind Time: 0\u003cbr\\/\u003e\\nOptimize Time: 0\u003cbr\\/\u003e\\nGenerate Time: 0\u003cbr\\/\u003e\\nCompile Time: 0\u003cbr\\/\u003e\\nExecute Time: 0\u003cbr\\/\u003e\\nBegin Compilation Timestamp : null\u003cbr\\/\u003e\\nEnd Compilation Timestamp : null\u003cbr\\/\u003e\\nBegin Execution Timestamp : null\u003cbr\\/\u003e\\nEnd Execution Timestamp : null\u003cbr\\/\u003e\\nStatement Execution Plan Text:\u003cbr\\/\u003e\\nSort ResultSet:\u003cbr\\/\u003e\\nNumber of opens = 1\u003cbr\\/\u003e\\nRows input = 3\u003cbr\\/\u003e\\nRows returned = 3\u003cbr\\/\u003e\\nEliminate duplicates = false\u003cbr\\/\u003e\\nIn sorted order = false\u003cbr\\/\u003e\\nSort information:\u003cbr\\/\u003e\\n        Number of rows input=3\u003cbr\\/\u003e\\n        Number of rows output=3\u003cbr\\/\u003e\\n        Sort type=internal\u003cbr\\/\u003e\\n        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n        open time (milliseconds) = 0\u003cbr\\/\u003e\\n        next time (milliseconds) = 0\u003cbr\\/\u003e\\n        close time (milliseconds) = 0\u003cbr\\/\u003e\\n        optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n        optimizer estimated cost:            8.26\u003c\\/p\u003e\\n\\n\u003cp\u003eSource result set:\u003cbr\\/\u003e\\n        Project-Restrict ResultSet (9):\u003cbr\\/\u003e\\n        Number of opens = 1\u003cbr\\/\u003e\\n        Rows seen = 3\u003cbr\\/\u003e\\n        Rows filtered = 0\u003cbr\\/\u003e\\n        restriction = false\u003cbr\\/\u003e\\n        projection = true\u003cbr\\/\u003e\\n                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                restriction time (milliseconds) = 0\u003cbr\\/\u003e\\n                projection time (milliseconds) = 0\u003cbr\\/\u003e\\n                optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                optimizer estimated cost:            8.26\u003c\\/p\u003e\\n\\n\u003cp\u003e        Source result set:\u003cbr\\/\u003e\\n                Nested Loop Exists Join ResultSet:\u003cbr\\/\u003e\\n                Number of opens = 1\u003cbr\\/\u003e\\n                Rows seen from the left = 3\u003cbr\\/\u003e\\n                Rows seen from the right = 3\u003cbr\\/\u003e\\n                Rows filtered = 0\u003cbr\\/\u003e\\n                Rows returned = 3\u003cbr\\/\u003e\\n                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                        optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                        optimizer estimated cost:            8.26\u003c\\/p\u003e\\n\\n\u003cp\u003e                Left result set:\u003cbr\\/\u003e\\n                        Nested Loop Exists Join ResultSet:\u003cbr\\/\u003e\\n                        Number of opens = 1\u003cbr\\/\u003e\\n                        Rows seen from the left = 3\u003cbr\\/\u003e\\n                        Rows seen from the right = 3\u003cbr\\/\u003e\\n                        Rows filtered = 0\u003cbr\\/\u003e\\n                        Rows returned = 3\u003cbr\\/\u003e\\n                                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                                optimizer estimated cost:            7.29\u003c\\/p\u003e\\n\\n\u003cp\u003e                        Left result set:\u003cbr\\/\u003e\\n                                Project-Restrict ResultSet (5):\u003cbr\\/\u003e\\n                                Number of opens = 1\u003cbr\\/\u003e\\n                                Rows seen = 3\u003cbr\\/\u003e\\n                                Rows filtered = 0\u003cbr\\/\u003e\\n                                restriction = true\u003cbr\\/\u003e\\n                                projection = true\u003cbr\\/\u003e\\n                                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        restriction time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        projection time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        optimizer estimated row count:\u003cbr\\/\u003e\\n  0.20\u003cbr\\/\u003e\\n                                        optimizer estimated cost:            6.9\u003cbr\\/\u003e\\n7\u003c\\/p\u003e\\n\\n\u003cp\u003e                                Source result set:\u003cbr\\/\u003e\\n                                        Index Row to Base Row ResultSet for TABL\u003cbr\\/\u003e\\nE2:\u003cbr\\/\u003e\\n                                        Number of opens = 1\u003cbr\\/\u003e\\n                                        Rows seen = 3\u003cbr\\/\u003e\\n                                        Columns accessed from heap = \u003c\\/p\u003e\\n{0, 1, 2}\\n\u003cp\u003e                                                constructor time (milliseconds)\u003cbr\\/\u003e\\n= 0\u003cbr\\/\u003e\\n                                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                optimizer estimated row count:\u003cbr\\/\u003e\\n          0.20\u003cbr\\/\u003e\\n                                                optimizer estimated cost:\u003cbr\\/\u003e\\n     6.97\u003c\\/p\u003e\\n\\n\u003cp\u003e                                                Index Scan ResultSet for TABLE2using index KEY3 at read committed isolation level using instantaneous share row\u003cbr\\/\u003e\\n locking chosen by the optimizer\u003cbr\\/\u003e\\n                                                Number of opens = 1\u003cbr\\/\u003e\\n                                                Rows seen = 3\u003cbr\\/\u003e\\n                                                Rows filtered = 0\u003cbr\\/\u003e\\n                                                Fetch Size = 16\u003cbr\\/\u003e\\n                                                        constructor time (millis\u003cbr\\/\u003e\\neconds) = 0\u003cbr\\/\u003e\\n                                                        open time (milliseconds)\u003cbr\\/\u003e\\n = 0\u003cbr\\/\u003e\\n                                                        next time (milliseconds)\u003cbr\\/\u003e\\n = 0\u003cbr\\/\u003e\\n                                                        close time (milliseconds\u003cbr\\/\u003e\\n) = 0\u003cbr\\/\u003e\\n                                                        next time in millisecond\u003cbr\\/\u003e\\ns\\/row = 0\u003c\\/p\u003e\\n\\n\u003cp\u003e                                                scan information:\u003cbr\\/\u003e\\n                                                        Bit set of columns fetch\u003cbr\\/\u003e\\ned=All\u003cbr\\/\u003e\\n                                                        Number of columns fetche\u003cbr\\/\u003e\\nd=2\u003cbr\\/\u003e\\n                                                        Number of deleted rows v\u003cbr\\/\u003e\\nisited=0\u003cbr\\/\u003e\\n                                                        Number of pages visited=\u003cbr\\/\u003e\\n2\u003cbr\\/\u003e\\n                                                        Number of rows qualified\u003cbr\\/\u003e\\n=3\u003cbr\\/\u003e\\n                                                        Number of rows visited=4\u003c\\/p\u003e\\n\\n\u003cp\u003e                                                        Scan type=btree\u003cbr\\/\u003e\\n                                                        Tree height=2\u003cbr\\/\u003e\\n                                                        start position:\u003cbr\\/\u003e\\n        &gt;= on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:\u003c\\/p\u003e\\n\\n\u003cp\u003e                                                        stop position:\u003cbr\\/\u003e\\n        &gt; on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:\u003c\\/p\u003e\\n\\n\u003cp\u003e                                                        qualifiers:\u003cbr\\/\u003e\\nNone\u003cbr\\/\u003e\\n                                                        optimizer estimated row\u003cbr\\/\u003e\\ncount:            0.20\u003cbr\\/\u003e\\n                                                        optimizer estimated cost\u003cbr\\/\u003e\\n:            6.97\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e                        Right result set:\u003cbr\\/\u003e\\n                                Index Scan ResultSet for TABLE1 using constraint SQL090320113016460 at read committed isolation level using share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                                Number of opens = 3\u003cbr\\/\u003e\\n                                Rows seen = 3\u003cbr\\/\u003e\\n                                Rows filtered = 0\u003cbr\\/\u003e\\n                                Fetch Size = 1\u003cbr\\/\u003e\\n                                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time in milliseconds\\/row = 0\u003c\\/p\u003e\\n\\n\u003cp\u003e                                scan information:\u003cbr\\/\u003e\\n                                        Bit set of columns fetched=\u003c\\/p\u003e\\n{0}\\n\u003cp\u003e                                        Number of columns fetched=1\u003cbr\\/\u003e\\n                                        Number of deleted rows visited=0\u003cbr\\/\u003e\\n                                        Number of pages visited=3\u003cbr\\/\u003e\\n                                        Number of rows qualified=3\u003cbr\\/\u003e\\n                                        Number of rows visited=3\u003cbr\\/\u003e\\n                                        Scan type=btree\u003cbr\\/\u003e\\n                                        Tree height=1\u003cbr\\/\u003e\\n                                        start position:\u003cbr\\/\u003e\\n        &gt;= on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:\u003cbr\\/\u003e\\n0\u003cbr\\/\u003e\\n                                        stop position:\u003cbr\\/\u003e\\n        &gt; on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:\u003cbr\\/\u003e\\n0\u003cbr\\/\u003e\\n                                        qualifiers:\u003cbr\\/\u003e\\nNone\u003cbr\\/\u003e\\n                                        optimizer estimated row count:\u003cbr\\/\u003e\\n  0.20\u003cbr\\/\u003e\\n                                        optimizer estimated cost:            0.31\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e                Right result set:\u003cbr\\/\u003e\\n                        Index Row to Base Row ResultSet for TABLE2:\u003cbr\\/\u003e\\n                        Number of opens = 3\u003cbr\\/\u003e\\n                        Rows seen = 3\u003cbr\\/\u003e\\n                        Columns accessed from heap = \u003c\\/p\u003e\\n{2}\\n\u003cp\u003e                                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                                optimizer estimated cost:            0.97\u003c\\/p\u003e\\n\\n\u003cp\u003e                                Index Scan ResultSet for TABLE2 using constraint SQL090320113016670 at read committed isolation level using share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                                Number of opens = 3\u003cbr\\/\u003e\\n                                Rows seen = 3\u003cbr\\/\u003e\\n                                Rows filtered = 0\u003cbr\\/\u003e\\n                                Fetch Size = 1\u003cbr\\/\u003e\\n                                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time in milliseconds\\/row = 0\u003c\\/p\u003e\\n\\n\u003cp\u003e                                scan information:\u003cbr\\/\u003e\\n                                        Bit set of columns fetched=All\u003cbr\\/\u003e\\n                                        Number of columns fetched=3\u003cbr\\/\u003e\\n                                        Number of deleted rows visited=0\u003cbr\\/\u003e\\n                                        Number of pages visited=6\u003cbr\\/\u003e\\n                                        Number of rows qualified=3\u003cbr\\/\u003e\\n                                        Number of rows visited=3\u003cbr\\/\u003e\\n                                        Scan type=btree\u003cbr\\/\u003e\\n                                        Tree height=2\u003cbr\\/\u003e\\n                                        start position:\u003cbr\\/\u003e\\n        &gt;= on first 2 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:0 1\u003cbr\\/\u003e\\n                                        stop position:\u003cbr\\/\u003e\\n        &gt; on first 2 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:0 1\u003cbr\\/\u003e\\n                                        qualifiers:None\u003cbr\\/\u003e\\n                                        optimizer estimated row count:  0.20\u003cbr\\/\u003e\\n                                        optimizer estimated cost:            0.97\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12683992_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12683992_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T19:03:27+0000\'\u003e20\\/Mar\\/09 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The query plan when the correct results are returned is as follows \\nStatement Name: \\n        null \\nStatement Text: \\n        SELECT table1.id, m0.value, m1.value FROM table1, table2 m0, table2 m1 W \\nHERE table1.id=m0.id AND \\nm0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m \\n1.value=\'21857\' ORDER BY \\nm0.value \\nParse Time: 0 \\nBind Time: 0 \\nOptimize Time: 0 \\nGenerate Time: 0 \\nCompile Time: 0 \\nExecute Time: 0 \\nBegin Compilation Timestamp : null \\nEnd Compilation Timestamp : null \\nBegin Execution Timestamp : null \\nEnd Execution Timestamp : null \\nStatement Execution Plan Text: \\nSort ResultSet: \\nNumber of opens = 1 \\nRows input = 3 \\nRows returned = 3 \\nEliminate duplicates = false \\nIn sorted order = false \\nSort information: \\n        Number of rows input=3 \\n        Number of rows output=3 \\n        Sort type=internal \\n        constructor time (milliseconds) = 0 \\n        open time (milliseconds) = 0 \\n        next time (milliseconds) = 0 \\n        close time (milliseconds) = 0 \\n        optimizer estimated row count:            0.20 \\n        optimizer estimated cost:            8.26 \\n\\n Source result set: \\n        Project-Restrict ResultSet (9): \\n        Number of opens = 1 \\n        Rows seen = 3 \\n        Rows filtered = 0 \\n        restriction = false \\n        projection = true \\n                constructor time (milliseconds) = 0 \\n                open time (milliseconds) = 0 \\n                next time (milliseconds) = 0 \\n                close time (milliseconds) = 0 \\n                restriction time (milliseconds) = 0 \\n                projection time (milliseconds) = 0 \\n                optimizer estimated row count:            0.20 \\n                optimizer estimated cost:            8.26 \\n\\n         Source result set: \\n                Nested Loop Exists Join ResultSet: \\n                Number of opens = 1 \\n                Rows seen from the left = 3 \\n                Rows seen from the right = 3 \\n                Rows filtered = 0 \\n                Rows returned = 3 \\n                        constructor time (milliseconds) = 0 \\n                        open time (milliseconds) = 0 \\n                        next time (milliseconds) = 0 \\n                        close time (milliseconds) = 0 \\n                        optimizer estimated row count:            0.20 \\n                        optimizer estimated cost:            8.26 \\n\\n                 Left result set: \\n                        Nested Loop Exists Join ResultSet: \\n                        Number of opens = 1 \\n                        Rows seen from the left = 3 \\n                        Rows seen from the right = 3 \\n                        Rows filtered = 0 \\n                        Rows returned = 3 \\n                                constructor time (milliseconds) = 0 \\n                                open time (milliseconds) = 0 \\n                                next time (milliseconds) = 0 \\n                                close time (milliseconds) = 0 \\n                                optimizer estimated row count:            0.20 \\n                                optimizer estimated cost:            7.29 \\n\\n                         Left result set: \\n                                Project-Restrict ResultSet (5): \\n                                Number of opens = 1 \\n                                Rows seen = 3 \\n                                Rows filtered = 0 \\n                                restriction = true \\n                                projection = true \\n                                        constructor time (milliseconds) = 0 \\n                                        open time (milliseconds) = 0 \\n                                        next time (milliseconds) = 0 \\n                                        close time (milliseconds) = 0 \\n                                        restriction time (milliseconds) = 0 \\n                                        projection time (milliseconds) = 0 \\n                                        optimizer estimated row count: \\n  0.20 \\n                                        optimizer estimated cost:            6.9 \\n7 \\n\\n                                 Source result set: \\n                                        Index Row to Base Row ResultSet for TABL \\nE2: \\n                                        Number of opens = 1 \\n                                        Rows seen = 3 \\n                                        Columns accessed from heap =  \\n{0, 1, 2}\\n                                                 constructor time (milliseconds) \\n= 0 \\n                                                open time (milliseconds) = 0 \\n                                                next time (milliseconds) = 0 \\n                                                close time (milliseconds) = 0 \\n                                                optimizer estimated row count: \\n          0.20 \\n                                                optimizer estimated cost: \\n     6.97 \\n\\n                                                 Index Scan ResultSet for TABLE2using index KEY3 at read committed isolation level using instantaneous share row \\n locking chosen by the optimizer \\n                                                Number of opens = 1 \\n                                                Rows seen = 3 \\n                                                Rows filtered = 0 \\n                                                Fetch Size = 16 \\n                                                        constructor time (millis \\neconds) = 0 \\n                                                        open time (milliseconds) \\n = 0 \\n                                                        next time (milliseconds) \\n = 0 \\n                                                        close time (milliseconds \\n) = 0 \\n                                                        next time in millisecond \\ns\\/row = 0 \\n\\n                                                 scan information: \\n                                                        Bit set of columns fetch \\ned=All \\n                                                        Number of columns fetche \\nd=2 \\n                                                        Number of deleted rows v \\nisited=0 \\n                                                        Number of pages visited= \\n2 \\n                                                        Number of rows qualified \\n=3 \\n                                                        Number of rows visited=4 \\n\\n                                                         Scan type=btree \\n                                                        Tree height=2 \\n                                                        start position: \\n        &gt;= on first 1 column(s). \\n        Ordered null semantics on the following columns: \\n\\n                                                         stop position: \\n        &gt; on first 1 column(s). \\n        Ordered null semantics on the following columns: \\n\\n                                                         qualifiers: \\nNone \\n                                                        optimizer estimated row \\ncount:            0.20 \\n                                                        optimizer estimated cost \\n:            6.97 \\n\\n\\n                         Right result set: \\n                                Index Scan ResultSet for TABLE1 using constraint SQL090320113016460 at read committed isolation level using share row locking chosen by the optimizer \\n                                Number of opens = 3 \\n                                Rows seen = 3 \\n                                Rows filtered = 0 \\n                                Fetch Size = 1 \\n                                        constructor time (milliseconds) = 0 \\n                                        open time (milliseconds) = 0 \\n                                        next time (milliseconds) = 0 \\n                                        close time (milliseconds) = 0 \\n                                        next time in milliseconds\\/row = 0 \\n\\n                                 scan information: \\n                                        Bit set of columns fetched= \\n{0}\\n                                         Number of columns fetched=1 \\n                                        Number of deleted rows visited=0 \\n                                        Number of pages visited=3 \\n                                        Number of rows qualified=3 \\n                                        Number of rows visited=3 \\n                                        Scan type=btree \\n                                        Tree height=1 \\n                                        start position: \\n        &gt;= on first 1 column(s). \\n        Ordered null semantics on the following columns: \\n0 \\n                                        stop position: \\n        &gt; on first 1 column(s). \\n        Ordered null semantics on the following columns: \\n0 \\n                                        qualifiers: \\nNone \\n                                        optimizer estimated row count: \\n  0.20 \\n                                        optimizer estimated cost:            0.31 \\n\\n\\n                 Right result set: \\n                        Index Row to Base Row ResultSet for TABLE2: \\n                        Number of opens = 3 \\n                        Rows seen = 3 \\n                        Columns accessed from heap =  \\n{2}\\n                                 constructor time (milliseconds) = 0 \\n                                open time (milliseconds) = 0 \\n                                next time (milliseconds) = 0 \\n                                close time (milliseconds) = 0 \\n                                optimizer estimated row count:            0.20 \\n                                optimizer estimated cost:            0.97 \\n\\n                                 Index Scan ResultSet for TABLE2 using constraint SQL090320113016670 at read committed isolation level using share row locking chosen by the optimizer \\n                                Number of opens = 3 \\n                                Rows seen = 3 \\n                                Rows filtered = 0 \\n                                Fetch Size = 1 \\n                                        constructor time (milliseconds) = 0 \\n                                        open time (milliseconds) = 0 \\n                                        next time (milliseconds) = 0 \\n                                        close time (milliseconds) = 0 \\n                                        next time in milliseconds\\/row = 0 \\n\\n                                 scan information: \\n                                        Bit set of columns fetched=All \\n                                        Number of columns fetched=3 \\n                                        Number of deleted rows visited=0 \\n                                        Number of pages visited=6 \\n                                        Number of rows qualified=3 \\n                                        Number of rows visited=3 \\n                                        Scan type=btree \\n                                        Tree height=2 \\n                                        start position: \\n        &gt;= on first 2 column(s). \\n        Ordered null semantics on the following columns:0 1 \\n                                        stop position: \\n        &gt; on first 2 column(s). \\n        Ordered null semantics on the following columns:0 1 \\n                                        qualifiers:None \\n                                        optimizer estimated row count:  0.20 \\n                                        optimizer estimated cost:            0.97              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12684012\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12684012&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12684012\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12684012_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12684012_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 19:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T19:55:52+0000\'\u003e20\\/Mar\\/09 19:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eto me looks like the problem comes with plan that is trying to do sort avoidance.  The working plan has a sort node on the top.  \u003c\\/p\u003e\\n\\n\u003cp\u003eBut to me the \\\"bad\\\" plan looks like a valid sort avoidance plan.  Seems to have index scans on the left side, using key3 which is sorted on the value that the query in the end wants to be sorted on.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12684012_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12684012_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 19:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T19:55:52+0000\'\u003e20\\/Mar\\/09 19:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    to me looks like the problem comes with plan that is trying to do sort avoidance.  The working plan has a sort node on the top.   \\n\\n But to me the \\\"bad\\\" plan looks like a valid sort avoidance plan.  Seems to have index scans on the left side, using key3 which is sorted on the value that the query in the end wants to be sorted on.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12684021\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12684021&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12684021\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12684021_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12684021_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 20:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T20:51:15+0000\'\u003e20\\/Mar\\/09 20:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ecould it be that the leftmost join is actually on the m1.value part of the query rather than the m0.value of the query.  maybe something got confused about the self join with 2 different \\\"range\\\" variables.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12684021_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12684021_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 20:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T20:51:15+0000\'\u003e20\\/Mar\\/09 20:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    could it be that the leftmost join is actually on the m1.value part of the query rather than the m0.value of the query.  maybe something got confused about the self join with 2 different \\\"range\\\" variables.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12685364\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12685364&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12685364\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12685364_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12685364_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 21:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T21:17:53+0000\'\u003e20\\/Mar\\/09 21:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOnce \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4105\\\" title=\\\"NPE when the attached reproducible script is run using ij.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4105\\\"\u003e\u003cdel\u003eDERBY-4105\u003c\\/del\u003e\u003c\\/a\u003e is fixed, make sure that whatever fix is checked in for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3926\\\" title=\\\"Incorrect ORDER BY caused by index\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3926\\\"\u003e\u003cdel\u003eDERBY-3926\u003c\\/del\u003e\u003c\\/a\u003e works in 10.1 release too.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12685364_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12685364_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 21:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T21:17:53+0000\'\u003e20\\/Mar\\/09 21:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Once   DERBY-4105   is fixed, make sure that whatever fix is checked in for   DERBY-3926   works in 10.1 release too.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12685372\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12685372&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12685372\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12685372_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12685372_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 21:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T21:54:35+0000\'\u003e20\\/Mar\\/09 21:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI noticed that this issue also occurs on versions back to 10.1\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12685372_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12685372_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/09 21:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-20T21:54:35+0000\'\u003e20\\/Mar\\/09 21:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I noticed that this issue also occurs on versions back to 10.1              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12688322\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12688322&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12688322\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12688322_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12688322_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/09 16:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-23T16:49:48+0000\'\u003e23\\/Mar\\/09 16:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy apologies for false alarm on 10.1 codeline. I noticed that I had some local changes made on that client. Once i reverted them, the npe went away. I will mark the new jira entry  \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4015\\\" title=\\\"Regression in Statement.getGeneratedKeys()\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4015\\\"\u003eDERBY-4015\u003c\\/a\u003e for npe as not a bug.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12688322_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12688322_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/09 16:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-23T16:49:48+0000\'\u003e23\\/Mar\\/09 16:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My apologies for false alarm on 10.1 codeline. I noticed that I had some local changes made on that client. Once i reverted them, the npe went away. I will mark the new jira entry   DERBY-4015  for npe as not a bug.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12688804\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12688804&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12688804\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12688804_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12688804_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Mar\\/09 19:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-24T19:15:32+0000\'\u003e24\\/Mar\\/09 19:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI will spend little time on this jira. As Mike pointed out, it is a possibilit that in the wrong result case, may be we are getting confused with m0 and m1 which basically are involved in a self join. \u003c\\/p\u003e\\n\\n\u003cp\u003eFor a given query, if the optimizer chooses a query plan with an index key for say a where clause and it finds that the same key can be used to satisfy the order by, then in that case, optimizer will avoid doing the sorting required for order by because the rows are already in order based on the index key used to satisfy where clause.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn this particular case, there is an index called key3 on table2.value which can be used to satisfy the m1.value=\'21857\'.  It is possible that may be there is some bug in optimizer which thinks that the index used for m1.value can be used to avoid the sorting required for m0.value. But the sort should not be avoided because the order by is on m0.value and not m1.value and hence index used for m1.value can\'t be used to avoid the sort on m0.value. I will debug this a little to see what is index key3 being used for ie m0 or m1. It is unclear from the query plan whether the index key3 is being used on m0 or m1.\u003c\\/p\u003e\\n\\n\u003cp\u003eSELECT table1.id, m0.value, m1.value \u003cbr\\/\u003e\\nFROM table1, table2 m0, table2 m1 \u003cbr\\/\u003e\\nWHERE table1.id=m0.id \u003cbr\\/\u003e\\nAND m0.name=\'PageSequenceId\' \u003cbr\\/\u003e\\nAND table1.id=m1.id \u003cbr\\/\u003e\\nAND m1.name=\'PostComponentId\' \u003cbr\\/\u003e\\nAND m1.value=\'21857\' \u003cbr\\/\u003e\\nORDER BY m0.value; \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12688804_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12688804_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Mar\\/09 19:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-24T19:15:32+0000\'\u003e24\\/Mar\\/09 19:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I will spend little time on this jira. As Mike pointed out, it is a possibilit that in the wrong result case, may be we are getting confused with m0 and m1 which basically are involved in a self join.  \\n\\n For a given query, if the optimizer chooses a query plan with an index key for say a where clause and it finds that the same key can be used to satisfy the order by, then in that case, optimizer will avoid doing the sorting required for order by because the rows are already in order based on the index key used to satisfy where clause. \\n\\n In this particular case, there is an index called key3 on table2.value which can be used to satisfy the m1.value=\'21857\'.  It is possible that may be there is some bug in optimizer which thinks that the index used for m1.value can be used to avoid the sorting required for m0.value. But the sort should not be avoided because the order by is on m0.value and not m1.value and hence index used for m1.value can\'t be used to avoid the sort on m0.value. I will debug this a little to see what is index key3 being used for ie m0 or m1. It is unclear from the query plan whether the index key3 is being used on m0 or m1. \\n\\n SELECT table1.id, m0.value, m1.value  \\nFROM table1, table2 m0, table2 m1  \\nWHERE table1.id=m0.id  \\nAND m0.name=\'PageSequenceId\'  \\nAND table1.id=m1.id  \\nAND m1.name=\'PostComponentId\'  \\nAND m1.value=\'21857\'  \\nORDER BY m0.value;               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12689785\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12689785&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12689785\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12689785_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12689785_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/09 02:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-27T02:39:21+0000\'\u003e27\\/Mar\\/09 02:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI debugged to see which table is picked as the leftmost table since it is unclear from the query plan what we mean when we say TABLE2 is the leftmost table. There is a self-join involved with TABLE2 and we use aliases m0 and m1 for them but in the query plan, we talk about them as just TABLE2 and not along  with their alias names. It appears that in both failing and passing case, m1 is the leftmost table in the query plan chosen for the queries. (I made one line change in my client to impl\\\\sql\\\\compile\\\\IndexToBaseRowNode.java where rather than just sending the table name, I send both table name and alias name to the query plan collection logic. The code change is shown below\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003emb.push(source.getBaseTableName());\u003cbr\\/\u003e\\n+               mb.push(source.getBaseTableName() + \\\" \\\" + source.getCorrelationName());\u003cbr\\/\u003e\\nWith the change above, I can see in the query plan for the failing and passing case that the leftmost resultset is for TABLE2 M1. I will go ahead and enter a jira entry to make query plan more readable by including the alias name along with the table name.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI will next look at why we decide to skip the sorting in the failing case. That seems to be the only difference between the 2 query plans.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12689785_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12689785_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/09 02:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-27T02:39:21+0000\'\u003e27\\/Mar\\/09 02:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I debugged to see which table is picked as the leftmost table since it is unclear from the query plan what we mean when we say TABLE2 is the leftmost table. There is a self-join involved with TABLE2 and we use aliases m0 and m1 for them but in the query plan, we talk about them as just TABLE2 and not along  with their alias names. It appears that in both failing and passing case, m1 is the leftmost table in the query plan chosen for the queries. (I made one line change in my client to impl\\\\sql\\\\compile\\\\IndexToBaseRowNode.java where rather than just sending the table name, I send both table name and alias name to the query plan collection logic. The code change is shown below \\n \\n\\t mb.push(source.getBaseTableName()); \\n+               mb.push(source.getBaseTableName() + \\\" \\\" + source.getCorrelationName()); \\nWith the change above, I can see in the query plan for the failing and passing case that the leftmost resultset is for TABLE2 M1. I will go ahead and enter a jira entry to make query plan more readable by including the alias name along with the table name. \\n \\n\\n\\n I will next look at why we decide to skip the sorting in the failing case. That seems to be the only difference between the 2 query plans.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12689790\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12689790&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12689790\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12689790_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12689790_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/09 02:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-27T02:50:02+0000\'\u003e27\\/Mar\\/09 02:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIncluding the alias name in the query plan output seems like a great idea. Thanks for tracking that down!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12689790_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12689790_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/09 02:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-27T02:50:02+0000\'\u003e27\\/Mar\\/09 02:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Including the alias name in the query plan output seems like a great idea. Thanks for tracking that down!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12689969\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12689969&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12689969\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12689969_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12689969_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/09 17:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-27T17:12:18+0000\'\u003e27\\/Mar\\/09 17:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Mamta thanks for all the hard work on this.\u003c\\/p\u003e\\n\\n\u003cp\u003eI just wanted to comment that I think your theory that \\\"may be there is some bug in optimizer \u003cbr\\/\u003e\\nwhich thinks that the index used for m1.value can be used to avoid the sorting required for m0.value\\\"\u003cbr\\/\u003e\\nis a really good theory, and I think this is a good idea to explore in depth.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12689969_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12689969_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/09 17:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-27T17:12:18+0000\'\u003e27\\/Mar\\/09 17:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Mamta thanks for all the hard work on this. \\n\\n I just wanted to comment that I think your theory that \\\"may be there is some bug in optimizer  \\nwhich thinks that the index used for m1.value can be used to avoid the sorting required for m0.value\\\" \\nis a really good theory, and I think this is a good idea to explore in depth.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12690020\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12690020&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12690020\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12690020_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12690020_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/09 19:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-27T19:44:28+0000\'\u003e27\\/Mar\\/09 19:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI also agree that including the alias name would be great.  Make sure to include a sample of what the query plan looks like after your change in the other jira.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also was guessing that the optimizer got confused by the two aliases on the same table.  It seems like you should find where in the optimizer we determine how the current query plan is sorted and we must compare that with how the query wants to be sorted to determine if the current plan is a valid \\\"sort avoidance\\\" plan.  My guess is that at this point we somehow pass in that the plan is sorted a table2.value but somewhere we are not recognizing that we need to \u003cbr\\/\u003e\\ncheck for m0.value.  but just a guess.  It could also be a bug where we are passing in the wrong alias to the check.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12690020_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12690020_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Mar\\/09 19:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-27T19:44:28+0000\'\u003e27\\/Mar\\/09 19:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I also agree that including the alias name would be great.  Make sure to include a sample of what the query plan looks like after your change in the other jira. \\n\\n I also was guessing that the optimizer got confused by the two aliases on the same table.  It seems like you should find where in the optimizer we determine how the current query plan is sorted and we must compare that with how the query wants to be sorted to determine if the current plan is a valid \\\"sort avoidance\\\" plan.  My guess is that at this point we somehow pass in that the plan is sorted a table2.value but somewhere we are not recognizing that we need to  \\ncheck for m0.value.  but just a guess.  It could also be a bug where we are passing in the wrong alias to the check.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12694206\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12694206&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12694206\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12694206_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12694206_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/09 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-31T18:40:02+0000\'\u003e31\\/Mar\\/09 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI spent some time in comparing the code path for the working case and non-working case in a debugger. What I found is in optimize phase, at one point, one of the join orders we try in non-working case is 2,0,1 and for the working case it is 2,0,-1. \u003cbr\\/\u003e\\n0 stands for Table1 and 1 stands for Table2 m0, 2 stands for Table2 m1. -1 means that join position is not being used. I am not sure why we are picking different join orders. In addition to that, I see that for the 2,0,1 join order in non-working case, we indeed mark sort avoidance for Table2 m0, I definitely need to do more debugging to see why we think for this join order, we can avoid sorting for Table2 m0. I realize this is not much information but wanted to share what I have. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12694206_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12694206_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/09 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-03-31T18:40:02+0000\'\u003e31\\/Mar\\/09 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I spent some time in comparing the code path for the working case and non-working case in a debugger. What I found is in optimize phase, at one point, one of the join orders we try in non-working case is 2,0,1 and for the working case it is 2,0,-1.  \\n0 stands for Table1 and 1 stands for Table2 m0, 2 stands for Table2 m1. -1 means that join position is not being used. I am not sure why we are picking different join orders. In addition to that, I see that for the 2,0,1 join order in non-working case, we indeed mark sort avoidance for Table2 m0, I definitely need to do more debugging to see why we think for this join order, we can avoid sorting for Table2 m0. I realize this is not much information but wanted to share what I have.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12695057\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12695057&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12695057\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12695057_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12695057_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Apr\\/09 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-02T16:55:03+0000\'\u003e02\\/Apr\\/09 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnother interesting thing I noticed (in both working and non-working case) is we do recognize the optimize phase that sorting is required for m0 for the order by clause as shown belowHere, for the join order \u003cspan class=\\\"error\\\"\u003e&#91;2, 0, 1&#93;\u003c\\/span\u003e, we identify that sorting is required for M0.\u003cbr\\/\u003e\\nThread \u003cspan class=\\\"error\\\"\u003e&#91;main&#93;\u003c\\/span\u003e (Suspended)\\t\u003cbr\\/\u003e\\n\\tOrderByList.sortRequired(RowOrdering, JBitSet) line: 549\\t\u003cbr\\/\u003e\\n\\tLevel2OptimizerImpl(OptimizerImpl).costBasedCostOptimizable(Optimizable, TableDescriptor, ConglomerateDescriptor, OptimizablePredicateList, CostEstimate) line: 2248\\t\u003cbr\\/\u003e\\n\\tLevel2OptimizerImpl(OptimizerImpl).costOptimizable(Optimizable, TableDescriptor, ConglomerateDescriptor, OptimizablePredicateList, CostEstimate) line: 1984\\t\u003cbr\\/\u003e\\n\\tFromBaseTable.optimizeIt(Optimizer, OptimizablePredicateList, CostEstimate, RowOrdering) line: 521\\t\u003cbr\\/\u003e\\n\\tProjectRestrictNode.optimizeIt(Optimizer, OptimizablePredicateList, CostEstimate, RowOrdering) line: 316\\t\u003cbr\\/\u003e\\n\\tLevel2OptimizerImpl(OptimizerImpl).costPermutation() line: 1938\\t\u003cbr\\/\u003e\\n\\tSelectNode.optimize(DataDictionary, PredicateList, double) line: 1767\\t\u003cbr\\/\u003e\\n\\tCursorNode(DMLStatementNode).optimizeStatement() line: 305\\t\u003cbr\\/\u003e\\n\\tCursorNode.optimizeStatement() line: 515\\t\u003cbr\\/\u003e\\n\\tGenericStatement.prepMinion(LanguageConnectionContext, boolean, Object[], SchemaDescriptor, boolean) line: 367\\t\u003cbr\\/\u003e\\n\\tGenericStatement.prepare(LanguageConnectionContext, boolean) line: 88\\t\u003cbr\\/\u003e\\n\\tGenericLanguageConnectionContext.prepareInternalStatement(SchemaDescriptor, String, boolean, boolean) line: 802\\t\u003cbr\\/\u003e\\n\\tEmbedStatement40(EmbedStatement).execute(String, boolean, boolean, int, int[], String[]) line: 606\\t\u003cbr\\/\u003e\\n\\tij.executeImmediate(String) line: 329\\t\u003cbr\\/\u003e\\n\\tutilMain.doCatch(String) line: 505\\t\u003cbr\\/\u003e\\n\\tutilMain.runScriptGuts() line: 347\\t\u003cbr\\/\u003e\\n\\tutilMain.go(LocalizedInput[], LocalizedOutput) line: 245\\t\u003cbr\\/\u003e\\n\\tMain.go(LocalizedInput, LocalizedOutput) line: 210\\t\u003cbr\\/\u003e\\n\\tMain.mainCore(String[], Main) line: 177\\t\u003cbr\\/\u003e\\n\\tMain.main(String[]) line: 73\\t\u003cbr\\/\u003e\\n\\tMain.main(String[]) line: 73\\t\u003cbr\\/\u003e\\n\\tij.main(String[]) line: 59\\t\u003cbr\\/\u003e\\nBut it is obvious from the query plan for non-working that somehow we later decide to do sort avoidance for m0. I will look more to see where the optimizer changes it mind about the sort requirement for m0.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12695057_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12695057_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Apr\\/09 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-02T16:55:03+0000\'\u003e02\\/Apr\\/09 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Another interesting thing I noticed (in both working and non-working case) is we do recognize the optimize phase that sorting is required for m0 for the order by clause as shown belowHere, for the join order  &#91;2, 0, 1&#93; , we identify that sorting is required for M0. \\nThread  &#91;main&#93;  (Suspended)\\t \\n\\tOrderByList.sortRequired(RowOrdering, JBitSet) line: 549\\t \\n\\tLevel2OptimizerImpl(OptimizerImpl).costBasedCostOptimizable(Optimizable, TableDescriptor, ConglomerateDescriptor, OptimizablePredicateList, CostEstimate) line: 2248\\t \\n\\tLevel2OptimizerImpl(OptimizerImpl).costOptimizable(Optimizable, TableDescriptor, ConglomerateDescriptor, OptimizablePredicateList, CostEstimate) line: 1984\\t \\n\\tFromBaseTable.optimizeIt(Optimizer, OptimizablePredicateList, CostEstimate, RowOrdering) line: 521\\t \\n\\tProjectRestrictNode.optimizeIt(Optimizer, OptimizablePredicateList, CostEstimate, RowOrdering) line: 316\\t \\n\\tLevel2OptimizerImpl(OptimizerImpl).costPermutation() line: 1938\\t \\n\\tSelectNode.optimize(DataDictionary, PredicateList, double) line: 1767\\t \\n\\tCursorNode(DMLStatementNode).optimizeStatement() line: 305\\t \\n\\tCursorNode.optimizeStatement() line: 515\\t \\n\\tGenericStatement.prepMinion(LanguageConnectionContext, boolean, Object[], SchemaDescriptor, boolean) line: 367\\t \\n\\tGenericStatement.prepare(LanguageConnectionContext, boolean) line: 88\\t \\n\\tGenericLanguageConnectionContext.prepareInternalStatement(SchemaDescriptor, String, boolean, boolean) line: 802\\t \\n\\tEmbedStatement40(EmbedStatement).execute(String, boolean, boolean, int, int[], String[]) line: 606\\t \\n\\tij.executeImmediate(String) line: 329\\t \\n\\tutilMain.doCatch(String) line: 505\\t \\n\\tutilMain.runScriptGuts() line: 347\\t \\n\\tutilMain.go(LocalizedInput[], LocalizedOutput) line: 245\\t \\n\\tMain.go(LocalizedInput, LocalizedOutput) line: 210\\t \\n\\tMain.mainCore(String[], Main) line: 177\\t \\n\\tMain.main(String[]) line: 73\\t \\n\\tMain.main(String[]) line: 73\\t \\n\\tij.main(String[]) line: 59\\t \\nBut it is obvious from the query plan for non-working that somehow we later decide to do sort avoidance for m0. I will look more to see where the optimizer changes it mind about the sort requirement for m0.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12697757\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12697757&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12697757\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12697757_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12697757_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Apr\\/09 06:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-10T06:40:28+0000\'\u003e10\\/Apr\\/09 06:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor the incorrect case, the join order picked is 2,1,0 which m1, m0, table1 where as for the correct case, the join order picked is 2,0,1 which is m1,table1,m0. The other interesting thing in case of incorrect case is, for m0, for the plan used for m0, both the \\\"optimizer estimated row count\\\" and \\\"optimizer estimated cost\\\" are 0.00. Is it possible for the optimizer to be able to find a plan for a table such that the \\\"optimizer estimated row count\\\" and \\\"optimizer estimated cost\\\" can be 0? Maybe that is a valid situation, I don\'t know enough about the optimizer yet to answer that question but I though those statistics were worth bringing it up for discussion. \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12697757_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12697757_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Apr\\/09 06:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-10T06:40:28+0000\'\u003e10\\/Apr\\/09 06:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For the incorrect case, the join order picked is 2,1,0 which m1, m0, table1 where as for the correct case, the join order picked is 2,0,1 which is m1,table1,m0. The other interesting thing in case of incorrect case is, for m0, for the plan used for m0, both the \\\"optimizer estimated row count\\\" and \\\"optimizer estimated cost\\\" are 0.00. Is it possible for the optimizer to be able to find a plan for a table such that the \\\"optimizer estimated row count\\\" and \\\"optimizer estimated cost\\\" can be 0? Maybe that is a valid situation, I don\'t know enough about the optimizer yet to answer that question but I though those statistics were worth bringing it up for discussion.  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12697764\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12697764&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12697764\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12697764_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12697764_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Apr\\/09 07:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-10T07:53:09+0000\'\u003e10\\/Apr\\/09 07:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDuring query optimization phase, we need to know the estimated row count for the tables involved in the query. What I have found during debugging  of the correct case and incorrect case is that the estimated row count is not the same in the 2 cases. When we finish the database session in which the tables, indexes are created, as part of closing the session, we must update the estimated row count and that would explain why the count is different for the same table. Of course, this change in estimated row count must be factoring in what plan gets picked up by the optimizer. \u003c\\/p\u003e\\n\\n\u003cp\u003eNext, I am planning on pursuing the broken case cost estimates during different join permutation because it seems like we are ending up with scenarios where the cost estimate shows the cost and row count to be 0 and hence we end up picking that plan because it is costing nothing to pickup that plan. Like I said in my earlier comment, I am not sure if it is ok to cost nothing for a plan and hence it ending up becoming the best plan and probably the best sort avoidance plan too.\u003cbr\\/\u003e\\ncostEstimate\\t\u003cbr\\/\u003e\\n\\tcost\\t0.0\\t\u003cbr\\/\u003e\\n\\trowCount\\t0.0\\t\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12697764_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12697764_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Apr\\/09 07:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-10T07:53:09+0000\'\u003e10\\/Apr\\/09 07:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    During query optimization phase, we need to know the estimated row count for the tables involved in the query. What I have found during debugging  of the correct case and incorrect case is that the estimated row count is not the same in the 2 cases. When we finish the database session in which the tables, indexes are created, as part of closing the session, we must update the estimated row count and that would explain why the count is different for the same table. Of course, this change in estimated row count must be factoring in what plan gets picked up by the optimizer.  \\n\\n Next, I am planning on pursuing the broken case cost estimates during different join permutation because it seems like we are ending up with scenarios where the cost estimate shows the cost and row count to be 0 and hence we end up picking that plan because it is costing nothing to pickup that plan. Like I said in my earlier comment, I am not sure if it is ok to cost nothing for a plan and hence it ending up becoming the best plan and probably the best sort avoidance plan too. \\ncostEstimate\\t \\n\\tcost\\t0.0\\t \\n\\trowCount\\t0.0\\t              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12697932\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12697932&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12697932\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12697932_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12697932_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Apr\\/09 19:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-10T19:07:45+0000\'\u003e10\\/Apr\\/09 19:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t think tracking down the difference in estimated row count is going to lead you to the solution to this problem.  For this issue it is key to figure out why the particular plan chosen in the bug case is wrong.  It may be that the cost of the plan is wrong, but that should not affect whether any chose plan gives the right result - the cost should never affect that.  \u003c\\/p\u003e\\n\\n\u003cp\u003eSo again I believe the key thing here is to track down why this plan that has m1 as the outermost table thinks that this plan does not have to add a sort at the top to get proper\u003cbr\\/\u003e\\nordering required by order by m0.  My guess is that the bad plan uses the same key for\u003cbr\\/\u003e\\nm1 and m0 which are just ranges on the same table, but has incorrect logic to not see\u003cbr\\/\u003e\\nthat it needs m0 using index key as outer most rather than just index key.  \u003c\\/p\u003e\\n\\n\u003cp\u003eAlso don\'t get confused when the bug is fixed.  My guess is that once the bug is fixed that the currently chosen plan will get marked correctly as NOT a sort avoidance plan which then will require an additional sort node which will add to the cost.  This will probably make it such that the optimizer no longer picks this plan.   \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12697932_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12697932_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Apr\\/09 19:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-10T19:07:45+0000\'\u003e10\\/Apr\\/09 19:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t think tracking down the difference in estimated row count is going to lead you to the solution to this problem.  For this issue it is key to figure out why the particular plan chosen in the bug case is wrong.  It may be that the cost of the plan is wrong, but that should not affect whether any chose plan gives the right result - the cost should never affect that.   \\n\\n So again I believe the key thing here is to track down why this plan that has m1 as the outermost table thinks that this plan does not have to add a sort at the top to get proper \\nordering required by order by m0.  My guess is that the bad plan uses the same key for \\nm1 and m0 which are just ranges on the same table, but has incorrect logic to not see \\nthat it needs m0 using index key as outer most rather than just index key.   \\n\\n Also don\'t get confused when the bug is fixed.  My guess is that once the bug is fixed that the currently chosen plan will get marked correctly as NOT a sort avoidance plan which then will require an additional sort node which will add to the cost.  This will probably make it such that the optimizer no longer picks this plan.                 \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12698038\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12698038&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12698038\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12698038_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12698038_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Apr\\/09 01:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-11T01:21:29+0000\'\u003e11\\/Apr\\/09 01:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, even if the cost calculation for a plan is wrong, Derby should not return wrong resutls and hence for this jira entry, at this point, it might not be worth it to pursue the lead if the cost calculation is wrong.\u003c\\/p\u003e\\n\\n\u003cp\u003eI did find one consistently reproducible SQL which will cause the problem behavior whether we are in the same session where the tables\\/indexes were created or whether we start a fresh database session. So, once the database has been setup, one can open a new ij session and consistently repro the problem case with following optimizer overrides (this way, one does not have to setup the whole database in the same session as the origina problem SQL to repro the problem)\u003cbr\\/\u003e\\nSELECT table1.id, m0.value, m1.value FROM  --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\ntable2  m1 &#8211; DERBY-PROPERTIES index=key3\u003cbr\\/\u003e\\n, table2 m0 &#8211; DERBY-PROPERTIES index=key3\u003cbr\\/\u003e\\n, table1 \u003cbr\\/\u003e\\nWHERE table1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value;\u003c\\/p\u003e\\n\\n\u003cp\u003eSo, the important thing is have both m1 and m0 use the index KEY3 which is on the column value on which ordering is happening for table m0.\u003c\\/p\u003e\\n\\n\u003cp\u003eNow that I have a simple repro case (ie I don\'t have to go through countless iteration of optimizer for all different join orders and different predicate pulling down in different join orders), I can focus on the problem join order. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12698038_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12698038_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Apr\\/09 01:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-11T01:21:29+0000\'\u003e11\\/Apr\\/09 01:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, even if the cost calculation for a plan is wrong, Derby should not return wrong resutls and hence for this jira entry, at this point, it might not be worth it to pursue the lead if the cost calculation is wrong. \\n\\n I did find one consistently reproducible SQL which will cause the problem behavior whether we are in the same session where the tables\\/indexes were created or whether we start a fresh database session. So, once the database has been setup, one can open a new ij session and consistently repro the problem case with following optimizer overrides (this way, one does not have to setup the whole database in the same session as the origina problem SQL to repro the problem) \\nSELECT table1.id, m0.value, m1.value FROM  --DERBY-PROPERTIES joinOrder=FIXED  \\ntable2  m1 &#8211; DERBY-PROPERTIES index=key3 \\n, table2 m0 &#8211; DERBY-PROPERTIES index=key3 \\n, table1  \\nWHERE table1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value; \\n\\n So, the important thing is have both m1 and m0 use the index KEY3 which is on the column value on which ordering is happening for table m0. \\n\\n Now that I have a simple repro case (ie I don\'t have to go through countless iteration of optimizer for all different join orders and different predicate pulling down in different join orders), I can focus on the problem join order.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12698508\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12698508&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12698508\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12698508_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12698508_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/09 19:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-13T19:25:06+0000\'\u003e13\\/Apr\\/09 19:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have done more debugging on the simpler query with optimizer overrides as shown below\u003cbr\\/\u003e\\nSELECT table1.id, m0.value, m1.value FROM  --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\ntable2  m1 &#8211; DERBY-PROPERTIES index=key3\u003cbr\\/\u003e\\n,  table2 m0 &#8211; DERBY-PROPERTIES index=key3\u003cbr\\/\u003e\\n, table1 \u003cbr\\/\u003e\\nWHERE table1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value;\u003c\\/p\u003e\\n\\n\u003cp\u003eFor the query above, when the optimizer will start considering the join orders, it is going to assume table2 m1 is 0, table2 m0 is 1 and table1 is 3. So, when I say in my analysis below, that optimizer is working with say join order 0,1,-1, what I mean is optimizer is considering the join order \u003cbr\\/\u003e\\nm1,m0,-1. -1 means we are not taking into consideration any table for that position at this point. With that in mind, let me share what is happening and what part of it I don\'t understand.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor the query above, optimizer first considers 0,-1,-1 and in OptimizerImpl.costBasedCostOptimizable line 2248 which is shown as below\u003cbr\\/\u003e\\nif (requiredRowOrdering.sortRequired(currentRowOrdering,assignedTableMap) == RequiredRowOrdering.NOTHING_REQUIRED)\u003cbr\\/\u003e\\nThe 2 params to the call above are set as follows\u003cbr\\/\u003e\\nAt this point, currentRowOrdering\\tRowOrderingImpl  (id=62)\\t\u003cbr\\/\u003e\\n\\talwaysOrderedOptimizables\\tVector&lt;E&gt;  (id=92)\\t\u003cbr\\/\u003e\\n\\t\\telementCount\\t0\\t\u003cbr\\/\u003e\\n\\tcolumnsAlwaysOrdered\\tColumnOrdering  (id=94)\\t\u003cbr\\/\u003e\\n\\t\\tcolumns\\tVector&lt;E&gt;  (id=158)\\t\u003cbr\\/\u003e\\n\\t\\tmyDirection\\t3\\t\u003cbr\\/\u003e\\n\\t\\ttables\\tVector&lt;E&gt;  (id=159)\\t\u003cbr\\/\u003e\\n\\tcurrentColumnOrdering\\tnull\\t\u003cbr\\/\u003e\\n\\tordering\\tVector&lt;E&gt;  (id=96)\\t\u003cbr\\/\u003e\\n\\t\\telementCount\\t0\\t\u003cbr\\/\u003e\\n\\tunorderedOptimizables\\tVector&lt;E&gt;  (id=97)\\t\u003cbr\\/\u003e\\n\\t\\telementCount\\t0\\t\u003cbr\\/\u003e\\n(ColumnsAlwaysOrdered in currentRowOrdering is set to Direction: 3 Table 0, Column 3 Table 0, Column 2)\u003cbr\\/\u003e\\nThe 2nd param assignedTableMap just has \u003c\\/p\u003e\\n{0}\\n\u003cp\u003e because we are only considering 0 in the join order.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe return for the call above with true and that qualifies us to consider sort avoidance for m1. One of my question is should m1 get quailified to have sort avoidance set to true when we are not really ordering on any column that comes from m1?\u003c\\/p\u003e\\n\\n\u003cp\u003eMoving on, once we finish with 0,-1,-1 where we decided that sorting can be avoided for m1, we move to the join order 0,1,-1. Again, we come to the code mentioned above for 0,1,-1\u003cbr\\/\u003e\\nif (requiredRowOrdering.sortRequired(currentRowOrdering,assignedTableMap) == RequiredRowOrdering.NOTHING_REQUIRED)\u003cbr\\/\u003e\\nIf the earlier decision for considering sort avoidance true for m1 was correct(for join order 0,-1,-1), we should definitely return sort avoidance false for join order 0,1,-1 because with m1 as the outermost table, we can\'t avoid sorting on m0. The 2 params at this point in code are as follows for the call above\u003cbr\\/\u003e\\nThe first param is currentRowOrdering\\tRowOrderingImpl  (id=62)\\t\u003cbr\\/\u003e\\n\\talwaysOrderedOptimizables\\tVector&lt;E&gt;  (id=99)\\t\u003cbr\\/\u003e\\n\\t\\telementCount\\t0\\t\u003cbr\\/\u003e\\n\\tcolumnsAlwaysOrdered\\tColumnOrdering  (id=156)\\t\u003cbr\\/\u003e\\n\\t\\tcolumns\\tVector&lt;E&gt;  (id=245)\\t\u003cbr\\/\u003e\\n\\t\\tmyDirection\\t3\\t\u003cbr\\/\u003e\\n\\t\\ttables\\tVector&lt;E&gt;  (id=246)\\t\u003cbr\\/\u003e\\n\\tcurrentColumnOrdering\\tColumnOrdering  (id=157)\\t\u003cbr\\/\u003e\\n\\t\\tcolumns\\tVector&lt;E&gt;  (id=252)\\t\u003cbr\\/\u003e\\n\\t\\tmyDirection\\t1\\t\u003cbr\\/\u003e\\n\\t\\ttables\\tVector&lt;E&gt;  (id=255)\\t\u003cbr\\/\u003e\\n\\tordering\\tVector&lt;E&gt;  (id=103)\\t\u003cbr\\/\u003e\\n\\t\\telementCount\\t1\\t\u003cbr\\/\u003e\\n\\t\\telementData\\tObject\u003cspan class=\\\"error\\\"\u003e&#91;10&#93;\u003c\\/span\u003e  (id=259)\\t\u003cbr\\/\u003e\\n\\t\\tmodCount\\t3\\t\u003cbr\\/\u003e\\n\\tunorderedOptimizables\\tVector&lt;E&gt;  (id=104)\\t\u003cbr\\/\u003e\\n\\t\\telementCount\\t0\\t\u003cbr\\/\u003e\\n(ColumnsAlwaysOrdered in currentRowOrdering is set to Direction: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2)\u003cbr\\/\u003e\\n(currentColumnOrdering in currentRowOrdering is set to Direction: 1 Table 1, Column 3)\u003cbr\\/\u003e\\n(ordering in currentRowOrdering is set to \u003cspan class=\\\"error\\\"\u003e&#91;Direction: 1 Table 1, Column 3&#93;\u003c\\/span\u003e)\u003cbr\\/\u003e\\nThe 2nd param assignedTableMap just has \u003c\\/p\u003e\\n{0,1}\\n\u003cp\u003e because we are only considering 0 and 1 in the join order.\u003c\\/p\u003e\\n\\n\u003cp\u003eGoing further deep in 0,1,-1 join order, the call above leads to following line in impl.sql.compile.OrderByList.sortRequired(RowOrdering, JBitSet) line: 535\\t\u003cbr\\/\u003e\\nif ( ! rowOrdering.alwaysOrdered(cr.getTableNumber())) \u003c\\/p\u003e\\n\\n\u003cp\u003eIn this if block, we say that sorting is not required. In my mind, we should required sorting because the outermost table m1 is not going to be able to satisfy the ordering requirement for m0.value and hence we can\'t consider sort avoidance when m1 is outermost. But of course, code is deciding that sort avoidance is ok in this case. I will highly appreciate if someone can help me understand this piece of code which ends up making the decision for sorting required or not required. I think the code is mostly centered in org.apache.derby.impl.sql.compile.RowOrderingImple (protocol class org.apache.derby.iapi.sql.compile.RowOrdering). There is not much of javadoc at the class level which is making it hard me to grasp what this class is supposed to do and what are the different memebers in it. I am going to debug further on my own to try to understand it but any help from community will be appreciated.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12698508_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12698508_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/09 19:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-13T19:25:06+0000\'\u003e13\\/Apr\\/09 19:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have done more debugging on the simpler query with optimizer overrides as shown below \\nSELECT table1.id, m0.value, m1.value FROM  --DERBY-PROPERTIES joinOrder=FIXED  \\ntable2  m1 &#8211; DERBY-PROPERTIES index=key3 \\n,  table2 m0 &#8211; DERBY-PROPERTIES index=key3 \\n, table1  \\nWHERE table1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value; \\n\\n For the query above, when the optimizer will start considering the join orders, it is going to assume table2 m1 is 0, table2 m0 is 1 and table1 is 3. So, when I say in my analysis below, that optimizer is working with say join order 0,1,-1, what I mean is optimizer is considering the join order  \\nm1,m0,-1. -1 means we are not taking into consideration any table for that position at this point. With that in mind, let me share what is happening and what part of it I don\'t understand. \\n\\n For the query above, optimizer first considers 0,-1,-1 and in OptimizerImpl.costBasedCostOptimizable line 2248 which is shown as below \\nif (requiredRowOrdering.sortRequired(currentRowOrdering,assignedTableMap) == RequiredRowOrdering.NOTHING_REQUIRED) \\nThe 2 params to the call above are set as follows \\nAt this point, currentRowOrdering\\tRowOrderingImpl  (id=62)\\t \\n\\talwaysOrderedOptimizables\\tVector&lt;E&gt;  (id=92)\\t \\n\\t\\telementCount\\t0\\t \\n\\tcolumnsAlwaysOrdered\\tColumnOrdering  (id=94)\\t \\n\\t\\tcolumns\\tVector&lt;E&gt;  (id=158)\\t \\n\\t\\tmyDirection\\t3\\t \\n\\t\\ttables\\tVector&lt;E&gt;  (id=159)\\t \\n\\tcurrentColumnOrdering\\tnull\\t \\n\\tordering\\tVector&lt;E&gt;  (id=96)\\t \\n\\t\\telementCount\\t0\\t \\n\\tunorderedOptimizables\\tVector&lt;E&gt;  (id=97)\\t \\n\\t\\telementCount\\t0\\t \\n(ColumnsAlwaysOrdered in currentRowOrdering is set to Direction: 3 Table 0, Column 3 Table 0, Column 2) \\nThe 2nd param assignedTableMap just has  \\n{0}\\n  because we are only considering 0 in the join order. \\n\\n We return for the call above with true and that qualifies us to consider sort avoidance for m1. One of my question is should m1 get quailified to have sort avoidance set to true when we are not really ordering on any column that comes from m1? \\n\\n Moving on, once we finish with 0,-1,-1 where we decided that sorting can be avoided for m1, we move to the join order 0,1,-1. Again, we come to the code mentioned above for 0,1,-1 \\nif (requiredRowOrdering.sortRequired(currentRowOrdering,assignedTableMap) == RequiredRowOrdering.NOTHING_REQUIRED) \\nIf the earlier decision for considering sort avoidance true for m1 was correct(for join order 0,-1,-1), we should definitely return sort avoidance false for join order 0,1,-1 because with m1 as the outermost table, we can\'t avoid sorting on m0. The 2 params at this point in code are as follows for the call above \\nThe first param is currentRowOrdering\\tRowOrderingImpl  (id=62)\\t \\n\\talwaysOrderedOptimizables\\tVector&lt;E&gt;  (id=99)\\t \\n\\t\\telementCount\\t0\\t \\n\\tcolumnsAlwaysOrdered\\tColumnOrdering  (id=156)\\t \\n\\t\\tcolumns\\tVector&lt;E&gt;  (id=245)\\t \\n\\t\\tmyDirection\\t3\\t \\n\\t\\ttables\\tVector&lt;E&gt;  (id=246)\\t \\n\\tcurrentColumnOrdering\\tColumnOrdering  (id=157)\\t \\n\\t\\tcolumns\\tVector&lt;E&gt;  (id=252)\\t \\n\\t\\tmyDirection\\t1\\t \\n\\t\\ttables\\tVector&lt;E&gt;  (id=255)\\t \\n\\tordering\\tVector&lt;E&gt;  (id=103)\\t \\n\\t\\telementCount\\t1\\t \\n\\t\\telementData\\tObject &#91;10&#93;   (id=259)\\t \\n\\t\\tmodCount\\t3\\t \\n\\tunorderedOptimizables\\tVector&lt;E&gt;  (id=104)\\t \\n\\t\\telementCount\\t0\\t \\n(ColumnsAlwaysOrdered in currentRowOrdering is set to Direction: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2) \\n(currentColumnOrdering in currentRowOrdering is set to Direction: 1 Table 1, Column 3) \\n(ordering in currentRowOrdering is set to  &#91;Direction: 1 Table 1, Column 3&#93; ) \\nThe 2nd param assignedTableMap just has  \\n{0,1}\\n  because we are only considering 0 and 1 in the join order. \\n\\n Going further deep in 0,1,-1 join order, the call above leads to following line in impl.sql.compile.OrderByList.sortRequired(RowOrdering, JBitSet) line: 535\\t \\nif ( ! rowOrdering.alwaysOrdered(cr.getTableNumber()))  \\n\\n In this if block, we say that sorting is not required. In my mind, we should required sorting because the outermost table m1 is not going to be able to satisfy the ordering requirement for m0.value and hence we can\'t consider sort avoidance when m1 is outermost. But of course, code is deciding that sort avoidance is ok in this case. I will highly appreciate if someone can help me understand this piece of code which ends up making the decision for sorting required or not required. I think the code is mostly centered in org.apache.derby.impl.sql.compile.RowOrderingImple (protocol class org.apache.derby.iapi.sql.compile.RowOrdering). There is not much of javadoc at the class level which is making it hard me to grasp what this class is supposed to do and what are the different memebers in it. I am going to debug further on my own to try to understand it but any help from community will be appreciated.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12699556\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12699556&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12699556\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12699556_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699556_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 06:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T06:59:35+0000\'\u003e16\\/Apr\\/09 06:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI talked to Army offline on this jira entry and following was his feedback on the issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eHe tends to agree that the outermost table m1 should not avoid sorting when the ordering required is on a column that is from an optimizable that is not in the join order yet. The join order is 0,-1,-1 when m1 decides that we can choose a plan which will avoid sorting. The code that makes that decision is in OrderByList.sortRequired(...), lines 496 - 533 Apparently, this code has been there since Cloudscape 2.0 days. \u003c\\/p\u003e\\n\\n\u003cp\u003e*************\u003cb\u003eStart of Army\'s analysis of the issue\u003c\\/b\u003e******************\u003cbr\\/\u003e\\nThe comment preceding the code segment mentioned above says:\u003c\\/p\u003e\\n\\n\u003cp\u003e            \\/*\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003e\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eCheck whether the table referred to is in the table map (if any).\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eIf it isn\'t, we may have an ordering that does not require\u003c\\/li\u003e\\n\\t\\t\u003cli\u003esorting for the tables in a partial join order.  Look for\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ecolumns beyond this column to see whether a referenced table\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eis found - if so, sorting is required (for example, in a\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ecase like ORDER BY S.A, T.B, S.C, sorting is required).\u003cbr\\/\u003e\\n            *\\/\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe 2nd and 3rd line in comment confuses me.  The only time I can think of where we could assume \\\"sort avoidance\\\" was okay when a table number is missing would be if the ORDER BY expression did not refer to any tables, ex. if it was a constant:\u003c\\/p\u003e\\n\\n\u003cp\u003e    ORDER BY \'some literal\', m0.value\u003c\\/p\u003e\\n\\n\u003cp\u003eBut from what I can tell, we catch that during preprocessing and remove the constant, so the above code still wouldn\'t be useful. (Note: the above ORDER BY will actually cause the query to return the correct results because the presence of a non-column expression (esp. the literal) causes the optimizer to ALWAYS perform a sort--that\'s a workaround to the problem if the user really needs one...).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf the code mentioned above was removed, then I think the optimizer would require sorting for the first optimizable (m1), and that would in turn mean that we have to sort for the entire join order--which should return the correct results.  Of course, the thought of just removing code that\'s been in there for years is a bit scary...It would be nice to understand what the intended use case was, but the comments are not clear about that at all.\u003cbr\\/\u003e\\n*************\u003cb\u003eEnd of Army\'s analysis of the issue\u003c\\/b\u003e******************\u003c\\/p\u003e\\n\\n\u003cp\u003eBased on the above feedback, I commented out the code from 496-533 lines in OrderByList and ran the junit tests and they all ran fine. The old harness had one test case failing (lang\\/wisconsin) and it failed because the query plans now include sorting when the original plans (without my code changes) did not include sorting.  It appears that wisconsin test does not check the results of the cursors which are getting prepared. It just opens few cursors in order to get their query plans and dumps the query plans without checking the results of those queries. So I am not sure if the results from those queries have changed because of the additional sorting which is being added into their query plans.\u003c\\/p\u003e\\n\\n\u003cp\u003eOfcourse, the problem query shown below works fine with the code commenting suggested by Army \u003cbr\\/\u003e\\nSELECT table1.id, m0.value, m1.value FROM  --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\ntable2  m1 &#8211; DERBY-PROPERTIES index=key3\u003cbr\\/\u003e\\n,  table2 m0 &#8211; DERBY-PROPERTIES index=key3\u003cbr\\/\u003e\\n, table1 \u003cbr\\/\u003e\\nWHERE table1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value;\u003c\\/p\u003e\\n\\n\u003cp\u003eI would like to know what the community thinks of the code removal suggested by Army.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12699556_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699556_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 06:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T06:59:35+0000\'\u003e16\\/Apr\\/09 06:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I talked to Army offline on this jira entry and following was his feedback on the issue. \\n\\n He tends to agree that the outermost table m1 should not avoid sorting when the ordering required is on a column that is from an optimizable that is not in the join order yet. The join order is 0,-1,-1 when m1 decides that we can choose a plan which will avoid sorting. The code that makes that decision is in OrderByList.sortRequired(...), lines 496 - 533 Apparently, this code has been there since Cloudscape 2.0 days.  \\n\\n ************* Start of Army\'s analysis of the issue ****************** \\nThe comment preceding the code segment mentioned above says: \\n\\n             \\/* \\n \\n\\t \\n\\t \\n\\t\\t Check whether the table referred to is in the table map (if any). \\n\\t\\t If it isn\'t, we may have an ordering that does not require \\n\\t\\t sorting for the tables in a partial join order.  Look for \\n\\t\\t columns beyond this column to see whether a referenced table \\n\\t\\t is found - if so, sorting is required (for example, in a \\n\\t\\t case like ORDER BY S.A, T.B, S.C, sorting is required). \\n            *\\/ \\n\\t \\n\\t \\n \\n\\n\\n The 2nd and 3rd line in comment confuses me.  The only time I can think of where we could assume \\\"sort avoidance\\\" was okay when a table number is missing would be if the ORDER BY expression did not refer to any tables, ex. if it was a constant: \\n\\n     ORDER BY \'some literal\', m0.value \\n\\n But from what I can tell, we catch that during preprocessing and remove the constant, so the above code still wouldn\'t be useful. (Note: the above ORDER BY will actually cause the query to return the correct results because the presence of a non-column expression (esp. the literal) causes the optimizer to ALWAYS perform a sort--that\'s a workaround to the problem if the user really needs one...). \\n\\n If the code mentioned above was removed, then I think the optimizer would require sorting for the first optimizable (m1), and that would in turn mean that we have to sort for the entire join order--which should return the correct results.  Of course, the thought of just removing code that\'s been in there for years is a bit scary...It would be nice to understand what the intended use case was, but the comments are not clear about that at all. \\n************* End of Army\'s analysis of the issue ****************** \\n\\n Based on the above feedback, I commented out the code from 496-533 lines in OrderByList and ran the junit tests and they all ran fine. The old harness had one test case failing (lang\\/wisconsin) and it failed because the query plans now include sorting when the original plans (without my code changes) did not include sorting.  It appears that wisconsin test does not check the results of the cursors which are getting prepared. It just opens few cursors in order to get their query plans and dumps the query plans without checking the results of those queries. So I am not sure if the results from those queries have changed because of the additional sorting which is being added into their query plans. \\n\\n Ofcourse, the problem query shown below works fine with the code commenting suggested by Army  \\nSELECT table1.id, m0.value, m1.value FROM  --DERBY-PROPERTIES joinOrder=FIXED  \\ntable2  m1 &#8211; DERBY-PROPERTIES index=key3 \\n,  table2 m0 &#8211; DERBY-PROPERTIES index=key3 \\n, table1  \\nWHERE table1.id=m0.id AND m0.name=\'PageSequenceId\' AND table1.id=m1.id AND m1.name=\'PostComponentId\' AND m1.value=\'21857\' ORDER BY m0.value; \\n\\n I would like to know what the community thinks of the code removal suggested by Army.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12699721\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12699721&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12699721\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12699721_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699721_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 14:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T14:42:44+0000\'\u003e16\\/Apr\\/09 14:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Army for taking the time to look at this, and for pointing us to a good theory!\u003c\\/p\u003e\\n\\n\u003cp\u003eI like Army\'s suggestion. I wish I had a clearer grasp on the concept of a \'partial join order\'. I think that\u003cbr\\/\u003e\\nthis is an intermediate stage during optimization, where the optimizer has so far chosen an ordering\u003cbr\\/\u003e\\nfor some, but not yet all, of the tables. It looks like the code is trying to handle the problem of how\u003cbr\\/\u003e\\nto make a sort avoidance check at this intermediate point in optimization.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think that all \u003cb\u003echosen\u003c\\/b\u003e query plans eventually reach a \u003cb\u003ecomplete\u003c\\/b\u003e join order, but a query plan which\u003cbr\\/\u003e\\nis \u003cb\u003ediscarded\u003c\\/b\u003e due to being too expensive may never get beyond a \u003cb\u003epartial\u003c\\/b\u003e join order. Is that true?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to me that there may be two topics here:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) it would be valid to make such a check for the purposes of doing some preliminary costing of \u003cbr\\/\u003e\\nthe join order up to this point, but for such an algorithm, the code would have to then re-visit the \u003cbr\\/\u003e\\nsort avoidance decision later in the optimization, once the partial join order had become a full join order.\u003cbr\\/\u003e\\nThat is, I wonder if the overall flow is something like:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eoptimizer investigates a partial join order, decides to cost it, determines that (so far) a sort is not required.\u003c\\/li\u003e\\n\\t\u003cli\u003eoptimizer later completes this join order, decides that it is acceptable, but does NOT re-analyze\u003cbr\\/\u003e\\n   whether a sort is now required for the complete join order\u003c\\/li\u003e\\n\\t\u003cli\u003eoptimizer then chooses the correct full join order, but incorrectly avoids the sort due to the decision\u003cbr\\/\u003e\\n   it made when considering the partial join order.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e2) The comment (\\\"ORDER BY S.A, T.B, S.C\\\") raises the interesting question of the situation in\u003cbr\\/\u003e\\nwhich each column, considered individually, is ordered properly, but because the ORDER BY\u003cbr\\/\u003e\\nclause interleaves columns from different tables, a sort is still required. That is, if S had an index\u003cbr\\/\u003e\\non (A, C), and T had an index on B, we might look at ORDER BY S.A, T.B, S.C and think that no\u003cbr\\/\u003e\\nsorting of the results was required, because the join from S -&gt; T would emit the rows in the\u003cbr\\/\u003e\\ncorrect order, but that is wrong; the interleaving of the columns means that the sort must still be performed.\u003cbr\\/\u003e\\nAnd, presumably, there is the interesting situation where we need to cost out a query at a point\u003cbr\\/\u003e\\nwhere we have determined a partial join order that contains a position for S, but not T, or vice versa.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would be interesting to know more about the Wisconsin test cases, about the queries involved, and\u003cbr\\/\u003e\\nabout the before- and after- query plan differences, with respect to sorting. Are \u003cb\u003eall\u003c\\/b\u003e the changes due\u003cbr\\/\u003e\\nto situations where we formerly avoided a sort, but now we choose one? That\'s interesting, I think; we\u003cbr\\/\u003e\\nwant to be careful to avoid introducing un-necessary sorts because that could be a substantial\u003cbr\\/\u003e\\nperformance regression (of course, if the old query was returning the rows in the wrong order, but\u003cbr\\/\u003e\\nthe test didn\'t check, and the new query is now being performed correctly, that\'s important to know, too!)\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would also be interesting to see if we can construct an example along the lines of the\u003cbr\\/\u003e\\nORDER BY S.A, T.B, S.C case, such that various other permutations (ORDER BY S.A, S.C, T.B or\u003cbr\\/\u003e\\nORDER BY T.B, S.A, S.C) did not require sorting, but ORDER BY S.A, T.B, S.C did, and see how\u003cbr\\/\u003e\\nthe query plans emitted for these various cases behaved.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12699721_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699721_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 14:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T14:42:44+0000\'\u003e16\\/Apr\\/09 14:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Army for taking the time to look at this, and for pointing us to a good theory! \\n\\n I like Army\'s suggestion. I wish I had a clearer grasp on the concept of a \'partial join order\'. I think that \\nthis is an intermediate stage during optimization, where the optimizer has so far chosen an ordering \\nfor some, but not yet all, of the tables. It looks like the code is trying to handle the problem of how \\nto make a sort avoidance check at this intermediate point in optimization. \\n\\n I think that all  chosen  query plans eventually reach a  complete  join order, but a query plan which \\nis  discarded  due to being too expensive may never get beyond a  partial  join order. Is that true? \\n\\n It seems to me that there may be two topics here: \\n\\n 1) it would be valid to make such a check for the purposes of doing some preliminary costing of  \\nthe join order up to this point, but for such an algorithm, the code would have to then re-visit the  \\nsort avoidance decision later in the optimization, once the partial join order had become a full join order. \\nThat is, I wonder if the overall flow is something like: \\n \\n\\t optimizer investigates a partial join order, decides to cost it, determines that (so far) a sort is not required. \\n\\t optimizer later completes this join order, decides that it is acceptable, but does NOT re-analyze \\n   whether a sort is now required for the complete join order \\n\\t optimizer then chooses the correct full join order, but incorrectly avoids the sort due to the decision \\n   it made when considering the partial join order. \\n \\n\\n\\n 2) The comment (\\\"ORDER BY S.A, T.B, S.C\\\") raises the interesting question of the situation in \\nwhich each column, considered individually, is ordered properly, but because the ORDER BY \\nclause interleaves columns from different tables, a sort is still required. That is, if S had an index \\non (A, C), and T had an index on B, we might look at ORDER BY S.A, T.B, S.C and think that no \\nsorting of the results was required, because the join from S -&gt; T would emit the rows in the \\ncorrect order, but that is wrong; the interleaving of the columns means that the sort must still be performed. \\nAnd, presumably, there is the interesting situation where we need to cost out a query at a point \\nwhere we have determined a partial join order that contains a position for S, but not T, or vice versa. \\n\\n It would be interesting to know more about the Wisconsin test cases, about the queries involved, and \\nabout the before- and after- query plan differences, with respect to sorting. Are  all  the changes due \\nto situations where we formerly avoided a sort, but now we choose one? That\'s interesting, I think; we \\nwant to be careful to avoid introducing un-necessary sorts because that could be a substantial \\nperformance regression (of course, if the old query was returning the rows in the wrong order, but \\nthe test didn\'t check, and the new query is now being performed correctly, that\'s important to know, too!) \\n\\n It would also be interesting to see if we can construct an example along the lines of the \\nORDER BY S.A, T.B, S.C case, such that various other permutations (ORDER BY S.A, S.C, T.B or \\nORDER BY T.B, S.A, S.C) did not require sorting, but ORDER BY S.A, T.B, S.C did, and see how \\nthe query plans emitted for these various cases behaved.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12699728\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12699728&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12699728\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12699728_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699728_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T15:19:10+0000\'\u003e16\\/Apr\\/09 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBryan, I haven\'t read your comment completely but I noticed \\\" I wish I had a clearer grasp on the concept of a \'partial join order.  I think that this is an intermediate stage during optimization, where the optimizer has so far chosen an ordering for some, but not yet all, of the tables. It looks like the code is trying to handle the problem of how to make a sort avoidance check at this intermediate point in optimization.\\\" Your understanding of partial join order is correct. For our specific query case, the optimizer is eventually going to have a join order consisting of 3 tables once it determines the best join order. But to arrive to that join order, it goes through many iterations of possible join orders. It starts out by considering only one optimizable in the first position of the join order, eg, 0,-1,-1 and this will be considered partial join order.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12699728_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699728_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T15:19:10+0000\'\u003e16\\/Apr\\/09 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Bryan, I haven\'t read your comment completely but I noticed \\\" I wish I had a clearer grasp on the concept of a \'partial join order.  I think that this is an intermediate stage during optimization, where the optimizer has so far chosen an ordering for some, but not yet all, of the tables. It looks like the code is trying to handle the problem of how to make a sort avoidance check at this intermediate point in optimization.\\\" Your understanding of partial join order is correct. For our specific query case, the optimizer is eventually going to have a join order consisting of 3 tables once it determines the best join order. But to arrive to that join order, it goes through many iterations of possible join orders. It starts out by considering only one optimizable in the first position of the join order, eg, 0,-1,-1 and this will be considered partial join order.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12699729\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12699729&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12699729\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12699729_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699729_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 15:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T15:20:42+0000\'\u003e16\\/Apr\\/09 15:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBryan, I think you are right that there might be some partial join orders which will never reach complete join order stage because the partial join order is turning out to be too expensive.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12699729_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699729_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 15:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T15:20:42+0000\'\u003e16\\/Apr\\/09 15:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Bryan, I think you are right that there might be some partial join orders which will never reach complete join order stage because the partial join order is turning out to be too expensive.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12699739\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12699739&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12699739\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12699739_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699739_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 16:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T16:12:50+0000\'\u003e16\\/Apr\\/09 16:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor what it\'s worth, I agree with everything Bryan wrote in his April 16th comment \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I think that all \u003cb\u003echosen\u003c\\/b\u003e query plans eventually reach a \u003cb\u003ecomplete\u003c\\/b\u003e join order, but a query\u003cbr\\/\u003e\\n&gt; plan which is \u003cb\u003ediscarded\u003c\\/b\u003e due to being too expensive may never get beyond a \u003cb\u003epartial\u003c\\/b\u003e\u003cbr\\/\u003e\\n&gt; join order. Is that true? \u003c\\/p\u003e\\n\\n\u003cp\u003eYes, that\'s true.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; The comment (\\\"ORDER BY S.A, T.B, S.C\\\") raises the interesting question of the\u003cbr\\/\u003e\\n&gt; situation in which each column, considered individually, is ordered properly, but\u003cbr\\/\u003e\\n&gt; because the ORDER BY clause interleaves columns from different tables, a sort is\u003cbr\\/\u003e\\n&gt; still required.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, it does.  And as I re-think about this, perhaps the code was written for a situation like\u003c\\/p\u003e\\n\\n\u003cp\u003e    \\\"ORDER BY S.A, T.B\\\"    &#8211; Note that we do \u003cb\u003eNOT\u003c\\/b\u003e have \\\"S.C\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eIn that case a partial join order with \\\"S\\\" would satisfy the first order by column, and the second order by colum, \\\"T.B\\\", would have a table that is not in the join order.  Without the logic in question, I think the method would determine that a sort was required because table \\\"T\\\" wasn\'t found.  But the logic in question would see if there was anything \'after\' T.B, and since there isn\'t, it would say that the partial join order can avoid a sort \u003cb\u003eso far\u003c\\/b\u003e, with the assumption that if the next optimizable to be placed in the join order is \\\"T\\\", we might be able to avoid the sort entirely.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs soon as \\\"S.C\\\" gets added to the list, though, the logic sees that we have interleaving columns and therefore correctly requires a sort.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo \u003cb\u003eif\u003c\\/b\u003e that\'s a correct statement of how the code is \u003cb\u003esupposed\u003c\\/b\u003e to work, then it is actually quite useful and it does make sense.  But there seems to be a glitch in the logic--namely, it should perhaps require that a) all of the tables for the LEADING SET of order by columns, up to the one whose table cannot be found, MUST exist within the join order, \u003cb\u003eand\u003c\\/b\u003e b) the leading set of order by columns canNOT be empty.  I think the code as written checks for \\\"a\\\", but it does not check for \\\"b\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eSo in the query for this issue, we have \\\"ORDER BY m0.value\\\".  When we get a partial join order with \u003c\\/p\u003e\\n{ m1 }\\n\u003cp\u003e in it, we check the order by column \\\"m0.value\\\" and find that \\\"m0\\\" is not in the (partial) join order.  Today, due to the lack of condition \\\"b\\\", we think we can avoid the sort.  But if condition \\\"b\\\" was in place, we would see that the \\\"leading set\\\" of order by columns--i.e. the number of order by columns before \\\"m0.value\\\", is EMPTY, which means that \\\"so far\\\" nothing is sorted, and thus the sort would be required.\u003c\\/p\u003e\\n\\n\u003cp\u003eI haven\'t actually tried that out, I\'m just writing as things occur to me, so this could be incomplete and\\/or entirely incorrect...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12699739_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699739_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 16:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T16:12:50+0000\'\u003e16\\/Apr\\/09 16:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For what it\'s worth, I agree with everything Bryan wrote in his April 16th comment   \\n\\n &gt; I think that all  chosen  query plans eventually reach a  complete  join order, but a query \\n&gt; plan which is  discarded  due to being too expensive may never get beyond a  partial  \\n&gt; join order. Is that true?  \\n\\n Yes, that\'s true. \\n\\n &gt; The comment (\\\"ORDER BY S.A, T.B, S.C\\\") raises the interesting question of the \\n&gt; situation in which each column, considered individually, is ordered properly, but \\n&gt; because the ORDER BY clause interleaves columns from different tables, a sort is \\n&gt; still required. \\n\\n Yes, it does.  And as I re-think about this, perhaps the code was written for a situation like \\n\\n     \\\"ORDER BY S.A, T.B\\\"    &#8211; Note that we do  NOT  have \\\"S.C\\\". \\n\\n In that case a partial join order with \\\"S\\\" would satisfy the first order by column, and the second order by colum, \\\"T.B\\\", would have a table that is not in the join order.  Without the logic in question, I think the method would determine that a sort was required because table \\\"T\\\" wasn\'t found.  But the logic in question would see if there was anything \'after\' T.B, and since there isn\'t, it would say that the partial join order can avoid a sort  so far , with the assumption that if the next optimizable to be placed in the join order is \\\"T\\\", we might be able to avoid the sort entirely. \\n\\n As soon as \\\"S.C\\\" gets added to the list, though, the logic sees that we have interleaving columns and therefore correctly requires a sort. \\n\\n So  if  that\'s a correct statement of how the code is  supposed  to work, then it is actually quite useful and it does make sense.  But there seems to be a glitch in the logic--namely, it should perhaps require that a) all of the tables for the LEADING SET of order by columns, up to the one whose table cannot be found, MUST exist within the join order,  and  b) the leading set of order by columns canNOT be empty.  I think the code as written checks for \\\"a\\\", but it does not check for \\\"b\\\". \\n\\n So in the query for this issue, we have \\\"ORDER BY m0.value\\\".  When we get a partial join order with  \\n{ m1 }\\n  in it, we check the order by column \\\"m0.value\\\" and find that \\\"m0\\\" is not in the (partial) join order.  Today, due to the lack of condition \\\"b\\\", we think we can avoid the sort.  But if condition \\\"b\\\" was in place, we would see that the \\\"leading set\\\" of order by columns--i.e. the number of order by columns before \\\"m0.value\\\", is EMPTY, which means that \\\"so far\\\" nothing is sorted, and thus the sort would be required. \\n\\n I haven\'t actually tried that out, I\'m just writing as things occur to me, so this could be incomplete and\\/or entirely incorrect...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12699744\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12699744&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12699744\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12699744_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699744_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 16:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T16:16:00+0000\'\u003e16\\/Apr\\/09 16:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; if condition \\\"b\\\" was in place, we would see that the \\\"leading set\\\" of order by\u003cbr\\/\u003e\\n&gt; columns--i.e. the number of order by columns before \\\"m0.value\\\", is EMPTY,\u003cbr\\/\u003e\\n&gt; which means that \\\"so far\\\" nothing is sorted, and thus the sort would be required.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne easy way to check this theory would be to make the following change:\u003c\\/p\u003e\\n\\n\u003cp\u003e@@ -503,7 +503,7 @@\u003cbr\\/\u003e\\n                        *\\/\u003cbr\\/\u003e\\n                        if (tableMap != null)\u003cbr\\/\u003e\\n                        {\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eif ( ! tableMap.get(cr.getTableNumber()))\u003cbr\\/\u003e\\n+                               if ((position &gt; 0) &amp;&amp; !tableMap.get(cr.getTableNumber()))\u003cbr\\/\u003e\\n                                {\u003cbr\\/\u003e\\n                                        \\/* Table not in partial join order *\\/\u003cbr\\/\u003e\\n                                        for (int remainingPosition = loc + 1;\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eand see what happens...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12699744_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699744_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 16:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T16:16:00+0000\'\u003e16\\/Apr\\/09 16:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; if condition \\\"b\\\" was in place, we would see that the \\\"leading set\\\" of order by \\n&gt; columns--i.e. the number of order by columns before \\\"m0.value\\\", is EMPTY, \\n&gt; which means that \\\"so far\\\" nothing is sorted, and thus the sort would be required. \\n\\n One easy way to check this theory would be to make the following change: \\n\\n @@ -503,7 +503,7 @@ \\n                        *\\/ \\n                        if (tableMap != null) \\n                        { \\n \\n\\t if ( ! tableMap.get(cr.getTableNumber())) \\n+                               if ((position &gt; 0) &amp;&amp; !tableMap.get(cr.getTableNumber())) \\n                                { \\n                                        \\/* Table not in partial join order *\\/ \\n                                        for (int remainingPosition = loc + 1; \\n \\n\\n\\n and see what happens...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12699755\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12699755&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12699755\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12699755_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699755_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 16:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T16:33:14+0000\'\u003e16\\/Apr\\/09 16:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; \u003cb\u003eand\u003c\\/b\u003e b) the leading set of order by columns canNOT be empty.\u003c\\/p\u003e\\n\\n\u003cp\u003eOkay, check that, that\'s not a complete solution.\u003c\\/p\u003e\\n\\n\u003cp\u003eConsider\u003c\\/p\u003e\\n\\n\u003cp\u003e    ORDER BY S.A, T.B\u003c\\/p\u003e\\n\\n\u003cp\u003ewith a join order of \u003c\\/p\u003e\\n{ S, W, - }\\n\u003cp\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we can avoid sorting for S.A and then we process \\\"T.B\\\" and say that we can avoid the sort there, as well, we\'ll get into trouble.  Once we get to join order \u003c\\/p\u003e\\n{ S, W, T }\\n\u003cp\u003e we might find that our access plan for T can avoid the sort for B...but due to the presence of \\\"W\\\" in the join order, I think the results would still end up out of order.  So the condition would have to be generalized more than what I posted earlier...I think...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12699755_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699755_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 16:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T16:33:14+0000\'\u003e16\\/Apr\\/09 16:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt;  and  b) the leading set of order by columns canNOT be empty. \\n\\n Okay, check that, that\'s not a complete solution. \\n\\n Consider \\n\\n     ORDER BY S.A, T.B \\n\\n with a join order of  \\n{ S, W, - }\\n . \\n\\n If we can avoid sorting for S.A and then we process \\\"T.B\\\" and say that we can avoid the sort there, as well, we\'ll get into trouble.  Once we get to join order  \\n{ S, W, T }\\n  we might find that our access plan for T can avoid the sort for B...but due to the presence of \\\"W\\\" in the join order, I think the results would still end up out of order.  So the condition would have to be generalized more than what I posted earlier...I think...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12699763\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12699763&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12699763\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12699763_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699763_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T17:00:06+0000\'\u003e16\\/Apr\\/09 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; due to the presence of \\\"W\\\" in the join order, I think the results would still end up out of order.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not seeing that, seems like the data from W is irrelevant to the final ordering, but I think it\'s \u003cbr\\/\u003e\\ngood to be cautious and verify all of this with some actual tables and some actual queries.\u003c\\/p\u003e\\n\\n\u003cp\u003eMamta, you might want to mark this issue as assigned to you...?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12699763_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12699763_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/09 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-16T17:00:06+0000\'\u003e16\\/Apr\\/09 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; due to the presence of \\\"W\\\" in the join order, I think the results would still end up out of order. \\n\\n I\'m not seeing that, seems like the data from W is irrelevant to the final ordering, but I think it\'s  \\ngood to be cautious and verify all of this with some actual tables and some actual queries. \\n\\n Mamta, you might want to mark this issue as assigned to you...?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12701587\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12701587&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12701587\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12701587_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701587_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Apr\\/09 16:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-22T16:15:58+0000\'\u003e22\\/Apr\\/09 16:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have worked on writing a junit test which is currently going to fail because we are returning the data in incorrect order. I thought it would be useful to have the test for people to quickly run the test if they wanted to. This junit test will not be part of any suite currently since the bug is not fixed yet. Putting it in the suite is going to make it fail everytime because the test is asserting that the data be returned in the correct order. I will check that test in soon. It was painful to convert the setup script provided for this jira into a junit test. The script is huge. I was able to use Army\'s test converter \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2151\\\" title=\\\"&quot;Fixer-upper&quot; utility to help convert ij canon-based tests to JUnit.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2151\\\"\u003e\u003cdel\u003eDERBY-2151\u003c\\/del\u003e\u003c\\/a\u003e(it was extremely helpful because it atleast converted half of the script into junit test. My understanding is that the converter works on the older canon based master file. I think it takes sql delimited by ; from the canon file and assumes that next line is the output of that sql. So, the converter skipped every other sql from my setup script. I ended up hand putting every other line which was skipped by the converter. )\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12701587_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701587_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Apr\\/09 16:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-22T16:15:58+0000\'\u003e22\\/Apr\\/09 16:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have worked on writing a junit test which is currently going to fail because we are returning the data in incorrect order. I thought it would be useful to have the test for people to quickly run the test if they wanted to. This junit test will not be part of any suite currently since the bug is not fixed yet. Putting it in the suite is going to make it fail everytime because the test is asserting that the data be returned in the correct order. I will check that test in soon. It was painful to convert the setup script provided for this jira into a junit test. The script is huge. I was able to use Army\'s test converter   DERBY-2151  (it was extremely helpful because it atleast converted half of the script into junit test. My understanding is that the converter works on the older canon based master file. I think it takes sql delimited by ; from the canon file and assumes that next line is the output of that sql. So, the converter skipped every other sql from my setup script. I ended up hand putting every other line which was skipped by the converter. )              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12701593\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12701593&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12701593\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12701593_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701593_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Apr\\/09 16:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-22T16:29:57+0000\'\u003e22\\/Apr\\/09 16:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am working on the wisconsin test so I can print out the test results and see if the code changes suggested by Army affects the data output in anyways.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12701593_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701593_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Apr\\/09 16:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-22T16:29:57+0000\'\u003e22\\/Apr\\/09 16:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am working on the wisconsin test so I can print out the test results and see if the code changes suggested by Army affects the data output in anyways.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12701729\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12701729&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12701729\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12701729_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701729_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Apr\\/09 23:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-22T23:09:18+0000\'\u003e22\\/Apr\\/09 23:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Mamta, I noticed the grant to ASF checkbox was not marked with the attachment derby-reproduce.zip. Do you think it is ok to turn it into a test?  This may be fine since it is just SQL and not java code, but I wanted to just check and make sure.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12701729_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701729_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Apr\\/09 23:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-22T23:09:18+0000\'\u003e22\\/Apr\\/09 23:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Mamta, I noticed the grant to ASF checkbox was not marked with the attachment derby-reproduce.zip. Do you think it is ok to turn it into a test?  This may be fine since it is just SQL and not java code, but I wanted to just check and make sure. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12701802\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12701802&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12701802\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12701802_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701802_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 04:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T04:45:01+0000\'\u003e23\\/Apr\\/09 04:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for catching that, Kathey. I don\'t know the answer whether it is ok to create a SQL test out of an attachement which is not marked grant to ASF. Maybe someone else has a definitive answer.\u003c\\/p\u003e\\n\\n\u003cp\u003eTars Joris, do you think you can grant the derby-reproduce.zip to ASF?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12701802_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701802_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 04:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T04:45:01+0000\'\u003e23\\/Apr\\/09 04:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for catching that, Kathey. I don\'t know the answer whether it is ok to create a SQL test out of an attachement which is not marked grant to ASF. Maybe someone else has a definitive answer. \\n\\n Tars Joris, do you think you can grant the derby-reproduce.zip to ASF?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12701827\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12701827&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12701827\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tjoris\\\" id=\\\"commentauthor_12701827_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tjoris\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tjoris\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tars Joris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701827_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 07:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T07:28:36+0000\'\u003e23\\/Apr\\/09 07:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI will find out if the test code can be granted to ASF.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tjoris\\\" id=\\\"commentauthor_12701827_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tjoris\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tjoris\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tars Joris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12701827_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 07:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T07:28:36+0000\'\u003e23\\/Apr\\/09 07:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I will find out if the test code can be granted to ASF.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12702085\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12702085&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12702085\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12702085_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12702085_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 20:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T20:13:17+0000\'\u003e23\\/Apr\\/09 20:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ewisconsin test was showing diffs after I commented out the code in OrderByList (code through 504-533). The diffs were for 7 queries and for those 7 queries, now the plan picked does a sorting (prior to my changes, the sorting was getting avoided). wisconsin test only does query plan dump, it does not check the actual data returned for those queries. For the 7 queries that changed, I added a check to dump the data returned from those queries. Rerunning wisconsin with and without my code changes atleast confirms that the data returned because of the additional sorting node has not been affected. All of these 7 queries involved multiple tables in the FROM list and they had ORDER BY clause. (I have included the 7 queries below for reference).\u003c\\/p\u003e\\n\\n\u003cp\u003eI went through all the queries in wisconsin test and see that there are still quite a few queries (even the ones with more than one table in the FROM list and have ORDER BY) that do not have sorting node on top of their query plan because of the commenting of the code. One of such query example is\u003cbr\\/\u003e\\nget cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t and TENKTUP2.unique1 &lt; 6000\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1\';\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eBTW, the 7 queries that have changed their plans so that they now require sorting are as follows(Note that the comment for the query 2 \\\"says that sort avoidance with joins and order by on columns in different tables\\\". Well, with other change in the code, we are not avoiding sort anymore)\u003cbr\\/\u003e\\n1)\u003cbr\\/\u003e\\nij&gt; &#8211; one row from joining table\u003cbr\\/\u003e\\nget cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique2 = TENKTUP2.unique2\u003cbr\\/\u003e\\n\\t and TENKTUP2.unique1 = 0\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1\';\u003c\\/p\u003e\\n\\n\u003cp\u003e2)\u003cbr\\/\u003e\\nij&gt; &#8211; Sort avoidance with joins and order by on columns in different tables\u003cbr\\/\u003e\\n&#8211;\u003cbr\\/\u003e\\n-- order on joining columns\u003cbr\\/\u003e\\nget cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\';\u003c\\/p\u003e\\n\\n\u003cp\u003e3)\u003cbr\\/\u003e\\nij&gt; get cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t and TENKTUP1.unique2 = 0\u003cbr\\/\u003e\\n\\t and TENKTUP2.unique2 = 0\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\';\u003c\\/p\u003e\\n\\n\u003cp\u003e4)\u003cbr\\/\u003e\\nij&gt; get cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t and TENKTUP1.unique2 &lt; 6000\u003cbr\\/\u003e\\n\\t and TENKTUP2.unique2 = 0\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\';\u003c\\/p\u003e\\n\\n\u003cp\u003e5)\u003cbr\\/\u003e\\nij&gt; get cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t and TENKTUP1.unique2 &lt; 6000\u003cbr\\/\u003e\\n\\t and TENKTUP2.unique2 = 0\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique2, TENKTUP2.unique2\';\u003c\\/p\u003e\\n\\n\u003cp\u003e6)\u003cbr\\/\u003e\\nij&gt; get cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2, ONEKTUP\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t and ONEKTUP.unique1 = TENKTUP1.unique1\u003cbr\\/\u003e\\n\\t and TENKTUP1.unique2 = 0\u003cbr\\/\u003e\\n\\t and TENKTUP2.unique2 = 0\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\';\u003c\\/p\u003e\\n\\n\u003cp\u003e7)\u003cbr\\/\u003e\\nij&gt; get cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2, ONEKTUP\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique2 = TENKTUP2.unique2\u003cbr\\/\u003e\\n\\t and ONEKTUP.unique2 = TENKTUP1.unique2\u003cbr\\/\u003e\\n\\t and TENKTUP1.unique2 = 0\u003cbr\\/\u003e\\n\\t and TENKTUP2.unique2 = 0\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\';\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12702085_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12702085_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 20:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T20:13:17+0000\'\u003e23\\/Apr\\/09 20:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    wisconsin test was showing diffs after I commented out the code in OrderByList (code through 504-533). The diffs were for 7 queries and for those 7 queries, now the plan picked does a sorting (prior to my changes, the sorting was getting avoided). wisconsin test only does query plan dump, it does not check the actual data returned for those queries. For the 7 queries that changed, I added a check to dump the data returned from those queries. Rerunning wisconsin with and without my code changes atleast confirms that the data returned because of the additional sorting node has not been affected. All of these 7 queries involved multiple tables in the FROM list and they had ORDER BY clause. (I have included the 7 queries below for reference). \\n\\n I went through all the queries in wisconsin test and see that there are still quite a few queries (even the ones with more than one table in the FROM list and have ORDER BY) that do not have sorting node on top of their query plan because of the commenting of the code. One of such query example is \\nget cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t and TENKTUP2.unique1 &lt; 6000 \\n\\t order by TENKTUP1.unique1\'; \\n\\n\\n BTW, the 7 queries that have changed their plans so that they now require sorting are as follows(Note that the comment for the query 2 \\\"says that sort avoidance with joins and order by on columns in different tables\\\". Well, with other change in the code, we are not avoiding sort anymore) \\n1) \\nij&gt; &#8211; one row from joining table \\nget cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique2 = TENKTUP2.unique2 \\n\\t and TENKTUP2.unique1 = 0 \\n\\t order by TENKTUP1.unique1\'; \\n\\n 2) \\nij&gt; &#8211; Sort avoidance with joins and order by on columns in different tables \\n&#8211; \\n-- order on joining columns \\nget cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\'; \\n\\n 3) \\nij&gt; get cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t and TENKTUP1.unique2 = 0 \\n\\t and TENKTUP2.unique2 = 0 \\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\'; \\n\\n 4) \\nij&gt; get cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t and TENKTUP1.unique2 &lt; 6000 \\n\\t and TENKTUP2.unique2 = 0 \\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\'; \\n\\n 5) \\nij&gt; get cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t and TENKTUP1.unique2 &lt; 6000 \\n\\t and TENKTUP2.unique2 = 0 \\n\\t order by TENKTUP1.unique2, TENKTUP2.unique2\'; \\n\\n 6) \\nij&gt; get cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2, ONEKTUP \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t and ONEKTUP.unique1 = TENKTUP1.unique1 \\n\\t and TENKTUP1.unique2 = 0 \\n\\t and TENKTUP2.unique2 = 0 \\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\'; \\n\\n 7) \\nij&gt; get cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2, ONEKTUP \\n\\t where TENKTUP1.unique2 = TENKTUP2.unique2 \\n\\t and ONEKTUP.unique2 = TENKTUP1.unique2 \\n\\t and TENKTUP1.unique2 = 0 \\n\\t and TENKTUP2.unique2 = 0 \\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\'; \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12702107\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12702107&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12702107\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12702107_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12702107_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 21:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T21:03:01+0000\'\u003e23\\/Apr\\/09 21:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Mamta!\u003c\\/p\u003e\\n\\n\u003cp\u003eCould you perhaps include the join order that was chosen for each of the above queries?  I\'m not looking for the full query plan, just something short like the \u003c\\/p\u003e\\n{ TENKTUP1, TENKTUP2 }\\n\u003cp\u003e notation.  You should be able to get the join order by reading the query plan top to bottom; the order in which you see the table names should reflect the join order chosen by the optimizer.\u003c\\/p\u003e\\n\\n\u003cp\u003eNote that the order by clauses for queries #2 thru #7 all match the \\\"ORDER BY S.A, T.B\\\" shape that I mentioned in my first April 16th comment, so if the theory as to how that code is supposed to work was correct, that \u003cb\u003emight\u003c\\/b\u003e explain why these queries fail to avoid the sort when the relevant code is commented out...?  Of course, more tracing\\/debugging of the individual queries would be necessary to know for sure...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12702107_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12702107_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 21:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T21:03:01+0000\'\u003e23\\/Apr\\/09 21:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Mamta! \\n\\n Could you perhaps include the join order that was chosen for each of the above queries?  I\'m not looking for the full query plan, just something short like the  \\n{ TENKTUP1, TENKTUP2 }\\n  notation.  You should be able to get the join order by reading the query plan top to bottom; the order in which you see the table names should reflect the join order chosen by the optimizer. \\n\\n Note that the order by clauses for queries #2 thru #7 all match the \\\"ORDER BY S.A, T.B\\\" shape that I mentioned in my first April 16th comment, so if the theory as to how that code is supposed to work was correct, that  might  explain why these queries fail to avoid the sort when the relevant code is commented out...?  Of course, more tracing\\/debugging of the individual queries would be necessary to know for sure...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12702137\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12702137&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12702137\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12702137_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12702137_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 22:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T22:12:35+0000\'\u003e23\\/Apr\\/09 22:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI took a close look at the original query plans for queries 1 through 3, and believe all of the original \u003cbr\\/\u003e\\nquery plans with no sort at the top are valid plans.  So think the current fix may not be valid as it is causing sort where they do not need to be.  I am new to this, so if my logic is wrong please point it\u003cbr\\/\u003e\\nout.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor query 1:\u003cbr\\/\u003e\\n1)\u003cbr\\/\u003e\\nij&gt; &#8211; one row from joining table\u003cbr\\/\u003e\\nget cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique2 = TENKTUP2.unique2\u003cbr\\/\u003e\\n\\t and TENKTUP2.unique1 = 0\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1\';\u003c\\/p\u003e\\n\\n\u003cp\u003eBecause TENKTUP2.unique1 is a unique column and the query requires TENKTUP2.unique1 = 0,\u003cbr\\/\u003e\\nonly 1 or 0 rows qualifies from TENKTUP2.   Because TENKTUP2.unique2 and TENKTUP1.unique2 are \u003cbr\\/\u003e\\nalso both unique then TENKTUP1.unique2 = TENKTUP2.unique2 means only 1 or 0 rows qualify\u003cbr\\/\u003e\\nqualify from TENKTUP1.  This means the query can only return 1 or 0 rows.  Because this is the\u003cbr\\/\u003e\\ncase there is no need to sort a 1 or 0 row result set.\u003c\\/p\u003e\\n\\n\u003cp\u003eMy question is, is it expected that the optimizer should recognize that a one row result set requires \u003cbr\\/\u003e\\nno ordering?  \u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks like queries 3 through 7 are all variations on one row result sets.\u003c\\/p\u003e\\n\\n\u003cp\u003eQuery 2 is different:\u003cbr\\/\u003e\\nget cursor c as\u003cbr\\/\u003e\\n\\t\'select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\';\u003c\\/p\u003e\\n\\n\u003cp\u003eIn this case the interesting thing is that TENKTUP1.unique1 must be the same as \u003cbr\\/\u003e\\nTENKTUP2.unique1.  So this means that any plan that is sorted on TENKTUP1.unique1 OR\u003cbr\\/\u003e\\nTENKTUP2.unique1 fulfills the order by requirement to be sorted by TENKTUP1.unique1, TENKTUP2.unique1.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo in the original queryplan it turns out the outermost index scan is:\u003cbr\\/\u003e\\nTENKTUP1 using index TK1UNIQUE1  which because of the predicate is enough to avoid sorting.\u003c\\/p\u003e\\n\\n\u003cp\u003eAgain the question is whether the code is meant to catch this case or did it get lucky?\u003c\\/p\u003e\\n\\n\u003cp\u003eOriginally I have to admit I didn\'t understand how any multiple table order by could be a sort \u003cbr\\/\u003e\\navoidance plan since we have no indexes that cover multiple tables.  I believe the above show\u003cbr\\/\u003e\\nsome of the cases.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother case I have seen is an order by of A.key, B.key being satisfied by join on A.key, B.key when it is known A.key is a single value.  Or satisfied also by join on B.key, A.key where it is also known that\u003cbr\\/\u003e\\nA is a single value like A.key = ?. \u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12702137_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12702137_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 22:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T22:12:35+0000\'\u003e23\\/Apr\\/09 22:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I took a close look at the original query plans for queries 1 through 3, and believe all of the original  \\nquery plans with no sort at the top are valid plans.  So think the current fix may not be valid as it is causing sort where they do not need to be.  I am new to this, so if my logic is wrong please point it \\nout. \\n\\n For query 1: \\n1) \\nij&gt; &#8211; one row from joining table \\nget cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique2 = TENKTUP2.unique2 \\n\\t and TENKTUP2.unique1 = 0 \\n\\t order by TENKTUP1.unique1\'; \\n\\n Because TENKTUP2.unique1 is a unique column and the query requires TENKTUP2.unique1 = 0, \\nonly 1 or 0 rows qualifies from TENKTUP2.   Because TENKTUP2.unique2 and TENKTUP1.unique2 are  \\nalso both unique then TENKTUP1.unique2 = TENKTUP2.unique2 means only 1 or 0 rows qualify \\nqualify from TENKTUP1.  This means the query can only return 1 or 0 rows.  Because this is the \\ncase there is no need to sort a 1 or 0 row result set. \\n\\n My question is, is it expected that the optimizer should recognize that a one row result set requires  \\nno ordering?   \\n\\n It looks like queries 3 through 7 are all variations on one row result sets. \\n\\n Query 2 is different: \\nget cursor c as \\n\\t\'select * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t order by TENKTUP1.unique1, TENKTUP2.unique1\'; \\n\\n In this case the interesting thing is that TENKTUP1.unique1 must be the same as  \\nTENKTUP2.unique1.  So this means that any plan that is sorted on TENKTUP1.unique1 OR \\nTENKTUP2.unique1 fulfills the order by requirement to be sorted by TENKTUP1.unique1, TENKTUP2.unique1. \\n\\n So in the original queryplan it turns out the outermost index scan is: \\nTENKTUP1 using index TK1UNIQUE1  which because of the predicate is enough to avoid sorting. \\n\\n Again the question is whether the code is meant to catch this case or did it get lucky? \\n\\n Originally I have to admit I didn\'t understand how any multiple table order by could be a sort  \\navoidance plan since we have no indexes that cover multiple tables.  I believe the above show \\nsome of the cases. \\n\\n Another case I have seen is an order by of A.key, B.key being satisfied by join on A.key, B.key when it is known A.key is a single value.  Or satisfied also by join on B.key, A.key where it is also known that \\nA is a single value like A.key = ?.  \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12702147\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12702147&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12702147\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12702147_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12702147_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 22:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T22:45:26+0000\'\u003e23\\/Apr\\/09 22:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI haven\'t looked at the details of your previous post, but regarding:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; So think the current fix may not be valid as it is causing sort where they do not need to be.\u003c\\/p\u003e\\n\\n\u003cp\u003eI agree.  That\'s what I was hoping to convey in my comment on April 16th when I wrote:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; \u003cb\u003eif\u003c\\/b\u003e that\'s a correct statement of how the code is \u003cb\u003esupposed\u003c\\/b\u003e to work, then it is actually\u003cbr\\/\u003e\\n&gt; quite useful and it does make sense.\u003c\\/p\u003e\\n\\n\u003cp\u003eI.e. we shouldn\'t remove it.  As for:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; is it expected that the optimizer should recognize that a one row result set requires\u003cbr\\/\u003e\\n&gt; no ordering? \u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t know the details of how it works, but there is definitely logic in the optimizer to try to recognize one row result sets and to make decisions based on that information.  The RowOrderingImpl.java class even includes a field called \\\"alwaysOrderedOptimizables\\\" for which the javadoc says:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \\/*\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003e\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eThis vector contains table numbers for tables that are always ordered.\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eThis happens for one-row tables.\u003cbr\\/\u003e\\n    *\\/\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eNot sure how that plays into the above queries, but I thought I\'d mention it...\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Another case I have seen is an order by of A.key, B.key being satisfied by join on\u003cbr\\/\u003e\\n&gt; A.key, B.key when it is known A.key is a single value\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I think that\'s what the \\\"columnsAlwaysOrdered\\\" field in RowOrderingImpl seems to be for.  Any columns which are compared to constants (and probably parameter markers as well?) are considered \\\"always ordered\\\" and hence should not require sorting in and of themselves.  Ex. In the query for this issue the columnsAlwaysOrdered field includes columns m0.name, m1.name, and m1.value because all of those columns are compared to literals in the WHERE clause.  It seems quite possible that the optimizer will apply these rules transitively to detect other \\\"always ordered\\\" columns as well...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12702147_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12702147_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/09 22:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-23T22:45:26+0000\'\u003e23\\/Apr\\/09 22:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I haven\'t looked at the details of your previous post, but regarding: \\n\\n &gt; So think the current fix may not be valid as it is causing sort where they do not need to be. \\n\\n I agree.  That\'s what I was hoping to convey in my comment on April 16th when I wrote: \\n\\n &gt;  if  that\'s a correct statement of how the code is  supposed  to work, then it is actually \\n&gt; quite useful and it does make sense. \\n\\n I.e. we shouldn\'t remove it.  As for: \\n\\n &gt; is it expected that the optimizer should recognize that a one row result set requires \\n&gt; no ordering?  \\n\\n I don\'t know the details of how it works, but there is definitely logic in the optimizer to try to recognize one row result sets and to make decisions based on that information.  The RowOrderingImpl.java class even includes a field called \\\"alwaysOrderedOptimizables\\\" for which the javadoc says: \\n\\n     \\/* \\n \\n\\t \\n\\t \\n\\t\\t This vector contains table numbers for tables that are always ordered. \\n\\t\\t This happens for one-row tables. \\n    *\\/ \\n\\t \\n\\t \\n \\n\\n\\n Not sure how that plays into the above queries, but I thought I\'d mention it... \\n\\n &gt; Another case I have seen is an order by of A.key, B.key being satisfied by join on \\n&gt; A.key, B.key when it is known A.key is a single value \\n\\n Yes, I think that\'s what the \\\"columnsAlwaysOrdered\\\" field in RowOrderingImpl seems to be for.  Any columns which are compared to constants (and probably parameter markers as well?) are considered \\\"always ordered\\\" and hence should not require sorting in and of themselves.  Ex. In the query for this issue the columnsAlwaysOrdered field includes columns m0.name, m1.name, and m1.value because all of those columns are compared to literals in the WHERE clause.  It seems quite possible that the optimizer will apply these rules transitively to detect other \\\"always ordered\\\" columns as well...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12703011\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12703011&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12703011\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tjoris\\\" id=\\\"commentauthor_12703011_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tjoris\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tjoris\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tars Joris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12703011_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/09 07:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-27T07:22:46+0000\'\u003e27\\/Apr\\/09 07:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTest script that can be included in the Test-Suite.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome data was changed, but I verified that it still reproduced the bug.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tjoris\\\" id=\\\"commentauthor_12703011_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tjoris\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tjoris\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tars Joris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12703011_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/09 07:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-27T07:22:46+0000\'\u003e27\\/Apr\\/09 07:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Test script that can be included in the Test-Suite. \\n\\n Some data was changed, but I verified that it still reproduced the bug.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12703351\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12703351&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12703351\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12703351_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12703351_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/09 20:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-27T20:36:34+0000\'\u003e27\\/Apr\\/09 20:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have changed the test to use the test script submitted by Tars this morning. Thanks for the updated script, Tars Joris.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12703351_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12703351_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/09 20:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-27T20:36:34+0000\'\u003e27\\/Apr\\/09 20:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have changed the test to use the test script submitted by Tars this morning. Thanks for the updated script, Tars Joris.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12703844\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12703844&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12703844\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12703844_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12703844_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Apr\\/09 21:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-28T21:49:46+0000\'\u003e28\\/Apr\\/09 21:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI modified the last script provided by Tars to create a table identical to table2 and the new table is called table3. The original query for Tars test case which returns incorrect order of rows used a self join on table2 along with table1. To avoid any possibilities of problems associated with may be self join, I created this table3 which is identical to table2. But despite that, the query is still returning incorrect results. Here is how the new query (without the self join) looks like.\u003cbr\\/\u003e\\nSELECT table1.id, table2.value, table3.value FROM table1, table2, table3 WHERE table1.id=table2.id AND \u003c\\/p\u003e\\n\\n\u003cp\u003etable2.name=\'PageSequenceId\' AND table1.id=table3.id AND table3.name=\'PostComponentId\' AND \u003c\\/p\u003e\\n\\n\u003cp\u003etable3.value=\'21857\' ORDER BY table2.value;\u003c\\/p\u003e\\n\\n\u003cp\u003eThe database can be setup to run the query above is enclosed as script3.sql to this jira entry.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12703844_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12703844_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Apr\\/09 21:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-28T21:49:46+0000\'\u003e28\\/Apr\\/09 21:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I modified the last script provided by Tars to create a table identical to table2 and the new table is called table3. The original query for Tars test case which returns incorrect order of rows used a self join on table2 along with table1. To avoid any possibilities of problems associated with may be self join, I created this table3 which is identical to table2. But despite that, the query is still returning incorrect results. Here is how the new query (without the self join) looks like. \\nSELECT table1.id, table2.value, table3.value FROM table1, table2, table3 WHERE table1.id=table2.id AND  \\n\\n table2.name=\'PageSequenceId\' AND table1.id=table3.id AND table3.name=\'PostComponentId\' AND  \\n\\n table3.value=\'21857\' ORDER BY table2.value; \\n\\n The database can be setup to run the query above is enclosed as script3.sql to this jira entry.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12704227\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12704227&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12704227\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12704227_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12704227_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Apr\\/09 18:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-29T18:12:09+0000\'\u003e29\\/Apr\\/09 18:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mamta A. Satoor - 29\\/Apr\\/09 18:32\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am attaching a newer version of script3.sql The new script is called script3WithUserFriendlyIndexNames.sql The only changes made to script3.sql are to use user-friendly index names so that it is easier to understand the query which is using index names through optimizer overrides to demonstrate the buggy behavior. Hopefully it will be easier to read the query plan as well. The query to see the problem is as follows\u003c\\/p\u003e\\n\\n\u003cp\u003eSELECT table1.id, table2.value, table3.value FROM --DERBY-PROPERTIES joinOrder=FIXED\u003cbr\\/\u003e\\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3\u003cbr\\/\u003e\\n, table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2\u003cbr\\/\u003e\\n, table1\u003cbr\\/\u003e\\nWHERE table1.id=table2.id AND table2.name=\'PageSequenceId\' \u003cbr\\/\u003e\\nAND table1.id=table3.id \u003cbr\\/\u003e\\nAND table3.name=\'PostComponentId\' \u003cbr\\/\u003e\\nAND table3.value=\'21857\' ORDER BY table2.value;\u003c\\/p\u003e\\n\\n\u003cp\u003eThe query plan for the query above looks as follows\u003cbr\\/\u003e\\nStatement Name:\u003cbr\\/\u003e\\n        null\u003cbr\\/\u003e\\nStatement Text:\u003cbr\\/\u003e\\n        SELECT table1.id, table2.value, table3.value FROM --DERBY-PROPERTIES joinOrder=FIXED\u003cbr\\/\u003e\\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3\u003cbr\\/\u003e\\n, table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2\u003cbr\\/\u003e\\n, table1\u003cbr\\/\u003e\\nWHERE table1.id=table2.id AND table2.name=\'PageSequenceId\'\u003cbr\\/\u003e\\nAND table1.id=table3.id\u003cbr\\/\u003e\\nAND table3.name=\'PostComponentId\'\u003cbr\\/\u003e\\nAND table3.value=\'21857\' ORDER BY table2.value\u003cbr\\/\u003e\\nParse Time: 0\u003cbr\\/\u003e\\nBind Time: 0\u003cbr\\/\u003e\\nOptimize Time: 0\u003cbr\\/\u003e\\nGenerate Time: 0\u003cbr\\/\u003e\\nCompile Time: 0\u003cbr\\/\u003e\\nExecute Time: 0\u003cbr\\/\u003e\\nBegin Compilation Timestamp : null\u003cbr\\/\u003e\\nEnd Compilation Timestamp : null\u003cbr\\/\u003e\\nBegin Execution Timestamp : null\u003cbr\\/\u003e\\nEnd Execution Timestamp : null\u003cbr\\/\u003e\\nStatement Execution Plan Text:\u003cbr\\/\u003e\\nProject-Restrict ResultSet (10):\u003cbr\\/\u003e\\nNumber of opens = 1\u003cbr\\/\u003e\\nRows seen = 3\u003cbr\\/\u003e\\nRows filtered = 0\u003cbr\\/\u003e\\nrestriction = false\u003cbr\\/\u003e\\nprojection = true\u003cbr\\/\u003e\\n        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n        open time (milliseconds) = 0\u003cbr\\/\u003e\\n        next time (milliseconds) = 0\u003cbr\\/\u003e\\n        close time (milliseconds) = 0\u003cbr\\/\u003e\\n        restriction time (milliseconds) = 0\u003cbr\\/\u003e\\n        projection time (milliseconds) = 0\u003cbr\\/\u003e\\n        optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n        optimizer estimated cost:         1185.66\u003c\\/p\u003e\\n\\n\u003cp\u003eSource result set:\u003cbr\\/\u003e\\n        User supplied optimizer overrides for join are \u003c\\/p\u003e\\n{ joinOrder=FIXED }\u003cbr\\/\u003e\\n        Nested Loop Exists Join ResultSet:\u003cbr\\/\u003e\\n        Number of opens = 1\u003cbr\\/\u003e\\n        Rows seen from the left = 3\u003cbr\\/\u003e\\n        Rows seen from the right = 3\u003cbr\\/\u003e\\n        Rows filtered = 0\u003cbr\\/\u003e\\n        Rows returned = 3\u003cbr\\/\u003e\\n                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                optimizer estimated cost:         1185.66\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n        Left result set:\u003cbr\\/\u003e\\n                User supplied optimizer overrides for join are { joinOrder=FIXED }\\n\u003cp\u003e                Nested Loop Join ResultSet:\u003cbr\\/\u003e\\n                Number of opens = 1\u003cbr\\/\u003e\\n                Rows seen from the left = 3\u003cbr\\/\u003e\\n                Rows seen from the right = 3\u003cbr\\/\u003e\\n                Rows filtered = 0\u003cbr\\/\u003e\\n                Rows returned = 3\u003cbr\\/\u003e\\n                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                        optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                        optimizer estimated cost:         1185.35\u003c\\/p\u003e\\n\\n\u003cp\u003e                Left result set:\u003cbr\\/\u003e\\n                        Project-Restrict ResultSet (5):\u003cbr\\/\u003e\\n                        Number of opens = 1\u003cbr\\/\u003e\\n                        Rows seen = 3\u003cbr\\/\u003e\\n                        Rows filtered = 0\u003cbr\\/\u003e\\n                        restriction = true\u003cbr\\/\u003e\\n                        projection = true\u003cbr\\/\u003e\\n                                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                restriction time (milliseconds) = 0\u003cbr\\/\u003e\\n                                projection time (milliseconds) = 0\u003cbr\\/\u003e\\n                                optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                                optimizer estimated cost:            6.97\u003c\\/p\u003e\\n\\n\u003cp\u003e                        Source result set:\u003cbr\\/\u003e\\n                                Index Row to Base Row ResultSet for TABLE3:\u003cbr\\/\u003e\\n                                Number of opens = 1\u003cbr\\/\u003e\\n                                Rows seen = 3\u003cbr\\/\u003e\\n                                Columns accessed from heap = \u003c\\/p\u003e\\n{0, 1, 2}\u003cbr\\/\u003e\\n                                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        optimizer estimated row count:  0.20\u003cbr\\/\u003e\\n                                        optimizer estimated cost:            6.97\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                                        User supplied optimizer overrides on TABLE3 are { index=NONUNIQUEONVALUE_TABLE3 }\u003cbr\\/\u003e\\n                                        Index Scan ResultSet for TABLE3 using index NONUNIQUEONVALUE_TABLE3 at read committed isolation level using share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                                        Number of opens = 1\u003cbr\\/\u003e\\n                                        Rows seen = 3\u003cbr\\/\u003e\\n                                        Rows filtered = 0\u003cbr\\/\u003e\\n                                        Fetch Size = 1\u003cbr\\/\u003e\\n                                                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time in milliseconds\\/row = 0\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                                        scan information:\u003cbr\\/\u003e\\n                                                Bit set of columns fetched=All\u003cbr\\/\u003e\\n                                                Number of columns fetched=2\u003cbr\\/\u003e\\n                                                Number of deleted rows visited=0\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                                                Number of pages visited=2\u003cbr\\/\u003e\\n                                                Number of rows qualified=3\u003cbr\\/\u003e\\n                                                Number of rows visited=4\u003cbr\\/\u003e\\n                                                Scan type=btree\u003cbr\\/\u003e\\n                                                Tree height=-1\u003cbr\\/\u003e\\n                                                start position:        &gt;= on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                                                stop position:        &gt; on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                                                qualifiers:None\u003cbr\\/\u003e\\n                                                optimizer estimated row count:          0.20\u003cbr\\/\u003e\\n                                                optimizer estimated cost:     6.97\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                Right result set:\u003cbr\\/\u003e\\n                        Project-Restrict ResultSet (8):\u003cbr\\/\u003e\\n                        Number of opens = 3\u003cbr\\/\u003e\\n                        Rows seen = 8688\u003cbr\\/\u003e\\n                        Rows filtered = 8685\u003cbr\\/\u003e\\n                        restriction = true\u003cbr\\/\u003e\\n                        projection = true\u003cbr\\/\u003e\\n                                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                restriction time (milliseconds) = 0\u003cbr\\/\u003e\\n                                projection time (milliseconds) = 0\u003cbr\\/\u003e\\n                                optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                                optimizer estimated cost:         1178.38\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                        Source result set:\u003cbr\\/\u003e\\n                                Index Row to Base Row ResultSet for TABLE2:\u003cbr\\/\u003e\\n                                Number of opens = 3\u003cbr\\/\u003e\\n                                Rows seen = 8688\u003cbr\\/\u003e\\n                                Columns accessed from heap = {0, 1, 2}\\n\u003cp\u003e                                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                        optimizer estimated row count:  0.20\u003cbr\\/\u003e\\n                                        optimizer estimated cost:         1178.38\u003c\\/p\u003e\\n\\n\u003cp\u003e                                        User supplied optimizer overrides on TABLE2 are \u003c\\/p\u003e\\n{ index=NONUNIQUEONVALUE_TABLE2 }\\n\u003cp\u003e                                        Index Scan ResultSet for TABLE2 using index NONUNIQUEONVALUE_TABLE2 at read committed isolation level using share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                                        Number of opens = 3\u003cbr\\/\u003e\\n                                        Rows seen = 8688\u003cbr\\/\u003e\\n                                        Rows filtered = 0\u003cbr\\/\u003e\\n                                        Fetch Size = 1\u003cbr\\/\u003e\\n                                                constructor time (milliseconds)= 0\u003cbr\\/\u003e\\n                                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                                next time in milliseconds\\/row =0\u003c\\/p\u003e\\n\\n\u003cp\u003e                                        scan information:\u003cbr\\/\u003e\\n                                                Bit set of columns fetched=\u003c\\/p\u003e\\n{1}\\n\u003cp\u003e                                                Number of columns fetched=1\u003cbr\\/\u003e\\n                                                Number of deleted rows visited=0\u003c\\/p\u003e\\n\\n\u003cp\u003e                                                Number of pages visited=12\u003cbr\\/\u003e\\n                                                Number of rows qualified=8688\u003cbr\\/\u003e\\n                                                Number of rows visited=8688\u003cbr\\/\u003e\\n                                                Scan type=btree\u003cbr\\/\u003e\\n                                                Tree height=2\u003cbr\\/\u003e\\n                                                start position:        None\u003cbr\\/\u003e\\n                                                stop position:        None\u003cbr\\/\u003e\\n                                                qualifiers:None\u003cbr\\/\u003e\\n                                                optimizer estimated row count:          0.20\u003cbr\\/\u003e\\n                                                optimizer estimated cost:  1178.38\u003c\\/p\u003e\\n\\n\\n\\n\u003cp\u003e        Right result set:\u003cbr\\/\u003e\\n                Index Scan ResultSet for TABLE1 using constraint SQL090429102526750 at read committed isolation level using share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                Number of opens = 3\u003cbr\\/\u003e\\n                Rows seen = 3\u003cbr\\/\u003e\\n                Rows filtered = 0\u003cbr\\/\u003e\\n                Fetch Size = 1\u003cbr\\/\u003e\\n                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time in milliseconds\\/row = 0\u003c\\/p\u003e\\n\\n\u003cp\u003e                scan information:\u003cbr\\/\u003e\\n                        Bit set of columns fetched=\u003c\\/p\u003e\\n{0}\\n\u003cp\u003e                        Number of columns fetched=1\u003cbr\\/\u003e\\n                        Number of deleted rows visited=0\u003cbr\\/\u003e\\n                        Number of pages visited=3\u003cbr\\/\u003e\\n                        Number of rows qualified=3\u003cbr\\/\u003e\\n                        Number of rows visited=3\u003cbr\\/\u003e\\n                        Scan type=btree\u003cbr\\/\u003e\\n                        Tree height=1\u003cbr\\/\u003e\\n                        start position:\u003cbr\\/\u003e\\n        &gt;= on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:0\u003cbr\\/\u003e\\n                        stop position:\u003cbr\\/\u003e\\n        &gt; on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:0\u003cbr\\/\u003e\\n                        qualifiers:\u003cbr\\/\u003e\\nColumn\u003cspan class=\\\"error\\\"\u003e&#91;0&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;0&#93;\u003c\\/span\u003e Id: 0\u003cbr\\/\u003e\\nOperator: =\u003cbr\\/\u003e\\nOrdered nulls: false\u003cbr\\/\u003e\\nUnknown return value: false\u003cbr\\/\u003e\\nNegate comparison result: false\u003c\\/p\u003e\\n\\n\u003cp\u003e                        optimizer estimated row count:            0.20\u003cbr\\/\u003e\\n                        optimizer estimated cost:            0.31\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12704227_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12704227_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Apr\\/09 18:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-04-29T18:12:09+0000\'\u003e29\\/Apr\\/09 18:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mamta A. Satoor - 29\\/Apr\\/09 18:32\\\"\u003eedited\u003c\\/span\u003e                   I am attaching a newer version of script3.sql The new script is called script3WithUserFriendlyIndexNames.sql The only changes made to script3.sql are to use user-friendly index names so that it is easier to understand the query which is using index names through optimizer overrides to demonstrate the buggy behavior. Hopefully it will be easier to read the query plan as well. The query to see the problem is as follows \\n\\n SELECT table1.id, table2.value, table3.value FROM --DERBY-PROPERTIES joinOrder=FIXED \\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3 \\n, table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2 \\n, table1 \\nWHERE table1.id=table2.id AND table2.name=\'PageSequenceId\'  \\nAND table1.id=table3.id  \\nAND table3.name=\'PostComponentId\'  \\nAND table3.value=\'21857\' ORDER BY table2.value; \\n\\n The query plan for the query above looks as follows \\nStatement Name: \\n        null \\nStatement Text: \\n        SELECT table1.id, table2.value, table3.value FROM --DERBY-PROPERTIES joinOrder=FIXED \\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3 \\n, table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2 \\n, table1 \\nWHERE table1.id=table2.id AND table2.name=\'PageSequenceId\' \\nAND table1.id=table3.id \\nAND table3.name=\'PostComponentId\' \\nAND table3.value=\'21857\' ORDER BY table2.value \\nParse Time: 0 \\nBind Time: 0 \\nOptimize Time: 0 \\nGenerate Time: 0 \\nCompile Time: 0 \\nExecute Time: 0 \\nBegin Compilation Timestamp : null \\nEnd Compilation Timestamp : null \\nBegin Execution Timestamp : null \\nEnd Execution Timestamp : null \\nStatement Execution Plan Text: \\nProject-Restrict ResultSet (10): \\nNumber of opens = 1 \\nRows seen = 3 \\nRows filtered = 0 \\nrestriction = false \\nprojection = true \\n        constructor time (milliseconds) = 0 \\n        open time (milliseconds) = 0 \\n        next time (milliseconds) = 0 \\n        close time (milliseconds) = 0 \\n        restriction time (milliseconds) = 0 \\n        projection time (milliseconds) = 0 \\n        optimizer estimated row count:            0.20 \\n        optimizer estimated cost:         1185.66 \\n\\n Source result set: \\n        User supplied optimizer overrides for join are  \\n{ joinOrder=FIXED } \\n        Nested Loop Exists Join ResultSet: \\n        Number of opens = 1 \\n        Rows seen from the left = 3 \\n        Rows seen from the right = 3 \\n        Rows filtered = 0 \\n        Rows returned = 3 \\n                constructor time (milliseconds) = 0 \\n                open time (milliseconds) = 0 \\n                next time (milliseconds) = 0 \\n                close time (milliseconds) = 0 \\n                optimizer estimated row count:            0.20 \\n                optimizer estimated cost:         1185.66 \\n \\n        Left result set: \\n                User supplied optimizer overrides for join are { joinOrder=FIXED }\\n                 Nested Loop Join ResultSet: \\n                Number of opens = 1 \\n                Rows seen from the left = 3 \\n                Rows seen from the right = 3 \\n                Rows filtered = 0 \\n                Rows returned = 3 \\n                        constructor time (milliseconds) = 0 \\n                        open time (milliseconds) = 0 \\n                        next time (milliseconds) = 0 \\n                        close time (milliseconds) = 0 \\n                        optimizer estimated row count:            0.20 \\n                        optimizer estimated cost:         1185.35 \\n\\n                 Left result set: \\n                        Project-Restrict ResultSet (5): \\n                        Number of opens = 1 \\n                        Rows seen = 3 \\n                        Rows filtered = 0 \\n                        restriction = true \\n                        projection = true \\n                                constructor time (milliseconds) = 0 \\n                                open time (milliseconds) = 0 \\n                                next time (milliseconds) = 0 \\n                                close time (milliseconds) = 0 \\n                                restriction time (milliseconds) = 0 \\n                                projection time (milliseconds) = 0 \\n                                optimizer estimated row count:            0.20 \\n                                optimizer estimated cost:            6.97 \\n\\n                         Source result set: \\n                                Index Row to Base Row ResultSet for TABLE3: \\n                                Number of opens = 1 \\n                                Rows seen = 3 \\n                                Columns accessed from heap =  \\n{0, 1, 2} \\n                                        constructor time (milliseconds) = 0 \\n                                        open time (milliseconds) = 0 \\n                                        next time (milliseconds) = 0 \\n                                        close time (milliseconds) = 0 \\n                                        optimizer estimated row count:  0.20 \\n                                        optimizer estimated cost:            6.97 \\n \\n                                        User supplied optimizer overrides on TABLE3 are { index=NONUNIQUEONVALUE_TABLE3 } \\n                                        Index Scan ResultSet for TABLE3 using index NONUNIQUEONVALUE_TABLE3 at read committed isolation level using share row locking chosen by the optimizer \\n                                        Number of opens = 1 \\n                                        Rows seen = 3 \\n                                        Rows filtered = 0 \\n                                        Fetch Size = 1 \\n                                                constructor time (milliseconds) = 0 \\n                                                open time (milliseconds) = 0 \\n                                                next time (milliseconds) = 0 \\n                                                close time (milliseconds) = 0 \\n                                                next time in milliseconds\\/row = 0 \\n \\n                                        scan information: \\n                                                Bit set of columns fetched=All \\n                                                Number of columns fetched=2 \\n                                                Number of deleted rows visited=0 \\n \\n                                                Number of pages visited=2 \\n                                                Number of rows qualified=3 \\n                                                Number of rows visited=4 \\n                                                Scan type=btree \\n                                                Tree height=-1 \\n                                                start position:        &gt;= on first 1 column(s). \\n        Ordered null semantics on the following columns: \\n \\n                                                stop position:        &gt; on first 1 column(s). \\n        Ordered null semantics on the following columns: \\n \\n                                                qualifiers:None \\n                                                optimizer estimated row count:          0.20 \\n                                                optimizer estimated cost:     6.97 \\n \\n \\n                Right result set: \\n                        Project-Restrict ResultSet (8): \\n                        Number of opens = 3 \\n                        Rows seen = 8688 \\n                        Rows filtered = 8685 \\n                        restriction = true \\n                        projection = true \\n                                constructor time (milliseconds) = 0 \\n                                open time (milliseconds) = 0 \\n                                next time (milliseconds) = 0 \\n                                close time (milliseconds) = 0 \\n                                restriction time (milliseconds) = 0 \\n                                projection time (milliseconds) = 0 \\n                                optimizer estimated row count:            0.20 \\n                                optimizer estimated cost:         1178.38 \\n \\n                        Source result set: \\n                                Index Row to Base Row ResultSet for TABLE2: \\n                                Number of opens = 3 \\n                                Rows seen = 8688 \\n                                Columns accessed from heap = {0, 1, 2}\\n                                         constructor time (milliseconds) = 0 \\n                                        open time (milliseconds) = 0 \\n                                        next time (milliseconds) = 0 \\n                                        close time (milliseconds) = 0 \\n                                        optimizer estimated row count:  0.20 \\n                                        optimizer estimated cost:         1178.38 \\n\\n                                         User supplied optimizer overrides on TABLE2 are  \\n{ index=NONUNIQUEONVALUE_TABLE2 }\\n                                         Index Scan ResultSet for TABLE2 using index NONUNIQUEONVALUE_TABLE2 at read committed isolation level using share row locking chosen by the optimizer \\n                                        Number of opens = 3 \\n                                        Rows seen = 8688 \\n                                        Rows filtered = 0 \\n                                        Fetch Size = 1 \\n                                                constructor time (milliseconds)= 0 \\n                                                open time (milliseconds) = 0 \\n                                                next time (milliseconds) = 0 \\n                                                close time (milliseconds) = 0 \\n                                                next time in milliseconds\\/row =0 \\n\\n                                         scan information: \\n                                                Bit set of columns fetched= \\n{1}\\n                                                 Number of columns fetched=1 \\n                                                Number of deleted rows visited=0 \\n\\n                                                 Number of pages visited=12 \\n                                                Number of rows qualified=8688 \\n                                                Number of rows visited=8688 \\n                                                Scan type=btree \\n                                                Tree height=2 \\n                                                start position:        None \\n                                                stop position:        None \\n                                                qualifiers:None \\n                                                optimizer estimated row count:          0.20 \\n                                                optimizer estimated cost:  1178.38 \\n\\n\\n\\n         Right result set: \\n                Index Scan ResultSet for TABLE1 using constraint SQL090429102526750 at read committed isolation level using share row locking chosen by the optimizer \\n                Number of opens = 3 \\n                Rows seen = 3 \\n                Rows filtered = 0 \\n                Fetch Size = 1 \\n                        constructor time (milliseconds) = 0 \\n                        open time (milliseconds) = 0 \\n                        next time (milliseconds) = 0 \\n                        close time (milliseconds) = 0 \\n                        next time in milliseconds\\/row = 0 \\n\\n                 scan information: \\n                        Bit set of columns fetched= \\n{0}\\n                         Number of columns fetched=1 \\n                        Number of deleted rows visited=0 \\n                        Number of pages visited=3 \\n                        Number of rows qualified=3 \\n                        Number of rows visited=3 \\n                        Scan type=btree \\n                        Tree height=1 \\n                        start position: \\n        &gt;= on first 1 column(s). \\n        Ordered null semantics on the following columns:0 \\n                        stop position: \\n        &gt; on first 1 column(s). \\n        Ordered null semantics on the following columns:0 \\n                        qualifiers: \\nColumn &#91;0&#93;  &#91;0&#93;  Id: 0 \\nOperator: = \\nOrdered nulls: false \\nUnknown return value: false \\nNegate comparison result: false \\n\\n                         optimizer estimated row count:            0.20 \\n                        optimizer estimated cost:            0.31              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12705646\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12705646&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12705646\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12705646_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12705646_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/09 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-04T16:55:38+0000\'\u003e04\\/May\\/09 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mamta A. Satoor - 04\\/May\\/09 20:38\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI went through the optimize phase through the debugger and it appears to me (I may be wrong and would appreciate others looking at my detail analysis of the optimize phase below) that the problem may be with the generate phase or the execute phase where we may be not using the non-unique index on table2 correctly to fetch the orders in row.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe query in question is as below\u003cbr\\/\u003e\\nSELECT table1.id, table2.value, table3.value FROM --DERBY-PROPERTIES joinOrder=FIXED\u003cbr\\/\u003e\\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3\u003cbr\\/\u003e\\n, table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2\u003cbr\\/\u003e\\n, table1\u003cbr\\/\u003e\\nWHERE table1.id=table2.id AND table2.name=\'PageSequenceId\' \u003cbr\\/\u003e\\nAND table1.id=table3.id \u003cbr\\/\u003e\\nAND table3.name=\'PostComponentId\' \u003cbr\\/\u003e\\nAND table3.value=\'21857\' ORDER BY table2.value;\u003c\\/p\u003e\\n\\n\u003cp\u003eFor the query above, in addition to the predicates supplied by the user, optimizer internally generates another predicate, namely, table3.id=table2.id\u003cbr\\/\u003e\\nSo for the queyr, all the predicates are as follows\u003cbr\\/\u003e\\n1)table1.id=table2.id \u003cbr\\/\u003e\\n2)table1.id=table3.id \u003cbr\\/\u003e\\n3)table3.id=table2.id\u003cbr\\/\u003e\\n4)table2.name=\'PageSequenceId\' \u003cbr\\/\u003e\\n5)table3.name=\'PostComponentId\' \u003cbr\\/\u003e\\n6)table3.value=\'21857\' \u003c\\/p\u003e\\n\\n\u003cp\u003eOf the predicates above, 4), 5) and 6) can be pushed down to the corresponding optimizables ie 4) will be associated with table2 and 5),6) will be associated with table3. This is because these predicates are constant comparison with columns. This leaves us with 3 predicates, namely 1), 2), 3)\u003cbr\\/\u003e\\nwhich are multitable join predicates.\u003c\\/p\u003e\\n\\n\u003cp\u003eOptimizer has a class called RowOrdering associated with it (OptimizerImpl.currentRowOrdering). \u003cbr\\/\u003e\\ncurrentRowOrdering has following fields in it.\u003cbr\\/\u003e\\ncurrentRowOrdering\\tRowOrderingImpl  \u003cbr\\/\u003e\\n\\talwaysOrderedOptimizables\\tVector&lt;E&gt;\u003cbr\\/\u003e\\n\\tcolumnsAlwaysOrdered\\tColumnOrdering\u003cbr\\/\u003e\\n\\tcurrentColumnOrdering\\tnull\\t\u003cbr\\/\u003e\\n\\tordering\\tVector&lt;E&gt;  \u003cbr\\/\u003e\\n\\tunorderedOptimizables\\tVector&lt;E&gt;  \u003cbr\\/\u003e\\nAll the predicates that are constant comparison will go into columnsAlwaysOrdered. These pushing of constant comparison predicates happen per optimizable basis when that particular optimizable is being consdiered in the possible join order combination.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn our specific query, through optimizer overrides, we have instructed optimizer to only consider join order \u003cspan class=\\\"error\\\"\u003e&#91;table3, table2, table1&#93;\u003c\\/span\u003e. The optimizer starts with \u003cspan class=\\\"error\\\"\u003e&#91;table3, -1, -1&#93;\u003c\\/span\u003e. First thing it does is it goes through the join predicates (which are 1), 2) and 3) in the predicate list above). But since\u003cbr\\/\u003e\\nall the referenced tables for any of the 3 predicates are not covered by the current join order of \u003cspan class=\\\"error\\\"\u003e&#91;table3, -1, -1&#93;\u003c\\/span\u003e, nothing gets done to those join predicates. Next, the optimizer will tell \u003cbr\\/\u003e\\ncurrentRowOrdering to (this happens in FromBaseTable(FromTable).tellRowOrderingAboutConstantColumns(RowOrdering, OptimizablePredicateList) line: 1477) to add predicates 5) and 6) from above list into it\'s columnsAlwaysOrdered list. So, at the end of the\u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;table3, -1, -1&#93;\u003c\\/span\u003e, currentRowOrdering.columnsAlwaysOrdered will look as follows \u003cbr\\/\u003e\\nDirection: 3 Table 0, Column 3 Table 0, Column 2\u003cbr\\/\u003e\\nWe are saying above that Table at position 0 (which is Table3 in our eg) has column 3(value) and column 2(name) which are always ordered because they are being compared with constants. So far, the logic for currentRowOrdering seems to be working fine. Next, we have asked the optimizer to use the index index=nonUniqueOnValue_Table3 on Table3. This index covers the predicate 6) since that predicate is on the same column on which the index is created but it does not cover the other columns from table3 that are being referenced in this query (which table3.id and table3.name). Because of this, we determine that the index being considered is not a covering index. The code to determine whether the sorting can be avoided for \u003cspan class=\\\"error\\\"\u003e&#91;table3, -1, -1&#93;\u003c\\/span\u003e, is in OrderByList.sortRequired(RowOrdering, JBitSet) method. Since order by is on table2.value, the order by column\'s table does not match with table3 and hecne we determine that sorting is not required based on what optimizer has seen so far. So it appears that we leave it to table2 when its turn comes in the join order to decide whether sorting should indeed be avoided or not.\u003c\\/p\u003e\\n\\n\u003cp\u003eNext we consider the join order \u003cspan class=\\\"error\\\"\u003e&#91;table3, table2, -1&#93;\u003c\\/span\u003e. For table2, we have asked the optimizer to use index=nonUniqueOnValue_Table2. First thing that we do is go through the join predicates 1), 2) and 3). Predicate number 3) which is TABLE3.ID = TABLE2.ID can be pushed down to optimizable table2 because the current join order \u003cspan class=\\\"error\\\"\u003e&#91;table3, table2, -1&#93;\u003c\\/span\u003e includes the tables referenced by predicate 3). So, at this point, there are 2 predicates pushed down to table3, they are number 5) and 6). And for table2, there are 2 prdicates pushed down to it, they are number 3) and 4). Also, since predicate 4) is a constant comparison, it will get added to currentRowOrdering. At this point, currentRowOrdering.columnsAlwaysOrdered will look as folows\u003cbr\\/\u003e\\nDirection: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2\u003cbr\\/\u003e\\nWe are saying above that Table at position 0 (which is Table3 in our eg) has column 3(value) and column 2(name) which are always ordered because they are being compared with constants. In addition, Table at position 1(which is Table2 in our join order) has column 2 which is always ordered because it is being compared with constant. Next, we have asked the optimizer to use the index nonUniqueOnValue_Table2 but it does not cover the constant comparison predicate 4) since that predicate is on column name and not value. Notice, this is a different code path we are following for table2 compared to table3 above. Because table3.value is not already an ordered column in currentRowOrdering because there is no\u003cbr\\/\u003e\\nconstant comparison predicate on it, we add it to the \\\"ordering \\\" vector in currentOrdering object. This is the first object that gets added to the currentRowOrdering.\\\"ordering\\\" vector in our eg. So, at this point, the currentRowOrdering has only 3 of it\'s fields propulated and they are as follows\u003cbr\\/\u003e\\ncolumnsAlwaysOrdered\\tColumnOrdering\u003cbr\\/\u003e\\n\\tDirection: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2\u003cbr\\/\u003e\\ncurrentColumnOrdering\\tColumnOrdering \u003cbr\\/\u003e\\n\\tDirection: 1 Table 1, Column 3\u003cbr\\/\u003e\\nordering\\tVector&lt;E&gt;  \u003cbr\\/\u003e\\n\\t\u003cspan class=\\\"error\\\"\u003e&#91;Direction: 1 Table 1, Column 3&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nThe index nonUniqueOnValue_Table2 does not cover any predicate on Table2 and it does not cover all the column from table2 that are being referenced in this query and hence it is not a covering index. Next, the code to determine whether sort can be avoided for join order \u003cspan class=\\\"error\\\"\u003e&#91;table3, table2, -1&#93;\u003c\\/span\u003e, we go through the code path in OrderByList.sortRequired(RowOrdering, JBitSet) method. We find that the order by column\'s table matches with table2 in join order. Because of this match, we need to look at currentRowOrdering to see if it will take care of the sorting and if so we can avoid the sort. To look into currentRowOrdering, we first call currentRowOrdering.alwaysOrdered(cr.getTableNumber()) (in this call, cr is the order by column). So, we are checking if table2 is always ordered in currentRowOrdering. Since table2 is not always ordered in this query, this check returns false. Next, we check if not the entire table, is the order by table.order by column combination always ordered in currentRowOrdering. In our query, that will be table2.value Since there is no constant comparison predicate on table2.value, it is not going to be in columnsAlwaysOrdered vector in currentRowOrdering.\u003cbr\\/\u003e\\nFor reference, currentRowOrdering looks as follws\u003cbr\\/\u003e\\ncolumnsAlwaysOrdered\\tColumnOrdering\u003cbr\\/\u003e\\n\\tDirection: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2\u003cbr\\/\u003e\\ncurrentColumnOrdering\\tColumnOrdering \u003cbr\\/\u003e\\n\\tDirection: 1 Table 1, Column 3\u003cbr\\/\u003e\\nordering\\tVector&lt;E&gt;  \u003cbr\\/\u003e\\n\\t\u003cspan class=\\\"error\\\"\u003e&#91;Direction: 1 Table 1, Column 3&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nAs we can see from currentRowOrdering object above, columnsAlwaysOrdered does not include Table 1, Column 3. So, we have not found table2 to be always ordered and we have not found table2.value to be always ordered either. The last place to check is the ordering vector in columnsAlwaysOrdered. This vector does include Table 1, Column 3 which is table2.value and hence we determine that sorting is not needed to table2. All this code of checking the columnsAlwaysOrdered happens in OrderByList.sortRequired(RowOrdering, JBitSet). Assuming that this code is working as intended, I think then the culprit might be when we generate the code. The only step in optimize left is to add table1 to the join order. So, at the end of the optimize phase, the join order will look as follows \u003cspan class=\\\"error\\\"\u003e&#91;table3, table2, table1&#93;\u003c\\/span\u003e and currentRowOrdering looks as follows\u003cbr\\/\u003e\\ncolumnsAlwaysOrdered\\tColumnOrdering\u003cbr\\/\u003e\\n\\tDirection: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2\u003cbr\\/\u003e\\ncurrentColumnOrdering\\tColumnOrdering \u003cbr\\/\u003e\\n\\tDirection: 1 Table 2, Column 1\u003cbr\\/\u003e\\nordering\\tVector&lt;E&gt;  \u003cbr\\/\u003e\\n\\t\u003cspan class=\\\"error\\\"\u003e&#91;Direction: 1 Table 1, Column 3, Direction: 1 Table 2, Column 1&#93;\u003c\\/span\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThe only change to currentRowOrdering that is caused by adding of table1 in third join order position is that we are going to use primary key on table1 and hence we need to reflect that in currentRowOrdering by adding it to the ordering vector.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12705646_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12705646_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/09 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-04T16:55:38+0000\'\u003e04\\/May\\/09 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mamta A. Satoor - 04\\/May\\/09 20:38\\\"\u003eedited\u003c\\/span\u003e                   I went through the optimize phase through the debugger and it appears to me (I may be wrong and would appreciate others looking at my detail analysis of the optimize phase below) that the problem may be with the generate phase or the execute phase where we may be not using the non-unique index on table2 correctly to fetch the orders in row. \\n\\n The query in question is as below \\nSELECT table1.id, table2.value, table3.value FROM --DERBY-PROPERTIES joinOrder=FIXED \\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3 \\n, table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2 \\n, table1 \\nWHERE table1.id=table2.id AND table2.name=\'PageSequenceId\'  \\nAND table1.id=table3.id  \\nAND table3.name=\'PostComponentId\'  \\nAND table3.value=\'21857\' ORDER BY table2.value; \\n\\n For the query above, in addition to the predicates supplied by the user, optimizer internally generates another predicate, namely, table3.id=table2.id \\nSo for the queyr, all the predicates are as follows \\n1)table1.id=table2.id  \\n2)table1.id=table3.id  \\n3)table3.id=table2.id \\n4)table2.name=\'PageSequenceId\'  \\n5)table3.name=\'PostComponentId\'  \\n6)table3.value=\'21857\'  \\n\\n Of the predicates above, 4), 5) and 6) can be pushed down to the corresponding optimizables ie 4) will be associated with table2 and 5),6) will be associated with table3. This is because these predicates are constant comparison with columns. This leaves us with 3 predicates, namely 1), 2), 3) \\nwhich are multitable join predicates. \\n\\n Optimizer has a class called RowOrdering associated with it (OptimizerImpl.currentRowOrdering).  \\ncurrentRowOrdering has following fields in it. \\ncurrentRowOrdering\\tRowOrderingImpl   \\n\\talwaysOrderedOptimizables\\tVector&lt;E&gt; \\n\\tcolumnsAlwaysOrdered\\tColumnOrdering \\n\\tcurrentColumnOrdering\\tnull\\t \\n\\tordering\\tVector&lt;E&gt;   \\n\\tunorderedOptimizables\\tVector&lt;E&gt;   \\nAll the predicates that are constant comparison will go into columnsAlwaysOrdered. These pushing of constant comparison predicates happen per optimizable basis when that particular optimizable is being consdiered in the possible join order combination. \\n\\n In our specific query, through optimizer overrides, we have instructed optimizer to only consider join order  &#91;table3, table2, table1&#93; . The optimizer starts with  &#91;table3, -1, -1&#93; . First thing it does is it goes through the join predicates (which are 1), 2) and 3) in the predicate list above). But since \\nall the referenced tables for any of the 3 predicates are not covered by the current join order of  &#91;table3, -1, -1&#93; , nothing gets done to those join predicates. Next, the optimizer will tell  \\ncurrentRowOrdering to (this happens in FromBaseTable(FromTable).tellRowOrderingAboutConstantColumns(RowOrdering, OptimizablePredicateList) line: 1477) to add predicates 5) and 6) from above list into it\'s columnsAlwaysOrdered list. So, at the end of the \\n &#91;table3, -1, -1&#93; , currentRowOrdering.columnsAlwaysOrdered will look as follows  \\nDirection: 3 Table 0, Column 3 Table 0, Column 2 \\nWe are saying above that Table at position 0 (which is Table3 in our eg) has column 3(value) and column 2(name) which are always ordered because they are being compared with constants. So far, the logic for currentRowOrdering seems to be working fine. Next, we have asked the optimizer to use the index index=nonUniqueOnValue_Table3 on Table3. This index covers the predicate 6) since that predicate is on the same column on which the index is created but it does not cover the other columns from table3 that are being referenced in this query (which table3.id and table3.name). Because of this, we determine that the index being considered is not a covering index. The code to determine whether the sorting can be avoided for  &#91;table3, -1, -1&#93; , is in OrderByList.sortRequired(RowOrdering, JBitSet) method. Since order by is on table2.value, the order by column\'s table does not match with table3 and hecne we determine that sorting is not required based on what optimizer has seen so far. So it appears that we leave it to table2 when its turn comes in the join order to decide whether sorting should indeed be avoided or not. \\n\\n Next we consider the join order  &#91;table3, table2, -1&#93; . For table2, we have asked the optimizer to use index=nonUniqueOnValue_Table2. First thing that we do is go through the join predicates 1), 2) and 3). Predicate number 3) which is TABLE3.ID = TABLE2.ID can be pushed down to optimizable table2 because the current join order  &#91;table3, table2, -1&#93;  includes the tables referenced by predicate 3). So, at this point, there are 2 predicates pushed down to table3, they are number 5) and 6). And for table2, there are 2 prdicates pushed down to it, they are number 3) and 4). Also, since predicate 4) is a constant comparison, it will get added to currentRowOrdering. At this point, currentRowOrdering.columnsAlwaysOrdered will look as folows \\nDirection: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2 \\nWe are saying above that Table at position 0 (which is Table3 in our eg) has column 3(value) and column 2(name) which are always ordered because they are being compared with constants. In addition, Table at position 1(which is Table2 in our join order) has column 2 which is always ordered because it is being compared with constant. Next, we have asked the optimizer to use the index nonUniqueOnValue_Table2 but it does not cover the constant comparison predicate 4) since that predicate is on column name and not value. Notice, this is a different code path we are following for table2 compared to table3 above. Because table3.value is not already an ordered column in currentRowOrdering because there is no \\nconstant comparison predicate on it, we add it to the \\\"ordering \\\" vector in currentOrdering object. This is the first object that gets added to the currentRowOrdering.\\\"ordering\\\" vector in our eg. So, at this point, the currentRowOrdering has only 3 of it\'s fields propulated and they are as follows \\ncolumnsAlwaysOrdered\\tColumnOrdering \\n\\tDirection: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2 \\ncurrentColumnOrdering\\tColumnOrdering  \\n\\tDirection: 1 Table 1, Column 3 \\nordering\\tVector&lt;E&gt;   \\n\\t &#91;Direction: 1 Table 1, Column 3&#93;  \\nThe index nonUniqueOnValue_Table2 does not cover any predicate on Table2 and it does not cover all the column from table2 that are being referenced in this query and hence it is not a covering index. Next, the code to determine whether sort can be avoided for join order  &#91;table3, table2, -1&#93; , we go through the code path in OrderByList.sortRequired(RowOrdering, JBitSet) method. We find that the order by column\'s table matches with table2 in join order. Because of this match, we need to look at currentRowOrdering to see if it will take care of the sorting and if so we can avoid the sort. To look into currentRowOrdering, we first call currentRowOrdering.alwaysOrdered(cr.getTableNumber()) (in this call, cr is the order by column). So, we are checking if table2 is always ordered in currentRowOrdering. Since table2 is not always ordered in this query, this check returns false. Next, we check if not the entire table, is the order by table.order by column combination always ordered in currentRowOrdering. In our query, that will be table2.value Since there is no constant comparison predicate on table2.value, it is not going to be in columnsAlwaysOrdered vector in currentRowOrdering. \\nFor reference, currentRowOrdering looks as follws \\ncolumnsAlwaysOrdered\\tColumnOrdering \\n\\tDirection: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2 \\ncurrentColumnOrdering\\tColumnOrdering  \\n\\tDirection: 1 Table 1, Column 3 \\nordering\\tVector&lt;E&gt;   \\n\\t &#91;Direction: 1 Table 1, Column 3&#93;  \\nAs we can see from currentRowOrdering object above, columnsAlwaysOrdered does not include Table 1, Column 3. So, we have not found table2 to be always ordered and we have not found table2.value to be always ordered either. The last place to check is the ordering vector in columnsAlwaysOrdered. This vector does include Table 1, Column 3 which is table2.value and hence we determine that sorting is not needed to table2. All this code of checking the columnsAlwaysOrdered happens in OrderByList.sortRequired(RowOrdering, JBitSet). Assuming that this code is working as intended, I think then the culprit might be when we generate the code. The only step in optimize left is to add table1 to the join order. So, at the end of the optimize phase, the join order will look as follows  &#91;table3, table2, table1&#93;  and currentRowOrdering looks as follows \\ncolumnsAlwaysOrdered\\tColumnOrdering \\n\\tDirection: 3 Table 0, Column 3 Table 0, Column 2 Table 1, Column 2 \\ncurrentColumnOrdering\\tColumnOrdering  \\n\\tDirection: 1 Table 2, Column 1 \\nordering\\tVector&lt;E&gt;   \\n\\t &#91;Direction: 1 Table 1, Column 3, Direction: 1 Table 2, Column 1&#93;  \\n\\n The only change to currentRowOrdering that is caused by adding of table1 in third join order position is that we are going to use primary key on table1 and hence we need to reflect that in currentRowOrdering by adding it to the ordering vector.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12705719\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12705719&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12705719\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12705719_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12705719_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/09 20:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-04T20:01:48+0000\'\u003e04\\/May\\/09 20:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLet me know if I am understanding what is going on.\u003cbr\\/\u003e\\nTo me what looks like is happening is that the optimizer is looking\u003cbr\\/\u003e\\nat each of the join nodes and says the following:\u003cbr\\/\u003e\\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3 :\u003cbr\\/\u003e\\n    always ordered because we only get rows where table3.value = 21857\u003cbr\\/\u003e\\n    but note that it is a non-unique key so multiple rows can come back.\u003c\\/p\u003e\\n\\n\u003cp\u003etable2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2\u003cbr\\/\u003e\\n    here it see\'s that an index scan on table2 will return keys in table2.valu\u003cbr\\/\u003e\\n    order.\u003c\\/p\u003e\\n\\n\u003cp\u003eNow it seems like the optimizer is saying that since table3 is always ordered\u003cbr\\/\u003e\\nthat it can then consider the result set to be solely ordered on\u003cbr\\/\u003e\\ntable2.value.  This would be a correct assumption if table3 returned a single\u003cbr\\/\u003e\\nrow, but not correct when it returns multiple rows.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the bug case it looks to me like table3 returns 3 rows where\u003cbr\\/\u003e\\ntable3.value = 21857.\u003c\\/p\u003e\\n\\n\u003cp\u003etable3.id  | table3.value\u003cbr\\/\u003e\\n----------------------------------------------\u003cbr\\/\u003e\\n2147483653 |21857\u003cbr\\/\u003e\\n2147483654 |21857\u003cbr\\/\u003e\\n4294967297 |21857\u003c\\/p\u003e\\n\\n\u003cp\u003eNow the next part of the join has been forced to use\u003cbr\\/\u003e\\ntable2.nonUniqueOnValue_Table2, which is not useful other than providing\u003cbr\\/\u003e\\nsorted access, so it turns into a table scan. The key is that it turns\u003cbr\\/\u003e\\ninto 3 table scans, searching for table3.id=table2.id leading to:\u003c\\/p\u003e\\n\\n\u003cp\u003eID         |table2.VALUE |VALUE\u003cbr\\/\u003e\\n----------------------------------------------\u003cbr\\/\u003e\\n2147483653 |000002       |21857\u003cbr\\/\u003e\\n2147483654 |000003       |21857\u003cbr\\/\u003e\\n4294967297 |000001       |21857\u003c\\/p\u003e\\n\\n\u003cp\u003eThe code does THREE full scan using the index and thus the rows are not\u003cbr\\/\u003e\\nordered by table2.value.  So even though we are using a key that should give\u003cbr\\/\u003e\\nus the correct sorted order on table2.value, we are traversing it more than\u003cbr\\/\u003e\\nonce so it does not matter.  If the probes had been done using a single\u003cbr\\/\u003e\\nscan with something like where (id = 2147483653 or 2147483654 or 4294967297)\u003cbr\\/\u003e\\nit would have been sorted correctly, but that is not how joins work.\u003c\\/p\u003e\\n\\n\u003cp\u003eI believe the execution code is doing the right thing.   It seems to me that\u003cbr\\/\u003e\\nthe optimizer code is incorrectly using the \\\"always sorted information\\\"\u003cbr\\/\u003e\\nincorrectly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12705719_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12705719_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/09 20:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-04T20:01:48+0000\'\u003e04\\/May\\/09 20:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Let me know if I am understanding what is going on. \\nTo me what looks like is happening is that the optimizer is looking \\nat each of the join nodes and says the following: \\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3 : \\n    always ordered because we only get rows where table3.value = 21857 \\n    but note that it is a non-unique key so multiple rows can come back. \\n\\n table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2 \\n    here it see\'s that an index scan on table2 will return keys in table2.valu \\n    order. \\n\\n Now it seems like the optimizer is saying that since table3 is always ordered \\nthat it can then consider the result set to be solely ordered on \\ntable2.value.  This would be a correct assumption if table3 returned a single \\nrow, but not correct when it returns multiple rows. \\n\\n In the bug case it looks to me like table3 returns 3 rows where \\ntable3.value = 21857. \\n\\n table3.id  | table3.value \\n---------------------------------------------- \\n2147483653 |21857 \\n2147483654 |21857 \\n4294967297 |21857 \\n\\n Now the next part of the join has been forced to use \\ntable2.nonUniqueOnValue_Table2, which is not useful other than providing \\nsorted access, so it turns into a table scan. The key is that it turns \\ninto 3 table scans, searching for table3.id=table2.id leading to: \\n\\n ID         |table2.VALUE |VALUE \\n---------------------------------------------- \\n2147483653 |000002       |21857 \\n2147483654 |000003       |21857 \\n4294967297 |000001       |21857 \\n\\n The code does THREE full scan using the index and thus the rows are not \\nordered by table2.value.  So even though we are using a key that should give \\nus the correct sorted order on table2.value, we are traversing it more than \\nonce so it does not matter.  If the probes had been done using a single \\nscan with something like where (id = 2147483653 or 2147483654 or 4294967297) \\nit would have been sorted correctly, but that is not how joins work. \\n\\n I believe the execution code is doing the right thing.   It seems to me that \\nthe optimizer code is incorrectly using the \\\"always sorted information\\\" \\nincorrectly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12705726\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12705726&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12705726\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12705726_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12705726_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/09 20:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-04T20:24:17+0000\'\u003e04\\/May\\/09 20:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMike, thanks for your time on this jira. Yes, your understanding of my description is correct. I think the key here is that the outer table(table3) is returning more than one row and each one of those row is requiring us to look at the middle table (table2) which results into 3 scans on table2. So even though, table2.value has index on it, it is not helping in this case because of 3 different scans on table2. If it were just one scan on table2, then the index table2.value would have returned the rows to us in proper order. The 3 different scans would require a sorting on them to return the rows in sorted order.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12705726_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12705726_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/09 20:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-04T20:24:17+0000\'\u003e04\\/May\\/09 20:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mike, thanks for your time on this jira. Yes, your understanding of my description is correct. I think the key here is that the outer table(table3) is returning more than one row and each one of those row is requiring us to look at the middle table (table2) which results into 3 scans on table2. So even though, table2.value has index on it, it is not helping in this case because of 3 different scans on table2. If it were just one scan on table2, then the index table2.value would have returned the rows to us in proper order. The 3 different scans would require a sorting on them to return the rows in sorted order.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12706497\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12706497&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12706497\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12706497_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12706497_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/09 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-06T16:28:30+0000\'\u003e06\\/May\\/09 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching another SQL file, d3926_repro.sql, which reproduces the problem (for me) with a simpler set of tables and data.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis repro was motivated by the observation made by Mike and re-iterated by Mamta, namely:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; the key here is that the outer table(table3) is returning more than one row and\u003cbr\\/\u003e\\n&gt; each one of those row is requiring us to look at the middle table (table2) which\u003cbr\\/\u003e\\n&gt; results into 3 scans on table2 \u003c\\/p\u003e\\n\\n\u003cp\u003ePut differently, the outer table is the one which is \\\"driving\\\" the iteration because a) each row from the outer table leads to a scan on the middle table, and b) the optimizer determines that no sort is necessary.  Thus the order of the result is based solely on the order of the rows that are retrieved from the outer table.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome observations about what was necessary to get this particular repro to work:\u003c\\/p\u003e\\n\\n\u003cp\u003e  1) The outer table (T1) has a non-unique index on column I1, and we force the optimizer to use that non-unique index.\u003c\\/p\u003e\\n\\n\u003cp\u003e      Why? If the optimizer were to use a table scan for T1 then we would check to see if T1 was a \\\"oneRowResultSet\\\", which it isn\'t (and can\'t be, since we need T1 to return multiple rows in order to satisfy observation 3 below).  Since it\'s not a one-row result set T1 would then get added to the list of \\\"unordered optimizables\\\" for the join order--and if that list has at least one optimizable in it, we would end up doing an explicit sort and thus the problem would not repro.  So the plan for T1 must use an index.\u003c\\/p\u003e\\n\\n\u003cp\u003e  2) There is a predicate in the WHERE clause which compares the non-unique indexed column T1.I1 to a CONSTANT expression.\u003c\\/p\u003e\\n\\n\u003cp\u003e      Why? If such a predicate did not exist then T1.I1 would be added as the first column in the \\\"rowOrdering\\\" for the join order.  Then when the optimizer adds the middle table (T2) to the join order, it would see that the index for T2 does \u003cb\u003enot\u003c\\/b\u003e satisfy the ordering requirement of T1.I1, which means we would end up doing an explicit sort for the whole plan.  So the problem would not repro.  By adding a predicate to compare T1.I1 with a constant, we effectively make T1.I1 \\\"always ordered\\\" and so we do not need to add it to the row ordering.\u003c\\/p\u003e\\n\\n\u003cp\u003e  3) The outer table (T1) has multiple rows which have the same value for the indexed column T1.I1.\u003c\\/p\u003e\\n\\n\u003cp\u003e      Why? The presence of multiple rows is important because that\'s what leads to multiple scans on the middle table (as pointed out by Mike and Mamta).  So we need to have a predicate which compares to a fixed constant value (observation 2), but we also need that predicate to return multiple rows.  Thus there must be multiple rows in T1 which have I1 column values that equal the constant value used in the predicate.  (This is why the index for T1 must be non-unique.)\u003c\\/p\u003e\\n\\n\u003cp\u003e  4) The middle table (T2) has an index that is ordered the same way as the ORDER BY clause.  We force the optimizer to use that index for T2.\u003c\\/p\u003e\\n\\n\u003cp\u003e      Why? If the optimizer is using an index that satisfies the ordering requirement for the query, it will try to avoid sorting the resultant rows.  Sort avoidance is key to reproducing the reported behavior--esp. the optimizer \u003cb\u003ethinks\u003c\\/b\u003e it can avoid the sort, and does so, but in truth it should \u003cb\u003enot\u003c\\/b\u003e have done so.\u003c\\/p\u003e\\n\\n\u003cp\u003e  5) The index for T2 is not covering--and esp. it does \u003cb\u003enot\u003c\\/b\u003e include the column T2.I2 that is used for joining with the outer table.\u003c\\/p\u003e\\n\\n\u003cp\u003e      Why? The fact that the index is non-covering means that we will have to go to the T2 table conglomerate to fetch the row that has the current join value--and access to the table conglomerate is \u003cem\u003eunordered\u003c\\/em\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003e  6)  The column from T1 (outer table) that is joined with T2 (middle table) has varied values for each of the rows.\u003c\\/p\u003e\\n\\n\u003cp\u003e      Why? The presence of different values in T1.J1 means that we will scan T2\'s table conglomerate multiple times for different T2.I2 values, and since the table conglomerate is unordered (observation 5), those multiple scans will return the rows in an order that does \u003cb\u003enot\u003c\\/b\u003e match the index order.\u003c\\/p\u003e\\n\\n\u003cp\u003e  7) The rows that are inserted into T2 are inserted in an order that does NOT match the ORDER BY ordering.\u003c\\/p\u003e\\n\\n\u003cp\u003e      Why? It appears that, when inserting rows into a table, the order of the rows in the base table conglomerate generally matches the insertion order.  I don\'t think there are any guarantees of that, but that\'s what I observed for this simple data.  So if we were to insert the rows in proper order, access to the base table conglomerate (observations 5 &amp; 6) might in fact return the rows in the desired order by accident, which would hide the problem that we\'re trying to reproduce.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith all of those observations in place, I was able to write the attached script to reproduce the problem for me.  The results I see when I run are:\u003c\\/p\u003e\\n\\n\u003cp\u003eJ1         |J2  |J3\u003cbr\\/\u003e\\n---------------------------\u003cbr\\/\u003e\\n0          |f   |five\u003cbr\\/\u003e\\n1          |g   |six\u003cbr\\/\u003e\\n2          |e   |four\u003c\\/p\u003e\\n\\n\u003cp\u003ebut the query specifies \\\"ORDER BY t2.j2\\\", so the rows are in the wrong order.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would be great if others could try to run the script to make sure they see the same behavior (if not, then some or all of this comment may in fact be wrong or incomplete...).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12706497_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12706497_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/09 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-06T16:28:30+0000\'\u003e06\\/May\\/09 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching another SQL file, d3926_repro.sql, which reproduces the problem (for me) with a simpler set of tables and data. \\n\\n This repro was motivated by the observation made by Mike and re-iterated by Mamta, namely: \\n\\n &gt; the key here is that the outer table(table3) is returning more than one row and \\n&gt; each one of those row is requiring us to look at the middle table (table2) which \\n&gt; results into 3 scans on table2  \\n\\n Put differently, the outer table is the one which is \\\"driving\\\" the iteration because a) each row from the outer table leads to a scan on the middle table, and b) the optimizer determines that no sort is necessary.  Thus the order of the result is based solely on the order of the rows that are retrieved from the outer table. \\n\\n Some observations about what was necessary to get this particular repro to work: \\n\\n   1) The outer table (T1) has a non-unique index on column I1, and we force the optimizer to use that non-unique index. \\n\\n       Why? If the optimizer were to use a table scan for T1 then we would check to see if T1 was a \\\"oneRowResultSet\\\", which it isn\'t (and can\'t be, since we need T1 to return multiple rows in order to satisfy observation 3 below).  Since it\'s not a one-row result set T1 would then get added to the list of \\\"unordered optimizables\\\" for the join order--and if that list has at least one optimizable in it, we would end up doing an explicit sort and thus the problem would not repro.  So the plan for T1 must use an index. \\n\\n   2) There is a predicate in the WHERE clause which compares the non-unique indexed column T1.I1 to a CONSTANT expression. \\n\\n       Why? If such a predicate did not exist then T1.I1 would be added as the first column in the \\\"rowOrdering\\\" for the join order.  Then when the optimizer adds the middle table (T2) to the join order, it would see that the index for T2 does  not  satisfy the ordering requirement of T1.I1, which means we would end up doing an explicit sort for the whole plan.  So the problem would not repro.  By adding a predicate to compare T1.I1 with a constant, we effectively make T1.I1 \\\"always ordered\\\" and so we do not need to add it to the row ordering. \\n\\n   3) The outer table (T1) has multiple rows which have the same value for the indexed column T1.I1. \\n\\n       Why? The presence of multiple rows is important because that\'s what leads to multiple scans on the middle table (as pointed out by Mike and Mamta).  So we need to have a predicate which compares to a fixed constant value (observation 2), but we also need that predicate to return multiple rows.  Thus there must be multiple rows in T1 which have I1 column values that equal the constant value used in the predicate.  (This is why the index for T1 must be non-unique.) \\n\\n   4) The middle table (T2) has an index that is ordered the same way as the ORDER BY clause.  We force the optimizer to use that index for T2. \\n\\n       Why? If the optimizer is using an index that satisfies the ordering requirement for the query, it will try to avoid sorting the resultant rows.  Sort avoidance is key to reproducing the reported behavior--esp. the optimizer  thinks  it can avoid the sort, and does so, but in truth it should  not  have done so. \\n\\n   5) The index for T2 is not covering--and esp. it does  not  include the column T2.I2 that is used for joining with the outer table. \\n\\n       Why? The fact that the index is non-covering means that we will have to go to the T2 table conglomerate to fetch the row that has the current join value--and access to the table conglomerate is  unordered . \\n\\n   6)  The column from T1 (outer table) that is joined with T2 (middle table) has varied values for each of the rows. \\n\\n       Why? The presence of different values in T1.J1 means that we will scan T2\'s table conglomerate multiple times for different T2.I2 values, and since the table conglomerate is unordered (observation 5), those multiple scans will return the rows in an order that does  not  match the index order. \\n\\n   7) The rows that are inserted into T2 are inserted in an order that does NOT match the ORDER BY ordering. \\n\\n       Why? It appears that, when inserting rows into a table, the order of the rows in the base table conglomerate generally matches the insertion order.  I don\'t think there are any guarantees of that, but that\'s what I observed for this simple data.  So if we were to insert the rows in proper order, access to the base table conglomerate (observations 5 &amp; 6) might in fact return the rows in the desired order by accident, which would hide the problem that we\'re trying to reproduce. \\n\\n With all of those observations in place, I was able to write the attached script to reproduce the problem for me.  The results I see when I run are: \\n\\n J1         |J2  |J3 \\n--------------------------- \\n0          |f   |five \\n1          |g   |six \\n2          |e   |four \\n\\n but the query specifies \\\"ORDER BY t2.j2\\\", so the rows are in the wrong order. \\n\\n It would be great if others could try to run the script to make sure they see the same behavior (if not, then some or all of this comment may in fact be wrong or incomplete...).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12706509\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12706509&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12706509\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12706509_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12706509_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/09 16:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-06T16:48:39+0000\'\u003e06\\/May\\/09 16:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eArmy, I tried your much simpler repro and it reproduces the problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12706509_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12706509_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/09 16:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-06T16:48:39+0000\'\u003e06\\/May\\/09 16:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Army, I tried your much simpler repro and it reproduces the problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12707021\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12707021&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12707021\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12707021_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12707021_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/May\\/09 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-07T18:13:13+0000\'\u003e07\\/May\\/09 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt appears that we need to catch the case where an optimizable is not the outermost node and optimizer is considering using an index on that optimizable (the index is on the order by column) and there is no constant comparison predicate on that column. This pretty much makes the index of no use but say the optimizer has been forced to use that index through optimizer overrides (ie what we have done in our test queries in this jira). If the outer tables in the join order are all one-row resultset, then it is not an issues because we will be doing only one scan on the optimizable in question and all the rows returned for that optimizable will be sorted on the index being considered on optimizable. The problem case is when there are outer optimizable involved and the outer optimizables will qualify more than one row which will be returned for them and for each one of those rows, we will be doing a scan on the optimizable in question and hence the rows satisfied through multiple scans of the optimizable in question will not be in any sorted order. To fix this, I am planning on adding additional code in OptimizerImpl.costBasedCostOptimizable after the following existing if statement at line 2239\u003cbr\\/\u003e\\nif (joinPosition == 0 ||  optimizableList.getOptimizable(proposedJoinOrder\u003cspan class=\\\"error\\\"\u003e&#91;joinPosition - 1&#93;\u003c\\/span\u003e).considerSortAvoidancePath())\u003cbr\\/\u003e\\nFollowing is the psudeo code of what I am planning on adding\u003cbr\\/\u003e\\nif (joinPosition != 0) \\/\\/if we are the outermost optimizable, we are good to go.\u003cbr\\/\u003e\\n{\u003cbr\\/\u003e\\n    if (optimizable.currentPlanUsingIndex() &amp;&amp; optimizable.indexOnOrderByColumn() &amp;&amp; optimizable.noConstantPredicateOnIndexColumn())\u003cbr\\/\u003e\\n        Sorting can\'t be avoided on this optimizable\u003cbr\\/\u003e\\n    else\u003c\\/p\u003e\\n    {\\n        Continue with the existing code which is \\n        if (requiredRowOrdering.sortRequired(currentRowOrdering,assignedTableMap) == RequiredRowOrdering.NOTHING_REQUIRED)\\n        ................... \\n    }\\n\u003cp\u003e}\u003c\\/p\u003e\\n\\n\u003cp\u003eI will try to implement this psedo code. Let me know if anyone has any comments if this does not look like a good possible solution.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12707021_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12707021_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/May\\/09 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-07T18:13:13+0000\'\u003e07\\/May\\/09 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It appears that we need to catch the case where an optimizable is not the outermost node and optimizer is considering using an index on that optimizable (the index is on the order by column) and there is no constant comparison predicate on that column. This pretty much makes the index of no use but say the optimizer has been forced to use that index through optimizer overrides (ie what we have done in our test queries in this jira). If the outer tables in the join order are all one-row resultset, then it is not an issues because we will be doing only one scan on the optimizable in question and all the rows returned for that optimizable will be sorted on the index being considered on optimizable. The problem case is when there are outer optimizable involved and the outer optimizables will qualify more than one row which will be returned for them and for each one of those rows, we will be doing a scan on the optimizable in question and hence the rows satisfied through multiple scans of the optimizable in question will not be in any sorted order. To fix this, I am planning on adding additional code in OptimizerImpl.costBasedCostOptimizable after the following existing if statement at line 2239 \\nif (joinPosition == 0 ||  optimizableList.getOptimizable(proposedJoinOrder &#91;joinPosition - 1&#93; ).considerSortAvoidancePath()) \\nFollowing is the psudeo code of what I am planning on adding \\nif (joinPosition != 0) \\/\\/if we are the outermost optimizable, we are good to go. \\n{ \\n    if (optimizable.currentPlanUsingIndex() &amp;&amp; optimizable.indexOnOrderByColumn() &amp;&amp; optimizable.noConstantPredicateOnIndexColumn()) \\n        Sorting can\'t be avoided on this optimizable \\n    else \\n    {\\n        Continue with the existing code which is \\n        if (requiredRowOrdering.sortRequired(currentRowOrdering,assignedTableMap) == RequiredRowOrdering.NOTHING_REQUIRED)\\n        ................... \\n    }\\n } \\n\\n I will try to implement this psedo code. Let me know if anyone has any comments if this does not look like a good possible solution.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12707045\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12707045&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12707045\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12707045_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12707045_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/May\\/09 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-07T19:06:05+0000\'\u003e07\\/May\\/09 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI was expecting a fix like the following, maybe I don\'t understand the code path that you\u003cbr\\/\u003e\\nare proposing.  The key point seems to be whether the other optimizables in the join order which have been marked\u003cbr\\/\u003e\\n\\\"already sorted\\\" are single row result sets or not.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think the issue is whether a \\\"useful\\\" index is being used or not.  Even a useful index\u003cbr\\/\u003e\\nin the middle of a join may result in multiple probes.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo was expecting something like:\u003c\\/p\u003e\\n\\n\u003cp\u003eif (not outer most join)\u003cbr\\/\u003e\\n    if (all previous join nodes which have been marked already sorted are single row result sets)\u003cbr\\/\u003e\\n        consider sort avoidance on the current join node\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12707045_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12707045_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/May\\/09 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-07T19:06:05+0000\'\u003e07\\/May\\/09 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I was expecting a fix like the following, maybe I don\'t understand the code path that you \\nare proposing.  The key point seems to be whether the other optimizables in the join order which have been marked \\n\\\"already sorted\\\" are single row result sets or not. \\n\\n I don\'t think the issue is whether a \\\"useful\\\" index is being used or not.  Even a useful index \\nin the middle of a join may result in multiple probes. \\n\\n So was expecting something like: \\n\\n if (not outer most join) \\n    if (all previous join nodes which have been marked already sorted are single row result sets) \\n        consider sort avoidance on the current join node \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12707215\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12707215&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12707215\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12707215_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12707215_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/May\\/09 02:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-08T02:47:19+0000\'\u003e08\\/May\\/09 02:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSorry, I don\'t know how but I missed the crucial logic for checking one row resultset on previous optimizables. \u003c\\/p\u003e\\n\\n\u003cp\u003eHere is my new pseudo code for handling the check to see if we are going to consider a new order by column and that column does not have a constant predicate on it. Before it can decide to do sort avoidance, It needs to make sure that previous optimizables do not return more than one row.\u003c\\/p\u003e\\n\\n\u003cp\u003eif (joinPosition != 0) { \u003cbr\\/\u003e\\n    if (optimizable.addingNewOrderByColumn() &amp;&amp; optimizable.doesNotHaveConstantPredOnOrderByColumn())\u003cbr\\/\u003e\\n    \u003c\\/p\u003e\\n{\\n\\tif (previousOptimizablesAreAllSingleRow()) \\n\\t        consider sort avoidanve (by running the current code)\\n    \\telse\\n                             Sorting can\'t be avoided on this optimizable \\n    }\\n\u003cp\u003e else\u003cbr\\/\u003e\\n\\t        consider sort avoidanve (by running the current code)\u003cbr\\/\u003e\\n}\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12707215_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12707215_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/May\\/09 02:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-08T02:47:19+0000\'\u003e08\\/May\\/09 02:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Sorry, I don\'t know how but I missed the crucial logic for checking one row resultset on previous optimizables.  \\n\\n Here is my new pseudo code for handling the check to see if we are going to consider a new order by column and that column does not have a constant predicate on it. Before it can decide to do sort avoidance, It needs to make sure that previous optimizables do not return more than one row. \\n\\n if (joinPosition != 0) {  \\n    if (optimizable.addingNewOrderByColumn() &amp;&amp; optimizable.doesNotHaveConstantPredOnOrderByColumn()) \\n     \\n{\\n\\tif (previousOptimizablesAreAllSingleRow()) \\n\\t        consider sort avoidanve (by running the current code)\\n    \\telse\\n                             Sorting can\'t be avoided on this optimizable \\n    }\\n  else \\n\\t        consider sort avoidanve (by running the current code) \\n}              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12708117\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12708117&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12708117\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12708117_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12708117_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/09 17:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-11T17:25:32+0000\'\u003e11\\/May\\/09 17:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have attached a patch (not intended for checkin) DERBY3926_notforcheckin_patch1_051109_diff.txt based on the pseudocode that I posted last week. It fixes the problem query in question but when I run wisconsin test, I see that now we are adding sort nodes on top of few queries. I am trying to understand if it makes sense for us to have the additional sort node case by case. The first case I am looking at seems like should not get a sort node when the patch is choosing to add one. The query for that case is as follows\u003cbr\\/\u003e\\n\\tselect * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1;\u003c\\/p\u003e\\n\\n\u003cp\u003eThe query plan for the above query shows tektup1 to be the outermost query so I am not sure why we need the sort node on the top. I will look further into it. If anyone has time to look at the patch, I will greatly appreciate it. There are no comments(minimal) for the new code. I will work on adding some comments and repost the patch to make it easier to read but the code should correspond fairly straightforward to the psuedo code posted last week.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe old query plan for the query above from wisconsin is as follows\u003cbr\\/\u003e\\nij&gt; values SYSCS_UTIL.SYSCS_GET_RUNTIMESTATISTICS();\u003cbr\\/\u003e\\n1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \u003cbr\\/\u003e\\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\u003cbr\\/\u003e\\nStatement Name: \u003cbr\\/\u003e\\n\\tC\u003cbr\\/\u003e\\nStatement Text: \u003cbr\\/\u003e\\n\\tselect * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n\\t order by TENKTUP1.unique1\u003cbr\\/\u003e\\nParse Time: 0\u003cbr\\/\u003e\\nBind Time: 0\u003cbr\\/\u003e\\nOptimize Time: 0\u003cbr\\/\u003e\\nGenerate Time: 0\u003cbr\\/\u003e\\nCompile Time: 0\u003cbr\\/\u003e\\nExecute Time: 0\u003cbr\\/\u003e\\nBegin Compilation Timestamp : null\u003cbr\\/\u003e\\nEnd Compilation Timestamp : null\u003cbr\\/\u003e\\nBegin Execution Timestamp : null\u003cbr\\/\u003e\\nEnd Execution Timestamp : null\u003cbr\\/\u003e\\nStatement Execution Plan Text: \u003cbr\\/\u003e\\nNested Loop Exists Join ResultSet:\u003cbr\\/\u003e\\n&lt;filtered number of opens&gt;\u003cbr\\/\u003e\\n&lt;filtered rows seen from the left&gt;\u003cbr\\/\u003e\\n&lt;filtered rows seen from the right&gt;\u003cbr\\/\u003e\\nRows filtered = 0\u003cbr\\/\u003e\\n&lt;filtered rows returned&gt;\u003cbr\\/\u003e\\n\\tconstructor time (milliseconds) = 0\u003cbr\\/\u003e\\n\\topen time (milliseconds) = 0\u003cbr\\/\u003e\\n\\tnext time (milliseconds) = 0\u003cbr\\/\u003e\\n\\tclose time (milliseconds) = 0\u003cbr\\/\u003e\\nLeft result set:\u003cbr\\/\u003e\\n\\tIndex Row to Base Row ResultSet for TENKTUP1:\u003cbr\\/\u003e\\n\\t&lt;filtered number of opens&gt;\u003cbr\\/\u003e\\n\\t&lt;filtered rows seen&gt;\u003cbr\\/\u003e\\n\\tColumns accessed from heap = \u003c\\/p\u003e\\n{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}\\n\u003cp\u003e\\t\\tconstructor time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\topen time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\tnext time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\tclose time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\tIndex Scan ResultSet for TENKTUP1 using index TK1UNIQUE1 at serializable isolation level using share table locking chosen by the optimizer\u003cbr\\/\u003e\\n\\t\\t&lt;filtered number of opens&gt;\u003cbr\\/\u003e\\n\\t\\t&lt;filtered rows seen&gt;\u003cbr\\/\u003e\\n\\t\\tRows filtered = 0\u003cbr\\/\u003e\\n\\t\\tFetch Size = 1\u003cbr\\/\u003e\\n\\t\\t\\tconstructor time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\t\\topen time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\t\\tnext time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\t\\tclose time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\tscan information: \u003cbr\\/\u003e\\n\\t\\t\\tBit set of columns fetched=\u003c\\/p\u003e\\n{1}\\n\u003cp\u003e\\t\\t\\tNumber of columns fetched=1\u003cbr\\/\u003e\\n\\t\\t\\tNumber of deleted rows visited=0\u003cbr\\/\u003e\\n\\t\\t\\t&lt;filtered number of pages visited&gt;\u003cbr\\/\u003e\\n\\t\\t\\t&lt;filtered number of rows qualified&gt;\u003cbr\\/\u003e\\n\\t\\t\\t&lt;filtered number of rows visited&gt;\u003cbr\\/\u003e\\n\\t\\t\\tScan type=btree\u003cbr\\/\u003e\\n\\t\\t\\tTree height=2\u003cbr\\/\u003e\\n\\t\\t\\tstart position: \\tNone\u003cbr\\/\u003e\\n\\t\\t\\tstop position: \\tNone\u003cbr\\/\u003e\\n\\t\\t\\tqualifiers:None\u003cbr\\/\u003e\\nRight result set:\u003cbr\\/\u003e\\n\\tIndex Row to Base Row ResultSet for TENKTUP2:\u003cbr\\/\u003e\\n\\t&lt;filtered number of opens&gt;\u003cbr\\/\u003e\\n\\t&lt;filtered rows seen&gt;\u003cbr\\/\u003e\\n\\tColumns accessed from heap = \u003c\\/p\u003e\\n{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}\u003cbr\\/\u003e\\n\\t\\tconstructor time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\topen time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\tnext time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\tclose time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\tIndex Scan ResultSet for TENKTUP2 using index TK2UNIQUE1 at serializable isolation level using share row locking chosen by the optimizer\u003cbr\\/\u003e\\n\\t\\t&lt;filtered number of opens&gt;\u003cbr\\/\u003e\\n\\t\\t&lt;filtered rows seen&gt;\u003cbr\\/\u003e\\n\\t\\tRows filtered = 0\u003cbr\\/\u003e\\n\\t\\tFetch Size = 1\u003cbr\\/\u003e\\n\\t\\t\\tconstructor time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\t\\topen time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\t\\tnext time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\t\\tclose time (milliseconds) = 0\u003cbr\\/\u003e\\n\\t\\tscan information: \u003cbr\\/\u003e\\n\\t\\t\\tBit set of columns fetched=All\u003cbr\\/\u003e\\n\\t\\t\\tNumber of columns fetched=2\u003cbr\\/\u003e\\n\\t\\t\\tNumber of deleted rows visited=0\u003cbr\\/\u003e\\n\\t\\t\\t&lt;filtered number of pages visited&gt;\u003cbr\\/\u003e\\n\\t\\t\\t&lt;filtered number of rows qualified&gt;\u003cbr\\/\u003e\\n\\t\\t\\t&lt;filtered number of rows visited&gt;\u003cbr\\/\u003e\\n\\t\\t\\tScan type=btree\u003cbr\\/\u003e\\n\\t\\t\\tTree height=2\u003cbr\\/\u003e\\n\\t\\t\\tstart position: \u003cbr\\/\u003e\\n\\t&gt;= on first 1 column(s).\u003cbr\\/\u003e\\n\\tOrdered null semantics on the following columns: 0 \u003cbr\\/\u003e\\n\\t\\t\\tstop position: \u003cbr\\/\u003e\\n\\t&gt; on first 1 column(s).\u003cbr\\/\u003e\\n\\tOrdered null semantics on the following columns: 0 \u003cbr\\/\u003e\\n\\t\\t\\tqualifiers:None\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nThe new query plan after my changes is as follows\u003cbr\\/\u003e\\nij&gt; values SYSCS_UTIL.SYSCS_GET_RUNTIMESTATISTICS();\u003cbr\\/\u003e\\n1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \u003cbr\\/\u003e\\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\u003cbr\\/\u003e\\nStatement Name:\u003cbr\\/\u003e\\n        null\u003cbr\\/\u003e\\nStatement Text:\u003cbr\\/\u003e\\n        select * from TENKTUP1, TENKTUP2\u003cbr\\/\u003e\\n         where TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\n         order by TENKTUP1.unique1\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nParse Time: 0\u003cbr\\/\u003e\\nBind Time: 0\u003cbr\\/\u003e\\nOptimize Time: 0\u003cbr\\/\u003e\\nGenerate Time: 0\u003cbr\\/\u003e\\nCompile Time: 0\u003cbr\\/\u003e\\nExecute Time: 0\u003cbr\\/\u003e\\nBegin Compilation Timestamp : null\u003cbr\\/\u003e\\nEnd Compilation Timestamp : null\u003cbr\\/\u003e\\nBegin Execution Timestamp : null\u003cbr\\/\u003e\\nEnd Execution Timestamp : null\u003cbr\\/\u003e\\nStatement Execution Plan Text:\u003cbr\\/\u003e\\nSort ResultSet:\u003cbr\\/\u003e\\nNumber of opens = 1\u003cbr\\/\u003e\\nRows input = 10000\u003cbr\\/\u003e\\nRows returned = 10000\u003cbr\\/\u003e\\nEliminate duplicates = false\u003cbr\\/\u003e\\nIn sorted order = false\u003cbr\\/\u003e\\nSort information:\u003cbr\\/\u003e\\n        Number of merge runs=3\u003cbr\\/\u003e\\n        Number of rows input=10000\u003cbr\\/\u003e\\n        Number of rows output=10000\u003cbr\\/\u003e\\n        Size of merge runs=\u003cspan class=\\\"error\\\"\u003e&#91;3215, 3215, 3215&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\n        Sort type=external\u003cbr\\/\u003e\\n        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n        open time (milliseconds) = 0\u003cbr\\/\u003e\\n        next time (milliseconds) = 0\u003cbr\\/\u003e\\n        close time (milliseconds) = 0\u003cbr\\/\u003e\\n        optimizer estimated row count:        10005.00\u003cbr\\/\u003e\\n        optimizer estimated cost:        73930.40\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nSource result set:\u003cbr\\/\u003e\\n        Nested Loop Exists Join ResultSet:\u003cbr\\/\u003e\\n        Number of opens = 1\u003cbr\\/\u003e\\n        Rows seen from the left = 10000\u003cbr\\/\u003e\\n        Rows seen from the right = 10000\u003cbr\\/\u003e\\n        Rows filtered = 0\u003cbr\\/\u003e\\n        Rows returned = 10000\u003cbr\\/\u003e\\n                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                optimizer estimated row count:        10005.00\u003cbr\\/\u003e\\n                optimizer estimated cost:        73930.40\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n        Left result set:\u003cbr\\/\u003e\\n                Table Scan ResultSet for TENKTUP1 at read committed isolation level using instantaneous share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                Number of opens = 1\u003cbr\\/\u003e\\n                Rows seen = 10000\u003cbr\\/\u003e\\n                Rows filtered = 0\u003cbr\\/\u003e\\n                Fetch Size = 16\u003cbr\\/\u003e\\n                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time in milliseconds\\/row = 0\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n                scan information:\u003cbr\\/\u003e\\n                        Bit set of columns fetched=All\u003cbr\\/\u003e\\n                        Number of columns fetched=16\u003cbr\\/\u003e\\n                        Number of pages visited=771\u003cbr\\/\u003e\\n                        Number of rows qualified=10000\u003cbr\\/\u003e\\n                        Number of rows visited=10000\u003cbr\\/\u003e\\n                        Scan type=heap\u003cbr\\/\u003e\\n                        start position:null                    \u003cbr\\/\u003e\\n                        stop position:null                    \u003cbr\\/\u003e\\n                        qualifiers:None\u003cbr\\/\u003e\\n                        optimizer estimated row count:        10005.00\u003cbr\\/\u003e\\n                        optimizer estimated cost:        14870.88\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n        Right result set:\u003cbr\\/\u003e\\n                Index Row to Base Row ResultSet for TENKTUP2:\u003cbr\\/\u003e\\n                Number of opens = 10000\u003cbr\\/\u003e\\n                Rows seen = 10000\u003cbr\\/\u003e\\n                Columns accessed from heap = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}\\n\u003cp\u003e                        constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                        open time (milliseconds) = 0\u003cbr\\/\u003e\\n                        next time (milliseconds) = 0\u003cbr\\/\u003e\\n                        close time (milliseconds) = 0\u003cbr\\/\u003e\\n                        optimizer estimated row count:        10005.00\u003cbr\\/\u003e\\n                        optimizer estimated cost:        59059.52\u003c\\/p\u003e\\n\\n\u003cp\u003e                        Index Scan ResultSet for TENKTUP2 using index TK2UNIQUE1 at read committed isolation level using share row locking chosen by the optimizer\u003cbr\\/\u003e\\n                        Number of opens = 10000\u003cbr\\/\u003e\\n                        Rows seen = 10000\u003cbr\\/\u003e\\n                        Rows filtered = 0\u003cbr\\/\u003e\\n                        Fetch Size = 1\u003cbr\\/\u003e\\n                                constructor time (milliseconds) = 0\u003cbr\\/\u003e\\n                                open time (milliseconds) = 0\u003cbr\\/\u003e\\n                                next time (milliseconds) = 0\u003cbr\\/\u003e\\n                                close time (milliseconds) = 0\u003cbr\\/\u003e\\n                                next time in milliseconds\\/row = 0\u003c\\/p\u003e\\n\\n\u003cp\u003e                        scan information:\u003cbr\\/\u003e\\n                                Bit set of columns fetched=All\u003cbr\\/\u003e\\n                                Number of columns fetched=2\u003cbr\\/\u003e\\n                                Number of deleted rows visited=0\u003cbr\\/\u003e\\n                                Number of pages visited=20000\u003cbr\\/\u003e\\n                                Number of rows qualified=10000\u003cbr\\/\u003e\\n                                Number of rows visited=10000\u003cbr\\/\u003e\\n                                Scan type=btree\u003cbr\\/\u003e\\n                                Tree height=2\u003cbr\\/\u003e\\n                                start position:\u003cbr\\/\u003e\\n        &gt;= on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:0\u003cbr\\/\u003e\\n                                stop position:\u003cbr\\/\u003e\\n        &gt; on first 1 column(s).\u003cbr\\/\u003e\\n        Ordered null semantics on the following columns:0\u003cbr\\/\u003e\\n                                qualifiers:None\u003cbr\\/\u003e\\n                                optimizer estimated row count:        10005.00\u003cbr\\/\u003e\\n                                optimizer estimated cost:        59059.52\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12708117_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12708117_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/09 17:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-11T17:25:32+0000\'\u003e11\\/May\\/09 17:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have attached a patch (not intended for checkin) DERBY3926_notforcheckin_patch1_051109_diff.txt based on the pseudocode that I posted last week. It fixes the problem query in question but when I run wisconsin test, I see that now we are adding sort nodes on top of few queries. I am trying to understand if it makes sense for us to have the additional sort node case by case. The first case I am looking at seems like should not get a sort node when the patch is choosing to add one. The query for that case is as follows \\n\\tselect * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t order by TENKTUP1.unique1; \\n\\n The query plan for the above query shows tektup1 to be the outermost query so I am not sure why we need the sort node on the top. I will look further into it. If anyone has time to look at the patch, I will greatly appreciate it. There are no comments(minimal) for the new code. I will work on adding some comments and repost the patch to make it easier to read but the code should correspond fairly straightforward to the psuedo code posted last week. \\n\\n The old query plan for the query above from wisconsin is as follows \\nij&gt; values SYSCS_UTIL.SYSCS_GET_RUNTIMESTATISTICS(); \\n1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \\nStatement Name:  \\n\\tC \\nStatement Text:  \\n\\tselect * from TENKTUP1, TENKTUP2 \\n\\t where TENKTUP1.unique1 = TENKTUP2.unique1 \\n\\t order by TENKTUP1.unique1 \\nParse Time: 0 \\nBind Time: 0 \\nOptimize Time: 0 \\nGenerate Time: 0 \\nCompile Time: 0 \\nExecute Time: 0 \\nBegin Compilation Timestamp : null \\nEnd Compilation Timestamp : null \\nBegin Execution Timestamp : null \\nEnd Execution Timestamp : null \\nStatement Execution Plan Text:  \\nNested Loop Exists Join ResultSet: \\n&lt;filtered number of opens&gt; \\n&lt;filtered rows seen from the left&gt; \\n&lt;filtered rows seen from the right&gt; \\nRows filtered = 0 \\n&lt;filtered rows returned&gt; \\n\\tconstructor time (milliseconds) = 0 \\n\\topen time (milliseconds) = 0 \\n\\tnext time (milliseconds) = 0 \\n\\tclose time (milliseconds) = 0 \\nLeft result set: \\n\\tIndex Row to Base Row ResultSet for TENKTUP1: \\n\\t&lt;filtered number of opens&gt; \\n\\t&lt;filtered rows seen&gt; \\n\\tColumns accessed from heap =  \\n{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}\\n \\t\\tconstructor time (milliseconds) = 0 \\n\\t\\topen time (milliseconds) = 0 \\n\\t\\tnext time (milliseconds) = 0 \\n\\t\\tclose time (milliseconds) = 0 \\n\\t\\tIndex Scan ResultSet for TENKTUP1 using index TK1UNIQUE1 at serializable isolation level using share table locking chosen by the optimizer \\n\\t\\t&lt;filtered number of opens&gt; \\n\\t\\t&lt;filtered rows seen&gt; \\n\\t\\tRows filtered = 0 \\n\\t\\tFetch Size = 1 \\n\\t\\t\\tconstructor time (milliseconds) = 0 \\n\\t\\t\\topen time (milliseconds) = 0 \\n\\t\\t\\tnext time (milliseconds) = 0 \\n\\t\\t\\tclose time (milliseconds) = 0 \\n\\t\\tscan information:  \\n\\t\\t\\tBit set of columns fetched= \\n{1}\\n \\t\\t\\tNumber of columns fetched=1 \\n\\t\\t\\tNumber of deleted rows visited=0 \\n\\t\\t\\t&lt;filtered number of pages visited&gt; \\n\\t\\t\\t&lt;filtered number of rows qualified&gt; \\n\\t\\t\\t&lt;filtered number of rows visited&gt; \\n\\t\\t\\tScan type=btree \\n\\t\\t\\tTree height=2 \\n\\t\\t\\tstart position: \\tNone \\n\\t\\t\\tstop position: \\tNone \\n\\t\\t\\tqualifiers:None \\nRight result set: \\n\\tIndex Row to Base Row ResultSet for TENKTUP2: \\n\\t&lt;filtered number of opens&gt; \\n\\t&lt;filtered rows seen&gt; \\n\\tColumns accessed from heap =  \\n{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15} \\n\\t\\tconstructor time (milliseconds) = 0 \\n\\t\\topen time (milliseconds) = 0 \\n\\t\\tnext time (milliseconds) = 0 \\n\\t\\tclose time (milliseconds) = 0 \\n\\t\\tIndex Scan ResultSet for TENKTUP2 using index TK2UNIQUE1 at serializable isolation level using share row locking chosen by the optimizer \\n\\t\\t&lt;filtered number of opens&gt; \\n\\t\\t&lt;filtered rows seen&gt; \\n\\t\\tRows filtered = 0 \\n\\t\\tFetch Size = 1 \\n\\t\\t\\tconstructor time (milliseconds) = 0 \\n\\t\\t\\topen time (milliseconds) = 0 \\n\\t\\t\\tnext time (milliseconds) = 0 \\n\\t\\t\\tclose time (milliseconds) = 0 \\n\\t\\tscan information:  \\n\\t\\t\\tBit set of columns fetched=All \\n\\t\\t\\tNumber of columns fetched=2 \\n\\t\\t\\tNumber of deleted rows visited=0 \\n\\t\\t\\t&lt;filtered number of pages visited&gt; \\n\\t\\t\\t&lt;filtered number of rows qualified&gt; \\n\\t\\t\\t&lt;filtered number of rows visited&gt; \\n\\t\\t\\tScan type=btree \\n\\t\\t\\tTree height=2 \\n\\t\\t\\tstart position:  \\n\\t&gt;= on first 1 column(s). \\n\\tOrdered null semantics on the following columns: 0  \\n\\t\\t\\tstop position:  \\n\\t&gt; on first 1 column(s). \\n\\tOrdered null semantics on the following columns: 0  \\n\\t\\t\\tqualifiers:None \\n \\n \\n \\nThe new query plan after my changes is as follows \\nij&gt; values SYSCS_UTIL.SYSCS_GET_RUNTIMESTATISTICS(); \\n1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \\nStatement Name: \\n        null \\nStatement Text: \\n        select * from TENKTUP1, TENKTUP2 \\n         where TENKTUP1.unique1 = TENKTUP2.unique1 \\n         order by TENKTUP1.unique1 \\n \\nParse Time: 0 \\nBind Time: 0 \\nOptimize Time: 0 \\nGenerate Time: 0 \\nCompile Time: 0 \\nExecute Time: 0 \\nBegin Compilation Timestamp : null \\nEnd Compilation Timestamp : null \\nBegin Execution Timestamp : null \\nEnd Execution Timestamp : null \\nStatement Execution Plan Text: \\nSort ResultSet: \\nNumber of opens = 1 \\nRows input = 10000 \\nRows returned = 10000 \\nEliminate duplicates = false \\nIn sorted order = false \\nSort information: \\n        Number of merge runs=3 \\n        Number of rows input=10000 \\n        Number of rows output=10000 \\n        Size of merge runs= &#91;3215, 3215, 3215&#93;  \\n        Sort type=external \\n        constructor time (milliseconds) = 0 \\n        open time (milliseconds) = 0 \\n        next time (milliseconds) = 0 \\n        close time (milliseconds) = 0 \\n        optimizer estimated row count:        10005.00 \\n        optimizer estimated cost:        73930.40 \\n \\nSource result set: \\n        Nested Loop Exists Join ResultSet: \\n        Number of opens = 1 \\n        Rows seen from the left = 10000 \\n        Rows seen from the right = 10000 \\n        Rows filtered = 0 \\n        Rows returned = 10000 \\n                constructor time (milliseconds) = 0 \\n                open time (milliseconds) = 0 \\n                next time (milliseconds) = 0 \\n                close time (milliseconds) = 0 \\n                optimizer estimated row count:        10005.00 \\n                optimizer estimated cost:        73930.40 \\n \\n        Left result set: \\n                Table Scan ResultSet for TENKTUP1 at read committed isolation level using instantaneous share row locking chosen by the optimizer \\n                Number of opens = 1 \\n                Rows seen = 10000 \\n                Rows filtered = 0 \\n                Fetch Size = 16 \\n                        constructor time (milliseconds) = 0 \\n                        open time (milliseconds) = 0 \\n                        next time (milliseconds) = 0 \\n                        close time (milliseconds) = 0 \\n                        next time in milliseconds\\/row = 0 \\n \\n                scan information: \\n                        Bit set of columns fetched=All \\n                        Number of columns fetched=16 \\n                        Number of pages visited=771 \\n                        Number of rows qualified=10000 \\n                        Number of rows visited=10000 \\n                        Scan type=heap \\n                        start position:null                     \\n                        stop position:null                     \\n                        qualifiers:None \\n                        optimizer estimated row count:        10005.00 \\n                        optimizer estimated cost:        14870.88 \\n \\n        Right result set: \\n                Index Row to Base Row ResultSet for TENKTUP2: \\n                Number of opens = 10000 \\n                Rows seen = 10000 \\n                Columns accessed from heap = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}\\n                         constructor time (milliseconds) = 0 \\n                        open time (milliseconds) = 0 \\n                        next time (milliseconds) = 0 \\n                        close time (milliseconds) = 0 \\n                        optimizer estimated row count:        10005.00 \\n                        optimizer estimated cost:        59059.52 \\n\\n                         Index Scan ResultSet for TENKTUP2 using index TK2UNIQUE1 at read committed isolation level using share row locking chosen by the optimizer \\n                        Number of opens = 10000 \\n                        Rows seen = 10000 \\n                        Rows filtered = 0 \\n                        Fetch Size = 1 \\n                                constructor time (milliseconds) = 0 \\n                                open time (milliseconds) = 0 \\n                                next time (milliseconds) = 0 \\n                                close time (milliseconds) = 0 \\n                                next time in milliseconds\\/row = 0 \\n\\n                         scan information: \\n                                Bit set of columns fetched=All \\n                                Number of columns fetched=2 \\n                                Number of deleted rows visited=0 \\n                                Number of pages visited=20000 \\n                                Number of rows qualified=10000 \\n                                Number of rows visited=10000 \\n                                Scan type=btree \\n                                Tree height=2 \\n                                start position: \\n        &gt;= on first 1 column(s). \\n        Ordered null semantics on the following columns:0 \\n                                stop position: \\n        &gt; on first 1 column(s). \\n        Ordered null semantics on the following columns:0 \\n                                qualifiers:None \\n                                optimizer estimated row count:        10005.00 \\n                                optimizer estimated cost:        59059.52              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12708213\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12708213&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12708213\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12708213_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12708213_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/09 20:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-11T20:51:40+0000\'\u003e11\\/May\\/09 20:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am reattaching the earlier patch with little more comments(DERBY3926_notforcheckin_patch2_051109_diff.txt)  to help understand the code for someone who might be looking at the patch. My patch is adding sort node for the query from the wisconsin test as shown below is\u003cbr\\/\u003e\\nconnect \'jdbc:derby:wombat\';\u003cbr\\/\u003e\\nselect * from tenktup1, tenktup2\u003cbr\\/\u003e\\nwhere tenktup1.unique1 = tenktup2.unique1\u003cbr\\/\u003e\\norder by tenktup1.unique1;\u003cbr\\/\u003e\\nI think the reason for the sort node might be the code below that I have added in my patch\u003cbr\\/\u003e\\nif (currentRowOrdering.orderingRequiredOnTable(optimizable.getTableNumber()))\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the if statement above, I was trying to see if the current optimizable is covering some columns from the order by and if there are constant predicates on those column. I am trying to do this by just looking at currentRowOrdering object. I think the correct code should look at both requiredRowOrdering provided by the user and current row ordering info for the current join order as collected by the optimizer in the currentRowOrdering object. I will work on fixing the if statement code above to see if it gets rid of the sort node for the query above.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12708213_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12708213_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/09 20:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-11T20:51:40+0000\'\u003e11\\/May\\/09 20:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am reattaching the earlier patch with little more comments(DERBY3926_notforcheckin_patch2_051109_diff.txt)  to help understand the code for someone who might be looking at the patch. My patch is adding sort node for the query from the wisconsin test as shown below is \\nconnect \'jdbc:derby:wombat\'; \\nselect * from tenktup1, tenktup2 \\nwhere tenktup1.unique1 = tenktup2.unique1 \\norder by tenktup1.unique1; \\nI think the reason for the sort node might be the code below that I have added in my patch \\nif (currentRowOrdering.orderingRequiredOnTable(optimizable.getTableNumber())) \\n\\n With the if statement above, I was trying to see if the current optimizable is covering some columns from the order by and if there are constant predicates on those column. I am trying to do this by just looking at currentRowOrdering object. I think the correct code should look at both requiredRowOrdering provided by the user and current row ordering info for the current join order as collected by the optimizer in the currentRowOrdering object. I will work on fixing the if statement code above to see if it gets rid of the sort node for the query above.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12708468\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12708468&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12708468\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12708468_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12708468_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/09 15:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-12T15:39:13+0000\'\u003e12\\/May\\/09 15:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy take on the most recent queryplan that you posted is that it does need a sort node as the outermost node\u003cbr\\/\u003e\\nis a tablescan, not an ordered index scan.  Having said that it seems likely that somehow your change incorrectly\u003cbr\\/\u003e\\neliminated a sort avoidance path, and then that plan was costed differently and not chosen.  To be sure you could\u003cbr\\/\u003e\\ntake the problem wisconsin query, force the old join order\\/index choice using hints and then see if your new code\u003cbr\\/\u003e\\nchooses sort avoidance.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to me the code you want to change is the path in current code where it has just chosen to add a node\u003cbr\\/\u003e\\nto the query ordering vector (not look at the ordering vector after the fact).  At the point the code is about to add\u003cbr\\/\u003e\\na node, then you want to do the checks you have in your patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12708468_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12708468_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/09 15:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-12T15:39:13+0000\'\u003e12\\/May\\/09 15:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My take on the most recent queryplan that you posted is that it does need a sort node as the outermost node \\nis a tablescan, not an ordered index scan.  Having said that it seems likely that somehow your change incorrectly \\neliminated a sort avoidance path, and then that plan was costed differently and not chosen.  To be sure you could \\ntake the problem wisconsin query, force the old join order\\/index choice using hints and then see if your new code \\nchooses sort avoidance. \\n\\n It seems to me the code you want to change is the path in current code where it has just chosen to add a node \\nto the query ordering vector (not look at the ordering vector after the fact).  At the point the code is about to add \\na node, then you want to do the checks you have in your patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12709898\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12709898&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12709898\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12709898_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12709898_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/May\\/09 16:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-15T16:36:31+0000\'\u003e15\\/May\\/09 16:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have attached a patch (DERBY3926_patch3_051509_diff.txt)  that fixes the reproducible order by query case. The problem was that when considering inner optimizable nodes that required ordering(but the user query has no constant comparison predicate(s) on those columns), we did not check if the previous optimizables all returned single rows before deciding to avoid sorting. If the previous optimizables return more than one row, then that would require multiple scans into the inner optimizable and the rows satisfied by the multiple scans may or may not be ordered as per the user query requirement. \u003c\\/p\u003e\\n\\n\u003cp\u003eThe new logic has gone into impl\\\\sql\\\\compile\\\\OptimizerImpl.java and the supporting code to determine if the current inner optimizable requires ordering on columns with no constant comparison predicates on them is in impl\\\\sql\\\\compile\\\\OrderByList.java\u003c\\/p\u003e\\n\\n\u003cp\u003eThe logic has also been explained in detail in OptimizerImpl.java I will appreciate if someone can take a look at it. I have run junit tests and derbyall. There are two failures in derbyall. One of them is for T_RawStoreFactory which I think is existing known jira issue \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3993\\\" title=\\\"With IBM 1.6 T_RawStoreFactory fails with There should be 0 observers, but we still have 1 observers on Win 2K\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3993\\\"\u003e\u003cdel\u003eDERBY-3993\u003c\\/del\u003e\u003c\\/a\u003e. The other failure is in wisconsin test. Only one sql is failing in wisconsin. That sql with some optimizer overrides looks as follows.\u003cbr\\/\u003e\\nselect * from   --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\nTENKTUP1   &#8211; DERBY-PROPERTIES index=TK1UNIQUE1\u003cbr\\/\u003e\\n, TENKTUP2  &#8211; DERBY-PROPERTIES index=TK2UNIQUE1\u003cbr\\/\u003e\\nwhere TENKTUP1.unique1 = TENKTUP2.unique1\u003cbr\\/\u003e\\norder by TENKTUP1.unique1, TENKTUP2.unique1;\u003c\\/p\u003e\\n\\n\u003cp\u003eAs the name of the columns suggest, there are unique indexes on the columns we are dealing with in the query above. With my changes in the patch, now we are requiring a sort on the top of the query plan. Prior to my changes, we were avoiding sort on this query. The reason we are requiring sort as per the new logic is - The outermost optimizable is TENKTUP1 and it is going to return more than one row. Next, we consider TENKTUP2 as the inner optimizable. We see that user has requested ordering on\u003cbr\\/\u003e\\nTENKTUP2.unique1 and there is no constant predicate on TENKTUP2.unique1 AND the previous optimizable is not one row resultset and because of these conditions, we require that sorting is necessary. I think ideally, we should be able to avoid sort because even though the previous optimizable is returning more than one row, the current optimizable has equality check with the previous optimizable (on the ordered columns) and hence even though there will be multiple scans into current optimizable, the rows will\u003cbr\\/\u003e\\nall be ordered because of the equality check. I haven\'t given this additional logic much thought. I will look more into it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12709898_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12709898_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/May\\/09 16:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-15T16:36:31+0000\'\u003e15\\/May\\/09 16:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have attached a patch (DERBY3926_patch3_051509_diff.txt)  that fixes the reproducible order by query case. The problem was that when considering inner optimizable nodes that required ordering(but the user query has no constant comparison predicate(s) on those columns), we did not check if the previous optimizables all returned single rows before deciding to avoid sorting. If the previous optimizables return more than one row, then that would require multiple scans into the inner optimizable and the rows satisfied by the multiple scans may or may not be ordered as per the user query requirement.  \\n\\n The new logic has gone into impl\\\\sql\\\\compile\\\\OptimizerImpl.java and the supporting code to determine if the current inner optimizable requires ordering on columns with no constant comparison predicates on them is in impl\\\\sql\\\\compile\\\\OrderByList.java \\n\\n The logic has also been explained in detail in OptimizerImpl.java I will appreciate if someone can take a look at it. I have run junit tests and derbyall. There are two failures in derbyall. One of them is for T_RawStoreFactory which I think is existing known jira issue   DERBY-3993  . The other failure is in wisconsin test. Only one sql is failing in wisconsin. That sql with some optimizer overrides looks as follows. \\nselect * from   --DERBY-PROPERTIES joinOrder=FIXED  \\nTENKTUP1   &#8211; DERBY-PROPERTIES index=TK1UNIQUE1 \\n, TENKTUP2  &#8211; DERBY-PROPERTIES index=TK2UNIQUE1 \\nwhere TENKTUP1.unique1 = TENKTUP2.unique1 \\norder by TENKTUP1.unique1, TENKTUP2.unique1; \\n\\n As the name of the columns suggest, there are unique indexes on the columns we are dealing with in the query above. With my changes in the patch, now we are requiring a sort on the top of the query plan. Prior to my changes, we were avoiding sort on this query. The reason we are requiring sort as per the new logic is - The outermost optimizable is TENKTUP1 and it is going to return more than one row. Next, we consider TENKTUP2 as the inner optimizable. We see that user has requested ordering on \\nTENKTUP2.unique1 and there is no constant predicate on TENKTUP2.unique1 AND the previous optimizable is not one row resultset and because of these conditions, we require that sorting is necessary. I think ideally, we should be able to avoid sort because even though the previous optimizable is returning more than one row, the current optimizable has equality check with the previous optimizable (on the ordered columns) and hence even though there will be multiple scans into current optimizable, the rows will \\nall be ordered because of the equality check. I haven\'t given this additional logic much thought. I will look more into it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12710809\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12710809&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12710809\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12710809_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12710809_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/May\\/09 17:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-19T17:43:31+0000\'\u003e19\\/May\\/09 17:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI took a look at the patch and the changes look reasonable to me. The latest version of the\u003cbr\\/\u003e\\npatch seems a bit cleaner than the previous ones, which is nice.  And I like the detailed\u003cbr\\/\u003e\\ncomments in OptimizerImpl.java \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI did notice that in the latest patch there is an \\\"if\\\" condition which is commented out.  Was\u003cbr\\/\u003e\\nthat intentional, and if so, can it (and the corresponding {} brackets) be removed entirely,\u003cbr\\/\u003e\\ninstead of just being commented out?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt might be useful if you could add a comment to indicate that the call to:\u003c\\/p\u003e\\n\\n\u003cp\u003e  currentRowOrdering.alwaysOrdered(previousOptimizable.getTableNumber())\u003c\\/p\u003e\\n\\n\u003cp\u003ewill return true if the optimizable was found to be a \\\"oneRowResultSet\\\" during costing.\u003cbr\\/\u003e\\nThat might make it more clear that the code is actually in sync with the comments which\u003cbr\\/\u003e\\nprecede it (I had to do some investigation before I could come to that conclusion).\u003c\\/p\u003e\\n\\n\u003cp\u003eYour explanation of the failure in the wisconsin test makes sense to me. Thanks so much\u003cbr\\/\u003e\\nfor your diligence with this particular issue!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12710809_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12710809_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/May\\/09 17:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-19T17:43:31+0000\'\u003e19\\/May\\/09 17:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I took a look at the patch and the changes look reasonable to me. The latest version of the \\npatch seems a bit cleaner than the previous ones, which is nice.  And I like the detailed \\ncomments in OptimizerImpl.java   \\n\\n I did notice that in the latest patch there is an \\\"if\\\" condition which is commented out.  Was \\nthat intentional, and if so, can it (and the corresponding {} brackets) be removed entirely, \\ninstead of just being commented out? \\n\\n It might be useful if you could add a comment to indicate that the call to: \\n\\n   currentRowOrdering.alwaysOrdered(previousOptimizable.getTableNumber()) \\n\\n will return true if the optimizable was found to be a \\\"oneRowResultSet\\\" during costing. \\nThat might make it more clear that the code is actually in sync with the comments which \\nprecede it (I had to do some investigation before I could come to that conclusion). \\n\\n Your explanation of the failure in the wisconsin test makes sense to me. Thanks so much \\nfor your diligence with this particular issue!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12711024\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12711024&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12711024\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12711024_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711024_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 06:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T06:17:48+0000\'\u003e20\\/May\\/09 06:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eArmy, thanks for looking at the patch. I need to remove the commented out if condition along with corresponding {} brackets. Also, I have added the comment for currentRowOrdering.alwaysOrdered(previousOptimizable.getTableNumber()) Let me know if I should reword it differently. \u003c\\/p\u003e\\n\\n\u003cp\u003eI have attached a patch with these changes and some more order by tests. That is the only difference between this patch and the earlier patch.,\u003c\\/p\u003e\\n\\n\u003cp\u003eOn another note, I was planning on moving all this new code inside the existing method OrderByList.sortRequired which gets called by OptimizerImpl. This way, all the decision regarding sort avoidance would have been made in the appropriate named method sortRequired. But the new code added by me needs access to current join order position, previous optimizables, predicate lists etc which are not available to OrderByList.sortRequired method. Passing these additional parameters to the method will require changes to other part of the Derby code where we call this method. Based on that, I am thinking that I should leave my new code where it is right now. If anyone feels differently about the location of the new code, do let me know.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe only issue with the suggested patch is that a query like following is now going to require a sort node on the top which we didn\'t require earlier. Other than this one case, all the other test cases\u003cbr\\/\u003e\\nhave worked fine with my patch. I am inclied on going ahead and committing the patch with this know one case. If I don\'t hear anything back on the patch, I will plan on comitting it towards the end of the week.\u003cbr\\/\u003e\\nselect * from --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\nTENKTUP1 &#8211; DERBY-PROPERTIES index=TK1UNIQUE1 \u003cbr\\/\u003e\\n, TENKTUP2 &#8211; DERBY-PROPERTIES index=TK2UNIQUE1 \u003cbr\\/\u003e\\nwhere TENKTUP1.unique1 = TENKTUP2.unique1 \u003cbr\\/\u003e\\norder by TENKTUP1.unique1, TENKTUP2.unique1; \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12711024_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711024_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 06:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T06:17:48+0000\'\u003e20\\/May\\/09 06:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Army, thanks for looking at the patch. I need to remove the commented out if condition along with corresponding {} brackets. Also, I have added the comment for currentRowOrdering.alwaysOrdered(previousOptimizable.getTableNumber()) Let me know if I should reword it differently.  \\n\\n I have attached a patch with these changes and some more order by tests. That is the only difference between this patch and the earlier patch., \\n\\n On another note, I was planning on moving all this new code inside the existing method OrderByList.sortRequired which gets called by OptimizerImpl. This way, all the decision regarding sort avoidance would have been made in the appropriate named method sortRequired. But the new code added by me needs access to current join order position, previous optimizables, predicate lists etc which are not available to OrderByList.sortRequired method. Passing these additional parameters to the method will require changes to other part of the Derby code where we call this method. Based on that, I am thinking that I should leave my new code where it is right now. If anyone feels differently about the location of the new code, do let me know. \\n\\n The only issue with the suggested patch is that a query like following is now going to require a sort node on the top which we didn\'t require earlier. Other than this one case, all the other test cases \\nhave worked fine with my patch. I am inclied on going ahead and committing the patch with this know one case. If I don\'t hear anything back on the patch, I will plan on comitting it towards the end of the week. \\nselect * from --DERBY-PROPERTIES joinOrder=FIXED  \\nTENKTUP1 &#8211; DERBY-PROPERTIES index=TK1UNIQUE1  \\n, TENKTUP2 &#8211; DERBY-PROPERTIES index=TK2UNIQUE1  \\nwhere TENKTUP1.unique1 = TENKTUP2.unique1  \\norder by TENKTUP1.unique1, TENKTUP2.unique1;               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12711211\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12711211&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12711211\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12711211_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711211_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T16:28:56+0000\'\u003e20\\/May\\/09 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDo you know how the current code determines that sort can be avoided in the one remaining \u003cbr\\/\u003e\\ncase?  Does it do something special with the equality condition?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12711211_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711211_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T16:28:56+0000\'\u003e20\\/May\\/09 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Do you know how the current code determines that sort can be avoided in the one remaining  \\ncase?  Does it do something special with the equality condition?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12711212\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12711212&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12711212\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12711212_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711212_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 16:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T16:37:47+0000\'\u003e20\\/May\\/09 16:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf others who know this code are ok with your patch then I am ok.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn looking at the current code I thought it would be cleaner if all the information that was \u003cbr\\/\u003e\\nnecessary to answer the question of whether the current join ordering met the current\u003cbr\\/\u003e\\norder by requirement was actually already located in the current RowOrdering object.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis would not require pushing the information down into the OrderBy.requiredOrdering()\u003cbr\\/\u003e\\ninterface.  Instead the information should already be in the RowOrdering object, so that\u003cbr\\/\u003e\\nOrderBy.sortRequired(), would be implemented as it is currently using just information\u003cbr\\/\u003e\\nfrom the RowOrdering interface.  The work here is that some more information may need\u003cbr\\/\u003e\\nto be tracked in the RowOrdering to implement the additional logic you have come up with.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12711212_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711212_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 16:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T16:37:47+0000\'\u003e20\\/May\\/09 16:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If others who know this code are ok with your patch then I am ok. \\n\\n In looking at the current code I thought it would be cleaner if all the information that was  \\nnecessary to answer the question of whether the current join ordering met the current \\norder by requirement was actually already located in the current RowOrdering object. \\n\\n This would not require pushing the information down into the OrderBy.requiredOrdering() \\ninterface.  Instead the information should already be in the RowOrdering object, so that \\nOrderBy.sortRequired(), would be implemented as it is currently using just information \\nfrom the RowOrdering interface.  The work here is that some more information may need \\nto be tracked in the RowOrdering to implement the additional logic you have come up with.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12711239\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12711239&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12711239\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12711239_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711239_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 17:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T17:17:54+0000\'\u003e20\\/May\\/09 17:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003emike&gt; I thought it would be cleaner if all the information that was necessary\u003cbr\\/\u003e\\nmike&gt; \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e was actually already located in the current RowOrdering object. \u003cbr\\/\u003e\\nmike&gt; \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e The work here is that some more information may need to be tracked\u003cbr\\/\u003e\\nmike&gt; in the RowOrdering.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor what little it\'s worth, I agree, I think this is a nice idea that would in fact be a\u003cbr\\/\u003e\\nbit cleaner.  I think the current patch is acceptable, as well, but if I had the luxury\u003cbr\\/\u003e\\nof choosing, I\'d probably go with Mike\'s approach, if possible...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12711239_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711239_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 17:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T17:17:54+0000\'\u003e20\\/May\\/09 17:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    mike&gt; I thought it would be cleaner if all the information that was necessary \\nmike&gt;  &#91;...&#93;  was actually already located in the current RowOrdering object.  \\nmike&gt;  &#91;...&#93;  The work here is that some more information may need to be tracked \\nmike&gt; in the RowOrdering. \\n\\n For what little it\'s worth, I agree, I think this is a nice idea that would in fact be a \\nbit cleaner.  I think the current patch is acceptable, as well, but if I had the luxury \\nof choosing, I\'d probably go with Mike\'s approach, if possible...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12711252\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12711252&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12711252\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12711252_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711252_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T17:42:18+0000\'\u003e20\\/May\\/09 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMike asked \\\"Do you know how the current code determines that sort can be avoided in the one remaining \u003cbr\\/\u003e\\ncase? Does it do something special with the equality condition? \\\" I do not know how the code knows about avoiding the sort in case of following query. I will spend some time understanding the code path.\u003cbr\\/\u003e\\nselect * from --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\nTENKTUP1 &#8211; DERBY-PROPERTIES index=TK1UNIQUE1 \u003cbr\\/\u003e\\n, TENKTUP2 &#8211; DERBY-PROPERTIES index=TK2UNIQUE1 \u003cbr\\/\u003e\\nwhere TENKTUP1.unique1 = TENKTUP2.unique1 \u003cbr\\/\u003e\\norder by TENKTUP1.unique1, TENKTUP2.unique1; \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12711252_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711252_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T17:42:18+0000\'\u003e20\\/May\\/09 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mike asked \\\"Do you know how the current code determines that sort can be avoided in the one remaining  \\ncase? Does it do something special with the equality condition? \\\" I do not know how the code knows about avoiding the sort in case of following query. I will spend some time understanding the code path. \\nselect * from --DERBY-PROPERTIES joinOrder=FIXED  \\nTENKTUP1 &#8211; DERBY-PROPERTIES index=TK1UNIQUE1  \\n, TENKTUP2 &#8211; DERBY-PROPERTIES index=TK2UNIQUE1  \\nwhere TENKTUP1.unique1 = TENKTUP2.unique1  \\norder by TENKTUP1.unique1, TENKTUP2.unique1;               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12711301\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12711301&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12711301\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12711301_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711301_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 19:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T19:25:33+0000\'\u003e20\\/May\\/09 19:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been following this discussion, and learning a lot! Thanks much for the careful writeups and explanations.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to me that the problem with the current Wisconsin query has to do with the precise definition of \\\"one row result set\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we go back to Mike\'s original insight some time ago, he said:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; the key here is that the outer table(table3) is returning more than one row and\u003cbr\\/\u003e\\n&gt; each one of those row is requiring us to look at the middle table (table2) which\u003cbr\\/\u003e\\n&gt; results into 3 scans on table2\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd that seems correct to me. But at some point I think we lost the \\\"AND\\\" part of Mike\'s statement\u003cbr\\/\u003e\\nwhen it was translated into the bits-and-bytes of actual code.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat is, in the Wisconsin query in question, the outer table (TENKTUP1) is returning\u003cbr\\/\u003e\\nmore than one row, \u003cb\u003ehowever\u003c\\/b\u003e each one of those rows only results in a single\u003cbr\\/\u003e\\nopen of the inner table (TENKTUP2), because the join key is unique.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis comment from the patch seems to describe the essence of the issue:\u003c\\/p\u003e\\n\\n\u003cp\u003e+\\t * ... and hence we need to make sure \u003cbr\\/\u003e\\n+\\t * that the outer predicates in the join order are all\u003cbr\\/\u003e\\n+\\t * one row optimizables meaning that they can at the\u003cbr\\/\u003e\\n+\\t * most return only one row. If they return more than\u003cbr\\/\u003e\\n+\\t * one row, then it will require multiple scans of the\u003cbr\\/\u003e\\n+\\t * current optimizable and the rows returned from\u003cbr\\/\u003e\\n+\\t * those multiple scans may not be ordered correctly.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe thing I think we need to do is to figure out some way to encode the following test:\u003c\\/p\u003e\\n\\n\u003cp\u003e   Are the outer predicates in the join such that they will require at most one scan of the current optimizable?\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the reason the Wisconsin query has changed behavior (now includes an unnecessary\u003cbr\\/\u003e\\nsort) is because the patch isn\'t quite expressing exactly this idea. Outer predicates which\u003cbr\\/\u003e\\nare \u003cb\u003enot\u003c\\/b\u003e one row result sets should still be able to perform sort avoidance plans, \u003cb\u003eas long as\u003c\\/b\u003e\u003cbr\\/\u003e\\nthe join condition will perform only a single open of the inner optimizable.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12711301_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711301_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/09 19:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-20T19:25:33+0000\'\u003e20\\/May\\/09 19:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve been following this discussion, and learning a lot! Thanks much for the careful writeups and explanations. \\n\\n It seems to me that the problem with the current Wisconsin query has to do with the precise definition of \\\"one row result set\\\". \\n\\n If we go back to Mike\'s original insight some time ago, he said: \\n\\n &gt; the key here is that the outer table(table3) is returning more than one row and \\n&gt; each one of those row is requiring us to look at the middle table (table2) which \\n&gt; results into 3 scans on table2 \\n\\n And that seems correct to me. But at some point I think we lost the \\\"AND\\\" part of Mike\'s statement \\nwhen it was translated into the bits-and-bytes of actual code. \\n\\n That is, in the Wisconsin query in question, the outer table (TENKTUP1) is returning \\nmore than one row,  however  each one of those rows only results in a single \\nopen of the inner table (TENKTUP2), because the join key is unique. \\n\\n This comment from the patch seems to describe the essence of the issue: \\n\\n +\\t * ... and hence we need to make sure  \\n+\\t * that the outer predicates in the join order are all \\n+\\t * one row optimizables meaning that they can at the \\n+\\t * most return only one row. If they return more than \\n+\\t * one row, then it will require multiple scans of the \\n+\\t * current optimizable and the rows returned from \\n+\\t * those multiple scans may not be ordered correctly. \\n\\n The thing I think we need to do is to figure out some way to encode the following test: \\n\\n    Are the outer predicates in the join such that they will require at most one scan of the current optimizable? \\n\\n I think the reason the Wisconsin query has changed behavior (now includes an unnecessary \\nsort) is because the patch isn\'t quite expressing exactly this idea. Outer predicates which \\nare  not  one row result sets should still be able to perform sort avoidance plans,  as long as  \\nthe join condition will perform only a single open of the inner optimizable.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12711781\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12711781&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12711781\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12711781_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711781_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/May\\/09 20:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-21T20:15:57+0000\'\u003e21\\/May\\/09 20:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI went through the optimizer code for following query\u003cbr\\/\u003e\\nconnect \'jdbc:derby:wombat\';\u003cbr\\/\u003e\\nselect * from --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\nTENKTUP1 &#8211; DERBY-PROPERTIES index=TK1UNIQUE1 \u003cbr\\/\u003e\\n, TENKTUP2 &#8211; DERBY-PROPERTIES index=TK2UNIQUE1 \u003cbr\\/\u003e\\nwhere TENKTUP1.unique1 = TENKTUP2.unique1 \u003cbr\\/\u003e\\norder by TENKTUP1.unique1, TENKTUP2.unique1; \u003c\\/p\u003e\\n\\n\\n\u003cp\u003eDuring the optimize phase, for an optimizable, everytime we are considering a new access path for it, we check if the conglomerate being considered for the optimizable is an index conglomerate. If yes, then we check if the current ordering for the given join order already has the index columns in it. That check is done by the following call in FromBaseTable.nextAccessPath: 478\\t\u003cbr\\/\u003e\\nif ( ! rowOrdering.orderedOnColumn(isAscending\u003cspan class=\\\"error\\\"\u003e&#91;i&#93;\u003c\\/span\u003e ? RowOrdering.ASCENDING : RowOrdering.DESCENDING,\u003cbr\\/\u003e\\n\\tgetTableNumber(), baseColumnPositions\u003cspan class=\\\"error\\\"\u003e&#91;i&#93;\u003c\\/span\u003e))\u003cbr\\/\u003e\\nThe RowOrderingImpl.orderedOnColumn:119 first checks if the optimizable we are dealing with is marked as always ordered(I think this happens if the optimizable is a one-row table). If yes, then the we will return true from RowOrderingImpl.orderedOnColumn. If not, we check if there was a predicate on the index column which makes it always ordered(line 127). If not,then we check if the column is already being ordered by checking ordering vector at line 133. If not, we go ahead and add the index column to the ordering vector in currentRowOrdering object.\u003c\\/p\u003e\\n\\n\u003cp\u003eGoing to the query above when the optimizer is going through the join order \u003cspan class=\\\"error\\\"\u003e&#91;0, -1&#93;\u003c\\/span\u003e which means it is considering TENKTUP1 at the outermost join order position and no optimizable has yet been considered in the next position yet. For TENKTUP1, we go through the above piece of code. The method RowOrderingImpl.orderedOnColumn is going to return false for the index column UNIQUE1(index TK1UNIQUE1 is on that column) because \u003cbr\\/\u003e\\na)TENKTUP1 is not always ordered meaning it is not one-row table\u003cbr\\/\u003e\\nb)there is no constant predicate on TENKTUP1.UNIQUE1\u003cbr\\/\u003e\\nc)there is no other ordering on TENKTUP1.UNIQUE1\u003c\\/p\u003e\\n\\n\u003cp\u003eSince for our query, the index column UNIQUE1 is not already ordered yet in the currentRowOrdering object, we go ahead and add it to the ordering vector inside currentRowOrdering object (this is done in FromBaseTable.nextAccessPath at line: 484 with following 2 code lines.)\u003cbr\\/\u003e\\n\\trowOrdering.nextOrderPosition(isAscending\u003cspan class=\\\"error\\\"\u003e&#91;i&#93;\u003c\\/span\u003e ? RowOrdering.ASCENDING : RowOrdering.DESCENDING);\u003cbr\\/\u003e\\n\\trowOrdering.addOrderedColumn(isAscending\u003cspan class=\\\"error\\\"\u003e&#91;i&#93;\u003c\\/span\u003e ? RowOrdering.ASCENDING : RowOrdering.DESCENDING,\u003cbr\\/\u003e\\n\\t\\tgetTableNumber(), baseColumnPositions\u003cspan class=\\\"error\\\"\u003e&#91;i&#93;\u003c\\/span\u003e);\u003cbr\\/\u003e\\nThis adding of TENKTUP1.UNIQUE1 to ordering object will indicate that the rows are ordered on that column. So, at the end of considering access path for \u003cspan class=\\\"error\\\"\u003e&#91;0, -1&#93;\u003c\\/span\u003e join order position, currentRowOrdering object will have TENKTUP1.UNIQUE1 in ordering vector and it will be marked as the current column ordering (this is done by having currentColumnOrdering = TENKTUP1.UNIQUE1). \u003c\\/p\u003e\\n\\n\u003cp\u003eNext, we work on finding the cost of the given access path for \u003cspan class=\\\"error\\\"\u003e&#91;0, -1&#93;\u003c\\/span\u003e join order. Once we find the cost, we check to see if it makes sense to avoid sort on it from what we know so far. This is done in OptimizerImpl.costBasedCostOptimizable through following piece of code\u003cbr\\/\u003e\\n\\tif (considerSortAvoidance &amp;&amp; requiredRowOrdering.sortRequired(currentRowOrdering,\u003cbr\\/\u003e\\n\\t\\tassignedTableMap) == RequiredRowOrdering.NOTHING_REQUIRED)\u003cbr\\/\u003e\\nWhat we are doing here is checking if the ordering requested by the user for the current table (that information is in requiredRowOrdering) is satisfied by row ordering provided by the join order being considered so far. The row ordering provided for the current join order is in currentRowOrdering. In our specific eg, since user has requested for ordering on TENKTUP1.UNIQUE1 and we are ordering on it because of the index that is being used, the above call to requiredRowOrdering.sortRequired is going to return sorting not required.\u003c\\/p\u003e\\n\\n\u003cp\u003eNext, we put the next optimizable in the join order, meaning moving from \u003cspan class=\\\"error\\\"\u003e&#91;0,-1&#93;\u003c\\/span\u003e join order to \u003cspan class=\\\"error\\\"\u003e&#91;0, 1&#93;\u003c\\/span\u003e. At this point, optimizer is considering TENKTUP2 in the 2nd join order position. We have asked the optimizer to use index TK2UNIQUE1 for optimizable TENKTUP2. We go through the same code path as above for this optimizable. We will find that the index column TENKTUP2.unique1 needs to be added to ordering vector in currentRowOrdering because TENKTUP2 is not one-row table and there is no constant predicate on TENKTUP2.unique1 and hence the current index being considered on TENKTUP2 is going to provide ordering on TENKTUP2.unique1. Next, we see if sort can be aovided for TENKTUP2 by comparing required row ordering against current row ordering. User has required ordering on TENKTUP2.unique1 and current row ordering satisfies that ordering because of the index which is being considered for TENKTUP2.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo, if my understanding of code is correct, the sorting is getting avoided NOT based on the fact that equality condition exists between the two optimizables ie TENKTUP1.unique1 = TENKTUP2.unique1 In other words, sorting avoidacne decision was not based on TENKTUP1.unique1 = TENKTUP2.unique1 It was because optimizer decides that the individual sorting required on the optimizables have been satisfied by indexes picked on them.\u003c\\/p\u003e\\n\\n\u003cp\u003eHope this helps understand the current behavior of the trunk code for the query in question.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12711781_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12711781_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/May\\/09 20:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-21T20:15:57+0000\'\u003e21\\/May\\/09 20:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I went through the optimizer code for following query \\nconnect \'jdbc:derby:wombat\'; \\nselect * from --DERBY-PROPERTIES joinOrder=FIXED  \\nTENKTUP1 &#8211; DERBY-PROPERTIES index=TK1UNIQUE1  \\n, TENKTUP2 &#8211; DERBY-PROPERTIES index=TK2UNIQUE1  \\nwhere TENKTUP1.unique1 = TENKTUP2.unique1  \\norder by TENKTUP1.unique1, TENKTUP2.unique1;  \\n\\n\\n During the optimize phase, for an optimizable, everytime we are considering a new access path for it, we check if the conglomerate being considered for the optimizable is an index conglomerate. If yes, then we check if the current ordering for the given join order already has the index columns in it. That check is done by the following call in FromBaseTable.nextAccessPath: 478\\t \\nif ( ! rowOrdering.orderedOnColumn(isAscending &#91;i&#93;  ? RowOrdering.ASCENDING : RowOrdering.DESCENDING, \\n\\tgetTableNumber(), baseColumnPositions &#91;i&#93; )) \\nThe RowOrderingImpl.orderedOnColumn:119 first checks if the optimizable we are dealing with is marked as always ordered(I think this happens if the optimizable is a one-row table). If yes, then the we will return true from RowOrderingImpl.orderedOnColumn. If not, we check if there was a predicate on the index column which makes it always ordered(line 127). If not,then we check if the column is already being ordered by checking ordering vector at line 133. If not, we go ahead and add the index column to the ordering vector in currentRowOrdering object. \\n\\n Going to the query above when the optimizer is going through the join order  &#91;0, -1&#93;  which means it is considering TENKTUP1 at the outermost join order position and no optimizable has yet been considered in the next position yet. For TENKTUP1, we go through the above piece of code. The method RowOrderingImpl.orderedOnColumn is going to return false for the index column UNIQUE1(index TK1UNIQUE1 is on that column) because  \\na)TENKTUP1 is not always ordered meaning it is not one-row table \\nb)there is no constant predicate on TENKTUP1.UNIQUE1 \\nc)there is no other ordering on TENKTUP1.UNIQUE1 \\n\\n Since for our query, the index column UNIQUE1 is not already ordered yet in the currentRowOrdering object, we go ahead and add it to the ordering vector inside currentRowOrdering object (this is done in FromBaseTable.nextAccessPath at line: 484 with following 2 code lines.) \\n\\trowOrdering.nextOrderPosition(isAscending &#91;i&#93;  ? RowOrdering.ASCENDING : RowOrdering.DESCENDING); \\n\\trowOrdering.addOrderedColumn(isAscending &#91;i&#93;  ? RowOrdering.ASCENDING : RowOrdering.DESCENDING, \\n\\t\\tgetTableNumber(), baseColumnPositions &#91;i&#93; ); \\nThis adding of TENKTUP1.UNIQUE1 to ordering object will indicate that the rows are ordered on that column. So, at the end of considering access path for  &#91;0, -1&#93;  join order position, currentRowOrdering object will have TENKTUP1.UNIQUE1 in ordering vector and it will be marked as the current column ordering (this is done by having currentColumnOrdering = TENKTUP1.UNIQUE1).  \\n\\n Next, we work on finding the cost of the given access path for  &#91;0, -1&#93;  join order. Once we find the cost, we check to see if it makes sense to avoid sort on it from what we know so far. This is done in OptimizerImpl.costBasedCostOptimizable through following piece of code \\n\\tif (considerSortAvoidance &amp;&amp; requiredRowOrdering.sortRequired(currentRowOrdering, \\n\\t\\tassignedTableMap) == RequiredRowOrdering.NOTHING_REQUIRED) \\nWhat we are doing here is checking if the ordering requested by the user for the current table (that information is in requiredRowOrdering) is satisfied by row ordering provided by the join order being considered so far. The row ordering provided for the current join order is in currentRowOrdering. In our specific eg, since user has requested for ordering on TENKTUP1.UNIQUE1 and we are ordering on it because of the index that is being used, the above call to requiredRowOrdering.sortRequired is going to return sorting not required. \\n\\n Next, we put the next optimizable in the join order, meaning moving from  &#91;0,-1&#93;  join order to  &#91;0, 1&#93; . At this point, optimizer is considering TENKTUP2 in the 2nd join order position. We have asked the optimizer to use index TK2UNIQUE1 for optimizable TENKTUP2. We go through the same code path as above for this optimizable. We will find that the index column TENKTUP2.unique1 needs to be added to ordering vector in currentRowOrdering because TENKTUP2 is not one-row table and there is no constant predicate on TENKTUP2.unique1 and hence the current index being considered on TENKTUP2 is going to provide ordering on TENKTUP2.unique1. Next, we see if sort can be aovided for TENKTUP2 by comparing required row ordering against current row ordering. User has required ordering on TENKTUP2.unique1 and current row ordering satisfies that ordering because of the index which is being considered for TENKTUP2. \\n\\n So, if my understanding of code is correct, the sorting is getting avoided NOT based on the fact that equality condition exists between the two optimizables ie TENKTUP1.unique1 = TENKTUP2.unique1 In other words, sorting avoidacne decision was not based on TENKTUP1.unique1 = TENKTUP2.unique1 It was because optimizer decides that the individual sorting required on the optimizables have been satisfied by indexes picked on them. \\n\\n Hope this helps understand the current behavior of the trunk code for the query in question.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12712398\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12712398&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12712398\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12712398_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12712398_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/May\\/09 10:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-23T10:29:43+0000\'\u003e23\\/May\\/09 10:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOrderByAndSortAvoidance.java has been causing warnings when building the javadocs in UTF-8 locale because it contains non-ASCII characters encoded with ISO-8859-1. The warnings look like this:\u003c\\/p\u003e\\n\\n\u003cp\u003e  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e \\/code\\/derby\\/trunk1\\/java\\/testing\\/org\\/apache\\/derbyTesting\\/functionTests\\/tests\\/lang\\/OrderByAndSortAvoidance.java:738: warning: unmappable character for encoding UTF8\u003cbr\\/\u003e\\n  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e                 + \\\"documents.  Ils ont \\uFFFDt\\uFFFD faits pour quelque chose.\')\\\");\u003cbr\\/\u003e\\n  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e                                        ^\u003cbr\\/\u003e\\n  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e \\/code\\/derby\\/trunk1\\/java\\/testing\\/org\\/apache\\/derbyTesting\\/functionTests\\/tests\\/lang\\/OrderByAndSortAvoidance.java:738: warning: unmappable character for encoding UTF8\u003cbr\\/\u003e\\n  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e                 + \\\"documents.  Ils ont \\uFFFDt\\uFFFD faits pour quelque chose.\')\\\");\u003cbr\\/\u003e\\n  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e                                          ^\u003cbr\\/\u003e\\n  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e \\/code\\/derby\\/trunk1\\/java\\/testing\\/org\\/apache\\/derbyTesting\\/functionTests\\/tests\\/lang\\/OrderByAndSortAvoidance.java:901: warning: unmappable character for encoding UTF8\u003cbr\\/\u003e\\n  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e                             \\\"\'BatchTypeInstructions\', \'Ne pas jeter ces documents.  Ils ont \\uFFFDt\\uFFFD faits pour quelque chose.\')\\\");\u003cbr\\/\u003e\\n  \u003cspan class=\\\"error\\\"\u003e&#91;javadoc&#93;\u003c\\/span\u003e                                                                                             ^\u003cbr\\/\u003e\\n.\u003cbr\\/\u003e\\n.\u003cbr\\/\u003e\\n.\u003c\\/p\u003e\\n\\n\u003cp\u003eI fixed it in revision 777886 by replacing the occurrences of the problematic non-ASCII character (\\u00E9) with a Unicode escape sequence (\\\\u00e).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12712398_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12712398_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/May\\/09 10:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-23T10:29:43+0000\'\u003e23\\/May\\/09 10:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OrderByAndSortAvoidance.java has been causing warnings when building the javadocs in UTF-8 locale because it contains non-ASCII characters encoded with ISO-8859-1. The warnings look like this: \\n\\n    &#91;javadoc&#93;  \\/code\\/derby\\/trunk1\\/java\\/testing\\/org\\/apache\\/derbyTesting\\/functionTests\\/tests\\/lang\\/OrderByAndSortAvoidance.java:738: warning: unmappable character for encoding UTF8 \\n   &#91;javadoc&#93;                  + \\\"documents.  Ils ont \\uFFFDt\\uFFFD faits pour quelque chose.\')\\\"); \\n   &#91;javadoc&#93;                                         ^ \\n   &#91;javadoc&#93;  \\/code\\/derby\\/trunk1\\/java\\/testing\\/org\\/apache\\/derbyTesting\\/functionTests\\/tests\\/lang\\/OrderByAndSortAvoidance.java:738: warning: unmappable character for encoding UTF8 \\n   &#91;javadoc&#93;                  + \\\"documents.  Ils ont \\uFFFDt\\uFFFD faits pour quelque chose.\')\\\"); \\n   &#91;javadoc&#93;                                           ^ \\n   &#91;javadoc&#93;  \\/code\\/derby\\/trunk1\\/java\\/testing\\/org\\/apache\\/derbyTesting\\/functionTests\\/tests\\/lang\\/OrderByAndSortAvoidance.java:901: warning: unmappable character for encoding UTF8 \\n   &#91;javadoc&#93;                              \\\"\'BatchTypeInstructions\', \'Ne pas jeter ces documents.  Ils ont \\uFFFDt\\uFFFD faits pour quelque chose.\')\\\"); \\n   &#91;javadoc&#93;                                                                                              ^ \\n. \\n. \\n. \\n\\n I fixed it in revision 777886 by replacing the occurrences of the problematic non-ASCII character (\\u00E9) with a Unicode escape sequence (\\\\u00e).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12712480\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12712480&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12712480\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12712480_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12712480_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/09 00:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-24T00:11:25+0000\'\u003e24\\/May\\/09 00:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Knut.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12712480_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12712480_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/09 00:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-24T00:11:25+0000\'\u003e24\\/May\\/09 00:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Knut.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12713641\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12713641&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12713641\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12713641_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12713641_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/May\\/09 16:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-27T16:58:38+0000\'\u003e27\\/May\\/09 16:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am attaching a new patch, namely DERBY3926_patch5_052709_stat.txt. This patch still does the same thing as the previous patch which is to make sure that if order by column does not belong to the outermost optimizable, then check if the order by column has a constant comparison predicate on it or it is coming from a single-row table. If either of the 2 conditions is true then we do not need to worry if the outer opitimizable to the optimizable for order by column are one-row resultsets or not. One thing to note is that I have the additional check to see if the order by column comes from a single row table. Earlier patch only checked if the order by column has constant comparison predicate on it. All this logic is now in RequiredRowOrdering:sortRequired(RowOrdering rowOrdering, JBitSet tableMap, OptimizableList optimizableList) throws StandardException;\u003cbr\\/\u003e\\nThis is more logical place for code to be in rather than putting in OptimizerImpl which is where the previous patch put the code changes.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe one item remaining on this jira is one query from wisconsin that now requires a sorting node rather than avoiding the sort. Mike and Bryan are right about checking if the previous optimizables are multi-row optimizables then see if the multiple scan into order by column\'s optimizable are all going to return same single row resulset. If so, then there is no need to require sorting even though outer optimizables are multu-row resultsets.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12713641_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12713641_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/May\\/09 16:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-27T16:58:38+0000\'\u003e27\\/May\\/09 16:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am attaching a new patch, namely DERBY3926_patch5_052709_stat.txt. This patch still does the same thing as the previous patch which is to make sure that if order by column does not belong to the outermost optimizable, then check if the order by column has a constant comparison predicate on it or it is coming from a single-row table. If either of the 2 conditions is true then we do not need to worry if the outer opitimizable to the optimizable for order by column are one-row resultsets or not. One thing to note is that I have the additional check to see if the order by column comes from a single row table. Earlier patch only checked if the order by column has constant comparison predicate on it. All this logic is now in RequiredRowOrdering:sortRequired(RowOrdering rowOrdering, JBitSet tableMap, OptimizableList optimizableList) throws StandardException; \\nThis is more logical place for code to be in rather than putting in OptimizerImpl which is where the previous patch put the code changes. \\n\\n The one item remaining on this jira is one query from wisconsin that now requires a sorting node rather than avoiding the sort. Mike and Bryan are right about checking if the previous optimizables are multi-row optimizables then see if the multiple scan into order by column\'s optimizable are all going to return same single row resulset. If so, then there is no need to require sorting even though outer optimizables are multu-row resultsets.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12714538\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12714538&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12714538\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12714538_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12714538_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/May\\/09 18:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-29T18:17:07+0000\'\u003e29\\/May\\/09 18:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI reviewed patch 5 and only comment I think requires change is that patch should enable the test you already added to always be run as part of the suite.\u003c\\/p\u003e\\n\\n\u003cp\u003enits:\u003cbr\\/\u003e\\nI find the \\\"alwaysOrdered\\\", isColumnAlwaysOrdered, terminology confusing.   Sometimes we need to be checking one row result set, and sometimes we seem it to mean a single value but may be multiple duplicate values.  It would be nice if the routine names reflected what we are counting on.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe new routine you added  isColumnAlwaysOrdered() is doc\'d as:\u003cbr\\/\u003e\\n+    * Return true if the column is always ordered. That will be true if the\u003cbr\\/\u003e\\n+    * column has a constant comparison predicate on it.\u003cbr\\/\u003e\\nBut the comment in the call to it seems to say it is expecting something different:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eThe current order by column does not have any constant\u003c\\/li\u003e\\n\\t\u003cli\u003ecomparison predicate on it nor does it belong to a\u003c\\/li\u003e\\n\\t\u003cli\u003esingle row table which means that the rows will not\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eo some lines over 80\u003c\\/p\u003e\\n\\n\u003cp\u003eo mostly uses brace on new line, but on the following uses brace on same line:\u003cbr\\/\u003e\\n if (moreThanOneTableInJoinOrder) {\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12714538_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12714538_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/May\\/09 18:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-05-29T18:17:07+0000\'\u003e29\\/May\\/09 18:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I reviewed patch 5 and only comment I think requires change is that patch should enable the test you already added to always be run as part of the suite. \\n\\n nits: \\nI find the \\\"alwaysOrdered\\\", isColumnAlwaysOrdered, terminology confusing.   Sometimes we need to be checking one row result set, and sometimes we seem it to mean a single value but may be multiple duplicate values.  It would be nice if the routine names reflected what we are counting on. \\n\\n The new routine you added  isColumnAlwaysOrdered() is doc\'d as: \\n+    * Return true if the column is always ordered. That will be true if the \\n+    * column has a constant comparison predicate on it. \\nBut the comment in the call to it seems to say it is expecting something different: \\n \\n\\t The current order by column does not have any constant \\n\\t comparison predicate on it nor does it belong to a \\n\\t single row table which means that the rows will not \\n \\n\\n\\n o some lines over 80 \\n\\n o mostly uses brace on new line, but on the following uses brace on same line: \\n if (moreThanOneTableInJoinOrder) { \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12716172\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12716172&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12716172\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12716172_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12716172_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jun\\/09 06:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-04T06:26:45+0000\'\u003e04\\/Jun\\/09 06:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am attaching DERBY3926_patch5_060309_diff.txt Hopefully, this is the final patch for this jira entry. This patch takes care of the original problem query and one query from wisconsin which was getting an unnecessary sort node on it with the previous patch (DERBY3926_patch5_052709_stat.txt). \u003c\\/p\u003e\\n\\n\u003cp\u003eFollowing are the files that were touched by the patch.\u003cbr\\/\u003e\\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\RowOrderingImpl.java\u003cbr\\/\u003e\\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\OrderByList.java\u003cbr\\/\u003e\\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\FromBaseTable.java\u003cbr\\/\u003e\\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\OptimizerImpl.java\u003cbr\\/\u003e\\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\PredicateList.java\u003cbr\\/\u003e\\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\iapi\\\\sql\\\\compile\\\\RowOrdering.java\u003cbr\\/\u003e\\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\iapi\\\\sql\\\\compile\\\\RequiredRowOrdering.java\u003cbr\\/\u003e\\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\iapi\\\\sql\\\\compile\\\\OptimizablePredicateList.java\u003cbr\\/\u003e\\nM      java\\\\testing\\\\org\\\\apache\\\\derbyTesting\\\\functionTests\\\\tests\\\\lang\\\\wisc_setup.sql\u003cbr\\/\u003e\\nM      java\\\\testing\\\\org\\\\apache\\\\derbyTesting\\\\functionTests\\\\tests\\\\lang&#95;Suite.java\u003cbr\\/\u003e\\nM      java\\\\testing\\\\org\\\\apache\\\\derbyTesting\\\\functionTests\\\\tests\\\\lang\\\\OrderByAndSortAvoidance.java\u003cbr\\/\u003e\\nM      java\\\\testing\\\\org\\\\apache\\\\derbyTesting\\\\functionTests\\\\master\\\\wisconsin.out\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eFollowing is the patch description.\u003cbr\\/\u003e\\nThe problem with the trunk codeline is that when optimizer goes through optimizables in a join order, it only looks at those optimizables individually to decide whether sorting can be avoided on them or not. That approach leaves out few queries which require sorting but do not get sorted. The decision for avoiding sorting should also include relationship between the optimizables in a given join order. Following query demonstrates the trunk problem\u003cbr\\/\u003e\\nSELECT table1.id, table2.value, table3.value FROM --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3 \u003cbr\\/\u003e\\n, table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2 \u003cbr\\/\u003e\\n, table1 \u003cbr\\/\u003e\\nWHERE table1.id=table2.id AND table2.name=\'PageSequenceId\' \u003cbr\\/\u003e\\nAND table1.id=table3.id \u003cbr\\/\u003e\\nAND table3.name=\'PostComponentId\' \u003cbr\\/\u003e\\nAND table3.value=\'21857\' ORDER BY table2.value; \u003c\\/p\u003e\\n\\n\u003cp\u003eIn the query above, when optimizer is considering \u003cspan class=\\\"error\\\"\u003e&#91;table3, table2, -1&#93;\u003c\\/span\u003e join order, it determines that sorting can be avoided on this join order because the order by column table2.value is already covered by the index nonUniqueOnValue_Table2. It does not see that the outermost optimizable table3 will qualify more than one row and hence it will be a multi-row resulset and for each one of those rows, we will be doing a scan into table2. In other words, there will be multiple scans into table2(and the rows returned by each one of those scans will be ordered on table2.value) but the collective rows from those multiple scans are not necessarily going to be ordered on table2.value. This patch is attempting to fix that problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eCurrently, in trunk, a column is marked always ordered during a query processing when the optimizer finds that there is constant comparison predicate on the order by column. If the column does not have a constant predicate (as in our example above), we next see if we are using an index which will provide the required ordering on column (which is true in our case. The required ordering on table2.value is provided by the index nonUniqueOnValue_Table2). But as we can see in the query above, this index coverage is not enough to say that sorting is not needed. We need to add 2 more conditions before we can decide to avoid the sorting. One of those cases is 1)if the order by column does not belong to the outermost optimizable, then check if the order by column\'s optimizable is a one-row resultset. If yes, then it will be safe for the optimizer to avoid the sorting. The second case to consider is 2)if the order by column does not belong to the outermost optimizable, then check if the order by column\'s optimizable is multi-row resultset BUT all the outer optimizables are one-row resulsets. If either of these 2 additional conditions are satisfied then optimizer can choose to avoid the sorting. Otherwise\u003cbr\\/\u003e\\nsorting should be added to the query plan. The example query above does not satisfy the 2 additional checks and hence sorting should be done as part of the query plan.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe changes for the 1)check above has gone into OrderbyByList.sortRequired(RowOrdering, JBitSet, OptimizableList). The implementation of this change just required us to check the outer optimizables to be one row since the order by column\'s optimizable is not one row. If outer optimizables are all one-row, then we say that sorting can be avoided. Otherwise sorting is required.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe changes for the 2)check above has gone into FromBaseTable.nextAccessPath(Optimizer optimizer, OptimizablePredicateList predList, RowOrdering rowOrdering) The implementation of this change requires us to see if the order by column is involved in equijoin with outer optimizable\'s indexed column. If yes, then we know that since outer optimizable is ordered, the rows qualified via the equijoin will also be ordered and hence sorting can be avoided. But if this is not true, then we can\'t rely on outer optimizables\' rows to be ordered on the order by column. To avoid sorting, we need to identify this case 2) as another case when the column can be marked as always ordered and that is when there is an equijoin predicate on the order by column with some other column\u003cbr\\/\u003e\\nwhich is already known to be always ordered. Taking the query from wisconsin as an example will explain this behavior\u003cbr\\/\u003e\\nselect * from --DERBY-PROPERTIES joinOrder=FIXED \u003cbr\\/\u003e\\nTENKTUP1 &#8211; DERBY-PROPERTIES index=TK1UNIQUE1 \u003cbr\\/\u003e\\n, TENKTUP2 &#8211; DERBY-PROPERTIES index=TK2UNIQUE1 \u003cbr\\/\u003e\\nwhere TENKTUP1.unique1 = TENKTUP2.unique1 \u003cbr\\/\u003e\\norder by TENKTUP1.unique1, TENKTUP2.unique1; \u003c\\/p\u003e\\n\\n\u003cp\u003eFor the above query, as per the current trunk codeline, none of the order by columns are marked as always ordered because there is no constant comparison predicate on them. But, for the given join order, with TENKTUP1 as the outermost resultset and with the index TK1UNIQUE1, we know that the current row ordering at this point is going to ensure that rows from TENKTUP1 are ordered on UNIQUE1. Next, when we process TEKTUP2 in the 2nd join order position, we find that there is no constant predicate on TENKTUP2.unique1 and hence we conculde that the rows from TENKTUP2 are not going to be ordered and we decide to force a sort node on the top of the query. But in reality, even though the outer optimizable is not a single row resultset, it is ordered on TENKTUP1.unique1 and hence all those rows from outer optimizable are going to be ordered on TENKTUP1.unique1 and the inner optimizable has an equality join on \u003c\\/p\u003e\\n\\n\u003cp\u003eTENKTUP1.unique1 using the order by column TENKTUP2.unique1 What that translates to is that even if there will be multiple scans into TENKTUP2, the rows qualified are going to be all ordered because of the equijoin between the outer and inner optimizables on the order by columns. So, with my latest patch, I have expanded the notion of always ordered columns to include both constant comparison predicates AND ordered column that has equijoin with an outer optimizable\'s ordered column. \u003c\\/p\u003e\\n\\n\u003cp\u003eI think this patch is also improving the existing queries to include a better path than what it was picking up before. Following is an example of one such query from wisconsin.\u003cbr\\/\u003e\\nselect * from TENKTUP1, TENKTUP2 \u003cbr\\/\u003e\\nwhere TENKTUP1.unique1 = TENKTUP2.unique1 \u003cbr\\/\u003e\\nand TENKTUP2.unique1 &lt; 100\u003cbr\\/\u003e\\norder by TENKTUP1.unique1; \u003cbr\\/\u003e\\nFor this query, the trunk currently decides to use TENKTUP1 as the outermost optimizable using the TK1UNIQUE1 index and then those rows are filtered using TENKTUP2.unique1 &lt; 100. Each of the 2 tables involved in the query have 10000 rows each. So we are going through 10000 qualified indexed rows from TENKTUP1 and then applying TENKTUP2.unique1 &lt; 100 on them. With the attached patch, we use TENKTUP2 as the outermost optimizable with the index TK2UNIQUE1 and only gets the indexed rows which satisfy TENKTUP2.unique1 &lt; 100 and then on them, we use the equlity join to fetch qualified rows from TENKTUP1. \u003c\\/p\u003e\\n\\n\u003cp\u003eI hope the above explanation helps understand the patch. I would appreciate if someone can take the time to go through the patch and provide any feedback they may have. If I don\'t hear anything by early next week, I will go ahead and commit the patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12716172_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12716172_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jun\\/09 06:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-04T06:26:45+0000\'\u003e04\\/Jun\\/09 06:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am attaching DERBY3926_patch5_060309_diff.txt Hopefully, this is the final patch for this jira entry. This patch takes care of the original problem query and one query from wisconsin which was getting an unnecessary sort node on it with the previous patch (DERBY3926_patch5_052709_stat.txt).  \\n\\n Following are the files that were touched by the patch. \\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\RowOrderingImpl.java \\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\OrderByList.java \\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\FromBaseTable.java \\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\OptimizerImpl.java \\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\impl\\\\sql\\\\compile\\\\PredicateList.java \\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\iapi\\\\sql\\\\compile\\\\RowOrdering.java \\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\iapi\\\\sql\\\\compile\\\\RequiredRowOrdering.java \\nM      java\\\\engine\\\\org\\\\apache\\\\derby\\\\iapi\\\\sql\\\\compile\\\\OptimizablePredicateList.java \\nM      java\\\\testing\\\\org\\\\apache\\\\derbyTesting\\\\functionTests\\\\tests\\\\lang\\\\wisc_setup.sql \\nM      java\\\\testing\\\\org\\\\apache\\\\derbyTesting\\\\functionTests\\\\tests\\\\lang&#95;Suite.java \\nM      java\\\\testing\\\\org\\\\apache\\\\derbyTesting\\\\functionTests\\\\tests\\\\lang\\\\OrderByAndSortAvoidance.java \\nM      java\\\\testing\\\\org\\\\apache\\\\derbyTesting\\\\functionTests\\\\master\\\\wisconsin.out \\n\\n\\n Following is the patch description. \\nThe problem with the trunk codeline is that when optimizer goes through optimizables in a join order, it only looks at those optimizables individually to decide whether sorting can be avoided on them or not. That approach leaves out few queries which require sorting but do not get sorted. The decision for avoiding sorting should also include relationship between the optimizables in a given join order. Following query demonstrates the trunk problem \\nSELECT table1.id, table2.value, table3.value FROM --DERBY-PROPERTIES joinOrder=FIXED  \\ntable3 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table3  \\n, table2 &#8211; DERBY-PROPERTIES index=nonUniqueOnValue_Table2  \\n, table1  \\nWHERE table1.id=table2.id AND table2.name=\'PageSequenceId\'  \\nAND table1.id=table3.id  \\nAND table3.name=\'PostComponentId\'  \\nAND table3.value=\'21857\' ORDER BY table2.value;  \\n\\n In the query above, when optimizer is considering  &#91;table3, table2, -1&#93;  join order, it determines that sorting can be avoided on this join order because the order by column table2.value is already covered by the index nonUniqueOnValue_Table2. It does not see that the outermost optimizable table3 will qualify more than one row and hence it will be a multi-row resulset and for each one of those rows, we will be doing a scan into table2. In other words, there will be multiple scans into table2(and the rows returned by each one of those scans will be ordered on table2.value) but the collective rows from those multiple scans are not necessarily going to be ordered on table2.value. This patch is attempting to fix that problem. \\n\\n Currently, in trunk, a column is marked always ordered during a query processing when the optimizer finds that there is constant comparison predicate on the order by column. If the column does not have a constant predicate (as in our example above), we next see if we are using an index which will provide the required ordering on column (which is true in our case. The required ordering on table2.value is provided by the index nonUniqueOnValue_Table2). But as we can see in the query above, this index coverage is not enough to say that sorting is not needed. We need to add 2 more conditions before we can decide to avoid the sorting. One of those cases is 1)if the order by column does not belong to the outermost optimizable, then check if the order by column\'s optimizable is a one-row resultset. If yes, then it will be safe for the optimizer to avoid the sorting. The second case to consider is 2)if the order by column does not belong to the outermost optimizable, then check if the order by column\'s optimizable is multi-row resultset BUT all the outer optimizables are one-row resulsets. If either of these 2 additional conditions are satisfied then optimizer can choose to avoid the sorting. Otherwise \\nsorting should be added to the query plan. The example query above does not satisfy the 2 additional checks and hence sorting should be done as part of the query plan. \\n\\n The changes for the 1)check above has gone into OrderbyByList.sortRequired(RowOrdering, JBitSet, OptimizableList). The implementation of this change just required us to check the outer optimizables to be one row since the order by column\'s optimizable is not one row. If outer optimizables are all one-row, then we say that sorting can be avoided. Otherwise sorting is required. \\n\\n The changes for the 2)check above has gone into FromBaseTable.nextAccessPath(Optimizer optimizer, OptimizablePredicateList predList, RowOrdering rowOrdering) The implementation of this change requires us to see if the order by column is involved in equijoin with outer optimizable\'s indexed column. If yes, then we know that since outer optimizable is ordered, the rows qualified via the equijoin will also be ordered and hence sorting can be avoided. But if this is not true, then we can\'t rely on outer optimizables\' rows to be ordered on the order by column. To avoid sorting, we need to identify this case 2) as another case when the column can be marked as always ordered and that is when there is an equijoin predicate on the order by column with some other column \\nwhich is already known to be always ordered. Taking the query from wisconsin as an example will explain this behavior \\nselect * from --DERBY-PROPERTIES joinOrder=FIXED  \\nTENKTUP1 &#8211; DERBY-PROPERTIES index=TK1UNIQUE1  \\n, TENKTUP2 &#8211; DERBY-PROPERTIES index=TK2UNIQUE1  \\nwhere TENKTUP1.unique1 = TENKTUP2.unique1  \\norder by TENKTUP1.unique1, TENKTUP2.unique1;  \\n\\n For the above query, as per the current trunk codeline, none of the order by columns are marked as always ordered because there is no constant comparison predicate on them. But, for the given join order, with TENKTUP1 as the outermost resultset and with the index TK1UNIQUE1, we know that the current row ordering at this point is going to ensure that rows from TENKTUP1 are ordered on UNIQUE1. Next, when we process TEKTUP2 in the 2nd join order position, we find that there is no constant predicate on TENKTUP2.unique1 and hence we conculde that the rows from TENKTUP2 are not going to be ordered and we decide to force a sort node on the top of the query. But in reality, even though the outer optimizable is not a single row resultset, it is ordered on TENKTUP1.unique1 and hence all those rows from outer optimizable are going to be ordered on TENKTUP1.unique1 and the inner optimizable has an equality join on  \\n\\n TENKTUP1.unique1 using the order by column TENKTUP2.unique1 What that translates to is that even if there will be multiple scans into TENKTUP2, the rows qualified are going to be all ordered because of the equijoin between the outer and inner optimizables on the order by columns. So, with my latest patch, I have expanded the notion of always ordered columns to include both constant comparison predicates AND ordered column that has equijoin with an outer optimizable\'s ordered column.  \\n\\n I think this patch is also improving the existing queries to include a better path than what it was picking up before. Following is an example of one such query from wisconsin. \\nselect * from TENKTUP1, TENKTUP2  \\nwhere TENKTUP1.unique1 = TENKTUP2.unique1  \\nand TENKTUP2.unique1 &lt; 100 \\norder by TENKTUP1.unique1;  \\nFor this query, the trunk currently decides to use TENKTUP1 as the outermost optimizable using the TK1UNIQUE1 index and then those rows are filtered using TENKTUP2.unique1 &lt; 100. Each of the 2 tables involved in the query have 10000 rows each. So we are going through 10000 qualified indexed rows from TENKTUP1 and then applying TENKTUP2.unique1 &lt; 100 on them. With the attached patch, we use TENKTUP2 as the outermost optimizable with the index TK2UNIQUE1 and only gets the indexed rows which satisfy TENKTUP2.unique1 &lt; 100 and then on them, we use the equlity join to fetch qualified rows from TENKTUP1.  \\n\\n I hope the above explanation helps understand the patch. I would appreciate if someone can take the time to go through the patch and provide any feedback they may have. If I don\'t hear anything by early next week, I will go ahead and commit the patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12716280\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12716280&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12716280\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12716280_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12716280_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jun\\/09 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-04T13:53:57+0000\'\u003e04\\/Jun\\/09 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAfter doing a sync of the codeline and re-running the junit tests, I see failures in upgrade tests but I do not think they are related to my changes. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12716280_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12716280_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jun\\/09 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-04T13:53:57+0000\'\u003e04\\/Jun\\/09 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    After doing a sync of the codeline and re-running the junit tests, I see failures in upgrade tests but I do not think they are related to my changes.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12716735\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12716735&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12716735\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12716735_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12716735_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jun\\/09 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-05T19:42:22+0000\'\u003e05\\/Jun\\/09 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTo elaborate more on the upgrade test failures, I had the junit tests using the gui and that\'s when I saw upgrade test failures.\u003cbr\\/\u003e\\njava -Xmx1024m -cp \'..\\/..\\/tools\\/java\\/junit.jar;..\\/..\\/classes\' junit.swingui.TestRunner -noloading org.apache.derbyTesting.functionTests.suites.All\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW, the platform for the test runs is Windows XP v2.10 and IBM 16 jdk.\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran the upgrade tests by themselves using the gui TestRunner and didn\'t see the failures. I am now running the entire junit test suit using text runner to see if the failures I saw earlier reproduce.\u003cbr\\/\u003e\\njava -Xmx256M -XX:MaxPermSize=128M -cp \'..\\/..\\/tools\\/java\\/junit.jar;..\\/..\\/classes\' junit.textui.TestRunner org.apache.derbyTesting.functionTests.suites.All\u003c\\/p\u003e\\n\\n\u003cp\u003eI will appreciate if someone has time to apply my patch and run the entire junit suite on their machine to see if the upgrade tests fail there. Thank you.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12716735_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12716735_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jun\\/09 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-05T19:42:22+0000\'\u003e05\\/Jun\\/09 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    To elaborate more on the upgrade test failures, I had the junit tests using the gui and that\'s when I saw upgrade test failures. \\njava -Xmx1024m -cp \'..\\/..\\/tools\\/java\\/junit.jar;..\\/..\\/classes\' junit.swingui.TestRunner -noloading org.apache.derbyTesting.functionTests.suites.All \\n\\n BTW, the platform for the test runs is Windows XP v2.10 and IBM 16 jdk. \\n\\n I ran the upgrade tests by themselves using the gui TestRunner and didn\'t see the failures. I am now running the entire junit test suit using text runner to see if the failures I saw earlier reproduce. \\njava -Xmx256M -XX:MaxPermSize=128M -cp \'..\\/..\\/tools\\/java\\/junit.jar;..\\/..\\/classes\' junit.textui.TestRunner org.apache.derbyTesting.functionTests.suites.All \\n\\n I will appreciate if someone has time to apply my patch and run the entire junit suite on their machine to see if the upgrade tests fail there. Thank you.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12717095\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12717095&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12717095\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12717095_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12717095_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jun\\/09 20:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-07T20:25:44+0000\'\u003e07\\/Jun\\/09 20:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran full set of tests against ibm16 on a windows xp box with the latest patch and got no unexpected errors\u003cbr\\/\u003e\\n(continue to get the replication test error seen in many nightly test runs).  I also by hand ran the upgrade tests\u003cbr\\/\u003e\\nin the gui and did not get any errors with the patch also.\u003c\\/p\u003e\\n\\n\u003cp\u003eUnless anyone else reviews and disagrees I think we should get this patch in and backported.  Any additional\u003cbr\\/\u003e\\nimprovements to the patch can be handled by subsequent work.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12717095_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12717095_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jun\\/09 20:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-07T20:25:44+0000\'\u003e07\\/Jun\\/09 20:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran full set of tests against ibm16 on a windows xp box with the latest patch and got no unexpected errors \\n(continue to get the replication test error seen in many nightly test runs).  I also by hand ran the upgrade tests \\nin the gui and did not get any errors with the patch also. \\n\\n Unless anyone else reviews and disagrees I think we should get this patch in and backported.  Any additional \\nimprovements to the patch can be handled by subsequent work.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12717311\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12717311&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12717311\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12717311_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12717311_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jun\\/09 16:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-08T16:25:47+0000\'\u003e08\\/Jun\\/09 16:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Mike, for ruuning the tests. I will plan on committing the patch tomorrow. \u003c\\/p\u003e\\n\\n\u003cp\u003eOne piece of possible improvement that can be made to the patch in future is to hide all the information about the column ordering in the RowOrdering object. Currently, we check if the current Optimizable is a one-row resultset or not and if not, then the check to make sure that all the previous optimizables should be one-row resultset happens in OrderByList.sortRequired(this check is done if we have found earlier that there is no equijoin between the current optimizable\'s order by column with columns already ordered from the previous optimizables. This check is made much earlier in the optimization phase and the result of that check is encapsulated in RowOrdering object and so no code restructuring is needed for this equijoin part of the logic. The possible code improvement is for part of the logic where the current optimizable is multi-row, there is no equijoin on this current optimizable\'s order by columns so say that ordering already exists and the previous optimizables are not all one-row resultset. It may be possible for this piece of logic to be encapsulated somehow in RowOrdering object). I am not sure if this encapsulation is feasible or not but just wanted to note it in the jira.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis observation was also made by Mike and Army as comments to this jira entry,\u003cbr\\/\u003e\\n********************************************************\u003cbr\\/\u003e\\nA B added a comment - 20\\/May\\/09 10:17 AM \u003cbr\\/\u003e\\nmike&gt; I thought it would be cleaner if all the information that was necessary \u003cbr\\/\u003e\\nmike&gt; \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e was actually already located in the current RowOrdering object. \u003cbr\\/\u003e\\nmike&gt; \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e The work here is that some more information may need to be tracked \u003cbr\\/\u003e\\nmike&gt; in the RowOrdering. \u003c\\/p\u003e\\n\\n\u003cp\u003eFor what little it\'s worth, I agree, I think this is a nice idea that would in fact be a \u003cbr\\/\u003e\\nbit cleaner. I think the current patch is acceptable, as well, but if I had the luxury \u003cbr\\/\u003e\\nof choosing, I\'d probably go with Mike\'s approach, if possible... \u003cbr\\/\u003e\\n********************************************\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12717311_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12717311_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jun\\/09 16:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-08T16:25:47+0000\'\u003e08\\/Jun\\/09 16:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Mike, for ruuning the tests. I will plan on committing the patch tomorrow.  \\n\\n One piece of possible improvement that can be made to the patch in future is to hide all the information about the column ordering in the RowOrdering object. Currently, we check if the current Optimizable is a one-row resultset or not and if not, then the check to make sure that all the previous optimizables should be one-row resultset happens in OrderByList.sortRequired(this check is done if we have found earlier that there is no equijoin between the current optimizable\'s order by column with columns already ordered from the previous optimizables. This check is made much earlier in the optimization phase and the result of that check is encapsulated in RowOrdering object and so no code restructuring is needed for this equijoin part of the logic. The possible code improvement is for part of the logic where the current optimizable is multi-row, there is no equijoin on this current optimizable\'s order by columns so say that ordering already exists and the previous optimizables are not all one-row resultset. It may be possible for this piece of logic to be encapsulated somehow in RowOrdering object). I am not sure if this encapsulation is feasible or not but just wanted to note it in the jira. \\n\\n This observation was also made by Mike and Army as comments to this jira entry, \\n******************************************************** \\nA B added a comment - 20\\/May\\/09 10:17 AM  \\nmike&gt; I thought it would be cleaner if all the information that was necessary  \\nmike&gt;  &#91;...&#93;  was actually already located in the current RowOrdering object.  \\nmike&gt;  &#91;...&#93;  The work here is that some more information may need to be tracked  \\nmike&gt; in the RowOrdering.  \\n\\n For what little it\'s worth, I agree, I think this is a nice idea that would in fact be a  \\nbit cleaner. I think the current patch is acceptable, as well, but if I had the luxury  \\nof choosing, I\'d probably go with Mike\'s approach, if possible...  \\n********************************************              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12717318\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12717318&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12717318\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12717318_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12717318_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jun\\/09 16:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-08T16:40:41+0000\'\u003e08\\/Jun\\/09 16:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBTW, i reran the reproducible test case for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4240\\\" title=\\\"An index cause SQL ORDER BY can&#39;t return correct result\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4240\\\"\u003e\u003cdel\u003eDERBY-4240\u003c\\/del\u003e\u003c\\/a\u003e with my patch and the test case returns correct result. Before committing the patch tomorrow, I will go ahead and add a test case for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4240\\\" title=\\\"An index cause SQL ORDER BY can&#39;t return correct result\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4240\\\"\u003e\u003cdel\u003eDERBY-4240\u003c\\/del\u003e\u003c\\/a\u003e in OrderByAndSortAvoidance.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, I forgot to mention that I did take care of following comments from Mike on my earlier patch.\u003cbr\\/\u003e\\n********************************\u003cbr\\/\u003e\\nThe new routine you added isColumnAlwaysOrdered() is doc\'d as: \u003cbr\\/\u003e\\n+ * Return true if the column is always ordered. That will be true if the \u003cbr\\/\u003e\\n+ * column has a constant comparison predicate on it. \u003cbr\\/\u003e\\nBut the comment in the call to it seems to say it is expecting something different: \u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eThe current order by column does not have any constant\u003c\\/li\u003e\\n\\t\u003cli\u003ecomparison predicate on it nor does it belong to a\u003c\\/li\u003e\\n\\t\u003cli\u003esingle row table which means that the rows will not\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eo some lines over 80 \u003c\\/p\u003e\\n\\n\u003cp\u003eo mostly uses brace on new line, but on the following uses brace on same line: \u003cbr\\/\u003e\\n if (moreThanOneTableInJoinOrder) { \u003cbr\\/\u003e\\n********************************\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12717318_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12717318_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jun\\/09 16:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-08T16:40:41+0000\'\u003e08\\/Jun\\/09 16:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    BTW, i reran the reproducible test case for   DERBY-4240   with my patch and the test case returns correct result. Before committing the patch tomorrow, I will go ahead and add a test case for   DERBY-4240   in OrderByAndSortAvoidance. \\n\\n Also, I forgot to mention that I did take care of following comments from Mike on my earlier patch. \\n******************************** \\nThe new routine you added isColumnAlwaysOrdered() is doc\'d as:  \\n+ * Return true if the column is always ordered. That will be true if the  \\n+ * column has a constant comparison predicate on it.  \\nBut the comment in the call to it seems to say it is expecting something different:  \\n \\n\\t The current order by column does not have any constant \\n\\t comparison predicate on it nor does it belong to a \\n\\t single row table which means that the rows will not \\n \\n\\n\\n o some lines over 80  \\n\\n o mostly uses brace on new line, but on the following uses brace on same line:  \\n if (moreThanOneTableInJoinOrder) {  \\n********************************              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12717880\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12717880&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12717880\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12717880_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12717880_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/09 01:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-10T01:09:07+0000\'\u003e10\\/Jun\\/09 01:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted the patch into trunk with revision 783168. In next couple days, will start backporting it to earlier codelines.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12717880_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12717880_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/09 01:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-10T01:09:07+0000\'\u003e10\\/Jun\\/09 01:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed the patch into trunk with revision 783168. In next couple days, will start backporting it to earlier codelines.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12718242\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12718242&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12718242\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"myrna\\\" id=\\\"commentauthor_12718242_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=myrna\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"myrna\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Myrna van Lunteren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12718242_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/09 22:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-10T22:53:29+0000\'\u003e10\\/Jun\\/09 22:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooks like this caused 1 javadoc warning:\u003cbr\\/\u003e\\nC:\\\\nightlies\\\\main\\\\src\\\\opensource\\\\java\\\\engine\\\\org\\\\apache\\\\derby\\\\iapi\\\\sql\\\\compile\\\\OptimizablePredicateList.java:136: warning - @return tag has no arguments.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"myrna\\\" id=\\\"commentauthor_12718242_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=myrna\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"myrna\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Myrna van Lunteren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12718242_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/09 22:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-10T22:53:29+0000\'\u003e10\\/Jun\\/09 22:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looks like this caused 1 javadoc warning: \\nC:\\\\nightlies\\\\main\\\\src\\\\opensource\\\\java\\\\engine\\\\org\\\\apache\\\\derby\\\\iapi\\\\sql\\\\compile\\\\OptimizablePredicateList.java:136: warning - @return tag has no arguments.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12718310\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12718310&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12718310\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12718310_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12718310_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/09 05:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-11T05:56:35+0000\'\u003e11\\/Jun\\/09 05:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for catching that, Myrna. I have fixed it with revision 783641.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12718310_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12718310_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/09 05:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-11T05:56:35+0000\'\u003e11\\/Jun\\/09 05:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for catching that, Myrna. I have fixed it with revision 783641.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12719596\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12719596&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12719596\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12719596_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12719596_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/09 15:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-15T15:24:17+0000\'\u003e15\\/Jun\\/09 15:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMerged changes for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3926\\\" title=\\\"Incorrect ORDER BY caused by index\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3926\\\"\u003e\u003cdel\u003eDERBY-3926\u003c\\/del\u003e\u003c\\/a\u003e into 10.5.1.2 codeline using revision 784809\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12719596_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12719596_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/09 15:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-15T15:24:17+0000\'\u003e15\\/Jun\\/09 15:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Merged changes for   DERBY-3926   into 10.5.1.2 codeline using revision 784809              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12719921\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12719921&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12719921\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12719921_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12719921_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/09 04:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-16T04:32:43+0000\'\u003e16\\/Jun\\/09 04:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMerged changes for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3926\\\" title=\\\"Incorrect ORDER BY caused by index\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3926\\\"\u003e\u003cdel\u003eDERBY-3926\u003c\\/del\u003e\u003c\\/a\u003e into 10.4.2.1 codeline using revision 785073. Had to hand copy some additional methods into RuntimeStatisticsParser.java because those methods didn\'t exist in 10.4.2.1 codeline.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12719921_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12719921_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/09 04:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-16T04:32:43+0000\'\u003e16\\/Jun\\/09 04:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Merged changes for   DERBY-3926   into 10.4.2.1 codeline using revision 785073. Had to hand copy some additional methods into RuntimeStatisticsParser.java because those methods didn\'t exist in 10.4.2.1 codeline.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12721244\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12721244&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12721244\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12721244_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12721244_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/09 12:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-18T12:59:50+0000\'\u003e18\\/Jun\\/09 12:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Mamta,\u003c\\/p\u003e\\n\\n\u003cp\u003eI can go ahead and finish backporting this change to 10.3, 10.2, and 10.1.  I am backporting \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4268\\\" title=\\\"&quot;SECURITY&quot; is reserved as SQL keyword.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4268\\\"\u003e\u003cdel\u003eDERBY-4268\u003c\\/del\u003e\u003c\\/a\u003e and running tests anyway and so can easily run tests for the two changes together.  The two changes don\'t have any common files, so I will check in separately,\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12721244_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12721244_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/09 12:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-18T12:59:50+0000\'\u003e18\\/Jun\\/09 12:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Mamta, \\n\\n I can go ahead and finish backporting this change to 10.3, 10.2, and 10.1.  I am backporting   DERBY-4268   and running tests anyway and so can easily run tests for the two changes together.  The two changes don\'t have any common files, so I will check in separately,              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12721381\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12721381&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12721381\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12721381_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12721381_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/09 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-18T17:56:57+0000\'\u003e18\\/Jun\\/09 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is a patch for my first attempt at merging this to 10.3.  This should not be committed.\u003c\\/p\u003e\\n\\n\u003cp\u003e  The new test is failing seeing extra columns in the query:\u003cbr\\/\u003e\\n  sql1 = \\\"select c.col1, b.col1, a.col1 from a, b, c where a.col1=1 \\\"+\u003cbr\\/\u003e\\n        \\\"and b.col1 = 2 and c.col1=3 order by c.col1, b.col1, a.col1\\\";\u003c\\/p\u003e\\n\\n\u003cp\u003eProbably one of those phantom column bugs needs to be backported too.  I\'ll take a look and see.  \u003cbr\\/\u003e\\n) testAdditionalOrderByCases(org.apache.derbyTesting.functionTests.tests.lang.OrderByAndSortAvoidance)junit.framewo\u003cbr\\/\u003e\\nsertionFailedError: Unexpected column count: expected:&lt;3&gt; but was:&lt;5&gt;\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:750)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:700)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:658)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.functionTests.tests.lang.OrderByAndSortAvoidance.testAdditionalOrderByCases(Order\u003cbr\\/\u003e\\nSortAvoidance.java:10102)\u003cbr\\/\u003e\\n       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\u003cbr\\/\u003e\\n       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:45)\u003cbr\\/\u003e\\n       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:89)\u003cbr\\/\u003e\\n       at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\u003cbr\\/\u003e\\n       at junit.extensions.TestSetup$1.protect(TestSetup.java:19)\u003cbr\\/\u003e\\n       at junit.extensions.TestSetup.run(TestSetup.java:23)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\u003cbr\\/\u003e\\n) testAdditionalOrderByCases(org.apache.derbyTesting.functionTests.tests.lang.OrderByAndSortAvoidance)junit.framewo\u003cbr\\/\u003e\\nsertionFailedError: Unexpected column count: expected:&lt;3&gt; but was:&lt;5&gt;\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:750)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:700)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:658)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.functionTests.tests.lang.OrderByAndSortAvoidance.testAdditionalOrderByCases(Order\u003cbr\\/\u003e\\nSortAvoidance.java:10102)\u003cbr\\/\u003e\\n       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\u003cbr\\/\u003e\\n       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:45)\u003cbr\\/\u003e\\n       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:89)\u003cbr\\/\u003e\\n       at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\u003cbr\\/\u003e\\n       at junit.extensions.TestSetup$1.protect(TestSetup.java:19)\u003cbr\\/\u003e\\n       at junit.extensions.TestSetup.run(TestSetup.java:23)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\u003cbr\\/\u003e\\n       at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\u003cbr\\/\u003e\\n       at junit.extensions.TestSetup$1.protect(TestSetup.java:19)\u003cbr\\/\u003e\\n       at junit.extensions.TestSetup.run(TestSetup.java:23)\u003cbr\\/\u003e\\n       at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\u003cbr\\/\u003e\\n       at junit.extensions.TestSetup$1.protect(TestSetup.java:19)\u003cbr\\/\u003e\\n       at junit.extensions.TestSetup.run(TestSetup.java:23)\u003cbr\\/\u003e\\n       at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\u003c\\/p\u003e\\n\\n\u003cp\u003eAILURES!!!\u003cbr\\/\u003e\\nests run: 10,  Failures: 2,  Errors: 0\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12721381_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12721381_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/09 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-18T17:56:57+0000\'\u003e18\\/Jun\\/09 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is a patch for my first attempt at merging this to 10.3.  This should not be committed. \\n\\n   The new test is failing seeing extra columns in the query: \\n  sql1 = \\\"select c.col1, b.col1, a.col1 from a, b, c where a.col1=1 \\\"+ \\n        \\\"and b.col1 = 2 and c.col1=3 order by c.col1, b.col1, a.col1\\\"; \\n\\n Probably one of those phantom column bugs needs to be backported too.  I\'ll take a look and see.   \\n) testAdditionalOrderByCases(org.apache.derbyTesting.functionTests.tests.lang.OrderByAndSortAvoidance)junit.framewo \\nsertionFailedError: Unexpected column count: expected:&lt;3&gt; but was:&lt;5&gt; \\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:750) \\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:700) \\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:658) \\n       at org.apache.derbyTesting.functionTests.tests.lang.OrderByAndSortAvoidance.testAdditionalOrderByCases(Order \\nSortAvoidance.java:10102) \\n       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \\n       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:45) \\n       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) \\n       at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:89) \\n       at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) \\n       at junit.extensions.TestSetup$1.protect(TestSetup.java:19) \\n       at junit.extensions.TestSetup.run(TestSetup.java:23) \\n       at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) \\n) testAdditionalOrderByCases(org.apache.derbyTesting.functionTests.tests.lang.OrderByAndSortAvoidance)junit.framewo \\nsertionFailedError: Unexpected column count: expected:&lt;3&gt; but was:&lt;5&gt; \\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:750) \\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:700) \\n       at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:658) \\n       at org.apache.derbyTesting.functionTests.tests.lang.OrderByAndSortAvoidance.testAdditionalOrderByCases(Order \\nSortAvoidance.java:10102) \\n       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \\n       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:45) \\n       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) \\n       at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:89) \\n       at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) \\n       at junit.extensions.TestSetup$1.protect(TestSetup.java:19) \\n       at junit.extensions.TestSetup.run(TestSetup.java:23) \\n       at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) \\n       at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) \\n       at junit.extensions.TestSetup$1.protect(TestSetup.java:19) \\n       at junit.extensions.TestSetup.run(TestSetup.java:23) \\n       at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) \\n       at junit.extensions.TestSetup$1.protect(TestSetup.java:19) \\n       at junit.extensions.TestSetup.run(TestSetup.java:23) \\n       at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) \\n\\n AILURES!!! \\nests run: 10,  Failures: 2,  Errors: 0              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12721390\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12721390&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12721390\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12721390_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12721390_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/09 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-18T18:10:30+0000\'\u003e18\\/Jun\\/09 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe test case for this issue requires that \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3997\\\" title=\\\"ORDER BY causes column to be returned\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3997\\\"\u003e\u003cdel\u003eDERBY-3997\u003c\\/del\u003e\u003c\\/a\u003e be backported as well.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12721390_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12721390_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/09 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-18T18:10:30+0000\'\u003e18\\/Jun\\/09 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The test case for this issue requires that   DERBY-3997   be backported as well.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12723099\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12723099&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12723099\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12723099_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12723099_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/09 14:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-23T14:51:23+0000\'\u003e23\\/Jun\\/09 14:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMerging the change to 10.1, I see a diff in wisconsin. The main thing is that it is not using optimizer directives because they do not exist in 10.1 I think. I confirmed that the original repro works on the patched 10.1 and plan to update the wisconsin master, but would appreciate if someone could take a look and make sure the 10.1 output looks ok. Attached is the test output (wisconsin_10.1_result.zip)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12723099_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12723099_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/09 14:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-23T14:51:23+0000\'\u003e23\\/Jun\\/09 14:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Merging the change to 10.1, I see a diff in wisconsin. The main thing is that it is not using optimizer directives because they do not exist in 10.1 I think. I confirmed that the original repro works on the patched 10.1 and plan to update the wisconsin master, but would appreciate if someone could take a look and make sure the 10.1 output looks ok. Attached is the test output (wisconsin_10.1_result.zip)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12723318\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12723318&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12723318\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12723318_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12723318_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/09 21:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-23T21:43:52+0000\'\u003e23\\/Jun\\/09 21:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKathey, I looked through the diff and like you said, it may have to do with no way of using optimizer overrides to have the optimizer use the specific join order. One other thing that can be done(though not necessary) is to run it on other codelines without optimizer overrides to see if we similar diff there.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12723318_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12723318_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/09 21:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-23T21:43:52+0000\'\u003e23\\/Jun\\/09 21:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Kathey, I looked through the diff and like you said, it may have to do with no way of using optimizer overrides to have the optimizer use the specific join order. One other thing that can be done(though not necessary) is to run it on other codelines without optimizer overrides to see if we similar diff there.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12723320\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12723320&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12723320\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12723320_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12723320_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/09 21:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-23T21:45:11+0000\'\u003e23\\/Jun\\/09 21:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBTW, Kathey, thanks for taking care of backporting the changes for this jira entry while my hard drive died.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12723320_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12723320_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jun\\/09 21:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-23T21:45:11+0000\'\u003e23\\/Jun\\/09 21:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    BTW, Kathey, thanks for taking care of backporting the changes for this jira entry while my hard drive died.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12726926\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12726926&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12726926\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12726926_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12726926_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jul\\/09 11:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-07-03T11:57:22+0000\'\u003e03\\/Jul\\/09 11:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTriaged July 3, 2009: Assigned normal urgency, replaced 11.0 with 10.6 in Fix versions.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12726926_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12726926_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jul\\/09 11:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-07-03T11:57:22+0000\'\u003e03\\/Jul\\/09 11:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Triaged July 3, 2009: Assigned normal urgency, replaced 11.0 with 10.6 in Fix versions.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12738087\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12738087&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12738087\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12738087_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12738087_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/09 15:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-02T15:14:39+0000\'\u003e02\\/Aug\\/09 15:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI neglected to resolve this issue after backporting it to 10.1. Resolving it now. Note: \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4331\\\" title=\\\"Join returns results in wrong order\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4331\\\"\u003e\u003cdel\u003eDERBY-4331\u003c\\/del\u003e\u003c\\/a\u003e has been identified as a regression from this change.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12738087_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12738087_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/09 15:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-02T15:14:39+0000\'\u003e02\\/Aug\\/09 15:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I neglected to resolve this issue after backporting it to 10.1. Resolving it now. Note:   DERBY-4331   has been identified as a regression from this change. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12738391\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12738391&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12738391\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12738391_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12738391_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Aug\\/09 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-03T15:33:08+0000\'\u003e03\\/Aug\\/09 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am re-opening this issue. Based on the discussion around \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4331\\\" title=\\\"Join returns results in wrong order\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4331\\\"\u003e\u003cdel\u003eDERBY-4331\u003c\\/del\u003e\u003c\\/a\u003e it appears that this issue may have not been fixed. It seems that the ordering problem may simply have been moved from one family of queries to another.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12738391_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12738391_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Aug\\/09 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-03T15:33:08+0000\'\u003e03\\/Aug\\/09 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am re-opening this issue. Based on the discussion around   DERBY-4331   it appears that this issue may have not been fixed. It seems that the ordering problem may simply have been moved from one family of queries to another.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12742433\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3926?focusedCommentId=12742433&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12742433\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12742433_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12742433_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Aug\\/09 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-12T16:23:08+0000\'\u003e12\\/Aug\\/09 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eregressions introduced by this fix have been resolved by checkins tracked under \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4311\\\" title=\\\"BaseJDBCTestCase.assertErrorCode() never fails\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4311\\\"\u003e\u003cdel\u003eDERBY-4311\u003c\\/del\u003e\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12742433_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12742433_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Aug\\/09 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-12T16:23:08+0000\'\u003e12\\/Aug\\/09 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    regressions introduced by this fix have been resolved by checkins tracked under   DERBY-4311                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520239581049"> 
    <input type="hidden" title="jira.request.server.time" value="555"> 
    <input type="hidden" title="jira.request.id" value="526x94396683x1"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="3"> 
    <input type="hidden" title="db.reads.time.in.ms" value="67"> 
    <input type="hidden" title="db.conns.time.in.ms" value="76"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 526x94396683x1
	          REQUEST TIMESTAMP : [05/Mar/2018:08:46:21 +0000]
	               REQUEST TIME : 0.5550
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 3

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=39, elapsedTotal=67163468, elapsedMin=507395, elapsedMax=15381196, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=44, elapsedTotal=76369666, elapsedMin=536357, elapsedMax=15564013, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>