<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|46acc08aa6a48ea9b270f65b20bda31ed0dfe2ed|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"b5386ce09cb83a\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-4571"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-4571] speedup disjunction with minShouldMatch  - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-4571] speedup disjunction with minShouldMatch  - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-4571">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-4571" href="/jira/browse/LUCENE-4571" id="key-val" rel="12617445">LUCENE-4571</a></li>
                </ol>
                <h1 id="summary-val">speedup disjunction with minShouldMatch </h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-4571"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-4571/LUCENE-4571.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-4571/LUCENE-4571.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-4571/LUCENE-4571.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-4571/LUCENE-4571.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="4.1 Major release after 4.0">4.1</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.3" title="4.3 Major release after 4.2">4.3</a>, <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+6.0" title="6.0 Major release after 5.5">6.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Fsearch%22" title="core/search issues with search code">core/search</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12617445-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>even minShouldMatch is supplied to DisjunctionSumScorer it enumerates whole disjunction, and verifies minShouldMatch condition <a href="https://github.com/apache/lucene-solr/blob/trunk/lucene/core/src/java/org/apache/lucene/search/DisjunctionSumScorer.java#L70" class="external-link" rel="nofollow">on every doc</a>:</p> 
                  <div class="code panel" style="border-width: 1px;">
                   <div class="codeContent panelContent"> 
                    <pre class="code-java">  <span class="code-keyword">public</span> <span class="code-object">int</span> nextDoc() <span class="code-keyword">throws</span> IOException {
    <span class="code-keyword">assert</span> doc != NO_MORE_DOCS;
    <span class="code-keyword">while</span>(<span class="code-keyword">true</span>) {
      <span class="code-keyword">while</span> (subScorers[0].docID() == doc) {
        <span class="code-keyword">if</span> (subScorers[0].nextDoc() != NO_MORE_DOCS) {
          heapAdjust(0);
        } <span class="code-keyword">else</span> {
          heapRemoveRoot();
          <span class="code-keyword">if</span> (numScorers &lt; minimumNrMatchers) {
            <span class="code-keyword">return</span> doc = NO_MORE_DOCS;
          }
        }
      }
      afterNext();
      <span class="code-keyword">if</span> (nrMatchers &gt;= minimumNrMatchers) {
        <span class="code-keyword">break</span>;
      }
    }
    
    <span class="code-keyword">return</span> doc;
  }
</pre> 
                   </div>
                  </div> 
                  <p><a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spo" class="user-hover" rel="spo">Stefan Pohl</a> proposes (as well as I get it) to pop nrMatchers-1 scorers from the heap first, and then push them back advancing behind that top doc. For me the question no.1 is there a performance test for minShouldMatch constrained disjunction. </p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-4571?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-4571?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-4571?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-4571?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12575034" data-issue-id="12617445" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12575034/LUCENE-4571.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12575034/LUCENE-4571.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12575034/LUCENE-4571.patch" title="Latest  22/Mar/13 16:31 - Stefan Pohl" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12575034/LUCENE-4571.patch">LUCENE-4571.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-03-22T16:31:04.333Z">22/Mar/13 16:31</time>
                   </dd>
                   <dd class="attachment-size">
                    18 kB
                   </dd>
                   <dd class="attachment-author">
                    Stefan Pohl
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12574992" data-issue-id="12617445" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12574992/LUCENE-4571.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12574992/LUCENE-4571.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12574992/LUCENE-4571.patch" title=" 22/Mar/13 09:53 - Stefan Pohl" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12574992/LUCENE-4571.patch">LUCENE-4571.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-03-22T09:53:48.196Z">22/Mar/13 09:53</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Stefan Pohl
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12574639" data-issue-id="12617445" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12574639/LUCENE-4571.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12574639/LUCENE-4571.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12574639/LUCENE-4571.patch" title=" 20/Mar/13 21:12 - Stefan Pohl" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12574639/LUCENE-4571.patch">LUCENE-4571.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-03-20T21:12:38.136Z">20/Mar/13 21:12</time>
                   </dd>
                   <dd class="attachment-size">
                    18 kB
                   </dd>
                   <dd class="attachment-author">
                    Stefan Pohl
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12574583" data-issue-id="12617445" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12574583/LUCENE-4571.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12574583/LUCENE-4571.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12574583/LUCENE-4571.patch" title=" 20/Mar/13 17:54 - Stefan Pohl" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12574583/LUCENE-4571.patch">LUCENE-4571.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-03-20T17:54:49.252Z">20/Mar/13 17:54</time>
                   </dd>
                   <dd class="attachment-size">
                    15 kB
                   </dd>
                   <dd class="attachment-author">
                    Stefan Pohl
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12570309" data-issue-id="12617445" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12570309/LUCENE-4571.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12570309/LUCENE-4571.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12570309/LUCENE-4571.patch" title=" 21/Feb/13 14:36 - Robert Muir" draggable="true" data-downloadurl="text/plain:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12570309/LUCENE-4571.patch">LUCENE-4571.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-02-21T14:36:16.127Z">21/Feb/13 14:36</time>
                   </dd>
                   <dd class="attachment-size">
                    15 kB
                   </dd>
                   <dd class="attachment-author">
                    Robert Muir
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12570301" data-issue-id="12617445" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12570301/LUCENE-4571.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12570301/LUCENE-4571.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12570301/LUCENE-4571.patch" title=" 21/Feb/13 13:09 - Robert Muir" draggable="true" data-downloadurl="text/plain:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12570301/LUCENE-4571.patch">LUCENE-4571.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-02-21T13:09:26.038Z">21/Feb/13 13:09</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Robert Muir
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12570152" data-issue-id="12617445" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12570152/LUCENE-4571.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12570152/LUCENE-4571.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12570152/LUCENE-4571.patch" title=" 20/Feb/13 17:03 - Stefan Pohl" draggable="true" data-downloadurl="text/x-patch:LUCENE-4571.patch:https://issues.apache.org/jira/secure/attachment/12570152/LUCENE-4571.patch">LUCENE-4571.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-02-20T17:03:02.176Z">20/Feb/13 17:03</time>
                   </dd>
                   <dd class="attachment-size">
                    12 kB
                   </dd>
                   <dd class="attachment-author">
                    Stefan Pohl
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="view-subtasks" class="module toggle-wrap">
               <div id="view-subtasks_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="subtask-view-options" class="aui-list-section aui-first aui-last">
                     <li class="aui-list-item"><a id="subtasks-show-all" href="/jira/browse/LUCENE-4571?subTaskView=all#issuetable" class="aui-list-checked aui-checked aui-list-item-link" title="Show All"><span>Show All</span></a></li>
                     <li class="aui-list-item"><a id="subtasks-show-open" href="/jira/browse/LUCENE-4571?subTaskView=unresolved#issuetable" class="aui-list-checked aui-list-item-link" title="Show Open"><span>Show Open</span></a></li>
                     <li class="aui-list-item"><a id="subtasks-bulk-operation" href="/jira/issue/bulkedit/BulkEdit1!default.jspa?reset=true&amp;searchParent=LUCENE-4571" class="aui-list-checked aui-list-item-link" title="Bulk operation"><span>Bulk operation</span></a></li>
                     <li class="aui-list-item"><a id="subtasks-open-issue-navigator" href="/jira/issues/?jql=parent%3DLUCENE-4571" class="aui-list-checked aui-list-item-link" title="Open issue navigator"><span>Open issue navigator</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Sub-Tasks</h2>
               </div>
               <div class="mod-content">
                <div class="mod-content intform subtask-table-container"> 
                 <issuetable-web-component> 
                  <table id="issuetable"> 
                   <tbody>
                    <tr id="issuerow12638509" rel="12638509" data-issuekey="LUCENE-4872" class="issuerow"> 
                     <td class="stsequence">
                      <div rel="0">
                       1.
                      </div> </td> 
                     <td class="stsummary"><a class="issue-link" data-issue-key="LUCENE-4872" href="/jira/browse/LUCENE-4872">BooleanWeight should decide how to execute minNrShouldMatch</a></td> 
                     <td class="issuetype"> <a class="issue-link" data-issue-key="LUCENE-4872" href="/jira/browse/LUCENE-4872"> <img src="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21146&amp;avatarType=issuetype" height="16" width="16" border="0" align="absmiddle" alt="Sub-task" title="Sub-task - The sub-task of the issue"> </a> </td> 
                     <td class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </td> 
                     <td class="assignee"> <em>Unassigned</em> </td> 
                    </tr> 
                   </tbody> 
                  </table> 
                 </issuetable-web-component> 
                 <div class="end-of-stable-message"></div> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10453"></span></span> Unassigned </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_mkhludnev" rel="mkhludnev" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Mikhail Khludnev&quot;,&quot;emailAddress&quot;:&quot;gedel@yandex.ru&quot;,&quot;username&quot;:&quot;mkhludnev&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mkhludnev"></span></span> Mikhail Khludnev </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">1</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">11</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="23/Nov/12 14:59"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-11-23T14:59:11+0000">23/Nov/12 14:59</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="09/May/16 18:33"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-05-09T18:33:43+0000">09/May/16 18:33</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="22/Mar/13 19:44"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-03-22T19:44:54+0000">22/Mar/13 19:44</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4571?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4571?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13503234\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13503234&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13503234\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13503234_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13503234_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Nov\\/12 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-23T15:50:38+0000\'\u003e23\\/Nov\\/12 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree we should try to use advance() with this scorer. If it has say 3 terms and one is a very common \u003cbr\\/\u003e\\nterm (e.g. stopword-type term), it will drag the entire query down.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eFor me the question no.1 is there a performance test for minShouldMatch constrained disjunction. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNo, currently there is not in luceneutil.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso it would be good to think about splitting out ordinary disjunctions from disjunctions-with-minNrShouldMatch\u003cbr\\/\u003e\\nfrom booleanscorer2. The simple disjunction case could then be easily optimized more (e.g. defer score() until necessary\u003cbr\\/\u003e\\nand so on).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13503234_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13503234_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Nov\\/12 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-23T15:50:38+0000\'\u003e23\\/Nov\\/12 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree we should try to use advance() with this scorer. If it has say 3 terms and one is a very common  \\nterm (e.g. stopword-type term), it will drag the entire query down. \\n\\n \\n For me the question no.1 is there a performance test for minShouldMatch constrained disjunction.   \\n\\n No, currently there is not in luceneutil. \\n\\n Also it would be good to think about splitting out ordinary disjunctions from disjunctions-with-minNrShouldMatch \\nfrom booleanscorer2. The simple disjunction case could then be easily optimized more (e.g. defer score() until necessary \\nand so on).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13503281\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13503281&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13503281\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mkhludnev\\\" id=\\\"commentauthor_13503281_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mkhludnev\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mkhludnev\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mikhail Khludnev\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13503281_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Nov\\/12 21:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-23T21:09:30+0000\'\u003e23\\/Nov\\/12 21:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt was a bad idea to reply to jira\'s mail. moving dialogue here:\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=mkhludnev\\\" class=\\\"user-hover\\\" rel=\\\"mkhludnev\\\"\u003eMikhail Khludnev\u003c\\/a\u003e\u003c\\/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eRobert, am I right that establishing the perf test is the first necessary step, rather than the implementation itself.\u003cbr\\/\u003e\\nAlso, (don\'t really important but let me mention) what I\'m really looking for is the disjunction query with an user supplied verification strategy, where minShouldMatch is just one of the way to verify match.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\" class=\\\"user-hover\\\" rel=\\\"rcmuir\\\"\u003eRobert Muir\u003c\\/a\u003e\u003c\\/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eRight, the best way to do this is to extend luceneutil (\u003ca href=\\\"http:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\u003c\\/a\u003e) to test this case.\u003c\\/p\u003e\\n\\n\u003cp\u003eKeep in mind that I\'d also be interested to see how BooleanScorer compares to BooleanScorer2 for this situation. I already mentioned on the solr list (nobody replied) that solr \u003cb\u003enever\u003c\\/b\u003e gets BooleanScorer, but from time to time I hear solr users complaining about BooleanScorer2\'s performance for min-should-match\u003c\\/p\u003e\\n\\n\u003cp\u003eSo when trying to improve the performance of min-should-match, I think a very early step should be to see if we already have a better performing alternative that is just not being used: if thats the case then the best solution is to fix Solr\'s collectors to be able to cope with BooleanScorer.\u003c\\/p\u003e\\n\\n\u003cp\u003eIntuitively I think its going to be like everything else, BS1 is better in some situations, BS2 in others.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt;&gt; Also, (don\'t really important but let me mention) what I\'m really looking for is the disjunction query with an user supplied verification strategy, where minShouldMatch is just one of the way to verify match.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think our concrete scorers should have such a hook: they should be as dead simple as possible.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you want to do this, I recommend just extending the abstract DisjunctionScorer (Currently DisjunctionSum and DisjunctionMax extend this, as I suggested we should think about splitting out a MinShouldMatchScorer as well: its confusing that pure disjunctions are all mixed up with min-should-match and the algorithms should actually work differently).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mkhludnev\\\" id=\\\"commentauthor_13503281_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mkhludnev\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mkhludnev\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mikhail Khludnev\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13503281_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Nov\\/12 21:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-23T21:09:30+0000\'\u003e23\\/Nov\\/12 21:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It was a bad idea to reply to jira\'s mail. moving dialogue here: \\n\\n  Mikhail Khludnev  \\n \\n Robert, am I right that establishing the perf test is the first necessary step, rather than the implementation itself. \\nAlso, (don\'t really important but let me mention) what I\'m really looking for is the disjunction query with an user supplied verification strategy, where minShouldMatch is just one of the way to verify match.  \\n\\n  Robert Muir  \\n \\n Right, the best way to do this is to extend luceneutil ( http:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil ) to test this case. \\n\\n Keep in mind that I\'d also be interested to see how BooleanScorer compares to BooleanScorer2 for this situation. I already mentioned on the solr list (nobody replied) that solr  never  gets BooleanScorer, but from time to time I hear solr users complaining about BooleanScorer2\'s performance for min-should-match \\n\\n So when trying to improve the performance of min-should-match, I think a very early step should be to see if we already have a better performing alternative that is just not being used: if thats the case then the best solution is to fix Solr\'s collectors to be able to cope with BooleanScorer. \\n\\n Intuitively I think its going to be like everything else, BS1 is better in some situations, BS2 in others. \\n\\n &gt;&gt;&gt; Also, (don\'t really important but let me mention) what I\'m really looking for is the disjunction query with an user supplied verification strategy, where minShouldMatch is just one of the way to verify match. \\n\\n I don\'t think our concrete scorers should have such a hook: they should be as dead simple as possible. \\n\\n If you want to do this, I recommend just extending the abstract DisjunctionScorer (Currently DisjunctionSum and DisjunctionMax extend this, as I suggested we should think about splitting out a MinShouldMatchScorer as well: its confusing that pure disjunctions are all mixed up with min-should-match and the algorithms should actually work differently).  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13504158\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13504158&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13504158\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13504158_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13504158_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Nov\\/12 21:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-26T21:50:55+0000\'\u003e26\\/Nov\\/12 21:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMikhail, Robert, thank you for following up on this and I\'m happy to provide more details on ideas of how to use the minimumMatch constraint to speed up the execution of disjunctive queries.\u003c\\/p\u003e\\n\\n\u003cp\u003eCurrently, one heap is used in disjunctive scorers to keep track of the next docid (next candidate), and only then these candidates are ruled out if below minimum number of terms \\/ percentage of terms. If there is only one stop word or otherwise high docfreq term in the query, this will produce a huge number of candidates that only occur in very few query terms and only afterwards will be ruled out by the constraint again. As Robert pointed out, this leads to long processing times to attain the next valid candidate. Using BooleanScorer will probably only give improvement by a factor (in some cases), but also this scorers would still generate all these useless candidates.\u003cbr\\/\u003e\\nIt would be much more efficient to actively use the constraint as part of query processing and employ inverted list skipping (leap-frogging), which makes conjunctive queries so efficient, also for these kind of queries.\u003c\\/p\u003e\\n\\n\u003cp\u003eAn efficient implementation could look like the following:\u003cbr\\/\u003e\\nAssume at least 5 out of 20 query terms have to match and imagine the terms\\/inverted lists to be sorted by the next docid. Then, the first potential candidate that satisfies the constraint would be the docid at position 5 and all of the inverted list at position 0-4 can be safely advanced and have to match to that docid in order to generate a real candidate worth scoring. The order, in which to try advancing terms 0-4 should probably be guided by the sparsity of the lists (guided by either docfreq, if available, or a heuristic such as the distance to the next docid), that is, inverted list 4 should first be advanced to the docid, then list 3,2,1, if previous advances are successful. Otherwise, the algorithm can start all over and try the next docid at 5th position. This leads to effective leap-frogging on the most sparse lists within the constraint which rules out matches not satisfying the constraint, most of the time without even touching the very high-frequency terms. Improvements all depend on the type of queries and number of docs per index.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are different implementations possible to achieve such a behavior:\u003cbr\\/\u003e\\n1) Using the current heap and pull out the first 5 lists to get to the next candidate docid to which the other 4 then have to be advanced. This probably leads to more heap removal and addition operations than necessary with the next approaches.\u003cbr\\/\u003e\\n2) Always keep the first 5 lists fully sorted and use the heap to keep track of the next docid within lists 6-20. This invariant should simplify implementation and be competitive for small minimumMatch.\u003cbr\\/\u003e\\n3) Use two heaps: A max-heap to keep track of the largest docid within the first 5 inverted lists and a min-heap to keep track of the smallest docid within lists 6-20. This approach looks most efficient.\u003c\\/p\u003e\\n\\n\u003cp\u003eThese implementations look like generalizations to pure disjunctive queries, but if there should be any impact they could be implemented as specializations used only for queries with a minimum match constraint.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13504158_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13504158_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Nov\\/12 21:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-26T21:50:55+0000\'\u003e26\\/Nov\\/12 21:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mikhail, Robert, thank you for following up on this and I\'m happy to provide more details on ideas of how to use the minimumMatch constraint to speed up the execution of disjunctive queries. \\n\\n Currently, one heap is used in disjunctive scorers to keep track of the next docid (next candidate), and only then these candidates are ruled out if below minimum number of terms \\/ percentage of terms. If there is only one stop word or otherwise high docfreq term in the query, this will produce a huge number of candidates that only occur in very few query terms and only afterwards will be ruled out by the constraint again. As Robert pointed out, this leads to long processing times to attain the next valid candidate. Using BooleanScorer will probably only give improvement by a factor (in some cases), but also this scorers would still generate all these useless candidates. \\nIt would be much more efficient to actively use the constraint as part of query processing and employ inverted list skipping (leap-frogging), which makes conjunctive queries so efficient, also for these kind of queries. \\n\\n An efficient implementation could look like the following: \\nAssume at least 5 out of 20 query terms have to match and imagine the terms\\/inverted lists to be sorted by the next docid. Then, the first potential candidate that satisfies the constraint would be the docid at position 5 and all of the inverted list at position 0-4 can be safely advanced and have to match to that docid in order to generate a real candidate worth scoring. The order, in which to try advancing terms 0-4 should probably be guided by the sparsity of the lists (guided by either docfreq, if available, or a heuristic such as the distance to the next docid), that is, inverted list 4 should first be advanced to the docid, then list 3,2,1, if previous advances are successful. Otherwise, the algorithm can start all over and try the next docid at 5th position. This leads to effective leap-frogging on the most sparse lists within the constraint which rules out matches not satisfying the constraint, most of the time without even touching the very high-frequency terms. Improvements all depend on the type of queries and number of docs per index. \\n\\n There are different implementations possible to achieve such a behavior: \\n1) Using the current heap and pull out the first 5 lists to get to the next candidate docid to which the other 4 then have to be advanced. This probably leads to more heap removal and addition operations than necessary with the next approaches. \\n2) Always keep the first 5 lists fully sorted and use the heap to keep track of the next docid within lists 6-20. This invariant should simplify implementation and be competitive for small minimumMatch. \\n3) Use two heaps: A max-heap to keep track of the largest docid within the first 5 inverted lists and a min-heap to keep track of the smallest docid within lists 6-20. This approach looks most efficient. \\n\\n These implementations look like generalizations to pure disjunctive queries, but if there should be any impact they could be implemented as specializations used only for queries with a minimum match constraint.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13504180\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13504180&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13504180\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13504180_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13504180_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Nov\\/12 22:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-26T22:14:05+0000\'\u003e26\\/Nov\\/12 22:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI like the ideas Stefan!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eUsing BooleanScorer will probably only give improvement by a factor (in some cases), but also this scorers would still generate all these useless candidates.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt might be hard to beat this one (which already supports minShouldMatch as a side effect of its coord computation anyway i think) in cases with\u003cbr\\/\u003e\\nlots of terms because I feel like inevitably supporting advance() on the subscorers will result in more heap operations\\/cpu (at least when i messed around on paper it seemed this way).\u003c\\/p\u003e\\n\\n\u003cp\u003eIn fact in some situations I think even this one should be used when there are mandatory clauses: in any case booleanweight should have better heuristics to decide, limited by what the collector can deal with.\u003c\\/p\u003e\\n\\n\u003cp\u003eCollectors that support out of order scoring today I think are likely a lot faster with these minShouldMatch types of queries than BooleanScorer2. Thats why i brought it up: it could be an easy win for e.g. solr users.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut when the number of terms is smallish and one is super-common, its silly we don\'t try to improve the BS2 impl to at least try to handle the worst case \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003eAt least for the sake of simplicity (not necessarily performance) I still think it would be good to factor minshouldmatch behavior out of disjunctionsumscorer if we try to make it use advance() on subscorers.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13504180_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13504180_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Nov\\/12 22:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-26T22:14:05+0000\'\u003e26\\/Nov\\/12 22:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I like the ideas Stefan! \\n\\n \\n Using BooleanScorer will probably only give improvement by a factor (in some cases), but also this scorers would still generate all these useless candidates.  \\n\\n It might be hard to beat this one (which already supports minShouldMatch as a side effect of its coord computation anyway i think) in cases with \\nlots of terms because I feel like inevitably supporting advance() on the subscorers will result in more heap operations\\/cpu (at least when i messed around on paper it seemed this way). \\n\\n In fact in some situations I think even this one should be used when there are mandatory clauses: in any case booleanweight should have better heuristics to decide, limited by what the collector can deal with. \\n\\n Collectors that support out of order scoring today I think are likely a lot faster with these minShouldMatch types of queries than BooleanScorer2. Thats why i brought it up: it could be an easy win for e.g. solr users. \\n\\n But when the number of terms is smallish and one is super-common, its silly we don\'t try to improve the BS2 impl to at least try to handle the worst case    \\n\\n At least for the sake of simplicity (not necessarily performance) I still think it would be good to factor minshouldmatch behavior out of disjunctionsumscorer if we try to make it use advance() on subscorers.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13582325\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13582325&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13582325\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13582325_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582325_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 17:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T17:03:02+0000\'\u003e20\\/Feb\\/13 17:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRobert, thank you for the excellent feedback.\u003c\\/p\u003e\\n\\n\u003cp\u003eI didn\'t look at the BS in detail for a while, and all you say sounds very reasonable. My statement \\\"improvement by a factor\\\" was under the assumption that BS would similarly to BS2 generate all OR-candidates and only afterwards screen out many of them again due to the minimum-match constraint. If that\'s the case and we assume BS to be faster than BS2 by some factor, then it will be the very same factor faster with a larger collection, whereas an optimized BS2 might become faster than BS because it does not generate many useless candidates for queries that have only one super-common term (proportional to document collection size) and a minimum-match constraint of at least 2. Hope this makes sense now, but of course my assumption might be wrong \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eIn fact, I got to think quite a bit about different approaches on how to implement a minimum-match optimized version of BS2 and converged on implementation approach 1) due to the others adding other expensive operations\\/overhead when getting down to all details. The attached patch contains a full drop-in replacement for the DisjunctionSumScorer in DisjunctionSumScorerMM.java and accordingly changes references within BooleanScorer2. All existing tests pass.\u003cbr\\/\u003e\\nAs this scorer is supposed to work with any subclauses (not only TermQuery), I decided for an implementation that dynamically orders the first mm-1 subscorers by the next docid, hence exploiting local within-inverted-list docid distributions. Fixing the mm-1 subscorers on basis of their doc frequency\\/sparseness estimation could be better (less heap operations, but no exploitation of within-list docid distributions), but this is currently only available for TermQuery as clauses and would hence limit the applicability of the implementation. Having an API to determine the sparseness of a subscorer already came up in some other tickets and many other Scorer implementations could similarly benefit from its availability.\u003c\\/p\u003e\\n\\n\u003cp\u003eI however share your thinking about not intermingling too many aspects within one Scorer, making it overly complex and probably less amenable for VM optimizations (e.g. not as tight loops). This is why I implemented it in a different class, so you could go ahead and remove the mm-constraint from DisjunctionSumScorer and use either implementation depending on the given query.\u003cbr\\/\u003e\\nAlso, this implementation could still be tested response-time-wise for different representative queries of interest and different mm-constraint settings (luceneutil?). I wouldn\'t be surprised if my implementation is not as quick as DisjunctionSumScorer when mm=1, but I have anecdotal evidence that it does a great job (speedups of 2-3) for higher mm (and longer queries).\u003cbr\\/\u003e\\nI don\'t quite see why the attached implementation would do more heap operations, but I agree that it could be slower due to lengthier\\/more complex loops, a few more if statements etc.\u003c\\/p\u003e\\n\\n\u003cp\u003eHope this contribution helps.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13582325_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582325_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 17:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T17:03:02+0000\'\u003e20\\/Feb\\/13 17:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Robert, thank you for the excellent feedback. \\n\\n I didn\'t look at the BS in detail for a while, and all you say sounds very reasonable. My statement \\\"improvement by a factor\\\" was under the assumption that BS would similarly to BS2 generate all OR-candidates and only afterwards screen out many of them again due to the minimum-match constraint. If that\'s the case and we assume BS to be faster than BS2 by some factor, then it will be the very same factor faster with a larger collection, whereas an optimized BS2 might become faster than BS because it does not generate many useless candidates for queries that have only one super-common term (proportional to document collection size) and a minimum-match constraint of at least 2. Hope this makes sense now, but of course my assumption might be wrong   \\n\\n In fact, I got to think quite a bit about different approaches on how to implement a minimum-match optimized version of BS2 and converged on implementation approach 1) due to the others adding other expensive operations\\/overhead when getting down to all details. The attached patch contains a full drop-in replacement for the DisjunctionSumScorer in DisjunctionSumScorerMM.java and accordingly changes references within BooleanScorer2. All existing tests pass. \\nAs this scorer is supposed to work with any subclauses (not only TermQuery), I decided for an implementation that dynamically orders the first mm-1 subscorers by the next docid, hence exploiting local within-inverted-list docid distributions. Fixing the mm-1 subscorers on basis of their doc frequency\\/sparseness estimation could be better (less heap operations, but no exploitation of within-list docid distributions), but this is currently only available for TermQuery as clauses and would hence limit the applicability of the implementation. Having an API to determine the sparseness of a subscorer already came up in some other tickets and many other Scorer implementations could similarly benefit from its availability. \\n\\n I however share your thinking about not intermingling too many aspects within one Scorer, making it overly complex and probably less amenable for VM optimizations (e.g. not as tight loops). This is why I implemented it in a different class, so you could go ahead and remove the mm-constraint from DisjunctionSumScorer and use either implementation depending on the given query. \\nAlso, this implementation could still be tested response-time-wise for different representative queries of interest and different mm-constraint settings (luceneutil?). I wouldn\'t be surprised if my implementation is not as quick as DisjunctionSumScorer when mm=1, but I have anecdotal evidence that it does a great job (speedups of 2-3) for higher mm (and longer queries). \\nI don\'t quite see why the attached implementation would do more heap operations, but I agree that it could be slower due to lengthier\\/more complex loops, a few more if statements etc. \\n\\n Hope this contribution helps.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13582337\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13582337&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13582337\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13582337_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582337_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 17:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T17:11:16+0000\'\u003e20\\/Feb\\/13 17:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eStefan this looks very promising! I think we should add support for this query to luceneutil and try it out.\u003c\\/p\u003e\\n\\n\u003cp\u003eAbout the docfreq idea, a scorer\\/disi cost estimation patch exists in at least two places. For example termscorer returns docfreq. Disjunctions return sum over their subscorers. Actually this speeds up conjunctions in general and removes the need for the specialized conjunctiontermscorer. I think it would be useful here too? I\'ll find the link and add it to a comment in a bit\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13582337_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582337_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 17:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T17:11:16+0000\'\u003e20\\/Feb\\/13 17:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Stefan this looks very promising! I think we should add support for this query to luceneutil and try it out. \\n\\n About the docfreq idea, a scorer\\/disi cost estimation patch exists in at least two places. For example termscorer returns docfreq. Disjunctions return sum over their subscorers. Actually this speeds up conjunctions in general and removes the need for the specialized conjunctiontermscorer. I think it would be useful here too? I\'ll find the link and add it to a comment in a bit              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13582347\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13582347&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13582347\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13582347_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582347_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 17:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T17:21:51+0000\'\u003e20\\/Feb\\/13 17:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s the most recent patch for what I discussed: \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4607\\\" title=\\\"Add estimateDocCount to DocIdSetIterator\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4607\\\"\u003e\u003cdel\u003eLUCENE-4607\u003c\\/del\u003e\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13582347_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582347_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 17:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T17:21:51+0000\'\u003e20\\/Feb\\/13 17:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s the most recent patch for what I discussed:   LUCENE-4607                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13582453\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13582453&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13582453\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13582453_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582453_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T19:35:03+0000\'\u003e20\\/Feb\\/13 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI fixed luceneutil to recognize +minShouldMatch=N, and made a trivial\u003cbr\\/\u003e\\ntasks file:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eHighMinShouldMatch4: ref http from name title +minShouldMatch=4\\nHighMinShouldMatch3: ref http from name title +minShouldMatch=3\\nHighMinShouldMatch2: ref http from name title +minShouldMatch=2\\nHighMinShouldMatch0: ref http from name title\\nLow1MinShouldMatch4: ref http from name dublin +minShouldMatch=4\\nLow1MinShouldMatch3: ref http from name dublin +minShouldMatch=3\\nLow1MinShouldMatch2: ref http from name dublin +minShouldMatch=2\\nLow1MinShouldMatch0: ref http from name dublin\\nLow2MinShouldMatch4: ref http from wings dublin +minShouldMatch=4\\nLow2MinShouldMatch3: ref http from wings dublin +minShouldMatch=3\\nLow2MinShouldMatch2: ref http from wings dublin +minShouldMatch=2\\nLow2MinShouldMatch0: ref http from wings dublin\\nLow3MinShouldMatch4: ref http struck wings dublin +minShouldMatch=4\\nLow3MinShouldMatch3: ref http struck wings dublin +minShouldMatch=3\\nLow3MinShouldMatch2: ref http struck wings dublin +minShouldMatch=2\\nLow3MinShouldMatch0: ref http struck wings dublin\\nLow4MinShouldMatch4: ref restored struck wings dublin +minShouldMatch=4\\nLow4MinShouldMatch3: ref restored struck wings dublin +minShouldMatch=3\\nLow4MinShouldMatch2: ref restored struck wings dublin +minShouldMatch=2\\nLow4MinShouldMatch0: ref restored struck wings dublin\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo, each query has 5 terms.  High* means all 5 are high freq, Low1*\u003cbr\\/\u003e\\nmeans one term is low freq and 4 are high, Low2* means 2 terms are low\u003cbr\\/\u003e\\nfreq and 3 are high, etc.\u003c\\/p\u003e\\n\\n\u003cp\u003eI tested on the 10 M doc wikimedium index, and for both base (= trunk)\u003cbr\\/\u003e\\nand comp (= this patch) I forcefully disabled BS1:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n     Low3MinShouldMatch2        3.95      (3.5%)        3.00      (2.1%)  -24.1% ( -28% -  -19%)\\n     Low1MinShouldMatch2        1.93      (3.1%)        1.50      (2.1%)  -22.4% ( -26% -  -17%)\\n     Low2MinShouldMatch2        2.52      (3.4%)        1.96      (2.0%)  -22.3% ( -26% -  -17%)\\n     HighMinShouldMatch2        1.62      (3.2%)        1.27      (2.2%)  -21.3% ( -25% -  -16%)\\n     HighMinShouldMatch3        1.65      (3.5%)        1.31      (2.3%)  -20.7% ( -25% -  -15%)\\n     Low4MinShouldMatch0        6.91      (3.9%)        5.79      (1.6%)  -16.2% ( -20% -  -11%)\\n     Low1MinShouldMatch3        1.98      (3.4%)        1.66      (2.3%)  -15.8% ( -20% -  -10%)\\n     Low3MinShouldMatch0        3.69      (3.2%)        3.21      (2.1%)  -13.0% ( -17% -   -8%)\\n     Low2MinShouldMatch0        2.38      (3.0%)        2.09      (1.9%)  -12.3% ( -16% -   -7%)\\n     Low1MinShouldMatch0        1.84      (2.7%)        1.65      (2.2%)  -10.4% ( -14% -   -5%)\\n     HighMinShouldMatch0        1.56      (2.9%)        1.41      (2.5%)   -9.8% ( -14% -   -4%)\\n     HighMinShouldMatch4        1.67      (3.6%)        1.55      (2.8%)   -7.1% ( -13% -    0%)\\n     Low2MinShouldMatch3        2.64      (3.8%)        2.65      (2.4%)    0.3% (  -5% -    6%)\\n     Low1MinShouldMatch4        2.02      (3.5%)        2.36      (2.8%)   16.8% (  10% -   23%)\\n     Low4MinShouldMatch2        8.53      (5.3%)       33.74      (5.8%)  295.8% ( 270% -  324%)\\n     Low4MinShouldMatch3        8.56      (5.4%)       44.93      (8.6%)  424.8% ( 389% -  463%)\\n     Low3MinShouldMatch3        4.25      (4.1%)       23.48      (8.8%)  452.7% ( 422% -  485%)\\n     Low4MinShouldMatch4        8.59      (5.2%)       59.53     (11.1%)  593.3% ( 548% -  643%)\\n     Low2MinShouldMatch4        2.68      (3.9%)       21.38     (14.3%)  696.8% ( 653% -  743%)\\n     Low3MinShouldMatch4        4.25      (4.1%)       34.97     (15.4%)  722.5% ( 675% -  773%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe new scorer is waaay faster when the minShouldMatch constraint is\u003cbr\\/\u003e\\nhighly restrictive, i.e. when .advance is being used on only low-freq\u003cbr\\/\u003e\\nterms (I think?).  It a bit slower for the no-minShouldMatch case\u003cbr\\/\u003e\\n(*MinShouldMatch0).  When .advance is sometimes used on the high freq\u003cbr\\/\u003e\\nterms it\'s a bit slower than BS2 today.\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran a 2nd test, this time with BS1 as the baseline.  BS1 is faster\u003cbr\\/\u003e\\nthan BS2, but indeed it still evaluates all subs and only rules out\u003cbr\\/\u003e\\nminShouldMmatch in the end.  I had to turn off luceneutil\'s score\u003cbr\\/\u003e\\ncomparisons since BS1\\/BS2 produce different scores:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n     HighMinShouldMatch2        3.33      (8.8%)        1.30      (0.8%)  -60.9% ( -64% -  -56%)\\n     HighMinShouldMatch3        3.35      (8.8%)        1.33      (1.0%)  -60.5% ( -64% -  -55%)\\n     Low1MinShouldMatch2        3.79      (8.4%)        1.52      (0.9%)  -59.9% ( -63% -  -55%)\\n     HighMinShouldMatch0        3.46      (9.1%)        1.43      (0.4%)  -58.5% ( -62% -  -53%)\\n     Low1MinShouldMatch0        4.00      (8.9%)        1.68      (0.4%)  -58.0% ( -61% -  -53%)\\n     Low2MinShouldMatch2        4.66      (8.0%)        1.99      (1.0%)  -57.3% ( -61% -  -52%)\\n     Low2MinShouldMatch0        4.97      (8.6%)        2.12      (0.4%)  -57.3% ( -61% -  -52%)\\n     Low1MinShouldMatch3        3.85      (8.6%)        1.68      (1.1%)  -56.3% ( -60% -  -50%)\\n     Low4MinShouldMatch0       13.32      (8.8%)        5.87      (0.5%)  -56.0% ( -59% -  -51%)\\n     Low3MinShouldMatch2        6.87      (8.4%)        3.03      (1.0%)  -55.9% ( -60% -  -50%)\\n     Low3MinShouldMatch0        7.13      (8.7%)        3.27      (0.5%)  -54.1% ( -58% -  -49%)\\n     HighMinShouldMatch4        3.40      (9.0%)        1.57      (1.3%)  -53.9% ( -58% -  -47%)\\n     Low2MinShouldMatch3        4.92      (8.4%)        2.67      (1.4%)  -45.8% ( -51% -  -39%)\\n     Low1MinShouldMatch4        4.04      (8.9%)        2.37      (1.5%)  -41.2% ( -47% -  -33%)\\n     Low4MinShouldMatch2       14.17      (9.1%)       33.77      (2.9%)  138.4% ( 115% -  165%)\\n     Low4MinShouldMatch3       14.28      (9.1%)       44.93      (3.1%)  214.7% ( 185% -  249%)\\n     Low3MinShouldMatch3        7.39      (9.1%)       23.47      (3.7%)  217.4% ( 187% -  253%)\\n     Low2MinShouldMatch4        5.13      (8.8%)       21.36      (5.5%)  316.4% ( 277% -  362%)\\n     Low4MinShouldMatch4       14.30      (9.0%)       59.65      (4.4%)  317.3% ( 278% -  363%)\\n     Low3MinShouldMatch4        7.41      (9.1%)       34.92      (5.2%)  371.2% ( 327% -  424%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo it looks like BS1 is faster when the minShouldMatch isn\'t very\u003cbr\\/\u003e\\nrestrictive ... somehow we need some heuristics for BQ to pick the\u003cbr\\/\u003e\\nbest scorer given the estimated cost\\/number of hits of each subs vs\u003cbr\\/\u003e\\nthe minShouldMatch constraint (only in those cases when BS1 is\u003cbr\\/\u003e\\n\\\"allowed\\\"...).\u003c\\/p\u003e\\n\\n\u003cp\u003eBut given that this new scorer drastically speeds up the BS2 case in the highly\u003cbr\\/\u003e\\nrestrictive cases, and only slows it down a bit for the other cases, I\u003cbr\\/\u003e\\nthink we should commit the new scorer, and then separately iterate on\u003cbr\\/\u003e\\nthe heuristics for when to choose which sub scorer?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13582453_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582453_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T19:35:03+0000\'\u003e20\\/Feb\\/13 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I fixed luceneutil to recognize +minShouldMatch=N, and made a trivial \\ntasks file: \\n\\n  \\n HighMinShouldMatch4: ref http from name title +minShouldMatch=4\\nHighMinShouldMatch3: ref http from name title +minShouldMatch=3\\nHighMinShouldMatch2: ref http from name title +minShouldMatch=2\\nHighMinShouldMatch0: ref http from name title\\nLow1MinShouldMatch4: ref http from name dublin +minShouldMatch=4\\nLow1MinShouldMatch3: ref http from name dublin +minShouldMatch=3\\nLow1MinShouldMatch2: ref http from name dublin +minShouldMatch=2\\nLow1MinShouldMatch0: ref http from name dublin\\nLow2MinShouldMatch4: ref http from wings dublin +minShouldMatch=4\\nLow2MinShouldMatch3: ref http from wings dublin +minShouldMatch=3\\nLow2MinShouldMatch2: ref http from wings dublin +minShouldMatch=2\\nLow2MinShouldMatch0: ref http from wings dublin\\nLow3MinShouldMatch4: ref http struck wings dublin +minShouldMatch=4\\nLow3MinShouldMatch3: ref http struck wings dublin +minShouldMatch=3\\nLow3MinShouldMatch2: ref http struck wings dublin +minShouldMatch=2\\nLow3MinShouldMatch0: ref http struck wings dublin\\nLow4MinShouldMatch4: ref restored struck wings dublin +minShouldMatch=4\\nLow4MinShouldMatch3: ref restored struck wings dublin +minShouldMatch=3\\nLow4MinShouldMatch2: ref restored struck wings dublin +minShouldMatch=2\\nLow4MinShouldMatch0: ref restored struck wings dublin\\n \\n  \\n\\n So, each query has 5 terms.  High* means all 5 are high freq, Low1* \\nmeans one term is low freq and 4 are high, Low2* means 2 terms are low \\nfreq and 3 are high, etc. \\n\\n I tested on the 10 M doc wikimedium index, and for both base (= trunk) \\nand comp (= this patch) I forcefully disabled BS1: \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n     Low3MinShouldMatch2        3.95      (3.5%)        3.00      (2.1%)  -24.1% ( -28% -  -19%)\\n     Low1MinShouldMatch2        1.93      (3.1%)        1.50      (2.1%)  -22.4% ( -26% -  -17%)\\n     Low2MinShouldMatch2        2.52      (3.4%)        1.96      (2.0%)  -22.3% ( -26% -  -17%)\\n     HighMinShouldMatch2        1.62      (3.2%)        1.27      (2.2%)  -21.3% ( -25% -  -16%)\\n     HighMinShouldMatch3        1.65      (3.5%)        1.31      (2.3%)  -20.7% ( -25% -  -15%)\\n     Low4MinShouldMatch0        6.91      (3.9%)        5.79      (1.6%)  -16.2% ( -20% -  -11%)\\n     Low1MinShouldMatch3        1.98      (3.4%)        1.66      (2.3%)  -15.8% ( -20% -  -10%)\\n     Low3MinShouldMatch0        3.69      (3.2%)        3.21      (2.1%)  -13.0% ( -17% -   -8%)\\n     Low2MinShouldMatch0        2.38      (3.0%)        2.09      (1.9%)  -12.3% ( -16% -   -7%)\\n     Low1MinShouldMatch0        1.84      (2.7%)        1.65      (2.2%)  -10.4% ( -14% -   -5%)\\n     HighMinShouldMatch0        1.56      (2.9%)        1.41      (2.5%)   -9.8% ( -14% -   -4%)\\n     HighMinShouldMatch4        1.67      (3.6%)        1.55      (2.8%)   -7.1% ( -13% -    0%)\\n     Low2MinShouldMatch3        2.64      (3.8%)        2.65      (2.4%)    0.3% (  -5% -    6%)\\n     Low1MinShouldMatch4        2.02      (3.5%)        2.36      (2.8%)   16.8% (  10% -   23%)\\n     Low4MinShouldMatch2        8.53      (5.3%)       33.74      (5.8%)  295.8% ( 270% -  324%)\\n     Low4MinShouldMatch3        8.56      (5.4%)       44.93      (8.6%)  424.8% ( 389% -  463%)\\n     Low3MinShouldMatch3        4.25      (4.1%)       23.48      (8.8%)  452.7% ( 422% -  485%)\\n     Low4MinShouldMatch4        8.59      (5.2%)       59.53     (11.1%)  593.3% ( 548% -  643%)\\n     Low2MinShouldMatch4        2.68      (3.9%)       21.38     (14.3%)  696.8% ( 653% -  743%)\\n     Low3MinShouldMatch4        4.25      (4.1%)       34.97     (15.4%)  722.5% ( 675% -  773%)\\n \\n  \\n\\n The new scorer is waaay faster when the minShouldMatch constraint is \\nhighly restrictive, i.e. when .advance is being used on only low-freq \\nterms (I think?).  It a bit slower for the no-minShouldMatch case \\n(*MinShouldMatch0).  When .advance is sometimes used on the high freq \\nterms it\'s a bit slower than BS2 today. \\n\\n I ran a 2nd test, this time with BS1 as the baseline.  BS1 is faster \\nthan BS2, but indeed it still evaluates all subs and only rules out \\nminShouldMmatch in the end.  I had to turn off luceneutil\'s score \\ncomparisons since BS1\\/BS2 produce different scores: \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n     HighMinShouldMatch2        3.33      (8.8%)        1.30      (0.8%)  -60.9% ( -64% -  -56%)\\n     HighMinShouldMatch3        3.35      (8.8%)        1.33      (1.0%)  -60.5% ( -64% -  -55%)\\n     Low1MinShouldMatch2        3.79      (8.4%)        1.52      (0.9%)  -59.9% ( -63% -  -55%)\\n     HighMinShouldMatch0        3.46      (9.1%)        1.43      (0.4%)  -58.5% ( -62% -  -53%)\\n     Low1MinShouldMatch0        4.00      (8.9%)        1.68      (0.4%)  -58.0% ( -61% -  -53%)\\n     Low2MinShouldMatch2        4.66      (8.0%)        1.99      (1.0%)  -57.3% ( -61% -  -52%)\\n     Low2MinShouldMatch0        4.97      (8.6%)        2.12      (0.4%)  -57.3% ( -61% -  -52%)\\n     Low1MinShouldMatch3        3.85      (8.6%)        1.68      (1.1%)  -56.3% ( -60% -  -50%)\\n     Low4MinShouldMatch0       13.32      (8.8%)        5.87      (0.5%)  -56.0% ( -59% -  -51%)\\n     Low3MinShouldMatch2        6.87      (8.4%)        3.03      (1.0%)  -55.9% ( -60% -  -50%)\\n     Low3MinShouldMatch0        7.13      (8.7%)        3.27      (0.5%)  -54.1% ( -58% -  -49%)\\n     HighMinShouldMatch4        3.40      (9.0%)        1.57      (1.3%)  -53.9% ( -58% -  -47%)\\n     Low2MinShouldMatch3        4.92      (8.4%)        2.67      (1.4%)  -45.8% ( -51% -  -39%)\\n     Low1MinShouldMatch4        4.04      (8.9%)        2.37      (1.5%)  -41.2% ( -47% -  -33%)\\n     Low4MinShouldMatch2       14.17      (9.1%)       33.77      (2.9%)  138.4% ( 115% -  165%)\\n     Low4MinShouldMatch3       14.28      (9.1%)       44.93      (3.1%)  214.7% ( 185% -  249%)\\n     Low3MinShouldMatch3        7.39      (9.1%)       23.47      (3.7%)  217.4% ( 187% -  253%)\\n     Low2MinShouldMatch4        5.13      (8.8%)       21.36      (5.5%)  316.4% ( 277% -  362%)\\n     Low4MinShouldMatch4       14.30      (9.0%)       59.65      (4.4%)  317.3% ( 278% -  363%)\\n     Low3MinShouldMatch4        7.41      (9.1%)       34.92      (5.2%)  371.2% ( 327% -  424%)\\n \\n  \\n\\n So it looks like BS1 is faster when the minShouldMatch isn\'t very \\nrestrictive ... somehow we need some heuristics for BQ to pick the \\nbest scorer given the estimated cost\\/number of hits of each subs vs \\nthe minShouldMatch constraint (only in those cases when BS1 is \\n\\\"allowed\\\"...). \\n\\n But given that this new scorer drastically speeds up the BS2 case in the highly \\nrestrictive cases, and only slows it down a bit for the other cases, I \\nthink we should commit the new scorer, and then separately iterate on \\nthe heuristics for when to choose which sub scorer?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13582816\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13582816&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13582816\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13582816_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582816_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 02:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T02:41:49+0000\'\u003e21\\/Feb\\/13 02:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eBut given that this new scorer drastically speeds up the BS2 case in the highly\u003cbr\\/\u003e\\nrestrictive cases, and only slows it down a bit for the other cases, I\u003cbr\\/\u003e\\nthink we should commit the new scorer, and then separately iterate on\u003cbr\\/\u003e\\nthe heuristics for when to choose which sub scorer?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think so too. I am jetlagged so will spend lots of time reviewing the patch tomorrow morning.\u003c\\/p\u003e\\n\\n\u003cp\u003eI do think we should fix our DisjunctionSumScorer to no longer do minShouldMatch and use it for mm=1\u003cbr\\/\u003e\\nas indicated by Stefan in his comment. This would remove all the XXX0 cases from being slower to\u003cbr\\/\u003e\\neither being the same or slightly faster. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eSeparately I can\'t help but be curious how the patch would perform if we combined it with \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4607\\\" title=\\\"Add estimateDocCount to DocIdSetIterator\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4607\\\"\u003e\u003cdel\u003eLUCENE-4607\u003c\\/del\u003e\u003c\\/a\u003e\u003cbr\\/\u003e\\npatch (as we know this significantly helped conjunctions). As Stefan\'s TODO indicates, this would \u003cbr\\/\u003e\\nreduce some of the cpu overhead of this in some of the worst cases as well, and I think the \u003cbr\\/\u003e\\nperformance would all look just fine.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13582816_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582816_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 02:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T02:41:49+0000\'\u003e21\\/Feb\\/13 02:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n But given that this new scorer drastically speeds up the BS2 case in the highly \\nrestrictive cases, and only slows it down a bit for the other cases, I \\nthink we should commit the new scorer, and then separately iterate on \\nthe heuristics for when to choose which sub scorer?  \\n\\n I think so too. I am jetlagged so will spend lots of time reviewing the patch tomorrow morning. \\n\\n I do think we should fix our DisjunctionSumScorer to no longer do minShouldMatch and use it for mm=1 \\nas indicated by Stefan in his comment. This would remove all the XXX0 cases from being slower to \\neither being the same or slightly faster.   \\n\\n Separately I can\'t help but be curious how the patch would perform if we combined it with   LUCENE-4607   \\npatch (as we know this significantly helped conjunctions). As Stefan\'s TODO indicates, this would  \\nreduce some of the cpu overhead of this in some of the worst cases as well, and I think the  \\nperformance would all look just fine.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13583163\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13583163&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13583163\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13583163_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583163_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 13:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T13:09:26+0000\'\u003e21\\/Feb\\/13 13:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eI broke out the two cases such that pure disjunctions (without minShouldMatch) use DisjunctionSumScorer.\u003c\\/li\u003e\\n\\t\u003cli\u003eI removed all minShouldMatch stuff from DisjunctionSumScorer, because it no longer needs to count to determine matches, I also made the counting lazy in score()... booleanscorer2 caches this anyway to ensure its only called once.\u003c\\/li\u003e\\n\\t\u003cli\u003eI renamed Stefan\'s new scorer to MinShouldMatchScorer (I liked this name better)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eMike how hard is it to re-run your bench with this patch? I am currently on a laptop!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13583163_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583163_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 13:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T13:09:26+0000\'\u003e21\\/Feb\\/13 13:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch: \\n \\n\\t I broke out the two cases such that pure disjunctions (without minShouldMatch) use DisjunctionSumScorer. \\n\\t I removed all minShouldMatch stuff from DisjunctionSumScorer, because it no longer needs to count to determine matches, I also made the counting lazy in score()... booleanscorer2 caches this anyway to ensure its only called once. \\n\\t I renamed Stefan\'s new scorer to MinShouldMatchScorer (I liked this name better) \\n \\n\\n\\n Mike how hard is it to re-run your bench with this patch? I am currently on a laptop!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13583166\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13583166&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13583166\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13583166_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583166_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 13:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T13:14:24+0000\'\u003e21\\/Feb\\/13 13:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eExcellent, I will re-test!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13583166_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583166_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 13:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T13:14:24+0000\'\u003e21\\/Feb\\/13 13:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Excellent, I will re-test!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13583197\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13583197&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13583197\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13583197_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583197_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 13:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T13:55:07+0000\'\u003e21\\/Feb\\/13 13:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebase=trunk, comp=new patch (forced to use BS2):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n     Low3MinShouldMatch2        3.99      (3.1%)        3.09      (4.0%)  -22.5% ( -28% -  -15%)\\n     Low2MinShouldMatch2        2.55      (3.1%)        2.01      (3.2%)  -21.1% ( -26% -  -15%)\\n     Low1MinShouldMatch2        1.94      (3.1%)        1.53      (3.0%)  -21.1% ( -26% -  -15%)\\n     HighMinShouldMatch2        1.63      (3.3%)        1.30      (2.9%)  -20.1% ( -25% -  -14%)\\n     HighMinShouldMatch3        1.66      (3.7%)        1.35      (3.8%)  -18.8% ( -25% -  -11%)\\n     Low4MinShouldMatch0        7.00      (3.2%)        5.94      (0.6%)  -15.2% ( -18% -  -11%)\\n     Low1MinShouldMatch3        2.00      (3.4%)        1.72      (4.3%)  -13.7% ( -20% -   -6%)\\n     Low3MinShouldMatch0        3.73      (2.8%)        3.29      (0.5%)  -11.7% ( -14% -   -8%)\\n     Low2MinShouldMatch0        2.41      (2.9%)        2.15      (0.6%)  -10.7% ( -13% -   -7%)\\n     Low1MinShouldMatch0        1.86      (2.8%)        1.69      (0.8%)   -9.3% ( -12% -   -5%)\\n     HighMinShouldMatch0        1.57      (3.1%)        1.44      (0.8%)   -8.7% ( -12% -   -4%)\\n     HighMinShouldMatch4        1.69      (3.8%)        1.62      (5.2%)   -4.3% ( -12% -    4%)\\n     Low2MinShouldMatch3        2.67      (3.5%)        2.76      (5.3%)    3.3% (  -5% -   12%)\\n     Low1MinShouldMatch4        2.04      (3.5%)        2.47      (6.4%)   20.7% (  10% -   31%)\\n     Low4MinShouldMatch2        8.66      (4.7%)       34.28      (9.3%)  295.7% ( 268% -  325%)\\n     Low4MinShouldMatch3        8.70      (4.8%)       45.76     (10.7%)  425.8% ( 391% -  463%)\\n     Low3MinShouldMatch3        4.30      (3.7%)       23.87     (14.0%)  455.6% ( 422% -  491%)\\n     Low4MinShouldMatch4        8.73      (4.4%)       60.81     (12.8%)  596.4% ( 554% -  641%)\\n     Low2MinShouldMatch4        2.71      (3.6%)       21.71     (19.0%)  700.4% ( 654% -  750%)\\n     Low3MinShouldMatch4        4.30      (3.7%)       35.44     (16.8%)  723.8% ( 678% -  772%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWeird that minShouldMatch0 is still a bit slower ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13583197_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583197_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 13:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T13:55:07+0000\'\u003e21\\/Feb\\/13 13:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    base=trunk, comp=new patch (forced to use BS2): \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n     Low3MinShouldMatch2        3.99      (3.1%)        3.09      (4.0%)  -22.5% ( -28% -  -15%)\\n     Low2MinShouldMatch2        2.55      (3.1%)        2.01      (3.2%)  -21.1% ( -26% -  -15%)\\n     Low1MinShouldMatch2        1.94      (3.1%)        1.53      (3.0%)  -21.1% ( -26% -  -15%)\\n     HighMinShouldMatch2        1.63      (3.3%)        1.30      (2.9%)  -20.1% ( -25% -  -14%)\\n     HighMinShouldMatch3        1.66      (3.7%)        1.35      (3.8%)  -18.8% ( -25% -  -11%)\\n     Low4MinShouldMatch0        7.00      (3.2%)        5.94      (0.6%)  -15.2% ( -18% -  -11%)\\n     Low1MinShouldMatch3        2.00      (3.4%)        1.72      (4.3%)  -13.7% ( -20% -   -6%)\\n     Low3MinShouldMatch0        3.73      (2.8%)        3.29      (0.5%)  -11.7% ( -14% -   -8%)\\n     Low2MinShouldMatch0        2.41      (2.9%)        2.15      (0.6%)  -10.7% ( -13% -   -7%)\\n     Low1MinShouldMatch0        1.86      (2.8%)        1.69      (0.8%)   -9.3% ( -12% -   -5%)\\n     HighMinShouldMatch0        1.57      (3.1%)        1.44      (0.8%)   -8.7% ( -12% -   -4%)\\n     HighMinShouldMatch4        1.69      (3.8%)        1.62      (5.2%)   -4.3% ( -12% -    4%)\\n     Low2MinShouldMatch3        2.67      (3.5%)        2.76      (5.3%)    3.3% (  -5% -   12%)\\n     Low1MinShouldMatch4        2.04      (3.5%)        2.47      (6.4%)   20.7% (  10% -   31%)\\n     Low4MinShouldMatch2        8.66      (4.7%)       34.28      (9.3%)  295.7% ( 268% -  325%)\\n     Low4MinShouldMatch3        8.70      (4.8%)       45.76     (10.7%)  425.8% ( 391% -  463%)\\n     Low3MinShouldMatch3        4.30      (3.7%)       23.87     (14.0%)  455.6% ( 422% -  491%)\\n     Low4MinShouldMatch4        8.73      (4.4%)       60.81     (12.8%)  596.4% ( 554% -  641%)\\n     Low2MinShouldMatch4        2.71      (3.6%)       21.71     (19.0%)  700.4% ( 654% -  750%)\\n     Low3MinShouldMatch4        4.30      (3.7%)       35.44     (16.8%)  723.8% ( 678% -  772%)\\n \\n  \\n\\n Weird that minShouldMatch0 is still a bit slower ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13583200\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13583200&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13583200\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13583200_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583200_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 13:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T13:59:08+0000\'\u003e21\\/Feb\\/13 13:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIts almost the same results as before... I find that crazy to believe (unless its a benchmarking bug?)\u003c\\/p\u003e\\n\\n\u003cp\u003eAre you sure you used latest patch? (the 19KB one). Worst case you could take this patch and \'svn revert\' DisjunctionSumScorer.java: if that shows any performance differences vs trunk then its definitely a bug in the benchmark.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13583200_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583200_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 13:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T13:59:08+0000\'\u003e21\\/Feb\\/13 13:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Its almost the same results as before... I find that crazy to believe (unless its a benchmarking bug?) \\n\\n Are you sure you used latest patch? (the 19KB one). Worst case you could take this patch and \'svn revert\' DisjunctionSumScorer.java: if that shows any performance differences vs trunk then its definitely a bug in the benchmark.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13583228\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13583228&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13583228\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13583228_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583228_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 14:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T14:36:16+0000\'\u003e21\\/Feb\\/13 14:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003egood news: I was able to get luceneutil with 1M collection working on my laptop and reproduce mike\'s problem (just with ordinary tasks set).\u003c\\/p\u003e\\n\\n\u003cp\u003eSo here\'s a patch reverting the cleanups to disjunctionsumscorer, but only using it when mm=1. This gives us same perf as trunk.\u003c\\/p\u003e\\n\\n\u003cp\u003eIll go and see what i screwed up as this is unintuitive, but it doesnt need to delay this patch anyway.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13583228_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583228_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 14:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T14:36:16+0000\'\u003e21\\/Feb\\/13 14:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    good news: I was able to get luceneutil with 1M collection working on my laptop and reproduce mike\'s problem (just with ordinary tasks set). \\n\\n So here\'s a patch reverting the cleanups to disjunctionsumscorer, but only using it when mm=1. This gives us same perf as trunk. \\n\\n Ill go and see what i screwed up as this is unintuitive, but it doesnt need to delay this patch anyway.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13583350\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13583350&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13583350\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13583350_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583350_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 16:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T16:53:30+0000\'\u003e21\\/Feb\\/13 16:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew patch results (BS2 trunk vs BS2 w\\/ last patch):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n     Low3MinShouldMatch2        3.95      (3.6%)        3.18      (3.5%)  -19.7% ( -25% -  -13%)\\n     Low1MinShouldMatch2        1.93      (3.0%)        1.57      (2.7%)  -18.8% ( -23% -  -13%)\\n     Low2MinShouldMatch2        2.53      (3.4%)        2.06      (2.8%)  -18.6% ( -23% -  -12%)\\n     HighMinShouldMatch2        1.62      (2.9%)        1.33      (2.8%)  -17.8% ( -22% -  -12%)\\n     HighMinShouldMatch3        1.65      (3.0%)        1.38      (3.2%)  -16.5% ( -22% -  -10%)\\n     Low1MinShouldMatch3        1.98      (3.1%)        1.76      (3.7%)  -11.2% ( -17% -   -4%)\\n     Low1MinShouldMatch0        1.85      (2.9%)        1.78      (3.3%)   -3.7% (  -9% -    2%)\\n     HighMinShouldMatch0        1.56      (2.8%)        1.51      (2.9%)   -3.6% (  -9% -    2%)\\n     Low2MinShouldMatch0        2.39      (3.1%)        2.30      (3.8%)   -3.5% ( -10% -    3%)\\n     Low3MinShouldMatch0        3.70      (3.3%)        3.59      (4.1%)   -3.0% ( -10% -    4%)\\n     Low4MinShouldMatch0        6.93      (4.1%)        6.78      (6.4%)   -2.1% ( -12% -    8%)\\n     HighMinShouldMatch4        1.67      (3.1%)        1.65      (4.6%)   -1.7% (  -9% -    6%)\\n     Low2MinShouldMatch3        2.65      (3.5%)        2.80      (5.0%)    5.7% (  -2% -   14%)\\n     Low1MinShouldMatch4        2.02      (3.2%)        2.49      (6.1%)   23.1% (  13% -   33%)\\n     Low4MinShouldMatch2        8.57      (5.5%)       34.29     (10.1%)  300.0% ( 269% -  334%)\\n     Low4MinShouldMatch3        8.61      (5.5%)       45.59     (10.5%)  429.3% ( 391% -  471%)\\n     Low3MinShouldMatch3        4.26      (3.8%)       23.84     (13.3%)  459.8% ( 426% -  495%)\\n     Low4MinShouldMatch4        8.64      (5.3%)       60.51     (13.9%)  600.2% ( 551% -  654%)\\n     Low2MinShouldMatch4        2.69      (3.6%)       21.68     (17.7%)  705.5% ( 660% -  753%)\\n     Low3MinShouldMatch4        4.27      (3.8%)       35.35     (16.5%)  728.4% ( 681% -  778%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13583350_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583350_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 16:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T16:53:30+0000\'\u003e21\\/Feb\\/13 16:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New patch results (BS2 trunk vs BS2 w\\/ last patch): \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n     Low3MinShouldMatch2        3.95      (3.6%)        3.18      (3.5%)  -19.7% ( -25% -  -13%)\\n     Low1MinShouldMatch2        1.93      (3.0%)        1.57      (2.7%)  -18.8% ( -23% -  -13%)\\n     Low2MinShouldMatch2        2.53      (3.4%)        2.06      (2.8%)  -18.6% ( -23% -  -12%)\\n     HighMinShouldMatch2        1.62      (2.9%)        1.33      (2.8%)  -17.8% ( -22% -  -12%)\\n     HighMinShouldMatch3        1.65      (3.0%)        1.38      (3.2%)  -16.5% ( -22% -  -10%)\\n     Low1MinShouldMatch3        1.98      (3.1%)        1.76      (3.7%)  -11.2% ( -17% -   -4%)\\n     Low1MinShouldMatch0        1.85      (2.9%)        1.78      (3.3%)   -3.7% (  -9% -    2%)\\n     HighMinShouldMatch0        1.56      (2.8%)        1.51      (2.9%)   -3.6% (  -9% -    2%)\\n     Low2MinShouldMatch0        2.39      (3.1%)        2.30      (3.8%)   -3.5% ( -10% -    3%)\\n     Low3MinShouldMatch0        3.70      (3.3%)        3.59      (4.1%)   -3.0% ( -10% -    4%)\\n     Low4MinShouldMatch0        6.93      (4.1%)        6.78      (6.4%)   -2.1% ( -12% -    8%)\\n     HighMinShouldMatch4        1.67      (3.1%)        1.65      (4.6%)   -1.7% (  -9% -    6%)\\n     Low2MinShouldMatch3        2.65      (3.5%)        2.80      (5.0%)    5.7% (  -2% -   14%)\\n     Low1MinShouldMatch4        2.02      (3.2%)        2.49      (6.1%)   23.1% (  13% -   33%)\\n     Low4MinShouldMatch2        8.57      (5.5%)       34.29     (10.1%)  300.0% ( 269% -  334%)\\n     Low4MinShouldMatch3        8.61      (5.5%)       45.59     (10.5%)  429.3% ( 391% -  471%)\\n     Low3MinShouldMatch3        4.26      (3.8%)       23.84     (13.3%)  459.8% ( 426% -  495%)\\n     Low4MinShouldMatch4        8.64      (5.3%)       60.51     (13.9%)  600.2% ( 551% -  654%)\\n     Low2MinShouldMatch4        2.69      (3.6%)       21.68     (17.7%)  705.5% ( 660% -  753%)\\n     Low3MinShouldMatch4        4.27      (3.8%)       35.35     (16.5%)  728.4% ( 681% -  778%)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13598485\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13598485&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13598485\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13598485_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13598485_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/13 02:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-11T02:21:03+0000\'\u003e11\\/Mar\\/13 02:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI played with this patch some the other night. the problem with my previous attempt was trying to defer score() until it was needed. this is not helpful to do if you are scoring.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll pick this back up ASAP since clearly it can be a big win \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13598485_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13598485_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/13 02:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-11T02:21:03+0000\'\u003e11\\/Mar\\/13 02:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I played with this patch some the other night. the problem with my previous attempt was trying to defer score() until it was needed. this is not helpful to do if you are scoring. \\n\\n I\'ll pick this back up ASAP since clearly it can be a big win                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13599481\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13599481&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13599481\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13599481_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13599481_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/13 23:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-11T23:32:41+0000\'\u003e11\\/Mar\\/13 23:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAwesome co-op. Thanks, Robert &amp; Mike, for picking this up.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne comment to \'deferring scoring\': I don\'t know about all current use-cases for these Scorers, but if there are some that require only matching, then it is probably most efficient to have respective specializations for each Scorer to either only match or match+score. Independently, this appears to be an orthogonal consideration to separate matching from scoring within Scorers, e.g. for not having to have such separate specializations.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you\'re just after saving some cycles for not to have a minor response time decrease for some queries, then it won\'t help as much for the optimized MinShouldMatchScorer as for the previous implementation because it now generates (and scores) much less candidates for each of which it is now much more likely to pass the MinShouldMatch-constraint and most of those will hence be scored anyways (in use-cases where scoring is required). This is probably what you mean by \'this is not helpful to do if you are scoring\'?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would be awesome to have that cost-API for (sub-)Scorers, as most Scorers can be rewritten to benefit from it (wow, you could even demonstrate this for conjunctive queries) and it also allows some optimizations to work with structured queries that otherwise would have a reduced scope to only work on flat bag-of-TermScorers queries.\u003cbr\\/\u003e\\nI would second that rewriting the attached new MinShouldMatchScorer to use the cost-API, that is, always excluding the very same most costly subScorers and heap-merging only the remaining ones would save quite a few heap operations and also simplify the implementation. This probably amounts to the desired ~15% response time improvement for the little restrictive mm-constraint queries so that it convincingly supersedes the previous MinShouldMatchScorer implementation.\u003c\\/p\u003e\\n\\n\u003cp\u003eLooking forward to see the impact of this optimized MinShouldMatchScorer to the runtimes of use-cases such as:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/blog.mikemccandless.com\\/2013\\/02\\/drill-sideways-faceting-with-lucene.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/blog.mikemccandless.com\\/2013\\/02\\/drill-sideways-faceting-with-lucene.html\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13599481_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13599481_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/13 23:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-11T23:32:41+0000\'\u003e11\\/Mar\\/13 23:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Awesome co-op. Thanks, Robert &amp; Mike, for picking this up. \\n\\n One comment to \'deferring scoring\': I don\'t know about all current use-cases for these Scorers, but if there are some that require only matching, then it is probably most efficient to have respective specializations for each Scorer to either only match or match+score. Independently, this appears to be an orthogonal consideration to separate matching from scoring within Scorers, e.g. for not having to have such separate specializations. \\n\\n If you\'re just after saving some cycles for not to have a minor response time decrease for some queries, then it won\'t help as much for the optimized MinShouldMatchScorer as for the previous implementation because it now generates (and scores) much less candidates for each of which it is now much more likely to pass the MinShouldMatch-constraint and most of those will hence be scored anyways (in use-cases where scoring is required). This is probably what you mean by \'this is not helpful to do if you are scoring\'? \\n\\n It would be awesome to have that cost-API for (sub-)Scorers, as most Scorers can be rewritten to benefit from it (wow, you could even demonstrate this for conjunctive queries) and it also allows some optimizations to work with structured queries that otherwise would have a reduced scope to only work on flat bag-of-TermScorers queries. \\nI would second that rewriting the attached new MinShouldMatchScorer to use the cost-API, that is, always excluding the very same most costly subScorers and heap-merging only the remaining ones would save quite a few heap operations and also simplify the implementation. This probably amounts to the desired ~15% response time improvement for the little restrictive mm-constraint queries so that it convincingly supersedes the previous MinShouldMatchScorer implementation. \\n\\n Looking forward to see the impact of this optimized MinShouldMatchScorer to the runtimes of use-cases such as: \\n http:\\/\\/blog.mikemccandless.com\\/2013\\/02\\/drill-sideways-faceting-with-lucene.html               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13602709\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13602709&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13602709\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13602709_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13602709_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/13 20:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-14T20:51:47+0000\'\u003e14\\/Mar\\/13 20:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eIt would be awesome to have that cost-API for (sub-)Scorers\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI just committed this to trunk! Curious to see what you can come up with here since I know it benefits conjunctions over the \\\"first docid\\\" heuristic.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13602709_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13602709_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/13 20:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-14T20:51:47+0000\'\u003e14\\/Mar\\/13 20:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n It would be awesome to have that cost-API for (sub-)Scorers  \\n\\n I just committed this to trunk! Curious to see what you can come up with here since I know it benefits conjunctions over the \\\"first docid\\\" heuristic.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13607920\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13607920&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13607920\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13607920_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13607920_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/13 17:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-20T17:54:49+0000\'\u003e20\\/Mar\\/13 17:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDuring working on a new cost-API based implementation, I stumbled upon a bug in the previous implementation that affected the scores returned by the advance()-method of this Scorer. I assume that it has not been called for the measurements in the previous comments (and obviously current tests), so all above should be valid.\u003cbr\\/\u003e\\nFor reference, I however attach a fixed (soon to be obsolete) patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13607920_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13607920_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/13 17:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-20T17:54:49+0000\'\u003e20\\/Mar\\/13 17:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    During working on a new cost-API based implementation, I stumbled upon a bug in the previous implementation that affected the scores returned by the advance()-method of this Scorer. I assume that it has not been called for the measurements in the previous comments (and obviously current tests), so all above should be valid. \\nFor reference, I however attach a fixed (soon to be obsolete) patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13608222\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13608222&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13608222\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13608222_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608222_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/13 21:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-20T21:12:38+0000\'\u003e20\\/Mar\\/13 21:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for your effort on the cost-API, Robert!\u003c\\/p\u003e\\n\\n\u003cp\u003eI changed the algorithm to now use the cost-API which should be saving some heap operations. The patch is based on trunk and also disables to sometimes use BS instead of BS2, only because of this 3 unrelated tests fail.\u003c\\/p\u003e\\n\\n\u003cp\u003eI didn\'t find time yet to do comprehensive performance testing (see TODOs in the source code), but this should be a good first shot.\u003cbr\\/\u003e\\nMike, feel free running the same measurements on the same setup again if you\'re interested to compare to the previous numbers.\u003c\\/p\u003e\\n\\n\u003cp\u003eRobert, this scorer should probably be called MinShouldMatch*Sum*Scorer to be even more precise, what do you think?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13608222_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608222_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/13 21:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-20T21:12:38+0000\'\u003e20\\/Mar\\/13 21:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for your effort on the cost-API, Robert! \\n\\n I changed the algorithm to now use the cost-API which should be saving some heap operations. The patch is based on trunk and also disables to sometimes use BS instead of BS2, only because of this 3 unrelated tests fail. \\n\\n I didn\'t find time yet to do comprehensive performance testing (see TODOs in the source code), but this should be a good first shot. \\nMike, feel free running the same measurements on the same setup again if you\'re interested to compare to the previous numbers. \\n\\n Robert, this scorer should probably be called MinShouldMatch*Sum*Scorer to be even more precise, what do you think?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13608230\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13608230&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13608230\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13608230_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608230_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/13 21:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-20T21:15:48+0000\'\u003e20\\/Mar\\/13 21:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Stefan! I will try to see if i can figure out how to run Mike\'s benchmark!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13608230_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608230_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/13 21:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-20T21:15:48+0000\'\u003e20\\/Mar\\/13 21:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Stefan! I will try to see if i can figure out how to run Mike\'s benchmark!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13608635\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13608635&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13608635\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13608635_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608635_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 04:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T04:56:00+0000\'\u003e21\\/Mar\\/13 04:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell, we have a problem in our tests for this minShouldMatch functionality.\u003c\\/p\u003e\\n\\n\u003cp\u003eluceneutil benchmark verifies a few things by default: totalHitCount of queries and scores.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen I try to benchmark the patch with 1M or 10M document indexes, the hitcounts differ: yet all lucene\\/solr tests pass with the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo our tests are not good enough: I\'ll work on some better tests for this to try to make it easier to find.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13608635_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608635_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 04:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T04:56:00+0000\'\u003e21\\/Mar\\/13 04:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well, we have a problem in our tests for this minShouldMatch functionality. \\n\\n luceneutil benchmark verifies a few things by default: totalHitCount of queries and scores. \\n\\n When I try to benchmark the patch with 1M or 10M document indexes, the hitcounts differ: yet all lucene\\/solr tests pass with the patch. \\n\\n So our tests are not good enough: I\'ll work on some better tests for this to try to make it easier to find.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13609460\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13609460&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13609460\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13609460_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13609460_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 20:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T20:55:34+0000\'\u003e21\\/Mar\\/13 20:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK: I committed a new test (TestMinShouldMatch2), it demonstrates the bug.... this currently passes on trunk but fails with the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eyou can also run it many times with ant test -Dtestcase=TestMinShouldMatch2 -Dtests.iters=100 and so on.\u003c\\/p\u003e\\n\\n\u003cp\u003ethe test is not very thorough yet but its an improvement for now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13609460_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13609460_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 20:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T20:55:34+0000\'\u003e21\\/Mar\\/13 20:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK: I committed a new test (TestMinShouldMatch2), it demonstrates the bug.... this currently passes on trunk but fails with the patch. \\n\\n you can also run it many times with ant test -Dtestcase=TestMinShouldMatch2 -Dtests.iters=100 and so on. \\n\\n the test is not very thorough yet but its an improvement for now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13609543\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13609543&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13609543\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13609543_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13609543_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 21:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T21:51:08+0000\'\u003e21\\/Mar\\/13 21:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;branch_4x commit&#93;\u003c\\/span\u003e Robert Muir\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459522\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459522\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4571\\\" title=\\\"speedup disjunction with minShouldMatch \\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4571\\\"\u003e\u003cdel\u003eLUCENE-4571\u003c\\/del\u003e\u003c\\/a\u003e: improve minShouldMatch testing\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13609543_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13609543_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 21:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T21:51:08+0000\'\u003e21\\/Mar\\/13 21:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;branch_4x commit&#93;  Robert Muir \\n http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459522  \\n\\n   LUCENE-4571  : improve minShouldMatch testing              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13609546\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13609546&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13609546\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13609546_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13609546_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 21:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T21:51:24+0000\'\u003e21\\/Mar\\/13 21:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;trunk commit&#93;\u003c\\/span\u003e Robert Muir\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459521\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459521\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4571\\\" title=\\\"speedup disjunction with minShouldMatch \\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4571\\\"\u003e\u003cdel\u003eLUCENE-4571\u003c\\/del\u003e\u003c\\/a\u003e: improve minShouldMatch testing\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13609546_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13609546_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 21:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T21:51:24+0000\'\u003e21\\/Mar\\/13 21:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;trunk commit&#93;  Robert Muir \\n http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459521  \\n\\n   LUCENE-4571  : improve minShouldMatch testing              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13609821\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13609821&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13609821\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13609821_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13609821_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 02:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T02:28:29+0000\'\u003e22\\/Mar\\/13 02:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlso for the record, the previous \\\"for reference patch\\\" (20\\/Mar\\/13 13:54) passes the new test (which doesnt check scores yet, just documents)\u003c\\/p\u003e\\n\\n\u003cp\u003eSo its just the newest patch with a bug. I\'m gonna play and see if I can spot it... because I really want to benchmark this thing!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13609821_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13609821_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 02:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T02:28:29+0000\'\u003e22\\/Mar\\/13 02:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Also for the record, the previous \\\"for reference patch\\\" (20\\/Mar\\/13 13:54) passes the new test (which doesnt check scores yet, just documents) \\n\\n So its just the newest patch with a bug. I\'m gonna play and see if I can spot it... because I really want to benchmark this thing!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610081\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610081&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610081\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13610081_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610081_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 09:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T09:53:48+0000\'\u003e22\\/Mar\\/13 09:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWith your nice test, I was quickly able to track it down (a &gt;= instead of a == fixed the issue). This was also present in the previous implementation, but there it was not wrong. New patch attached.\u003cbr\\/\u003e\\nThere are still some assertions failing, but for now I\'d attribute them to problems with the test (are return statements is missing when actual==null?), because these assertions only fail within the baseline\\/expected impl. Lucenebench doesn\'t complain anymore, even when checking scores.\u003c\\/p\u003e\\n\\n\u003cp\u003eInstead of re-implementing all of the previous basic implementation, do you think it would be possible to rather re-use a normal DisjunctionSumScorer and wrap it with a Scorer that discards candidates that don\'t match the mm-constraint? This way we would get correct scoring for free. E.g.\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e        public int nextDoc() throws IOException {\\n          int docid;\\n          while (true) {\\n            docid = wrappedScorer.nextDoc();\\n            if (docid==NO_MORE_DOCS)\\n              break;\\n            \\/\\/ count how many (optional) subscorers match on the same docid, and check against constraint\\n            int cntOpt = 0;\\n            for (ChildScorer cs : this.subscorers) {\\n              if (cs.child.docID() == docid &amp;&amp; \\\"SHOULD\\\".equalsIgnoreCase(cs.relationship))\\n                cntOpt++;\\n            }\\n            if (cntOpt&gt;=mm)\\n              break;\\n          }          \\n          return docid;\\n        }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI ran the perf test locally on the 1M doc index and got quite nice numbers. As we anticipated, the cost-API is very beneficial and the now added per-candidate early-stopping (less advance()-calls at the expense of additional if-statements) roughly doubles the speedups \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    TaskQPS baseline      StdDevQPS my_modified_version      StdDev                Pct diff\\n     Low4MinShouldMatch0       36.41      (3.1%)       35.18      (5.1%)   -3.4% ( -11% -    5%)\\n     Low3MinShouldMatch0       21.31      (6.6%)       21.18      (3.9%)   -0.6% ( -10% -   10%)\\n     Low2MinShouldMatch0       14.54      (7.4%)       14.45      (3.3%)   -0.6% ( -10% -   10%)\\n     HighMinShouldMatch0        9.85      (9.1%)        9.82      (2.8%)   -0.3% ( -11% -   12%)\\n     Low1MinShouldMatch0       11.68      (8.3%)       11.65      (3.1%)   -0.3% ( -10% -   12%)\\n     HighMinShouldMatch2       10.12      (9.4%)       10.95      (2.8%)    8.2% (  -3% -   22%)\\n     Low1MinShouldMatch2       12.08      (8.6%)       13.60      (3.2%)   12.5% (   0% -   26%)\\n     Low2MinShouldMatch2       15.23      (7.8%)       18.22      (4.2%)   19.6% (   7% -   34%)\\n     HighMinShouldMatch3       10.33      (9.2%)       13.21      (3.2%)   27.9% (  14% -   44%)\\n     Low3MinShouldMatch2       22.72      (7.3%)       30.85      (5.8%)   35.8% (  21% -   52%)\\n     Low1MinShouldMatch3       12.49      (8.3%)       17.92      (4.4%)   43.5% (  28% -   61%)\\n     HighMinShouldMatch4       10.55      (9.0%)       18.29      (4.8%)   73.3% (  54% -   95%)\\n     Low2MinShouldMatch3       16.08      (7.2%)       30.38      (6.8%)   88.9% (  69% -  110%)\\n     Low1MinShouldMatch4       12.84      (7.9%)       32.68      (9.6%)  154.6% ( 126% -  186%)\\n     Low4MinShouldMatch2       45.39      (3.2%)      222.71     (16.0%)  390.6% ( 360% -  423%)\\n     Low3MinShouldMatch3       24.70      (6.2%)      215.56     (29.8%)  772.9% ( 693% -  862%)\\n     Low4MinShouldMatch3       45.71      (3.1%)      636.23     (53.4%) 1292.0% (1198% - 1390%)\\n     Low2MinShouldMatch4       16.48      (7.1%)      257.47     (47.6%) 1462.7% (1314% - 1633%)\\n     Low4MinShouldMatch4       45.81      (3.3%)      811.82     (60.4%) 1672.1% (1557% - 1794%)\\n     Low3MinShouldMatch4       24.87      (6.8%)      768.67    (119.4%) 2990.2% (2681% - 3344%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eNote that these numbers are not directly comparable to the others in this ticket, but they give evidence that the new implementation is never (as far as this one query generalizes) slower than the previous one.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13610081_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610081_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 09:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T09:53:48+0000\'\u003e22\\/Mar\\/13 09:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    With your nice test, I was quickly able to track it down (a &gt;= instead of a == fixed the issue). This was also present in the previous implementation, but there it was not wrong. New patch attached. \\nThere are still some assertions failing, but for now I\'d attribute them to problems with the test (are return statements is missing when actual==null?), because these assertions only fail within the baseline\\/expected impl. Lucenebench doesn\'t complain anymore, even when checking scores. \\n\\n Instead of re-implementing all of the previous basic implementation, do you think it would be possible to rather re-use a normal DisjunctionSumScorer and wrap it with a Scorer that discards candidates that don\'t match the mm-constraint? This way we would get correct scoring for free. E.g. \\n  \\n         public int nextDoc() throws IOException {\\n          int docid;\\n          while (true) {\\n            docid = wrappedScorer.nextDoc();\\n            if (docid==NO_MORE_DOCS)\\n              break;\\n            \\/\\/ count how many (optional) subscorers match on the same docid, and check against constraint\\n            int cntOpt = 0;\\n            for (ChildScorer cs : this.subscorers) {\\n              if (cs.child.docID() == docid &amp;&amp; \\\"SHOULD\\\".equalsIgnoreCase(cs.relationship))\\n                cntOpt++;\\n            }\\n            if (cntOpt&gt;=mm)\\n              break;\\n          }          \\n          return docid;\\n        }\\n \\n  \\n\\n I ran the perf test locally on the 1M doc index and got quite nice numbers. As we anticipated, the cost-API is very beneficial and the now added per-candidate early-stopping (less advance()-calls at the expense of additional if-statements) roughly doubles the speedups   \\n  \\n                     TaskQPS baseline      StdDevQPS my_modified_version      StdDev                Pct diff\\n     Low4MinShouldMatch0       36.41      (3.1%)       35.18      (5.1%)   -3.4% ( -11% -    5%)\\n     Low3MinShouldMatch0       21.31      (6.6%)       21.18      (3.9%)   -0.6% ( -10% -   10%)\\n     Low2MinShouldMatch0       14.54      (7.4%)       14.45      (3.3%)   -0.6% ( -10% -   10%)\\n     HighMinShouldMatch0        9.85      (9.1%)        9.82      (2.8%)   -0.3% ( -11% -   12%)\\n     Low1MinShouldMatch0       11.68      (8.3%)       11.65      (3.1%)   -0.3% ( -10% -   12%)\\n     HighMinShouldMatch2       10.12      (9.4%)       10.95      (2.8%)    8.2% (  -3% -   22%)\\n     Low1MinShouldMatch2       12.08      (8.6%)       13.60      (3.2%)   12.5% (   0% -   26%)\\n     Low2MinShouldMatch2       15.23      (7.8%)       18.22      (4.2%)   19.6% (   7% -   34%)\\n     HighMinShouldMatch3       10.33      (9.2%)       13.21      (3.2%)   27.9% (  14% -   44%)\\n     Low3MinShouldMatch2       22.72      (7.3%)       30.85      (5.8%)   35.8% (  21% -   52%)\\n     Low1MinShouldMatch3       12.49      (8.3%)       17.92      (4.4%)   43.5% (  28% -   61%)\\n     HighMinShouldMatch4       10.55      (9.0%)       18.29      (4.8%)   73.3% (  54% -   95%)\\n     Low2MinShouldMatch3       16.08      (7.2%)       30.38      (6.8%)   88.9% (  69% -  110%)\\n     Low1MinShouldMatch4       12.84      (7.9%)       32.68      (9.6%)  154.6% ( 126% -  186%)\\n     Low4MinShouldMatch2       45.39      (3.2%)      222.71     (16.0%)  390.6% ( 360% -  423%)\\n     Low3MinShouldMatch3       24.70      (6.2%)      215.56     (29.8%)  772.9% ( 693% -  862%)\\n     Low4MinShouldMatch3       45.71      (3.1%)      636.23     (53.4%) 1292.0% (1198% - 1390%)\\n     Low2MinShouldMatch4       16.48      (7.1%)      257.47     (47.6%) 1462.7% (1314% - 1633%)\\n     Low4MinShouldMatch4       45.81      (3.3%)      811.82     (60.4%) 1672.1% (1557% - 1794%)\\n     Low3MinShouldMatch4       24.87      (6.8%)      768.67    (119.4%) 2990.2% (2681% - 3344%)\\n \\n  \\n Note that these numbers are not directly comparable to the others in this ticket, but they give evidence that the new implementation is never (as far as this one query generalizes) slower than the previous one.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610094\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610094&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610094\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13610094_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610094_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 10:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T10:13:25+0000\'\u003e22\\/Mar\\/13 10:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHOLY SHIT!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13610094_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610094_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 10:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T10:13:25+0000\'\u003e22\\/Mar\\/13 10:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    HOLY SHIT!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610099\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610099&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610099\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_13610099_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610099_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 10:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T10:16:50+0000\'\u003e22\\/Mar\\/13 10:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAgreed, these speedups are awesome!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_13610099_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610099_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 10:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T10:16:50+0000\'\u003e22\\/Mar\\/13 10:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Agreed, these speedups are awesome!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610148\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610148&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610148\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13610148_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610148_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 11:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T11:07:43+0000\'\u003e22\\/Mar\\/13 11:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Stefan Pohl - 22\\/Mar\\/13 12:57\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell, I\'m standing on the shoulders of giants; each of you is taller than you might think, not even thinking about us working together\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nThis wouldn\'t be possible without all your efforts pushing forward a cost-API and use-cases (e.g. faceting now makes use of these queries) that make this improvement significant.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut let\'s wait for Robert to confirm these results and the absence of (obvious major;p) bugs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13610148_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610148_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 11:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T11:07:43+0000\'\u003e22\\/Mar\\/13 11:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Stefan Pohl - 22\\/Mar\\/13 12:57\\\"\u003eedited\u003c\\/span\u003e                   Well, I\'m standing on the shoulders of giants; each of you is taller than you might think, not even thinking about us working together  \\nThis wouldn\'t be possible without all your efforts pushing forward a cost-API and use-cases (e.g. faceting now makes use of these queries) that make this improvement significant. \\n\\n But let\'s wait for Robert to confirm these results and the absence of (obvious major;p) bugs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610203\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610203&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610203\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"paul.elschot@xs4all.nl\\\" id=\\\"commentauthor_13610203_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=paul.elschot%40xs4all.nl\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"paul.elschot@xs4all.nl\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Elschot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610203_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 12:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T12:40:13+0000\'\u003e22\\/Mar\\/13 12:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust over eight years ago, there was this remark the initial version of DisjunctionSumScorer:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003e@todo Investigate whether it is possible to use skipTo() when\u003c\\/li\u003e\\n\\t\u003cli\u003ethe minimum number of matchers is bigger than one, ie. try and use the\u003c\\/li\u003e\\n\\t\u003cli\u003echaracter of ConjunctionScorer for the minimum number of matchers.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eSo, thanks a lot for this.\u003c\\/p\u003e\\n\\n\u003cp\u003eBtw. Confirming the absence of bugs is a lot to ask...\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"paul.elschot@xs4all.nl\\\" id=\\\"commentauthor_13610203_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=paul.elschot%40xs4all.nl\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"paul.elschot@xs4all.nl\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Elschot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610203_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 12:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T12:40:13+0000\'\u003e22\\/Mar\\/13 12:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just over eight years ago, there was this remark the initial version of DisjunctionSumScorer: \\n\\n \\n\\t @todo Investigate whether it is possible to use skipTo() when \\n\\t the minimum number of matchers is bigger than one, ie. try and use the \\n\\t character of ConjunctionScorer for the minimum number of matchers. \\n \\n\\n\\n So, thanks a lot for this. \\n\\n Btw. Confirming the absence of bugs is a lot to ask... \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610275\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610275&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610275\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610275_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610275_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T13:56:33+0000\'\u003e22\\/Mar\\/13 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Stefan! I can confirm its passing tests and I\'m seeing similar benchmark results (on iteration #9 now)\u003c\\/p\u003e\\n\\n\u003cp\u003ethe benchmark takes some time on my computer: I\'ll report back what I see when its complete.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eThere are still some assertions failing, but for now I\'d attribute them to problems with the test (are return statements is missing when actual==null?), because these assertions only fail within the baseline\\/expected impl. Lucenebench doesn\'t complain anymore, even when checking scores.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAwesome! Thats definitely a test bug in assertNext()... its just very unlikely to happen (means that by rare chance, no documents got term \\\"j\\\" or whatever): so it hasn\'t tripped up in Jenkins. I\'ll fix this, thanks!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eInstead of re-implementing all of the previous basic implementation, do you think it would be possible to rather re-use a normal DisjunctionSumScorer and wrap it with a Scorer that discards candidates that don\'t match the mm-constraint? This way we would get correct scoring for free. E.g.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe could: I thought about this. However I did this slow one for a few reasons:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003edoesn\'t prevent any refactoring of core\\/ code (its a standalone thing just for testing)\u003c\\/li\u003e\\n\\t\u003cli\u003eshould make things pretty easy to debug (this isnt yet done though)\u003c\\/li\u003e\\n\\t\u003cli\u003epossibility of finding bugs in the current implementation. especially as we near a bugfix release \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe correct scoring is actually easy to add. But I didnt do this yet because I didnt want to hold up this issue on \\\"the perfect test\\\". To me the important thing here is matching the correct documents according to minNrShouldMatch. If this is correct, its pretty intuitive to me that scoring is correct too: wherever we increase nrMatchers there should also be a addition to the score.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I\'ll improve this today so we all have that warm fuzzy feeling!\u003c\\/p\u003e\\n\\n\u003cp\u003eAs far as I\'m concerned this patch is ready to be committed today. I\'ll follow up with my benchmark results in a comment and improve \u003cbr\\/\u003e\\nthe tests a bit this morning though.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks a lot for taking this on... awesome work.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610275_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610275_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T13:56:33+0000\'\u003e22\\/Mar\\/13 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Stefan! I can confirm its passing tests and I\'m seeing similar benchmark results (on iteration #9 now) \\n\\n the benchmark takes some time on my computer: I\'ll report back what I see when its complete. \\n\\n \\n There are still some assertions failing, but for now I\'d attribute them to problems with the test (are return statements is missing when actual==null?), because these assertions only fail within the baseline\\/expected impl. Lucenebench doesn\'t complain anymore, even when checking scores.  \\n\\n Awesome! Thats definitely a test bug in assertNext()... its just very unlikely to happen (means that by rare chance, no documents got term \\\"j\\\" or whatever): so it hasn\'t tripped up in Jenkins. I\'ll fix this, thanks! \\n\\n \\n Instead of re-implementing all of the previous basic implementation, do you think it would be possible to rather re-use a normal DisjunctionSumScorer and wrap it with a Scorer that discards candidates that don\'t match the mm-constraint? This way we would get correct scoring for free. E.g.  \\n\\n We could: I thought about this. However I did this slow one for a few reasons: \\n \\n\\t doesn\'t prevent any refactoring of core\\/ code (its a standalone thing just for testing) \\n\\t should make things pretty easy to debug (this isnt yet done though) \\n\\t possibility of finding bugs in the current implementation. especially as we near a bugfix release   \\n \\n\\n\\n The correct scoring is actually easy to add. But I didnt do this yet because I didnt want to hold up this issue on \\\"the perfect test\\\". To me the important thing here is matching the correct documents according to minNrShouldMatch. If this is correct, its pretty intuitive to me that scoring is correct too: wherever we increase nrMatchers there should also be a addition to the score. \\n\\n But I\'ll improve this today so we all have that warm fuzzy feeling! \\n\\n As far as I\'m concerned this patch is ready to be committed today. I\'ll follow up with my benchmark results in a comment and improve  \\nthe tests a bit this morning though. \\n\\n Thanks a lot for taking this on... awesome work.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610284\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610284&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610284\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610284_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610284_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 14:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T14:02:33+0000\'\u003e22\\/Mar\\/13 14:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIll open a followup issue as well to fix the logic of BooleanWeight to decide how it should execute minNrShouldMatch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610284_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610284_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 14:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T14:02:33+0000\'\u003e22\\/Mar\\/13 14:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ill open a followup issue as well to fix the logic of BooleanWeight to decide how it should execute minNrShouldMatch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610317\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610317&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610317\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610317_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610317_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 14:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T14:18:20+0000\'\u003e22\\/Mar\\/13 14:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor the initial commit here: I plan to turn this thing on always when minNrShouldMatch is &gt; 1.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe can explore \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4872\\\" title=\\\"BooleanWeight should decide how to execute minNrShouldMatch\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4872\\\"\u003eLUCENE-4872\u003c\\/a\u003e to see if we can develop some detection to safely still use BooleanScorer in case where e.g. all the terms are high frequency or whatever.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610317_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610317_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 14:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T14:18:20+0000\'\u003e22\\/Mar\\/13 14:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For the initial commit here: I plan to turn this thing on always when minNrShouldMatch is &gt; 1. \\n\\n We can explore  LUCENE-4872  to see if we can develop some detection to safely still use BooleanScorer in case where e.g. all the terms are high frequency or whatever.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610330\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610330&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610330\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610330_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610330_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 14:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T14:31:48+0000\'\u003e22\\/Mar\\/13 14:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s my performance results.\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task   QPS trunk      StdDev   QPS patch      StdDev                Pct diff\\n                PKLookup      251.82      (1.3%)      239.58      (2.5%)   -4.9% (  -8% -   -1%)\\n     Low4MinShouldMatch0        8.34      (6.0%)        8.62      (6.8%)    3.3% (  -8% -   17%)\\n     Low1MinShouldMatch0        1.90      (3.9%)        1.99      (6.0%)    4.8% (  -4% -   15%)\\n     Low2MinShouldMatch0        2.41      (4.3%)        2.53      (6.3%)    4.8% (  -5% -   16%)\\n     Low3MinShouldMatch0        3.94      (4.4%)        4.13      (6.3%)    5.0% (  -5% -   16%)\\n     HighMinShouldMatch0        1.61      (3.7%)        1.70      (6.0%)    5.1% (  -4% -   15%)\\n     HighMinShouldMatch2        1.68      (4.1%)        1.94      (5.0%)   15.6% (   6% -   25%)\\n     Low1MinShouldMatch2        1.99      (4.4%)        2.39      (5.4%)   19.8% (   9% -   30%)\\n     Low2MinShouldMatch2        2.57      (5.0%)        3.27      (6.4%)   27.2% (  15% -   40%)\\n     HighMinShouldMatch3        1.71      (4.3%)        2.48      (5.6%)   45.0% (  33% -   57%)\\n     Low3MinShouldMatch2        4.24      (5.2%)        6.21      (8.4%)   46.3% (  31% -   63%)\\n     Low1MinShouldMatch3        2.05      (4.6%)        3.25      (6.9%)   58.9% (  45% -   73%)\\n     HighMinShouldMatch4        1.74      (4.5%)        3.52      (8.2%)  102.2% (  85% -  120%)\\n     Low2MinShouldMatch3        2.67      (5.4%)        5.40     (10.7%)  102.3% (  81% -  125%)\\n     Low1MinShouldMatch4        2.08      (4.9%)        5.74     (14.2%)  175.3% ( 148% -  204%)\\n     Low4MinShouldMatch2       10.18      (8.7%)       48.51     (16.3%)  376.5% ( 323% -  439%)\\n     Low3MinShouldMatch3        4.50      (5.9%)       40.66     (26.7%)  804.3% ( 728% -  889%)\\n     Low4MinShouldMatch3       10.22      (8.7%)      151.37     (62.2%) 1380.9% (1204% - 1590%)\\n     Low2MinShouldMatch4        2.71      (5.6%)       45.36     (43.9%) 1574.3% (1443% - 1720%)\\n     Low4MinShouldMatch4       10.22      (8.7%)      222.35     (93.0%) 2075.6% (1816% - 2383%)\\n     Low3MinShouldMatch4        4.50      (5.8%)      206.42    (197.7%) 4486.1% (4047% - 4979%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610330_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610330_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 14:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T14:31:48+0000\'\u003e22\\/Mar\\/13 14:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s my performance results. \\n  \\n                     Task   QPS trunk      StdDev   QPS patch      StdDev                Pct diff\\n                PKLookup      251.82      (1.3%)      239.58      (2.5%)   -4.9% (  -8% -   -1%)\\n     Low4MinShouldMatch0        8.34      (6.0%)        8.62      (6.8%)    3.3% (  -8% -   17%)\\n     Low1MinShouldMatch0        1.90      (3.9%)        1.99      (6.0%)    4.8% (  -4% -   15%)\\n     Low2MinShouldMatch0        2.41      (4.3%)        2.53      (6.3%)    4.8% (  -5% -   16%)\\n     Low3MinShouldMatch0        3.94      (4.4%)        4.13      (6.3%)    5.0% (  -5% -   16%)\\n     HighMinShouldMatch0        1.61      (3.7%)        1.70      (6.0%)    5.1% (  -4% -   15%)\\n     HighMinShouldMatch2        1.68      (4.1%)        1.94      (5.0%)   15.6% (   6% -   25%)\\n     Low1MinShouldMatch2        1.99      (4.4%)        2.39      (5.4%)   19.8% (   9% -   30%)\\n     Low2MinShouldMatch2        2.57      (5.0%)        3.27      (6.4%)   27.2% (  15% -   40%)\\n     HighMinShouldMatch3        1.71      (4.3%)        2.48      (5.6%)   45.0% (  33% -   57%)\\n     Low3MinShouldMatch2        4.24      (5.2%)        6.21      (8.4%)   46.3% (  31% -   63%)\\n     Low1MinShouldMatch3        2.05      (4.6%)        3.25      (6.9%)   58.9% (  45% -   73%)\\n     HighMinShouldMatch4        1.74      (4.5%)        3.52      (8.2%)  102.2% (  85% -  120%)\\n     Low2MinShouldMatch3        2.67      (5.4%)        5.40     (10.7%)  102.3% (  81% -  125%)\\n     Low1MinShouldMatch4        2.08      (4.9%)        5.74     (14.2%)  175.3% ( 148% -  204%)\\n     Low4MinShouldMatch2       10.18      (8.7%)       48.51     (16.3%)  376.5% ( 323% -  439%)\\n     Low3MinShouldMatch3        4.50      (5.9%)       40.66     (26.7%)  804.3% ( 728% -  889%)\\n     Low4MinShouldMatch3       10.22      (8.7%)      151.37     (62.2%) 1380.9% (1204% - 1590%)\\n     Low2MinShouldMatch4        2.71      (5.6%)       45.36     (43.9%) 1574.3% (1443% - 1720%)\\n     Low4MinShouldMatch4       10.22      (8.7%)      222.35     (93.0%) 2075.6% (1816% - 2383%)\\n     Low3MinShouldMatch4        4.50      (5.8%)      206.42    (197.7%) 4486.1% (4047% - 4979%)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610388\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610388&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610388\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610388_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610388_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T15:34:01+0000\'\u003e22\\/Mar\\/13 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI beefed up tests (to try varying numbers of terms and varying numbers of minShouldMatch and to verify scoring) and things are looking good. \u003c\\/p\u003e\\n\\n\u003cp\u003eHowever with the new tests I\'m managing to hit the assert in \u003cbr\\/\u003e\\nminHeapRemove \\\"subScorer should always be found\\\" in some cases...\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems like the assert is invalid in some corner case?\u003c\\/p\u003e\\n\\n\u003cp\u003eIf i just disable the assert, the test passes with many iterations (correct matching and scoring).\u003c\\/p\u003e\\n\\n\u003cp\u003eCould it just be the case where a scorer became exhausted in next() or advance(), and is already removed from the heap?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610388_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610388_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T15:34:01+0000\'\u003e22\\/Mar\\/13 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I beefed up tests (to try varying numbers of terms and varying numbers of minShouldMatch and to verify scoring) and things are looking good.  \\n\\n However with the new tests I\'m managing to hit the assert in  \\nminHeapRemove \\\"subScorer should always be found\\\" in some cases... \\n\\n It seems like the assert is invalid in some corner case? \\n\\n If i just disable the assert, the test passes with many iterations (correct matching and scoring). \\n\\n Could it just be the case where a scorer became exhausted in next() or advance(), and is already removed from the heap?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610416\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610416&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610416\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13610416_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610416_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:01:58+0000\'\u003e22\\/Mar\\/13 16:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;branch_4x commit&#93;\u003c\\/span\u003e Robert Muir\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459842\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459842\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4571\\\" title=\\\"speedup disjunction with minShouldMatch \\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4571\\\"\u003e\u003cdel\u003eLUCENE-4571\u003c\\/del\u003e\u003c\\/a\u003e: also verify scores in this test\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13610416_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610416_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:01:58+0000\'\u003e22\\/Mar\\/13 16:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;branch_4x commit&#93;  Robert Muir \\n http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459842  \\n\\n   LUCENE-4571  : also verify scores in this test              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610418\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610418&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610418\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13610418_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610418_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:02:04+0000\'\u003e22\\/Mar\\/13 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;branch_4x commit&#93;\u003c\\/span\u003e Robert Muir\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459820\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459820\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4571\\\" title=\\\"speedup disjunction with minShouldMatch \\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4571\\\"\u003e\u003cdel\u003eLUCENE-4571\u003c\\/del\u003e\u003c\\/a\u003e: fix rare test bug and beef up matching tests some more\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13610418_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610418_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:02:04+0000\'\u003e22\\/Mar\\/13 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;branch_4x commit&#93;  Robert Muir \\n http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459820  \\n\\n   LUCENE-4571  : fix rare test bug and beef up matching tests some more              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610432\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610432&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610432\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13610432_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610432_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:07:12+0000\'\u003e22\\/Mar\\/13 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;trunk commit&#93;\u003c\\/span\u003e Robert Muir\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459841\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459841\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4571\\\" title=\\\"speedup disjunction with minShouldMatch \\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4571\\\"\u003e\u003cdel\u003eLUCENE-4571\u003c\\/del\u003e\u003c\\/a\u003e: also verify scores in this test\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13610432_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610432_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:07:12+0000\'\u003e22\\/Mar\\/13 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;trunk commit&#93;  Robert Muir \\n http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459841  \\n\\n   LUCENE-4571  : also verify scores in this test              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610433\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610433&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610433\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13610433_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610433_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:07:18+0000\'\u003e22\\/Mar\\/13 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;trunk commit&#93;\u003c\\/span\u003e Robert Muir\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459819\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459819\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4571\\\" title=\\\"speedup disjunction with minShouldMatch \\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4571\\\"\u003e\u003cdel\u003eLUCENE-4571\u003c\\/del\u003e\u003c\\/a\u003e: fix rare test bug and beef up matching tests some more\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13610433_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610433_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:07:18+0000\'\u003e22\\/Mar\\/13 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;trunk commit&#93;  Robert Muir \\n http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1459819  \\n\\n   LUCENE-4571  : fix rare test bug and beef up matching tests some more              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610737\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610737&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610737\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13610737_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610737_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:31:04+0000\'\u003e22\\/Mar\\/13 16:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eIt seems like the assert is invalid in some corner case?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI\'ve put this in not to get distracted from the core algorithm and without thinking until end about it. That you spotted it seriously convinces me about your test!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eCould it just be the case where a scorer became exhausted in next() or advance(), and is already removed from the heap?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYou\'re absolutely right, however, the assertion should not simply be removed as this breaks invariants (you might not spot race conditions stemming from this in case of this already rare event) and it is also not the most efficient.\u003cbr\\/\u003e\\nI attached a patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13610737_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610737_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 16:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T16:31:04+0000\'\u003e22\\/Mar\\/13 16:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n It seems like the assert is invalid in some corner case?  \\n I\'ve put this in not to get distracted from the core algorithm and without thinking until end about it. That you spotted it seriously convinces me about your test! \\n\\n \\n Could it just be the case where a scorer became exhausted in next() or advance(), and is already removed from the heap?  \\n You\'re absolutely right, however, the assertion should not simply be removed as this breaks invariants (you might not spot race conditions stemming from this in case of this already rare event) and it is also not the most efficient. \\nI attached a patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610962\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610962&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610962\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610962_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610962_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 17:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T17:28:59+0000\'\u003e22\\/Mar\\/13 17:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran 1000 iterations of the test with this patch, I think we are good to go.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13610962_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610962_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 17:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T17:28:59+0000\'\u003e22\\/Mar\\/13 17:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran 1000 iterations of the test with this patch, I think we are good to go.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13610968\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13610968&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13610968\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13610968_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610968_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 17:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T17:33:05+0000\'\u003e22\\/Mar\\/13 17:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e+1\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13610968_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13610968_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 17:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T17:33:05+0000\'\u003e22\\/Mar\\/13 17:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    +1              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13611137\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13611137&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13611137\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13611137_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13611137_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 19:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T19:44:54+0000\'\u003e22\\/Mar\\/13 19:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ewhew: committed, thanks Stefan! \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13611137_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13611137_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 19:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T19:44:54+0000\'\u003e22\\/Mar\\/13 19:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    whew: committed, thanks Stefan!               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13611186\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13611186&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13611186\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13611186_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13611186_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T20:20:32+0000\'\u003e22\\/Mar\\/13 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Stefan, what an amazing improvement \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13611186_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13611186_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/13 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-22T20:20:32+0000\'\u003e22\\/Mar\\/13 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Stefan, what an amazing improvement                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13653877\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4571?focusedCommentId=13653877&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13653877\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13653877_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13653877_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/13 10:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-05-10T10:33:16+0000\'\u003e10\\/May\\/13 10:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eClosed after release.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13653877_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13653877_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/13 10:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-05-10T10:33:16+0000\'\u003e10\\/May\\/13 10:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Closed after release.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516204424948"> 
    <input type="hidden" title="jira.request.server.time" value="310"> 
    <input type="hidden" title="jira.request.id" value="953x7757557x8"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="5"> 
    <input type="hidden" title="db.reads.time.in.ms" value="45"> 
    <input type="hidden" title="db.conns.time.in.ms" value="55"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 953x7757557x8
	          REQUEST TIMESTAMP : [17/Jan/2018:15:53:44 +0000]
	               REQUEST TIME : 0.3100
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 5

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=23, elapsedTotal=45337995, elapsedMin=599346, elapsedMax=17833879, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=27, elapsedTotal=55734469, elapsedMin=502855, elapsedMax=17907283, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>