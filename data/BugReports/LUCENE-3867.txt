<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|fa5e0b6722e00cf09a963a1d7a3076b37f36b444|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"8a4dfe990dcf94\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-3867"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-3867] RamUsageEstimator.NUM_BYTES_ARRAY_HEADER and other constants are incorrect - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-3867] RamUsageEstimator.NUM_BYTES_ARRAY_HEADER and other constants are incorrect - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-3867">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-3867" href="/jira/browse/LUCENE-3867" id="key-val" rel="12546359">LUCENE-3867</a></li>
                </ol>
                <h1 id="summary-val">RamUsageEstimator.NUM_BYTES_ARRAY_HEADER and other constants are incorrect</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-3867"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-3867/LUCENE-3867.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-3867/LUCENE-3867.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-3867/LUCENE-3867.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-3867/LUCENE-3867.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/trivial.svg" title="Trivial - Cosmetic problem like misspelt words or misaligned text." width="16"> Trivial </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+3.6" title="3.6 Major release after 3.5">3.6</a>, <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.0-ALPHA" title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12546359-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span>, 
                        <span>Patch Available</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>RamUsageEstimator.NUM_BYTES_ARRAY_HEADER is computed like that: NUM_BYTES_OBJECT_HEADER + NUM_BYTES_INT + NUM_BYTES_OBJECT_REF. The NUM_BYTES_OBJECT_REF part should not be included, at least not according to this page: <a href="http://www.javamex.com/tutorials/memory/array_memory_usage.shtml" class="external-link" rel="nofollow">http://www.javamex.com/tutorials/memory/array_memory_usage.shtml</a></p> 
                  <blockquote> 
                   <p>A single-dimension array is a single object. As expected, the array has the usual object header. However, this object head is 12 bytes to accommodate a four-byte array length. Then comes the actual array data which, as you might expect, consists of the number of elements multiplied by the number of bytes required for one element, depending on its type. The memory usage for one element is 4 bytes for an object reference ...</p>
                  </blockquote> 
                  <p>While on it, I wrote a sizeOf(String) impl, and I wonder how do people feel about including such helper methods in RUE, as static, stateless, methods? It's not perfect, there's some room for improvement I'm sure, here it is:</p> 
                  <div class="code panel" style="border-width: 1px;">
                   <div class="codeContent panelContent"> 
                    <pre class="code-java">	/**
	 * Computes the approximate size of a <span class="code-object">String</span> object. Note that <span class="code-keyword">if</span> <span class="code-keyword">this</span> object
	 * is also referenced by another object, you should add
	 * {@link RamUsageEstimator#NUM_BYTES_OBJECT_REF} to the result of <span class="code-keyword">this</span>
	 * method.
	 */
	<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-object">int</span> sizeOf(<span class="code-object">String</span> str) {
		<span class="code-keyword">return</span> 2 * str.length() + 6 <span class="code-comment">// chars + additional safeness <span class="code-keyword">for</span> arrays alignment
</span>				+ 3 * RamUsageEstimator.NUM_BYTES_INT <span class="code-comment">// <span class="code-object">String</span> maintains 3 integers
</span>				+ RamUsageEstimator.NUM_BYTES_ARRAY_HEADER <span class="code-comment">// <span class="code-object">char</span>[] array
</span>				+ RamUsageEstimator.NUM_BYTES_OBJECT_HEADER; <span class="code-comment">// <span class="code-object">String</span> object
</span>	}
</pre> 
                   </div>
                  </div> 
                  <p>If people are not against it, I'd like to also add sizeOf(int[] / byte[] / long[] / double[] ... and String[]).</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-3867?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-3867?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-3867?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-3867?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12519612" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12519612/LUCENE-3867.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12519612/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12519612/LUCENE-3867.patch" title="Latest  23/Mar/12 12:24 - Dawid Weiss" draggable="true" data-downloadurl="text/x-patch:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12519612/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-23T12:24:10.176Z">23/Mar/12 12:24</time>
                   </dd>
                   <dd class="attachment-size">
                    39 kB
                   </dd>
                   <dd class="attachment-author">
                    Dawid Weiss
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12519603" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12519603/LUCENE-3867.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12519603/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12519603/LUCENE-3867.patch" title=" 23/Mar/12 10:40 - Dawid Weiss" draggable="true" data-downloadurl="text/x-patch:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12519603/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-23T10:40:54.156Z">23/Mar/12 10:40</time>
                   </dd>
                   <dd class="attachment-size">
                    314 kB
                   </dd>
                   <dd class="attachment-author">
                    Dawid Weiss
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518835" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518835/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518835/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518835/LUCENE-3867.patch" title=" 18/Mar/12 11:58 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518835/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-18T11:58:32.828Z">18/Mar/12 11:58</time>
                   </dd>
                   <dd class="attachment-size">
                    49 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518833" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518833/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518833/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518833/LUCENE-3867.patch" title=" 18/Mar/12 10:53 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518833/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-18T10:53:13.368Z">18/Mar/12 10:53</time>
                   </dd>
                   <dd class="attachment-size">
                    49 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518812" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518812/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518812/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518812/LUCENE-3867.patch" title=" 17/Mar/12 22:50 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518812/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-17T22:50:07.739Z">17/Mar/12 22:50</time>
                   </dd>
                   <dd class="attachment-size">
                    49 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518810" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518810/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518810/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518810/LUCENE-3867.patch" title=" 17/Mar/12 21:53 - Dawid Weiss" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518810/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-17T21:53:22.085Z">17/Mar/12 21:53</time>
                   </dd>
                   <dd class="attachment-size">
                    49 kB
                   </dd>
                   <dd class="attachment-author">
                    Dawid Weiss
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518795" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518795/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518795/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518795/LUCENE-3867.patch" title=" 17/Mar/12 15:33 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518795/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-17T15:33:15.456Z">17/Mar/12 15:33</time>
                   </dd>
                   <dd class="attachment-size">
                    35 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518793" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518793/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518793/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518793/LUCENE-3867.patch" title=" 17/Mar/12 14:53 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518793/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-17T14:53:21.643Z">17/Mar/12 14:53</time>
                   </dd>
                   <dd class="attachment-size">
                    35 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518785" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518785/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518785/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518785/LUCENE-3867.patch" title=" 17/Mar/12 10:56 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518785/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-17T10:56:42.611Z">17/Mar/12 10:56</time>
                   </dd>
                   <dd class="attachment-size">
                    32 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518782" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518782/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518782/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518782/LUCENE-3867.patch" title=" 17/Mar/12 08:56 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518782/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-17T08:56:31.554Z">17/Mar/12 08:56</time>
                   </dd>
                   <dd class="attachment-size">
                    32 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518743" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518743/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518743/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518743/LUCENE-3867.patch" title=" 16/Mar/12 22:14 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518743/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-16T22:14:32.367Z">16/Mar/12 22:14</time>
                   </dd>
                   <dd class="attachment-size">
                    27 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518702" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518702/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518702/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518702/LUCENE-3867.patch" title=" 16/Mar/12 16:53 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518702/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-16T16:53:53.169Z">16/Mar/12 16:53</time>
                   </dd>
                   <dd class="attachment-size">
                    25 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518661" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518661/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518661/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518661/LUCENE-3867.patch" title=" 16/Mar/12 12:54 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518661/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-16T12:54:01.065Z">16/Mar/12 12:54</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518657" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518657/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518657/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518657/LUCENE-3867.patch" title=" 16/Mar/12 12:07 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518657/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-16T12:07:46.617Z">16/Mar/12 12:07</time>
                   </dd>
                   <dd class="attachment-size">
                    13 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518463" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518463/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518463/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518463/LUCENE-3867.patch" title=" 15/Mar/12 14:07 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518463/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-15T14:07:32.826Z">15/Mar/12 14:07</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518455" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518455/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518455/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518455/LUCENE-3867.patch" title=" 15/Mar/12 12:56 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518455/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-15T12:56:35.290Z">15/Mar/12 12:56</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518439" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518439/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518439/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518439/LUCENE-3867.patch" title=" 15/Mar/12 09:40 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518439/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-15T09:40:47.641Z">15/Mar/12 09:40</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518337" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518337/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518337/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518337/LUCENE-3867.patch" title=" 14/Mar/12 16:53 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518337/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-14T16:53:17.151Z">14/Mar/12 16:53</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12518317" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518317/LUCENE-3867.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518317/LUCENE-3867.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518317/LUCENE-3867.patch" title=" 14/Mar/12 13:27 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-3867.patch:https://issues.apache.org/jira/secure/attachment/12518317/LUCENE-3867.patch">LUCENE-3867.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-14T13:27:11.204Z">14/Mar/12 13:27</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12518837" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518837/LUCENE-3867-3.x.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867-3.x.patch:https://issues.apache.org/jira/secure/attachment/12518837/LUCENE-3867-3.x.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518837/LUCENE-3867-3.x.patch" title="Latest  18/Mar/12 15:56 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867-3.x.patch:https://issues.apache.org/jira/secure/attachment/12518837/LUCENE-3867-3.x.patch">LUCENE-3867-3.x.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-18T15:56:10.967Z">18/Mar/12 15:56</time>
                   </dd>
                   <dd class="attachment-size">
                    53 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12518315" data-issue-id="12546359" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12518315/LUCENE-3867-compressedOops.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3867-compressedOops.patch:https://issues.apache.org/jira/secure/attachment/12518315/LUCENE-3867-compressedOops.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12518315/LUCENE-3867-compressedOops.patch" title="Latest  14/Mar/12 13:04 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3867-compressedOops.patch:https://issues.apache.org/jira/secure/attachment/12518315/LUCENE-3867-compressedOops.patch">LUCENE-3867-compressedOops.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-14T13:04:44.713Z">14/Mar/12 13:04</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_thetaphi" rel="thetaphi" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Uwe Schindler&quot;,&quot;emailAddress&quot;:&quot;uwe@thetaphi.de&quot;,&quot;username&quot;:&quot;thetaphi&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="thetaphi"></span></span> Uwe Schindler </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_shaie" rel="shaie" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Shai Erera&quot;,&quot;emailAddress&quot;:&quot;serera@gmail.com&quot;,&quot;username&quot;:&quot;shaie&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="shaie"></span></span> Shai Erera </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="14/Mar/12 06:22"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-03-14T06:22:13+0000">14/Mar/12 06:22</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="10/May/13 10:43"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-05-10T10:43:19+0000">10/May/13 10:43</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="23/Mar/12 19:17"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-03-23T19:17:44+0000">23/Mar/12 19:17</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3867?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3867?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13229061\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229061&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229061\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229061_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229061_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 07:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T07:42:03+0000\'\u003e14\\/Mar\\/12 07:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne can provide exact object allocation size (including alignments) by running with an agent (acquired from Instrumentation). This is shown here, for example:\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/www.javaspecialists.eu\\/archive\\/Issue142.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.javaspecialists.eu\\/archive\\/Issue142.html\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think it makes sense to be \\\"perfect\\\" here because there is a tradeoff between being accurate and being fast. One thing to possibly improve would be to handle reference size (4 vs. 8 bytes; in particular with compact references while running under 64 bit jvms).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229061_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229061_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 07:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T07:42:03+0000\'\u003e14\\/Mar\\/12 07:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One can provide exact object allocation size (including alignments) by running with an agent (acquired from Instrumentation). This is shown here, for example: \\n\\n  http:\\/\\/www.javaspecialists.eu\\/archive\\/Issue142.html  \\n\\n I don\'t think it makes sense to be \\\"perfect\\\" here because there is a tradeoff between being accurate and being fast. One thing to possibly improve would be to handle reference size (4 vs. 8 bytes; in particular with compact references while running under 64 bit jvms).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229062\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229062&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229062\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229062_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229062_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 07:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T07:43:33+0000\'\u003e14\\/Mar\\/12 07:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOh, one thing that I had in the back of my mind was to run a side-by-side comparison of Lucene\'s memory estimator and \\\"exact\\\" memory occupation via agent and see what the real difference is (on various vms and with compact vs. non-compact refs).\u003c\\/p\u003e\\n\\n\u003cp\u003eThis would be a 2 hour effort I guess, fun, but I don\'t have the time for it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229062_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229062_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 07:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T07:43:33+0000\'\u003e14\\/Mar\\/12 07:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oh, one thing that I had in the back of my mind was to run a side-by-side comparison of Lucene\'s memory estimator and \\\"exact\\\" memory occupation via agent and see what the real difference is (on various vms and with compact vs. non-compact refs). \\n\\n This would be a 2 hour effort I guess, fun, but I don\'t have the time for it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229066\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229066&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229066\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229066_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229066_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 08:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T08:02:03+0000\'\u003e14\\/Mar\\/12 08:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI was talking with Shai already about the OBJECT_REF size of 8, in RamUsageEstimator it is:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e NUM_BYTES_OBJECT_REF = Constants.JRE_IS_64BIT ? 8 : 4;\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003e...which does not take the CompressedOops into account. Can we detect those oops, so we can change the above ternary to return 4 on newer JVMs with compressed oops enabled?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229066_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229066_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 08:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T08:02:03+0000\'\u003e14\\/Mar\\/12 08:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I was talking with Shai already about the OBJECT_REF size of 8, in RamUsageEstimator it is: \\n\\n  \\n  public   final   static   int  NUM_BYTES_OBJECT_REF = Constants.JRE_IS_64BIT ? 8 : 4;\\n \\n  \\n\\n ...which does not take the CompressedOops into account. Can we detect those oops, so we can change the above ternary to return 4 on newer JVMs with compressed oops enabled?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229067\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229067&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229067\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229067_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229067_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 08:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T08:06:58+0000\'\u003e14\\/Mar\\/12 08:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf you\'re running with an agent then it will tell you many bytes a reference is, so this would fix the issue. I don\'t think you can test this from within Java VM itself, but this is an interesting question. What you could do is spawn a child VM process with identical arguments (and an agent) and check it there, but this is quite awful... \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll ask on hotspot mailing list, maybe they know how to do this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229067_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229067_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 08:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T08:06:58+0000\'\u003e14\\/Mar\\/12 08:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If you\'re running with an agent then it will tell you many bytes a reference is, so this would fix the issue. I don\'t think you can test this from within Java VM itself, but this is an interesting question. What you could do is spawn a child VM process with identical arguments (and an agent) and check it there, but this is quite awful...  \\n\\n I\'ll ask on hotspot mailing list, maybe they know how to do this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229093\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229093&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229093\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229093_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229093_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 09:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T09:26:29+0000\'\u003e14\\/Mar\\/12 09:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI don\'t think it makes sense to be \\\"perfect\\\" here because there is a tradeoff between being accurate and being fast.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree. We should be fast, and \\\"as accurate as we can get while preserving speed\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eI will fix the constant\'s value as it\'s wrong. The helper methods are just that - helper. Someone can use other techniques to compute the size of objects.\u003c\\/p\u003e\\n\\n\u003cp\u003eWill post a patch shortly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229093_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229093_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 09:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T09:26:29+0000\'\u003e14\\/Mar\\/12 09:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I don\'t think it makes sense to be \\\"perfect\\\" here because there is a tradeoff between being accurate and being fast.  \\n\\n I agree. We should be fast, and \\\"as accurate as we can get while preserving speed\\\". \\n\\n I will fix the constant\'s value as it\'s wrong. The helper methods are just that - helper. Someone can use other techniques to compute the size of objects. \\n\\n Will post a patch shortly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229125\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229125&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229125\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229125_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229125_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 10:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T10:42:47+0000\'\u003e14\\/Mar\\/12 10:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNice catch on the overcounting of array\'s RAM usage!\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd +1 for additional sizeOf(...) methods.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229125_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229125_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 10:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T10:42:47+0000\'\u003e14\\/Mar\\/12 10:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Nice catch on the overcounting of array\'s RAM usage! \\n\\n And +1 for additional sizeOf(...) methods.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229127\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229127&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229127\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229127_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229127_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 10:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T10:51:54+0000\'\u003e14\\/Mar\\/12 10:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Mike,\u003c\\/p\u003e\\n\\n\u003cp\u003eDawid and I were already contacting Hotspot list. There is an easy way to get the compressedOoooooops setting from inside the JVM using MXBeans from the ManagementFactory. I think we will provide a patch later! I think by that we could also optimize the check for 64 bit, because that one should also be reported by the MXBean without looking into strange sysprops (see the TODO in the code for JRE_IS_64BIT).\u003c\\/p\u003e\\n\\n\u003cp\u003eUwe\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229127_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229127_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 10:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T10:51:54+0000\'\u003e14\\/Mar\\/12 10:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Mike, \\n\\n Dawid and I were already contacting Hotspot list. There is an easy way to get the compressedOoooooops setting from inside the JVM using MXBeans from the ManagementFactory. I think we will provide a patch later! I think by that we could also optimize the check for 64 bit, because that one should also be reported by the MXBean without looking into strange sysprops (see the TODO in the code for JRE_IS_64BIT). \\n\\n Uwe              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229128\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229128&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229128\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229128_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229128_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 10:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T10:56:28+0000\'\u003e14\\/Mar\\/12 10:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSysprops should be a fallback though because (to be verified) they\'re supported by other vendors whereas the mx bean may not be.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt needs to be verified by running under j9, jrockit, etc.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229128_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229128_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 10:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T10:56:28+0000\'\u003e14\\/Mar\\/12 10:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Sysprops should be a fallback though because (to be verified) they\'re supported by other vendors whereas the mx bean may not be. \\n\\n It needs to be verified by running under j9, jrockit, etc.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229160\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229160&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229160\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229160_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229160_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 12:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T12:52:23+0000\'\u003e14\\/Mar\\/12 12:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eConsulting MXBean sounds great?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eSysprops should be a fallback though \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229160_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229160_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 12:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T12:52:23+0000\'\u003e14\\/Mar\\/12 12:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Consulting MXBean sounds great? \\n\\n  Sysprops should be a fallback though   \\n\\n +1              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229163\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229163&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229163\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229163_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229163_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:04:44+0000\'\u003e14\\/Mar\\/12 13:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere the patch for detecting compressesOops in Sun JVMs. For other JVMs it will simply use false, so the object refs will be guessed to have 64 bits, which is fine as upper memory limit.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe code does only use public Java APIs and falls back if anything fails to false.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229163_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229163_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:04:44+0000\'\u003e14\\/Mar\\/12 13:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here the patch for detecting compressesOops in Sun JVMs. For other JVMs it will simply use false, so the object refs will be guessed to have 64 bits, which is fine as upper memory limit. \\n\\n The code does only use public Java APIs and falls back if anything fails to false.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229176\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229176&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229176\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229176_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229176_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:27:11+0000\'\u003e14\\/Mar\\/12 13:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch adds RUE.sizeOf(String) and various sizeOf(arr[]) methods. Also fixes the ARRAY_HEADER.\u003c\\/p\u003e\\n\\n\u003cp\u003eUwe, I merged with your patch, with one difference &#8211; the System.out prints in the test are printed only if VERBOSE.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229176_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229176_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:27:11+0000\'\u003e14\\/Mar\\/12 13:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch adds RUE.sizeOf(String) and various sizeOf(arr[]) methods. Also fixes the ARRAY_HEADER. \\n\\n Uwe, I merged with your patch, with one difference &#8211; the System.out prints in the test are printed only if VERBOSE.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229182\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229182&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229182\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229182_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229182_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:34:54+0000\'\u003e14\\/Mar\\/12 13:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eShai: Thanks! I am in a train at the moment, so internet is slow\\/not working. I will later find out what MXBeans we can use to detect 64bit without looking at strange sysprops (which may have been modified by user code, so not really secure to use...).\u003c\\/p\u003e\\n\\n\u003cp\u003eI left the non-verbose printlns in it, so people reviewing the patch can quickly see by running that test what happens on their JVM. It would be interesting to see what your jRockit does... \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229182_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229182_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:34:54+0000\'\u003e14\\/Mar\\/12 13:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Shai: Thanks! I am in a train at the moment, so internet is slow\\/not working. I will later find out what MXBeans we can use to detect 64bit without looking at strange sysprops (which may have been modified by user code, so not really secure to use...). \\n\\n I left the non-verbose printlns in it, so people reviewing the patch can quickly see by running that test what happens on their JVM. It would be interesting to see what your jRockit does...                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229188\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229188&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229188\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229188_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229188_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:45:01+0000\'\u003e14\\/Mar\\/12 13:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI tried IBM and Oracle 1.6 JVMs, and both printed the same:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    [junit] ------------- Standard Output ---------------\\n    [junit] NOTE: This JVM is 64bit: \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e\\n    [junit] NOTE: This JVM uses CompressedOops: \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e\\n    [junit] ------------- ---------------- ---------------\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo no CompressedOops for me \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI will later find out what MXBeans we can use to detect 64bit without looking at strange sysprops\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOk. If you\'ll make it, we can add these changes to that patch, otherwise we can also do them in a separate issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229188_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229188_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:45:01+0000\'\u003e14\\/Mar\\/12 13:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I tried IBM and Oracle 1.6 JVMs, and both printed the same: \\n\\n  \\n     [junit] ------------- Standard Output ---------------\\n    [junit] NOTE: This JVM is 64bit:  true \\n    [junit] NOTE: This JVM uses CompressedOops:  false \\n    [junit] ------------- ---------------- ---------------\\n \\n  \\n\\n So no CompressedOops for me  . \\n\\n  I will later find out what MXBeans we can use to detect 64bit without looking at strange sysprops  \\n\\n Ok. If you\'ll make it, we can add these changes to that patch, otherwise we can also do them in a separate issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229191\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229191&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229191\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229191_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229191_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:46:19+0000\'\u003e14\\/Mar\\/12 13:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 14\\/Mar\\/12 13:47\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHm, for me (1.6.0_31, 7u3) it prints true. What JVMs are you using and what settings?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229191_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229191_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:46:19+0000\'\u003e14\\/Mar\\/12 13:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 14\\/Mar\\/12 13:47\\\"\u003eedited\u003c\\/span\u003e                   Hm, for me (1.6.0_31, 7u3) it prints true. What JVMs are you using and what settings?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229200\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229200&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229200\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229200_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229200_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:54:17+0000\'\u003e14\\/Mar\\/12 13:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere my results:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e*****************************************************\\nJAVA_HOME = C:\\\\Program Files\\\\Java\\\\jdk1.7.0_03\\njava version \\\"1.7.0_03\\\"\\nJava(TM) SE Runtime Environment (build 1.7.0_03-b05)\\nJava HotSpot(TM) 64-Bit Server VM (build 22.1-b02, mixed mode)\\n*****************************************************\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam*\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,561 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: true\\n[junit] ------------- ---------------- ---------------\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam* -Dargs=-XX:-UseCompressedOops\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,5 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: false\\n[junit] ------------- ---------------- ---------------\\n\\n*****************************************************\\nJAVA_HOME = C:\\\\Program Files\\\\Java\\\\jdk1.6.0_31\\njava version \\\"1.6.0_31\\\"\\nJava(TM) SE Runtime Environment (build 1.6.0_31-b05)\\nJava HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)\\n*****************************************************\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam*\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,453 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: true\\n[junit] ------------- ---------------- ---------------\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam* -Dargs=-XX:-UseCompressedOops\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,421 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: false\\n[junit] ------------- ---------------- ---------------\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam* -Dargs=-XX:+UseCompressedOops\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,422 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: true\\n[junit] ------------- ---------------- ---------------\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229200_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229200_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 13:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T13:54:17+0000\'\u003e14\\/Mar\\/12 13:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here my results: \\n\\n  \\n *****************************************************\\nJAVA_HOME = C:\\\\Program Files\\\\Java\\\\jdk1.7.0_03\\njava version \\\"1.7.0_03\\\"\\nJava(TM) SE Runtime Environment (build 1.7.0_03-b05)\\nJava HotSpot(TM) 64-Bit Server VM (build 22.1-b02, mixed mode)\\n*****************************************************\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam*\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,561 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: true\\n[junit] ------------- ---------------- ---------------\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam* -Dargs=-XX:-UseCompressedOops\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,5 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: false\\n[junit] ------------- ---------------- ---------------\\n\\n*****************************************************\\nJAVA_HOME = C:\\\\Program Files\\\\Java\\\\jdk1.6.0_31\\njava version \\\"1.6.0_31\\\"\\nJava(TM) SE Runtime Environment (build 1.6.0_31-b05)\\nJava HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)\\n*****************************************************\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam*\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,453 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: true\\n[junit] ------------- ---------------- ---------------\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam* -Dargs=-XX:-UseCompressedOops\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,421 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: false\\n[junit] ------------- ---------------- ---------------\\n\\nC:\\\\Users\\\\Uwe Schindler\\\\Projects\\\\lucene\\\\trunk-lusolr1\\\\lucene\\\\core&gt;ant test -Dtestcase=TestRam* -Dargs=-XX:+UseCompressedOops\\n[junit] Testsuite: org.apache.lucene.util.TestRamUsageEstimator\\n[junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 0,422 sec\\n[junit]\\n[junit] ------------- Standard Output ---------------\\n[junit] NOTE: This JVM is 64bit: true\\n[junit] NOTE: This JVM uses CompressedOops: true\\n[junit] ------------- ---------------- ---------------\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229211\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229211&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229211\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229211_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229211_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:05:56+0000\'\u003e14\\/Mar\\/12 14:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOracle:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003ejava version \u003cspan class=\\\"code-quote\\\"\u003e\\\"1.6.0_21\\\"\u003c\\/span\u003e\\nJava(TM) SE \u003cspan class=\\\"code-object\\\"\u003eRuntime\u003c\\/span\u003e Environment (build 1.6.0_21-b07)\\nJava HotSpot(TM) 64-Bit Server VM (build 17.0-b17, mixed mode)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eIBM:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003ejava version \u003cspan class=\\\"code-quote\\\"\u003e\\\"1.6.0\\\"\u003c\\/span\u003e\\nJava(TM) SE \u003cspan class=\\\"code-object\\\"\u003eRuntime\u003c\\/span\u003e Environment (build pwa6460sr9fp3-20111122_05(SR9 FP3))\\nIBM J9 VM (build 2.4, JRE 1.6.0 IBM J9 2.4 Windows 7 amd64-64 jvmwa6460sr9-20111111_94827 (JIT enabled, AOT enabled)\\nJ9VM - 20111111_094827\\nJIT  - r9_20101028_17488ifx45\\nGC   - 20101027_AA)\\nJCL  - 20110727_07\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229211_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229211_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:05:56+0000\'\u003e14\\/Mar\\/12 14:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oracle: \\n\\n  \\n java version  \\\"1.6.0_21\\\" \\nJava(TM) SE  Runtime  Environment (build 1.6.0_21-b07)\\nJava HotSpot(TM) 64-Bit Server VM (build 17.0-b17, mixed mode)\\n \\n  \\n\\n IBM: \\n\\n  \\n java version  \\\"1.6.0\\\" \\nJava(TM) SE  Runtime  Environment (build pwa6460sr9fp3-20111122_05(SR9 FP3))\\nIBM J9 VM (build 2.4, JRE 1.6.0 IBM J9 2.4 Windows 7 amd64-64 jvmwa6460sr9-20111111_94827 (JIT enabled, AOT enabled)\\nJ9VM - 20111111_094827\\nJIT  - r9_20101028_17488ifx45\\nGC   - 20101027_AA)\\nJCL  - 20110727_07\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229215\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229215&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229215\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229215_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229215_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:09:03+0000\'\u003e14\\/Mar\\/12 14:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:+UseCompressedOops\\\" and with the Oracle JVM I get \\\"Compressed Oops: true\\\" but with IBM JVM I still get \'false\'.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229215_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229215_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:09:03+0000\'\u003e14\\/Mar\\/12 14:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:+UseCompressedOops\\\" and with the Oracle JVM I get \\\"Compressed Oops: true\\\" but with IBM JVM I still get \'false\'.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229217\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229217&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229217\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229217_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229217_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:15:26+0000\'\u003e14\\/Mar\\/12 14:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, that is expected. 1.6.0_21 does not enable compressedOops by default, so false is correct. If you manually enable, it gets true.\u003c\\/p\u003e\\n\\n\u003cp\u003ejRockit is jRockit and not Sun\\/Oracle, so the result is somehow expected. It seems to nor have that MXBrean. But the code does not produce strange exceptions, so at least in the Sun VM we can detect compressed Oops and guess the reference size better. 8 is still not bad as it gives an upper limit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229217_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229217_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:15:26+0000\'\u003e14\\/Mar\\/12 14:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, that is expected. 1.6.0_21 does not enable compressedOops by default, so false is correct. If you manually enable, it gets true. \\n\\n jRockit is jRockit and not Sun\\/Oracle, so the result is somehow expected. It seems to nor have that MXBrean. But the code does not produce strange exceptions, so at least in the Sun VM we can detect compressed Oops and guess the reference size better. 8 is still not bad as it gives an upper limit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229218\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229218&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229218\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229218_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229218_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:18:28+0000\'\u003e14\\/Mar\\/12 14:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBy the way, here is the code from the hotspot mailing list member (my code is based on it), it also shows the outputs for different JVMs:\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/gist.github.com\\/1333043\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/gist.github.com\\/1333043\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e(I just removed the com.sun.* imports and replaced by reflection)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229218_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229218_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:18:28+0000\'\u003e14\\/Mar\\/12 14:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    By the way, here is the code from the hotspot mailing list member (my code is based on it), it also shows the outputs for different JVMs: \\n\\n  https:\\/\\/gist.github.com\\/1333043  \\n\\n (I just removed the com.sun.* imports and replaced by reflection)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229226\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229226&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229226\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229226_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229226_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:25:53+0000\'\u003e14\\/Mar\\/12 14:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003e8 is still not bad as it gives an upper limit.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree. Better to over-estimate here, than under-estimate.\u003c\\/p\u003e\\n\\n\u003cp\u003eWould appreciate if someone can take a look at the sizeOf() impls before I commit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229226_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229226_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 14:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T14:25:53+0000\'\u003e14\\/Mar\\/12 14:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     8 is still not bad as it gives an upper limit.  \\n\\n I agree. Better to over-estimate here, than under-estimate. \\n\\n Would appreciate if someone can take a look at the sizeOf() impls before I commit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229244\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229244&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229244\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229244_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229244_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:01:08+0000\'\u003e14\\/Mar\\/12 15:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 14\\/Mar\\/12 15:01\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOn Hotspot Mailing list some people also seem to have an idea about jRockit and IBM J9:\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eFrom: Krystal Mok\u003cbr\\/\u003e\\nSent: Wednesday, March 14, 2012 3:46 PM\u003cbr\\/\u003e\\nTo: Uwe Schindler\u003cbr\\/\u003e\\nCc: Dawid Weiss; hotspot compiler\u003cbr\\/\u003e\\nSubject: Re: How to detect if the VM is running with compact refs from within the VM (no agent)?\u003c\\/p\u003e\\n\\n\u003cp\u003eHi,\u003c\\/p\u003e\\n\\n\u003cp\u003eJust in case you\'d care, the same MXBean could be used to detect compressed references on JRockit, too. It\'s probably available starting from JRockit R28.\u003c\\/p\u003e\\n\\n\u003cp\u003eInstead of \\\"UseCompressedOops\\\", use \\\"CompressedRefs\\\" as the VM option name on JRockit.\u003c\\/p\u003e\\n\\n\u003cp\u003eDon\'t know how to extract this information for J9 without another whole bunch of hackeries...well, you could try this, on a \\\"best-effort\\\" basis for platform detection:\u003cbr\\/\u003e\\nIBM J9\'s VM version string contains the compressed reference information. Example:\u003c\\/p\u003e\\n\\n\u003cp\u003e$ export JAVA_OPTS=\'-Xcompressedrefs\'\u003cbr\\/\u003e\\n$ groovysh\u003cbr\\/\u003e\\nGroovy Shell (1.7.7, JVM: 1.7.0)\u003cbr\\/\u003e\\nType \'help\' or \'\\\\h\' for help.\u003cbr\\/\u003e\\n----------------------------------------------------------------------------------------------------------------------------\u003cbr\\/\u003e\\ngroovy:000&gt; System.getProperty \'java.vm.info\'\u003cbr\\/\u003e\\n===&gt; JRE 1.7.0 Linux amd64-64 Compressed References 20110810_88604 (JIT enabled, AOT enabled)\u003cbr\\/\u003e\\nJ9VM - R26_Java726_GA_20110810_1208_B88592\u003cbr\\/\u003e\\nJIT  - r11_20110810_20466\u003cbr\\/\u003e\\nGC   - R26_Java726_GA_20110810_1208_B88592_CMPRSS\u003cbr\\/\u003e\\nJ9CL - 20110810_88604\u003cbr\\/\u003e\\ngroovy:000&gt; quit\u003c\\/p\u003e\\n\\n\u003cp\u003eSo grepping for \\\"Compressed References\\\" in the \\\"java.vm.info\\\" system property gives you the clue.\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eKris\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\u003c\\/blockquote\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229244_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229244_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:01:08+0000\'\u003e14\\/Mar\\/12 15:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 14\\/Mar\\/12 15:01\\\"\u003eedited\u003c\\/span\u003e                   On Hotspot Mailing list some people also seem to have an idea about jRockit and IBM J9: \\n\\n \\n From: Krystal Mok \\nSent: Wednesday, March 14, 2012 3:46 PM \\nTo: Uwe Schindler \\nCc: Dawid Weiss; hotspot compiler \\nSubject: Re: How to detect if the VM is running with compact refs from within the VM (no agent)? \\n\\n Hi, \\n\\n Just in case you\'d care, the same MXBean could be used to detect compressed references on JRockit, too. It\'s probably available starting from JRockit R28. \\n\\n Instead of \\\"UseCompressedOops\\\", use \\\"CompressedRefs\\\" as the VM option name on JRockit. \\n\\n Don\'t know how to extract this information for J9 without another whole bunch of hackeries...well, you could try this, on a \\\"best-effort\\\" basis for platform detection: \\nIBM J9\'s VM version string contains the compressed reference information. Example: \\n\\n $ export JAVA_OPTS=\'-Xcompressedrefs\' \\n$ groovysh \\nGroovy Shell (1.7.7, JVM: 1.7.0) \\nType \'help\' or \'\\\\h\' for help. \\n---------------------------------------------------------------------------------------------------------------------------- \\ngroovy:000&gt; System.getProperty \'java.vm.info\' \\n===&gt; JRE 1.7.0 Linux amd64-64 Compressed References 20110810_88604 (JIT enabled, AOT enabled) \\nJ9VM - R26_Java726_GA_20110810_1208_B88592 \\nJIT  - r11_20110810_20466 \\nGC   - R26_Java726_GA_20110810_1208_B88592_CMPRSS \\nJ9CL - 20110810_88604 \\ngroovy:000&gt; quit \\n\\n So grepping for \\\"Compressed References\\\" in the \\\"java.vm.info\\\" system property gives you the clue. \\n\\n \\n\\t Kris \\n \\n              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229264\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229264&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229264\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229264_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229264_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:37:56+0000\'\u003e14\\/Mar\\/12 15:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch looks good!\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe just explain in sizeOf(String) javadoc that this method assumes the String is \\\"standalone\\\" (ie, does not reference a larger char[] than itself)?\u003c\\/p\u003e\\n\\n\u003cp\u003eBecause... if you call String.substring, the returned string references a slice the char[] of the original one... and so technically the RAM it\'s tying up could be (much) larger than expected.  (At least, this used to be the case... not sure if it\'s changed...).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229264_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229264_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:37:56+0000\'\u003e14\\/Mar\\/12 15:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch looks good! \\n\\n Maybe just explain in sizeOf(String) javadoc that this method assumes the String is \\\"standalone\\\" (ie, does not reference a larger char[] than itself)? \\n\\n Because... if you call String.substring, the returned string references a slice the char[] of the original one... and so technically the RAM it\'s tying up could be (much) larger than expected.  (At least, this used to be the case... not sure if it\'s changed...).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229273\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229273&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229273\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229273_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229273_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:50:51+0000\'\u003e14\\/Mar\\/12 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGood point. I clarified the jdocs with this:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \\/**\\n   * Returns the approximate size of a \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e object. This computation relies on\\n   * {@link \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e#length()} to compute the number of bytes held by the \u003cspan class=\\\"code-object\\\"\u003echar\u003c\\/span\u003e[].\\n   * However, \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e the \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e object passed to \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e method is the result of e.g.\\n   * {@link \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e#substring}, the computation may be entirely inaccurate\\n   * (depending on the difference between length() and the actual \u003cspan class=\\\"code-object\\\"\u003echar\u003c\\/span\u003e[]\\n   * length).\\n   *\\/\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eIf there are no objections, I\'d like to commit this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229273_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229273_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:50:51+0000\'\u003e14\\/Mar\\/12 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Good point. I clarified the jdocs with this: \\n\\n  \\n   \\/**\\n   * Returns the approximate size of a  String  object. This computation relies on\\n   * {@link  String #length()} to compute the number of bytes held by the  char [].\\n   * However,  if  the  String  object passed to  this  method is the result of e.g.\\n   * {@link  String #substring}, the computation may be entirely inaccurate\\n   * (depending on the difference between length() and the actual  char []\\n   * length).\\n   *\\/\\n \\n  \\n\\n If there are no objections, I\'d like to commit this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229275\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229275&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229275\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229275_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229275_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:52:51+0000\'\u003e14\\/Mar\\/12 15:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI would opt for sizeOf to return the actual size of the object, including underlying string buffers... We can take into account interning buffers but other than that I wouldn\'t skew the result because it can be misleading.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229275_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229275_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:52:51+0000\'\u003e14\\/Mar\\/12 15:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I would opt for sizeOf to return the actual size of the object, including underlying string buffers... We can take into account interning buffers but other than that I wouldn\'t skew the result because it can be misleading.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229279\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229279&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229279\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229279_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229279_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:56:01+0000\'\u003e14\\/Mar\\/12 15:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t like this special handling of Strings, to be honest. Why do we need\\/do it?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229279_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229279_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 15:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T15:56:01+0000\'\u003e14\\/Mar\\/12 15:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t like this special handling of Strings, to be honest. Why do we need\\/do it?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229286\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229286&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229286\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229286_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229286_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:02:07+0000\'\u003e14\\/Mar\\/12 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI don\'t like this special handling of Strings, to be honest. Why do we need\\/do it?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBecause I wrote it, and it seemed useful to me, so why not? We know how Strings look like, at least in their worse case. If there will be a better implementation, we can fix it in RUE, rather than having many impls try to do it on their own?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229286_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229286_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:02:07+0000\'\u003e14\\/Mar\\/12 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I don\'t like this special handling of Strings, to be honest. Why do we need\\/do it?  \\n\\n Because I wrote it, and it seemed useful to me, so why not? We know how Strings look like, at least in their worse case. If there will be a better implementation, we can fix it in RUE, rather than having many impls try to do it on their own?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229296\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229296&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229296\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229296_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229296_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:18:41+0000\'\u003e14\\/Mar\\/12 16:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI don\'t like this special handling of Strings, to be honest. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m confused: what special handling of Strings are we talking about...?\u003c\\/p\u003e\\n\\n\u003cp\u003eYou mean that sizeOf(String) doesn\'t return the correct answer if the string came from a previous .substring (.split too) call...?\u003c\\/p\u003e\\n\\n\u003cp\u003eIf so, how can we actually fix that?  Is there some way to ask a string for the true length of its char[]?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229296_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229296_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:18:41+0000\'\u003e14\\/Mar\\/12 16:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I don\'t like this special handling of Strings, to be honest.   \\n\\n I\'m confused: what special handling of Strings are we talking about...? \\n\\n You mean that sizeOf(String) doesn\'t return the correct answer if the string came from a previous .substring (.split too) call...? \\n\\n If so, how can we actually fix that?  Is there some way to ask a string for the true length of its char[]?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229311\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229311&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229311\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229311_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229311_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:32:47+0000\'\u003e14\\/Mar\\/12 16:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e+  \u003cspan class=\\\"code-comment\\\"\u003e\\/** Returns the size in bytes of the \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e[] object. *\\/\u003c\\/span\u003e\\n+  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e sizeOf(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e[] arr) {\\n+    \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e size = alignObjectSize(NUM_BYTES_ARRAY_HEADER + NUM_BYTES_OBJECT_REF * arr.length);\\n+    \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e s : arr) {\\n+      size += sizeOf(s);\\n+    }\\n+    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e size;\\n+  }\\n+\\n+  \u003cspan class=\\\"code-comment\\\"\u003e\\/** Returns the approximate size of a \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e object. *\\/\u003c\\/span\u003e\\n+  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e sizeOf(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e str) {\\n+    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e\'s \u003cspan class=\\\"code-object\\\"\u003echar\u003c\\/span\u003e[] size\\n\u003c\\/span\u003e+    \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e arraySize = alignObjectSize(NUM_BYTES_ARRAY_HEADER + NUM_BYTES_CHAR * str.length());\\n+\\n+    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e\'s row object size    \\n\u003c\\/span\u003e+    \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e objectSize = alignObjectSize(NUM_BYTES_OBJECT_REF \u003cspan class=\\\"code-comment\\\"\u003e\\/* array reference *\\/\u003c\\/span\u003e\\n+        + 3 * NUM_BYTES_INT \u003cspan class=\\\"code-comment\\\"\u003e\\/* \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e holds 3 integers *\\/\u003c\\/span\u003e\\n+        + NUM_BYTES_OBJECT_HEADER \u003cspan class=\\\"code-comment\\\"\u003e\\/* \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e object header *\\/\u003c\\/span\u003e);\\n+    \\n+    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e objectSize + arraySize;\\n+  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWhat I mean is that without looking at the code I would expect sizeOf(String[] N) to return the actual memory taken by an array of strings. If they point to a single char[], this should simple count the object overhead, not count every character N times as it would do now. This isn\'t sizeOf(), this is sum(string lengths * 2) + epsilon to me.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'d keep RamUsageEstimator exactly what the name says &#8211; an estimation of the actual memory taken by a given object. A string can point to a char[] and if so this should be traversed as an object and counted once.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229311_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229311_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:32:47+0000\'\u003e14\\/Mar\\/12 16:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     \\n +   \\/** Returns the size in bytes of the  String [] object. *\\/ \\n+   public   static   int  sizeOf( String [] arr) {\\n+     int  size = alignObjectSize(NUM_BYTES_ARRAY_HEADER + NUM_BYTES_OBJECT_REF * arr.length);\\n+     for  ( String  s : arr) {\\n+      size += sizeOf(s);\\n+    }\\n+     return  size;\\n+  }\\n+\\n+   \\/** Returns the approximate size of a  String  object. *\\/ \\n+   public   static   int  sizeOf( String  str) {\\n+     \\/\\/  String \'s  char [] size\\n +     int  arraySize = alignObjectSize(NUM_BYTES_ARRAY_HEADER + NUM_BYTES_CHAR * str.length());\\n+\\n+     \\/\\/  String \'s row object size    \\n +     int  objectSize = alignObjectSize(NUM_BYTES_OBJECT_REF  \\/* array reference *\\/ \\n+        + 3 * NUM_BYTES_INT  \\/*  String  holds 3 integers *\\/ \\n+        + NUM_BYTES_OBJECT_HEADER  \\/*  String  object header *\\/ );\\n+    \\n+     return  objectSize + arraySize;\\n+  }\\n \\n  \\n\\n What I mean is that without looking at the code I would expect sizeOf(String[] N) to return the actual memory taken by an array of strings. If they point to a single char[], this should simple count the object overhead, not count every character N times as it would do now. This isn\'t sizeOf(), this is sum(string lengths * 2) + epsilon to me. \\n\\n I\'d keep RamUsageEstimator exactly what the name says &#8211; an estimation of the actual memory taken by a given object. A string can point to a char[] and if so this should be traversed as an object and counted once.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229313\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229313&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229313\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229313_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229313_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:34:05+0000\'\u003e14\\/Mar\\/12 16:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf so, how can we actually fix that? Is there some way to ask a string for the true length of its char[]?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSame as with other objects &#8211; traverse its fields and count them (once, building an identity set for all objects reachable from the root)?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229313_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229313_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:34:05+0000\'\u003e14\\/Mar\\/12 16:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If so, how can we actually fix that? Is there some way to ask a string for the true length of its char[]?  \\n\\n Same as with other objects &#8211; traverse its fields and count them (once, building an identity set for all objects reachable from the root)?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229332\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229332&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229332\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229332_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229332_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:46:24+0000\'\u003e14\\/Mar\\/12 16:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhat I mean is that without looking at the code I would expect sizeOf(String[] N) to return the actual memory taken by an array of strings.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSo you mean you\'d want sizeOf(String[]) be just that?\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e alignObjectSize(NUM_BYTES_ARRAY_HEADER + NUM_BYTES_OBJECT_REF * arr.length);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI don\'t mind. I just thought that since we know how to compute sizeOf(String), we can use that. It\'s an extreme case, I think, that someone will want to compute the size of String[] which share same char[] instance ... but I don\'t mind if it bothers you that much, to simplify it and document that it computes the raw size of the String[].\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I don\'t think that we should change sizeOf(String) to not count the char[] size. It\'s part of the object, and really it\'s String, not like we\'re trying to compute the size of a general object.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eSame as with other objects \\u2013 traverse its fields and count them\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRUE already has .estimateRamUsage(Object) which does that through reflection. I think that sizeOf(String) can remain fast as it is now, with the comment that it my over-estimate if the String is actually a sub-string of one original larger string. In the worse case, we\'ll just be over-estimating.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229332_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229332_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:46:24+0000\'\u003e14\\/Mar\\/12 16:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     What I mean is that without looking at the code I would expect sizeOf(String[] N) to return the actual memory taken by an array of strings.  \\n\\n So you mean you\'d want sizeOf(String[]) be just that? \\n\\n  \\n  return  alignObjectSize(NUM_BYTES_ARRAY_HEADER + NUM_BYTES_OBJECT_REF * arr.length);\\n \\n  \\n\\n I don\'t mind. I just thought that since we know how to compute sizeOf(String), we can use that. It\'s an extreme case, I think, that someone will want to compute the size of String[] which share same char[] instance ... but I don\'t mind if it bothers you that much, to simplify it and document that it computes the raw size of the String[]. \\n\\n But I don\'t think that we should change sizeOf(String) to not count the char[] size. It\'s part of the object, and really it\'s String, not like we\'re trying to compute the size of a general object. \\n\\n  Same as with other objects \\u2013 traverse its fields and count them  \\n\\n RUE already has .estimateRamUsage(Object) which does that through reflection. I think that sizeOf(String) can remain fast as it is now, with the comment that it my over-estimate if the String is actually a sub-string of one original larger string. In the worse case, we\'ll just be over-estimating.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229336\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229336&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229336\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229336_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229336_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:53:17+0000\'\u003e14\\/Mar\\/12 16:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Shai,\u003c\\/p\u003e\\n\\n\u003cp\u003ecan ypou try this patch with J9 or maybe JRockit (Robert)? If yozu use one of those JVMs you may have to explicitely enable  compressed Oops\\/refs!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229336_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229336_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:53:17+0000\'\u003e14\\/Mar\\/12 16:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Shai, \\n\\n can ypou try this patch with J9 or maybe JRockit (Robert)? If yozu use one of those JVMs you may have to explicitely enable  compressed Oops\\/refs!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229339\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229339&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229339\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229339_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229339_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:56:30+0000\'\u003e14\\/Mar\\/12 16:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eRUE already has .estimateRamUsage(Object) which does that through reflection. I think that sizeOf(String) can remain fast as it is now, with the comment that it my over-estimate if the String is actually a sub-string of one original larger string. In the worse case, we\'ll just be over-estimating.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah, that\'s exactly what I didn\'t like. All the primitive\\/ primitive array methods are fine, but why make things inconsistent with sizeOf(String)? I\'d rather have the reflection-based method estimate the size of a String\\/String[]. Like we mentioned it\'s always a matter of speed\\/accuracy but here I\'d opt for accuracy because the output can be off by a lot if you make substrings along the way (not to mention it assumes details about String internal implementation which may or may not be true, depending on the vendor).\u003c\\/p\u003e\\n\\n\u003cp\u003eDo you have a need for this method, Shai? If you don\'t then why not wait (with this part) until such a need arises?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229339_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229339_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 16:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T16:56:30+0000\'\u003e14\\/Mar\\/12 16:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     RUE already has .estimateRamUsage(Object) which does that through reflection. I think that sizeOf(String) can remain fast as it is now, with the comment that it my over-estimate if the String is actually a sub-string of one original larger string. In the worse case, we\'ll just be over-estimating.  \\n\\n Yeah, that\'s exactly what I didn\'t like. All the primitive\\/ primitive array methods are fine, but why make things inconsistent with sizeOf(String)? I\'d rather have the reflection-based method estimate the size of a String\\/String[]. Like we mentioned it\'s always a matter of speed\\/accuracy but here I\'d opt for accuracy because the output can be off by a lot if you make substrings along the way (not to mention it assumes details about String internal implementation which may or may not be true, depending on the vendor). \\n\\n Do you have a need for this method, Shai? If you don\'t then why not wait (with this part) until such a need arises?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229344\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229344&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229344\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229344_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229344_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 17:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T17:01:39+0000\'\u003e14\\/Mar\\/12 17:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eDo you have a need for this method, Shai?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI actually started this issue because of this method \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e. I wrote the method for my own code, then spotted the bug in the ARRAY_HEADER, and on the go thought that it will be good if RUE would offer it for me \\/ other people can benefit from it. Because from my experience, after I put code in Lucene, very smart people improve and optimize it, and I benefit from it in new releases.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo while I could keep sizeOf(String) in my own code, I know that Uwe\\/Robert\\/Mike\\/You will make it more efficient when Java 7\\/8\\/9 will be out, while I\'ll totally forget about it ! \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13229344_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229344_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 17:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T17:01:39+0000\'\u003e14\\/Mar\\/12 17:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Do you have a need for this method, Shai?  \\n\\n I actually started this issue because of this method  . I wrote the method for my own code, then spotted the bug in the ARRAY_HEADER, and on the go thought that it will be good if RUE would offer it for me \\/ other people can benefit from it. Because from my experience, after I put code in Lucene, very smart people improve and optimize it, and I benefit from it in new releases. \\n\\n So while I could keep sizeOf(String) in my own code, I know that Uwe\\/Robert\\/Mike\\/You will make it more efficient when Java 7\\/8\\/9 will be out, while I\'ll totally forget about it !  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229363\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229363&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229363\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229363_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229363_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 17:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T17:10:22+0000\'\u003e14\\/Mar\\/12 17:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYeah... well... I\'m flattered \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e I\'m still -1 for adding this particular method because I don\'t like being surprised at how a method works and this is surprising behavior to me, especially in this class (even if it\'s documented in the javadoc, but who reads it anyway, right?).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf others don\'t share my opinion then can we at least rename this method to sizeOfBlah(..) where Blah is something that would indicate it\'s not actually taking into account char buffer sharing or sub-slicing (suggestions for Blah welcome)?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229363_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229363_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 17:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T17:10:22+0000\'\u003e14\\/Mar\\/12 17:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yeah... well... I\'m flattered   I\'m still -1 for adding this particular method because I don\'t like being surprised at how a method works and this is surprising behavior to me, especially in this class (even if it\'s documented in the javadoc, but who reads it anyway, right?). \\n\\n If others don\'t share my opinion then can we at least rename this method to sizeOfBlah(..) where Blah is something that would indicate it\'s not actually taking into account char buffer sharing or sub-slicing (suggestions for Blah welcome)?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229400\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229400&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229400\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13229400_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229400_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 17:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T17:23:50+0000\'\u003e14\\/Mar\\/12 17:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eestimateSizeOf(..)\u003cbr\\/\u003e\\nguessSizeOf(..)\u003cbr\\/\u003e\\nwildGuessSizeOf(..)\u003cbr\\/\u003e\\nincorrectSizeOf(..)\u003cbr\\/\u003e\\nsizeOfWeiss(..)\u003cbr\\/\u003e\\nweissSize(..)\u003cbr\\/\u003e\\nsizeOfButWithoutTakingIntoAccountCharBufferSharingOrSubSlicingSeeJavaDoc(..)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13229400_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229400_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 17:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T17:23:50+0000\'\u003e14\\/Mar\\/12 17:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    estimateSizeOf(..) \\nguessSizeOf(..) \\nwildGuessSizeOf(..) \\nincorrectSizeOf(..) \\nsizeOfWeiss(..) \\nweissSize(..) \\nsizeOfButWithoutTakingIntoAccountCharBufferSharingOrSubSlicingSeeJavaDoc(..)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229410\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229410&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229410\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229410_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229410_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 17:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T17:35:10+0000\'\u003e14\\/Mar\\/12 17:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eIf so, how can we actually fix that? Is there some way to ask a string for the true length of its char[]?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSame as with other objects \\u2013 traverse its fields and count them (once, building an identity set for all objects reachable from the root)?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAha, cool!  I hadn\'t realized RUE can crawl into the private char[] inside string and count up the RAM usage correctly.  That\'s nice.\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe lowerBoundSizeOf(...)?\u003c\\/p\u003e\\n\\n\u003cp\u003eOr maybe we don\'t add the new string methods (sizeOf(String), sizeOf(String[])) and somewhere document that you should do new RUE().size(String\\/String[]) instead...?  Hmm or maybe we do add the methods, but implement them under-the-hood w\\/ that?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229410_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229410_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 17:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T17:35:10+0000\'\u003e14\\/Mar\\/12 17:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n  If so, how can we actually fix that? Is there some way to ask a string for the true length of its char[]?  \\n\\n Same as with other objects \\u2013 traverse its fields and count them (once, building an identity set for all objects reachable from the root)?  \\n\\n Aha, cool!  I hadn\'t realized RUE can crawl into the private char[] inside string and count up the RAM usage correctly.  That\'s nice. \\n\\n Maybe lowerBoundSizeOf(...)? \\n\\n Or maybe we don\'t add the new string methods (sizeOf(String), sizeOf(String[])) and somewhere document that you should do new RUE().size(String\\/String[]) instead...?  Hmm or maybe we do add the methods, but implement them under-the-hood w\\/ that?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229440\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229440&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229440\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229440_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229440_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 18:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T18:02:24+0000\'\u003e14\\/Mar\\/12 18:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003esizeOfWeiss(..)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe\'re talking some serious dimensions here, beware of buffer overflows!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eOr maybe we don\'t add the new string methods (sizeOf(String), sizeOf(String[])) and somewhere document that you should do new RUE().size(String\\/String[]) instead..\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis is something I would go for &#8211; it\'s consistent with what I would consider this class\'s logic. I would even change it to sizeOf(Object) &#8211; this would be a static shortcut to just measure an object\'s size, no strings attached?\u003c\\/p\u003e\\n\\n\u003cp\u003eKabutz\'s code also distinguishes interned strings\\/ cached boxed integers and enums. This could be a switch much like it is now with interned Strings. Then this would really be either an upper (why lower, Mike?) bound or something that would try to be close to the exact memory consumption.\u003c\\/p\u003e\\n\\n\u003cp\u003eA fun way to determine if we\'re right would be to run a benchmark with -Xmx20mb and test how close we can get to the main memory pool\'s maximum value before OOM is thrown. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229440_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229440_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 18:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T18:02:24+0000\'\u003e14\\/Mar\\/12 18:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     sizeOfWeiss(..)  \\n\\n We\'re talking some serious dimensions here, beware of buffer overflows! \\n\\n  Or maybe we don\'t add the new string methods (sizeOf(String), sizeOf(String[])) and somewhere document that you should do new RUE().size(String\\/String[]) instead..  \\n\\n This is something I would go for &#8211; it\'s consistent with what I would consider this class\'s logic. I would even change it to sizeOf(Object) &#8211; this would be a static shortcut to just measure an object\'s size, no strings attached? \\n\\n Kabutz\'s code also distinguishes interned strings\\/ cached boxed integers and enums. This could be a switch much like it is now with interned Strings. Then this would really be either an upper (why lower, Mike?) bound or something that would try to be close to the exact memory consumption. \\n\\n A fun way to determine if we\'re right would be to run a benchmark with -Xmx20mb and test how close we can get to the main memory pool\'s maximum value before OOM is thrown.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229456\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229456&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229456\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229456_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229456_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T18:13:25+0000\'\u003e14\\/Mar\\/12 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003e(why lower, Mike?)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOh I just meant the sizeOf(String) impl in the current patch is a lower bound (since it \\\"guesses\\\" the private char[] length by calling String.length(), which is a lower bound on the actual char[] length).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13229456_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229456_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T18:13:25+0000\'\u003e14\\/Mar\\/12 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     (why lower, Mike?)  \\n\\n Oh I just meant the sizeOf(String) impl in the current patch is a lower bound (since it \\\"guesses\\\" the private char[] length by calling String.length(), which is a lower bound on the actual char[] length).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229460\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229460&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229460\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229460_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229460_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 18:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T18:18:51+0000\'\u003e14\\/Mar\\/12 18:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJohn Rose just replied to my question &#8211; there are fields in Unsafe that allow array scaling (1.7). Check these out:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e        ARRAY_BOOLEAN_INDEX_SCALE = theUnsafe.arrayIndexScale([Z);\\n        ARRAY_BYTE_INDEX_SCALE = theUnsafe.arrayIndexScale([B);\\n        ARRAY_SHORT_INDEX_SCALE = theUnsafe.arrayIndexScale([S);\\n        ARRAY_CHAR_INDEX_SCALE = theUnsafe.arrayIndexScale([C);\\n        ARRAY_INT_INDEX_SCALE = theUnsafe.arrayIndexScale([I);\\n        ARRAY_LONG_INDEX_SCALE = theUnsafe.arrayIndexScale([J);\\n        ARRAY_FLOAT_INDEX_SCALE = theUnsafe.arrayIndexScale([F);\\n        ARRAY_DOUBLE_INDEX_SCALE = theUnsafe.arrayIndexScale([D);\\n        ARRAY_OBJECT_INDEX_SCALE = theUnsafe.arrayIndexScale([Ljava\\/lang\\/Object;);\\n        ADDRESS_SIZE = theUnsafe.addressSize();\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo... there is a (theoretical?) possibility that, say, byte[] is machine word-aligned \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e I bet any RAM estimator written so far will be screwed if this happens \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13229460_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229460_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 18:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T18:18:51+0000\'\u003e14\\/Mar\\/12 18:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    John Rose just replied to my question &#8211; there are fields in Unsafe that allow array scaling (1.7). Check these out: \\n\\n  \\n         ARRAY_BOOLEAN_INDEX_SCALE = theUnsafe.arrayIndexScale([Z);\\n        ARRAY_BYTE_INDEX_SCALE = theUnsafe.arrayIndexScale([B);\\n        ARRAY_SHORT_INDEX_SCALE = theUnsafe.arrayIndexScale([S);\\n        ARRAY_CHAR_INDEX_SCALE = theUnsafe.arrayIndexScale([C);\\n        ARRAY_INT_INDEX_SCALE = theUnsafe.arrayIndexScale([I);\\n        ARRAY_LONG_INDEX_SCALE = theUnsafe.arrayIndexScale([J);\\n        ARRAY_FLOAT_INDEX_SCALE = theUnsafe.arrayIndexScale([F);\\n        ARRAY_DOUBLE_INDEX_SCALE = theUnsafe.arrayIndexScale([D);\\n        ARRAY_OBJECT_INDEX_SCALE = theUnsafe.arrayIndexScale([Ljava\\/lang\\/Object;);\\n        ADDRESS_SIZE = theUnsafe.addressSize();\\n \\n  \\n\\n So... there is a (theoretical?) possibility that, say, byte[] is machine word-aligned   I bet any RAM estimator written so far will be screwed if this happens                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13229579\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13229579&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13229579\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229579_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229579_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T20:19:25+0000\'\u003e14\\/Mar\\/12 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSo the whole Oops MBean magic is obsolete... ADDRESS_SIZE = theUnsafe.addressSize(); woooah, so simple - works on more platforms for guessing!\u003c\\/p\u003e\\n\\n\u003cp\u003eI will check this out with the usual reflection magic \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13229579_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13229579_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/12 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-14T20:19:25+0000\'\u003e14\\/Mar\\/12 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    So the whole Oops MBean magic is obsolete... ADDRESS_SIZE = theUnsafe.addressSize(); woooah, so simple - works on more platforms for guessing! \\n\\n I will check this out with the usual reflection magic                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230023\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230023&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230023\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230023_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230023_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 09:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T09:40:47+0000\'\u003e15\\/Mar\\/12 09:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi,\u003cbr\\/\u003e\\nhere new patch using Unsafe to get the bitness (with the well-known fallback) and for compressedOops detection. Looks much cleaner.\u003cbr\\/\u003e\\nI also like it more, that the addressSize is now detected natively and not from sysprops.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe constants mentioned by Dawid are only availabe in Java 7, so i reflected the underlying methods from theUnsafe. I also changed the boolean JRE_USES_COMPRESSED_OOPS to an integer JRE_REFERENCE_SIZE that is used by RamUsageEstimator. We might do the same for all other native types... (this is just a start).\u003c\\/p\u003e\\n\\n\u003cp\u003eShai: Can you test with your JVMs and also enable\\/disable compressed oops\\/refs?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230023_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230023_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 09:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T09:40:47+0000\'\u003e15\\/Mar\\/12 09:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, \\nhere new patch using Unsafe to get the bitness (with the well-known fallback) and for compressedOops detection. Looks much cleaner. \\nI also like it more, that the addressSize is now detected natively and not from sysprops. \\n\\n The constants mentioned by Dawid are only availabe in Java 7, so i reflected the underlying methods from theUnsafe. I also changed the boolean JRE_USES_COMPRESSED_OOPS to an integer JRE_REFERENCE_SIZE that is used by RamUsageEstimator. We might do the same for all other native types... (this is just a start). \\n\\n Shai: Can you test with your JVMs and also enable\\/disable compressed oops\\/refs?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230126\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230126&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230126\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13230126_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230126_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 12:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T12:56:35+0000\'\u003e15\\/Mar\\/12 12:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Uwe !\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran the test, and now with both J9 (IBM) and Oracle, I get this print (without enabling any flag):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    [junit] NOTE: running test testReferenceSize\\n    [junit] NOTE: This JVM is 64bit: \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e\\n    [junit] NOTE: Reference size in \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e JVM: 8\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI modified the test name to testReferenceSize (was testCompressedOops).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI wrote this small test to print the differences between sizeOf(String) and estimateRamUsage(String):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e void testSizeOfString() \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e Exception {\\n    \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e s = \u003cspan class=\\\"code-quote\\\"\u003e\\\"abcdefgkjdfkdsjdskljfdskfjdsf\\\"\u003c\\/span\u003e;\\n    \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e sub = s.substring(0, 4);\\n    \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(\u003cspan class=\\\"code-quote\\\"\u003e\\\"original=\\\"\u003c\\/span\u003e + RamUsageEstimator.sizeOf(s));\\n    \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(\u003cspan class=\\\"code-quote\\\"\u003e\\\"sub=\\\"\u003c\\/span\u003e + RamUsageEstimator.sizeOf(sub));\\n    \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(\u003cspan class=\\\"code-quote\\\"\u003e\\\"checkInterned=\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e(orig): \\\"\u003c\\/span\u003e + \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RamUsageEstimator().estimateRamUsage(s));\\n    \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(\u003cspan class=\\\"code-quote\\\"\u003e\\\"checkInterned=\u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e(orig): \\\"\u003c\\/span\u003e + \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RamUsageEstimator(\u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e).estimateRamUsage(s));\\n    \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(\u003cspan class=\\\"code-quote\\\"\u003e\\\"checkInterned=\u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e(sub): \\\"\u003c\\/span\u003e + \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RamUsageEstimator(\u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e).estimateRamUsage(sub));\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eIt prints:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eoriginal=104\\nsub=56\\ncheckInterned=\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e(orig): 0\\ncheckInterned=\u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e(orig): 98\\ncheckInterned=\u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e(sub): 98\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo clearly estimateRamUsage factors in the sub-string\'s larger char[]. The difference in sizes of \'orig\' stem from AverageGuessMemoryModel which computes the reference size to be 4 (hardcoded), and array size to be 16 (hardcoded). I modified AverageGuess to use constants from RUE (they are best guesses themselves). Still the test prints a difference, but now I think it\'s because sizeOf(String) aligns the size to mod 8, while estimateRamUsage isn\'t. I fixed that in size(Object), and now the prints are the same.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI also fixed sizeOfArray &#8211; if the array.length == 0, it returned 0, but it should return its header, and aligned to mod 8 as well.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI modified sizeOf(String[]) to sizeOf(Object[]) and compute its raw size only. I started to add sizeOf(String), fastSizeOf(String) and deepSizeOf(String[]), but reverted to avoid the hassle &#8211; the documentation confuses even me \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eChanged all sizeOf() to return long, and align() to take and return long.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI think this is ready to commit, though I\'d appreciate a second look on the MemoryModel and size(Obj) changes.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, how about renaming MemoryModel methods to: arrayHeaderSize(), classHeaderSize(), objReferenceSize() to make them more clear and accurate? For instance, getArraySize does not return the size of an array, but its object header ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13230126_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230126_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 12:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T12:56:35+0000\'\u003e15\\/Mar\\/12 12:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Uwe ! \\n\\n I ran the test, and now with both J9 (IBM) and Oracle, I get this print (without enabling any flag): \\n\\n  \\n     [junit] NOTE: running test testReferenceSize\\n    [junit] NOTE: This JVM is 64bit:  true \\n    [junit] NOTE: Reference size in  this  JVM: 8\\n \\n  \\n\\n \\n\\t I modified the test name to testReferenceSize (was testCompressedOops). \\n \\n\\n\\n I wrote this small test to print the differences between sizeOf(String) and estimateRamUsage(String): \\n\\n  \\n    public  void testSizeOfString()  throws  Exception {\\n     String  s =  \\\"abcdefgkjdfkdsjdskljfdskfjdsf\\\" ;\\n     String  sub = s.substring(0, 4);\\n     System .out.println( \\\"original=\\\"  + RamUsageEstimator.sizeOf(s));\\n     System .out.println( \\\"sub=\\\"  + RamUsageEstimator.sizeOf(sub));\\n     System .out.println( \\\"checkInterned= true (orig): \\\"  +  new  RamUsageEstimator().estimateRamUsage(s));\\n     System .out.println( \\\"checkInterned= false (orig): \\\"  +  new  RamUsageEstimator( false ).estimateRamUsage(s));\\n     System .out.println( \\\"checkInterned= false (sub): \\\"  +  new  RamUsageEstimator( false ).estimateRamUsage(sub));\\n  }\\n \\n  \\n\\n It prints: \\n  \\n original=104\\nsub=56\\ncheckInterned= true (orig): 0\\ncheckInterned= false (orig): 98\\ncheckInterned= false (sub): 98\\n \\n  \\n\\n So clearly estimateRamUsage factors in the sub-string\'s larger char[]. The difference in sizes of \'orig\' stem from AverageGuessMemoryModel which computes the reference size to be 4 (hardcoded), and array size to be 16 (hardcoded). I modified AverageGuess to use constants from RUE (they are best guesses themselves). Still the test prints a difference, but now I think it\'s because sizeOf(String) aligns the size to mod 8, while estimateRamUsage isn\'t. I fixed that in size(Object), and now the prints are the same. \\n\\n \\n\\t I also fixed sizeOfArray &#8211; if the array.length == 0, it returned 0, but it should return its header, and aligned to mod 8 as well. \\n \\n\\n\\n \\n\\t I modified sizeOf(String[]) to sizeOf(Object[]) and compute its raw size only. I started to add sizeOf(String), fastSizeOf(String) and deepSizeOf(String[]), but reverted to avoid the hassle &#8211; the documentation confuses even me  . \\n \\n\\n\\n \\n\\t Changed all sizeOf() to return long, and align() to take and return long. \\n \\n\\n\\n I think this is ready to commit, though I\'d appreciate a second look on the MemoryModel and size(Obj) changes. \\n\\n Also, how about renaming MemoryModel methods to: arrayHeaderSize(), classHeaderSize(), objReferenceSize() to make them more clear and accurate? For instance, getArraySize does not return the size of an array, but its object header ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230171\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230171&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230171\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230171_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230171_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T13:56:57+0000\'\u003e15\\/Mar\\/12 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dawid Weiss - 16\\/Mar\\/12 08:03\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e-1 to mixing shallow and deep sizeofs &#8211; sizeOf(Object[] arr) is shallow and just feels wrong to me. All the other methods yield the deep total, why make an exception? If anything, make it explicit and then do it for any type of object &#8211; \u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eshallowSizeOf(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e t);\\nsizeOf(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e t);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI\'m not complaining just because my sense of taste is feeling bad. I am actually using this class in my own projects and I would hate to look into the JavaDoc every time to make sure what a given method does (especially with multiple overloads). In other words, I would hate to see this:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e [] o1 = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e [] {1, 2, 3};\\n\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e o2 = o1;\\n\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (sizeOf(o1) != sizeOf(o2)) \u003cspan class=\\\"code-keyword\\\"\u003ethrow\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e WtfException();\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230171_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230171_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T13:56:57+0000\'\u003e15\\/Mar\\/12 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dawid Weiss - 16\\/Mar\\/12 08:03\\\"\u003eedited\u003c\\/span\u003e                   -1 to mixing shallow and deep sizeofs &#8211; sizeOf(Object[] arr) is shallow and just feels wrong to me. All the other methods yield the deep total, why make an exception? If anything, make it explicit and then do it for any type of object &#8211;  \\n\\n  \\n shallowSizeOf( Object  t);\\nsizeOf( Object  t);\\n \\n  \\n\\n I\'m not complaining just because my sense of taste is feeling bad. I am actually using this class in my own projects and I would hate to look into the JavaDoc every time to make sure what a given method does (especially with multiple overloads). In other words, I would hate to see this: \\n\\n  \\n  Object  [] o1 =  new   Object  [] {1, 2, 3};\\n Object  o2 = o1;\\n if  (sizeOf(o1) != sizeOf(o2))  throw   new  WtfException();\\n \\n  \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230181\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230181&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230181\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230181_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230181_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:02:43+0000\'\u003e15\\/Mar\\/12 14:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\\n\u003cp\u003eI ran the test, and now with both J9 (IBM) and Oracle, I get this print (without enabling any flag):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    [junit] NOTE: running test testReferenceSize\\n    [junit] NOTE: This JVM is 64bit: \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e\\n    [junit] NOTE: Reference size in \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e JVM: 8\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI hope with compressedOops explicitely enabled (or however they call them), you get a reference size of 4 in J9 and pre-1.6.0_23 Oracle?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230181_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230181_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:02:43+0000\'\u003e15\\/Mar\\/12 14:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n\\n I ran the test, and now with both J9 (IBM) and Oracle, I get this print (without enabling any flag): \\n\\n  \\n     [junit] NOTE: running test testReferenceSize\\n    [junit] NOTE: This JVM is 64bit:  true \\n    [junit] NOTE: Reference size in  this  JVM: 8\\n \\n   \\n\\n I hope with compressedOops explicitely enabled (or however they call them), you get a reference size of 4 in J9 and pre-1.6.0_23 Oracle?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230184\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230184&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230184\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13230184_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230184_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:07:32+0000\'\u003e15\\/Mar\\/12 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk removed sizeOf(Object[]). One can compute it by using RUE.estimateRamSize to do a deep calculation.\u003c\\/p\u003e\\n\\n\u003cp\u003eGeez Dawid, you took away all the reasons I originally opened the issue for \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut at least AvgGuessMemoryModel and RUE.size() are more accurate now. And we have some useful utility methods.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13230184_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230184_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:07:32+0000\'\u003e15\\/Mar\\/12 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok removed sizeOf(Object[]). One can compute it by using RUE.estimateRamSize to do a deep calculation. \\n\\n Geez Dawid, you took away all the reasons I originally opened the issue for  . \\n\\n But at least AvgGuessMemoryModel and RUE.size() are more accurate now. And we have some useful utility methods.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230187\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230187&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230187\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13230187_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230187_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:12:46+0000\'\u003e15\\/Mar\\/12 14:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:+UseCompressedOops\\\" and \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:-UseCompressedOops\\\" and get 8 and 4 (with CompressedOops).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13230187_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230187_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:12:46+0000\'\u003e15\\/Mar\\/12 14:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:+UseCompressedOops\\\" and \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:-UseCompressedOops\\\" and get 8 and 4 (with CompressedOops).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230202\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230202&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230202\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13230202_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230202_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:36:37+0000\'\u003e15\\/Mar\\/12 14:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOh, bummer - looks like we lost the whole history of this class...such a bummer. I really wanted to take a look at how this class had evolved since I last looked at it. I\'ve missed the conversations around the history loss - is that gone, gone, gone, or is there still some way to find it?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13230202_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230202_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:36:37+0000\'\u003e15\\/Mar\\/12 14:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oh, bummer - looks like we lost the whole history of this class...such a bummer. I really wanted to take a look at how this class had evolved since I last looked at it. I\'ve missed the conversations around the history loss - is that gone, gone, gone, or is there still some way to find it?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230206\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230206&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230206\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13230206_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230206_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:40:53+0000\'\u003e15\\/Mar\\/12 14:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eScratch that - I was trying to look back from the apache git clone using git - assumed it\'s history matched svn - but I get a clean full history using svn.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13230206_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230206_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:40:53+0000\'\u003e15\\/Mar\\/12 14:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Scratch that - I was trying to look back from the apache git clone using git - assumed it\'s history matched svn - but I get a clean full history using svn.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230208\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230208&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230208\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230208_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230208_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:42:08+0000\'\u003e15\\/Mar\\/12 14:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDie, GIT, die! \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e (as usual)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230208_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230208_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:42:08+0000\'\u003e15\\/Mar\\/12 14:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Die, GIT, die!   (as usual)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230214\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230214&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230214\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230214_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230214_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:53:47+0000\'\u003e15\\/Mar\\/12 14:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI ran \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:+UseCompressedOops\\\" and \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:-UseCompressedOops\\\" and get 8 and 4 (with CompressedOops).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK, thanks. So it seems to work at least with Oracle\\/Sun and IBM J9. I have no other updates to this detection code.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230214_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230214_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 14:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T14:53:47+0000\'\u003e15\\/Mar\\/12 14:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I ran \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:+UseCompressedOops\\\" and \\\"ant test-core -Dtestcase=TestRam* -Dtests.verbose=true -Dargs=-XX:-UseCompressedOops\\\" and get 8 and 4 (with CompressedOops).  \\n\\n OK, thanks. So it seems to work at least with Oracle\\/Sun and IBM J9. I have no other updates to this detection code.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230219\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230219&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230219\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230219_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230219_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:00:18+0000\'\u003e15\\/Mar\\/12 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eGeez Dawid, you took away all the reasons I originally opened the issue for \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis is by no means wasted time. I think the improvements are clear?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eDie, GIT, die!\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI disagree here &#8211; git is a great tool, even if the learning curve may be steep at first. git-svn is a whole different story (it\'s a great hack but just a hack).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230219_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230219_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:00:18+0000\'\u003e15\\/Mar\\/12 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Geez Dawid, you took away all the reasons I originally opened the issue for   \\n\\n This is by no means wasted time. I think the improvements are clear? \\n\\n  Die, GIT, die!  \\n\\n I disagree here &#8211; git is a great tool, even if the learning curve may be steep at first. git-svn is a whole different story (it\'s a great hack but just a hack).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230222\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230222&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230222\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230222_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230222_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:05:33+0000\'\u003e15\\/Mar\\/12 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI disagree here\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCalm down, was just my well-known standard answer \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230222_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230222_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:05:33+0000\'\u003e15\\/Mar\\/12 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I disagree here  \\n\\n Calm down, was just my well-known standard answer                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230228\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230228&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230228\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230228_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230228_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:08:21+0000\'\u003e15\\/Mar\\/12 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOh, I am calm, I just know people do hate git (and I used to as well, until I started using it frequently). Robert has a strong opinion about git, for example. \u003c\\/p\u003e\\n\\n\u003cp\u003eBesides, there\'s nothing wrong in having a strong opinion &#8211; it\'s great people can choose what they like and still collaborate via patches (and this seems to be the common ground between all vcs\'s).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230228_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230228_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:08:21+0000\'\u003e15\\/Mar\\/12 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oh, I am calm, I just know people do hate git (and I used to as well, until I started using it frequently). Robert has a strong opinion about git, for example.  \\n\\n Besides, there\'s nothing wrong in having a strong opinion &#8211; it\'s great people can choose what they like and still collaborate via patches (and this seems to be the common ground between all vcs\'s).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230229\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230229&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230229\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13230229_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230229_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:09:03+0000\'\u003e15\\/Mar\\/12 15:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThis is by no means wasted time. I think the improvements are clear?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes, yes. It was a joke.\u003c\\/p\u003e\\n\\n\u003cp\u003eOk so can I proceed with the commit, or does someone intend to review the patch later?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13230229_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230229_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:09:03+0000\'\u003e15\\/Mar\\/12 15:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     This is by no means wasted time. I think the improvements are clear?  \\n\\n Yes, yes. It was a joke. \\n\\n Ok so can I proceed with the commit, or does someone intend to review the patch later?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230230\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230230&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230230\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230230_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230230_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:09:09+0000\'\u003e15\\/Mar\\/12 15:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWith unsafe we also get all those information like size of array header we have hardcoded. Should we not try to get these in the same way like I did for bitness and reference size - using Unsafe.theUnsafe.arrayBaseOffset()? And fallback to our hardcoded defaults?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230230_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230230_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:09:09+0000\'\u003e15\\/Mar\\/12 15:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    With unsafe we also get all those information like size of array header we have hardcoded. Should we not try to get these in the same way like I did for bitness and reference size - using Unsafe.theUnsafe.arrayBaseOffset()? And fallback to our hardcoded defaults?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230235\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230235&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230235\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230235_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230235_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:16:19+0000\'\u003e15\\/Mar\\/12 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eusing Unsafe.theUnsafe.arrayBaseOffset()? And fallback to our hardcoded defaults?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1. \u003c\\/p\u003e\\n\\n\u003cp\u003eI will also try on OpenJDK with various jits but I\'ll do it in the evening.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eYes, yes. It was a joke.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eJoke or no joke the truth is I did complain a lot. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230235_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230235_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T15:16:19+0000\'\u003e15\\/Mar\\/12 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     using Unsafe.theUnsafe.arrayBaseOffset()? And fallback to our hardcoded defaults?  \\n\\n +1.  \\n\\n I will also try on OpenJDK with various jits but I\'ll do it in the evening. \\n\\n  Yes, yes. It was a joke.  \\n\\n Joke or no joke the truth is I did complain a lot.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230503\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230503&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230503\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230503_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230503_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 20:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T20:14:32+0000\'\u003e15\\/Mar\\/12 20:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI just peeked at OpenJDK sources and addressSize() is defined as this:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ See comment at file start about UNSAFE_LEAF\\n\u003c\\/span\u003e\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/UNSAFE_LEAF(jint, Unsafe_AddressSize())\\n\u003c\\/span\u003eUNSAFE_ENTRY(jint, Unsafe_AddressSize(JNIEnv *env, jobject unsafe))\\n  UnsafeWrapper(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Unsafe_AddressSize\\\"\u003c\\/span\u003e);\\n  \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e sizeof(void*);\\nUNSAFE_END\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eIn this light this switch:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eswitch\u003c\\/span\u003e (addressSize) {\\n  \u003cspan class=\\\"code-keyword\\\"\u003ecase\u003c\\/span\u003e 4:\\n    is64Bit = \u003cspan class=\\\"code-object\\\"\u003eBoolean\u003c\\/span\u003e.FALSE;\\n    \u003cspan class=\\\"code-keyword\\\"\u003ebreak\u003c\\/span\u003e;\\n  \u003cspan class=\\\"code-keyword\\\"\u003ecase\u003c\\/span\u003e 8:\\n    is64Bit = \u003cspan class=\\\"code-object\\\"\u003eBoolean\u003c\\/span\u003e.TRUE;\\n    \u003cspan class=\\\"code-keyword\\\"\u003ebreak\u003c\\/span\u003e;\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eBecomes interesting. Do you know of any architecture with pointers different than 4 or 8 bytes? \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230503_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230503_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 20:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T20:14:32+0000\'\u003e15\\/Mar\\/12 20:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I just peeked at OpenJDK sources and addressSize() is defined as this: \\n  \\n  \\/\\/ See comment at file start about UNSAFE_LEAF\\n  \\/\\/UNSAFE_LEAF(jint, Unsafe_AddressSize())\\n UNSAFE_ENTRY(jint, Unsafe_AddressSize(JNIEnv *env, jobject unsafe))\\n  UnsafeWrapper( \\\"Unsafe_AddressSize\\\" );\\n   return  sizeof(void*);\\nUNSAFE_END\\n \\n  \\n\\n In this light this switch: \\n  \\n  switch  (addressSize) {\\n   case  4:\\n    is64Bit =  Boolean .FALSE;\\n     break ;\\n   case  8:\\n    is64Bit =  Boolean .TRUE;\\n     break ;\\n}\\n \\n  \\n Becomes interesting. Do you know of any architecture with pointers different than 4 or 8 bytes?                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230529\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230529&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230529\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230529_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230529_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 20:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T20:49:45+0000\'\u003e15\\/Mar\\/12 20:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA few more exotic jits from OpenJDK (all seem to be using explicit 8 byte ref size on 64-bit:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-jamvm\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, JamVM, Robert Lougher, 1.6.0-devel, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-jamvm -XX:+UseCompressedOops\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, JamVM, Robert Lougher, 1.6.0-devel, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-cacao\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, CACAO, CACAOVM - Verein zur Foerderung der freien virtuellen Maschine CACAO, 1.1.0pre2, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-server\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, OpenJDK 64-Bit Server VM, Sun Microsystems Inc., 20.0-b11, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 4\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-server -XX:-UseCompressedOops\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, OpenJDK 64-Bit Server VM, Sun Microsystems Inc., 20.0-b11, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230529_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230529_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 20:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T20:49:45+0000\'\u003e15\\/Mar\\/12 20:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A few more exotic jits from OpenJDK (all seem to be using explicit 8 byte ref size on 64-bit: \\n  \\n &gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-jamvm\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, JamVM, Robert Lougher, 1.6.0-devel, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-jamvm -XX:+UseCompressedOops\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, JamVM, Robert Lougher, 1.6.0-devel, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-cacao\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, CACAO, CACAOVM - Verein zur Foerderung der freien virtuellen Maschine CACAO, 1.1.0pre2, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-server\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, OpenJDK 64-Bit Server VM, Sun Microsystems Inc., 20.0-b11, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 4\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-server -XX:-UseCompressedOops\\\"\\n    [junit] JVM: OpenJDK Runtime Environment, OpenJDK 64-Bit Server VM, Sun Microsystems Inc., 20.0-b11, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_23, Sun Microsystems Inc., null,\\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230535\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230535&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230535\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230535_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230535_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T20:57:49+0000\'\u003e15\\/Mar\\/12 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMac:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true\\n    [junit] JVM: Java(TM) SE Runtime Environment, Java HotSpot(TM) 64-Bit Server VM, Apple Inc., 20.4-b02-402, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_29, Apple Inc., null, \\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 4\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-server -XX:-UseCompressedOops\\\"\\n    [junit] JVM: Java(TM) SE Runtime Environment, Java HotSpot(TM) 64-Bit Server VM, Apple Inc., 20.4-b02-402, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_29, Apple Inc., null, \\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230535_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230535_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T20:57:49+0000\'\u003e15\\/Mar\\/12 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mac: \\n  \\n &gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true\\n    [junit] JVM: Java(TM) SE Runtime Environment, Java HotSpot(TM) 64-Bit Server VM, Apple Inc., 20.4-b02-402, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_29, Apple Inc., null, \\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 4\\n\\n&gt; ant test-core -Dtestcase=TestRam* -Dtests.verbose=true \\\"-Dargs=-server -XX:-UseCompressedOops\\\"\\n    [junit] JVM: Java(TM) SE Runtime Environment, Java HotSpot(TM) 64-Bit Server VM, Apple Inc., 20.4-b02-402, Java Virtual Machine Specification, Sun Microsystems Inc., 1.6.0_29, Apple Inc., null, \\n    [junit] NOTE: This JVM is 64bit: true\\n    [junit] NOTE: Reference size in this JVM: 8\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230543\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230543&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230543\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13230543_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230543_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 21:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T21:05:17+0000\'\u003e15\\/Mar\\/12 21:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNooo!!! My eyes!!!! I\'m pretty sure my liver has just been virally licensed!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13230543_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230543_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 21:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T21:05:17+0000\'\u003e15\\/Mar\\/12 21:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Nooo!!! My eyes!!!! I\'m pretty sure my liver has just been virally licensed!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230572\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230572&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230572\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230572_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230572_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 21:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T21:27:02+0000\'\u003e15\\/Mar\\/12 21:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, right, sorry, let me scramble for intellectual property protection reasons:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e\\/\\/ See cemnmot at flie sratt abuot U_ANEESAFLF \\n\\/\\n\\/ ULAAFEN_SEF (jnit, UfdAsnerS_zsiaedse ())\\nUEATERSNFN_Y (jint, UnidsdserSAasfe_ze (JNnEIv * env, jcbjeot unfsae))\\nUesWrpfapaner (\\\" UdenfsSseAazs_drie \\\"); \\nrreutn seiozf (void *\\n;)\\nUNEF_SNEAD\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230572_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230572_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 21:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T21:27:02+0000\'\u003e15\\/Mar\\/12 21:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, right, sorry, let me scramble for intellectual property protection reasons: \\n  \\n \\/\\/ See cemnmot at flie sratt abuot U_ANEESAFLF \\n\\/\\n\\/ ULAAFEN_SEF (jnit, UfdAsnerS_zsiaedse ())\\nUEATERSNFN_Y (jint, UnidsdserSAasfe_ze (JNnEIv * env, jcbjeot unfsae))\\nUesWrpfapaner (\\\" UdenfsSseAazs_drie \\\"); \\nrreutn seiozf (void *\\n;)\\nUNEF_SNEAD\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230631\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230631&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230631\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230631_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230631_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:13:54+0000\'\u003e15\\/Mar\\/12 22:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eBecomes interesting. Do you know of any architecture with pointers different than 4 or 8 bytes? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhen I was writing that code, I was thinking a very long time about: Hm, should I add a \\\"default\\\" case saying:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003edefault:\\n  throw new Error(\\\"Lucene does not like architectures with pointer size \\\" + addressSize)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eBut then I decided: If there is an architecture with a pointer size of 6, does this break Lucene really? Hm, maybe I should have added a comment there:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003edefault:\\n  \\/\\/ this is the philosophical case of Lucene reaching an architecture returning something different here\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230631_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230631_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:13:54+0000\'\u003e15\\/Mar\\/12 22:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Becomes interesting. Do you know of any architecture with pointers different than 4 or 8 bytes?   \\n\\n When I was writing that code, I was thinking a very long time about: Hm, should I add a \\\"default\\\" case saying: \\n\\n  \\n default:\\n  throw new Error(\\\"Lucene does not like architectures with pointer size \\\" + addressSize)\\n \\n  \\n\\n But then I decided: If there is an architecture with a pointer size of 6, does this break Lucene really? Hm, maybe I should have added a comment there: \\n\\n  \\n default:\\n  \\/\\/ this is the philosophical case of Lucene reaching an architecture returning something different here\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230644\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230644&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230644\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230644_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230644_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:28:53+0000\'\u003e15\\/Mar\\/12 22:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMaybe this for @UweSays:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003edefault:\\n  throw new Error(\\\"Your processor(*) hit me with his \\\" + addressSize + \\\" inch dick\\\");\\n  \\/\\/ (*)Dawid\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230644_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230644_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:28:53+0000\'\u003e15\\/Mar\\/12 22:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Maybe this for @UweSays: \\n\\n  \\n default:\\n  throw new Error(\\\"Your processor(*) hit me with his \\\" + addressSize + \\\" inch dick\\\");\\n  \\/\\/ (*)Dawid\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230647\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230647&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230647\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230647_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230647_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:32:18+0000\'\u003e15\\/Mar\\/12 22:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI would throw an exception just so that we can hear about those architectures nobody has ever heard of \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230647_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230647_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:32:18+0000\'\u003e15\\/Mar\\/12 22:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I would throw an exception just so that we can hear about those architectures nobody has ever heard of                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230652\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230652&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230652\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230652_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230652_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:33:24+0000\'\u003e15\\/Mar\\/12 22:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003efyi. \u003ca href=\\\"http:\\/\\/en.wikipedia.org\\/wiki\\/48-bit\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/en.wikipedia.org\\/wiki\\/48-bit\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230652_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230652_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:33:24+0000\'\u003e15\\/Mar\\/12 22:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    fyi.  http:\\/\\/en.wikipedia.org\\/wiki\\/48-bit               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230655\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230655&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230655\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230655_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230655_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:37:09+0000\'\u003e15\\/Mar\\/12 22:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"http:\\/\\/en.wikipedia.org\\/wiki\\/Quadruple_precision_floating-point_format\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/en.wikipedia.org\\/wiki\\/Quadruple_precision_floating-point_format\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230655_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230655_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/12 22:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-15T22:37:09+0000\'\u003e15\\/Mar\\/12 22:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     http:\\/\\/en.wikipedia.org\\/wiki\\/Quadruple_precision_floating-point_format               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230950\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230950&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230950\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230950_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230950_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 07:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T07:46:49+0000\'\u003e16\\/Mar\\/12 07:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYep, but I\'m talking about address registers and addressing in general. 48 bit addressing aligning would be inconvenient if you take into account that any index scaling addressing modes would have to do a shift and an addition (*3) instead of just a shift. Interesting stuff.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230950_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230950_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 07:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T07:46:49+0000\'\u003e16\\/Mar\\/12 07:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yep, but I\'m talking about address registers and addressing in general. 48 bit addressing aligning would be inconvenient if you take into account that any index scaling addressing modes would have to do a shift and an addition (*3) instead of just a shift. Interesting stuff.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230956\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230956&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230956\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230956_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230956_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 07:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T07:55:51+0000\'\u003e16\\/Mar\\/12 07:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree, was just a joke. The comment before was more about suddenly appearing 128 bit architectures. That ones would have an addressSize of 16, still a power of 2 \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI will now look into the unsafe array offsets...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230956_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230956_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 07:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T07:55:51+0000\'\u003e16\\/Mar\\/12 07:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree, was just a joke. The comment before was more about suddenly appearing 128 bit architectures. That ones would have an addressSize of 16, still a power of 2   \\n\\n I will now look into the unsafe array offsets...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230959\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230959&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230959\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230959_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230959_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 08:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T08:01:31+0000\'\u003e16\\/Mar\\/12 08:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dawid Weiss - 16\\/Mar\\/12 08:03\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNice. All of a sudden you could enumerate all the atoms in the universe \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e I love Wolfram Alpha...\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/www.wolframalpha.com\\/input\\/?i=is+number+of+atoms+in+the+universe+greater+than+2%5E128%3F\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.wolframalpha.com\\/input\\/?i=is+number+of+atoms+in+the+universe+greater+than+2%5E128%3F\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230959_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230959_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 08:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T08:01:31+0000\'\u003e16\\/Mar\\/12 08:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dawid Weiss - 16\\/Mar\\/12 08:03\\\"\u003eedited\u003c\\/span\u003e                   Nice. All of a sudden you could enumerate all the atoms in the universe   I love Wolfram Alpha... \\n http:\\/\\/www.wolframalpha.com\\/input\\/?i=is+number+of+atoms+in+the+universe+greater+than+2%5E128%3F               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230977\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230977&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230977\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230977_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230977_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 08:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T08:48:13+0000\'\u003e16\\/Mar\\/12 08:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI played around: Unsafe.arrayBaseOffset always returns 16 on my 64bit JVM, so it seems that NUM_BYTES_ARRAY_HEADER is wrong in our case (we have it as 12). It seems that the JVM aligns the array data to be multiple of 8 bytes on 64 bit machines?\u003c\\/p\u003e\\n\\n\u003cp\u003eFor normal objects, is there a way with unsafe to get the NUM_BYTES_OBJECT_HEADER?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230977_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230977_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 08:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T08:48:13+0000\'\u003e16\\/Mar\\/12 08:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I played around: Unsafe.arrayBaseOffset always returns 16 on my 64bit JVM, so it seems that NUM_BYTES_ARRAY_HEADER is wrong in our case (we have it as 12). It seems that the JVM aligns the array data to be multiple of 8 bytes on 64 bit machines? \\n\\n For normal objects, is there a way with unsafe to get the NUM_BYTES_OBJECT_HEADER?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230979\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230979&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230979\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230979_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230979_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:03:20+0000\'\u003e16\\/Mar\\/12 09:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eFor normal objects, is there a way with unsafe to get the NUM_BYTES_OBJECT_HEADER?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t know and I don\'t know if it varies between vendors. As for aligning &#8211; I bet this holds for anything, not only arrays. So fields of an object will be reordered and packed on their own boundary but entire themselves will be aligned on machine word boundaries for efficiency. Did you try running with Instrumentation (an agent)? What does it say about object\\/ array sizes?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13230979_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230979_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:03:20+0000\'\u003e16\\/Mar\\/12 09:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     For normal objects, is there a way with unsafe to get the NUM_BYTES_OBJECT_HEADER?  \\n\\n I don\'t know and I don\'t know if it varies between vendors. As for aligning &#8211; I bet this holds for anything, not only arrays. So fields of an object will be reordered and packed on their own boundary but entire themselves will be aligned on machine word boundaries for efficiency. Did you try running with Instrumentation (an agent)? What does it say about object\\/ array sizes?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13230994\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13230994&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13230994\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230994_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230994_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:33:51+0000\'\u003e16\\/Mar\\/12 09:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eInterestingly the ARRAY header seems to be much bigger on 64 bit platforms without compact refs, so I have the feeling that somehow thre is still some space needed for an object ref, so the original definition of the size was more correct? \u003ca href=\\\"https:\\/\\/gist.github.com\\/2038305\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/gist.github.com\\/2038305\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eUsing the original definition:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e NUM_BYTES_ARRAY_HEADER = NUM_BYTES_OBJECT_HEADER + NUM_BYTES_INT + NUM_BYTES_OBJECT_REF;\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThis looks much more like the above size, aligned to 8 bytes.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eDid you try running with Instrumentation (an agent)? What does it say about object\\/ array sizes?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHave to try out and set this up first.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13230994_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13230994_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:33:51+0000\'\u003e16\\/Mar\\/12 09:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Interestingly the ARRAY header seems to be much bigger on 64 bit platforms without compact refs, so I have the feeling that somehow thre is still some space needed for an object ref, so the original definition of the size was more correct?  https:\\/\\/gist.github.com\\/2038305  \\n\\n Using the original definition: \\n  \\n  public   final   static   int  NUM_BYTES_ARRAY_HEADER = NUM_BYTES_OBJECT_HEADER + NUM_BYTES_INT + NUM_BYTES_OBJECT_REF;\\n \\n  \\n\\n This looks much more like the above size, aligned to 8 bytes. \\n\\n  Did you try running with Instrumentation (an agent)? What does it say about object\\/ array sizes?  \\n\\n Have to try out and set this up first.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231001\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231001&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231001\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231001_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231001_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:43:20+0000\'\u003e16\\/Mar\\/12 09:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is also in line with this instumentation page:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/www.javaspecialists.eu\\/archive\\/Issue142.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.javaspecialists.eu\\/archive\\/Issue142.html\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eWhich prints:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003emeasureSize(new byte[1000]);\\nbyte[], shallow=1016, deep=1016\\nmeasureSize(new boolean[1000]);\\nboolean[], shallow=1016, deep=1016\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231001_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231001_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:43:20+0000\'\u003e16\\/Mar\\/12 09:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is also in line with this instumentation page: \\n http:\\/\\/www.javaspecialists.eu\\/archive\\/Issue142.html  \\n\\n Which prints: \\n  \\n measureSize(new byte[1000]);\\nbyte[], shallow=1016, deep=1016\\nmeasureSize(new boolean[1000]);\\nboolean[], shallow=1016, deep=1016\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231002\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231002&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231002\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231002_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231002_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:45:49+0000\'\u003e16\\/Mar\\/12 09:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eArray header is still 12 bytes but it is aligned to the next multiple-8 boundary? Looks like it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231002_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231002_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:45:49+0000\'\u003e16\\/Mar\\/12 09:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Array header is still 12 bytes but it is aligned to the next multiple-8 boundary? Looks like it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231003\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231003&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231003\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231003_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231003_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:48:55+0000\'\u003e16\\/Mar\\/12 09:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBut how does that explain that with non-compact refs the arrayBaseOffset is 24?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231003_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231003_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 09:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T09:48:55+0000\'\u003e16\\/Mar\\/12 09:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    But how does that explain that with non-compact refs the arrayBaseOffset is 24?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231017\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231017&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231017\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231017_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231017_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 10:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T10:02:54+0000\'\u003e16\\/Mar\\/12 10:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan you check what size does Object[] report vs. for example Integer[]? I think the difference may be because typed arrays need to know the type of their component.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231017_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231017_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 10:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T10:02:54+0000\'\u003e16\\/Mar\\/12 10:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can you check what size does Object[] report vs. for example Integer[]? I think the difference may be because typed arrays need to know the type of their component.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231045\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231045&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231045\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231045_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231045_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 10:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T10:42:49+0000\'\u003e16\\/Mar\\/12 10:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe peeked at the forbidden a bit again. The difference 12 vs. 16 bytes is a result of how ordinary object pointers (OOPs) are defined &#8211; they are a combination of object header information (oopMark) and class pointer. The class pointer is a compile time union of either a regular pointer or a compact pointer. oopMark is either 4 bytes (32 bit jvms) or 8 bytes (64 bit jvms). So:\u003c\\/p\u003e\\n\\n\u003cp\u003e64 bit jvm, full oops: 8 + 8 = 16\u003cbr\\/\u003e\\n64 bit jvm, compact oops: 8 + 4 = 12\u003cbr\\/\u003e\\n32 bit jvm: 4 + 4 = 8\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231045_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231045_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 10:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T10:42:49+0000\'\u003e16\\/Mar\\/12 10:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We peeked at the forbidden a bit again. The difference 12 vs. 16 bytes is a result of how ordinary object pointers (OOPs) are defined &#8211; they are a combination of object header information (oopMark) and class pointer. The class pointer is a compile time union of either a regular pointer or a compact pointer. oopMark is either 4 bytes (32 bit jvms) or 8 bytes (64 bit jvms). So: \\n\\n 64 bit jvm, full oops: 8 + 8 = 16 \\n64 bit jvm, compact oops: 8 + 4 = 12 \\n32 bit jvm: 4 + 4 = 8              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231096\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231096&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231096\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231096_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231096_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 12:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T12:07:46+0000\'\u003e16\\/Mar\\/12 12:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWith the help of Dawid (inspecting forbidden C code \u003cb\u003eg\u003c\\/b\u003e), we checked the actual size and how they are calculated. Based on that I changed the defaults depending on bitness (Object header is 16 on 64 bit without compact refs, array header is 24 on 64 bit).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe attached patch will use the above defaults, but tries to update them using sun.misc.Unsafe. The trick to get the object header from usafe is by declaring a dummy class extending Object with one single field. We are then using unsafe to get the fieldOffset of that field. As Dawid pointed out, the return value is identical to his investigations (8 bytes on 32 bit archs, 16 bytes on 64 bit archs and 12 bytes on compact ref 64bit archs). So RamUsageEstimator was completely wrong in the past for 64 bit architectures.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also changed the funny switch statement (\\\"the \\\" + adressSize + \\\" inch dick\\\") to assume 64 bits architecture, if addressSize &gt;= 8.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231096_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231096_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 12:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T12:07:46+0000\'\u003e16\\/Mar\\/12 12:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    With the help of Dawid (inspecting forbidden C code  g ), we checked the actual size and how they are calculated. Based on that I changed the defaults depending on bitness (Object header is 16 on 64 bit without compact refs, array header is 24 on 64 bit). \\n\\n The attached patch will use the above defaults, but tries to update them using sun.misc.Unsafe. The trick to get the object header from usafe is by declaring a dummy class extending Object with one single field. We are then using unsafe to get the fieldOffset of that field. As Dawid pointed out, the return value is identical to his investigations (8 bytes on 32 bit archs, 16 bytes on 64 bit archs and 12 bytes on compact ref 64bit archs). So RamUsageEstimator was completely wrong in the past for 64 bit architectures. \\n\\n I also changed the funny switch statement (\\\"the \\\" + adressSize + \\\" inch dick\\\") to assume 64 bits architecture, if addressSize &gt;= 8.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231097\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231097&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231097\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231097_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231097_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 12:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T12:09:27+0000\'\u003e16\\/Mar\\/12 12:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI would like to remove the AverageBlabla memotry model. The code inside is simply no longer useful. RamUsageEstimator simply uses the sizes returned by the JVM.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231097_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231097_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 12:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T12:09:27+0000\'\u003e16\\/Mar\\/12 12:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I would like to remove the AverageBlabla memotry model. The code inside is simply no longer useful. RamUsageEstimator simply uses the sizes returned by the JVM.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231119\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231119&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231119\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231119_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231119_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 12:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T12:54:01+0000\'\u003e16\\/Mar\\/12 12:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch with the abstract and now useless MemoryModel removed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231119_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231119_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 12:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T12:54:01+0000\'\u003e16\\/Mar\\/12 12:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch with the abstract and now useless MemoryModel removed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231134\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231134&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231134\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231134_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231134_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 13:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T13:04:34+0000\'\u003e16\\/Mar\\/12 13:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRobert reminded me that there is also a heavily broken custom memory estimator in MemoryIndex, too. I will look into it, too.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231134_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231134_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 13:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T13:04:34+0000\'\u003e16\\/Mar\\/12 13:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Robert reminded me that there is also a heavily broken custom memory estimator in MemoryIndex, too. I will look into it, too.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231379\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231379&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231379\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231379_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231379_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 16:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T16:53:53+0000\'\u003e16\\/Mar\\/12 16:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is a patch fixing several bugs and more:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eRemoved the MemoryIndex VM class and the completely outdated and incorrect estimation there.\u003c\\/li\u003e\\n\\t\u003cli\u003eUsed Shai\'s new added methods also in Lucene\'s PackedInt classes\u003c\\/li\u003e\\n\\t\u003cli\u003eFixes overflows in Shai\'s new methods, as they can overflow if arrays are greater than 2 GB (casts to long missing)\u003c\\/li\u003e\\n\\t\u003cli\u003eFixed the up-rounding to multiples of 8 to work with longs\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eWhat\'s the reason why this rounding up to 8 bytes was added? I assume this information comes from somewhere, but it was added by Shai without any explanation. Is this not also dependent on the 64bitness if its 8 or 4?\u003c\\/p\u003e\\n\\n\u003cp\u003eOtherwise patch is ready.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231379_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231379_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 16:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T16:53:53+0000\'\u003e16\\/Mar\\/12 16:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is a patch fixing several bugs and more: \\n \\n\\t Removed the MemoryIndex VM class and the completely outdated and incorrect estimation there. \\n\\t Used Shai\'s new added methods also in Lucene\'s PackedInt classes \\n\\t Fixes overflows in Shai\'s new methods, as they can overflow if arrays are greater than 2 GB (casts to long missing) \\n\\t Fixed the up-rounding to multiples of 8 to work with longs \\n \\n\\n\\n What\'s the reason why this rounding up to 8 bytes was added? I assume this information comes from somewhere, but it was added by Shai without any explanation. Is this not also dependent on the 64bitness if its 8 or 4? \\n\\n Otherwise patch is ready.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231388\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231388&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231388\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13231388_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231388_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T17:00:05+0000\'\u003e16\\/Mar\\/12 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eRemoved the MemoryIndex VM class and the completely outdated and incorrect estimation there.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ethank you!!!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13231388_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231388_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T17:00:05+0000\'\u003e16\\/Mar\\/12 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Removed the MemoryIndex VM class and the completely outdated and incorrect estimation there.  \\n\\n thank you!!!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231413\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231413&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231413\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231413_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231413_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T17:34:33+0000\'\u003e16\\/Mar\\/12 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAwesome job, Uwe. I think I wasn\'t right about that alignment of arrays &#8211; sizeof(int) should\'t come up to 8. I will look into this again in the evening, it got me interested. I\'ll also check out the alignments, so if this patch can wait until tomorrow then we\'ll be more confident we get the estimates right.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231413_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231413_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T17:34:33+0000\'\u003e16\\/Mar\\/12 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Awesome job, Uwe. I think I wasn\'t right about that alignment of arrays &#8211; sizeof(int) should\'t come up to 8. I will look into this again in the evening, it got me interested. I\'ll also check out the alignments, so if this patch can wait until tomorrow then we\'ll be more confident we get the estimates right.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231625\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231625&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231625\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231625_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231625_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 21:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T21:00:38+0000\'\u003e16\\/Mar\\/12 21:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is very interesting indeed. \u003c\\/p\u003e\\n\\n\u003cp\u003eSo, I used the agent hook into a running VM to dump some of the internal diagnostics, including OOP sizes, heap word alignments, etc. Here\'s a scoop of the results (with client-side indicated sizes on the right):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e\\n# 1.7, 64 bit, OOPS compressed            (client)\\ngetOopSize: 8                             ref size = 4         \\nAddress size: 8                           array header = 16    \\nBytes per long: 8                         object header = 12   \\nCPU: amd64\\nHeapOopSize: 4\\nHeapWordSize: 8\\nIntSize: 4\\ngetMinObjAlignmentInBytes: 8\\ngetObjectAlignmentInBytes: 8\\nisCompressedOopsEnabled: true\\nisLP64: true\\n\\n\\n# 1.7, 64 bit, full\\ngetOopSize: 8                             ref size = 8     \\nAddress size: 8                           array header = 24\\nBytes per long: 8                         object header = 16\\nCPU: amd64\\nHeapOopSize: 8\\nHeapWordSize: 8\\nIntSize: 4\\ngetMinObjAlignmentInBytes: 8\\ngetObjectAlignmentInBytes: 8\\nisCompressedOopsEnabled: false\\nisLP64: true\\n\\n# 1.7, 32 bit  \\ngetOopSize: 4                             ref size = 4     \\nAddress size: 4                           array header = 12\\nBytes per long: 8                         object header = 8\\nCPU: x86\\nHeapOopSize: 4\\nHeapWordSize: 4\\nIntSize: 4\\ngetMinObjAlignmentInBytes: 8\\ngetObjectAlignmentInBytes: 8\\nisCompressedOopsEnabled: false\\nisLP64: false\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe question we asked ourselves with Uwe is why an empty array takes 24 bytes without OOP compression (that\'s object overhead and an int length, so should be 16 + 4 = 20)? The answer seems to be in how base offsets are calculated for arrays &#8211; they seem to be enforced on HeapWordSize boundary and this is 8, even with OOP compressed:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e  \\/\\/ Returns the offset of the first element.\\n  static int base_offset_in_bytes(BasicType type) {\\n    return header_size(type) * HeapWordSize;\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eI\'ll spare you the detailed code but the rounding to next HeapWordSize multiple seems evident in all cases. What\'s even more interesting, this \\\"wasted\\\" space is not (and cannot) be used for data so even a single integer pushes the array size to the next available bound:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eint[0] = 24\\nint[1] = 32   (*)\\nint[2] = 32\\nint[3] = 40\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eFinally, I could not resist to mention that object alignments... are adjustable, at least to 2^n boundaries. So you can also do this:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e&gt; java  -XX:-UseCompressedOops -XX:ObjectAlignmentInBytes=32 ...\\nObject = 32\\nint[0] = 32\\nint[1] = 32\\nint[2] = 32\\nint[3] = 64\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eNice, huh? \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e I don\'t think the JVM has been tested heavily for this possibility though because the code hung on me a few times if executed in that mode.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231625_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231625_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 21:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T21:00:38+0000\'\u003e16\\/Mar\\/12 21:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is very interesting indeed.  \\n\\n So, I used the agent hook into a running VM to dump some of the internal diagnostics, including OOP sizes, heap word alignments, etc. Here\'s a scoop of the results (with client-side indicated sizes on the right): \\n\\n  \\n \\n# 1.7, 64 bit, OOPS compressed            (client)\\ngetOopSize: 8                             ref size = 4         \\nAddress size: 8                           array header = 16    \\nBytes per long: 8                         object header = 12   \\nCPU: amd64\\nHeapOopSize: 4\\nHeapWordSize: 8\\nIntSize: 4\\ngetMinObjAlignmentInBytes: 8\\ngetObjectAlignmentInBytes: 8\\nisCompressedOopsEnabled: true\\nisLP64: true\\n\\n\\n# 1.7, 64 bit, full\\ngetOopSize: 8                             ref size = 8     \\nAddress size: 8                           array header = 24\\nBytes per long: 8                         object header = 16\\nCPU: amd64\\nHeapOopSize: 8\\nHeapWordSize: 8\\nIntSize: 4\\ngetMinObjAlignmentInBytes: 8\\ngetObjectAlignmentInBytes: 8\\nisCompressedOopsEnabled: false\\nisLP64: true\\n\\n# 1.7, 32 bit  \\ngetOopSize: 4                             ref size = 4     \\nAddress size: 4                           array header = 12\\nBytes per long: 8                         object header = 8\\nCPU: x86\\nHeapOopSize: 4\\nHeapWordSize: 4\\nIntSize: 4\\ngetMinObjAlignmentInBytes: 8\\ngetObjectAlignmentInBytes: 8\\nisCompressedOopsEnabled: false\\nisLP64: false\\n \\n  \\n\\n The question we asked ourselves with Uwe is why an empty array takes 24 bytes without OOP compression (that\'s object overhead and an int length, so should be 16 + 4 = 20)? The answer seems to be in how base offsets are calculated for arrays &#8211; they seem to be enforced on HeapWordSize boundary and this is 8, even with OOP compressed: \\n  \\n   \\/\\/ Returns the offset of the first element.\\n  static int base_offset_in_bytes(BasicType type) {\\n    return header_size(type) * HeapWordSize;\\n  }\\n \\n  \\n I\'ll spare you the detailed code but the rounding to next HeapWordSize multiple seems evident in all cases. What\'s even more interesting, this \\\"wasted\\\" space is not (and cannot) be used for data so even a single integer pushes the array size to the next available bound: \\n  \\n int[0] = 24\\nint[1] = 32   (*)\\nint[2] = 32\\nint[3] = 40\\n \\n  \\n\\n Finally, I could not resist to mention that object alignments... are adjustable, at least to 2^n boundaries. So you can also do this: \\n  \\n &gt; java  -XX:-UseCompressedOops -XX:ObjectAlignmentInBytes=32 ...\\nObject = 32\\nint[0] = 32\\nint[1] = 32\\nint[2] = 32\\nint[3] = 64\\n \\n  \\n Nice, huh?   I don\'t think the JVM has been tested heavily for this possibility though because the code hung on me a few times if executed in that mode.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231668\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231668&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231668\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231668_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231668_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:07:42+0000\'\u003e16\\/Mar\\/12 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHe, he, he... this is fun, haven\'t been playing with Unsafe for a while and forgot how enjoyable this can be.\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e            Unsafe us = ...;\\n            \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e [] dummy  = {0x11, 0x22, 0x33, 0x44};\\n            \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e []  dummy2 = {0}; \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ match length above.\\n\u003c\\/span\u003e            \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Change the \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eof dummy to \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e[]...\\n\u003c\\/span\u003e            \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e klazz = us.getInt(dummy2, 8);\\n                        us.putInt( dummy, 8, klazz);\\n            \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e will be ok.\\n\u003c\\/span\u003e            dummy2 = (\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e[])(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e) dummy;\\n            \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ and we can run \u003cspan class=\\\"code-keyword\\\"\u003enative\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e accessors on a \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e[] now...\\n\u003c\\/span\u003e            \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(\u003cspan class=\\\"code-quote\\\"\u003e\\\"&gt; \\\"\u003c\\/span\u003e + \u003cspan class=\\\"code-object\\\"\u003eInteger\u003c\\/span\u003e.toHexString(dummy2[0]));\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231668_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231668_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:07:42+0000\'\u003e16\\/Mar\\/12 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    He, he, he... this is fun, haven\'t been playing with Unsafe for a while and forgot how enjoyable this can be. \\n  \\n             Unsafe us = ...;\\n             byte  [] dummy  = {0x11, 0x22, 0x33, 0x44};\\n             int  []  dummy2 = {0};  \\/\\/ match length above.\\n              \\/\\/ Change the  class  of dummy to  int []...\\n              int  klazz = us.getInt(dummy2, 8);\\n                        us.putInt( dummy, 8, klazz);\\n             \\/\\/  this  will be ok.\\n             dummy2 = ( int [])( Object ) dummy;\\n             \\/\\/ and we can run  native   int  accessors on a  byte [] now...\\n              System .out.println( \\\"&gt; \\\"  +  Integer .toHexString(dummy2[0]));\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231673\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231673&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231673\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231673_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231673_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:08:49+0000\'\u003e16\\/Mar\\/12 22:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think Yonik once mentioned he wanted a fast hash over byte[] &#8211; this could be it (temporarily cast to a long[] and then revert after computations are over). Go for it, Yonik \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231673_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231673_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:08:49+0000\'\u003e16\\/Mar\\/12 22:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think Yonik once mentioned he wanted a fast hash over byte[] &#8211; this could be it (temporarily cast to a long[] and then revert after computations are over). Go for it, Yonik                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231679\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231679&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231679\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231679_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231679_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:14:32+0000\'\u003e16\\/Mar\\/12 22:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for investigation. The 8 byte object size multiplier is fixed, so the round-up method is fine.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have been thinking about alignment things. Its a good possibility to get the object size by suming up the field sizes, but it can even be done better.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf unsafe is available and useable, we can simply get the object size (including all headers), by finding the Math.max(field offset + field type length). So the object size is the offset of the last field (with biggest offset) + its size. This value is finally rounded up to multiples of 8.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe attached patch does this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231679_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231679_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:14:32+0000\'\u003e16\\/Mar\\/12 22:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for investigation. The 8 byte object size multiplier is fixed, so the round-up method is fine. \\n\\n I have been thinking about alignment things. Its a good possibility to get the object size by suming up the field sizes, but it can even be done better. \\n\\n If unsafe is available and useable, we can simply get the object size (including all headers), by finding the Math.max(field offset + field type length). So the object size is the offset of the last field (with biggest offset) + its size. This value is finally rounded up to multiples of 8. \\n\\n The attached patch does this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231682\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231682&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231682\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231682_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231682_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:19:52+0000\'\u003e16\\/Mar\\/12 22:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe 8 byte object size multiplier is fixed, so the round-up method is fine.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t think it\'s \\\"fixed\\\" &#8211; see the -XX:ObjectAlignmentInBytes=32 above. But the defaults seem to be the same on all systems.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231682_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231682_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:19:52+0000\'\u003e16\\/Mar\\/12 22:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The 8 byte object size multiplier is fixed, so the round-up method is fine.  \\n\\n I don\'t think it\'s \\\"fixed\\\" &#8211; see the -XX:ObjectAlignmentInBytes=32 above. But the defaults seem to be the same on all systems.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231719\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231719&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231719\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231719_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231719_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:57:44+0000\'\u003e16\\/Mar\\/12 22:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI don\'t think it\'s \\\"fixed\\\" \\u2013 see the -XX:ObjectAlignmentInBytes=32 above. But the defaults seem to be the same on all systems.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI would like to have the rounding also dynamic, but this is not possible to find out with Unsafe, at least for this I have no idea \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231719_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231719_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/12 22:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-16T22:57:44+0000\'\u003e16\\/Mar\\/12 22:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I don\'t think it\'s \\\"fixed\\\" \\u2013 see the -XX:ObjectAlignmentInBytes=32 above. But the defaults seem to be the same on all systems.  \\n\\n I would like to have the rounding also dynamic, but this is not possible to find out with Unsafe, at least for this I have no idea                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231889\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231889&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231889\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231889_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231889_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 08:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T08:04:33+0000\'\u003e17\\/Mar\\/12 08:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eat least for this I have no idea\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe management factory trick mentioned by Kris works for object alignment as well:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epackage\u003c\\/span\u003e spikes;\\n\\n\u003cspan class=\\\"code-keyword\\\"\u003eimport\u003c\\/span\u003e java.io.IOException;\\n\u003cspan class=\\\"code-keyword\\\"\u003eimport\u003c\\/span\u003e java.lang.management.ManagementFactory;\\n\u003cspan class=\\\"code-keyword\\\"\u003eimport\u003c\\/span\u003e java.lang.reflect.Method;\\n\u003cspan class=\\\"code-keyword\\\"\u003eimport\u003c\\/span\u003e java.util.List;\\n\\n\u003cspan class=\\\"code-keyword\\\"\u003eimport\u003c\\/span\u003e com.sun.management.HotSpotDiagnosticMXBean;\\n\u003cspan class=\\\"code-keyword\\\"\u003eimport\u003c\\/span\u003e com.sun.management.VMOption;\\n\\n\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eObAlignment\\n{\\n    \u003cspan class=\\\"code-keyword\\\"\u003eprivate\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e HOTSPOT_BEAN_NAME = \u003cspan class=\\\"code-quote\\\"\u003e\\\"com.sun.management:type=HotSpotDiagnostic\\\"\u003c\\/span\u003e;\\n    \u003cspan class=\\\"code-keyword\\\"\u003eprivate\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e HotSpotDiagnosticMXBean hotspotMBean;\\n    \\n    \u003cspan class=\\\"code-keyword\\\"\u003eprivate\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e HotSpotDiagnosticMXBean getHotSpotMBean() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (hotspotMBean == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n          hotspotMBean = ManagementFactory.newPlatformMXBeanProxy(\\n            ManagementFactory.getPlatformMBeanServer(),\\n            HOTSPOT_BEAN_NAME,\\n            HotSpotDiagnosticMXBean.class);\\n        } \u003cspan class=\\\"code-keyword\\\"\u003ecatch\u003c\\/span\u003e (IOException e) {\\n          e.printStackTrace();\\n        }\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e hotspotMBean;\\n    }\\n\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e void main(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e [] args)\\n        \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e Exception\\n    {\\n        \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Just the object alignment.\\n\u003c\\/span\u003e        \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(getHotSpotMBean().getVMOption(\u003cspan class=\\\"code-quote\\\"\u003e\\\"ObjectAlignmentInBytes\\\"\u003c\\/span\u003e));\\n\\n        \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Everything.\\n\u003c\\/span\u003e        \u003cspan class=\\\"code-object\\\"\u003eClass\u003c\\/span\u003e&lt;?&gt; fc = \u003cspan class=\\\"code-object\\\"\u003eClass\u003c\\/span\u003e.forName(\u003cspan class=\\\"code-quote\\\"\u003e\\\"sun.management.Flag\\\"\u003c\\/span\u003e);\\n        \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(fc);\\n        Method m = fc.getDeclaredMethod(\u003cspan class=\\\"code-quote\\\"\u003e\\\"getAllFlags\\\"\u003c\\/span\u003e);\\n        m.setAccessible(\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n        List&lt;\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e&gt; flags = (List&lt;\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e&gt;) m.invoke(\u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e);\\n        \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e f : flags) {\\n            Method dm = f.getClass().getDeclaredMethod(\u003cspan class=\\\"code-quote\\\"\u003e\\\"getVMOption\\\"\u003c\\/span\u003e);\\n            dm.setAccessible(\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n            VMOption option = (VMOption) dm.invoke(f);\\n            \u003cspan class=\\\"code-object\\\"\u003eSystem\u003c\\/span\u003e.out.println(option);\\n        }\\n    }\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI don\'t think it is of much practical use for now (object alignment seems to be constant everywhere), but we could as well probe it &#8211; if it\'s available why not use it.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'d also like to add a shallow size method (which wouldn\'t follow the fields, just return the aligned object size). I\'ll be able to work on it in the evening though, not sooner.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231889_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231889_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 08:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T08:04:33+0000\'\u003e17\\/Mar\\/12 08:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     at least for this I have no idea  \\n\\n The management factory trick mentioned by Kris works for object alignment as well: \\n  \\n  package  spikes;\\n\\n import  java.io.IOException;\\n import  java.lang.management.ManagementFactory;\\n import  java.lang.reflect.Method;\\n import  java.util.List;\\n\\n import  com.sun.management.HotSpotDiagnosticMXBean;\\n import  com.sun.management.VMOption;\\n\\n public   class  ObAlignment\\n{\\n     private   static   final   String  HOTSPOT_BEAN_NAME =  \\\"com.sun.management:type=HotSpotDiagnostic\\\" ;\\n     private   static  HotSpotDiagnosticMXBean hotspotMBean;\\n    \\n     private   static  HotSpotDiagnosticMXBean getHotSpotMBean() {\\n       if  (hotspotMBean ==  null ) {\\n         try  {\\n          hotspotMBean = ManagementFactory.newPlatformMXBeanProxy(\\n            ManagementFactory.getPlatformMBeanServer(),\\n            HOTSPOT_BEAN_NAME,\\n            HotSpotDiagnosticMXBean.class);\\n        }  catch  (IOException e) {\\n          e.printStackTrace();\\n        }\\n      }\\n       return  hotspotMBean;\\n    }\\n\\n     public   static  void main( String  [] args)\\n         throws  Exception\\n    {\\n         \\/\\/ Just the object alignment.\\n          System .out.println(getHotSpotMBean().getVMOption( \\\"ObjectAlignmentInBytes\\\" ));\\n\\n         \\/\\/ Everything.\\n          Class &lt;?&gt; fc =  Class .forName( \\\"sun.management.Flag\\\" );\\n         System .out.println(fc);\\n        Method m = fc.getDeclaredMethod( \\\"getAllFlags\\\" );\\n        m.setAccessible( true );\\n        List&lt; Object &gt; flags = (List&lt; Object &gt;) m.invoke( null );\\n         for  ( Object  f : flags) {\\n            Method dm = f.getClass().getDeclaredMethod( \\\"getVMOption\\\" );\\n            dm.setAccessible( true );\\n            VMOption option = (VMOption) dm.invoke(f);\\n             System .out.println(option);\\n        }\\n    }\\n}\\n \\n  \\n\\n I don\'t think it is of much practical use for now (object alignment seems to be constant everywhere), but we could as well probe it &#8211; if it\'s available why not use it. \\n\\n I\'d also like to add a shallow size method (which wouldn\'t follow the fields, just return the aligned object size). I\'ll be able to work on it in the evening though, not sooner.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231893\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231893&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231893\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231893_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231893_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 08:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T08:26:29+0000\'\u003e17\\/Mar\\/12 08:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eToo funny,\u003cbr\\/\u003e\\nI had the same idea while at breakfast and started to implement it when you were writing your comment \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI will post patch soon (also with other improvements)!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231893_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231893_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 08:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T08:26:29+0000\'\u003e17\\/Mar\\/12 08:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Too funny, \\nI had the same idea while at breakfast and started to implement it when you were writing your comment   \\n\\n I will post patch soon (also with other improvements)!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231894\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231894&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231894\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231894_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231894_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 08:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T08:31:08+0000\'\u003e17\\/Mar\\/12 08:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI will add a shallow parameter to the estimate method, we just dont have to dig into, so it\'s a simple if check.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231894_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231894_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 08:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T08:31:08+0000\'\u003e17\\/Mar\\/12 08:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I will add a shallow parameter to the estimate method, we just dont have to dig into, so it\'s a simple if check.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231901\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231901&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231901\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231901_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231901_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 08:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T08:56:32+0000\'\u003e17\\/Mar\\/12 08:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew patch:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eretrieve object alignment (default 8, e.g. 32bit JVMs don\'t report it)\u003c\\/li\u003e\\n\\t\u003cli\u003eadd shallow object size measurement\u003c\\/li\u003e\\n\\t\u003cli\u003eadd some security checks to possibly handle the \\\"cookie\\\" warning in Unsafe.objectFieldOffset() (the offsets may be \\\"scaled\\\"). Current JVMs never do this, but the documentation explicitely states that the offsets may not be byte-aligned.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231901_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231901_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 08:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T08:56:32+0000\'\u003e17\\/Mar\\/12 08:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New patch: \\n \\n\\t retrieve object alignment (default 8, e.g. 32bit JVMs don\'t report it) \\n\\t add shallow object size measurement \\n\\t add some security checks to possibly handle the \\\"cookie\\\" warning in Unsafe.objectFieldOffset() (the offsets may be \\\"scaled\\\"). Current JVMs never do this, but the documentation explicitely states that the offsets may not be byte-aligned. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231916\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231916&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231916\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231916_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231916_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 10:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T10:56:42+0000\'\u003e17\\/Mar\\/12 10:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMinor improvements.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231916_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231916_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 10:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T10:56:42+0000\'\u003e17\\/Mar\\/12 10:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Minor improvements.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231981\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231981&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231981\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231981_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231981_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T14:11:45+0000\'\u003e17\\/Mar\\/12 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe patch looks good. I don\'t know if decorating IdentityHashMap to be a set adds any overhead... I was also thinking about doing a custom set impl. for this so that we know how much memory we allocate during the checking itself, but it seems to be very specific to what I need, so no worries.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne thing:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e(size % NUM_BYTES_OBJECT_ALIGNMENT);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eByte alignment will be a power of 2 (that option to change it even enforces it when you start the JVM) so you can do a bitmask instead of modulo - should be slighly faster.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13231981_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231981_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T14:11:45+0000\'\u003e17\\/Mar\\/12 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The patch looks good. I don\'t know if decorating IdentityHashMap to be a set adds any overhead... I was also thinking about doing a custom set impl. for this so that we know how much memory we allocate during the checking itself, but it seems to be very specific to what I need, so no worries. \\n\\n One thing: \\n  \\n (size % NUM_BYTES_OBJECT_ALIGNMENT);\\n \\n  \\n Byte alignment will be a power of 2 (that option to change it even enforces it when you start the JVM) so you can do a bitmask instead of modulo - should be slighly faster.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231986\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231986&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231986\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231986_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231986_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 14:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T14:53:21+0000\'\u003e17\\/Mar\\/12 14:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI separated the shallow Object inspection to a static method, which is more cheap (no RamUsageEstimator instance is needed). The static method now only takes a Class&lt;?&gt; parameter and returns the size (an instance is not even needed).\u003c\\/p\u003e\\n\\n\u003cp\u003eI also added a diagnostic boolean, so you can query RamUsageEstimator, if the used JVM is supported (supports Hotspot diagnostics, sum.misc.Unsafe). If that is not the case, our testcase will print a warning so users cam report back (if they run the tests).\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this is ready to commit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231986_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231986_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 14:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T14:53:21+0000\'\u003e17\\/Mar\\/12 14:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I separated the shallow Object inspection to a static method, which is more cheap (no RamUsageEstimator instance is needed). The static method now only takes a Class&lt;?&gt; parameter and returns the size (an instance is not even needed). \\n\\n I also added a diagnostic boolean, so you can query RamUsageEstimator, if the used JVM is supported (supports Hotspot diagnostics, sum.misc.Unsafe). If that is not the case, our testcase will print a warning so users cam report back (if they run the tests). \\n\\n I think this is ready to commit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231988\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231988&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231988\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231988_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231988_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 14:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T14:58:17+0000\'\u003e17\\/Mar\\/12 14:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eOne thing:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e(size % NUM_BYTES_OBJECT_ALIGNMENT);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eByte alignment will be a power of 2 (that option to change it even enforces it when you start the JVM) so you can do a bitmask instead of modulo - should be slighly faster.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t think thats really needed here \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e Speed is limited by reflection in most cases and this one calculation should not matter. Also the number is not reported back as power of 2, so I have to calc the log2 first (ok, ntz &amp;co.), but I don\'t think we should actually limit that to powers of 2. Maybe another vendor has the ultimate answer of 42 for his objects?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231988_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231988_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 14:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T14:58:17+0000\'\u003e17\\/Mar\\/12 14:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n One thing: \\n  \\n (size % NUM_BYTES_OBJECT_ALIGNMENT);\\n \\n  \\n Byte alignment will be a power of 2 (that option to change it even enforces it when you start the JVM) so you can do a bitmask instead of modulo - should be slighly faster.  \\n\\n I don\'t think thats really needed here   Speed is limited by reflection in most cases and this one calculation should not matter. Also the number is not reported back as power of 2, so I have to calc the log2 first (ok, ntz &amp;co.), but I don\'t think we should actually limit that to powers of 2. Maybe another vendor has the ultimate answer of 42 for his objects?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231989\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231989&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231989\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231989_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231989_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T15:02:27+0000\'\u003e17\\/Mar\\/12 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI don\'t know if decorating IdentityHashMap to be a set adds any overhead\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe whole problem is more that it might happen that the IdentityHashMap takes horrible amounts of memory while inspecting (think of a boxed numbers array like Byte\u003cspan class=\\\"error\\\"\u003e&#91;50000&#93;\u003c\\/span\u003e). Speed is not important, reflection is slow \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI have no better idea about how to detect duplicates, unfortunately. The old trick from Arrays.deepEquals() to stop when the parameter itsself is seen again, is not enough here.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231989_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231989_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T15:02:27+0000\'\u003e17\\/Mar\\/12 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I don\'t know if decorating IdentityHashMap to be a set adds any overhead  \\n\\n The whole problem is more that it might happen that the IdentityHashMap takes horrible amounts of memory while inspecting (think of a boxed numbers array like Byte &#91;50000&#93; ). Speed is not important, reflection is slow   \\n\\n I have no better idea about how to detect duplicates, unfortunately. The old trick from Arrays.deepEquals() to stop when the parameter itsself is seen again, is not enough here.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13231992\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13231992&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13231992\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231992_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231992_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 15:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T15:25:06+0000\'\u003e17\\/Mar\\/12 15:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne more improvement:\u003cbr\\/\u003e\\nThe shallow Class inspection can ignore superclasses, if Unsafe is in use. As additional fields are always added at the end (otherwise casting of classes and later field access would not work inside the JVM), to find the maximum field offset we don\'t need to go to superclasses.\u003c\\/p\u003e\\n\\n\u003cp\u003eI want to commit and backport this to 3.x during the weekend.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13231992_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13231992_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 15:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T15:25:06+0000\'\u003e17\\/Mar\\/12 15:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One more improvement: \\nThe shallow Class inspection can ignore superclasses, if Unsafe is in use. As additional fields are always added at the end (otherwise casting of classes and later field access would not work inside the JVM), to find the maximum field offset we don\'t need to go to superclasses. \\n\\n I want to commit and backport this to 3.x during the weekend.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232006\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232006&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232006\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232006_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232006_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 16:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T16:40:52+0000\'\u003e17\\/Mar\\/12 16:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eReflection don\'t need to cost you much if you make a cache along the way. Retrieving an object\'s class is virtually zero cost so this would make it very efficient and the number of classes in the system is much smaller than the number of objects so it shouldn\'t be a problem.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eto find the maximum field offset we don\'t need to go to superclasses.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI can\'t imagine a situation where this wouldn\'t be the case although an assertion here would be nice just to make sure we\'re not assuming something that isn\'t true.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eI will take a closer look at the patch again this evening and do some testing\\/ API flexibility based on what I have in my project. Will report on the results.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232006_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232006_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 16:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T16:40:52+0000\'\u003e17\\/Mar\\/12 16:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Reflection don\'t need to cost you much if you make a cache along the way. Retrieving an object\'s class is virtually zero cost so this would make it very efficient and the number of classes in the system is much smaller than the number of objects so it shouldn\'t be a problem. \\n\\n  to find the maximum field offset we don\'t need to go to superclasses.  \\n\\n I can\'t imagine a situation where this wouldn\'t be the case although an assertion here would be nice just to make sure we\'re not assuming something that isn\'t true. \\n\\n\\n I will take a closer look at the patch again this evening and do some testing\\/ API flexibility based on what I have in my project. Will report on the results.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232024\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232024&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232024\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232024_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232024_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 17:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T17:30:53+0000\'\u003e17\\/Mar\\/12 17:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eReflection don\'t need to cost you much if you make a cache along the way. Retrieving an object\'s class is virtually zero cost so this would make it very efficient and the number of classes in the system is much smaller than the number of objects so it shouldn\'t be a problem.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWould be like the reflection  cache in AttributeSource \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e But yes I was also thinking about a second IdentityHashMap&lt;Class&lt;?&gt;,Long&gt; along the way.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI can\'t imagine a situation where this wouldn\'t be the case although an assertion here would be nice just to make sure we\'re not assuming something that isn\'t true.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThats already checked in the test, who has 2 subclasses, one with no additional fields (size must be identical) and one with 2 more fields (should be &gt;=).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232024_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232024_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 17:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T17:30:53+0000\'\u003e17\\/Mar\\/12 17:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Reflection don\'t need to cost you much if you make a cache along the way. Retrieving an object\'s class is virtually zero cost so this would make it very efficient and the number of classes in the system is much smaller than the number of objects so it shouldn\'t be a problem.  \\n\\n Would be like the reflection  cache in AttributeSource   But yes I was also thinking about a second IdentityHashMap&lt;Class&lt;?&gt;,Long&gt; along the way. \\n\\n  I can\'t imagine a situation where this wouldn\'t be the case although an assertion here would be nice just to make sure we\'re not assuming something that isn\'t true.  \\n\\n Thats already checked in the test, who has 2 subclasses, one with no additional fields (size must be identical) and one with 2 more fields (should be &gt;=).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232030\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232030&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232030\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13232030_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232030_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 17:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T17:50:59+0000\'\u003e17\\/Mar\\/12 17:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWow, what awesome improvements you guys have added !\u003c\\/p\u003e\\n\\n\u003cp\u003eUwe, +1 to commit. I unassigned myself - you and Dawid definitely deserve the credit!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13232030_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232030_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 17:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T17:50:59+0000\'\u003e17\\/Mar\\/12 17:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Wow, what awesome improvements you guys have added ! \\n\\n Uwe, +1 to commit. I unassigned myself - you and Dawid definitely deserve the credit!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232077\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232077&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232077\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232077_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232077_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 21:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T21:53:22+0000\'\u003e17\\/Mar\\/12 21:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eModified method naming convention: any sizeOf  is \\\"deep\\\", shallowSizeOf* is \\\"shallow\\\". Methods in RUE are now static; didn\'t hide the constructor though (maybe we should?).\u003c\\/p\u003e\\n\\n\u003cp\u003eMore comments in a minute.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232077_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232077_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 21:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T21:53:22+0000\'\u003e17\\/Mar\\/12 21:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Modified method naming convention: any sizeOf  is \\\"deep\\\", shallowSizeOf* is \\\"shallow\\\". Methods in RUE are now static; didn\'t hide the constructor though (maybe we should?). \\n\\n More comments in a minute.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232078\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232078&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232078\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232078_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232078_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 22:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T22:06:35+0000\'\u003e17\\/Mar\\/12 22:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for cleanup!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003edidn\'t hide the constructor though (maybe we should?).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe must. Class is final and has no instance methods -&gt; useless to have ctor. Also as previous versions in 3.x allowed instances, we should prevent this to fix incorrect usage.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232078_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232078_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 22:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T22:06:35+0000\'\u003e17\\/Mar\\/12 22:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for cleanup! \\n\\n  didn\'t hide the constructor though (maybe we should?).  \\n\\n We must. Class is final and has no instance methods -&gt; useless to have ctor. Also as previous versions in 3.x allowed instances, we should prevent this to fix incorrect usage.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232079\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232079&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232079\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232079_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232079_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T22:07:15+0000\'\u003e17\\/Mar\\/12 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve played with the code a bit and I\'ve been trying to figure out a way to determine empirically \\\"how far off\\\" is the estimation from real life usage. It\'s not easy because RUE itself allocates memory (and not small quantities in case of complex object graphs!). I left these experiments in StressRamUsageEstimator; it is a test case &#8211; maybe we should add @Ignore and rename it to Test*, don\'t know.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, the allocation seems to be measured pretty accurately. When tlabs are disabled this is a result of allocating small byte arrays for example:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e committed           max        estimated(allocation)\\n      2 MB\\t   48.4 MB\\t  16 bytes\\n    1.7 MB\\t   48.4 MB\\t  262.4 KB\\n      2 MB\\t   48.4 MB\\t  524.6 KB\\n    2.2 MB\\t   48.4 MB\\t    787 KB\\n    2.5 MB\\t   48.4 MB\\t      1 MB\\n    2.7 MB\\t   48.4 MB\\t    1.3 MB\\n      3 MB\\t   48.4 MB\\t    1.5 MB\\n    3.3 MB\\t   48.4 MB\\t    1.8 MB\\n....\\n   46.9 MB\\t   48.4 MB\\t   45.6 MB\\n   47.1 MB\\t   48.4 MB\\t   45.9 MB\\n   47.4 MB\\t   48.4 MB\\t   46.1 MB\\n   47.6 MB\\t   48.4 MB\\t   46.4 MB\\n   47.9 MB\\t   48.4 MB\\t   46.6 MB\\n   48.1 MB\\t   48.4 MB\\t   46.9 MB\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo it\'s fairly ideal (committed memory is all committed memory so I assume additional data structures, classes, etc. also count in).\u003c\\/p\u003e\\n\\n\u003cp\u003eUnfortunately it\'s not always so smooth, for example jrockit\'s mx beans seem not to return the actual memory allocation state (and if they do, I don\'t understand it):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e committed           max        estimated(allocation)\\n   29.4 MB\\t     50 MB\\t  16 bytes\\n   29.8 MB\\t     50 MB\\t  262.5 KB\\n   30.2 MB\\t     50 MB\\t  524.9 KB\\n   30.4 MB\\t     50 MB\\t  787.3 KB\\n   30.8 MB\\t     50 MB\\t      1 MB\\n   31.1 MB\\t     50 MB\\t    1.3 MB\\n   31.4 MB\\t     50 MB\\t    1.5 MB\\n   31.7 MB\\t     50 MB\\t    1.8 MB\\n     32 MB\\t     50 MB\\t      2 MB\\n   32.4 MB\\t     50 MB\\t    2.3 MB\\n   32.7 MB\\t     50 MB\\t    2.6 MB\\n   33.1 MB\\t     50 MB\\t    2.8 MB\\n   33.5 MB\\t     50 MB\\t    3.1 MB\\n   33.8 MB\\t     50 MB\\t    3.3 MB\\n   34.2 MB\\t     50 MB\\t    3.6 MB\\n   34.5 MB\\t     50 MB\\t    3.8 MB\\n   34.8 MB\\t     50 MB\\t    4.1 MB\\n   35.2 MB\\t     50 MB\\t    4.4 MB\\n   35.5 MB\\t     50 MB\\t    4.6 MB\\n   35.7 MB\\t     50 MB\\t    4.9 MB\\n   36.2 MB\\t     50 MB\\t    5.1 MB\\n   36.4 MB\\t     50 MB\\t    5.4 MB\\n...\\n   49.6 MB\\t     50 MB\\t   47.6 MB\\n     50 MB\\t     50 MB\\t   47.9 MB\\n   49.6 MB\\t     50 MB\\t   48.2 MB\\n   49.9 MB\\t     50 MB\\t   48.4 MB\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eA snapshot from 32 bit HotSpot:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e...\\n   25.5 MB\\t   48.4 MB\\t   24.7 MB\\n   25.7 MB\\t   48.4 MB\\t   24.9 MB\\n   25.9 MB\\t   48.4 MB\\t   25.1 MB\\n   26.1 MB\\t   48.4 MB\\t   25.3 MB\\n   26.3 MB\\t   48.4 MB\\t   25.5 MB\\n   26.5 MB\\t   48.4 MB\\t   25.7 MB\\n   26.7 MB\\t   48.4 MB\\t   25.9 MB\\n   26.8 MB\\t   48.4 MB\\t   26.1 MB\\n     27 MB\\t   48.4 MB\\t   26.4 MB\\n   27.2 MB\\t   48.4 MB\\t   26.6 MB\\n   27.4 MB\\t   48.4 MB\\t   26.8 MB\\n   27.7 MB\\t   48.4 MB\\t     27 MB\\n...\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI see two problems that remain, but I don\'t think they\'re urgent enough to be addressed now:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethe stack easily overflows if the graph of objects has long chains. This is demonstrated in the test case (uncomment ignore annotation).\u003c\\/li\u003e\\n\\t\u003cli\u003ethere is a fair amount of memory allocation going on in the RUE itself. If one \u003cem\u003eknows\u003c\\/em\u003e the graph of an object\'s dependencies is a tree then the memory cost could be decreased to zero (because we wouldn\'t need to remember which objects we\'ve seen so far).\u003c\\/li\u003e\\n\\t\u003cli\u003ewe could make RUE an object again (resign from static methods) and have a cache of classes and class-fields to avoid reflective accesses over and over. If one performed estimations over and over then such a  RUE instance would have an initial cost, but then would be running smoother.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eHaving said that, I\'m +1 for committing this in if you agree with the changes I\'ve made (I will be a pain in the arse about that naming convention discriminating between shallow vs. deep sizeOf though \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232079_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232079_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T22:07:15+0000\'\u003e17\\/Mar\\/12 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve played with the code a bit and I\'ve been trying to figure out a way to determine empirically \\\"how far off\\\" is the estimation from real life usage. It\'s not easy because RUE itself allocates memory (and not small quantities in case of complex object graphs!). I left these experiments in StressRamUsageEstimator; it is a test case &#8211; maybe we should add @Ignore and rename it to Test*, don\'t know. \\n\\n Anyway, the allocation seems to be measured pretty accurately. When tlabs are disabled this is a result of allocating small byte arrays for example: \\n  \\n  committed           max        estimated(allocation)\\n      2 MB\\t   48.4 MB\\t  16 bytes\\n    1.7 MB\\t   48.4 MB\\t  262.4 KB\\n      2 MB\\t   48.4 MB\\t  524.6 KB\\n    2.2 MB\\t   48.4 MB\\t    787 KB\\n    2.5 MB\\t   48.4 MB\\t      1 MB\\n    2.7 MB\\t   48.4 MB\\t    1.3 MB\\n      3 MB\\t   48.4 MB\\t    1.5 MB\\n    3.3 MB\\t   48.4 MB\\t    1.8 MB\\n....\\n   46.9 MB\\t   48.4 MB\\t   45.6 MB\\n   47.1 MB\\t   48.4 MB\\t   45.9 MB\\n   47.4 MB\\t   48.4 MB\\t   46.1 MB\\n   47.6 MB\\t   48.4 MB\\t   46.4 MB\\n   47.9 MB\\t   48.4 MB\\t   46.6 MB\\n   48.1 MB\\t   48.4 MB\\t   46.9 MB\\n \\n  \\n\\n So it\'s fairly ideal (committed memory is all committed memory so I assume additional data structures, classes, etc. also count in). \\n\\n Unfortunately it\'s not always so smooth, for example jrockit\'s mx beans seem not to return the actual memory allocation state (and if they do, I don\'t understand it): \\n  \\n  committed           max        estimated(allocation)\\n   29.4 MB\\t     50 MB\\t  16 bytes\\n   29.8 MB\\t     50 MB\\t  262.5 KB\\n   30.2 MB\\t     50 MB\\t  524.9 KB\\n   30.4 MB\\t     50 MB\\t  787.3 KB\\n   30.8 MB\\t     50 MB\\t      1 MB\\n   31.1 MB\\t     50 MB\\t    1.3 MB\\n   31.4 MB\\t     50 MB\\t    1.5 MB\\n   31.7 MB\\t     50 MB\\t    1.8 MB\\n     32 MB\\t     50 MB\\t      2 MB\\n   32.4 MB\\t     50 MB\\t    2.3 MB\\n   32.7 MB\\t     50 MB\\t    2.6 MB\\n   33.1 MB\\t     50 MB\\t    2.8 MB\\n   33.5 MB\\t     50 MB\\t    3.1 MB\\n   33.8 MB\\t     50 MB\\t    3.3 MB\\n   34.2 MB\\t     50 MB\\t    3.6 MB\\n   34.5 MB\\t     50 MB\\t    3.8 MB\\n   34.8 MB\\t     50 MB\\t    4.1 MB\\n   35.2 MB\\t     50 MB\\t    4.4 MB\\n   35.5 MB\\t     50 MB\\t    4.6 MB\\n   35.7 MB\\t     50 MB\\t    4.9 MB\\n   36.2 MB\\t     50 MB\\t    5.1 MB\\n   36.4 MB\\t     50 MB\\t    5.4 MB\\n...\\n   49.6 MB\\t     50 MB\\t   47.6 MB\\n     50 MB\\t     50 MB\\t   47.9 MB\\n   49.6 MB\\t     50 MB\\t   48.2 MB\\n   49.9 MB\\t     50 MB\\t   48.4 MB\\n \\n  \\n\\n A snapshot from 32 bit HotSpot: \\n  \\n ...\\n   25.5 MB\\t   48.4 MB\\t   24.7 MB\\n   25.7 MB\\t   48.4 MB\\t   24.9 MB\\n   25.9 MB\\t   48.4 MB\\t   25.1 MB\\n   26.1 MB\\t   48.4 MB\\t   25.3 MB\\n   26.3 MB\\t   48.4 MB\\t   25.5 MB\\n   26.5 MB\\t   48.4 MB\\t   25.7 MB\\n   26.7 MB\\t   48.4 MB\\t   25.9 MB\\n   26.8 MB\\t   48.4 MB\\t   26.1 MB\\n     27 MB\\t   48.4 MB\\t   26.4 MB\\n   27.2 MB\\t   48.4 MB\\t   26.6 MB\\n   27.4 MB\\t   48.4 MB\\t   26.8 MB\\n   27.7 MB\\t   48.4 MB\\t     27 MB\\n...\\n \\n  \\n\\n I see two problems that remain, but I don\'t think they\'re urgent enough to be addressed now: \\n \\n\\t the stack easily overflows if the graph of objects has long chains. This is demonstrated in the test case (uncomment ignore annotation). \\n\\t there is a fair amount of memory allocation going on in the RUE itself. If one  knows  the graph of an object\'s dependencies is a tree then the memory cost could be decreased to zero (because we wouldn\'t need to remember which objects we\'ve seen so far). \\n\\t we could make RUE an object again (resign from static methods) and have a cache of classes and class-fields to avoid reflective accesses over and over. If one performed estimations over and over then such a  RUE instance would have an initial cost, but then would be running smoother. \\n \\n\\n\\n Having said that, I\'m +1 for committing this in if you agree with the changes I\'ve made (I will be a pain in the arse about that naming convention discriminating between shallow vs. deep sizeOf though  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232082\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232082&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232082\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232082_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232082_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 22:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T22:10:58+0000\'\u003e17\\/Mar\\/12 22:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOh, one thing that springs to my mind is that we could have an automatically generated class with nested static classes with a random arrangement of all sorts of fields (in all sorts of configurations) and use a similar empirical benchmark to the one I did on small byte arrays but on these objects. This would show if we\'re estimating object field offsets and sizes correctly. \u003c\\/p\u003e\\n\\n\u003cp\u003eI wouldn\'t go into deep object structures though &#8211; I\'ve tried this and it\'s hard to tell what the allocation is and what the overhead\\/ noise of measurement is.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232082_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232082_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 22:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T22:10:58+0000\'\u003e17\\/Mar\\/12 22:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oh, one thing that springs to my mind is that we could have an automatically generated class with nested static classes with a random arrangement of all sorts of fields (in all sorts of configurations) and use a similar empirical benchmark to the one I did on small byte arrays but on these objects. This would show if we\'re estimating object field offsets and sizes correctly.  \\n\\n I wouldn\'t go into deep object structures though &#8211; I\'ve tried this and it\'s hard to tell what the allocation is and what the overhead\\/ noise of measurement is.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232090\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232090&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232090\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232090_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232090_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 22:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T22:43:51+0000\'\u003e17\\/Mar\\/12 22:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi,\u003c\\/p\u003e\\n\\n\u003cp\u003eI am fine with the patch for now, changed in this patch:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eHidden ctor\u003c\\/li\u003e\\n\\t\u003cli\u003eCleaned up test to use static import consequently\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe stress test is an testcase, but not automatically executed (you have to explicitely do that with -Dtestcase=...). I think thats wanted, right? Otherwise we should rename, but its also noisy and slow.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232090_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232090_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/12 22:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-17T22:43:51+0000\'\u003e17\\/Mar\\/12 22:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, \\n\\n I am fine with the patch for now, changed in this patch: \\n \\n\\t Hidden ctor \\n\\t Cleaned up test to use static import consequently \\n \\n\\n\\n The stress test is an testcase, but not automatically executed (you have to explicitely do that with -Dtestcase=...). I think thats wanted, right? Otherwise we should rename, but its also noisy and slow.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232252\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232252&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232252\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232252_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232252_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 10:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T10:53:13+0000\'\u003e18\\/Mar\\/12 10:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFinal patch: I removed some code duplication and improved exception handling for the reflection while iterating class tree. Simply  suppressing is a bad idea, as the resulting size would be underdetermined.\u003c\\/p\u003e\\n\\n\u003cp\u003eI will commit this later this evening and then backport to 3.x.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232252_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232252_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 10:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T10:53:13+0000\'\u003e18\\/Mar\\/12 10:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Final patch: I removed some code duplication and improved exception handling for the reflection while iterating class tree. Simply  suppressing is a bad idea, as the resulting size would be underdetermined. \\n\\n I will commit this later this evening and then backport to 3.x.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232257\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232257&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232257\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13232257_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232257_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 11:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T11:15:18+0000\'\u003e18\\/Mar\\/12 11:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Uwe !\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13232257_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232257_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 11:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T11:15:18+0000\'\u003e18\\/Mar\\/12 11:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Uwe !              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232261\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232261&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232261\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232261_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232261_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 11:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T11:58:33+0000\'\u003e18\\/Mar\\/12 11:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJavadocs fixes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232261_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232261_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 11:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T11:58:33+0000\'\u003e18\\/Mar\\/12 11:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Javadocs fixes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232279\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232279&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232279\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232279_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232279_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 14:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T14:28:03+0000\'\u003e18\\/Mar\\/12 14:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooks good to me, thanks Uwe.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13232279_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232279_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 14:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T14:28:03+0000\'\u003e18\\/Mar\\/12 14:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looks good to me, thanks Uwe.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232281\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232281&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232281\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232281_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232281_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 14:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T14:59:51+0000\'\u003e18\\/Mar\\/12 14:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted trunk revision: 1302133\u003c\\/p\u003e\\n\\n\u003cp\u003eI will now backport with deprecations and add CHANGES.txt later!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232281_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232281_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 14:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T14:59:51+0000\'\u003e18\\/Mar\\/12 14:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed trunk revision: 1302133 \\n\\n I will now backport with deprecations and add CHANGES.txt later!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232291\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232291&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232291\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232291_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232291_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 15:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T15:56:11+0000\'\u003e18\\/Mar\\/12 15:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch for 3.x including backwards layer (deprecated instances of RUE + string interning support). MemoryModels were nuked completely (will add comment to backwards changes).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232291_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232291_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 15:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T15:56:11+0000\'\u003e18\\/Mar\\/12 15:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch for 3.x including backwards layer (deprecated instances of RUE + string interning support). MemoryModels were nuked completely (will add comment to backwards changes).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13232294\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13232294&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13232294\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232294_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232294_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 16:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T16:20:54+0000\'\u003e18\\/Mar\\/12 16:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted 3.x revision: 1302152\u003c\\/p\u003e\\n\\n\u003cp\u003eCHANGES.txt committed in revisions: 1302155 (3.x), 1302156 (trunk)\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks Dawid and Shai!\u003c\\/p\u003e\\n\\n\u003cp\u003eDawid and I will now look into donating this masterpiece to maybe Apache Commons Lang or similar, as it\'s of general use.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13232294_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13232294_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/12 16:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-18T16:20:54+0000\'\u003e18\\/Mar\\/12 16:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed 3.x revision: 1302152 \\n\\n CHANGES.txt committed in revisions: 1302155 (3.x), 1302156 (trunk) \\n\\n Thanks Dawid and Shai! \\n\\n Dawid and I will now look into donating this masterpiece to maybe Apache Commons Lang or similar, as it\'s of general use.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235494\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235494&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235494\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235494_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235494_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 10:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T10:29:18+0000\'\u003e22\\/Mar\\/12 10:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been experimenting a bit with the new code. Field offsets for three classes in a hierarchy with unalignable fields (byte, long combinations at all levels). Note unaligned reordering of byte field in JRockit - nice.\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eJVM: [JVM: HotSpot, Sun Microsystems Inc., 1.6.0_31] (compressed OOPs)\\n@12  4 Super.superByte\\n@16  8 Super.subLong\\n@24  8 Sub.subLong\\n@32  4 Sub.subByte\\n@36  4 SubSub.subSubByte\\n@40  8 SubSub.subSubLong\\n@48    sizeOf(SubSub.class instance)\\n\\nJVM: [JVM: HotSpot, Sun Microsystems Inc., 1.6.0_31] (normal OOPs)\\n@16  8 Super.subLong\\n@24  8 Super.superByte\\n@32  8 Sub.subLong\\n@40  8 Sub.subByte\\n@48  8 SubSub.subSubLong\\n@56  8 SubSub.subSubByte\\n@64    sizeOf(SubSub.class instance)\\n\\n\\nJVM: [JVM: J9, IBM Corporation, 1.6.0]\\n@24  8 Super.subLong\\n@32  4 Super.superByte\\n@36  4 Sub.subByte\\n@40  8 Sub.subLong\\n@48  8 SubSub.subSubLong\\n@56  8 SubSub.subSubByte\\n@64    sizeOf(SubSub.class instance)\\n\\nJVM: [JVM: JRockit, Oracle Corporation, 1.6.0_26] (64-bit JVM!)\\n@ 8  8 Super.subLong\\n@16  1 Super.superByte\\n@17  7 Sub.subByte\\n@24  8 Sub.subLong\\n@32  8 SubSub.subSubLong\\n@40  8 SubSub.subSubByte\\n@48    sizeOf(SubSub.class instance)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235494_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235494_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 10:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T10:29:18+0000\'\u003e22\\/Mar\\/12 10:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve been experimenting a bit with the new code. Field offsets for three classes in a hierarchy with unalignable fields (byte, long combinations at all levels). Note unaligned reordering of byte field in JRockit - nice. \\n\\n  \\n JVM: [JVM: HotSpot, Sun Microsystems Inc., 1.6.0_31] (compressed OOPs)\\n@12  4 Super.superByte\\n@16  8 Super.subLong\\n@24  8 Sub.subLong\\n@32  4 Sub.subByte\\n@36  4 SubSub.subSubByte\\n@40  8 SubSub.subSubLong\\n@48    sizeOf(SubSub.class instance)\\n\\nJVM: [JVM: HotSpot, Sun Microsystems Inc., 1.6.0_31] (normal OOPs)\\n@16  8 Super.subLong\\n@24  8 Super.superByte\\n@32  8 Sub.subLong\\n@40  8 Sub.subByte\\n@48  8 SubSub.subSubLong\\n@56  8 SubSub.subSubByte\\n@64    sizeOf(SubSub.class instance)\\n\\n\\nJVM: [JVM: J9, IBM Corporation, 1.6.0]\\n@24  8 Super.subLong\\n@32  4 Super.superByte\\n@36  4 Sub.subByte\\n@40  8 Sub.subLong\\n@48  8 SubSub.subSubLong\\n@56  8 SubSub.subSubByte\\n@64    sizeOf(SubSub.class instance)\\n\\nJVM: [JVM: JRockit, Oracle Corporation, 1.6.0_26] (64-bit JVM!)\\n@ 8  8 Super.subLong\\n@16  1 Super.superByte\\n@17  7 Sub.subByte\\n@24  8 Sub.subLong\\n@32  8 SubSub.subSubLong\\n@40  8 SubSub.subSubByte\\n@48    sizeOf(SubSub.class instance)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235500\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235500&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235500\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235500_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235500_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:02:33+0000\'\u003e22\\/Mar\\/12 11:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the insight.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen thinking about the reordering, I am a littel bit afraid about the \\\"optimization\\\" in the shallow sizeOf(Class&lt;?&gt;). This optimiaztion does not recurse to superclasses, as it assumes, that all field offsets are greater than those of the superclass, so finding the maximum does not need to recurse up (so it early exits).\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is generally true (also in the above printout), but not guaranteed. E.g. JRockit does it partly (it reuses space inside the superclass area to locate the byte from the subclass). In the above example still the order of fields is always Super-Sub-SubSub, but if the ordeing in the JRockit example would be like:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e@ 8  1 Super.superByte\\n@ 9  7 Sub.subByte\\n@16  8 Super.subLong\\n@24  8 Sub.subLong\\n@32  8 SubSub.subSubLong\\n@40  8 SubSub.subSubByte\\n@48    sizeOf(SubSub.class instance)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe only thing the JVM cannot change is field offsets between sub classes (so the field offset of the superclass is inherited), but it could happen that \u003cb\u003enew\u003c\\/b\u003e fields are located between super\'s fields (see above - it\'s unused space). This would also allow casting and so on (it\'s unused space in superclass). Unfortunately with that reordering the maximum field offset in the subclass is no longer guaranteed to be greater.\u003c\\/p\u003e\\n\\n\u003cp\u003eI would suggest that we remove the \\\"optimization\\\" in the shallow class size method. It\'s too risky in my opinion to underdetermine the size, because the maximum offset in the subclass is &lt; the maximum offset in the superclass.\u003c\\/p\u003e\\n\\n\u003cp\u003eI hope my explanation was understandable... \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eDawid, what do you thing, should we remove the \\\"optimization\\\"? Patch is easy.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235500_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235500_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:02:33+0000\'\u003e22\\/Mar\\/12 11:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the insight. \\n\\n When thinking about the reordering, I am a littel bit afraid about the \\\"optimization\\\" in the shallow sizeOf(Class&lt;?&gt;). This optimiaztion does not recurse to superclasses, as it assumes, that all field offsets are greater than those of the superclass, so finding the maximum does not need to recurse up (so it early exits). \\n\\n This is generally true (also in the above printout), but not guaranteed. E.g. JRockit does it partly (it reuses space inside the superclass area to locate the byte from the subclass). In the above example still the order of fields is always Super-Sub-SubSub, but if the ordeing in the JRockit example would be like: \\n\\n  \\n @ 8  1 Super.superByte\\n@ 9  7 Sub.subByte\\n@16  8 Super.subLong\\n@24  8 Sub.subLong\\n@32  8 SubSub.subSubLong\\n@40  8 SubSub.subSubByte\\n@48    sizeOf(SubSub.class instance)\\n \\n  \\n\\n The only thing the JVM cannot change is field offsets between sub classes (so the field offset of the superclass is inherited), but it could happen that  new  fields are located between super\'s fields (see above - it\'s unused space). This would also allow casting and so on (it\'s unused space in superclass). Unfortunately with that reordering the maximum field offset in the subclass is no longer guaranteed to be greater. \\n\\n I would suggest that we remove the \\\"optimization\\\" in the shallow class size method. It\'s too risky in my opinion to underdetermine the size, because the maximum offset in the subclass is &lt; the maximum offset in the superclass. \\n\\n I hope my explanation was understandable...   \\n\\n Dawid, what do you thing, should we remove the \\\"optimization\\\"? Patch is easy.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235501\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235501&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235501\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235501_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235501_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:09:53+0000\'\u003e22\\/Mar\\/12 11:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI hope my explanation was understandable... \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ePerfectly well. Yes, I agree, it\'s possible to fill in the \\\"holes\\\" packing them with fields from subclasses. It would be a nice vm-level optimization in fact! \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m still experimenting on this code and cleaning\\/ adding javadocs &#8211; I\'ll patch this and provide a complete patch once I\'m done, ok?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235501_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235501_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:09:53+0000\'\u003e22\\/Mar\\/12 11:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I hope my explanation was understandable...   \\n\\n Perfectly well. Yes, I agree, it\'s possible to fill in the \\\"holes\\\" packing them with fields from subclasses. It would be a nice vm-level optimization in fact!  \\n\\n I\'m still experimenting on this code and cleaning\\/ adding javadocs &#8211; I\'ll patch this and provide a complete patch once I\'m done, ok?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235502\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235502&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235502\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235502_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235502_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:11:45+0000\'\u003e22\\/Mar\\/12 11:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 22\\/Mar\\/12 11:12\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK. All you have to remove is the if (fieldFound &amp;&amp; useUnsafe) check and always recurse. fieldFound itsself can also be removed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235502_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235502_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:11:45+0000\'\u003e22\\/Mar\\/12 11:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 22\\/Mar\\/12 11:12\\\"\u003eedited\u003c\\/span\u003e                   OK. All you have to remove is the if (fieldFound &amp;&amp; useUnsafe) check and always recurse. fieldFound itsself can also be removed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235505\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235505&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235505\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235505_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235505_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:17:35+0000\'\u003e22\\/Mar\\/12 11:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJRockit could even compress like this, it would still allow casting as all holes are solely used by one sub-class:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e@ 8  1 Super.superByte\\n@ 9  1 Sub.subByte\\n@10  6 SubSub.subSubByte\\n@16  8 Super.subLong\\n@24  8 Sub.subLong\\n@32  8 SubSub.subSubLong\\n@40    sizeOf(SubSub.class instance)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235505_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235505_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:17:35+0000\'\u003e22\\/Mar\\/12 11:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    JRockit could even compress like this, it would still allow casting as all holes are solely used by one sub-class: \\n\\n  \\n @ 8  1 Super.superByte\\n@ 9  1 Sub.subByte\\n@10  6 SubSub.subSubByte\\n@16  8 Super.subLong\\n@24  8 Sub.subLong\\n@32  8 SubSub.subSubLong\\n@40    sizeOf(SubSub.class instance)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235506\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235506&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235506\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235506_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235506_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:24:20+0000\'\u003e22\\/Mar\\/12 11:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMaybe it does such things already. I didn\'t check extensively.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235506_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235506_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:24:20+0000\'\u003e22\\/Mar\\/12 11:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Maybe it does such things already. I didn\'t check extensively.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235508\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235508&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235508\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235508_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235508_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:26:27+0000\'\u003e22\\/Mar\\/12 11:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe have to remove the shallow size optimization in 3.x and trunk.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235508_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235508_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 11:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T11:26:27+0000\'\u003e22\\/Mar\\/12 11:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We have to remove the shallow size optimization in 3.x and trunk.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235570\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235570&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235570\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235570_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235570_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 13:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T13:20:37+0000\'\u003e22\\/Mar\\/12 13:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI confirmed that this packing indeed takes place. Wrote a pseudo-random test with lots of classes and fields. Here\'s an offender on J9 for example (Wild_\u003c\\/p\u003e\\n{inheritance-level}\\n\u003cp\u003e_\u003c\\/p\u003e\\n{field-number}\\n\u003cp\u003e):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e@24  4 Wild_0_92.fld_0_0_92\\n@28  4 Wild_0_92.fld_1_0_92\\n@32  4 Wild_0_92.fld_2_0_92\\n@36  4 Wild_0_92.fld_3_0_92\\n@40  4 Wild_0_92.fld_4_0_92\\n@44  4 Wild_0_92.fld_5_0_92\\n@48  4 Wild_0_92.fld_6_0_92\\n@52  4 Wild_2_5.fld_0_2_5\\n@56  8 Wild_1_85.fld_0_1_85\\n@64  8 Wild_1_85.fld_1_1_85\\n@72    sizeOf(Wild_2_5 instance)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eHotSpot and JRockit don\'t seem to do this (at least it didn\'t fail on the example).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235570_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235570_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 13:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T13:20:37+0000\'\u003e22\\/Mar\\/12 13:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I confirmed that this packing indeed takes place. Wrote a pseudo-random test with lots of classes and fields. Here\'s an offender on J9 for example (Wild_ \\n{inheritance-level}\\n _ \\n{field-number}\\n ): \\n  \\n @24  4 Wild_0_92.fld_0_0_92\\n@28  4 Wild_0_92.fld_1_0_92\\n@32  4 Wild_0_92.fld_2_0_92\\n@36  4 Wild_0_92.fld_3_0_92\\n@40  4 Wild_0_92.fld_4_0_92\\n@44  4 Wild_0_92.fld_5_0_92\\n@48  4 Wild_0_92.fld_6_0_92\\n@52  4 Wild_2_5.fld_0_2_5\\n@56  8 Wild_1_85.fld_0_1_85\\n@64  8 Wild_1_85.fld_1_1_85\\n@72    sizeOf(Wild_2_5 instance)\\n \\n  \\n\\n HotSpot and JRockit don\'t seem to do this (at least it didn\'t fail on the example).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235577\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235577&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235577\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235577_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235577_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 13:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T13:45:05+0000\'\u003e22\\/Mar\\/12 13:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, in that case shallowSizeOf(Wild_2_5.class) would incorrectly return 56 because of the short-circuit - so let\'s fix this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13235577_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235577_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 13:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T13:45:05+0000\'\u003e22\\/Mar\\/12 13:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, in that case shallowSizeOf(Wild_2_5.class) would incorrectly return 56 because of the short-circuit - so let\'s fix this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13235588\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13235588&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13235588\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235588_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235588_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T14:07:34+0000\'\u003e22\\/Mar\\/12 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYep, that assumption was wrong &#8211; indeed:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eWildClasses.Wild_2_5 wc = new WildClasses.Wild_2_5();\\nwc.fld_6_0_92 = 0x1122;\\nwc.fld_0_2_5 = Float.intBitsToFloat(0xa1a2a3a4);\\nwc.fld_0_1_85 = Double.longBitsToDouble(0xb1b2b3b4b5b6b7L);\\nSystem.out.println(ExpMemoryDumper.dumpObjectMem(wc));\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eresults in:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e0x0000 b0 3d 6f 01 00 00 00 00 0e 80 79 01 00 00 00 00\\n0x0010 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\\n0x0020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\\n0x0030 22 11 00 00 a4 a3 a2 a1 b7 b6 b5 b4 b3 b2 b1 00\\n0x0040 00 00 00 00 00 00 00 00\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eAnd you can see they are reordered and longs are aligned.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll provide a cumulative patch of changes in the evening, there\'s one more thing I wanted to add (cache of fields) because this affects processing speed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13235588_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13235588_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T14:07:34+0000\'\u003e22\\/Mar\\/12 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yep, that assumption was wrong &#8211; indeed: \\n  \\n WildClasses.Wild_2_5 wc = new WildClasses.Wild_2_5();\\nwc.fld_6_0_92 = 0x1122;\\nwc.fld_0_2_5 = Float.intBitsToFloat(0xa1a2a3a4);\\nwc.fld_0_1_85 = Double.longBitsToDouble(0xb1b2b3b4b5b6b7L);\\nSystem.out.println(ExpMemoryDumper.dumpObjectMem(wc));\\n \\n  \\n results in: \\n  \\n 0x0000 b0 3d 6f 01 00 00 00 00 0e 80 79 01 00 00 00 00\\n0x0010 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\\n0x0020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\\n0x0030 22 11 00 00 a4 a3 a2 a1 b7 b6 b5 b4 b3 b2 b1 00\\n0x0040 00 00 00 00 00 00 00 00\\n \\n  \\n And you can see they are reordered and longs are aligned. \\n\\n I\'ll provide a cumulative patch of changes in the evening, there\'s one more thing I wanted to add (cache of fields) because this affects processing speed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13236028\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13236028&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13236028\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13236028_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236028_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 20:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T20:59:52+0000\'\u003e22\\/Mar\\/12 20:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, I admit J9 is fascinating... \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e How much memory does this take?\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eX {\\n  \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e a = 0x11;\\n  \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e b = 0x22;\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eHere is the memory layout:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e[JVM: IBM J9 VM, 2.6, IBM Corporation, IBM Corporation, 1.7.0]\\n0x0000 00 b8 21 c4 5f 7f 00 00 00 00 00 00 00 00 00 00\\n0x0010 11 00 00 00 22 00 00 00\\n@16  4 Super.b1\\n@20  4 Super.b2\\n@24    sizeOf(Super instance)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI don\'t think I screwed up anything. It really is 4 byte alignment \u003cem\u003eon all fields\u003c\\/em\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13236028_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236028_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/12 20:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-22T20:59:52+0000\'\u003e22\\/Mar\\/12 20:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, I admit J9 is fascinating...   How much memory does this take? \\n  \\n  class  X {\\n   byte  a = 0x11;\\n   byte  b = 0x22;\\n}\\n \\n  \\n Here is the memory layout: \\n  \\n [JVM: IBM J9 VM, 2.6, IBM Corporation, IBM Corporation, 1.7.0]\\n0x0000 00 b8 21 c4 5f 7f 00 00 00 00 00 00 00 00 00 00\\n0x0010 11 00 00 00 22 00 00 00\\n@16  4 Super.b1\\n@20  4 Super.b2\\n@24    sizeOf(Super instance)\\n \\n  \\n\\n I don\'t think I screwed up anything. It really is 4 byte alignment  on all fields .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13236504\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13236504&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13236504\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13236504_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236504_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 10:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T10:40:54+0000\'\u003e23\\/Mar\\/12 10:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDon\'t be scared by the size of this patch &#8211; it contains a lot of generated code in WildClasses.\u003c\\/p\u003e\\n\\n\u003cp\u003eImprovements:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003esize estimation is not recursive (which led to stack overflows quite easily on more complex object graphs),\u003c\\/li\u003e\\n\\t\u003cli\u003edecreased memory consumption by using a custom impl. of an identity object set.\u003c\\/li\u003e\\n\\t\u003cli\u003eadded a cache of resolved class information (ref. fields, shallow size).\u003c\\/li\u003e\\n\\t\u003cli\u003eremoved the optimization of counting only subclass field offsets because fields can be packed (J9).\u003c\\/li\u003e\\n\\t\u003cli\u003eadded more verbose information about unsupported JVM features. J9 doesn\'t have the MX bean for example (and does dump this).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe above changes also speed up the entire processing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13236504_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236504_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 10:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T10:40:54+0000\'\u003e23\\/Mar\\/12 10:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Don\'t be scared by the size of this patch &#8211; it contains a lot of generated code in WildClasses. \\n\\n Improvements: \\n \\n\\t size estimation is not recursive (which led to stack overflows quite easily on more complex object graphs), \\n\\t decreased memory consumption by using a custom impl. of an identity object set. \\n\\t added a cache of resolved class information (ref. fields, shallow size). \\n\\t removed the optimization of counting only subclass field offsets because fields can be packed (J9). \\n\\t added more verbose information about unsupported JVM features. J9 doesn\'t have the MX bean for example (and does dump this). \\n \\n\\n\\n The above changes also speed up the entire processing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13236537\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13236537&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13236537\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13236537_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236537_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 12:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T12:24:10+0000\'\u003e23\\/Mar\\/12 12:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAdded a test case for identity has set, removed constants, removed wild classes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13236537_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236537_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 12:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T12:24:10+0000\'\u003e23\\/Mar\\/12 12:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Added a test case for identity has set, removed constants, removed wild classes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13236557\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13236557&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13236557\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13236557_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236557_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 12:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T12:59:29+0000\'\u003e23\\/Mar\\/12 12:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think the patch is now fine! I will commit it later and backport to 3.x.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13236557_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236557_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 12:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T12:59:29+0000\'\u003e23\\/Mar\\/12 12:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think the patch is now fine! I will commit it later and backport to 3.x.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13236626\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13236626&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13236626\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13236626_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236626_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T14:29:16+0000\'\u003e23\\/Mar\\/12 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Uwe. I\'ll be working in the evening again but if you\'re faster go ahead and commit it in.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13236626_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236626_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T14:29:16+0000\'\u003e23\\/Mar\\/12 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Uwe. I\'ll be working in the evening again but if you\'re faster go ahead and commit it in.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13236964\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13236964&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13236964\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13236964_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236964_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 19:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T19:17:44+0000\'\u003e23\\/Mar\\/12 19:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted trunk revision: 1304485, 1304513, 1304564\u003cbr\\/\u003e\\nCommitted 3.x revision: 1304565\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13236964_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13236964_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 19:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T19:17:44+0000\'\u003e23\\/Mar\\/12 19:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed trunk revision: 1304485, 1304513, 1304564 \\nCommitted 3.x revision: 1304565              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13237172\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13237172&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13237172\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13237172_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13237172_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 21:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T21:47:32+0000\'\u003e23\\/Mar\\/12 21:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dawid Weiss - 23\\/Mar\\/12 21:47\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been thinking how one can assess the estimation quality of the new code. I came up with this:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eI allocate an Object[] half the size of estimated maximum available RAM (just to make sure all objects will fit without the need to reallocate),\u003c\\/li\u003e\\n\\t\u003cli\u003eI precompute shallow sizes for instances of all \\\"wild classes\\\" (classes with random fields, including arrays).\u003c\\/li\u003e\\n\\t\u003cli\u003eI then fill in the \\\"vault\\\" array above with random instances of wild classes, summing up the estimated size UNTIL I HIT OOM.\u003c\\/li\u003e\\n\\t\u003cli\u003eOnce I git OOM I know how much we actually allocated vs. how much space we thought we did allocate.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe results are very accurate on HotSpot if one is using serial GC. For example:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e[JVM: Java HotSpot(TM) 64-Bit Server VM, 20.4-b02, Sun Microsystems Inc., Sun Microsystems Inc., 1.6.0_29]\\nMax: 483.4 MB, Used: 698.9 KB, Committed: 123.8 MB\\nExpected free: 240.9 MB, Allocated estimation: 240.8 MB, Difference: -0.05% (113.6 KB)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eIf one runs with a parallel GC things do get out of hand because the GC is not keeping up with allocations (although I\'m not sure how I should interpret this because we only allocate; it\'s not possible to free any space &#8211; maybe there are different GC pools or something):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e[JVM: Java HotSpot(TM) 64-Bit Server VM, 20.4-b02, Sun Microsystems Inc., Sun Microsystems Inc., 1.6.0_29]\\nMax: 444.5 MB, Used: 655.4 KB, Committed: 122.7 MB\\nExpected free: 221.5 MB, Allocated estimation: 174.2 MB, Difference: -21.34% (47.3 MB)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eJRockit:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e[JVM: Oracle JRockit(R), R28.1.4-7-144370-1.6.0_26-20110617-2130-windows-x86_64, Oracle Corporation, Oracle Corporation, 1.6.0_26]\\nMax: 500 MB, Used: 3.5 MB, Committed: 64 MB\\nExpected free: 247.7 MB, Allocated estimation: 249.5 MB, Difference: 0.74% (1.8 MB)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI think we\'re good. If somebody wishes to experiment, the spike is here:\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/github.com\\/dweiss\\/java-sizeof\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/github.com\\/dweiss\\/java-sizeof\u003c\\/a\u003e\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003emvn test\\nmvn dependency:copy-dependencies\\njava -cp target\\\\classes:target\\\\test-classes:target\\\\dependency\\\\junit-4.10.jar \\\\\\n  com.carrotsearch.sizeof.TestEstimationQuality\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13237172_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13237172_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/12 21:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-23T21:47:32+0000\'\u003e23\\/Mar\\/12 21:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dawid Weiss - 23\\/Mar\\/12 21:47\\\"\u003eedited\u003c\\/span\u003e                   I\'ve been thinking how one can assess the estimation quality of the new code. I came up with this: \\n \\n\\t I allocate an Object[] half the size of estimated maximum available RAM (just to make sure all objects will fit without the need to reallocate), \\n\\t I precompute shallow sizes for instances of all \\\"wild classes\\\" (classes with random fields, including arrays). \\n\\t I then fill in the \\\"vault\\\" array above with random instances of wild classes, summing up the estimated size UNTIL I HIT OOM. \\n\\t Once I git OOM I know how much we actually allocated vs. how much space we thought we did allocate. \\n \\n\\n\\n The results are very accurate on HotSpot if one is using serial GC. For example: \\n  \\n [JVM: Java HotSpot(TM) 64-Bit Server VM, 20.4-b02, Sun Microsystems Inc., Sun Microsystems Inc., 1.6.0_29]\\nMax: 483.4 MB, Used: 698.9 KB, Committed: 123.8 MB\\nExpected free: 240.9 MB, Allocated estimation: 240.8 MB, Difference: -0.05% (113.6 KB)\\n \\n  \\n\\n If one runs with a parallel GC things do get out of hand because the GC is not keeping up with allocations (although I\'m not sure how I should interpret this because we only allocate; it\'s not possible to free any space &#8211; maybe there are different GC pools or something): \\n  \\n [JVM: Java HotSpot(TM) 64-Bit Server VM, 20.4-b02, Sun Microsystems Inc., Sun Microsystems Inc., 1.6.0_29]\\nMax: 444.5 MB, Used: 655.4 KB, Committed: 122.7 MB\\nExpected free: 221.5 MB, Allocated estimation: 174.2 MB, Difference: -21.34% (47.3 MB)\\n \\n  \\n\\n JRockit: \\n  \\n [JVM: Oracle JRockit(R), R28.1.4-7-144370-1.6.0_26-20110617-2130-windows-x86_64, Oracle Corporation, Oracle Corporation, 1.6.0_26]\\nMax: 500 MB, Used: 3.5 MB, Committed: 64 MB\\nExpected free: 247.7 MB, Allocated estimation: 249.5 MB, Difference: 0.74% (1.8 MB)\\n \\n  \\n\\n I think we\'re good. If somebody wishes to experiment, the spike is here: \\n https:\\/\\/github.com\\/dweiss\\/java-sizeof  \\n  \\n mvn test\\nmvn dependency:copy-dependencies\\njava -cp target\\\\classes:target\\\\test-classes:target\\\\dependency\\\\junit-4.10.jar \\\\\\n  com.carrotsearch.sizeof.TestEstimationQuality\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13238203\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13238203&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13238203\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13238203_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13238203_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Mar\\/12 08:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-26T08:27:51+0000\'\u003e26\\/Mar\\/12 08:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor historical records: the previous implementation of RamUsageEstimator was off by anything between 3% (random size objects, including arrays) to 20% (objects smaller than 80 bytes). Again &#8211; these are \\\"perfect scenario\\\" measurements with empty heap and max. allocation until OOM, with a serial GC. With a concurrent and parallel GCs the memory consumption estimation is still accurate but it\'s nearly impossible to tell when an OOM will occur or how the GC will manage the heap space. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13238203_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13238203_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Mar\\/12 08:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-26T08:27:51+0000\'\u003e26\\/Mar\\/12 08:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For historical records: the previous implementation of RamUsageEstimator was off by anything between 3% (random size objects, including arrays) to 20% (objects smaller than 80 bytes). Again &#8211; these are \\\"perfect scenario\\\" measurements with empty heap and max. allocation until OOM, with a serial GC. With a concurrent and parallel GCs the memory consumption estimation is still accurate but it\'s nearly impossible to tell when an OOM will occur or how the GC will manage the heap space.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13238206\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13238206&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13238206\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13238206_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13238206_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Mar\\/12 08:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-26T08:32:43+0000\'\u003e26\\/Mar\\/12 08:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat\'s true. But you can still get the \\\"unreleaseable allocation\\\", so the size of the non-gc-able object graph. If GC does not free the objects after release fast-enough, it will still do it once memory gets low. But the allocated objects with hard refs are not releaseable.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I think it\'s fine for memory requirement purposes. If you want real heap allocation, you must use instrumentation.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13238206_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13238206_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Mar\\/12 08:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-26T08:32:43+0000\'\u003e26\\/Mar\\/12 08:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That\'s true. But you can still get the \\\"unreleaseable allocation\\\", so the size of the non-gc-able object graph. If GC does not free the objects after release fast-enough, it will still do it once memory gets low. But the allocated objects with hard refs are not releaseable. \\n\\n So I think it\'s fine for memory requirement purposes. If you want real heap allocation, you must use instrumentation.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13238208\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3867?focusedCommentId=13238208&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13238208\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13238208_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13238208_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Mar\\/12 08:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-26T08:45:41+0000\'\u003e26\\/Mar\\/12 08:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI didn\'t say it\'s wrong &#8211; it is fine and accurate. What I\'m saying is that it\'s not really suitable for predictions; for answering questions like: how many objects of a given type\\/ types can I allocate before an OOM hits me? It doesn\'t really surprise me that much, but it would be nice. For measuring already allocated stuff it\'s more than fine of course.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dweiss\\\" id=\\\"commentauthor_13238208_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dweiss\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dweiss\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dawid Weiss\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13238208_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Mar\\/12 08:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-26T08:45:41+0000\'\u003e26\\/Mar\\/12 08:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I didn\'t say it\'s wrong &#8211; it is fine and accurate. What I\'m saying is that it\'s not really suitable for predictions; for answering questions like: how many objects of a given type\\/ types can I allocate before an OOM hits me? It doesn\'t really surprise me that much, but it would be nice. For measuring already allocated stuff it\'s more than fine of course.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520245022646"> 
    <input type="hidden" title="jira.request.server.time" value="303"> 
    <input type="hidden" title="jira.request.id" value="617x94594556x3"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="1"> 
    <input type="hidden" title="db.reads.time.in.ms" value="27"> 
    <input type="hidden" title="db.conns.time.in.ms" value="33"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 617x94594556x3
	          REQUEST TIMESTAMP : [05/Mar/2018:10:17:02 +0000]
	               REQUEST TIME : 0.3030
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 1

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=16, elapsedTotal=27644136, elapsedMin=544550, elapsedMax=10089438, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=20, elapsedTotal=33812274, elapsedMin=506170, elapsedMax=10115281, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>