<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|06cd90f066b6fc278fe5f9338bd32826a0d438bf|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"6cc240c3f87493\"";
WRM._unparsedData["project-id"]="12310230";
WRM._unparsedData["project-key"]="\"SOLR\"";
WRM._unparsedData["project-name"]="\"Solr\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310230";
WRM._unparsedData["projectKey"]="\"SOLR\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="SOLR-665"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[SOLR-665] FIFO Cache (Unsynchronized): 9x times performance boost - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[SOLR-665] FIFO Cache (Unsynchronized): 9x times performance boost - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/SOLR" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-665">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310230" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Solr'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310230&amp;avatarId=22151"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/SOLR">Solr</a></li>
                 <li><a class="issue-link" data-issue-key="SOLR-665" href="/jira/browse/SOLR-665" id="key-val" rel="12401132">SOLR-665</a></li>
                </ol>
                <h1 id="summary-val">FIFO Cache (Unsynchronized): 9x times performance boost</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-665"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/SOLR-665/SOLR-665.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/SOLR-665/SOLR-665.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/SOLR-665/SOLR-665.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/SOLR-665/SOLR-665.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Duplicate </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="1.3 ">1.3</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12401132-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value"> 
                    <p>JRockit R27 (Java 6)</p> 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Attached is modified version of LRUCache where <br> 1. map = new LinkedHashMap(initialSize, 0.75f, false) - so that "reordering"/true (performance bottleneck of LRU) is replaced to "insertion-order"/false (so that it became FIFO)<br> 2. Almost all (absolutely unneccessary) synchronized statements commented out</p> 
                  <p>See discussion at <a href="http://www.nabble.com/LRUCache---synchronized%21--td16439831.html" class="external-link" rel="nofollow">http://www.nabble.com/LRUCache---synchronized%21--td16439831.html</a></p> 
                  <p>Performance metrics (taken from SOLR Admin):</p> 
                  <p>LRU<br> Requests: 7638<br> Average Time-Per-Request: 15300<br> Average Request-per-Second: 0.06</p> 
                  <p>FIFO:<br> Requests: 3355<br> Average Time-Per-Request: 1610<br> Average Request-per-Second: 0.11</p> 
                  <p>Performance increased 9 times which roughly corresponds to a number of CPU in a system, <a href="http://www.tokenizer.org/" class="external-link" rel="nofollow">http://www.tokenizer.org/</a> (Shopping Search Engine at Tokenizer.org)</p> 
                  <p>Current number of documents: 7494689<br> name: filterCache <br> class: org.apache.solr.search.LRUCache <br> version: 1.0 <br> description: LRU Cache(maxSize=10000000, initialSize=1000) <br> stats: lookups : 15966954582<br> hits : 16391851546<br> hitratio : 0.102<br> inserts : 4246120<br> evictions : 0<br> size : 2668705<br> cumulative_lookups : 16415839763<br> cumulative_hits : 16411608101<br> cumulative_hitratio : 0.99<br> cumulative_inserts : 4246246<br> cumulative_evictions : 0 </p> 
                  <p>Thanks</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/SOLR-665?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/SOLR-665?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/SOLR-665?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/SOLR-665?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12387099" data-issue-id="12401132" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12387099/ConcurrentFIFOCache.java" draggable="true" data-downloadurl="text/plain:ConcurrentFIFOCache.java:https://issues.apache.org/jira/secure/attachment/12387099/ConcurrentFIFOCache.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12387099/ConcurrentFIFOCache.java" title="Latest  29/Jul/08 14:42 - Noble Paul" draggable="true" data-downloadurl="text/plain:ConcurrentFIFOCache.java:https://issues.apache.org/jira/secure/attachment/12387099/ConcurrentFIFOCache.java">ConcurrentFIFOCache.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-07-29T14:42:39.620Z">29/Jul/08 14:42</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Noble Paul
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12387083" data-issue-id="12401132" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12387083/ConcurrentFIFOCache.java" draggable="true" data-downloadurl="text/plain:ConcurrentFIFOCache.java:https://issues.apache.org/jira/secure/attachment/12387083/ConcurrentFIFOCache.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12387083/ConcurrentFIFOCache.java" title=" 29/Jul/08 06:26 - Noble Paul" draggable="true" data-downloadurl="text/plain:ConcurrentFIFOCache.java:https://issues.apache.org/jira/secure/attachment/12387083/ConcurrentFIFOCache.java">ConcurrentFIFOCache.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-07-29T06:26:12.746Z">29/Jul/08 06:26</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Noble Paul
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12387089" data-issue-id="12401132" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12387089/ConcurrentLRUCache.java" draggable="true" data-downloadurl="text/plain:ConcurrentLRUCache.java:https://issues.apache.org/jira/secure/attachment/12387089/ConcurrentLRUCache.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12387089/ConcurrentLRUCache.java" title="Latest  29/Jul/08 09:34 - Noble Paul" draggable="true" data-downloadurl="text/plain:ConcurrentLRUCache.java:https://issues.apache.org/jira/secure/attachment/12387089/ConcurrentLRUCache.java">ConcurrentLRUCache.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-07-29T09:34:51.760Z">29/Jul/08 09:34</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Noble Paul
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12387161" data-issue-id="12401132" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12387161/ConcurrentLRUWeakCache.java" draggable="true" data-downloadurl="text/x-java:ConcurrentLRUWeakCache.java:https://issues.apache.org/jira/secure/attachment/12387161/ConcurrentLRUWeakCache.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12387161/ConcurrentLRUWeakCache.java" title="Latest  30/Jul/08 04:50 - Fuad Efendi" draggable="true" data-downloadurl="text/x-java:ConcurrentLRUWeakCache.java:https://issues.apache.org/jira/secure/attachment/12387161/ConcurrentLRUWeakCache.java">ConcurrentLRUWeakCache.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-07-30T04:50:03.450Z">30/Jul/08 04:50</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Fuad Efendi
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12387002" data-issue-id="12401132" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12387002/FIFOCache.java" draggable="true" data-downloadurl="text/x-java:FIFOCache.java:https://issues.apache.org/jira/secure/attachment/12387002/FIFOCache.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12387002/FIFOCache.java" title="Latest  28/Jul/08 03:25 - Fuad Efendi" draggable="true" data-downloadurl="text/x-java:FIFOCache.java:https://issues.apache.org/jira/secure/attachment/12387002/FIFOCache.java">FIFOCache.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-07-28T03:25:32.987Z">28/Jul/08 03:25</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Fuad Efendi
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12387200" data-issue-id="12401132" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12387200/SimplestConcurrentLRUCache.java" draggable="true" data-downloadurl="text/plain:SimplestConcurrentLRUCache.java:https://issues.apache.org/jira/secure/attachment/12387200/SimplestConcurrentLRUCache.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12387200/SimplestConcurrentLRUCache.java" title="Latest  30/Jul/08 15:05 - Fuad Efendi" draggable="true" data-downloadurl="text/plain:SimplestConcurrentLRUCache.java:https://issues.apache.org/jira/secure/attachment/12387200/SimplestConcurrentLRUCache.java">SimplestConcurrentLRUCache.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-07-30T15:05:42.905Z">30/Jul/08 15:05</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Fuad Efendi
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10453"></span></span> Unassigned </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_funtick" rel="funtick" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Fuad Efendi&quot;,&quot;emailAddress&quot;:&quot;fuad@efendi.ca&quot;,&quot;username&quot;:&quot;funtick&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="funtick"></span></span> Fuad Efendi </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">5</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="28/Jul/08 03:24"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2008-07-28T03:24:29+0000">28/Jul/08 03:24</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="21/Feb/09 15:31"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2009-02-21T15:31:33+0000">21/Feb/09 15:31</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="21/Feb/09 15:31"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2009-02-21T15:31:33+0000">21/Feb/09 15:31</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="timetrackingmodule" class="module toggle-wrap">
               <div id="timetrackingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Time Tracking</h2>
               </div>
               <div class="mod-content"> 
                <div id="tt_single_table_info" class="tt_inner"> 
                 <dl> 
                  <dt id="tt_single_text_orig" class="tt_text" title="Original Estimate - 672h">
                    Estimated: 
                  </dt> 
                  <dd class="tt_graph"> 
                   <table id="tt_single_graph_orig" cellspacing="0" cellpadding="0" class="tt_graph"> 
                    <tbody>
                     <tr class="tt_graph"> 
                      <td style="width:100%; background-color:#89afd7"> <img src="/jira/images/border/spacer.gif" style="height:10px; width:100%; border-width:0" class="hideOnPrint" title="Original Estimate - 672h" alt="Original Estimate - 672h"> </td> 
                     </tr> 
                    </tbody>
                   </table> 
                  </dd> 
                  <dd id="tt_single_values_orig" class="tt_values" title="Original Estimate - 672h">
                    672h 
                  </dd> 
                 </dl> 
                 <dl> 
                  <dt id="tt_single_text_remain" class="tt_text" title="Remaining Estimate - 672h">
                    Remaining: 
                  </dt> 
                  <dd class="tt_graph"> 
                   <table id="tt_single_graph_remain" cellspacing="0" cellpadding="0" class="tt_graph"> 
                    <tbody>
                     <tr class="tt_graph"> 
                      <td style="width:100%; background-color:#ec8e00"> <img src="/jira/images/border/spacer.gif" style="height:10px; width:100%; border-width:0" class="hideOnPrint" title="Remaining Estimate - 672h" alt="Remaining Estimate - 672h"> </td> 
                     </tr> 
                    </tbody>
                   </table> 
                  </dd> 
                  <dd id="tt_single_values_remain" class="tt_values" title="Remaining Estimate - 672h">
                    672h 
                  </dd> 
                 </dl> 
                 <dl> 
                  <dt id="tt_single_text_spent" class="tt_text" title="Time Spent - Not Specified">
                    Logged: 
                  </dt> 
                  <dd class="tt_graph"> 
                   <table id="tt_single_graph_spent" cellspacing="0" cellpadding="0" class="tt_graph"> 
                    <tbody>
                     <tr class="tt_graph"> 
                      <td style="width:100%; background-color:#cccccc"> <img src="/jira/images/border/spacer.gif" style="height:10px; width:100%; border-width:0" class="hideOnPrint" title="Time Spent - Not Specified" alt="Time Spent - Not Specified"> </td> 
                     </tr> 
                    </tbody>
                   </table> 
                  </dd> 
                  <dd id="tt_single_values_spent" class="tt_values" title="Time Spent - Not Specified">
                    Not Specified 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-665?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/SOLR-665?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12617357\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617357&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617357\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617357_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617357_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 03:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T03:29:08+0000\'\u003e28\\/Jul\\/08 03:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI renamed to FIFOCache just before opening an issue; in a local system it is (modified) LRUCache so that filterCache has reference to \'old\' name...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617357_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617357_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 03:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T03:29:08+0000\'\u003e28\\/Jul\\/08 03:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I renamed to FIFOCache just before opening an issue; in a local system it is (modified) LRUCache so that filterCache has reference to \'old\' name...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617359\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617359&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617359\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617359_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617359_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 04:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T04:34:01+0000\'\u003e28\\/Jul\\/08 04:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlmost forgot: I am estimating performance gains basing on real application in-production, multithreaded, Tomcat 6.0.16 &amp; JRockit R27 (Java 6) &amp; SLES10 &amp; two quad-core Opteron 2350 (8 CPUs total) &amp; 25Gb for SOLR...\u003cbr\\/\u003e\\nAnd, first queries run a long, more than a minute (warming up caches with faceted query id:\u003cspan class=\\\"error\\\"\u003e&#91;* TO *&#93;\u003c\\/span\u003e) average Time-Per-Request decreases over time and it is now 1591.5232 giving 10x performance boost.\u003cbr\\/\u003e\\nFacets are highly distributed as you can see from website and filterCache... HTTP caching is supported - to see real timing you should execute real queries...\u003cbr\\/\u003e\\nConcurrentHashMap is not applicable - we are not modifying cached item indeed... FIFO is without \'Out\' if we have enough memory.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617359_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617359_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 04:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T04:34:01+0000\'\u003e28\\/Jul\\/08 04:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Almost forgot: I am estimating performance gains basing on real application in-production, multithreaded, Tomcat 6.0.16 &amp; JRockit R27 (Java 6) &amp; SLES10 &amp; two quad-core Opteron 2350 (8 CPUs total) &amp; 25Gb for SOLR... \\nAnd, first queries run a long, more than a minute (warming up caches with faceted query id: &#91;* TO *&#93; ) average Time-Per-Request decreases over time and it is now 1591.5232 giving 10x performance boost. \\nFacets are highly distributed as you can see from website and filterCache... HTTP caching is supported - to see real timing you should execute real queries... \\nConcurrentHashMap is not applicable - we are not modifying cached item indeed... FIFO is without \'Out\' if we have enough memory.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617420\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617420&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617420\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617420_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617420_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 13:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T13:29:31+0000\'\u003e28\\/Jul\\/08 13:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis implementation isn\'t thread safe (due the the removed synchronization).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617420_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617420_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 13:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T13:29:31+0000\'\u003e28\\/Jul\\/08 13:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This implementation isn\'t thread safe (due the the removed synchronization).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617422\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617422&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617422\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617422_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617422_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 13:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T13:37:49+0000\'\u003e28\\/Jul\\/08 13:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhy do we have almost the entire \u003cem\u003eget()\u003c\\/em\u003e method synchronized on the map in LRUCache . \u003cbr\\/\u003e\\nstats increment can possibly be put out of synchronized \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617422_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617422_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 13:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T13:37:49+0000\'\u003e28\\/Jul\\/08 13:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Why do we have almost the entire  get()  method synchronized on the map in LRUCache .  \\nstats increment can possibly be put out of synchronized               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617427\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617427&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617427\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617427_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617427_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 13:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T13:52:26+0000\'\u003e28\\/Jul\\/08 13:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhy do we have almost the entire get() method synchronized on the map in LRUCache . \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt simplified the code and reduced the number of branches.  What\'s your proposed version?\u003cbr\\/\u003e\\nHere is the current method:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e get(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e key) {\\n    \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (map) {\\n      \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e val = map.get(key);\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (state == State.LIVE) {\\n        \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ only increment lookups and hits \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e we are live.\\n\u003c\\/span\u003e        lookups++;\\n        stats.lookups.incrementAndGet();\\n        \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (val!=\u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n          hits++;\\n          stats.hits.incrementAndGet();\\n        }\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e val;\\n    }\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617427_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617427_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 13:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T13:52:26+0000\'\u003e28\\/Jul\\/08 13:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Why do we have almost the entire get() method synchronized on the map in LRUCache .   \\n\\n It simplified the code and reduced the number of branches.  What\'s your proposed version? \\nHere is the current method: \\n  \\n    public   Object  get( Object  key) {\\n     synchronized  (map) {\\n       Object  val = map.get(key);\\n       if  (state == State.LIVE) {\\n         \\/\\/ only increment lookups and hits  if  we are live.\\n         lookups++;\\n        stats.lookups.incrementAndGet();\\n         if  (val!= null ) {\\n          hits++;\\n          stats.hits.incrementAndGet();\\n        }\\n      }\\n       return  val;\\n    }\\n  }\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617431\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617431&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617431\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617431_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617431_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 14:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T14:06:45+0000\'\u003e28\\/Jul\\/08 14:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Noble Paul - 28\\/Jul\\/08 14:19\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI guess this is safe and faster\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e get(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e key) {\\n    \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (map) {\\n      \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e val = map.get(key);\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (state == State.LIVE) {\\n        \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ only increment lookups and hits \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e we are live.\\n\u003c\\/span\u003e        lookups++;\\n      }\\n    }\\n      stats.lookups.incrementAndGet();\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (val != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/hits++; \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e must be removed\\n\u003c\\/span\u003e        stats.hits.incrementAndGet();\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e val;\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003elet us remove the field hits and use stats.hits wherever we need it\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617431_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617431_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 14:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T14:06:45+0000\'\u003e28\\/Jul\\/08 14:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Noble Paul - 28\\/Jul\\/08 14:19\\\"\u003eedited\u003c\\/span\u003e                   I guess this is safe and faster \\n  \\n  public   Object  get( Object  key) {\\n     synchronized  (map) {\\n       Object  val = map.get(key);\\n       if  (state == State.LIVE) {\\n         \\/\\/ only increment lookups and hits  if  we are live.\\n         lookups++;\\n      }\\n    }\\n      stats.lookups.incrementAndGet();\\n       if  (val !=  null ) {\\n         \\/\\/hits++;  this  must be removed\\n         stats.hits.incrementAndGet();\\n      }\\n       return  val;\\n  }\\n \\n  \\n\\n let us remove the field hits and use stats.hits wherever we need it              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617436\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617436&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617436\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617436_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617436_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 14:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T14:35:23+0000\'\u003e28\\/Jul\\/08 14:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 28\\/Jul\\/08 14:35\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYour version changes what the method does in a couple of respects though.\u003c\\/p\u003e\\n\u003cblockquote\u003e\u003cp\u003elet us remove the field hits and use stats.hits wherever we need it\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003estats.hits is for all caches of this type (it\'s shared across searchers).  hits is local to this cache instance.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617436_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617436_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 14:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T14:35:23+0000\'\u003e28\\/Jul\\/08 14:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 28\\/Jul\\/08 14:35\\\"\u003eedited\u003c\\/span\u003e                   Your version changes what the method does in a couple of respects though. \\n  let us remove the field hits and use stats.hits wherever we need it  \\n stats.hits is for all caches of this type (it\'s shared across searchers).  hits is local to this cache instance.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617441\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617441&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617441\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617441_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617441_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 14:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T14:56:49+0000\'\u003e28\\/Jul\\/08 14:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRegarding Thread Safety:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eyes, we need synchronized get() method for LRU cache because each access \u003cem\u003ereorders\u003c\\/em\u003e LinkedHashMap.\u003c\\/li\u003e\\n\\t\u003cli\u003eabsolutely no need to synchronize get() method for FIFO!\u003c\\/li\u003e\\n\\t\u003cli\u003eprobably we need to deal with insertion, but do not synchronize it: instead, extend LinkedHashMap and make some \'removal\' synchronized...  With caches large enough to store all object we do not need it. We probably do not need to synchronize \'removal\' at all - it removes entry but does not remove\\/finalize referenced object.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eFrom JavaDoc: \\\"Note that this implementation is not synchronized. If multiple threads access a linked hash map concurrently, and at least\u003cbr\\/\u003e\\none of the threads modifies the map structurally, it must be  synchronized externally.\\\"\u003cbr\\/\u003e\\nHowever, we do not modify cache structurally during iteration loop or any other \'structure\' access (we do not use Iterator!) - so, advice from JavaDoc is not applicable.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe should synchronize only removeEntryForKey of HashMap; unfortunately we can\'t do it without rewriting HashMap. Probably we can use ConcurrentHashMap as a base class of LinkedHashMap, but I don\'t know answer yet... I am guessing that unsynchronized entry removal won\'t be significant issue in multithreaded environment.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617441_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617441_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 14:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T14:56:49+0000\'\u003e28\\/Jul\\/08 14:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Regarding Thread Safety: \\n\\n \\n\\t yes, we need synchronized get() method for LRU cache because each access  reorders  LinkedHashMap. \\n\\t absolutely no need to synchronize get() method for FIFO! \\n\\t probably we need to deal with insertion, but do not synchronize it: instead, extend LinkedHashMap and make some \'removal\' synchronized...  With caches large enough to store all object we do not need it. We probably do not need to synchronize \'removal\' at all - it removes entry but does not remove\\/finalize referenced object. \\n \\n\\n\\n From JavaDoc: \\\"Note that this implementation is not synchronized. If multiple threads access a linked hash map concurrently, and at least \\none of the threads modifies the map structurally, it must be  synchronized externally.\\\" \\nHowever, we do not modify cache structurally during iteration loop or any other \'structure\' access (we do not use Iterator!) - so, advice from JavaDoc is not applicable. \\n\\n We should synchronize only removeEntryForKey of HashMap; unfortunately we can\'t do it without rewriting HashMap. Probably we can use ConcurrentHashMap as a base class of LinkedHashMap, but I don\'t know answer yet... I am guessing that unsynchronized entry removal won\'t be significant issue in multithreaded environment.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617442\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617442&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617442\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617442_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617442_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:10:54+0000\'\u003e28\\/Jul\\/08 15:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eabsolutely no need to synchronize get() method for FIFO!\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eA cache is not a read-only object.  Gets need to be synchronized because other threads can be changing the cache.\u003cbr\\/\u003e\\nIf anyone wants to learn more about thread safety and concurrency, I\'d recommend \\\"Java concurrency in practice\\\"\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/www.javaconcurrencyinpractice.com\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.javaconcurrencyinpractice.com\\/\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617442_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617442_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:10:54+0000\'\u003e28\\/Jul\\/08 15:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     absolutely no need to synchronize get() method for FIFO!  \\n\\n A cache is not a read-only object.  Gets need to be synchronized because other threads can be changing the cache. \\nIf anyone wants to learn more about thread safety and concurrency, I\'d recommend \\\"Java concurrency in practice\\\" \\n http:\\/\\/www.javaconcurrencyinpractice.com\\/               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617443\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617443&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617443\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617443_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617443_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:13:02+0000\'\u003e28\\/Jul\\/08 15:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eClasses from java.util.concurrent.atomic designed NOT to be synchronized, per-instance stats should be replaced to AtomicLong instead of \u003ctt\u003elong\u003c\\/tt\u003e:\u003cbr\\/\u003e\\n{{  private long lookups;\u003cbr\\/\u003e\\n  private long hits;\u003cbr\\/\u003e\\n  private long inserts;\u003cbr\\/\u003e\\n  private long evictions;}}\u003c\\/li\u003e\\n\\t\u003cli\u003eget() method of FIFO do not need any synchronization\u003c\\/li\u003e\\n\\t\u003cli\u003eget() method of LRU reorers LinkedHashMap, unsynchronized access may cause orphan Entry objects\u003c\\/li\u003e\\n\\t\u003cli\u003esynchronized insertion for FIFO won\'t cause performance degradation because get() is unsynchronized.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617443_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617443_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:13:02+0000\'\u003e28\\/Jul\\/08 15:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n\\t Classes from java.util.concurrent.atomic designed NOT to be synchronized, per-instance stats should be replaced to AtomicLong instead of  long : \\n{{  private long lookups; \\n  private long hits; \\n  private long inserts; \\n  private long evictions;}} \\n\\t get() method of FIFO do not need any synchronization \\n\\t get() method of LRU reorers LinkedHashMap, unsynchronized access may cause orphan Entry objects \\n\\t synchronized insertion for FIFO won\'t cause performance degradation because get() is unsynchronized. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617444\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617444&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617444\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617444_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617444_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:18:16+0000\'\u003e28\\/Jul\\/08 15:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eper-instance stats should be replaced to AtomicLong instead of long.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSince we need to synchronize anyway, it\'s more efficient to just stick things like hits++ inside the sync block instead of having a separate AtomicLong.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617444_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617444_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:18:16+0000\'\u003e28\\/Jul\\/08 15:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     per-instance stats should be replaced to AtomicLong instead of long.  \\n\\n Since we need to synchronize anyway, it\'s more efficient to just stick things like hits++ inside the sync block instead of having a separate AtomicLong.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617445\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617445&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617445\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617445_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617445_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:19:28+0000\'\u003e28\\/Jul\\/08 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ebq. absolutely no need to synchronize get() method for FIFO!\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eA cache is not a read-only object. Gets need to be synchronized because other threads can be changing the cache.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI am familiar with Doug Lea\'s findings (he wrote his book in 1996, and it became part of java.util.concurrent after 10(!!!) years). \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003echanging the cache\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhat is \'cache change\'?\u003cbr\\/\u003e\\nChanging the stored Key, changing the referenced object - never ever happens in SOLR. Removal of object - yes. More correctly: removal of key. get(MyKey) will return null OR will return MyValue, and \\\"ConcurentCacheModification\\\" will never be thrown in SOLR (we are not using Iterator!). We can insert concurrently the same (key, value) pairs - not a problem.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617445_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617445_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:19:28+0000\'\u003e28\\/Jul\\/08 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     bq. absolutely no need to synchronize get() method for FIFO!  \\n\\n  A cache is not a read-only object. Gets need to be synchronized because other threads can be changing the cache.  \\n\\n I am familiar with Doug Lea\'s findings (he wrote his book in 1996, and it became part of java.util.concurrent after 10(!!!) years).  \\n\\n  changing the cache  \\n \\n\\t what is \'cache change\'? \\nChanging the stored Key, changing the referenced object - never ever happens in SOLR. Removal of object - yes. More correctly: removal of key. get(MyKey) will return null OR will return MyValue, and \\\"ConcurentCacheModification\\\" will never be thrown in SOLR (we are not using Iterator!). We can insert concurrently the same (key, value) pairs - not a problem. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617447\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617447&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617447\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617447_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617447_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:30:04+0000\'\u003e28\\/Jul\\/08 15:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ewhat is \'cache change\'?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAdding a new key\\/value pair to the cache, or removal of a key\\/value pair from the cache.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eget(MyKey) will return null OR will return MyValue, and \\\"ConcurentCacheModification\\\" will never be thrown in SOLR\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis would only be under very specific usage patterns - everything pre-cached, and no adds or removes once the cache is \\\"LIVE\\\" (accessed by more than one thread concurrently).\u003cbr\\/\u003e\\nConcurentModification is best effort, not guaranteed.  You can still get incorrect results or other exceptions from code that isn\'t thread safe, even when a ConcurentModification isn\'t thrown.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617447_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617447_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:30:04+0000\'\u003e28\\/Jul\\/08 15:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     what is \'cache change\'?  \\n\\n Adding a new key\\/value pair to the cache, or removal of a key\\/value pair from the cache. \\n\\n  get(MyKey) will return null OR will return MyValue, and \\\"ConcurentCacheModification\\\" will never be thrown in SOLR  \\n\\n This would only be under very specific usage patterns - everything pre-cached, and no adds or removes once the cache is \\\"LIVE\\\" (accessed by more than one thread concurrently). \\nConcurentModification is best effort, not guaranteed.  You can still get incorrect results or other exceptions from code that isn\'t thread safe, even when a ConcurentModification isn\'t thrown.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617448\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617448&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617448\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"timmsc\\\" id=\\\"commentauthor_12617448_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=timmsc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"timmsc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Sean Timm\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617448_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:33:50+0000\'\u003e28\\/Jul\\/08 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFuad--\u003c\\/p\u003e\\n\\n\u003cp\u003eI agree with Yonik here.  From the HashMap Javadoc:\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIf multiple threads access this map concurrently, and at least one of the threads modifies the map structurally, it must be synchronized externally. (A structural modification is any operation that adds or deletes one or more mappings; merely changing the value associated with a key that an instance already contains is not a structural modification.)\u003c\\/p\u003e\u003c\\/blockquote\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"timmsc\\\" id=\\\"commentauthor_12617448_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=timmsc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"timmsc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Sean Timm\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617448_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T15:33:50+0000\'\u003e28\\/Jul\\/08 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fuad-- \\n\\n I agree with Yonik here.  From the HashMap Javadoc: \\n\\n  If multiple threads access this map concurrently, and at least one of the threads modifies the map structurally, it must be synchronized externally. (A structural modification is any operation that adds or deletes one or more mappings; merely changing the value associated with a key that an instance already contains is not a structural modification.)               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617454\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617454&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617454\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617454_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617454_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 16:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T16:05:27+0000\'\u003e28\\/Jul\\/08 16:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf multiple threads access this map concurrently, and at least one of the threads modifies the map structurally, it must be synchronized externally. (A structural modification is any operation that adds or deletes one or more mappings; merely changing the value associated with a key that an instance already contains is not a structural modification.)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI already commented it. Just try to avoid \'books\' and \'authors\', also try to find meaning in JavaDocs and try to browse JavaSource instead...\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003e\u003cem\u003estructural\u003c\\/em\u003e  \u003cem\u003emodification\u003c\\/em\u003e, related \u003cem\u003eConcurrentModificationException\u003c\\/em\u003e, and related \u003cem\u003eIterator\u003c\\/em\u003e: not applicable to SOLR Cache.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eWill never happen. We need to synchronize inserts because each insert may calculate size and remove \'eldest\' entry, and we need to avoid OOMs. We need to synchronize retrieves for LRU because \'Linked\' HashMap (with Access Order) will change links (will reorder Map). And we do not need to synchronize retrieves from Insertion-Ordered LinkedHashMap (FIFO). It is classic... i\'d like to research more java.util.concurrent\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617454_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617454_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 16:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T16:05:27+0000\'\u003e28\\/Jul\\/08 16:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If multiple threads access this map concurrently, and at least one of the threads modifies the map structurally, it must be synchronized externally. (A structural modification is any operation that adds or deletes one or more mappings; merely changing the value associated with a key that an instance already contains is not a structural modification.)  \\n\\n I already commented it. Just try to avoid \'books\' and \'authors\', also try to find meaning in JavaDocs and try to browse JavaSource instead... \\n\\n \\n\\t  structural    modification , related  ConcurrentModificationException , and related  Iterator : not applicable to SOLR Cache. \\n \\n\\n\\n Will never happen. We need to synchronize inserts because each insert may calculate size and remove \'eldest\' entry, and we need to avoid OOMs. We need to synchronize retrieves for LRU because \'Linked\' HashMap (with Access Order) will change links (will reorder Map). And we do not need to synchronize retrieves from Insertion-Ordered LinkedHashMap (FIFO). It is classic... i\'d like to research more java.util.concurrent              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617458\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617458&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617458\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617458_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617458_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 16:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T16:22:34+0000\'\u003e28\\/Jul\\/08 16:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eClosing, since it\'s pretty much impossible to avoid all forms of synchronization and memory barriers for get() on a shared Map object.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617458_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617458_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 16:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T16:22:34+0000\'\u003e28\\/Jul\\/08 16:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Closing, since it\'s pretty much impossible to avoid all forms of synchronization and memory barriers for get() on a shared Map object.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617466\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617466&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617466\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617466_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617466_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 16:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T16:43:32+0000\'\u003e28\\/Jul\\/08 16:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhy? We have PoC at least, and we know the bottleneck! \u003cbr\\/\u003e\\nWe need improvement: avoid \u003cem\u003esome\u003c\\/em\u003e synchronization; it is extremely easy with FIFO. We may try to improve LRU too.\u003cbr\\/\u003e\\nNot everything in JAVA is extremely good: for instance, synchronization. Even for single-threaded application, it needs additionally 600 CPU cycles (I\'ve read it somewhere for SUN Java 1.3 on Windows)\u003c\\/p\u003e\\n\\n\u003cp\u003eYonik, please allow some time to think \\/ to discuss. \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll try also to provide \'concurrent\' LRU; but this issue is FIFO related.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617466_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617466_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 16:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T16:43:32+0000\'\u003e28\\/Jul\\/08 16:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Why? We have PoC at least, and we know the bottleneck!  \\nWe need improvement: avoid  some  synchronization; it is extremely easy with FIFO. We may try to improve LRU too. \\nNot everything in JAVA is extremely good: for instance, synchronization. Even for single-threaded application, it needs additionally 600 CPU cycles (I\'ve read it somewhere for SUN Java 1.3 on Windows) \\n\\n Yonik, please allow some time to think \\/ to discuss.  \\n\\n I\'ll try also to provide \'concurrent\' LRU; but this issue is FIFO related.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617469\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617469&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617469\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617469_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617469_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 16:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T16:50:10+0000\'\u003e28\\/Jul\\/08 16:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eget() method do not need to be synchronized for FIFO cache. Unsynchronized object retrieval is not structural modification of \u003cem\u003eInsertion-Ordered\u003c\\/em\u003e LinkedHashMap. Unsynchronized cache improves performance of multithreaded applications linear to number of CPUs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617469_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617469_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 16:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T16:50:10+0000\'\u003e28\\/Jul\\/08 16:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    get() method do not need to be synchronized for FIFO cache. Unsynchronized object retrieval is not structural modification of  Insertion-Ordered  LinkedHashMap. Unsynchronized cache improves performance of multithreaded applications linear to number of CPUs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617479\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617479&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617479\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617479_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617479_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 17:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T17:25:18+0000\'\u003e28\\/Jul\\/08 17:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK.Let us try to study the failure cases .\u003cbr\\/\u003e\\n\u003cem\u003eget()\u003c\\/em\u003e does no state modification. \u003c\\/p\u003e\\n\\n\u003cp\u003eSo if the get is unsynchronized the worst case scenario is that we may get an Exception (I dunno what ConcurrentModificationException? ArrayIndexOutOfBoundsException? ). How often does it happen? What is the probability?\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat is the big deal ?(the system won\'t crash). We can catch the Exception and return null as if the entry was not found . That means that Solr may have to recompute results where it did not have to (this is a cost). \u003c\\/p\u003e\\n\\n\u003cp\u003ehere we totally eliminated the cost of synchronization (benefit). I guess if you do a cost benefit analysis this does not turn out to be as bad as it is projected to be. \u003c\\/p\u003e\\n\\n\u003cp\u003eAnd after all the user is knowingly using this fully aware of the cost. is there anything else I have not considered \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617479_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617479_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 17:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T17:25:18+0000\'\u003e28\\/Jul\\/08 17:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK.Let us try to study the failure cases . \\n get()  does no state modification.  \\n\\n So if the get is unsynchronized the worst case scenario is that we may get an Exception (I dunno what ConcurrentModificationException? ArrayIndexOutOfBoundsException? ). How often does it happen? What is the probability? \\n\\n What is the big deal ?(the system won\'t crash). We can catch the Exception and return null as if the entry was not found . That means that Solr may have to recompute results where it did not have to (this is a cost).  \\n\\n here we totally eliminated the cost of synchronization (benefit). I guess if you do a cost benefit analysis this does not turn out to be as bad as it is projected to be.  \\n\\n And after all the user is knowingly using this fully aware of the cost. is there anything else I have not considered               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617481\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617481&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617481\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617481_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617481_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 17:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T17:27:49+0000\'\u003e28\\/Jul\\/08 17:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003e...and at least one of the threads modifies the map structurally, it &lt;i&gt;must&lt;\\/i&gt; be synchronized externally.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eso that thread running on \u003cem\u003einsert\u003c\\/em\u003e must be synchronized and \u003cem\u003enot\u003c\\/em\u003e thread running on \u003cem\u003eretrieve\u003c\\/em\u003e. Again, we need synchronize \u003cem\u003einsert\u003c\\/em\u003e only to avoid memory leaks, not more. SOLR does not iterate Map.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617481_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617481_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 17:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T17:27:49+0000\'\u003e28\\/Jul\\/08 17:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     ...and at least one of the threads modifies the map structurally, it &lt;i&gt;must&lt;\\/i&gt; be synchronized externally.  \\n\\n \\n\\t so that thread running on  insert  must be synchronized and  not  thread running on  retrieve . Again, we need synchronize  insert  only to avoid memory leaks, not more. SOLR does not iterate Map. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617482\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617482&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617482\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617482_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617482_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 17:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T17:30:56+0000\'\u003e28\\/Jul\\/08 17:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eConcurrentModificationException is thrown only when we iterate Map and another thread modified structure; with LRU each get() modifies structure, with FIFO - only inserts...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617482_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617482_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 17:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T17:30:56+0000\'\u003e28\\/Jul\\/08 17:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    ConcurrentModificationException is thrown only when we iterate Map and another thread modified structure; with LRU each get() modifies structure, with FIFO - only inserts...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617490\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617490&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617490\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_12617490_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617490_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T17:42:48+0000\'\u003e28\\/Jul\\/08 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think Fuad has a point. In an Insertion ordered LinkedHashMap, get makes no structural modification and if we synchronize put\\/remove, we should be fine. The cache warming is already thread-safe and we don\'t have iterators anywhere. Am I missing something here?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_12617490_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617490_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T17:42:48+0000\'\u003e28\\/Jul\\/08 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think Fuad has a point. In an Insertion ordered LinkedHashMap, get makes no structural modification and if we synchronize put\\/remove, we should be fine. The cache warming is already thread-safe and we don\'t have iterators anywhere. Am I missing something here?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617509\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617509&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617509\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12617509_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617509_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 18:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T18:41:45+0000\'\u003e28\\/Jul\\/08 18:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSent to the mailing List:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt;Depends on if you want to go by the javadoc or not - it says that if \u003cb\u003eany\u003c\\/b\u003e of the threads accessing the map concurrently make a structural change, the map must be synchronized.  It\'s clear that get does not &gt;&gt;make a structural change when using  insertion order,  but can  any other threads possibly make a mapping change while calling get? Sounds like yes, and so the contract would seem to indicate you &gt;&gt;synchronize...\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt;Put can modify shared variables that get accesses - sounds like dangerous ground to me. If it works, its got to be sneaky enough to warrant code smell...\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt;- Mark\u003c\\/p\u003e\\n\\n\u003cp\u003eFurther:\u003c\\/p\u003e\\n\\n\u003cp\u003eHere is just one of possibly many problems - a put call can resize and make an entirely new table array. A get call can do something like the following with the table array:\u003c\\/p\u003e\\n\\n\u003cp\u003etable[indexFor(hash, table.length)\u003c\\/p\u003e\\n\\n\u003cp\u003eDo to execution reordering \\/ memory barriers, would seem to me that the table being indexed into and the table.length may not be the values you were hoping for...\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12617509_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617509_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 18:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T18:41:45+0000\'\u003e28\\/Jul\\/08 18:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Sent to the mailing List: \\n\\n &gt;&gt;Depends on if you want to go by the javadoc or not - it says that if  any  of the threads accessing the map concurrently make a structural change, the map must be synchronized.  It\'s clear that get does not &gt;&gt;make a structural change when using  insertion order,  but can  any other threads possibly make a mapping change while calling get? Sounds like yes, and so the contract would seem to indicate you &gt;&gt;synchronize... \\n\\n &gt;&gt;Put can modify shared variables that get accesses - sounds like dangerous ground to me. If it works, its got to be sneaky enough to warrant code smell... \\n\\n &gt;&gt;- Mark \\n\\n Further: \\n\\n Here is just one of possibly many problems - a put call can resize and make an entirely new table array. A get call can do something like the following with the table array: \\n\\n table[indexFor(hash, table.length) \\n\\n Do to execution reordering \\/ memory barriers, would seem to me that the table being indexed into and the table.length may not be the values you were hoping for... \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617512\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617512&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617512\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"klaasm\\\" id=\\\"commentauthor_12617512_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=klaasm\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"klaasm\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Klaas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617512_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 18:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T18:58:32+0000\'\u003e28\\/Jul\\/08 18:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI haven\'t looked at the proposed code at all, but it \u003cem\u003eis\u003c\\/em\u003e possible to design this kind of datastructure, with much care:\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/www.ddj.com\\/hpc-high-performance-computing\\/208801974\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.ddj.com\\/hpc-high-performance-computing\\/208801974\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"klaasm\\\" id=\\\"commentauthor_12617512_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=klaasm\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"klaasm\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Klaas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617512_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 18:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T18:58:32+0000\'\u003e28\\/Jul\\/08 18:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I haven\'t looked at the proposed code at all, but it  is  possible to design this kind of datastructure, with much care: \\n\\n  http:\\/\\/www.ddj.com\\/hpc-high-performance-computing\\/208801974               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617514\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617514&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617514\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_12617514_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617514_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:00:33+0000\'\u003e28\\/Jul\\/08 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, I\'m sorry for speaking out of turn here.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_12617514_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617514_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:00:33+0000\'\u003e28\\/Jul\\/08 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, I\'m sorry for speaking out of turn here.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617515\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617515&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617515\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617515_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617515_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:03:40+0000\'\u003e28\\/Jul\\/08 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK . I take my words back. LinkedHashMap is backed a by a HashMap . The table can get resized during the lifetime of a map (and hence during a get operation also). So the get() may return a wrong value (which is unacceptable) and it may never throw an Exception. \u003c\\/p\u003e\\n\\n\u003cp\u003eIf we ever want to have an LRUCache with a non -synchronized get() we must have it backed by a ConcurrentHashMap\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617515_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617515_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:03:40+0000\'\u003e28\\/Jul\\/08 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK . I take my words back. LinkedHashMap is backed a by a HashMap . The table can get resized during the lifetime of a map (and hence during a get operation also). So the get() may return a wrong value (which is unacceptable) and it may never throw an Exception.  \\n\\n If we ever want to have an LRUCache with a non -synchronized get() we must have it backed by a ConcurrentHashMap              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617516\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617516&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617516\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617516_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617516_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:05:54+0000\'\u003e28\\/Jul\\/08 19:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 28\\/Jul\\/08 19:14\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMark, thanks for going deeper. Yes, \u003cem\u003eresize\u003c\\/em\u003e may change ( Entry[ ] ) \u003cem\u003etable\u003c\\/em\u003e, \u003cem\u003ekey\u003c\\/em\u003e will disappear from \u003cem\u003ebucket\u003c\\/em\u003e and _get() returns null:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \\/**\\n     * The table, resized as necessary. Length MUST Always be a power of two.\\n     *\\/\\n    \u003cspan class=\\\"code-keyword\\\"\u003etransient\u003c\\/span\u003e Entry[] table;\\n...\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e V get(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e key) {\\n\\t\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (key == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e)\\n\\t    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e getForNullKey();\\n        \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e hash = hash(key.hashCode());\\n        \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];\\n             e != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n             e = e.next) {\\n            \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e k;\\n            \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))\\n                \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e e.value;\\n        }\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eMight get  \u003cem\u003enull\u003c\\/em\u003e instead of MyValue (during \u003cem\u003eresize\u003c\\/em\u003e by another thread); not a big deal! It is still Thread-Safe. Will add new entry (overwrite existing) in such extremely rare cases.\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eget() will \u003cem\u003enever\u003c\\/em\u003e return wrong value (Entry object is immutable in our case):\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))\\n                \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e e.value;\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617516_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617516_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:05:54+0000\'\u003e28\\/Jul\\/08 19:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 28\\/Jul\\/08 19:14\\\"\u003eedited\u003c\\/span\u003e                   Mark, thanks for going deeper. Yes,  resize  may change ( Entry[ ] )  table ,  key  will disappear from  bucket  and _get() returns null: \\n  \\n     \\/**\\n     * The table, resized as necessary. Length MUST Always be a power of two.\\n     *\\/\\n     transient  Entry[] table;\\n...\\n     public  V get( Object  key) {\\n\\t if  (key ==  null )\\n\\t     return  getForNullKey();\\n         int  hash = hash(key.hashCode());\\n         for  (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];\\n             e !=  null ;\\n             e = e.next) {\\n             Object  k;\\n             if  (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))\\n                 return  e.value;\\n        }\\n         return   null ;\\n    }\\n \\n  \\n\\n Might get   null  instead of MyValue (during  resize  by another thread); not a big deal! It is still Thread-Safe. Will add new entry (overwrite existing) in such extremely rare cases. \\n\\n \\n\\t get() will  never  return wrong value (Entry object is immutable in our case):\\n  \\n  if  (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))\\n                 return  e.value;\\n \\n   \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617517\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617517&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617517\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_12617517_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617517_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:13:59+0000\'\u003e28\\/Jul\\/08 19:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFuad, before going further on this, we must also consider users who use alternate JVM implementations. Since the contract is to synchronize, we cannot base our decision on Sun JDK\'s implementation.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_12617517_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617517_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:13:59+0000\'\u003e28\\/Jul\\/08 19:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fuad, before going further on this, we must also consider users who use alternate JVM implementations. Since the contract is to synchronize, we cannot base our decision on Sun JDK\'s implementation.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617518\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617518&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617518\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12617518_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617518_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:15:47+0000\'\u003e28\\/Jul\\/08 19:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t have time to look at this right now, but I\'ll certainly spend some time tonight Efendi.\u003c\\/p\u003e\\n\\n\u003cp\u003eA quick to my point though: I mentioned something that might be done in an implementation that could be an issue - you came back with a specific implementation that may (or may not, I don\'t have time at the moment) not work anyway. We can\'t program to an implementation though - we must program to the contract.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12617518_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617518_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:15:47+0000\'\u003e28\\/Jul\\/08 19:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t have time to look at this right now, but I\'ll certainly spend some time tonight Efendi. \\n\\n A quick to my point though: I mentioned something that might be done in an implementation that could be an issue - you came back with a specific implementation that may (or may not, I don\'t have time at the moment) not work anyway. We can\'t program to an implementation though - we must program to the contract.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617519\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617519&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617519\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617519_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617519_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:21:44+0000\'\u003e28\\/Jul\\/08 19:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eresize() is only the most obvious problem... there are \u003cb\u003etons\u003c\\/b\u003e of ways this can fail, even if you get around the resize (and your \\\"null\\\" fix for resize() won\'t work).  Some of the failures can be in the form of incorrect results rather than null pointers or exceptions (so you can\'t just retry).\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll reiterate:\u003c\\/p\u003e\\n\u003cblockquote\u003e\u003cp\u003eit\'s pretty much impossible to avoid all forms of synchronization and memory barriers for get() on a shared Map object.\u003c\\/p\u003e\u003c\\/blockquote\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617519_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617519_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:21:44+0000\'\u003e28\\/Jul\\/08 19:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    resize() is only the most obvious problem... there are  tons  of ways this can fail, even if you get around the resize (and your \\\"null\\\" fix for resize() won\'t work).  Some of the failures can be in the form of incorrect results rather than null pointers or exceptions (so you can\'t just retry). \\n\\n I\'ll reiterate: \\n  it\'s pretty much impossible to avoid all forms of synchronization and memory barriers for get() on a shared Map object.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617520\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617520&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617520\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617520_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617520_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:21:50+0000\'\u003e28\\/Jul\\/08 19:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eShalin, we are already using \u003cem\u003eAtomicLong of Java 5\u003c\\/em\u003e; JVM is defferent story... JRockit R27 is JVM from BEA-Oracle, and its JDK 6 powered (rt.jar comes from SUN).\u003cbr\\/\u003e\\nI just tried to compare synchronized with unsynchronized and found it \u003cem\u003eis\u003c\\/em\u003e the main problem for faceting...\u003cbr\\/\u003e\\nAnother problem: somehow faceting recalculates each time (using filterCache during repeated \u003cem\u003erecalculations\u003c\\/em\u003e), queryCache is not enough...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617520_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617520_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:21:50+0000\'\u003e28\\/Jul\\/08 19:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Shalin, we are already using  AtomicLong of Java 5 ; JVM is defferent story... JRockit R27 is JVM from BEA-Oracle, and its JDK 6 powered (rt.jar comes from SUN). \\nI just tried to compare synchronized with unsynchronized and found it  is  the main problem for faceting... \\nAnother problem: somehow faceting recalculates each time (using filterCache during repeated  recalculations ), queryCache is not enough...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617523\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617523&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617523\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617523_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617523_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:31:51+0000\'\u003e28\\/Jul\\/08 19:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe need to invite Doug Lea to this discussion...\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/en.wikipedia.org\\/wiki\\/Doug_Lea\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/en.wikipedia.org\\/wiki\\/Doug_Lea\u003c\\/a\u003e\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/gee.cs.oswego.edu\\/dl\\/index.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/gee.cs.oswego.edu\\/dl\\/index.html\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eWe may simply use java.util.concurrent.locks instead of heavy synchronized... we may also use Executor framework instead of single-thread faceting... We may even base SOLR on Apache MINA project.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617523_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617523_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:31:51+0000\'\u003e28\\/Jul\\/08 19:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We need to invite Doug Lea to this discussion... \\n http:\\/\\/en.wikipedia.org\\/wiki\\/Doug_Lea  \\n http:\\/\\/gee.cs.oswego.edu\\/dl\\/index.html  \\n\\n We may simply use java.util.concurrent.locks instead of heavy synchronized... we may also use Executor framework instead of single-thread faceting... We may even base SOLR on Apache MINA project.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617526\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617526&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617526\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_12617526_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617526_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:37:32+0000\'\u003e28\\/Jul\\/08 19:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI just tried to compare synchronized with unsynchronized and found it is the main problem for faceting...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eFuad, I am completely with you on this. Everybody will agree that a more efficient implementation will be a very useful addition to Solr. However, Yonik\'s concerns on the current patch are valid and we cannot go ahead with the current one.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_12617526_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617526_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:37:32+0000\'\u003e28\\/Jul\\/08 19:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I just tried to compare synchronized with unsynchronized and found it is the main problem for faceting...  \\n Fuad, I am completely with you on this. Everybody will agree that a more efficient implementation will be a very useful addition to Solr. However, Yonik\'s concerns on the current patch are valid and we cannot go ahead with the current one.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617529\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617529&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617529\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617529_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617529_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:45:41+0000\'\u003e28\\/Jul\\/08 19:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 28\\/Jul\\/08 22:46\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003econcerns are probably because of misunderstanding of  some \u003cem\u003econtract\u003c\\/em\u003e... \u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \\/**\\n     * The table, resized as necessary. Length MUST Always be a power of two.\\n     *\\/\\n    \u003cspan class=\\\"code-keyword\\\"\u003etransient\u003c\\/span\u003e Entry[] table;\\n\\n    void resize(\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e newCapacity) {\\n        Entry[] oldTable = table;\\n        \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e oldCapacity = oldTable.length;\\n        \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (oldCapacity == MAXIMUM_CAPACITY) {\\n            threshold = \u003cspan class=\\\"code-object\\\"\u003eInteger\u003c\\/span\u003e.MAX_VALUE;\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e;\\n        }\\n\\n        Entry[] newTable = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Entry[newCapacity];\\n        transfer(newTable);\\n        table = newTable;\\n        threshold = (\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e)(newCapacity * loadFactor);\\n    }\\n\\n\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e V get(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e key) {\\n\\t\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (key == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e)\\n\\t    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e getForNullKey();\\n        \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e hash = hash(key.hashCode());\\n        \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];\\n             e != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n             e = e.next) {\\n            \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e k;\\n            \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))\\n                \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e e.value;\\n        }\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n    }\\n\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ein worst case we will have pointer to \u003cem\u003eold\u003c\\/em\u003e table and even with \u003cem\u003enew\u003c\\/em\u003e one of smaller size we won\'t get \u003cem\u003eany\u003c\\/em\u003e ArrayIndexOutOfBounds.\u003c\\/li\u003e\\n\\t\u003cli\u003eThere is no any \u003cem\u003econtract\u003c\\/em\u003e requiring synchronization on get() of HashMap or LinkedHashMap; it IS application specific.\u003c\\/li\u003e\\n\\t\u003cli\u003ewe will never have \u003cem\u003ewrong\u003c\\/em\u003e results because Entry is immutable\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \\/** \\n     * Transfer all entries from current table to newTable.\\n     *\\/\\n    void transfer(Entry[] newTable) {\\n        Entry[] src = table;\\n        \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e newCapacity = newTable.length;\\n        \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e j = 0; j &lt; src.length; j++) {\\n            Entry&lt;K,V&gt; e = src[j];\\n            \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (e != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n                src[j] = \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n                \u003cspan class=\\\"code-keyword\\\"\u003edo\u003c\\/span\u003e {\\n                    Entry&lt;K,V&gt; next = e.next;\\n                    \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e i = indexFor(e.hash, newCapacity);  \\n                    e.next = newTable[i];\\n                    newTable[i] = e;\\n                    e = next;\\n                } \u003cspan class=\\\"code-keyword\\\"\u003ewhile\u003c\\/span\u003e (e != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e);\\n            }\\n        }\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWe won\'t have even any NullPointerException after src\u003cspan class=\\\"error\\\"\u003e&#91;j&#93;\u003c\\/span\u003e = null.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eP.S.\u003cbr\\/\u003e\\nOf course, I agree - it is Java internals, and it is not public Map interface-\u003cem\u003econtract\u003c\\/em\u003e - should we avoid to use implementation then? I believe it is specified somewhere in JSR too...\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e * @author  Doug Lea\\n * @author  Josh Bloch\\n * @author  Arthur van Hoff\\n * @author  Neal Gafter\\n * @version 1.65, 03\\/03\\/05\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eP.P.S.\u003cbr\\/\u003e\\nDo not forget to look at the top of this discussion:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003edescription: xxx Cache(maxSize=10000000, initialSize=1000) \\nsize : 2668705\\ncumulative_inserts : 4246246\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003e\u003cem\u003ecumulative_inserts\u003c\\/em\u003e is almost double of \u003cem\u003esize\u003c\\/em\u003e which shows that double-inserts are real\u003c\\/li\u003e\\n\\t\u003cli\u003eI checked catalina_out: no any NullPointerException, ArrayIndexOutOfBoundsException, and etc.\u003c\\/li\u003e\\n\\t\u003cli\u003eI don\'t think we should be worried \u003cem\u003etoo much\u003c\\/em\u003e about possible change of Map implementation by SUN \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/tongue.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e... in this case we should use neither java.lang.String nor java.util.Date (some are placed in wrong packages).\u003c\\/li\u003e\\n\\t\u003cli\u003eabout thread safety: some participants are wrongly guessing that making object access totally synchronized will make their code thread-safe... deadlock.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617529_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617529_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 19:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T19:45:41+0000\'\u003e28\\/Jul\\/08 19:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 28\\/Jul\\/08 22:46\\\"\u003eedited\u003c\\/span\u003e                   concerns are probably because of misunderstanding of  some  contract ...  \\n\\n  \\n     \\/**\\n     * The table, resized as necessary. Length MUST Always be a power of two.\\n     *\\/\\n     transient  Entry[] table;\\n\\n    void resize( int  newCapacity) {\\n        Entry[] oldTable = table;\\n         int  oldCapacity = oldTable.length;\\n         if  (oldCapacity == MAXIMUM_CAPACITY) {\\n            threshold =  Integer .MAX_VALUE;\\n             return ;\\n        }\\n\\n        Entry[] newTable =  new  Entry[newCapacity];\\n        transfer(newTable);\\n        table = newTable;\\n        threshold = ( int )(newCapacity * loadFactor);\\n    }\\n\\n\\n     public  V get( Object  key) {\\n\\t if  (key ==  null )\\n\\t     return  getForNullKey();\\n         int  hash = hash(key.hashCode());\\n         for  (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];\\n             e !=  null ;\\n             e = e.next) {\\n             Object  k;\\n             if  (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))\\n                 return  e.value;\\n        }\\n         return   null ;\\n    }\\n\\n \\n  \\n\\n\\n \\n\\t in worst case we will have pointer to  old  table and even with  new  one of smaller size we won\'t get  any  ArrayIndexOutOfBounds. \\n\\t There is no any  contract  requiring synchronization on get() of HashMap or LinkedHashMap; it IS application specific. \\n\\t we will never have  wrong  results because Entry is immutable \\n \\n\\n\\n  \\n     \\/** \\n     * Transfer all entries from current table to newTable.\\n     *\\/\\n    void transfer(Entry[] newTable) {\\n        Entry[] src = table;\\n         int  newCapacity = newTable.length;\\n         for  ( int  j = 0; j &lt; src.length; j++) {\\n            Entry&lt;K,V&gt; e = src[j];\\n             if  (e !=  null ) {\\n                src[j] =  null ;\\n                 do  {\\n                    Entry&lt;K,V&gt; next = e.next;\\n                     int  i = indexFor(e.hash, newCapacity);  \\n                    e.next = newTable[i];\\n                    newTable[i] = e;\\n                    e = next;\\n                }  while  (e !=  null );\\n            }\\n        }\\n    }\\n \\n  \\n\\n \\n\\t We won\'t have even any NullPointerException after src &#91;j&#93;  = null. \\n \\n\\n\\n P.S. \\nOf course, I agree - it is Java internals, and it is not public Map interface- contract  - should we avoid to use implementation then? I believe it is specified somewhere in JSR too... \\n  \\n  * @author  Doug Lea\\n * @author  Josh Bloch\\n * @author  Arthur van Hoff\\n * @author  Neal Gafter\\n * @version 1.65, 03\\/03\\/05\\n \\n  \\n\\n P.P.S. \\nDo not forget to look at the top of this discussion: \\n  \\n description: xxx Cache(maxSize=10000000, initialSize=1000) \\nsize : 2668705\\ncumulative_inserts : 4246246\\n \\n  \\n\\n \\n\\t  cumulative_inserts  is almost double of  size  which shows that double-inserts are real \\n\\t I checked catalina_out: no any NullPointerException, ArrayIndexOutOfBoundsException, and etc. \\n\\t I don\'t think we should be worried  too much  about possible change of Map implementation by SUN  ... in this case we should use neither java.lang.String nor java.util.Date (some are placed in wrong packages). \\n\\t about thread safety: some participants are wrongly guessing that making object access totally synchronized will make their code thread-safe... deadlock. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617549\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617549&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617549\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"klaasm\\\" id=\\\"commentauthor_12617549_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=klaasm\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"klaasm\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Klaas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617549_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 21:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T21:16:57+0000\'\u003e28\\/Jul\\/08 21:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;quote&#93;\u003c\\/span\u003eWe may simply use java.util.concurrent.locks instead of heavy synchronized... we may also use Executor framework instead of single-thread faceting... We may even base SOLR on Apache MINA project.\u003cspan class=\\\"error\\\"\u003e&#91;\\/quote&#93;\u003c\\/span\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eSimply replacing synchronized with java.util.concurrent.locks doesn\'t increase performance.  There needs to be a specific strategy for employing these locks in a way that makes sense.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor instance, one idea would be to create a read\\/write lock with the put()\'s covered by write and get()\'s covered by read.  This would allow multiple parallel reads and will be thread-safe.  Another is to create something like ConcurrentLinkedHashMap.\u003c\\/p\u003e\\n\\n\u003cp\u003eThese strategies should be tested before trying to create a lock-free get() version, which if even possible, would rely deeply on the implementation (such a structure would have to be created from scratch, I believe).  I\'d expect anyone that is able to create such a thing be familiar enough wiht memory barriers and such issues to be able to deeply explain the problems with double-checked locking off the top of their head (and immediately see such problems in other code)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"klaasm\\\" id=\\\"commentauthor_12617549_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=klaasm\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"klaasm\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Klaas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617549_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 21:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T21:16:57+0000\'\u003e28\\/Jul\\/08 21:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;quote&#93; We may simply use java.util.concurrent.locks instead of heavy synchronized... we may also use Executor framework instead of single-thread faceting... We may even base SOLR on Apache MINA project. &#91;\\/quote&#93;  \\n\\n Simply replacing synchronized with java.util.concurrent.locks doesn\'t increase performance.  There needs to be a specific strategy for employing these locks in a way that makes sense. \\n\\n For instance, one idea would be to create a read\\/write lock with the put()\'s covered by write and get()\'s covered by read.  This would allow multiple parallel reads and will be thread-safe.  Another is to create something like ConcurrentLinkedHashMap. \\n\\n These strategies should be tested before trying to create a lock-free get() version, which if even possible, would rely deeply on the implementation (such a structure would have to be created from scratch, I believe).  I\'d expect anyone that is able to create such a thing be familiar enough wiht memory barriers and such issues to be able to deeply explain the problems with double-checked locking off the top of their head (and immediately see such problems in other code)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617562\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617562&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617562\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617562_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617562_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 21:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T21:34:46+0000\'\u003e28\\/Jul\\/08 21:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eSimply replacing synchronized with java.util.concurrent.locks doesn\'t increase performance. There needs to be a specific strategy for employing these locks in a way that makes sense.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI absolutely agree... \u003c\\/p\u003e\\n\\n\u003cp\u003eConcurrentHashMap is based on some level of acceptable safety, for specific tasks only\u003c\\/p\u003e\\n\u003cblockquote\u003e\u003cp\u003eThey do not throw ConcurrentModificationException. However, iterators are designed to be used by only one thread at a time. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe can try to design specific caches directly implementing Map or ConcurrentMap interfaces. We should define \'safety\' levels (for instance, \u003cem\u003enull\u003c\\/em\u003e is not a problem if cache already contains this object added by another thread concurrently; cache elements are explicitly immutable objects; and etc.) \u003cbr\\/\u003e\\nFIFO looks simplest and it \u003cem\u003edoes\u003c\\/em\u003e work indeed; for LRU we need reordering for each get(), \u003cem\u003eOR\u003c\\/em\u003e we can make it weaker using weak (approximate) reordering somehow...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617562_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617562_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/08 21:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-28T21:34:46+0000\'\u003e28\\/Jul\\/08 21:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Simply replacing synchronized with java.util.concurrent.locks doesn\'t increase performance. There needs to be a specific strategy for employing these locks in a way that makes sense.  \\n\\n I absolutely agree...  \\n\\n ConcurrentHashMap is based on some level of acceptable safety, for specific tasks only \\n  They do not throw ConcurrentModificationException. However, iterators are designed to be used by only one thread at a time.   \\n\\n We can try to design specific caches directly implementing Map or ConcurrentMap interfaces. We should define \'safety\' levels (for instance,  null  is not a problem if cache already contains this object added by another thread concurrently; cache elements are explicitly immutable objects; and etc.)  \\nFIFO looks simplest and it  does  work indeed; for LRU we need reordering for each get(),  OR  we can make it weaker using weak (approximate) reordering somehow...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617639\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617639&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617639\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617639_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617639_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 01:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T01:19:41+0000\'\u003e29\\/Jul\\/08 01:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 29\\/Jul\\/08 01:28\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is extremely simple Concurrent LRU, I spent an hour to create it; it is based on ConcurrentHashMap. I don\'t use java.util.concurrent.locks, and I am trying to focus on \u003cem\u003erequirements only\u003c\\/em\u003e avoiding implementing unnecessary methods of Map interface (so that I am not following \u003cem\u003econtract\u003c\\/em\u003e \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e very sorry!)\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eimport\u003c\\/span\u003e java.util.Map;\\n\u003cspan class=\\\"code-keyword\\\"\u003eimport\u003c\\/span\u003e java.util.concurrent.ConcurrentHashMap;\\n\\n\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eConcurrentLRU&lt;K, V&gt; {\\n\\n\\t\u003cspan class=\\\"code-keyword\\\"\u003eprotected\u003c\\/span\u003e ConcurrentHashMap&lt;K, ValueWrapper&lt;V&gt;&gt; map;\\n\\t\u003cspan class=\\\"code-keyword\\\"\u003eprotected\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e maxEntries;\\n\\n\\t\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e ConcurrentLRU(\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e maxEntries) {\\n\\t\\tmap = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e ConcurrentHashMap&lt;K, ValueWrapper&lt;V&gt;&gt;();\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.maxEntries = maxEntries;\\n\\t}\\n\\n\\t\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e V put(K key, V value) {\\n\\t\\tValueWrapper&lt;V&gt; wrapper = map.put(key, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e ValueWrapper&lt;V&gt;(value));\\n\\t\\tcheckRemove();\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e value;\\n\\t}\\n\\n\\tvoid checkRemove() {\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (map.size() &lt;= maxEntries)\\n\\t\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e;\\n\\t\\tMap.Entry&lt;K, ValueWrapper&lt;V&gt;&gt; eldestEntry = \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (Map.Entry&lt;K, ValueWrapper&lt;V&gt;&gt; entry : map.entrySet()) {\\n\\t\\t\\t\u003cspan class=\\\"code-object\\\"\u003elong\u003c\\/span\u003e popularity = entry.getValue().popularity;\\n\\t\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (eldestEntry == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e || eldestEntry.getValue().popularity &gt; popularity) {\\n\\t\\t\\t\\teldestEntry = entry;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tmap.remove(eldestEntry.getKey(), eldestEntry.getValue());\\n\\t}\\n\\n\\t\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e V get(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e key) {\\n\\t\\tValueWrapper&lt;V&gt; wrapper = map.get(key);\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e wrapper == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ? \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e : wrapper.getValue();\\n\\t}\\n\\n\\t\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eValueWrapper&lt;V&gt; {\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003evolatile\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003elong\u003c\\/span\u003e popularityCounter;\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003evolatile\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003elong\u003c\\/span\u003e popularity;\\n\\t\\tV value;\\n\\n\\t\\tValueWrapper(V value) {\\n\\t\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.value = value;\\n\\t\\t\\tpopularity = popularityCounter++;\\n\\t\\t}\\n\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e equals(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e o) {\\n\\t\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (!(o \u003cspan class=\\\"code-keyword\\\"\u003einstanceof\u003c\\/span\u003e ValueWrapper)) {\\n\\t\\t\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e;\\n\\t\\t\\t}\\n\\t\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e (value == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ? ((ValueWrapper) o).value == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e : value.equals(((ValueWrapper) o).value));\\n\\t\\t}\\n\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e hashCode() {\\n\\t\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e value.hashCode();\\n\\t\\t}\\n\\n\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e V getValue() {\\n\\t\\t\\tpopularity = popularityCounter++;\\n\\t\\t\\t\u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e value;\\n\\t\\t}\\n\\n\\t}\\n\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eP.S.\u003cbr\\/\u003e\\nDo we need to synchronize put() or checkRemove()? The only hypothetical problem is OutOfMemoryException. But it is just first draft, very simplified... we do not need to sort array.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617639_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617639_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 01:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T01:19:41+0000\'\u003e29\\/Jul\\/08 01:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 29\\/Jul\\/08 01:28\\\"\u003eedited\u003c\\/span\u003e                   This is extremely simple Concurrent LRU, I spent an hour to create it; it is based on ConcurrentHashMap. I don\'t use java.util.concurrent.locks, and I am trying to focus on  requirements only  avoiding implementing unnecessary methods of Map interface (so that I am not following  contract    very sorry!) \\n\\n  \\n  import  java.util.Map;\\n import  java.util.concurrent.ConcurrentHashMap;\\n\\n public   class  ConcurrentLRU&lt;K, V&gt; {\\n\\n\\t protected  ConcurrentHashMap&lt;K, ValueWrapper&lt;V&gt;&gt; map;\\n\\t protected   int  maxEntries;\\n\\n\\t public  ConcurrentLRU( int  maxEntries) {\\n\\t\\tmap =  new  ConcurrentHashMap&lt;K, ValueWrapper&lt;V&gt;&gt;();\\n\\t\\t this .maxEntries = maxEntries;\\n\\t}\\n\\n\\t public  V put(K key, V value) {\\n\\t\\tValueWrapper&lt;V&gt; wrapper = map.put(key,  new  ValueWrapper&lt;V&gt;(value));\\n\\t\\tcheckRemove();\\n\\t\\t return  value;\\n\\t}\\n\\n\\tvoid checkRemove() {\\n\\t\\t if  (map.size() &lt;= maxEntries)\\n\\t\\t\\t return ;\\n\\t\\tMap.Entry&lt;K, ValueWrapper&lt;V&gt;&gt; eldestEntry =  null ;\\n\\t\\t for  (Map.Entry&lt;K, ValueWrapper&lt;V&gt;&gt; entry : map.entrySet()) {\\n\\t\\t\\t long  popularity = entry.getValue().popularity;\\n\\t\\t\\t if  (eldestEntry ==  null  || eldestEntry.getValue().popularity &gt; popularity) {\\n\\t\\t\\t\\teldestEntry = entry;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tmap.remove(eldestEntry.getKey(), eldestEntry.getValue());\\n\\t}\\n\\n\\t public  V get( Object  key) {\\n\\t\\tValueWrapper&lt;V&gt; wrapper = map.get(key);\\n\\t\\t return  wrapper ==  null  ?  null  : wrapper.getValue();\\n\\t}\\n\\n\\t public   final   static   class  ValueWrapper&lt;V&gt; {\\n\\t\\t static   volatile   long  popularityCounter;\\n\\t\\t volatile   long  popularity;\\n\\t\\tV value;\\n\\n\\t\\tValueWrapper(V value) {\\n\\t\\t\\t this .value = value;\\n\\t\\t\\tpopularity = popularityCounter++;\\n\\t\\t}\\n\\n\\t\\t public   boolean  equals( Object  o) {\\n\\t\\t\\t if  (!(o  instanceof  ValueWrapper)) {\\n\\t\\t\\t\\t return   false ;\\n\\t\\t\\t}\\n\\t\\t\\t return  (value ==  null  ? ((ValueWrapper) o).value ==  null  : value.equals(((ValueWrapper) o).value));\\n\\t\\t}\\n\\n\\t\\t public   int  hashCode() {\\n\\t\\t\\t return  value.hashCode();\\n\\t\\t}\\n\\n\\t\\t public  V getValue() {\\n\\t\\t\\tpopularity = popularityCounter++;\\n\\t\\t\\t return  value;\\n\\t\\t}\\n\\n\\t}\\n\\n}\\n \\n  \\n\\n P.S. \\nDo we need to synchronize put() or checkRemove()? The only hypothetical problem is OutOfMemoryException. But it is just first draft, very simplified... we do not need to sort array.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617646\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617646&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617646\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617646_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617646_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 01:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T01:40:31+0000\'\u003e29\\/Jul\\/08 01:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFuad, you are on the right track now by using something that is thread-safe (ConcurrentHashMap).  A couple of minor points:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eI don\'t see the point of the static popularityCounter... that looks like a bug.\u003c\\/li\u003e\\n\\t\u003cli\u003eincrements aren\'t atomic, but losing an increment once in a while should be fine in this scenario\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAnyway, If this works for you, use it!\u003cbr\\/\u003e\\nIt\'s likely to be \u003cb\u003every\u003c\\/b\u003e specific to your use-case though (with millions of cache entries, millions of lookups per request, and no evictions).  The eviction code looks like it would be relatively expensive.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617646_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617646_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 01:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T01:40:31+0000\'\u003e29\\/Jul\\/08 01:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fuad, you are on the right track now by using something that is thread-safe (ConcurrentHashMap).  A couple of minor points: \\n \\n\\t I don\'t see the point of the static popularityCounter... that looks like a bug. \\n\\t increments aren\'t atomic, but losing an increment once in a while should be fine in this scenario \\n \\n\\n\\n Anyway, If this works for you, use it! \\nIt\'s likely to be  very  specific to your use-case though (with millions of cache entries, millions of lookups per request, and no evictions).  The eviction code looks like it would be relatively expensive.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617648\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617648&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617648\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"larsko\\\" id=\\\"commentauthor_12617648_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=larsko\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"larsko\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lars Kotthoff\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617648_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 01:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T01:49:10+0000\'\u003e29\\/Jul\\/08 01:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eNot everything in JAVA is extremely good: for instance, synchronization. Even for single-threaded application, it needs additionally 600 CPU cycles (I\'ve read it somewhere for SUN Java 1.3 on Windows)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s probably not true for modern JVMs though &#8211; cf. \u003ca href=\\\"http:\\/\\/www.ibm.com\\/developerworks\\/library\\/j-jtp04223.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.ibm.com\\/developerworks\\/library\\/j-jtp04223.html\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e...9x times performance boost...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHow did you measure that exactly? The Solr admin pages will \u003cb\u003enot\u003c\\/b\u003e give you exact measurements. Could you describe the test setup in detail? I\'m guessing that you\'re caching the results of all queries in memory such that no disk access is necessary. Are you using highlighting or anything else that might be CPU-intensive at all? From my personal experience with Solr I wouldn\'t expect synchronization for the caches to be that big of a performance penalty. In some of my tests with a several GB index where all results where cached and highlighting was turned on I\'ve seen throughputs in excess of 400 searches per second. I think that the performance bottleneck in this case was the network interface for sending the replies.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eabsolutely no need to synchronize get() method for FIFO!\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eConsider the following case: thread A performs a synchronized put, thread B performs an unsynchronized get on the same key. B gets scheduled before A completes, the returned value will be undefined. Yes, we could do sanity checks to minimise these cases, but that would probably end up being more expensive than the synchronization.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eFrom JavaDoc: \\\"Note that this implementation is not synchronized. If multiple threads access a linked hash map concurrently, and at least\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eone of the threads modifies the map structurally, it must be synchronized externally.\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s exactly the case here &#8211; the update thread modifies the map structurally! It doesn\'t do this at all times, probably even never after the cache has been populated, but there\'s no way to \u003cb\u003eknow\u003c\\/b\u003e for sure unless you \u003cb\u003eexplicitely\u003c\\/b\u003e remove the put method.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not convinced that we should change the current implementation for the following reasons:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eConcurrency is traditionally a discipline which is very hard to get right. Furthermore the serious bugs tend to show up only when you really get race conditions and the like, i.e. when the machine is under heavy load and any disruption will hit you seriously.\u003c\\/li\u003e\\n\\t\u003cli\u003eYou\'ve already started to amend your implementation with sanity checks and the like &#8211; as I\'ve said before, this might end up being more expensive than synchronization.\u003c\\/li\u003e\\n\\t\u003cli\u003eA FIFO cache might become a bottleneck itself &#8211; if the cache is very large and the most frequently accessed item is inserted just after the cache is created, all accesses will need to traverse all the other entries before getting that item.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThat said, if you can show conclusively (e.g. with a profiler) that the synchronized access is indeed the bottleneck and incurs a heavy penalty on performance, then I\'m all for investigating this further.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"larsko\\\" id=\\\"commentauthor_12617648_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=larsko\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"larsko\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lars Kotthoff\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617648_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 01:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T01:49:10+0000\'\u003e29\\/Jul\\/08 01:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Not everything in JAVA is extremely good: for instance, synchronization. Even for single-threaded application, it needs additionally 600 CPU cycles (I\'ve read it somewhere for SUN Java 1.3 on Windows)  \\n\\n That\'s probably not true for modern JVMs though &#8211; cf.  http:\\/\\/www.ibm.com\\/developerworks\\/library\\/j-jtp04223.html . \\n\\n  ...9x times performance boost...  \\n\\n How did you measure that exactly? The Solr admin pages will  not  give you exact measurements. Could you describe the test setup in detail? I\'m guessing that you\'re caching the results of all queries in memory such that no disk access is necessary. Are you using highlighting or anything else that might be CPU-intensive at all? From my personal experience with Solr I wouldn\'t expect synchronization for the caches to be that big of a performance penalty. In some of my tests with a several GB index where all results where cached and highlighting was turned on I\'ve seen throughputs in excess of 400 searches per second. I think that the performance bottleneck in this case was the network interface for sending the replies. \\n\\n  absolutely no need to synchronize get() method for FIFO!  \\n\\n Consider the following case: thread A performs a synchronized put, thread B performs an unsynchronized get on the same key. B gets scheduled before A completes, the returned value will be undefined. Yes, we could do sanity checks to minimise these cases, but that would probably end up being more expensive than the synchronization. \\n\\n  From JavaDoc: \\\"Note that this implementation is not synchronized. If multiple threads access a linked hash map concurrently, and at least  \\n one of the threads modifies the map structurally, it must be synchronized externally.\\\" \\n\\n That\'s exactly the case here &#8211; the update thread modifies the map structurally! It doesn\'t do this at all times, probably even never after the cache has been populated, but there\'s no way to  know  for sure unless you  explicitely  remove the put method. \\n\\n I\'m not convinced that we should change the current implementation for the following reasons: \\n \\n\\t Concurrency is traditionally a discipline which is very hard to get right. Furthermore the serious bugs tend to show up only when you really get race conditions and the like, i.e. when the machine is under heavy load and any disruption will hit you seriously. \\n\\t You\'ve already started to amend your implementation with sanity checks and the like &#8211; as I\'ve said before, this might end up being more expensive than synchronization. \\n\\t A FIFO cache might become a bottleneck itself &#8211; if the cache is very large and the most frequently accessed item is inserted just after the cache is created, all accesses will need to traverse all the other entries before getting that item. \\n \\n\\n\\n That said, if you can show conclusively (e.g. with a profiler) that the synchronized access is indeed the bottleneck and incurs a heavy penalty on performance, then I\'m all for investigating this further.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617654\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617654&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617654\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617654_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617654_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:19:27+0000\'\u003e29\\/Jul\\/08 02:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 30\\/Jul\\/08 17:08\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe Solr admin pages will not give you exact measurements. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYes, and I do not need exact measurements! It gives me averageTimePerRequest which improved almost 10 times on production server. Should I right JUnit tests and execute it in a single-threaded environment? Better is to use The Grinder, but I don\'t have time and spare CPUs.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'ve seen throughputs in excess of 400 searches per second. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eBut \'searches per second\' is not the same as \'average response time\'!!!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAre you using highlighting or anything else that might be CPU-intensive at all? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYes, I am using highlighting. You can see it at \u003ca href=\\\"http:\\/\\/www.tokenizer.org\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.tokenizer.org\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'m guessing that you\'re caching the results of all queries in memory such that no disk access is necessary.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003e\u003cfont color=\\\"red\\\"\u003e But this is another bug of SOLR!!! I am using extremely large caches but SOLR still \u003cb\u003erecalculates\u003c\\/b\u003e facet intersections. \u003c\\/font\u003e - \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-669\\\" title=\\\"SOLR currently does not support caching for (Query, FacetFieldList)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-669\\\"\u003e\u003cdel\u003eSOLR-669\u003c\\/del\u003e\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eA FIFO cache might become a bottleneck itself - if the cache is very large and the most frequently accessed item is inserted just after the cache is created, all accesses will need to traverse all the other entries before getting that item.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003esorry, I didn\'t understand... yes, if cache contains 100000 entries and \'most popular item\' is removed... Why \'traverse all the other entries before getting that item\'? why 99999 items are less popular (cumulative) than single one (absolute)?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eYou probably mean \'LinkedList traversal\' but this is not the case. This is why we need to browse JavaSource... LinkedHashMap extends HashMap and there is no any \'traversal\',\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e V get(\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e key) {\\n        Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)getEntry(key);\\n        \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (e == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e)\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n        e.recordAccess(\u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e);\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e e.value;\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eConsider the following case: thread A performs a synchronized put, thread B performs an unsynchronized get on the same key. B gets scheduled before A completes, the returned value will be undefined.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ethe returned value is well defined: it is either null or correct value.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThat\'s exactly the case here - the update thread modifies the map structurally! \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWho cares? We are not iterating the map!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThat said, if you can show conclusively (e.g. with a profiler) that the synchronized access is indeed the bottleneck and incurs a heavy penalty on performance, then I\'m all for investigating this further.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e\u003cb\u003eWhat?!!\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eAnyway, I believe simplified ConcurrentLRU backed by ConcurrentHashMap is easier to understand and troubleshoot...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI don\'t see the point of the static popularityCounter... that looks like a bug.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eNo, it is not a bug. it is virtually \\\"checkpoint\\\", like as a timer, one timer for all instances. We can use System.currentTimeMillis() instead, but static volatile long is faster.\u003c\\/p\u003e\\n\\n\u003cp\u003eAbout specific use case: yes... if someone has 0.5 seconds response time for faceted queries I am very happy... I had 15 seconds before going with FIFO. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617654_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617654_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:19:27+0000\'\u003e29\\/Jul\\/08 02:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 30\\/Jul\\/08 17:08\\\"\u003eedited\u003c\\/span\u003e                    The Solr admin pages will not give you exact measurements.   \\n Yes, and I do not need exact measurements! It gives me averageTimePerRequest which improved almost 10 times on production server. Should I right JUnit tests and execute it in a single-threaded environment? Better is to use The Grinder, but I don\'t have time and spare CPUs. \\n\\n  I\'ve seen throughputs in excess of 400 searches per second.   \\n But \'searches per second\' is not the same as \'average response time\'!!! \\n\\n  Are you using highlighting or anything else that might be CPU-intensive at all?   \\n Yes, I am using highlighting. You can see it at  http:\\/\\/www.tokenizer.org  \\n\\n\\n  I\'m guessing that you\'re caching the results of all queries in memory such that no disk access is necessary.  \\n   But this is another bug of SOLR!!! I am using extremely large caches but SOLR still  recalculates  facet intersections.   -   SOLR-669   \\n\\n  A FIFO cache might become a bottleneck itself - if the cache is very large and the most frequently accessed item is inserted just after the cache is created, all accesses will need to traverse all the other entries before getting that item.  \\n\\n \\n\\t sorry, I didn\'t understand... yes, if cache contains 100000 entries and \'most popular item\' is removed... Why \'traverse all the other entries before getting that item\'? why 99999 items are less popular (cumulative) than single one (absolute)? \\n \\n\\n\\n You probably mean \'LinkedList traversal\' but this is not the case. This is why we need to browse JavaSource... LinkedHashMap extends HashMap and there is no any \'traversal\', \\n  \\n      public  V get( Object  key) {\\n        Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)getEntry(key);\\n         if  (e ==  null )\\n             return   null ;\\n        e.recordAccess( this );\\n         return  e.value;\\n    }\\n \\n  \\n\\n\\n  Consider the following case: thread A performs a synchronized put, thread B performs an unsynchronized get on the same key. B gets scheduled before A completes, the returned value will be undefined.  \\n the returned value is well defined: it is either null or correct value. \\n\\n  That\'s exactly the case here - the update thread modifies the map structurally!   \\n Who cares? We are not iterating the map! \\n\\n  That said, if you can show conclusively (e.g. with a profiler) that the synchronized access is indeed the bottleneck and incurs a heavy penalty on performance, then I\'m all for investigating this further.  \\n\\n  What?!!  \\n\\n\\n Anyway, I believe simplified ConcurrentLRU backed by ConcurrentHashMap is easier to understand and troubleshoot... \\n\\n  I don\'t see the point of the static popularityCounter... that looks like a bug.  \\n No, it is not a bug. it is virtually \\\"checkpoint\\\", like as a timer, one timer for all instances. We can use System.currentTimeMillis() instead, but static volatile long is faster. \\n\\n About specific use case: yes... if someone has 0.5 seconds response time for faceted queries I am very happy... I had 15 seconds before going with FIFO.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617655\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617655&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617655\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617655_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617655_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:25:57+0000\'\u003e29\\/Jul\\/08 02:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe eviction code looks like it would be relatively expensive\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ebut get() method of LinkedHashMap reorders whole map!!! (Of course, CPU load is evenly distributed between several get() so that we can\'t see it) Other implementations even use Arrays.sort() or something similar. I don\'t see easier solution than that... probably some random-access policy with predictable range of \\\"popularity\\\", we can evict anything \'old\' and not necessarily \'eldest\'...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617655_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617655_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:25:57+0000\'\u003e29\\/Jul\\/08 02:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The eviction code looks like it would be relatively expensive  \\n\\n but get() method of LinkedHashMap reorders whole map!!! (Of course, CPU load is evenly distributed between several get() so that we can\'t see it) Other implementations even use Arrays.sort() or something similar. I don\'t see easier solution than that... probably some random-access policy with predictable range of \\\"popularity\\\", we can evict anything \'old\' and not necessarily \'eldest\'...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617656\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617656&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617656\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617656_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617656_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:31:51+0000\'\u003e29\\/Jul\\/08 02:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ebut get() method of LinkedHashMap reorders whole map!!! \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNo it doesn\'t... think linked-list.  It moves a single item, which is pretty fast.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617656_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617656_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:31:51+0000\'\u003e29\\/Jul\\/08 02:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     but get() method of LinkedHashMap reorders whole map!!!   \\n\\n No it doesn\'t... think linked-list.  It moves a single item, which is pretty fast.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617657\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617657&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617657\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617657_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617657_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:31:53+0000\'\u003e29\\/Jul\\/08 02:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 29\\/Jul\\/08 02:36\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLars, I used FIFO because it is extremely simple to get unsynchronized \u003cem\u003eget()\u003c\\/em\u003e:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003emap = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e LinkedHashMap(initialSize, 0.75f, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e)  - LRU Cache\\n(and we need \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e get())\\nmap = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e LinkedHashMap(initialSize, 0.75f, \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e) - FIFO\\n(and we \u003cspan class=\\\"code-keyword\\\"\u003edo\u003c\\/span\u003e not need \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e get()) \\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eYonik, I\'ll try to improve ConcurrentLRU and to share findings... of course FIFO is not what we need.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eNo it doesn\'t... think linked-list. It moves a single item, which is pretty fast.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eyes, so I wrote \'evenly distributed between several get() so we can\'t see it\' - it keeps List ordered and we can\'t unsynchronize it with all subsequences!!!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617657_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617657_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:31:53+0000\'\u003e29\\/Jul\\/08 02:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 29\\/Jul\\/08 02:36\\\"\u003eedited\u003c\\/span\u003e                   Lars, I used FIFO because it is extremely simple to get unsynchronized  get() : \\n  \\n map =  new  LinkedHashMap(initialSize, 0.75f,  true )  - LRU Cache\\n(and we need  synchronized  get())\\nmap =  new  LinkedHashMap(initialSize, 0.75f,  false ) - FIFO\\n(and we  do  not need  synchronized  get()) \\n \\n  \\n\\n Yonik, I\'ll try to improve ConcurrentLRU and to share findings... of course FIFO is not what we need. \\n\\n  No it doesn\'t... think linked-list. It moves a single item, which is pretty fast.  \\n yes, so I wrote \'evenly distributed between several get() so we can\'t see it\' - it keeps List ordered and we can\'t unsynchronize it with all subsequences!!!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617658\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617658&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617658\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"larsko\\\" id=\\\"commentauthor_12617658_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=larsko\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"larsko\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lars Kotthoff\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617658_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:31:59+0000\'\u003e29\\/Jul\\/08 02:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ethe returned value is well defined: it is either null or correct value.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt is if nothing is modifying the map during the get. If something is modifying the map you don\'t know how the implementation handles the insert of a new value. It might copy the object, and you\'d end up with half an object or even an invalid memory location. That\'s why the javadoc says that you \u003cb\u003emust\u003c\\/b\u003e synchronize accesses if \u003cb\u003eanything\u003c\\/b\u003e modifies the map &#8211; this is not limited to iterators.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"larsko\\\" id=\\\"commentauthor_12617658_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=larsko\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"larsko\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lars Kotthoff\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617658_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:31:59+0000\'\u003e29\\/Jul\\/08 02:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     the returned value is well defined: it is either null or correct value.  \\n\\n It is if nothing is modifying the map during the get. If something is modifying the map you don\'t know how the implementation handles the insert of a new value. It might copy the object, and you\'d end up with half an object or even an invalid memory location. That\'s why the javadoc says that you  must  synchronize accesses if  anything  modifies the map &#8211; this is not limited to iterators.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617662\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617662&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617662\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617662_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617662_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:43:50+0000\'\u003e29\\/Jul\\/08 02:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ethe returned value is well defined: it is either null or correct value.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNo, it is not!  Your analysis seems to ignore the java memory model (partially constructed objects and all that).  I don\'t know how many different ways to say it.... please do yourself a favor and read up on the java memory model (and the book I previously referenced is great for this).  This is hard stuff (at the lowest levels).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617662_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617662_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:43:50+0000\'\u003e29\\/Jul\\/08 02:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     the returned value is well defined: it is either null or correct value.  \\n\\n No, it is not!  Your analysis seems to ignore the java memory model (partially constructed objects and all that).  I don\'t know how many different ways to say it.... please do yourself a favor and read up on the java memory model (and the book I previously referenced is great for this).  This is hard stuff (at the lowest levels).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617664\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617664&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617664\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617664_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617664_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:45:30+0000\'\u003e29\\/Jul\\/08 02:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIt is if nothing is modifying the map during the get. If something is modifying the map you don\'t know how the implementation handles the insert of a new value. It might copy the object, and you\'d end up with half an object or even an invalid memory location. That\'s why the javadoc says that you must synchronize accesses if anything modifies the map - this is not limited to iterators.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eJavaDoc does not say that. Instead, it says (I am repeating):\u003c\\/p\u003e\\n\u003cblockquote\u003e\u003cp\u003e..and at least one of the threads modifies the map structurally, it must be synchronized externally. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eonly thread doing  structural modification must be synchronized. In case of LinkedHashMap, for instance, we need to synchronize inserts in order to avoid Entry instances referencing themselves (orphans).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eyou don\'t know how the implementation handles the insert of a new value\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI know exactly: SOLR does not modify \'value\' during \'insert\', Map.Entry instances are immutable in SOLR, etc. Table resize is main problem - but after analyzing source code I don\'t see any problem. Consern that \'wrong value will be returned for a key\' is not applicable. And JavaDocs does not say anything about that. Collections internally use Map.Entry in an immutable way, do not change it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617664_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617664_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:45:30+0000\'\u003e29\\/Jul\\/08 02:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     It is if nothing is modifying the map during the get. If something is modifying the map you don\'t know how the implementation handles the insert of a new value. It might copy the object, and you\'d end up with half an object or even an invalid memory location. That\'s why the javadoc says that you must synchronize accesses if anything modifies the map - this is not limited to iterators.  \\n\\n JavaDoc does not say that. Instead, it says (I am repeating): \\n  ..and at least one of the threads modifies the map structurally, it must be synchronized externally.   \\n\\n \\n\\t only thread doing  structural modification must be synchronized. In case of LinkedHashMap, for instance, we need to synchronize inserts in order to avoid Entry instances referencing themselves (orphans). \\n \\n\\n\\n\\n  you don\'t know how the implementation handles the insert of a new value  \\n\\n I know exactly: SOLR does not modify \'value\' during \'insert\', Map.Entry instances are immutable in SOLR, etc. Table resize is main problem - but after analyzing source code I don\'t see any problem. Consern that \'wrong value will be returned for a key\' is not applicable. And JavaDocs does not say anything about that. Collections internally use Map.Entry in an immutable way, do not change it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617668\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617668&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617668\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617668_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617668_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:55:27+0000\'\u003e29\\/Jul\\/08 02:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eNo, it is not! Your analysis seems to ignore the java memory model (partially constructed objects and all that). I don\'t know how many different ways to say it.... please do yourself a favor and read up on the java memory model (and the book I previously referenced is great for this). This is hard stuff (at the lowest levels).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOk. May be I can get reference to wrong object type, or even object scheduled for finalization... But we are not inserting into Map \'partially constructed objects\', isn\'t it?\u003c\\/p\u003e\\n\\n\u003cp\u003eSimplest scenario: Thread A tries to get variable (4 bytes of address in JVM) pointing to object O. Another thread B concurrently assigns \u003cem\u003enull\u003c\\/em\u003e to that variable. Isn\'t it solved at CPU level yet? Or, may be on 64bit system thread B assigns zero to first 2 bytes, and then to another 2 bytes?\u003c\\/p\u003e\\n\\n\u003cp\u003eI need to study this book... BTW, I am running JVM with \'-server\' option.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617668_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617668_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:55:27+0000\'\u003e29\\/Jul\\/08 02:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     No, it is not! Your analysis seems to ignore the java memory model (partially constructed objects and all that). I don\'t know how many different ways to say it.... please do yourself a favor and read up on the java memory model (and the book I previously referenced is great for this). This is hard stuff (at the lowest levels).  \\n\\n Ok. May be I can get reference to wrong object type, or even object scheduled for finalization... But we are not inserting into Map \'partially constructed objects\', isn\'t it? \\n\\n Simplest scenario: Thread A tries to get variable (4 bytes of address in JVM) pointing to object O. Another thread B concurrently assigns  null  to that variable. Isn\'t it solved at CPU level yet? Or, may be on 64bit system thread B assigns zero to first 2 bytes, and then to another 2 bytes? \\n\\n I need to study this book... BTW, I am running JVM with \'-server\' option.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617669\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617669&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617669\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"larsko\\\" id=\\\"commentauthor_12617669_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=larsko\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"larsko\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lars Kotthoff\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617669_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:56:42+0000\'\u003e29\\/Jul\\/08 02:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe way I understand the javadoc is\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e..and at least one of the threads modifies the map structurally, \u003cb\u003eit\u003c\\/b\u003e must be synchronized externally.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe \u003cb\u003eit\u003c\\/b\u003e references the map. It says explicitely that the \u003cb\u003emap\u003c\\/b\u003e must be synchronized, i.e. all operations on it. It does not say that only the thread modifying it must be synchronized. Consider the case where only one thread modifies the map. You\'re saying that in this case synchronization would not be necessary, as only modifications themselves need to be synchronized and there is only one thread doing that. The javadoc explicitely says that it is necessary.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"larsko\\\" id=\\\"commentauthor_12617669_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=larsko\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"larsko\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lars Kotthoff\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617669_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 02:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T02:56:42+0000\'\u003e29\\/Jul\\/08 02:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The way I understand the javadoc is \\n\\n  ..and at least one of the threads modifies the map structurally,  it  must be synchronized externally.  \\n\\n The  it  references the map. It says explicitely that the  map  must be synchronized, i.e. all operations on it. It does not say that only the thread modifying it must be synchronized. Consider the case where only one thread modifies the map. You\'re saying that in this case synchronization would not be necessary, as only modifications themselves need to be synchronized and there is only one thread doing that. The javadoc explicitely says that it is necessary.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617673\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617673&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617673\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617673_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617673_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 03:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T03:07:06+0000\'\u003e29\\/Jul\\/08 03:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe it references the map. It says explicitely that the map must be synchronized.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eI agree, thanks for pointing to it. Synchronize!\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eBTW, Joshua Bloch developed Arrays.sort(), and bug was found after 9 years. Nothing is perfect.\u003c\\/p\u003e\\n\\n\u003cp\u003eConcurrentLRU looks extremely simple and easy to improve. Should we check SUN\'s bug database before using ConcurrentHashMap? It has some related...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617673_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617673_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 03:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T03:07:06+0000\'\u003e29\\/Jul\\/08 03:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The it references the map. It says explicitely that the map must be synchronized.  \\n\\n \\n\\t I agree, thanks for pointing to it. Synchronize! \\n \\n\\n\\n BTW, Joshua Bloch developed Arrays.sort(), and bug was found after 9 years. Nothing is perfect. \\n\\n ConcurrentLRU looks extremely simple and easy to improve. Should we check SUN\'s bug database before using ConcurrentHashMap? It has some related...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617676\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617676&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617676\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"craigmcc\\\" id=\\\"commentauthor_12617676_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=craigmcc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"craigmcc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Craig McClanahan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617676_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 03:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T03:44:21+0000\'\u003e29\\/Jul\\/08 03:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust a quick comment from the Peanut Gallery.\u003c\\/p\u003e\\n\\n\u003cp\u003eInstead of arguing about what the semantics of what the JavaDocs for java.util.Map and friends actually say, and worrying about whether particular implementations actually follow the rules but provide reasonable performance, this seems like a good opportunity to design and build an application specific data structure that has the behavioral characteristics you want (Fuad is after fastest-possible reads, everybody is after \u003cb\u003ereasonable\u003c\\/b\u003e behavior in the face of concurrent writes).  My only recommendation in this regard would be this:  don\'t make a custom implementation say \\\"implements java.util.LinkedHashMap\\\" (again, or whatever implementation is currently in use) unless it does actually implement the documented semantics for java.util.LinkedHashMap.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s fine to have a custom FifoCacheMap (or whatever name you like) class that does not implement java.util.Map.  It\'s \u003cb\u003enot\u003c\\/b\u003e fine to say you implement an interface but then break the documented contract.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"craigmcc\\\" id=\\\"commentauthor_12617676_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=craigmcc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"craigmcc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Craig McClanahan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617676_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 03:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T03:44:21+0000\'\u003e29\\/Jul\\/08 03:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just a quick comment from the Peanut Gallery. \\n\\n Instead of arguing about what the semantics of what the JavaDocs for java.util.Map and friends actually say, and worrying about whether particular implementations actually follow the rules but provide reasonable performance, this seems like a good opportunity to design and build an application specific data structure that has the behavioral characteristics you want (Fuad is after fastest-possible reads, everybody is after  reasonable  behavior in the face of concurrent writes).  My only recommendation in this regard would be this:  don\'t make a custom implementation say \\\"implements java.util.LinkedHashMap\\\" (again, or whatever implementation is currently in use) unless it does actually implement the documented semantics for java.util.LinkedHashMap. \\n\\n It\'s fine to have a custom FifoCacheMap (or whatever name you like) class that does not implement java.util.Map.  It\'s  not  fine to say you implement an interface but then break the documented contract.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617682\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617682&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617682\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617682_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617682_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 03:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T03:58:31+0000\'\u003e29\\/Jul\\/08 03:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIt\'s fine to have a custom FifoCacheMap (or whatever name you like) class that does not implement java.util.Map.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRight.  Any solr cache must currently implement the SolrCache interface, and LinkedHashMap is simply an implementation detail of the LRUCache implementation of SolrCache (which has no relationship to the Map interface).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12617682_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617682_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 03:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T03:58:31+0000\'\u003e29\\/Jul\\/08 03:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     It\'s fine to have a custom FifoCacheMap (or whatever name you like) class that does not implement java.util.Map.  \\n\\n Right.  Any solr cache must currently implement the SolrCache interface, and LinkedHashMap is simply an implementation detail of the LRUCache implementation of SolrCache (which has no relationship to the Map interface).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617684\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617684&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617684\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617684_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617684_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 04:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T04:05:07+0000\'\u003e29\\/Jul\\/08 04:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 29\\/Jul\\/08 04:20\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eFuad is after fastest-possible reads, everybody is after reasonable behavior in the face of concurrent writes\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThanks and sorry for runtime errors;\u003c\\/p\u003e\\n\\n\u003cp\u003eFIFO looks strange at first, but... for large cache (100000 items), most popular item can be \u003cem\u003emistakenly\u003c\\/em\u003e removed... but I don\'t think there are any \'most popular facets\' etc.; it\'s evenly distributed in most cases.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother issue: SOLR always tries \u003cem\u003erecalculate\u003c\\/em\u003e \u003cem\u003efacets\u003c\\/em\u003e even with extremely large filterCache &amp; queryResultCache, even the same faceted query shows always the same long response times.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIt is if nothing is modifying the map during the get. If something is modifying the map you don\'t know how the implementation handles the insert of a new value. It might copy the object, and you\'d end up with half an object or even an invalid memory location. That\'s why the javadoc says that you must synchronize accesses if anything modifies the map - this is not limited to iterators.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree of course... However, we are not dealing with unknown implementation of java.util.Map clonig (java.lang.Cloneable) objects somehow or using some weird object introspection etc.... \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617684_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617684_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 04:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T04:05:07+0000\'\u003e29\\/Jul\\/08 04:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 29\\/Jul\\/08 04:20\\\"\u003eedited\u003c\\/span\u003e                    Fuad is after fastest-possible reads, everybody is after reasonable behavior in the face of concurrent writes  \\n\\n Thanks and sorry for runtime errors; \\n\\n FIFO looks strange at first, but... for large cache (100000 items), most popular item can be  mistakenly  removed... but I don\'t think there are any \'most popular facets\' etc.; it\'s evenly distributed in most cases. \\n\\n Another issue: SOLR always tries  recalculate   facets  even with extremely large filterCache &amp; queryResultCache, even the same faceted query shows always the same long response times. \\n\\n  It is if nothing is modifying the map during the get. If something is modifying the map you don\'t know how the implementation handles the insert of a new value. It might copy the object, and you\'d end up with half an object or even an invalid memory location. That\'s why the javadoc says that you must synchronize accesses if anything modifies the map - this is not limited to iterators.  \\n\\n I agree of course... However, we are not dealing with unknown implementation of java.util.Map clonig (java.lang.Cloneable) objects somehow or using some weird object introspection etc....               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617692\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617692&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617692\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617692_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617692_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 04:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T04:54:10+0000\'\u003e29\\/Jul\\/08 04:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBTW there is almost no any functional difference between LRU and FIFO. And there is \u003cb\u003ehuge difference\u003c\\/b\u003e between LRU (Least Recently Used) and LFU (Least Frequently Used).\u003cbr\\/\u003e\\nIt\'s easy to implement ConcurrentLFU based on provided ConcurrentLRU template; of course, following the main \u003cem\u003econtract\u003c\\/em\u003e org.apache.solr.search.SolrCache.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617692_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617692_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 04:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T04:54:10+0000\'\u003e29\\/Jul\\/08 04:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    BTW there is almost no any functional difference between LRU and FIFO. And there is  huge difference  between LRU (Least Recently Used) and LFU (Least Frequently Used). \\nIt\'s easy to implement ConcurrentLFU based on provided ConcurrentLRU template; of course, following the main  contract  org.apache.solr.search.SolrCache.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617693\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617693&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617693\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617693_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617693_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 04:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T04:59:04+0000\'\u003e29\\/Jul\\/08 04:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI Fuad. This is a worthwhile effort to undertake. Why don\'t you implement a LRUCache implementation and post it (as a java file) .  Let everyone review and see if it can be improved\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617693_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617693_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 04:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T04:59:04+0000\'\u003e29\\/Jul\\/08 04:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I Fuad. This is a worthwhile effort to undertake. Why don\'t you implement a LRUCache implementation and post it (as a java file) .  Let everyone review and see if it can be improved              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617699\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617699&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617699\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617699_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617699_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T05:08:38+0000\'\u003e29\\/Jul\\/08 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePaul, I want to do it... understand me, since February I am having constant performance problems with faceted queries (15-20 seconds response time), I ordered new server with 32 Gb &amp; 2x quad-core (8x times more power!) but it didn\'t improve performance; finally I commented sync in LRUCache and made it FIFO... I was very impatient with this post, just tried to share very real staff... \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12617699_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617699_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T05:08:38+0000\'\u003e29\\/Jul\\/08 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Paul, I want to do it... understand me, since February I am having constant performance problems with faceted queries (15-20 seconds response time), I ordered new server with 32 Gb &amp; 2x quad-core (8x times more power!) but it didn\'t improve performance; finally I commented sync in LRUCache and made it FIFO... I was very impatient with this post, just tried to share very real staff...               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617720\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617720&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617720\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617720_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617720_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 06:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T06:26:12+0000\'\u003e29\\/Jul\\/08 06:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA FIFOCache using ConcurrentHashMap.\u003cbr\\/\u003e\\nPlease give feedback\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617720_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617720_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 06:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T06:26:12+0000\'\u003e29\\/Jul\\/08 06:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A FIFOCache using ConcurrentHashMap. \\nPlease give feedback              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617753\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617753&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617753\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617753_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617753_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 09:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T09:34:51+0000\'\u003e29\\/Jul\\/08 09:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnother one this is LRU. uses ConcurrentHashMap again\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eGets are free\u003c\\/li\u003e\\n\\t\u003cli\u003ePuts are expensive (very expensive) after the high watermark . Till then it is free\u003c\\/li\u003e\\n\\t\u003cli\u003eTo lighten the load on put an extra thread is employed to do a concurrent mark and sweep\u003c\\/li\u003e\\n\\t\u003cli\u003ethere is a high-water-mark and a low-water-mark . The extra thread cleans anything if low-water-mark is crossed. Put must removes if level crosses high-water-mark\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617753_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617753_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 09:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T09:34:51+0000\'\u003e29\\/Jul\\/08 09:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Another one this is LRU. uses ConcurrentHashMap again \\n\\n \\n\\t Gets are free \\n\\t Puts are expensive (very expensive) after the high watermark . Till then it is free \\n\\t To lighten the load on put an extra thread is employed to do a concurrent mark and sweep \\n\\t there is a high-water-mark and a low-water-mark . The extra thread cleans anything if low-water-mark is crossed. Put must removes if level crosses high-water-mark \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12617801\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12617801&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12617801\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617801_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617801_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 14:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T14:42:39+0000\'\u003e29\\/Jul\\/08 14:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebug fix\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12617801_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12617801_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/08 14:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-29T14:42:39+0000\'\u003e29\\/Jul\\/08 14:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bug fix              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12618057\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12618057&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12618057\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618057_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618057_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 04:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T04:32:14+0000\'\u003e30\\/Jul\\/08 04:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Paul, I am always trying to simplify... AtomicReference is a pointer to (approximately) least recently used \'key\'...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618057_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618057_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 04:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T04:32:14+0000\'\u003e30\\/Jul\\/08 04:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Paul, I am always trying to simplify... AtomicReference is a pointer to (approximately) least recently used \'key\'...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12618060\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12618060&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12618060\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618060_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618060_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 04:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T04:40:37+0000\'\u003e30\\/Jul\\/08 04:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebug fix\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618060_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618060_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 04:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T04:40:37+0000\'\u003e30\\/Jul\\/08 04:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bug fix              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12618061\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12618061&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12618061\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618061_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618061_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 04:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T04:50:04+0000\'\u003e30\\/Jul\\/08 04:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eanother bug... and AtomicReference is generic... never used it before. Could be even \'weaker\' if we use \'hashcode\' which is long (and atomic) instead of Key which is object (and unsafe), and distribution of hashcode is ok...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618061_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618061_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 04:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T04:50:04+0000\'\u003e30\\/Jul\\/08 04:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    another bug... and AtomicReference is generic... never used it before. Could be even \'weaker\' if we use \'hashcode\' which is long (and atomic) instead of Key which is object (and unsafe), and distribution of hashcode is ok...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12618064\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12618064&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12618064\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12618064_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618064_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 05:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T05:04:07+0000\'\u003e30\\/Jul\\/08 05:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Noble Paul - 30\\/Jul\\/08 05:08\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThere are a few obvious issues w\\/ your patch.\u003cbr\\/\u003e\\nEffendi your implementation is wrong\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\t \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (wrapper.lastAccessed &lt; pointer.lastAccessed) {\\n\\t\\t\\tref.set(\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Pointer(key, wrapper.lastAccessed));\\n}\\n\\t\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003ewill always evaluate to false. And the reference will always have one value\u003cbr\\/\u003e\\nWe must be removing the entry which was accessed first (not last).. To get that you must maintian a linkedlist the way linkedhashmap maintains. No other shortcut. Keeping one reference \u003cb\u003ewill not\u003c\\/b\u003e work. \u003c\\/p\u003e\\n\\n\u003cp\u003eIn that implementation there is always a contention on the head so gets are bound to be slow. That is why i did not go that route\u003cbr\\/\u003e\\nAnd the static volatile counter is not threadsafe. \u003cbr\\/\u003e\\nstatic in general is not a good idea\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eThere is no need to use a WeakReference anywhere. This is a cache. So it \u003cb\u003emust\u003c\\/b\u003e maintain strong reference\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12618064_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618064_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 05:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T05:04:07+0000\'\u003e30\\/Jul\\/08 05:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Noble Paul - 30\\/Jul\\/08 05:08\\\"\u003eedited\u003c\\/span\u003e                   There are a few obvious issues w\\/ your patch. \\nEffendi your implementation is wrong \\n\\n  \\n \\t  if  (wrapper.lastAccessed &lt; pointer.lastAccessed) {\\n\\t\\t\\tref.set( new  Pointer(key, wrapper.lastAccessed));\\n}\\n\\t \\n  \\n will always evaluate to false. And the reference will always have one value \\nWe must be removing the entry which was accessed first (not last).. To get that you must maintian a linkedlist the way linkedhashmap maintains. No other shortcut. Keeping one reference  will not  work.  \\n\\n In that implementation there is always a contention on the head so gets are bound to be slow. That is why i did not go that route \\nAnd the static volatile counter is not threadsafe.  \\nstatic in general is not a good idea \\n\\n\\n There is no need to use a WeakReference anywhere. This is a cache. So it  must  maintain strong reference              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12618074\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12618074&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12618074\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12618074_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618074_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 06:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T06:21:58+0000\'\u003e30\\/Jul\\/08 06:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have opened \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-667\\\" title=\\\"Alternate LRUCache implementation\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-667\\\"\u003e\u003cdel\u003eSOLR-667\u003c\\/del\u003e\u003c\\/a\u003e for LRU implementations\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_12618074_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618074_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 06:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T06:21:58+0000\'\u003e30\\/Jul\\/08 06:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have opened   SOLR-667   for LRU implementations              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12618339\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12618339&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12618339\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618339_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618339_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 14:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T14:01:11+0000\'\u003e30\\/Jul\\/08 14:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 30\\/Jul\\/08 14:08\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNoble, thanks for feedback!\u003c\\/p\u003e\\n\\n\u003cp\u003eOf course my code is buggy but I only wanted \u003cem\u003eto illustrate\u003c\\/em\u003e simplest idea; I am extremely busy with other staff (Liferay) and can\'t focus on SOLR improvements... may be during weekend.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e...will always evaluate to false. And the reference will always have one value\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eyes, this is bug. There are other bugs too...\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eWe must be removing the entry which was accessed first (not last).. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI mean (and code too) the same; probably wrong wording\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAnd the static volatile counter is not threadsafe. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eDo we \u003cem\u003ereally-really\u003c\\/em\u003e need thread safety here? By using \'volatile\' I only prevent \u003cem\u003esome\u003c\\/em\u003e JVMs from trying to optimize some code (and cause problems).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThere is no need to use a WeakReference anywhere\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eAgree... \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eTo get that you must maintian a linkedlist the way linkedhashmap maintains. No other shortcut. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eMay be... but looks similar to Arrays.sort(), or TreeSet, and etc.... I am trying to avoid this. \'No other shortcut\' - may be, but I am unsure.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks!\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618339_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618339_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/08 14:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-30T14:01:11+0000\'\u003e30\\/Jul\\/08 14:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Fuad Efendi - 30\\/Jul\\/08 14:08\\\"\u003eedited\u003c\\/span\u003e                   Noble, thanks for feedback! \\n\\n Of course my code is buggy but I only wanted  to illustrate  simplest idea; I am extremely busy with other staff (Liferay) and can\'t focus on SOLR improvements... may be during weekend. \\n\\n  ...will always evaluate to false. And the reference will always have one value  \\n \\n\\t yes, this is bug. There are other bugs too... \\n \\n\\n\\n  We must be removing the entry which was accessed first (not last)..   \\n I mean (and code too) the same; probably wrong wording \\n\\n  And the static volatile counter is not threadsafe.   \\n Do we  really-really  need thread safety here? By using \'volatile\' I only prevent  some  JVMs from trying to optimize some code (and cause problems). \\n\\n  There is no need to use a WeakReference anywhere  \\n Agree...  \\n\\n  To get that you must maintian a linkedlist the way linkedhashmap maintains. No other shortcut.   \\n May be... but looks similar to Arrays.sort(), or TreeSet, and etc.... I am trying to avoid this. \'No other shortcut\' - may be, but I am unsure. \\n\\n Thanks! \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12618766\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12618766&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12618766\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618766_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618766_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Jul\\/08 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-31T17:34:42+0000\'\u003e31\\/Jul\\/08 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t think ConcurrentHashMap will improve performance, and ConcurrentMap is not what SOLR needs:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    V putIfAbsent(K key, V value);\\n    V replace(K key, V value);\\n    \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e replace(K key, V oldValue, V newValue);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThere is also some(...) overhead with \u003cem\u003eoldValue\u003c\\/em\u003e and \u003cem\u003ethe state of the hash table at some point\u003c\\/em\u003e; additional memory requirements; etc... can we design something plain-simpler being focused on SOLR specific requirements? Without all functionality of Map etc...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12618766_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12618766_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Jul\\/08 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-07-31T17:34:42+0000\'\u003e31\\/Jul\\/08 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t think ConcurrentHashMap will improve performance, and ConcurrentMap is not what SOLR needs: \\n  \\n     V putIfAbsent(K key, V value);\\n    V replace(K key, V value);\\n     boolean  replace(K key, V oldValue, V newValue);\\n \\n  \\n\\n There is also some(...) overhead with  oldValue  and  the state of the hash table at some point ; additional memory requirements; etc... can we design something plain-simpler being focused on SOLR specific requirements? Without all functionality of Map etc...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12619058\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12619058&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12619058\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12619058_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12619058_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Aug\\/08 16:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-08-01T16:12:34+0000\'\u003e01\\/Aug\\/08 16:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGuys at LingPipe (Natural Language Processing) \u003ca href=\\\"http:\\/\\/alias-i.com\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/alias-i.com\\/\u003c\\/a\u003e are using excellent Map implementations with optimistic concurrency strategy:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/alias-i.com\\/lingpipe\\/docs\\/api\\/com\\/aliasi\\/util\\/FastCache.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/alias-i.com\\/lingpipe\\/docs\\/api\\/com\\/aliasi\\/util\\/FastCache.html\u003c\\/a\u003e\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/alias-i.com\\/lingpipe\\/docs\\/api\\/com\\/aliasi\\/util\\/HardFastCache.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/alias-i.com\\/lingpipe\\/docs\\/api\\/com\\/aliasi\\/util\\/HardFastCache.html\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"funtick\\\" id=\\\"commentauthor_12619058_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=funtick\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"funtick\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fuad Efendi\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12619058_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Aug\\/08 16:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-08-01T16:12:34+0000\'\u003e01\\/Aug\\/08 16:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Guys at LingPipe (Natural Language Processing)  http:\\/\\/alias-i.com\\/  are using excellent Map implementations with optimistic concurrency strategy: \\n http:\\/\\/alias-i.com\\/lingpipe\\/docs\\/api\\/com\\/aliasi\\/util\\/FastCache.html  \\n http:\\/\\/alias-i.com\\/lingpipe\\/docs\\/api\\/com\\/aliasi\\/util\\/HardFastCache.html               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12675568\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-665?focusedCommentId=12675568&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12675568\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12675568_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12675568_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/09 15:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-02-21T15:31:33+0000\'\u003e21\\/Feb\\/09 15:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eclosing as duplicate since we have a concurrent cache impl now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12675568_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12675568_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/09 15:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-02-21T15:31:33+0000\'\u003e21\\/Feb\\/09 15:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    closing as duplicate since we have a concurrent cache impl now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310230";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310230&amp;avatarId=22151\\\" alt=\\\"Solr\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\"\u003eSolr\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516207642099"> 
    <input type="hidden" title="jira.request.server.time" value="615"> 
    <input type="hidden" title="jira.request.id" value="1007x7891407x12"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="9"> 
    <input type="hidden" title="db.reads.time.in.ms" value="65"> 
    <input type="hidden" title="db.conns.time.in.ms" value="76"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 1007x7891407x12
	          REQUEST TIMESTAMP : [17/Jan/2018:16:47:22 +0000]
	               REQUEST TIME : 0.6150
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 9

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=20, elapsedTotal=65009065, elapsedMin=521694, elapsedMax=29488345, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=24, elapsedTotal=76450878, elapsedMin=560757, elapsedMax=29528342, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>