<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|aa0561dd34dddb43ff57507a00ed95d9fad25bf5|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"3cbf48a2b93be7\"";
WRM._unparsedData["project-id"]="12310230";
WRM._unparsedData["project-key"]="\"SOLR\"";
WRM._unparsedData["project-name"]="\"Solr\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310230";
WRM._unparsedData["projectKey"]="\"SOLR\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="SOLR-4260"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[SOLR-4260] Inconsistent numDocs between leader and replica - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[SOLR-4260] Inconsistent numDocs between leader and replica - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/SOLR" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-4260">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310230" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Solr'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310230&amp;avatarId=22151"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/SOLR">Solr</a></li>
                 <li><a class="issue-link" data-issue-key="SOLR-4260" href="/jira/browse/SOLR-4260" id="key-val" rel="12626072">SOLR-4260</a></li>
                </ol>
                <h1 id="summary-val">Inconsistent numDocs between leader and replica</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-4260"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/SOLR-4260/SOLR-4260.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/SOLR-4260/SOLR-4260.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/SOLR-4260/SOLR-4260.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/SOLR-4260/SOLR-4260.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/critical.svg" title="Critical - Crashes, loss of data, severe memory leak." width="16"> Critical </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+4.6.1" title="4.6.1 Bugfix release after 4.6">4.6.1</a>, <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+6.0" title="6.0 First 6.x release, Major release after 5.5">6.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+SOLR+AND+component+%3D+SolrCloud" title="SolrCloud ">SolrCloud</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12626072-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value"> 
                    <p>5.0.0.2013.01.04.15.31.51</p> 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>After wiping all cores and reindexing some 3.3 million docs from Nutch using CloudSolrServer we see inconsistencies between the leader and replica for some shards.</p> 
                  <p>Each core hold about 3.3k documents. For some reason 5 out of 10 shards have a small deviation in then number of documents. The leader and slave deviate for roughly 10-20 documents, not more.</p> 
                  <p>Results hopping ranks in the result set for identical queries got my attention, there were small IDF differences for exactly the same record causing a record to shift positions in the result set. During those tests no records were indexed. Consecutive catch all queries also return different number of numDocs.</p> 
                  <p>We're running a 10 node test cluster with 10 shards and a replication factor of two and frequently reindex using a fresh build from trunk. I've not seen this issue for quite some time until a few days ago.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/SOLR-4260?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/SOLR-4260?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/SOLR-4260?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/SOLR-4260?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12612155" data-issue-id="12626072" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12612155/192.168.20.102-replica1.png" draggable="true" data-downloadurl="image/png:192.168.20.102-replica1.png:https://issues.apache.org/jira/secure/attachment/12612155/192.168.20.102-replica1.png" file-preview-id="12612155" file-preview-title="192.168.20.102-replica1.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12612155/192.168.20.102-replica1.png" title="Latest  05/Nov/13 11:08 - Yago Riveiro" draggable="true" data-downloadurl="image/png:192.168.20.102-replica1.png:https://issues.apache.org/jira/secure/attachment/12612155/192.168.20.102-replica1.png" file-preview-id="12612155" file-preview-title="192.168.20.102-replica1.png" file-preview-type="image">192.168.20.102-replica1.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-11-05T11:08:43.915Z">05/Nov/13 11:08</time>
                   </dd>
                   <dd class="attachment-size">
                    28 kB
                   </dd>
                   <dd class="attachment-author">
                    Yago Riveiro
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12612154" data-issue-id="12626072" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12612154/192.168.20.104-replica2.png" draggable="true" data-downloadurl="image/png:192.168.20.104-replica2.png:https://issues.apache.org/jira/secure/attachment/12612154/192.168.20.104-replica2.png" file-preview-id="12612154" file-preview-title="192.168.20.104-replica2.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12612154/192.168.20.104-replica2.png" title="Latest  05/Nov/13 11:08 - Yago Riveiro" draggable="true" data-downloadurl="image/png:192.168.20.104-replica2.png:https://issues.apache.org/jira/secure/attachment/12612154/192.168.20.104-replica2.png" file-preview-id="12612154" file-preview-title="192.168.20.104-replica2.png" file-preview-type="image">192.168.20.104-replica2.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-11-05T11:08:43.911Z">05/Nov/13 11:08</time>
                   </dd>
                   <dd class="attachment-size">
                    28 kB
                   </dd>
                   <dd class="attachment-author">
                    Yago Riveiro
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12612153" data-issue-id="12626072" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12612153/clusterstate.png" draggable="true" data-downloadurl="image/png:clusterstate.png:https://issues.apache.org/jira/secure/attachment/12612153/clusterstate.png" file-preview-id="12612153" file-preview-title="clusterstate.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12612153/clusterstate.png" title="Latest  05/Nov/13 11:08 - Yago Riveiro" draggable="true" data-downloadurl="image/png:clusterstate.png:https://issues.apache.org/jira/secure/attachment/12612153/clusterstate.png" file-preview-id="12612153" file-preview-title="clusterstate.png" file-preview-type="image">clusterstate.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-11-05T11:08:43.907Z">05/Nov/13 11:08</time>
                   </dd>
                   <dd class="attachment-size">
                    74 kB
                   </dd>
                   <dd class="attachment-author">
                    Yago Riveiro
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12622006" data-issue-id="12626072" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12622006/demo_shard1_replicas_out_of_sync.tgz" draggable="true" data-downloadurl="application/x-gzip:demo_shard1_replicas_out_of_sync.tgz:https://issues.apache.org/jira/secure/attachment/12622006/demo_shard1_replicas_out_of_sync.tgz"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12622006/demo_shard1_replicas_out_of_sync.tgz" title="Latest  08/Jan/14 18:32 - Timothy Potter" draggable="true" data-downloadurl="application/x-gzip:demo_shard1_replicas_out_of_sync.tgz:https://issues.apache.org/jira/secure/attachment/12622006/demo_shard1_replicas_out_of_sync.tgz">demo_shard1_replicas_out_of_sync.tgz</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-01-08T18:32:25.979Z">08/Jan/14 18:32</time>
                   </dd>
                   <dd class="attachment-size">
                    4.03 MB
                   </dd>
                   <dd class="attachment-author">
                    Timothy Potter
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12623488" data-issue-id="12626072" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12623488/SOLR-4260.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-4260.patch:https://issues.apache.org/jira/secure/attachment/12623488/SOLR-4260.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12623488/SOLR-4260.patch" title="Latest  16/Jan/14 21:39 - Mark Miller" draggable="true" data-downloadurl="text/x-patch:SOLR-4260.patch:https://issues.apache.org/jira/secure/attachment/12623488/SOLR-4260.patch">SOLR-4260.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-01-16T21:39:17.541Z">16/Jan/14 21:39</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Miller
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12688464_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-5625: Add to testing for SolrCmdDistributor"> <a href="/jira/browse/SOLR-5625" data-issue-key="SOLR-5625" class="issue-link link-title resolution">SOLR-5625</a> <span class="link-summary">Add to testing for SolrCmdDistributor</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12689682_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-5643: ConcurrentUpdateSolrServer will sometimes not spawn a new Runner thread even though there are updates in the queue."> <a href="/jira/browse/SOLR-5643" data-issue-key="SOLR-5643" class="issue-link link-title resolution">SOLR-5643</a> <span class="link-summary">ConcurrentUpdateSolrServer will sometimes not spawn a new Runner thread even though there are updates in the queue.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12676206_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-5397: Replication can fail silently in some cases."> <a href="/jira/browse/SOLR-5397" data-issue-key="SOLR-5397" class="issue-link link-title resolution">SOLR-5397</a> <span class="link-summary">Replication can fail silently in some cases.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/critical.svg" width="16" height="16" title="Critical - Crashes, loss of data, severe memory leak." alt="Critical - Crashes, loss of data, severe memory leak."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12684361_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-5552: Leader recovery process can select the wrong leader if all replicas for a shard are down and trying to recover as well as lose updates that should have been recovered."> <a href="/jira/browse/SOLR-5552" data-issue-key="SOLR-5552" class="issue-link link-title resolution">SOLR-5552</a> <span class="link-summary">Leader recovery process can select the wrong leader if all replicas for a shard are down and trying to recover as well as lose updates that should have been recovered.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/critical.svg" width="16" height="16" title="Critical - Crashes, loss of data, severe memory leak." alt="Critical - Crashes, loss of data, severe memory leak."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12686103_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/images/icons/issuetypes/requirement.png" width="16" height="16" title="Test - A new unit, integration or system test." alt="Test - A new unit, integration or system test."> <span title="SOLR-5573: ChaosMonkey should randomly turn off Solr's commit on shutdown option."> <a href="/jira/browse/SOLR-5573" data-issue-key="SOLR-5573" class="issue-link link-title resolution">SOLR-5573</a> <span class="link-summary">ChaosMonkey should randomly turn off Solr's commit on shutdown option.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_markrmiller@gmail.com" rel="markrmiller@gmail.com" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Mark Miller&quot;,&quot;emailAddress&quot;:&quot;markrmiller@gmail.com&quot;,&quot;username&quot;:&quot;markrmiller@gmail.com&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="markrmiller@gmail.com"></span></span> Mark Miller </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_markus17" rel="markus17" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Markus Jelsma&quot;,&quot;emailAddress&quot;:&quot;markus@apache.org&quot;,&quot;username&quot;:&quot;markus17&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="markus17"></span></span> Markus Jelsma </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">6</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">24</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="04/Jan/13 17:53"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-01-04T17:53:01+0000">04/Jan/13 17:53</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="09/May/16 18:51"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-05-09T18:51:53+0000">09/May/16 18:51</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="02/Feb/14 15:19"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2014-02-02T15:19:33+0000">02/Feb/14 15:19</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-4260?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/SOLR-4260?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13544077\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13544077&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13544077\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_13544077_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13544077_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/13 17:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-04T17:59:08+0000\'\u003e04\\/Jan\\/13 17:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eFor some reason 5 out of 10 shards have a small deviation in then number of documents. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003enumDocs or maxDoc?\u003cbr\\/\u003e\\nYou \u003cb\u003ecan\u003c\\/b\u003e expect variations in maxDoc (due to the same document being added more than once in recovery scenarios).  numDocs should be identical of course.\u003c\\/p\u003e\\n\\n\u003cp\u003eOh, and that variation in maxDoc will cause small differences in IDF too.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_13544077_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13544077_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/13 17:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-04T17:59:08+0000\'\u003e04\\/Jan\\/13 17:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     For some reason 5 out of 10 shards have a small deviation in then number of documents.   \\n\\n numDocs or maxDoc? \\nYou  can  expect variations in maxDoc (due to the same document being added more than once in recovery scenarios).  numDocs should be identical of course. \\n\\n Oh, and that variation in maxDoc will cause small differences in IDF too.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13544078\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13544078&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13544078\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13544078_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13544078_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/13 17:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-04T17:59:18+0000\'\u003e04\\/Jan\\/13 17:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat\'s fresh? We fixed a couple issue for this within the last couple weeks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13544078_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13544078_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/13 17:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-04T17:59:18+0000\'\u003e04\\/Jan\\/13 17:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What\'s fresh? We fixed a couple issue for this within the last couple weeks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13544079\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13544079&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13544079\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13544079_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13544079_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/13 18:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-04T18:00:17+0000\'\u003e04\\/Jan\\/13 18:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooks like fresh means from today?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13544079_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13544079_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/13 18:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-04T18:00:17+0000\'\u003e04\\/Jan\\/13 18:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looks like fresh means from today?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13544081\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13544081&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13544081\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13544081_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13544081_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/13 18:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-04T18:01:59+0000\'\u003e04\\/Jan\\/13 18:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 04\\/Jan\\/13 18:02\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYonik, i explicitly look at numDocs. Shard_B has Num Docs: 335986, Max Doc: 336079 on one node and Num Docs: 335976 Max Doc: 336091 on the other. \u003c\\/p\u003e\\n\\n\u003cp\u003eMark: yes, this is today, 5.0.0.2013.01.04.15.31.51\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13544081_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13544081_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/13 18:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-04T18:01:59+0000\'\u003e04\\/Jan\\/13 18:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 04\\/Jan\\/13 18:02\\\"\u003eedited\u003c\\/span\u003e                   Yonik, i explicitly look at numDocs. Shard_B has Num Docs: 335986, Max Doc: 336079 on one node and Num Docs: 335976 Max Doc: 336091 on the other.  \\n\\n Mark: yes, this is today, 5.0.0.2013.01.04.15.31.51              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13546000\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13546000&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13546000\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13546000_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13546000_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jan\\/13 16:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-07T16:15:49+0000\'\u003e07\\/Jan\\/13 16:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI tried to reproduce this twice with today\'s check out of trunk manner but failed to consistently reproduce it. I did see a small deviation while no data was coming in and no recovery was \u003cb\u003ereported\u003c\\/b\u003e to be in progress, in the end all replicates where in sync and had, accoring to Luke, identical numDocs.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll keep an eye on this in the next couple of days.\u003c\\/p\u003e\\n\\n\u003cp\u003ebtw: in this test cluster we use docCount and not maxDoc for our IDF calculation.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13546000_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13546000_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jan\\/13 16:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-07T16:15:49+0000\'\u003e07\\/Jan\\/13 16:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I tried to reproduce this twice with today\'s check out of trunk manner but failed to consistently reproduce it. I did see a small deviation while no data was coming in and no recovery was  reported  to be in progress, in the end all replicates where in sync and had, accoring to Luke, identical numDocs. \\n\\n I\'ll keep an eye on this in the next couple of days. \\n\\n btw: in this test cluster we use docCount and not maxDoc for our IDF calculation.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13546027\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13546027&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13546027\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13546027_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13546027_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jan\\/13 16:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-07T16:49:06+0000\'\u003e07\\/Jan\\/13 16:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks - would be good to make sure this is okay. FYI, seeing things off for a short time is somewhat expected - there is some \'eventual\' consistency here - but it should quickly consistent itself up - under heavy bulk indexing is when you would be most likely to have the most \\\"eventualness\\\".\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13546027_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13546027_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jan\\/13 16:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-07T16:49:06+0000\'\u003e07\\/Jan\\/13 16:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks - would be good to make sure this is okay. FYI, seeing things off for a short time is somewhat expected - there is some \'eventual\' consistency here - but it should quickly consistent itself up - under heavy bulk indexing is when you would be most likely to have the most \\\"eventualness\\\".              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13546196\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13546196&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13546196\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13546196_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13546196_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jan\\/13 19:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-07T19:41:55+0000\'\u003e07\\/Jan\\/13 19:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, we see that behaviour all the time but it is expected indeed. The problem with with this issue is that it was not a dozen seconds or a few minutes but it was consistently wrong for almost an hour, then i wrote this issue and left the office \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13546196_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13546196_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jan\\/13 19:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-07T19:41:55+0000\'\u003e07\\/Jan\\/13 19:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, we see that behaviour all the time but it is expected indeed. The problem with with this issue is that it was not a dozen seconds or a few minutes but it was consistently wrong for almost an hour, then i wrote this issue and left the office                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13555980\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13555980&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13555980\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13555980_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13555980_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/13 08:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-17T08:31:28+0000\'\u003e17\\/Jan\\/13 08:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve got it again. This time numDocs is consistent but some facet counts are not consistent between leader and replica. Here are two facet counts for one node:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e   &lt;lst name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"domain\\\"\u003c\\/span\u003e&gt;\\n      &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"domain_a\\\"\u003c\\/span\u003e&gt;238620&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n      &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"domain_b\\\"\u003c\\/span\u003e&gt;218&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eand the other:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e   &lt;lst name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"domain\\\"\u003c\\/span\u003e&gt;\\n      &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"domain_a\\\"\u003c\\/span\u003e&gt;238621&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n      &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"domain_b\\\"\u003c\\/span\u003e&gt;217&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13555980_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13555980_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/13 08:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-17T08:31:28+0000\'\u003e17\\/Jan\\/13 08:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve got it again. This time numDocs is consistent but some facet counts are not consistent between leader and replica. Here are two facet counts for one node: \\n\\n  \\n    &lt;lst name= \\\"domain\\\" &gt;\\n      &lt; int  name= \\\"domain_a\\\" &gt;238620&lt;\\/ int &gt;\\n      &lt; int  name= \\\"domain_b\\\" &gt;218&lt;\\/ int &gt;\\n \\n  \\n\\n and the other: \\n\\n  \\n    &lt;lst name= \\\"domain\\\" &gt;\\n      &lt; int  name= \\\"domain_a\\\" &gt;238621&lt;\\/ int &gt;\\n      &lt; int  name= \\\"domain_b\\\" &gt;217&lt;\\/ int &gt;\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13556261\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13556261&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13556261\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13556261_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13556261_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/13 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-17T15:16:34+0000\'\u003e17\\/Jan\\/13 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNot sure I\'d say it\'s \'it\' again yet - numdocs and facet counts are quite different.\u003c\\/p\u003e\\n\\n\u003cp\u003eInteresting though - does that persist after a hard commit \\/ open new searcher?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13556261_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13556261_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/13 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-17T15:16:34+0000\'\u003e17\\/Jan\\/13 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Not sure I\'d say it\'s \'it\' again yet - numdocs and facet counts are quite different. \\n\\n Interesting though - does that persist after a hard commit \\/ open new searcher?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13556315\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13556315&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13556315\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13556315_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13556315_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/13 15:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-17T15:37:35+0000\'\u003e17\\/Jan\\/13 15:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYou\'re right, it is different, my bad. A hard commit is issues automatically once in a while and the issue persists and after a manual hard commit as well.\u003c\\/p\u003e\\n\\n\u003cp\u003eInterestingly, we see that the docCounts returned by CollectionStatistics.docCount() is inconsistent between leader and replica for each shard. As Yonik said, it\'s normal when using maxDoc but we don\'t use maxDoc in this set up, docCount should be correct. Since it isn\'t, our IDF is sometimes skewed, causing docs to jump position in the result set.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13556315_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13556315_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/13 15:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-17T15:37:35+0000\'\u003e17\\/Jan\\/13 15:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    You\'re right, it is different, my bad. A hard commit is issues automatically once in a while and the issue persists and after a manual hard commit as well. \\n\\n Interestingly, we see that the docCounts returned by CollectionStatistics.docCount() is inconsistent between leader and replica for each shard. As Yonik said, it\'s normal when using maxDoc but we don\'t use maxDoc in this set up, docCount should be correct. Since it isn\'t, our IDF is sometimes skewed, causing docs to jump position in the result set. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13557211\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13557211&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13557211\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13557211_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557211_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T13:53:12+0000\'\u003e18\\/Jan\\/13 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve removed domain_b from the index and as i expected the numDocs is now inconsistent indeed. By coincidence the what was missing in one replica from domain_a was replaced by an extra doc from domain_b and vice versa.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe collection of a couple of million records has one replica that\'s missing one document.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13557211_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557211_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T13:53:12+0000\'\u003e18\\/Jan\\/13 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve removed domain_b from the index and as i expected the numDocs is now inconsistent indeed. By coincidence the what was missing in one replica from domain_a was replaced by an extra doc from domain_b and vice versa. \\n\\n The collection of a couple of million records has one replica that\'s missing one document.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558794\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13558794&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558794\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13558794_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558794_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 14:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T14:30:45+0000\'\u003e21\\/Jan\\/13 14:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s the debug output of the same query executed on both the leader and the replica. This set up uses and overridden BM25Similarity that returns docCount() for IDF instead of maxDoc. In this case both have the equal number of documents in the index so something else doesn\'t seem right. Facet counts add up, both leader and replicaa have the same number of documents per domain.\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e43.960983 = (MATCH) sum of:\\n  43.960983 = (MATCH) max plus 0.35 times others of:\\n    29.059849 = (MATCH) weight(title_nl:amsterdam^6.4 in 14437) [], result of:\\n      29.059849 = score(doc=14437,freq=3.0 = termFreq=3.0\\n), product of:\\n        6.4 = boost\\n        2.889473 = idf(docFreq=18368, docCount=330335)\\n        1.5714288 = tfNorm, computed from:\\n          3.0 = termFreq=3.0\\n          1.2 = parameter k1\\n          0.0 = parameter b (norms omitted \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e field)\\n    4.651832 = (MATCH) weight(content_nl:amsterdam^1.6 in 14437) [], result of:\\n      4.651832 = score(doc=14437,freq=1.0 = termFreq=1.0\\n), product of:\\n        1.6 = boost\\n        2.9073951 = idf(docFreq=18039, docCount=330285)\\n        1.0 = tfNorm, computed from:\\n          1.0 = termFreq=1.0\\n          1.2 = parameter k1\\n          0.0 = parameter b (norms omitted \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e field)\\n    32.161896 = (MATCH) weight(url:amsterdam^3.64 in 14437) [], result of:\\n      32.161896 = score(doc=14437,freq=2.0 = termFreq=2.0\\n), product of:\\n        3.64 = boost\\n        6.328843 = idf(docFreq=608, docCount=341068)\\n        1.396098 = tfNorm, computed from:\\n          2.0 = termFreq=2.0\\n          1.2 = parameter k1\\n          0.75 = parameter b\\n          4.227131 = avgFieldLength\\n          4.0 = fieldLength\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e45.993042 = (MATCH) sum of:\\n  45.993042 = (MATCH) max plus 0.35 times others of:\\n    28.35725 = (MATCH) weight(title_nl:amsterdam^6.4 in 170479) [], result of:\\n      28.35725 = score(doc=170479,freq=3.0 = termFreq=3.0\\n), product of:\\n        6.4 = boost\\n        2.8196125 = idf(docFreq=16736, docCount=280676)\\n        1.5714288 = tfNorm, computed from:\\n          3.0 = termFreq=3.0\\n          1.2 = parameter k1\\n          0.0 = parameter b (norms omitted \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e field)\\n    4.577688 = (MATCH) weight(content_nl:amsterdam^1.6 in 170479) [], result of:\\n      4.577688 = score(doc=170479,freq=1.0 = termFreq=1.0\\n), product of:\\n        1.6 = boost\\n        2.8610551 = idf(docFreq=16054, docCount=280631)\\n        1.0 = tfNorm, computed from:\\n          1.0 = termFreq=1.0\\n          1.2 = parameter k1\\n          0.0 = parameter b (norms omitted \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e field)\\n    34.465813 = (MATCH) weight(url:amsterdam^3.64 in 170479) [], result of:\\n      34.465813 = score(doc=170479,freq=2.0 = termFreq=2.0\\n), product of:\\n        3.64 = boost\\n        6.798851 = idf(docFreq=323, docCount=290119)\\n        1.3926809 = tfNorm, computed from:\\n          2.0 = termFreq=2.0\\n          1.2 = parameter k1\\n          0.75 = parameter b\\n          4.189095 = avgFieldLength\\n          4.0 = fieldLength\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eIt\'s clear that not only docCount is different but also docFreq while both should be equal on the leader and replica. This makes a mess of the final score!\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyone else here that has seen this issue?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13558794_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558794_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 14:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T14:30:45+0000\'\u003e21\\/Jan\\/13 14:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s the debug output of the same query executed on both the leader and the replica. This set up uses and overridden BM25Similarity that returns docCount() for IDF instead of maxDoc. In this case both have the equal number of documents in the index so something else doesn\'t seem right. Facet counts add up, both leader and replicaa have the same number of documents per domain. \\n\\n  \\n 43.960983 = (MATCH) sum of:\\n  43.960983 = (MATCH) max plus 0.35 times others of:\\n    29.059849 = (MATCH) weight(title_nl:amsterdam^6.4 in 14437) [], result of:\\n      29.059849 = score(doc=14437,freq=3.0 = termFreq=3.0\\n), product of:\\n        6.4 = boost\\n        2.889473 = idf(docFreq=18368, docCount=330335)\\n        1.5714288 = tfNorm, computed from:\\n          3.0 = termFreq=3.0\\n          1.2 = parameter k1\\n          0.0 = parameter b (norms omitted  for  field)\\n    4.651832 = (MATCH) weight(content_nl:amsterdam^1.6 in 14437) [], result of:\\n      4.651832 = score(doc=14437,freq=1.0 = termFreq=1.0\\n), product of:\\n        1.6 = boost\\n        2.9073951 = idf(docFreq=18039, docCount=330285)\\n        1.0 = tfNorm, computed from:\\n          1.0 = termFreq=1.0\\n          1.2 = parameter k1\\n          0.0 = parameter b (norms omitted  for  field)\\n    32.161896 = (MATCH) weight(url:amsterdam^3.64 in 14437) [], result of:\\n      32.161896 = score(doc=14437,freq=2.0 = termFreq=2.0\\n), product of:\\n        3.64 = boost\\n        6.328843 = idf(docFreq=608, docCount=341068)\\n        1.396098 = tfNorm, computed from:\\n          2.0 = termFreq=2.0\\n          1.2 = parameter k1\\n          0.75 = parameter b\\n          4.227131 = avgFieldLength\\n          4.0 = fieldLength\\n \\n  \\n\\n  \\n 45.993042 = (MATCH) sum of:\\n  45.993042 = (MATCH) max plus 0.35 times others of:\\n    28.35725 = (MATCH) weight(title_nl:amsterdam^6.4 in 170479) [], result of:\\n      28.35725 = score(doc=170479,freq=3.0 = termFreq=3.0\\n), product of:\\n        6.4 = boost\\n        2.8196125 = idf(docFreq=16736, docCount=280676)\\n        1.5714288 = tfNorm, computed from:\\n          3.0 = termFreq=3.0\\n          1.2 = parameter k1\\n          0.0 = parameter b (norms omitted  for  field)\\n    4.577688 = (MATCH) weight(content_nl:amsterdam^1.6 in 170479) [], result of:\\n      4.577688 = score(doc=170479,freq=1.0 = termFreq=1.0\\n), product of:\\n        1.6 = boost\\n        2.8610551 = idf(docFreq=16054, docCount=280631)\\n        1.0 = tfNorm, computed from:\\n          1.0 = termFreq=1.0\\n          1.2 = parameter k1\\n          0.0 = parameter b (norms omitted  for  field)\\n    34.465813 = (MATCH) weight(url:amsterdam^3.64 in 170479) [], result of:\\n      34.465813 = score(doc=170479,freq=2.0 = termFreq=2.0\\n), product of:\\n        3.64 = boost\\n        6.798851 = idf(docFreq=323, docCount=290119)\\n        1.3926809 = tfNorm, computed from:\\n          2.0 = termFreq=2.0\\n          1.2 = parameter k1\\n          0.75 = parameter b\\n          4.189095 = avgFieldLength\\n          4.0 = fieldLength\\n \\n  \\n\\n It\'s clear that not only docCount is different but also docFreq while both should be equal on the leader and replica. This makes a mess of the final score! \\n\\n Anyone else here that has seen this issue?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558910\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13558910&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558910\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13558910_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558910_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 17:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T17:03:02+0000\'\u003e21\\/Jan\\/13 17:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, this is not a SolrCloud issue, i can also reproduce this in stand-alone and multi core set ups. This is also not a problem of BM25 since TFIDF has the same problem. Neither docCount vs. maxCount seems to be the problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eI now have two identical cores set up and index the same data to both, no problem, everything is very consistent. Then i\'ll reindex the same data again to only one of the two cores and then the trouble starts. There is a small variation in maxDoc which is expected but there is also a variation in docFreq which is very unexpected, docFreq must not change at all if i reindex the same data.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s an debug snippet of the first core that did not receive reindexed data:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e910.47974 = (MATCH) sum of:\\n  910.47974 = (MATCH) max plus 0.35 times others of:\\n    793.99835 = (MATCH) weight(title_en:groningen^6.4 in 5132) [], result of:\\n      793.99835 = score(doc=5132,freq=1.0 = termFreq=1.0\\n), product of:\\n        71.28527 = queryWeight, product of:\\n          6.4 = boost\\n          11.138323 = idf(docFreq=1, maxDocs=50588)\\n          1.0 = queryNorm\\n        11.138323 = fieldWeight in 5132, product of:\\n          1.0 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          11.138323 = idf(docFreq=1, maxDocs=50588)\\n          1.0 = fieldNorm(doc=5132)\\n    312.06528 = (MATCH) weight(content_en:groningen^1.6 in 5132) [], result of:\\n      312.06528 = score(doc=5132,freq=1.0 = termFreq=1.0\\n), product of:\\n        17.172573 = queryWeight, product of:\\n          1.6 = boost\\n          10.732858 = idf(docFreq=2, maxDocs=50588)\\n          1.0 = queryNorm\\n        18.172308 = fieldWeight in 5132, product of:\\n          1.6931472 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          10.732858 = idf(docFreq=2, maxDocs=50588)\\n          1.0 = fieldNorm(doc=5132)\\n    20.73867 = (MATCH) weight(domain_grams:groningen^3.7 in 5132) [], result of:\\n      20.73867 = score(doc=5132,freq=1.0 = termFreq=1.0\\n), product of:\\n        26.48697 = queryWeight, product of:\\n          3.7 = boost\\n          7.158641 = idf(docFreq=106, maxDocs=50588)\\n          1.0 = queryNorm\\n        0.7829763 = fieldWeight in 5132, product of:\\n          1.0 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          7.158641 = idf(docFreq=106, maxDocs=50588)\\n          0.109375 = fieldNorm(doc=5132)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eHere\'s the debug of the same doc on the core which i reindexed the same data to:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e928.31537 = (MATCH) sum of:\\n  928.31537 = (MATCH) max plus 0.35 times others of:\\n    815.29694 = (MATCH) weight(title_en:groningen^6.4 in 31881) [], result of:\\n      815.29694 = score(doc=31881,freq=1.0 = termFreq=1.0\\n), product of:\\n        72.23504 = queryWeight, product of:\\n          6.4 = boost\\n          11.286724 = idf(docFreq=1, maxDocs=58681)\\n          1.0 = queryNorm\\n        11.286724 = fieldWeight in 31881, product of:\\n          1.0 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          11.286724 = idf(docFreq=1, maxDocs=58681)\\n          1.0 = fieldNorm(doc=31881)\\n    304.0185 = (MATCH) weight(content_en:groningen^1.6 in 31881) [], result of:\\n      304.0185 = score(doc=31881,freq=1.0 = termFreq=1.0\\n), product of:\\n        16.949724 = queryWeight, product of:\\n          1.6 = boost\\n          10.593577 = idf(docFreq=3, maxDocs=58681)\\n          1.0 = queryNorm\\n        17.936485 = fieldWeight in 31881, product of:\\n          1.6931472 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          10.593577 = idf(docFreq=3, maxDocs=58681)\\n          1.0 = fieldNorm(doc=31881)\\n    18.891369 = (MATCH) weight(domain_grams:groningen^3.7 in 31881) [], result of:\\n      18.891369 = score(doc=31881,freq=1.0 = termFreq=1.0\\n), product of:\\n        25.279795 = queryWeight, product of:\\n          3.7 = boost\\n          6.832377 = idf(docFreq=171, maxDocs=58681)\\n          1.0 = queryNorm\\n        0.7472912 = fieldWeight in 31881, product of:\\n          1.0 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          6.832377 = idf(docFreq=171, maxDocs=58681)\\n          0.109375 = fieldNorm(doc=31881)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eAs you can see, docFreq has changed but the number of documents is still the same. Since i now suspect the merging of segments has something to do with it i\'ll send an optimize command to the node that i reindexed data to.\u003c\\/p\u003e\\n\\n\u003cp\u003eAfter optimizing (or forcing all segments to be merged) i get the same debug as i had for the first node that i didn\'t reindex to!\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13558910_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558910_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 17:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T17:03:02+0000\'\u003e21\\/Jan\\/13 17:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, this is not a SolrCloud issue, i can also reproduce this in stand-alone and multi core set ups. This is also not a problem of BM25 since TFIDF has the same problem. Neither docCount vs. maxCount seems to be the problem. \\n\\n I now have two identical cores set up and index the same data to both, no problem, everything is very consistent. Then i\'ll reindex the same data again to only one of the two cores and then the trouble starts. There is a small variation in maxDoc which is expected but there is also a variation in docFreq which is very unexpected, docFreq must not change at all if i reindex the same data. \\n\\n Here\'s an debug snippet of the first core that did not receive reindexed data: \\n\\n  \\n 910.47974 = (MATCH) sum of:\\n  910.47974 = (MATCH) max plus 0.35 times others of:\\n    793.99835 = (MATCH) weight(title_en:groningen^6.4 in 5132) [], result of:\\n      793.99835 = score(doc=5132,freq=1.0 = termFreq=1.0\\n), product of:\\n        71.28527 = queryWeight, product of:\\n          6.4 = boost\\n          11.138323 = idf(docFreq=1, maxDocs=50588)\\n          1.0 = queryNorm\\n        11.138323 = fieldWeight in 5132, product of:\\n          1.0 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          11.138323 = idf(docFreq=1, maxDocs=50588)\\n          1.0 = fieldNorm(doc=5132)\\n    312.06528 = (MATCH) weight(content_en:groningen^1.6 in 5132) [], result of:\\n      312.06528 = score(doc=5132,freq=1.0 = termFreq=1.0\\n), product of:\\n        17.172573 = queryWeight, product of:\\n          1.6 = boost\\n          10.732858 = idf(docFreq=2, maxDocs=50588)\\n          1.0 = queryNorm\\n        18.172308 = fieldWeight in 5132, product of:\\n          1.6931472 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          10.732858 = idf(docFreq=2, maxDocs=50588)\\n          1.0 = fieldNorm(doc=5132)\\n    20.73867 = (MATCH) weight(domain_grams:groningen^3.7 in 5132) [], result of:\\n      20.73867 = score(doc=5132,freq=1.0 = termFreq=1.0\\n), product of:\\n        26.48697 = queryWeight, product of:\\n          3.7 = boost\\n          7.158641 = idf(docFreq=106, maxDocs=50588)\\n          1.0 = queryNorm\\n        0.7829763 = fieldWeight in 5132, product of:\\n          1.0 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          7.158641 = idf(docFreq=106, maxDocs=50588)\\n          0.109375 = fieldNorm(doc=5132)\\n \\n  \\n\\n Here\'s the debug of the same doc on the core which i reindexed the same data to: \\n\\n  \\n 928.31537 = (MATCH) sum of:\\n  928.31537 = (MATCH) max plus 0.35 times others of:\\n    815.29694 = (MATCH) weight(title_en:groningen^6.4 in 31881) [], result of:\\n      815.29694 = score(doc=31881,freq=1.0 = termFreq=1.0\\n), product of:\\n        72.23504 = queryWeight, product of:\\n          6.4 = boost\\n          11.286724 = idf(docFreq=1, maxDocs=58681)\\n          1.0 = queryNorm\\n        11.286724 = fieldWeight in 31881, product of:\\n          1.0 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          11.286724 = idf(docFreq=1, maxDocs=58681)\\n          1.0 = fieldNorm(doc=31881)\\n    304.0185 = (MATCH) weight(content_en:groningen^1.6 in 31881) [], result of:\\n      304.0185 = score(doc=31881,freq=1.0 = termFreq=1.0\\n), product of:\\n        16.949724 = queryWeight, product of:\\n          1.6 = boost\\n          10.593577 = idf(docFreq=3, maxDocs=58681)\\n          1.0 = queryNorm\\n        17.936485 = fieldWeight in 31881, product of:\\n          1.6931472 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          10.593577 = idf(docFreq=3, maxDocs=58681)\\n          1.0 = fieldNorm(doc=31881)\\n    18.891369 = (MATCH) weight(domain_grams:groningen^3.7 in 31881) [], result of:\\n      18.891369 = score(doc=31881,freq=1.0 = termFreq=1.0\\n), product of:\\n        25.279795 = queryWeight, product of:\\n          3.7 = boost\\n          6.832377 = idf(docFreq=171, maxDocs=58681)\\n          1.0 = queryNorm\\n        0.7472912 = fieldWeight in 31881, product of:\\n          1.0 = tf(freq=1.0), with freq of:\\n            1.0 = termFreq=1.0\\n          6.832377 = idf(docFreq=171, maxDocs=58681)\\n          0.109375 = fieldNorm(doc=31881)\\n \\n  \\n\\n As you can see, docFreq has changed but the number of documents is still the same. Since i now suspect the merging of segments has something to do with it i\'ll send an optimize command to the node that i reindexed data to. \\n\\n After optimizing (or forcing all segments to be merged) i get the same debug as i had for the first node that i didn\'t reindex to! \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558920\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13558920&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558920\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13558920_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558920_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 17:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T17:12:16+0000\'\u003e21\\/Jan\\/13 17:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI updated the title to reflect the new issue. Can anyone confirm that with trunk they see different values for CollectionStatistics.docCount and docFreq?\u003c\\/p\u003e\\n\\n\u003cp\u003eI can confirm that the variations disappear after optimizing one of our SolrCloud clusters. The only time results swap places is when the score is identical and docID is used to score.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13558920_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558920_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 17:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T17:12:16+0000\'\u003e21\\/Jan\\/13 17:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I updated the title to reflect the new issue. Can anyone confirm that with trunk they see different values for CollectionStatistics.docCount and docFreq? \\n\\n I can confirm that the variations disappear after optimizing one of our SolrCloud clusters. The only time results swap places is when the score is identical and docID is used to score.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558929\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13558929&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558929\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_13558929_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558929_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 17:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T17:28:39+0000\'\u003e21\\/Jan\\/13 17:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThere is a small variation in maxDoc which is expected but there is also a variation in docFreq which is very unexpected, docFreq must not change at all if i reindex the same data.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eUnfortunately, deletions don\'t change index statistics like docFreq (this has been the case since the first version of Lucene).  This means that reindexing a document can artificially increase the docFreq until the deletion is really removed via merging\\/optimize.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_13558929_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558929_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 17:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T17:28:39+0000\'\u003e21\\/Jan\\/13 17:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     There is a small variation in maxDoc which is expected but there is also a variation in docFreq which is very unexpected, docFreq must not change at all if i reindex the same data.  \\n\\n Unfortunately, deletions don\'t change index statistics like docFreq (this has been the case since the first version of Lucene).  This means that reindexing a document can artificially increase the docFreq until the deletion is really removed via merging\\/optimize.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558999\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13558999&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558999\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13558999_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558999_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 19:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T19:14:55+0000\'\u003e21\\/Jan\\/13 19:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOf course, you\'re right! I got distracted by that fact and in the process renamed this issue while i shouldn\'t. The inconsistency between leader and replica on one shard is still here.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll rename it back and raise the docFreq and docCount issue on the list. Sorry for the mess \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13558999_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558999_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 19:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T19:14:55+0000\'\u003e21\\/Jan\\/13 19:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Of course, you\'re right! I got distracted by that fact and in the process renamed this issue while i shouldn\'t. The inconsistency between leader and replica on one shard is still here. \\n\\n I\'ll rename it back and raise the docFreq and docCount issue on the list. Sorry for the mess                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13581189\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13581189&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13581189\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13581189_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13581189_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/13 10:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-19T10:16:44+0000\'\u003e19\\/Feb\\/13 10:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s the index information for two cores of the same shard, running on different nodes.\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e&lt;?xml version=\u003cspan class=\\\"code-quote\\\"\u003e\\\"1.0\\\"\u003c\\/span\u003e encoding=\u003cspan class=\\\"code-quote\\\"\u003e\\\"UTF-8\\\"\u003c\\/span\u003e?&gt;\\n&lt;response&gt;\\n\\n&lt;lst name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"responseHeader\\\"\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"status\\\"\u003c\\/span\u003e&gt;0&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"QTime\\\"\u003c\\/span\u003e&gt;1&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n&lt;\\/lst&gt;\\n&lt;lst name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"index\\\"\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"numDocs\\\"\u003c\\/span\u003e&gt;117744&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"maxDoc\\\"\u003c\\/span\u003e&gt;118160&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"deletedDocs\\\"\u003c\\/span\u003e&gt;416&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003elong\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"version\\\"\u003c\\/span\u003e&gt;3802&lt;\\/\u003cspan class=\\\"code-object\\\"\u003elong\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"segmentCount\\\"\u003c\\/span\u003e&gt;15&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;bool name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"current\\\"\u003c\\/span\u003e&gt;\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e&lt;\\/bool&gt;\\n  &lt;bool name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"hasDeletions\\\"\u003c\\/span\u003e&gt;\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e&lt;\\/bool&gt;\\n  &lt;str name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"directory\\\"\u003c\\/span\u003e&gt;org.apache.lucene.store.NRTCachingDirectory:NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@\\/opt\\/solr\\/cores\\/shard_h\\/data\\/index.20130211094737738 lockFactory=org.apache.lucene.store.NativeFSLockFactory@2ca7563d; maxCacheMB=48.0 maxMergeSizeMB=4.0)&lt;\\/str&gt;\\n  &lt;lst name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"userData\\\"\u003c\\/span\u003e&gt;\\n    &lt;str name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"commitTimeMSec\\\"\u003c\\/span\u003e&gt;1361265544970&lt;\\/str&gt;\\n  &lt;\\/lst&gt;\\n  &lt;date name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"lastModified\\\"\u003c\\/span\u003e&gt;2013-02-19T09:19:04.97Z&lt;\\/date&gt;\\n&lt;\\/lst&gt;\\n&lt;\\/response&gt;\\n\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e&lt;?xml version=\u003cspan class=\\\"code-quote\\\"\u003e\\\"1.0\\\"\u003c\\/span\u003e encoding=\u003cspan class=\\\"code-quote\\\"\u003e\\\"UTF-8\\\"\u003c\\/span\u003e?&gt;\\n&lt;response&gt;\\n\\n&lt;lst name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"responseHeader\\\"\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"status\\\"\u003c\\/span\u003e&gt;0&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"QTime\\\"\u003c\\/span\u003e&gt;0&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n&lt;\\/lst&gt;\\n&lt;lst name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"index\\\"\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"numDocs\\\"\u003c\\/span\u003e&gt;117767&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"maxDoc\\\"\u003c\\/span\u003e&gt;118181&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"deletedDocs\\\"\u003c\\/span\u003e&gt;414&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003elong\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"version\\\"\u003c\\/span\u003e&gt;3772&lt;\\/\u003cspan class=\\\"code-object\\\"\u003elong\u003c\\/span\u003e&gt;\\n  &lt;\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"segmentCount\\\"\u003c\\/span\u003e&gt;13&lt;\\/\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e&gt;\\n  &lt;bool name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"current\\\"\u003c\\/span\u003e&gt;\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e&lt;\\/bool&gt;\\n  &lt;bool name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"hasDeletions\\\"\u003c\\/span\u003e&gt;\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e&lt;\\/bool&gt;\\n  &lt;str name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"directory\\\"\u003c\\/span\u003e&gt;org.apache.lucene.store.NRTCachingDirectory:NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@\\/opt\\/solr\\/cores\\/shard_h\\/data\\/index.20130211105622621 lockFactory=org.apache.lucene.store.NativeFSLockFactory@684b4388; maxCacheMB=48.0 maxMergeSizeMB=4.0)&lt;\\/str&gt;\\n  &lt;lst name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"userData\\\"\u003c\\/span\u003e&gt;\\n    &lt;str name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"commitTimeMSec\\\"\u003c\\/span\u003e&gt;1361265544937&lt;\\/str&gt;\\n  &lt;\\/lst&gt;\\n  &lt;date name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"lastModified\\\"\u003c\\/span\u003e&gt;2013-02-19T09:19:04.937Z&lt;\\/date&gt;\\n&lt;\\/lst&gt;\\n&lt;\\/response&gt;\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWe send updates\\/deletes to the cluster every 10-15 minutes. The shard will not become synchronized, unless i remove the index of one of the nodes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13581189_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13581189_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/13 10:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-19T10:16:44+0000\'\u003e19\\/Feb\\/13 10:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s the index information for two cores of the same shard, running on different nodes. \\n\\n  \\n &lt;?xml version= \\\"1.0\\\"  encoding= \\\"UTF-8\\\" ?&gt;\\n&lt;response&gt;\\n\\n&lt;lst name= \\\"responseHeader\\\" &gt;\\n  &lt; int  name= \\\"status\\\" &gt;0&lt;\\/ int &gt;\\n  &lt; int  name= \\\"QTime\\\" &gt;1&lt;\\/ int &gt;\\n&lt;\\/lst&gt;\\n&lt;lst name= \\\"index\\\" &gt;\\n  &lt; int  name= \\\"numDocs\\\" &gt;117744&lt;\\/ int &gt;\\n  &lt; int  name= \\\"maxDoc\\\" &gt;118160&lt;\\/ int &gt;\\n  &lt; int  name= \\\"deletedDocs\\\" &gt;416&lt;\\/ int &gt;\\n  &lt; long  name= \\\"version\\\" &gt;3802&lt;\\/ long &gt;\\n  &lt; int  name= \\\"segmentCount\\\" &gt;15&lt;\\/ int &gt;\\n  &lt;bool name= \\\"current\\\" &gt; true &lt;\\/bool&gt;\\n  &lt;bool name= \\\"hasDeletions\\\" &gt; true &lt;\\/bool&gt;\\n  &lt;str name= \\\"directory\\\" &gt;org.apache.lucene.store.NRTCachingDirectory:NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@\\/opt\\/solr\\/cores\\/shard_h\\/data\\/index.20130211094737738 lockFactory=org.apache.lucene.store.NativeFSLockFactory@2ca7563d; maxCacheMB=48.0 maxMergeSizeMB=4.0)&lt;\\/str&gt;\\n  &lt;lst name= \\\"userData\\\" &gt;\\n    &lt;str name= \\\"commitTimeMSec\\\" &gt;1361265544970&lt;\\/str&gt;\\n  &lt;\\/lst&gt;\\n  &lt;date name= \\\"lastModified\\\" &gt;2013-02-19T09:19:04.97Z&lt;\\/date&gt;\\n&lt;\\/lst&gt;\\n&lt;\\/response&gt;\\n\\n \\n  \\n\\n  \\n &lt;?xml version= \\\"1.0\\\"  encoding= \\\"UTF-8\\\" ?&gt;\\n&lt;response&gt;\\n\\n&lt;lst name= \\\"responseHeader\\\" &gt;\\n  &lt; int  name= \\\"status\\\" &gt;0&lt;\\/ int &gt;\\n  &lt; int  name= \\\"QTime\\\" &gt;0&lt;\\/ int &gt;\\n&lt;\\/lst&gt;\\n&lt;lst name= \\\"index\\\" &gt;\\n  &lt; int  name= \\\"numDocs\\\" &gt;117767&lt;\\/ int &gt;\\n  &lt; int  name= \\\"maxDoc\\\" &gt;118181&lt;\\/ int &gt;\\n  &lt; int  name= \\\"deletedDocs\\\" &gt;414&lt;\\/ int &gt;\\n  &lt; long  name= \\\"version\\\" &gt;3772&lt;\\/ long &gt;\\n  &lt; int  name= \\\"segmentCount\\\" &gt;13&lt;\\/ int &gt;\\n  &lt;bool name= \\\"current\\\" &gt; true &lt;\\/bool&gt;\\n  &lt;bool name= \\\"hasDeletions\\\" &gt; true &lt;\\/bool&gt;\\n  &lt;str name= \\\"directory\\\" &gt;org.apache.lucene.store.NRTCachingDirectory:NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@\\/opt\\/solr\\/cores\\/shard_h\\/data\\/index.20130211105622621 lockFactory=org.apache.lucene.store.NativeFSLockFactory@684b4388; maxCacheMB=48.0 maxMergeSizeMB=4.0)&lt;\\/str&gt;\\n  &lt;lst name= \\\"userData\\\" &gt;\\n    &lt;str name= \\\"commitTimeMSec\\\" &gt;1361265544937&lt;\\/str&gt;\\n  &lt;\\/lst&gt;\\n  &lt;date name= \\\"lastModified\\\" &gt;2013-02-19T09:19:04.937Z&lt;\\/date&gt;\\n&lt;\\/lst&gt;\\n&lt;\\/response&gt;\\n \\n  \\n\\n We send updates\\/deletes to the cluster every 10-15 minutes. The shard will not become synchronized, unless i remove the index of one of the nodes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13581942\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13581942&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13581942\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13581942_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13581942_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 04:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T04:46:17+0000\'\u003e20\\/Feb\\/13 04:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNo interesting exceptions in the logs? Perhaps dial them up to warn and run?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13581942_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13581942_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 04:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T04:46:17+0000\'\u003e20\\/Feb\\/13 04:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    No interesting exceptions in the logs? Perhaps dial them up to warn and run?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13582030\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13582030&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13582030\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13582030_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582030_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 08:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T08:30:32+0000\'\u003e20\\/Feb\\/13 08:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 20\\/Feb\\/13 08:38\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNothing peculiar in the WARN logs. We don\'t log INFO usually unless something is really broken, that\'s too much data.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13582030_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13582030_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/13 08:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-20T08:30:32+0000\'\u003e20\\/Feb\\/13 08:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 20\\/Feb\\/13 08:38\\\"\u003eedited\u003c\\/span\u003e                   Nothing peculiar in the WARN logs. We don\'t log INFO usually unless something is really broken, that\'s too much data.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13712297\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13712297&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13712297\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13712297_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13712297_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/13 13:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-18T13:11:12+0000\'\u003e18\\/Jul\\/13 13:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFYI: we\'re still seeing major inconsistencies, facet counts are off and when inspecting leaders and replica\'s we notice not all are in sync. This is on yesterday\'s trunk and with an empty index. There were no node failures during indexing. Shard_b\'s stats for example:\u003c\\/p\u003e\\n\\n\u003cp\u003enode 2 shard b\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eLast Modified:    about a minute ago\\nNum Docs:    158964\\nMax Doc:    158964\\nDeleted Docs:    0\\nVersion:    4479\\nSegment Count:    1\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003enode 3 shard b\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eLast Modified:    2 minutes ago\\nNum Docs:    158298\\nMax Doc:    158298\\nDeleted Docs:    0\\nVersion:    2886\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSize and versions are also different. Cluster is optimized\\/forceMerged but doesn\'t change the facts as expected. At least one other shard also has differences in its two replica\'s, i haven\'t manually checked the others.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13712297_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13712297_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/13 13:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-18T13:11:12+0000\'\u003e18\\/Jul\\/13 13:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    FYI: we\'re still seeing major inconsistencies, facet counts are off and when inspecting leaders and replica\'s we notice not all are in sync. This is on yesterday\'s trunk and with an empty index. There were no node failures during indexing. Shard_b\'s stats for example: \\n\\n node 2 shard b \\n  \\n Last Modified:    about a minute ago\\nNum Docs:    158964\\nMax Doc:    158964\\nDeleted Docs:    0\\nVersion:    4479\\nSegment Count:    1\\n \\n  \\n\\n node 3 shard b \\n  \\n Last Modified:    2 minutes ago\\nNum Docs:    158298\\nMax Doc:    158298\\nDeleted Docs:    0\\nVersion:    2886\\n \\n  \\n\\n Size and versions are also different. Cluster is optimized\\/forceMerged but doesn\'t change the facts as expected. At least one other shard also has differences in its two replica\'s, i haven\'t manually checked the others.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13712300\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13712300&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13712300\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13712300_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13712300_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/13 13:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-18T13:17:28+0000\'\u003e18\\/Jul\\/13 13:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSee anything in the logs about zk expirations?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13712300_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13712300_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/13 13:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-18T13:17:28+0000\'\u003e18\\/Jul\\/13 13:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    See anything in the logs about zk expirations?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13712314\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13712314&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13712314\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13712314_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13712314_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/13 13:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-18T13:21:01+0000\'\u003e18\\/Jul\\/13 13:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve already restarted the job and enabled logging! It\'s going to take a while \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13712314_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13712314_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/13 13:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-18T13:21:01+0000\'\u003e18\\/Jul\\/13 13:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve already restarted the job and enabled logging! It\'s going to take a while                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13712400\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13712400&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13712400\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13712400_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13712400_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/13 15:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-18T15:12:07+0000\'\u003e18\\/Jul\\/13 15:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlright, nothing looks like zookeeper expirations i grepped expirations in the error log but there\'s nothing there. This indexing session did not produce so many inconsistencies as the previous one; there is only 1 shard of which one replica has 2 more documents. It won\'t fix itself.\u003c\\/p\u003e\\n\\n\u003cp\u003eDuring indexing there were, as usual, error such as autocommit causing a searcher too many and time outs talking to other nodes.\u003c\\/p\u003e\\n\\n\u003cp\u003eOnly 2 nodes report a Stopping Recovery For of which one node actually has a replica of the inconsistent core. The other shard is seems fine, both replica\'s have the same numDocs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13712400_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13712400_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jul\\/13 15:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-18T15:12:07+0000\'\u003e18\\/Jul\\/13 15:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Alright, nothing looks like zookeeper expirations i grepped expirations in the error log but there\'s nothing there. This indexing session did not produce so many inconsistencies as the previous one; there is only 1 shard of which one replica has 2 more documents. It won\'t fix itself. \\n\\n During indexing there were, as usual, error such as autocommit causing a searcher too many and time outs talking to other nodes. \\n\\n Only 2 nodes report a Stopping Recovery For of which one node actually has a replica of the inconsistent core. The other shard is seems fine, both replica\'s have the same numDocs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13813827\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13813827&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13813827\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13813827_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13813827_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Nov\\/13 10:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-05T10:31:33+0000\'\u003e05\\/Nov\\/13 10:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi, I hit this bug with solr 4.5.1\u003c\\/p\u003e\\n\\n\u003cp\u003ereplica 1:\u003c\\/p\u003e\\n\\n\u003cp\u003elastModified:20 minutes ago\u003cbr\\/\u003e\\nversion:80616\u003cbr\\/\u003e\\nnumDocs:6072661\u003cbr\\/\u003e\\nmaxDoc:6072841\u003cbr\\/\u003e\\ndeletedDocs:180\u003c\\/p\u003e\\n\\n\u003cp\u003ereplica 2 (leader)\u003c\\/p\u003e\\n\\n\u003cp\u003elastModified:20 minutes ago\u003cbr\\/\u003e\\nversion:77595\u003cbr\\/\u003e\\nnumDocs:6072575\u003cbr\\/\u003e\\nmaxDoc:6072771\u003cbr\\/\u003e\\ndeletedDocs:196\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t know when this happened, therefore I have no time frame to find in log valuable information on logs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13813827_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13813827_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Nov\\/13 10:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-05T10:31:33+0000\'\u003e05\\/Nov\\/13 10:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, I hit this bug with solr 4.5.1 \\n\\n replica 1: \\n\\n lastModified:20 minutes ago \\nversion:80616 \\nnumDocs:6072661 \\nmaxDoc:6072841 \\ndeletedDocs:180 \\n\\n replica 2 (leader) \\n\\n lastModified:20 minutes ago \\nversion:77595 \\nnumDocs:6072575 \\nmaxDoc:6072771 \\ndeletedDocs:196 \\n\\n I don\'t know when this happened, therefore I have no time frame to find in log valuable information on logs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13813850\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13813850&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13813850\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13813850_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13813850_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Nov\\/13 11:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-05T11:11:17+0000\'\u003e05\\/Nov\\/13 11:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yago Riveiro - 05\\/Nov\\/13 11:15\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI attached some screenshots\u003c\\/p\u003e\\n\\n\u003cp\u003eThe shard is the shard11:\u003c\\/p\u003e\\n\\n\u003cp\u003e1 - clusterstate: this screenshot shows replica2 192.168.20.104 as the leader\u003cbr\\/\u003e\\n2 - the replica 2 has lower gen that replica1 and is the leader, is this correct?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13813850_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13813850_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Nov\\/13 11:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-05T11:11:17+0000\'\u003e05\\/Nov\\/13 11:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yago Riveiro - 05\\/Nov\\/13 11:15\\\"\u003eedited\u003c\\/span\u003e                   I attached some screenshots \\n\\n The shard is the shard11: \\n\\n 1 - clusterstate: this screenshot shows replica2 192.168.20.104 as the leader \\n2 - the replica 2 has lower gen that replica1 and is the leader, is this correct?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13820205\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13820205&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13820205\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13820205_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13820205_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/13 15:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-12T15:53:46+0000\'\u003e12\\/Nov\\/13 15:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI can confirm as well that is issue still exists. Since yesterday one of a shard\'s replica has one document less than it should have. Solr doesn\'t notice this and makes no attempt in recovering this issue. Around the time when i noticed it first we were shutting down and restarting nodes, it\'s likely that at that time some documents got indexed as well. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13820205_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13820205_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/13 15:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-12T15:53:46+0000\'\u003e12\\/Nov\\/13 15:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I can confirm as well that is issue still exists. Since yesterday one of a shard\'s replica has one document less than it should have. Solr doesn\'t notice this and makes no attempt in recovering this issue. Around the time when i noticed it first we were shutting down and restarting nodes, it\'s likely that at that time some documents got indexed as well.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13821300\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13821300&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13821300\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13821300_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13821300_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/13 13:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-13T13:15:29+0000\'\u003e13\\/Nov\\/13 13:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYeah, I know that this can still happen - unfortunately, the debugging and testing required to make continued improvements requires a \u003cb\u003elot\u003c\\/b\u003e of time, so I don\'t personally know when I can work on hardening it. Currently, if shards eventually get out of whack, the best you can do is trigger a new recovery against the leader. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13821300_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13821300_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/13 13:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-13T13:15:29+0000\'\u003e13\\/Nov\\/13 13:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yeah, I know that this can still happen - unfortunately, the debugging and testing required to make continued improvements requires a  lot  of time, so I don\'t personally know when I can work on hardening it. Currently, if shards eventually get out of whack, the best you can do is trigger a new recovery against the leader.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13821304\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13821304&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13821304\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13821304_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13821304_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/13 13:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-13T13:21:58+0000\'\u003e13\\/Nov\\/13 13:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have done a bit of work on making it easier to turn on some debug logging that I use for this type of thing recently. I also have some specific local Jenkins jobs I run on dedicated hardware to help track down problems - I have been collecting a lot of logs over the last few weeks. There is a lot more that needs to be done though. I\'m hoping to start a wiki page on how I have gone about tracking this type of thing down in the past so that perhaps it\'s easier for others to get involved. Hopefully Yonik can add any of his useful tricks to that as well.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13821304_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13821304_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/13 13:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-13T13:21:58+0000\'\u003e13\\/Nov\\/13 13:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have done a bit of work on making it easier to turn on some debug logging that I use for this type of thing recently. I also have some specific local Jenkins jobs I run on dedicated hardware to help track down problems - I have been collecting a lot of logs over the last few weeks. There is a lot more that needs to be done though. I\'m hoping to start a wiki page on how I have gone about tracking this type of thing down in the past so that perhaps it\'s easier for others to get involved. Hopefully Yonik can add any of his useful tricks to that as well.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13821375\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13821375&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13821375\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13821375_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13821375_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/13 14:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-13T14:26:54+0000\'\u003e13\\/Nov\\/13 14:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003e Currently, if shards eventually get out of whack, the best you can do is trigger a new recovery against the leader.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhat happen when the leader is the shard with less docs? Is the replication done in the right way?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13821375_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13821375_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/13 14:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-13T14:26:54+0000\'\u003e13\\/Nov\\/13 14:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                      Currently, if shards eventually get out of whack, the best you can do is trigger a new recovery against the leader.  \\n\\n What happen when the leader is the shard with less docs? Is the replication done in the right way?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13821421\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13821421&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13821421\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13821421_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13821421_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/13 15:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-13T15:31:08+0000\'\u003e13\\/Nov\\/13 15:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhat happen when the leader is the shard with less docs? Is the replication done in the right way?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt really depends on how careful you are trying to be and what you can count on - you don\'t know if the leader is behind if deletes are involved. The safest thing to do is to stop the cluster and start it again - that triggers a process that tries to pick the most up to date replica and trades up to 100 updates or so among each other if some are on some replicas and not others.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you are sure the leader is simply behind, you can just bounce it and let a replica take over as leader.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13821421_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13821421_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/13 15:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-13T15:31:08+0000\'\u003e13\\/Nov\\/13 15:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     What happen when the leader is the shard with less docs? Is the replication done in the right way?  \\n\\n It really depends on how careful you are trying to be and what you can count on - you don\'t know if the leader is behind if deletes are involved. The safest thing to do is to stop the cluster and start it again - that triggers a process that tries to pick the most up to date replica and trades up to 100 updates or so among each other if some are on some replicas and not others. \\n\\n If you are sure the leader is simply behind, you can just bounce it and let a replica take over as leader.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823195\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823195&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823195\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13823195_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823195_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 01:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T01:36:30+0000\'\u003e15\\/Nov\\/13 01:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe\'re seeing the same thing, running v4.5.0.\u003c\\/p\u003e\\n\\n\u003cp\u003eMark, if you don\'t mind clarifying...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eThe safest thing to do is to stop the cluster and start it again - that triggers a process that tries to pick the most up to date replica and trades up to 100 updates or so among each other if some are on some replicas and not others.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWhat if the difference is greater than 100? Is there any other way to figure out who is the \\\"truth\\\" and force that state onto the other replicas by doing a full sync?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eIf you are sure the leader is simply behind, you can just bounce it and let a replica take over as leader.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eNewbie question: Why would the leader be behind? Aren\'t all updates sent to the leader first and then the leader distribute it to the replicas? Also, I was under the impression that this update call is synchronous, so once an update request returns successfully to the client, why would any replica be behind?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13823195_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823195_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 01:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T01:36:30+0000\'\u003e15\\/Nov\\/13 01:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We\'re seeing the same thing, running v4.5.0. \\n\\n Mark, if you don\'t mind clarifying... \\n\\n \\n The safest thing to do is to stop the cluster and start it again - that triggers a process that tries to pick the most up to date replica and trades up to 100 updates or so among each other if some are on some replicas and not others.  \\n What if the difference is greater than 100? Is there any other way to figure out who is the \\\"truth\\\" and force that state onto the other replicas by doing a full sync? \\n\\n \\n If you are sure the leader is simply behind, you can just bounce it and let a replica take over as leader.  \\n Newbie question: Why would the leader be behind? Aren\'t all updates sent to the leader first and then the leader distribute it to the replicas? Also, I was under the impression that this update call is synchronous, so once an update request returns successfully to the client, why would any replica be behind? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823517\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823517&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823517\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13823517_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823517_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 09:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T09:54:00+0000\'\u003e15\\/Nov\\/13 09:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJessica, \u003c\\/p\u003e\\n\\n\u003cp\u003eIn some point of the process the leader can be downgraded to replica, the other replica whit less document will become the leader, in this case, the older leader (after the recovery) can be updated as usual and you get the leader behind the replica if the recovery doesn\'t fix the desviation.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13823517_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823517_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 09:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T09:54:00+0000\'\u003e15\\/Nov\\/13 09:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Jessica,  \\n\\n In some point of the process the leader can be downgraded to replica, the other replica whit less document will become the leader, in this case, the older leader (after the recovery) can be updated as usual and you get the leader behind the replica if the recovery doesn\'t fix the desviation.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823652\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823652&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823652\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823652_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823652_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 13:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T13:27:57+0000\'\u003e15\\/Nov\\/13 13:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhat if the difference is greater than 100? Is there any other way to figure out who is the \\\"truth\\\" and force that state onto the other replicas by doing a full sync?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat is basically what should happen - everyone in the leader line will \\\"try\\\" and become the leader by trying to peer sync with everyone else - either they will be ahead of everyone else and the sync will succeed or they will be behind by less than 100 updates and trade and the sync will succeed. If the sync fails, the next guy in line tries. Eventually the most up to date guy should succeed and he forces everyone else to match him. That is the idea anyway.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eNewbie question: Why would the leader be behind? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eZooKeeper session timeouts (due to load, gc, whatever) can cause the leader to be bumped.\u003c\\/p\u003e\\n\\n\u003cp\u003eYou mainly only expect this stuff to happen if nodes go down (and perhaps come back) or session expirations.\u003c\\/p\u003e\\n\\n\u003cp\u003eUnfortunately, for a while between 4.4 and 4.5, a couple of our important tests stopped working and I think a couple problems were introduced. I hope to have more time to look into it soon.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823652_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823652_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 13:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T13:27:57+0000\'\u003e15\\/Nov\\/13 13:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     What if the difference is greater than 100? Is there any other way to figure out who is the \\\"truth\\\" and force that state onto the other replicas by doing a full sync?  \\n\\n That is basically what should happen - everyone in the leader line will \\\"try\\\" and become the leader by trying to peer sync with everyone else - either they will be ahead of everyone else and the sync will succeed or they will be behind by less than 100 updates and trade and the sync will succeed. If the sync fails, the next guy in line tries. Eventually the most up to date guy should succeed and he forces everyone else to match him. That is the idea anyway. \\n\\n  Newbie question: Why would the leader be behind?   \\n\\n ZooKeeper session timeouts (due to load, gc, whatever) can cause the leader to be bumped. \\n\\n You mainly only expect this stuff to happen if nodes go down (and perhaps come back) or session expirations. \\n\\n Unfortunately, for a while between 4.4 and 4.5, a couple of our important tests stopped working and I think a couple problems were introduced. I hope to have more time to look into it soon.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823834\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823834&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823834\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13823834_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823834_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 17:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T17:31:08+0000\'\u003e15\\/Nov\\/13 17:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Yago and Mark. I really appreciate you guys spending time to answer my questions--it\'s definitely helping me understand more.\u003c\\/p\u003e\\n\\n\u003cp\u003eI understand how leader roles can change, but not how replicas can be behind--I thought the updates are synchronously distributed (i.e. solrj\'s request doesn\'t return successfully until an update has been distributed to all replicas). Is this not the case?\u003c\\/p\u003e\\n\\n\u003cp\u003eIf any replica can fall behind, and it can be elected leader without having caught up, wouldn\'t we possibly end up in the following situation (where let\'s pretend docs are represented by monotonically increasing numbers):\u003c\\/p\u003e\\n\\n\u003cp\u003eOld Leader: 1 2 3 4 5 (GC)\u003cbr\\/\u003e\\nNew Leader:  1 2 3 .. (elected) 6 7\u003c\\/p\u003e\\n\\n\u003cp\u003eIn this case, who\'s considered the most up-to-date guy? Would they figure out among themselves that Old Leader is missing 6 7 but the New Leader is missing 4 5? If so, how do they do the right \\\"merge\\\" if the difference is greater than 100 and they have to resort to full sync?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13823834_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823834_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 17:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T17:31:08+0000\'\u003e15\\/Nov\\/13 17:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Yago and Mark. I really appreciate you guys spending time to answer my questions--it\'s definitely helping me understand more. \\n\\n I understand how leader roles can change, but not how replicas can be behind--I thought the updates are synchronously distributed (i.e. solrj\'s request doesn\'t return successfully until an update has been distributed to all replicas). Is this not the case? \\n\\n If any replica can fall behind, and it can be elected leader without having caught up, wouldn\'t we possibly end up in the following situation (where let\'s pretend docs are represented by monotonically increasing numbers): \\n\\n Old Leader: 1 2 3 4 5 (GC) \\nNew Leader:  1 2 3 .. (elected) 6 7 \\n\\n In this case, who\'s considered the most up-to-date guy? Would they figure out among themselves that Old Leader is missing 6 7 but the New Leader is missing 4 5? If so, how do they do the right \\\"merge\\\" if the difference is greater than 100 and they have to resort to full sync?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823867\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823867&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823867\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13823867_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823867_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:00:07+0000\'\u003e15\\/Nov\\/13 18:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI thought the updates are synchronously distributed\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMy knowledge about how replication is done is very limited, for me replication is a distributed HTTP requests to all replicas, if all responses return the code 200, then the insertion was successful. I don\'t know if internally the 200 is returned when the document is written on tlog or in the open segment.\u003c\\/p\u003e\\n\\n\u003cp\u003eUp-to-date in this case is none, you have your data compromised, you can\'t guarantee wich is the correct replica, the logic could be pick the replica with more docs and make a new replica using it, but still can know without check one by one if you have all data. An extreme case can be do a full reindex of the data (if you can).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13823867_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823867_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:00:07+0000\'\u003e15\\/Nov\\/13 18:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I thought the updates are synchronously distributed  \\n\\n My knowledge about how replication is done is very limited, for me replication is a distributed HTTP requests to all replicas, if all responses return the code 200, then the insertion was successful. I don\'t know if internally the 200 is returned when the document is written on tlog or in the open segment. \\n\\n Up-to-date in this case is none, you have your data compromised, you can\'t guarantee wich is the correct replica, the logic could be pick the replica with more docs and make a new replica using it, but still can know without check one by one if you have all data. An extreme case can be do a full reindex of the data (if you can).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823871\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823871&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823871\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823871_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823871_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:01:50+0000\'\u003e15\\/Nov\\/13 18:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI understand how leader roles can change, but not how replicas can be behind--I thought the updates are synchronously distributed (i.e. solrj\'s request doesn\'t return successfully until an update has been distributed to all replicas). Is this not the case?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThey could get behind because of a bug generally \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823871_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823871_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:01:50+0000\'\u003e15\\/Nov\\/13 18:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I understand how leader roles can change, but not how replicas can be behind--I thought the updates are synchronously distributed (i.e. solrj\'s request doesn\'t return successfully until an update has been distributed to all replicas). Is this not the case?  \\n\\n They could get behind because of a bug generally   \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823887\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823887&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823887\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13823887_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823887_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:12:39+0000\'\u003e15\\/Nov\\/13 18:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMark, \u003c\\/p\u003e\\n\\n\u003cp\u003eI can confirm that I had session expirations in my logs in some point of time. My index rate is high and some times my boxes are under some \\\"pressure\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eMy problem is that I don\'t know how deal with the situation. I\'m using a non java client and I don\'t know how I can do debug or the tools that I can use to give some information to help debug this issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13823887_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823887_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:12:39+0000\'\u003e15\\/Nov\\/13 18:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mark,  \\n\\n I can confirm that I had session expirations in my logs in some point of time. My index rate is high and some times my boxes are under some \\\"pressure\\\". \\n\\n My problem is that I don\'t know how deal with the situation. I\'m using a non java client and I don\'t know how I can do debug or the tools that I can use to give some information to help debug this issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823894\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823894&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823894\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13823894_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823894_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:16:33+0000\'\u003e15\\/Nov\\/13 18:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eThey could get behind because of a bug generally \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI see, so as designed, the scenario I described shouldn\'t really happen, because New Leader wouldn\'t have been missing 4 5?\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW, for our case, turns out the version numbers across the replicas matched even though numDocs didn\'t. That seems to suggest that there\\u2019s at least an issue somewhere in the replication flow where it\\u2019s possible to update the version but not have the matching documents. Not sure if this is a useful piece of information to you but thought I\'d mention.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13823894_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823894_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:16:33+0000\'\u003e15\\/Nov\\/13 18:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n They could get behind because of a bug generally   \\n\\n I see, so as designed, the scenario I described shouldn\'t really happen, because New Leader wouldn\'t have been missing 4 5? \\n\\n BTW, for our case, turns out the version numbers across the replicas matched even though numDocs didn\'t. That seems to suggest that there\\u2019s at least an issue somewhere in the replication flow where it\\u2019s possible to update the version but not have the matching documents. Not sure if this is a useful piece of information to you but thought I\'d mention.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823905\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823905&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823905\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823905_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823905_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:24:41+0000\'\u003e15\\/Nov\\/13 18:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think of two failure scenarios:\u003c\\/p\u003e\\n\\n\u003cp\u003e1. A replica goes down. Design solution: it comes back and uses peer sync or replication to catch up.\u003c\\/p\u003e\\n\\n\u003cp\u003e2. A leader goes down. It might have been in the middle of sending updates and somehow a couple didn\'t make it to a replica. Design solution: that leader peer sync dance I talk about above.\u003c\\/p\u003e\\n\\n\u003cp\u003eBasically, no one should ever be behind by more than 100 docs (a leader sends updates to replicas in parallel), and new leaders should always end up up to date. Obviously a bit more hardening to do though. Could also use more targeted testing - we count  a lot on the chaosmonkey tests for this (those are the tests that stopped working correctly for a while).\u003c\\/p\u003e\\n\\n\u003cp\u003eA wrinkle is that zookeeper session timeouts also trigger the same thing as if the node had died - it comes back when the session is reestablished.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823905_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823905_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:24:41+0000\'\u003e15\\/Nov\\/13 18:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think of two failure scenarios: \\n\\n 1. A replica goes down. Design solution: it comes back and uses peer sync or replication to catch up. \\n\\n 2. A leader goes down. It might have been in the middle of sending updates and somehow a couple didn\'t make it to a replica. Design solution: that leader peer sync dance I talk about above. \\n\\n Basically, no one should ever be behind by more than 100 docs (a leader sends updates to replicas in parallel), and new leaders should always end up up to date. Obviously a bit more hardening to do though. Could also use more targeted testing - we count  a lot on the chaosmonkey tests for this (those are the tests that stopped working correctly for a while). \\n\\n A wrinkle is that zookeeper session timeouts also trigger the same thing as if the node had died - it comes back when the session is reestablished.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823922\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823922&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823922\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823922_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823922_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:40:11+0000\'\u003e15\\/Nov\\/13 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eBasically, no one should ever be behind by more than 100 docs\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOf course if they are over 100 updates behind, they won\'t successfully sync and become leader, someone else will, and the behind node will be asked to catch up to the leader via replication.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823922_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823922_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T18:40:11+0000\'\u003e15\\/Nov\\/13 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Basically, no one should ever be behind by more than 100 docs  \\n\\n Of course if they are over 100 updates behind, they won\'t successfully sync and become leader, someone else will, and the behind node will be asked to catch up to the leader via replication.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823959\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13823959&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823959\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823959_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823959_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 19:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T19:07:27+0000\'\u003e15\\/Nov\\/13 19:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eMy problem is that I don\'t know how deal with the situation. I\'m using a non java client and I don\'t know how I can do debug or the tools that I can use to give some information to help debug this issue.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m hoping to put together a guide on debugging some of the tests for this sort of thing soon. Perhaps some of that will also be useful for debugging a live installation. I sure could use the help - I have a lot on my plate at the moment. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13823959_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823959_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 19:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T19:07:27+0000\'\u003e15\\/Nov\\/13 19:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     My problem is that I don\'t know how deal with the situation. I\'m using a non java client and I don\'t know how I can do debug or the tools that I can use to give some information to help debug this issue.  \\n\\n I\'m hoping to put together a guide on debugging some of the tests for this sort of thing soon. Perhaps some of that will also be useful for debugging a live installation. I sure could use the help - I have a lot on my plate at the moment.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13824270\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13824270&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13824270\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13824270_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824270_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/13 00:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-16T00:25:41+0000\'\u003e16\\/Nov\\/13 00:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooking at the code a bit, I realized that the scenario I described can in fact happen if the Old Leader dies (or somehow becomes unreachable, for example due to tripping the kernel SYN flood detection, as ours did), because looks like during runLeaderProcess(), the sync that\'s run is called with cantReachIsSuccess=true. Since the New Leader can\'t reach Old Leader, it won\'t find out about 4 5 (assuming no other replicas have it either), but will successfully \\\"sync\\\" and become the new leader. This can be remedied if the \\\"\\/\\/ TODO: optionally fail if n replicas are not reached...\\\" on DistributedUpdateProcessor.doFinish() is implemented so that at least another replica must have 4 5 before the request would have been ack\'d to the user, but of course if New Leader can\'t reach this other replica either then it\'s not much help.\u003c\\/p\u003e\\n\\n\u003cp\u003eI feel like in general the code may be trying too hard to find a new leader to take over, thereby compromising data consistency. This is probably the right thing to do for many, if not most, search solutions. However, if Solr is indeed moving toward being a possible NoSql solution or for use cases where reindexing the entire corpus is extremely expensive, then maybe a more consistent mode can be implemented where user can choose to trade availability for consistency.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13824270_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824270_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/13 00:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-16T00:25:41+0000\'\u003e16\\/Nov\\/13 00:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looking at the code a bit, I realized that the scenario I described can in fact happen if the Old Leader dies (or somehow becomes unreachable, for example due to tripping the kernel SYN flood detection, as ours did), because looks like during runLeaderProcess(), the sync that\'s run is called with cantReachIsSuccess=true. Since the New Leader can\'t reach Old Leader, it won\'t find out about 4 5 (assuming no other replicas have it either), but will successfully \\\"sync\\\" and become the new leader. This can be remedied if the \\\"\\/\\/ TODO: optionally fail if n replicas are not reached...\\\" on DistributedUpdateProcessor.doFinish() is implemented so that at least another replica must have 4 5 before the request would have been ack\'d to the user, but of course if New Leader can\'t reach this other replica either then it\'s not much help. \\n\\n I feel like in general the code may be trying too hard to find a new leader to take over, thereby compromising data consistency. This is probably the right thing to do for many, if not most, search solutions. However, if Solr is indeed moving toward being a possible NoSql solution or for use cases where reindexing the entire corpus is extremely expensive, then maybe a more consistent mode can be implemented where user can choose to trade availability for consistency.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13824284\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13824284&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13824284\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13824284_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824284_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/13 00:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-16T00:44:07+0000\'\u003e16\\/Nov\\/13 00:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eSince the New Leader can\'t reach Old Leader, it won\'t find out about 4 5 (assuming no other replicas have it either)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis shouldn\'t be the case, because those updates will only have been ack\'d if each replica received them. And if they were not ack\'d a success, we don\'t care if we keep them - we just want to get consistent.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI feel like in general the code may be trying too hard to find a new leader to take over\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eA further protection is that a node will not become leader unless it\'s last state was active.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not convinced it\'s too loose - I do know that the impl could use additional love and tests.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13824284_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824284_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/13 00:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-16T00:44:07+0000\'\u003e16\\/Nov\\/13 00:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Since the New Leader can\'t reach Old Leader, it won\'t find out about 4 5 (assuming no other replicas have it either)  \\n\\n This shouldn\'t be the case, because those updates will only have been ack\'d if each replica received them. And if they were not ack\'d a success, we don\'t care if we keep them - we just want to get consistent. \\n\\n  I feel like in general the code may be trying too hard to find a new leader to take over  \\n\\n A further protection is that a node will not become leader unless it\'s last state was active. \\n\\n I\'m not convinced it\'s too loose - I do know that the impl could use additional love and tests.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13824295\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13824295&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13824295\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13824295_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824295_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/13 00:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-16T00:56:07+0000\'\u003e16\\/Nov\\/13 00:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eThis shouldn\'t be the case, because those updates will only have been ack\'d if each replica received them.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s what I thought too, but doesn\'t seem to be the case in the code. If you take a look at DistributedUpdateProcessor.doFinish(),\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003e    \\/\\/ if its a forward, any fail is a problem - \u003cbr\\/\u003e\\n    \\/\\/ otherwise we assume things are fine if we got it locally\u003cbr\\/\u003e\\n    \\/\\/ until we start allowing min replication param\u003cbr\\/\u003e\\n    if (errors.size() &gt; 0) {\u003cbr\\/\u003e\\n      \\/\\/ if one node is a RetryNode, this was a forward request\u003cbr\\/\u003e\\n      if (errors.get(0).req.node instanceof RetryNode) \u003c\\/p\u003e\\n\u003cdiv class=\\\"error\\\"\u003e\u003cspan class=\\\"error\\\"\u003eUnknown macro: {        rsp.setException(errors.get(0).e);      }\u003c\\/span\u003e \u003c\\/div\u003e\\n\u003cp\u003e      \\/\\/ else\u003cbr\\/\u003e\\n      \\/\\/ for now we don\'t error - we assume if it was added locally, we\u003cbr\\/\u003e\\n      \\/\\/ succeeded \u003cbr\\/\u003e\\n    }\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt then starts a thread to urge the replica to recover, but if that fails, it just completely gives up.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mewmewball\\\" id=\\\"commentauthor_13824295_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mewmewball\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mewmewball\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jessica Cheng Mallet\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824295_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/13 00:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-16T00:56:07+0000\'\u003e16\\/Nov\\/13 00:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n This shouldn\'t be the case, because those updates will only have been ack\'d if each replica received them.  \\n\\n That\'s what I thought too, but doesn\'t seem to be the case in the code. If you take a look at DistributedUpdateProcessor.doFinish(), \\n\\n \\n     \\/\\/ if its a forward, any fail is a problem -  \\n    \\/\\/ otherwise we assume things are fine if we got it locally \\n    \\/\\/ until we start allowing min replication param \\n    if (errors.size() &gt; 0) { \\n      \\/\\/ if one node is a RetryNode, this was a forward request \\n      if (errors.get(0).req.node instanceof RetryNode)  \\n  Unknown macro: {        rsp.setException(errors.get(0).e);      }   \\n       \\/\\/ else \\n      \\/\\/ for now we don\'t error - we assume if it was added locally, we \\n      \\/\\/ succeeded  \\n    }  \\n\\n It then starts a thread to urge the replica to recover, but if that fails, it just completely gives up.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13824299\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13824299&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13824299\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13824299_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824299_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/13 01:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-16T01:01:59+0000\'\u003e16\\/Nov\\/13 01:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRight - but that\'s just impl, not design. The idea is that, since we add locally first, there is not much reason it should fail on a replica - unless that replica has crashed or lost connectivity or something really bad. In that case, it will have to reconnect to zk and recover or restart and recover. Just in case, as a precaution, we try and tell it to recover - then if it\'s still got connectivity or it was an intermittent problem, it won\'t run around acting active. I think I have a note about perhaps doing more retries in background threads for that recovery request, but I\'ve never gotten to it.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you are finding a scenario that eludes that, we should strengthen the impl.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13824299_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824299_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/13 01:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-16T01:01:59+0000\'\u003e16\\/Nov\\/13 01:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Right - but that\'s just impl, not design. The idea is that, since we add locally first, there is not much reason it should fail on a replica - unless that replica has crashed or lost connectivity or something really bad. In that case, it will have to reconnect to zk and recover or restart and recover. Just in case, as a precaution, we try and tell it to recover - then if it\'s still got connectivity or it was an intermittent problem, it won\'t run around acting active. I think I have a note about perhaps doing more retries in background threads for that recovery request, but I\'ve never gotten to it. \\n\\n If you are finding a scenario that eludes that, we should strengthen the impl.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13824921\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13824921&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13824921\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13824921_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824921_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Nov\\/13 18:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-17T18:20:11+0000\'\u003e17\\/Nov\\/13 18:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis could be related to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5397\\\" title=\\\"Replication can fail silently in some cases.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5397\\\"\u003e\u003cdel\u003eSOLR-5397\u003c\\/del\u003e\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13824921_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13824921_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Nov\\/13 18:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-17T18:20:11+0000\'\u003e17\\/Nov\\/13 18:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This could be related to   SOLR-5397                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13825107\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13825107&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13825107\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13825107_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13825107_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/13 04:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-18T04:38:04+0000\'\u003e18\\/Nov\\/13 04:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWould love if you guys could try with 4.6 and report back. \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5397\\\" title=\\\"Replication can fail silently in some cases.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5397\\\"\u003e\u003cdel\u003eSOLR-5397\u003c\\/del\u003e\u003c\\/a\u003e was introduced when we fixed a similar issue, so that has really been an issue for a few releases.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13825107_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13825107_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/13 04:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-18T04:38:04+0000\'\u003e18\\/Nov\\/13 04:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Would love if you guys could try with 4.6 and report back.   SOLR-5397   was introduced when we fixed a similar issue, so that has really been an issue for a few releases. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13826350\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13826350&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13826350\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13826350_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826350_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 09:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T09:45:28+0000\'\u003e19\\/Nov\\/13 09:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI updated our machines to include \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5397\\\" title=\\\"Replication can fail silently in some cases.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5397\\\"\u003e\u003cdel\u003eSOLR-5397\u003c\\/del\u003e\u003c\\/a\u003e. Everything works fine now, it may take quite some time before we can say it is fixed \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13826350_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826350_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 09:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T09:45:28+0000\'\u003e19\\/Nov\\/13 09:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I updated our machines to include   SOLR-5397  . Everything works fine now, it may take quite some time before we can say it is fixed                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13826356\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13826356&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13826356\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13826356_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826356_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 10:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T10:00:20+0000\'\u003e19\\/Nov\\/13 10:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt\'s safe upgrade from 4.5.1 to 4.6?. I have docValues and I read that it\'s not linear upgraded and I can\'t reindex the data.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13826356_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826356_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 10:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T10:00:20+0000\'\u003e19\\/Nov\\/13 10:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It\'s safe upgrade from 4.5.1 to 4.6?. I have docValues and I read that it\'s not linear upgraded and I can\'t reindex the data.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13826529\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13826529&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13826529\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13826529_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826529_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 13:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T13:58:53+0000\'\u003e19\\/Nov\\/13 13:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAccording to the wiki, it depends on the doc values impl you are using - the default one will upgrade fine. Others require that you forceMerge your index to rewrite it with the default and then upgrade, then I guess you can forceMerge back to that impl. Honestly, I have not had a chance to play with doc values yet though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13826529_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826529_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 13:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T13:58:53+0000\'\u003e19\\/Nov\\/13 13:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    According to the wiki, it depends on the doc values impl you are using - the default one will upgrade fine. Others require that you forceMerge your index to rewrite it with the default and then upgrade, then I guess you can forceMerge back to that impl. Honestly, I have not had a chance to play with doc values yet though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13826533\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13826533&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13826533\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13826533_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826533_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 14:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T14:10:55+0000\'\u003e19\\/Nov\\/13 14:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m using  &lt;codecFactory class=\\\"solr.SchemaCodecFactory\\\"\\/&gt; to enable per-field DocValues formats.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think that this aspect about docValues it doesn\'t  explained on wiki in a proper way. There is no example how we can do the switch to default, do the forceMerge and switch back to the original implementation.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf I can\'t have the security that all will work fine,  I can\'t do the upgrade.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13826533_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826533_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 14:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T14:10:55+0000\'\u003e19\\/Nov\\/13 14:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m using  &lt;codecFactory class=\\\"solr.SchemaCodecFactory\\\"\\/&gt; to enable per-field DocValues formats. \\n\\n I think that this aspect about docValues it doesn\'t  explained on wiki in a proper way. There is no example how we can do the switch to default, do the forceMerge and switch back to the original implementation. \\n\\n If I can\'t have the security that all will work fine,  I can\'t do the upgrade.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13826535\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13826535&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13826535\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13826535_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826535_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 14:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T14:15:11+0000\'\u003e19\\/Nov\\/13 14:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eShould probably bring it up on the user list - we need someone like \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\" class=\\\"user-hover\\\" rel=\\\"rcmuir\\\"\u003eRobert Muir\u003c\\/a\u003e to weigh in. I assume it all works the same way - you merge each field to the default impl and then back to what they were.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13826535_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13826535_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/13 14:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-19T14:15:11+0000\'\u003e19\\/Nov\\/13 14:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Should probably bring it up on the user list - we need someone like  Robert Muir  to weigh in. I assume it all works the same way - you merge each field to the default impl and then back to what they were.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13834760\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13834760&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13834760\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13834760_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13834760_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/13 11:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-28T11:58:59+0000\'\u003e28\\/Nov\\/13 11:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve got some bad news, it happened again on one of our clusters using a build of november 19th.Three replica\'s went out of sync.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13834760_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13834760_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/13 11:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-28T11:58:59+0000\'\u003e28\\/Nov\\/13 11:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve got some bad news, it happened again on one of our clusters using a build of november 19th.Three replica\'s went out of sync.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13835368\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13835368&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13835368\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gro\\\" id=\\\"commentauthor_13835368_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rafa\\u0142 Ku\\u0107\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13835368_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Nov\\/13 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-29T13:40:24+0000\'\u003e29\\/Nov\\/13 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHappened to me two, collection with two four shards, each having a single replica. The replicas were our of sync.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gro\\\" id=\\\"commentauthor_13835368_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rafa\\u0142 Ku\\u0107\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13835368_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Nov\\/13 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-29T13:40:24+0000\'\u003e29\\/Nov\\/13 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Happened to me two, collection with two four shards, each having a single replica. The replicas were our of sync.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13835436\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13835436&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13835436\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13835436_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13835436_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Nov\\/13 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-29T16:21:17+0000\'\u003e29\\/Nov\\/13 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat\'s the exact version \\/ checkout?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13835436_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13835436_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Nov\\/13 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-29T16:21:17+0000\'\u003e29\\/Nov\\/13 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What\'s the exact version \\/ checkout?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13835883\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13835883&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13835883\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13835883_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13835883_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/13 22:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-30T22:00:52+0000\'\u003e30\\/Nov\\/13 22:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\" class=\\\"user-hover\\\" rel=\\\"markus17\\\"\u003eMarkus Jelsma\u003c\\/a\u003e, hopefully that\'s \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5516\\\" title=\\\"ChaosMonkeyNothingIsSafeTest rare inconsistency fails.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5516\\\"\u003eSOLR-5516\u003c\\/a\u003e then.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13835883_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13835883_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/13 22:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-30T22:00:52+0000\'\u003e30\\/Nov\\/13 22:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Markus Jelsma , hopefully that\'s  SOLR-5516  then.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13836414\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13836414&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13836414\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13836414_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13836414_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Dec\\/13 10:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-02T10:54:10+0000\'\u003e02\\/Dec\\/13 10:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll check it out!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13836414_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13836414_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Dec\\/13 10:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-02T10:54:10+0000\'\u003e02\\/Dec\\/13 10:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll check it out!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13841162\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13841162&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13841162\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13841162_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13841162_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/13 10:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-06T10:42:00+0000\'\u003e06\\/Dec\\/13 10:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m sorry, i\'ve got three replica\'s having one document less than the leader. We\'re on a december, 3th build.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13841162_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13841162_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/13 10:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-06T10:42:00+0000\'\u003e06\\/Dec\\/13 10:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m sorry, i\'ve got three replica\'s having one document less than the leader. We\'re on a december, 3th build.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13841870\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13841870&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13841870\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13841870_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13841870_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/13 23:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-06T23:16:42+0000\'\u003e06\\/Dec\\/13 23:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eReplicas are still losing docs in Solr 4.6 \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m wondering if we can\'t have a pair (version, numDocs) to track the increments of docs between versions. Also we can save the last 10 tlogs in each replica as backups after be commited and make a diff to see what is missing in case the replicas are out of sync, replay the transaction and avoid a not synchronized replica and a full-recovery that probably will be heaviest that make the diff.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s only and idea and of course find the bug must be the priority.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis issue compromisse Solr to be \\\"the main\\\" storage. If re-index data is not possible, we can\'t guarantee that no data is missing,  and worse, we lost the data forever \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yriveiro\\\" id=\\\"commentauthor_13841870_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yriveiro\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yriveiro\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yago Riveiro\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13841870_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/13 23:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-06T23:16:42+0000\'\u003e06\\/Dec\\/13 23:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Replicas are still losing docs in Solr 4.6  . \\n\\n I\'m wondering if we can\'t have a pair (version, numDocs) to track the increments of docs between versions. Also we can save the last 10 tlogs in each replica as backups after be commited and make a diff to see what is missing in case the replicas are out of sync, replay the transaction and avoid a not synchronized replica and a full-recovery that probably will be heaviest that make the diff. \\n\\n It\'s only and idea and of course find the bug must be the priority. \\n\\n This issue compromisse Solr to be \\\"the main\\\" storage. If re-index data is not possible, we can\'t guarantee that no data is missing,  and worse, we lost the data forever  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13841896\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13841896&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13841896\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13841896_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13841896_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/13 23:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-06T23:37:14+0000\'\u003e06\\/Dec\\/13 23:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve fixed some things since 4.6 - I only had time to focus on the leader not going down case for 4.6, I spent a bunch more time on this case after 4.6 was released. Unfortunately, I think there are a couple of issues at play here - some of the new changes makes existing holes easier to spot and the chaos monkey tests where accidentally disabled for some time, so small issues may have crept in.\u003c\\/p\u003e\\n\\n\u003cp\u003eI \u003cb\u003ethink\u003c\\/b\u003e the remaining issue is mostly around \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5516\\\" title=\\\"ChaosMonkeyNothingIsSafeTest rare inconsistency fails.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5516\\\"\u003eSOLR-5516\u003c\\/a\u003e. Need to come up with a better idea than a really long wait though - but if someone wants to help test, putting in a long wait and stressing this would be useful to see if it is indeed the main remaining issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eI recently put in a lot of time improving the situation and I need to focus on other things for a bit, but that I\'ll keep coming back to this as I can.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13841896_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13841896_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/13 23:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-06T23:37:14+0000\'\u003e06\\/Dec\\/13 23:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve fixed some things since 4.6 - I only had time to focus on the leader not going down case for 4.6, I spent a bunch more time on this case after 4.6 was released. Unfortunately, I think there are a couple of issues at play here - some of the new changes makes existing holes easier to spot and the chaos monkey tests where accidentally disabled for some time, so small issues may have crept in. \\n\\n I  think  the remaining issue is mostly around  SOLR-5516 . Need to come up with a better idea than a really long wait though - but if someone wants to help test, putting in a long wait and stressing this would be useful to see if it is indeed the main remaining issue. \\n\\n I recently put in a lot of time improving the situation and I need to focus on other things for a bit, but that I\'ll keep coming back to this as I can.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13845459\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13845459&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13845459\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13845459_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13845459_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/13 14:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-11T14:58:46+0000\'\u003e11\\/Dec\\/13 14:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have some cycles to work on this issue over the next couple of days. I\'m starting by trying to reproduce it in my environment. Please let me know of any tasks that I can help out on (beyond the long wait stuff you mentioned above). \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13845459_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13845459_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/13 14:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-11T14:58:46+0000\'\u003e11\\/Dec\\/13 14:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have some cycles to work on this issue over the next couple of days. I\'m starting by trying to reproduce it in my environment. Please let me know of any tasks that I can help out on (beyond the long wait stuff you mentioned above).               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13845847\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13845847&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13845847\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13845847_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13845847_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/13 23:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-11T23:35:00+0000\'\u003e11\\/Dec\\/13 23:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t have fix yet, but I wanted to post an update here to get some feedback on what I\'m seeing ...\u003c\\/p\u003e\\n\\n\u003cp\u003eI have a simple SolrCloud configuration setup locally: 1 collection named \\\"cloud\\\" with 1 shard and replicationFactor 2, i.e. here\'s what I use to create it:\u003cbr\\/\u003e\\ncurl \\\"http:\\/\\/localhost:8984\\/solr\\/admin\\/collections?action=CREATE&amp;name=cloud&amp;replicationFactor=$REPFACT&amp;numShards=1&amp;collection.configName=cloud\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eThe collection gets distributed on two nodes: cloud84:8984 and cloud85:8985 with cloud84 being assigned the leader.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s an outline of the process I used to get my collection out-of-sync during indexing:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) start indexing docs using CloudSolrServer in SolrJ - direct updates go to the leader and replica remains in sync for as long as I let this process run\u003cbr\\/\u003e\\n2) kill -9 the process for the replica cloud85\u003cbr\\/\u003e\\n3) let indexing continue against cloud84 for a few seconds (just to get the leader and replica out-of-sync once I bring the replica back online)\u003cbr\\/\u003e\\n4) kill -9 the process for the leader cloud84 ... indexing halts of course as there are no running servers\u003cbr\\/\u003e\\n5) start the replica cloud85 but do not start the previous leader cloud84\u003c\\/p\u003e\\n\\n\u003cp\u003eHere are some key log messages as cloud85 - the replica - fires up ... my annotations of the log messages are prefixed by [TJP &gt;&gt;\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-11 11:43:22,076 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ZkStateReader  - A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/clusterstate.json, has occurred - updating... (live nodes size: 1)\u003cbr\\/\u003e\\n2013-12-11 11:43:23,370 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.cloud.ShardLeaderElectionContext  - Waiting until we see more replicas up for shard shard1: total=2 found=1 timeoutin=139841\u003c\\/p\u003e\\n\\n\u003cp\u003e[TJP &gt;&gt; This looks good and is expected because cloud85 was not the leader before it died, so it should not immediately assume it is the leader until it sees more replicas\u003c\\/p\u003e\\n\\n\u003cp\u003e6) now start the previous leader cloud84 ...\u003c\\/p\u003e\\n\\n\u003cp\u003eHere are some key log messages from cloud85 as the previous leader cloud84 is coming up ... \u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-11 11:43:24,085 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ZkStateReader  - Updating live nodes... (2)\u003cbr\\/\u003e\\n2013-12-11 11:43:24,136 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  solr.cloud.DistributedQueue  - LatchChildWatcher fired on path: \\/overseer\\/queue state: SyncConnected type NodeChildrenChanged\u003cbr\\/\u003e\\n2013-12-11 11:43:24,137 \u003cspan class=\\\"error\\\"\u003e&#91;Thread-13&#93;\u003c\\/span\u003e INFO  common.cloud.ZkStateReader  - Updating cloud state from ZooKeeper... \u003cbr\\/\u003e\\n2013-12-11 11:43:24,138 \u003cspan class=\\\"error\\\"\u003e&#91;Thread-13&#93;\u003c\\/span\u003e INFO  solr.cloud.Overseer  - Update state numShards=1 message=\u003c\\/p\u003e\\n{\\n  \\\"operation\\\":\\\"state\\\",\\n  \\\"state\\\":\\\"down\\\",\\n  \\\"base_url\\\":\\\"http:\\/\\/cloud84:8984\\/solr\\\",\\n  \\\"core\\\":\\\"cloud_shard1_replica2\\\",\\n  \\\"roles\\\":null,\\n  \\\"node_name\\\":\\\"cloud84:8984_solr\\\",\\n  \\\"shard\\\":\\\"shard1\\\",\\n  \\\"shard_range\\\":null,\\n  \\\"shard_state\\\":\\\"active\\\",\\n  \\\"shard_parent\\\":null,\\n  \\\"collection\\\":\\\"cloud\\\",\\n  \\\"numShards\\\":\\\"1\\\",\\n  \\\"core_node_name\\\":\\\"core_node1\\\"}\\n\\n\u003cp\u003e[TJP &gt;&gt; state of cloud84 looks correct as it is still initializing ...\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-11 11:43:24,140 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  solr.cloud.DistributedQueue  - LatchChildWatcher fired on path: \\/overseer\\/queue state: SyncConnected type NodeChildrenChanged\u003cbr\\/\u003e\\n2013-12-11 11:43:24,141 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ZkStateReader  - A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/clusterstate.json, has occurred - updating... (live nodes size: 2)\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-11 11:43:25,878 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.cloud.ShardLeaderElectionContext  - Enough replicas found to continue.\u003c\\/p\u003e\\n\\n\u003cp\u003e[TJP &gt;&gt; hmmmm ... cloud84 is listed in \\/live_nodes but it isn\'t \\\"active\\\" yet or even recovering (see state above - it\'s currently \\\"down\\\") ... My thinking here is that the ShardLeaderElectionContext needs to take the state of the replica into account before deciding it should continue.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e2013-12-11 11:43:25,878 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.cloud.ShardLeaderElectionContext  - I may be the new leader - try and sync\u003cbr\\/\u003e\\n2013-12-11 11:43:25,878 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.cloud.SyncStrategy  - Sync replicas to \u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/\u003c\\/a\u003e\u003cbr\\/\u003e\\n2013-12-11 11:43:25,880 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.update.PeerSync  - PeerSync: core=cloud_shard1_replica1 url=\u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\u003c\\/a\u003e START replicas=\u003ca href=\\\"http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\u003c\\/a\u003e nUpdates=100\u003cbr\\/\u003e\\n2013-12-11 11:43:25,936 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e WARN  solr.update.PeerSync  - PeerSync: core=cloud_shard1_replica1 url=\u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\u003c\\/a\u003e  couldn\'t connect to \u003ca href=\\\"http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\u003c\\/a\u003e, counting as success\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e[TJP &gt;&gt; whoops! of course it couldn\'t connect to cloud84 as it\'s still initializing ...\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e2013-12-11 11:43:25,936 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.update.PeerSync  - PeerSync: core=cloud_shard1_replica1 url=\u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\u003c\\/a\u003e DONE. sync succeeded\u003cbr\\/\u003e\\n2013-12-11 11:43:25,937 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.cloud.SyncStrategy  - Sync Success - now sync replicas to me\u003cbr\\/\u003e\\n2013-12-11 11:43:25,937 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.cloud.SyncStrategy  - \u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/:\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/:\u003c\\/a\u003e try and ask \u003ca href=\\\"http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\u003c\\/a\u003e to sync\u003cbr\\/\u003e\\n2013-12-11 11:43:25,938 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e ERROR solr.cloud.SyncStrategy  - Sync request error: org.apache.solr.client.solrj.SolrServerException: Server refused connection at: \u003ca href=\\\"http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e[TJP &gt;&gt; ayep, cloud84 is still initializing so it can\'t respond to you Mr. Impatient cloud85!\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-11 11:43:25,939 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.cloud.SyncStrategy  - \u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/:\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/:\u003c\\/a\u003e Sync failed - asking replica (\u003ca href=\\\"http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\u003c\\/a\u003e) to recover.\u003cbr\\/\u003e\\n2013-12-11 11:43:25,940 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e INFO  solr.cloud.ShardLeaderElectionContext  - I am the new leader: \u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/\u003c\\/a\u003e shard1\u003c\\/p\u003e\\n\\n\u003cp\u003e[TJP &gt;&gt; oh no! the collection is now out-of-sync ... my test harness periodically polls the replicas for their doc counts and at this point, we ended up with:\u003cbr\\/\u003e\\nshard1: {\u003cbr\\/\u003e\\n\\t\u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/\u003c\\/a\u003e = 300800 LEADER\u003cbr\\/\u003e\\n\\t\u003ca href=\\\"http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\u003c\\/a\u003e = 447600 diff:\u003cdel\u003e146800  &lt;\u003c\\/del\u003e-- this should be the real leader!\u003cbr\\/\u003e\\n}\u003c\\/p\u003e\\n\\n\u003cp\u003eWhich of course is expected because cloud85 should \u003cb\u003eNOT\u003c\\/b\u003e be the leader\u003c\\/p\u003e\\n\\n\u003cp\u003eSo all that is interesting, but how to fix???\u003c\\/p\u003e\\n\\n\u003cp\u003eMy first idea was to go tackle the decision making process ShardLeaderElectionContext uses to decide if it has enough replicas to continue. \u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s easy enough to do something like the following:\u003cbr\\/\u003e\\n        int notDownCount = 0;\u003cbr\\/\u003e\\n        Map&lt;String,Replica&gt; replicasMap = slices.getReplicasMap();\u003cbr\\/\u003e\\n        for (Replica replica : replicasMap.values()) {\u003cbr\\/\u003e\\n          ZkCoreNodeProps replicaCoreProps = new ZkCoreNodeProps(replica);\u003cbr\\/\u003e\\n          String replicaState = replicaCoreProps.getState();\u003cbr\\/\u003e\\n          log.warn(\\\"&gt;&gt;&gt;&gt; State of replica \\\"\u003cins\u003ereplica.getName()\u003c\\/ins\u003e\\\" is \\\"\u003cins\u003ereplicaState\u003c\\/ins\u003e\\\" &lt;&lt;&lt;&lt;\\\");\u003cbr\\/\u003e\\n          if (\\\"active\\\".equals(replicaState) || \\\"recovering\\\".equals(replicaState)) \u003c\\/p\u003e\\n{\\n            ++notDownCount;\\n          }\\n\u003cp\u003e        }\u003c\\/p\u003e\\n\\n\u003cp\u003eWas thinking I could use the notDownCount to make a better decision, but then I ran into another issue related to replica state being stale. In my cluster, if I have \\/clusterstate.json:\u003c\\/p\u003e\\n\\n\u003cp\u003e{\\\"cloud\\\":{\u003cbr\\/\u003e\\n    \\\"shards\\\":{\\\"shard1\\\":{\u003cbr\\/\u003e\\n        \\\"range\\\":\\\"80000000-7fffffff\\\",\u003cbr\\/\u003e\\n        \\\"state\\\":\\\"active\\\",\u003cbr\\/\u003e\\n        \\\"replicas\\\":{\u003cbr\\/\u003e\\n          \\\"core_node1\\\":\u003c\\/p\u003e\\n{\\n            \\\"state\\\":\\\"active\\\",\\n            \\\"base_url\\\":\\\"http:\\/\\/cloud84:8984\\/solr\\\",\\n            \\\"core\\\":\\\"cloud_shard1_replica2\\\",\\n            \\\"node_name\\\":\\\"cloud84:8984_solr\\\",\\n            \\\"leader\\\":\\\"true\\\"}\\n\u003cp\u003e,\u003cbr\\/\u003e\\n          \\\"core_node2\\\":{\u003cbr\\/\u003e\\n            \\\"state\\\":\\\"active\\\",\u003cbr\\/\u003e\\n            \\\"base_url\\\":\\\"http:\\/\\/cloud85:8985\\/solr\\\",\u003cbr\\/\u003e\\n            \\\"core\\\":\\\"cloud_shard1_replica1\\\",\u003cbr\\/\u003e\\n            \\\"node_name\\\":\\\"cloud85:8985_solr\\\"}}}},\u003cbr\\/\u003e\\n    \\\"maxShardsPerNode\\\":\\\"1\\\",\u003cbr\\/\u003e\\n    \\\"router\\\":\u003c\\/p\u003e\\n{\\\"name\\\":\\\"compositeId\\\"}\\n\u003cp\u003e,\u003cbr\\/\u003e\\n    \\\"replicationFactor\\\":\\\"2\\\"}}\u003c\\/p\u003e\\n\\n\u003cp\u003eIf I kill the process using kill -9 PID for the Solr running on 8985 (the replica), core_node2\'s state remains \\\"active\\\" in \\/clusterstate.json\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen tailing the log on core_node1, I do see one notification coming in the watcher setup by ZkStateReader from ZooKeeper about live nodes having changed:\u003cbr\\/\u003e\\n2013-12-11 15:42:46,010 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ZkStateReader  - Updating live nodes... (1)\u003c\\/p\u003e\\n\\n\u003cp\u003eSo after killing the process, \\/live_nodes is updated to only have one node, but \\/clusterstate.json still thinks there are 2 healthy replicas for shard1, instead of just 1.\u003c\\/p\u003e\\n\\n\u003cp\u003eOf course, if I restart 8985, then it goes through a series of state changes until it is marked active again, which looks correct.\u003c\\/p\u003e\\n\\n\u003cp\u003eBottom line ... it seems there is something in SolrCloud that does not update a replica\'s state when the node is killed. If a change to \\/live_nodes doesn\'t trigger a refresh of replica state, what does?\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m seeing this stale replica state issue in Solr 4.6.0 and in revision 1550300 of branch_4x - the latest from svn.\u003c\\/p\u003e\\n\\n\u003cp\u003eNot having a fresh state of a replica prevents my idea for fixing ShardLeaderElectionContext\'s decision making process. I\'m also curious about the decision to register a node under \\/live_nodes before it is fully initialized, but maybe that is a discussion for another time.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn any case, I wanted to get some feedback on my findings before moving forward with a solution.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13845847_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13845847_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/13 23:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-11T23:35:00+0000\'\u003e11\\/Dec\\/13 23:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t have fix yet, but I wanted to post an update here to get some feedback on what I\'m seeing ... \\n\\n I have a simple SolrCloud configuration setup locally: 1 collection named \\\"cloud\\\" with 1 shard and replicationFactor 2, i.e. here\'s what I use to create it: \\ncurl \\\"http:\\/\\/localhost:8984\\/solr\\/admin\\/collections?action=CREATE&amp;name=cloud&amp;replicationFactor=$REPFACT&amp;numShards=1&amp;collection.configName=cloud\\\" \\n\\n The collection gets distributed on two nodes: cloud84:8984 and cloud85:8985 with cloud84 being assigned the leader. \\n\\n Here\'s an outline of the process I used to get my collection out-of-sync during indexing: \\n\\n 1) start indexing docs using CloudSolrServer in SolrJ - direct updates go to the leader and replica remains in sync for as long as I let this process run \\n2) kill -9 the process for the replica cloud85 \\n3) let indexing continue against cloud84 for a few seconds (just to get the leader and replica out-of-sync once I bring the replica back online) \\n4) kill -9 the process for the leader cloud84 ... indexing halts of course as there are no running servers \\n5) start the replica cloud85 but do not start the previous leader cloud84 \\n\\n Here are some key log messages as cloud85 - the replica - fires up ... my annotations of the log messages are prefixed by [TJP &gt;&gt; \\n\\n 2013-12-11 11:43:22,076  &#91;main-EventThread&#93;  INFO  common.cloud.ZkStateReader  - A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/clusterstate.json, has occurred - updating... (live nodes size: 1) \\n2013-12-11 11:43:23,370  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.cloud.ShardLeaderElectionContext  - Waiting until we see more replicas up for shard shard1: total=2 found=1 timeoutin=139841 \\n\\n [TJP &gt;&gt; This looks good and is expected because cloud85 was not the leader before it died, so it should not immediately assume it is the leader until it sees more replicas \\n\\n 6) now start the previous leader cloud84 ... \\n\\n Here are some key log messages from cloud85 as the previous leader cloud84 is coming up ...  \\n\\n 2013-12-11 11:43:24,085  &#91;main-EventThread&#93;  INFO  common.cloud.ZkStateReader  - Updating live nodes... (2) \\n2013-12-11 11:43:24,136  &#91;main-EventThread&#93;  INFO  solr.cloud.DistributedQueue  - LatchChildWatcher fired on path: \\/overseer\\/queue state: SyncConnected type NodeChildrenChanged \\n2013-12-11 11:43:24,137  &#91;Thread-13&#93;  INFO  common.cloud.ZkStateReader  - Updating cloud state from ZooKeeper...  \\n2013-12-11 11:43:24,138  &#91;Thread-13&#93;  INFO  solr.cloud.Overseer  - Update state numShards=1 message= \\n{\\n  \\\"operation\\\":\\\"state\\\",\\n  \\\"state\\\":\\\"down\\\",\\n  \\\"base_url\\\":\\\"http:\\/\\/cloud84:8984\\/solr\\\",\\n  \\\"core\\\":\\\"cloud_shard1_replica2\\\",\\n  \\\"roles\\\":null,\\n  \\\"node_name\\\":\\\"cloud84:8984_solr\\\",\\n  \\\"shard\\\":\\\"shard1\\\",\\n  \\\"shard_range\\\":null,\\n  \\\"shard_state\\\":\\\"active\\\",\\n  \\\"shard_parent\\\":null,\\n  \\\"collection\\\":\\\"cloud\\\",\\n  \\\"numShards\\\":\\\"1\\\",\\n  \\\"core_node_name\\\":\\\"core_node1\\\"}\\n\\n [TJP &gt;&gt; state of cloud84 looks correct as it is still initializing ... \\n\\n 2013-12-11 11:43:24,140  &#91;main-EventThread&#93;  INFO  solr.cloud.DistributedQueue  - LatchChildWatcher fired on path: \\/overseer\\/queue state: SyncConnected type NodeChildrenChanged \\n2013-12-11 11:43:24,141  &#91;main-EventThread&#93;  INFO  common.cloud.ZkStateReader  - A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/clusterstate.json, has occurred - updating... (live nodes size: 2) \\n\\n 2013-12-11 11:43:25,878  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.cloud.ShardLeaderElectionContext  - Enough replicas found to continue. \\n\\n [TJP &gt;&gt; hmmmm ... cloud84 is listed in \\/live_nodes but it isn\'t \\\"active\\\" yet or even recovering (see state above - it\'s currently \\\"down\\\") ... My thinking here is that the ShardLeaderElectionContext needs to take the state of the replica into account before deciding it should continue. \\n\\n\\n 2013-12-11 11:43:25,878  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.cloud.ShardLeaderElectionContext  - I may be the new leader - try and sync \\n2013-12-11 11:43:25,878  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.cloud.SyncStrategy  - Sync replicas to  http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/  \\n2013-12-11 11:43:25,880  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.update.PeerSync  - PeerSync: core=cloud_shard1_replica1 url= http:\\/\\/cloud85:8985\\/solr  START replicas= http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/  nUpdates=100 \\n2013-12-11 11:43:25,936  &#91;coreLoadExecutor-3-thread-1&#93;  WARN  solr.update.PeerSync  - PeerSync: core=cloud_shard1_replica1 url= http:\\/\\/cloud85:8985\\/solr   couldn\'t connect to  http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/ , counting as success \\n\\n\\n [TJP &gt;&gt; whoops! of course it couldn\'t connect to cloud84 as it\'s still initializing ... \\n\\n\\n 2013-12-11 11:43:25,936  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.update.PeerSync  - PeerSync: core=cloud_shard1_replica1 url= http:\\/\\/cloud85:8985\\/solr  DONE. sync succeeded \\n2013-12-11 11:43:25,937  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.cloud.SyncStrategy  - Sync Success - now sync replicas to me \\n2013-12-11 11:43:25,937  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.cloud.SyncStrategy  -  http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/:  try and ask  http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/  to sync \\n2013-12-11 11:43:25,938  &#91;coreLoadExecutor-3-thread-1&#93;  ERROR solr.cloud.SyncStrategy  - Sync request error: org.apache.solr.client.solrj.SolrServerException: Server refused connection at:  http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2  \\n\\n [TJP &gt;&gt; ayep, cloud84 is still initializing so it can\'t respond to you Mr. Impatient cloud85! \\n\\n 2013-12-11 11:43:25,939  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.cloud.SyncStrategy  -  http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/:  Sync failed - asking replica ( http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/ ) to recover. \\n2013-12-11 11:43:25,940  &#91;coreLoadExecutor-3-thread-1&#93;  INFO  solr.cloud.ShardLeaderElectionContext  - I am the new leader:  http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/  shard1 \\n\\n [TJP &gt;&gt; oh no! the collection is now out-of-sync ... my test harness periodically polls the replicas for their doc counts and at this point, we ended up with: \\nshard1: { \\n\\t http:\\/\\/cloud85:8985\\/solr\\/cloud_shard1_replica1\\/  = 300800 LEADER \\n\\t http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/  = 447600 diff: 146800  &lt; -- this should be the real leader! \\n} \\n\\n Which of course is expected because cloud85 should  NOT  be the leader \\n\\n So all that is interesting, but how to fix??? \\n\\n My first idea was to go tackle the decision making process ShardLeaderElectionContext uses to decide if it has enough replicas to continue.  \\n\\n It\'s easy enough to do something like the following: \\n        int notDownCount = 0; \\n        Map&lt;String,Replica&gt; replicasMap = slices.getReplicasMap(); \\n        for (Replica replica : replicasMap.values()) { \\n          ZkCoreNodeProps replicaCoreProps = new ZkCoreNodeProps(replica); \\n          String replicaState = replicaCoreProps.getState(); \\n          log.warn(\\\"&gt;&gt;&gt;&gt; State of replica \\\" replica.getName() \\\" is \\\" replicaState \\\" &lt;&lt;&lt;&lt;\\\"); \\n          if (\\\"active\\\".equals(replicaState) || \\\"recovering\\\".equals(replicaState))  \\n{\\n            ++notDownCount;\\n          }\\n         } \\n\\n Was thinking I could use the notDownCount to make a better decision, but then I ran into another issue related to replica state being stale. In my cluster, if I have \\/clusterstate.json: \\n\\n {\\\"cloud\\\":{ \\n    \\\"shards\\\":{\\\"shard1\\\":{ \\n        \\\"range\\\":\\\"80000000-7fffffff\\\", \\n        \\\"state\\\":\\\"active\\\", \\n        \\\"replicas\\\":{ \\n          \\\"core_node1\\\": \\n{\\n            \\\"state\\\":\\\"active\\\",\\n            \\\"base_url\\\":\\\"http:\\/\\/cloud84:8984\\/solr\\\",\\n            \\\"core\\\":\\\"cloud_shard1_replica2\\\",\\n            \\\"node_name\\\":\\\"cloud84:8984_solr\\\",\\n            \\\"leader\\\":\\\"true\\\"}\\n , \\n          \\\"core_node2\\\":{ \\n            \\\"state\\\":\\\"active\\\", \\n            \\\"base_url\\\":\\\"http:\\/\\/cloud85:8985\\/solr\\\", \\n            \\\"core\\\":\\\"cloud_shard1_replica1\\\", \\n            \\\"node_name\\\":\\\"cloud85:8985_solr\\\"}}}}, \\n    \\\"maxShardsPerNode\\\":\\\"1\\\", \\n    \\\"router\\\": \\n{\\\"name\\\":\\\"compositeId\\\"}\\n , \\n    \\\"replicationFactor\\\":\\\"2\\\"}} \\n\\n If I kill the process using kill -9 PID for the Solr running on 8985 (the replica), core_node2\'s state remains \\\"active\\\" in \\/clusterstate.json \\n\\n When tailing the log on core_node1, I do see one notification coming in the watcher setup by ZkStateReader from ZooKeeper about live nodes having changed: \\n2013-12-11 15:42:46,010  &#91;main-EventThread&#93;  INFO  common.cloud.ZkStateReader  - Updating live nodes... (1) \\n\\n So after killing the process, \\/live_nodes is updated to only have one node, but \\/clusterstate.json still thinks there are 2 healthy replicas for shard1, instead of just 1. \\n\\n Of course, if I restart 8985, then it goes through a series of state changes until it is marked active again, which looks correct. \\n\\n Bottom line ... it seems there is something in SolrCloud that does not update a replica\'s state when the node is killed. If a change to \\/live_nodes doesn\'t trigger a refresh of replica state, what does? \\n\\n I\'m seeing this stale replica state issue in Solr 4.6.0 and in revision 1550300 of branch_4x - the latest from svn. \\n\\n Not having a fresh state of a replica prevents my idea for fixing ShardLeaderElectionContext\'s decision making process. I\'m also curious about the decision to register a node under \\/live_nodes before it is fully initialized, but maybe that is a discussion for another time. \\n\\n In any case, I wanted to get some feedback on my findings before moving forward with a solution.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13845887\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13845887&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13845887\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13845887_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13845887_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 00:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T00:13:41+0000\'\u003e12\\/Dec\\/13 00:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA lot there! I\'ll respond to most of it later.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs far as the stale state, that is expected. You cannot tell the state just from clusterstate.json - it is a mix of clusterstate.json and the live_nodes list. If the livenode for anything in clusterstate.json is missing, it\'s considered not up. This is just currently by design - without live_nodes, you don\'t know the state.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13845887_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13845887_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 00:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T00:13:41+0000\'\u003e12\\/Dec\\/13 00:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A lot there! I\'ll respond to most of it later. \\n\\n As far as the stale state, that is expected. You cannot tell the state just from clusterstate.json - it is a mix of clusterstate.json and the live_nodes list. If the livenode for anything in clusterstate.json is missing, it\'s considered not up. This is just currently by design - without live_nodes, you don\'t know the state.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13845895\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13845895&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13845895\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13845895_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13845895_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 00:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T00:20:08+0000\'\u003e12\\/Dec\\/13 00:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eok - cool ... just wanted to make sure that \\\"stale\\\" situation was expected ...\u003c\\/p\u003e\\n\\n\u003cp\u003ethe more I dig into ShardLeaderElectionContext\'s decision making process, I think looking at state won\'t work because both are in the \\\"down\\\" state while this is happening. I think some determination of is the node \\\"reachable\\\" so that PeerSync can get good information from it is what needs to be factored into ShardLeaderElectionContext. Or maybe there is another state \\\"trying to figure out my role in the world as I come back up\\\" \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13845895_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13845895_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 00:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T00:20:08+0000\'\u003e12\\/Dec\\/13 00:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    ok - cool ... just wanted to make sure that \\\"stale\\\" situation was expected ... \\n\\n the more I dig into ShardLeaderElectionContext\'s decision making process, I think looking at state won\'t work because both are in the \\\"down\\\" state while this is happening. I think some determination of is the node \\\"reachable\\\" so that PeerSync can get good information from it is what needs to be factored into ShardLeaderElectionContext. Or maybe there is another state \\\"trying to figure out my role in the world as I come back up\\\"                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13846572\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13846572&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846572\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13846572_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846572_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 18:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T18:44:03+0000\'\u003e12\\/Dec\\/13 18:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe other issue is expected as well. It\'s the safety mechanism - we don\'t let you just start one node and let it becomes leader - ideally you want all replicas to be involved in the election to prevent data loss. You have to be explicit if you want to have this work with no wait. It might be nice if we added a startup sys prop that caused it not to wait on first startup. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13846572_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846572_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 18:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T18:44:03+0000\'\u003e12\\/Dec\\/13 18:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The other issue is expected as well. It\'s the safety mechanism - we don\'t let you just start one node and let it becomes leader - ideally you want all replicas to be involved in the election to prevent data loss. You have to be explicit if you want to have this work with no wait. It might be nice if we added a startup sys prop that caused it not to wait on first startup.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13846593\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13846593&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846593\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13846593_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846593_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 19:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T19:01:46+0000\'\u003e12\\/Dec\\/13 19:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAgreed on the wait being necessary (which I actually annotated in the comment above). The crux of the issue here is that the replica (cloud85) can\'t sync with the previous leader (cloud84) because they are waiting on each other; much like a dead-lock. Eventually, they both give up and one wins; unfortunately in my test case, cloud85 wins which leads to the shard being out-of-sync because the wrong leader is selected in this scenario (cloud84 should have been selected). \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m continuing to dig into this but have come to the conclusion that tweaking the waitForReplicasToComeUp process is a dead end and it\'s working as well as it can.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13846593_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846593_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 19:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T19:01:46+0000\'\u003e12\\/Dec\\/13 19:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Agreed on the wait being necessary (which I actually annotated in the comment above). The crux of the issue here is that the replica (cloud85) can\'t sync with the previous leader (cloud84) because they are waiting on each other; much like a dead-lock. Eventually, they both give up and one wins; unfortunately in my test case, cloud85 wins which leads to the shard being out-of-sync because the wrong leader is selected in this scenario (cloud84 should have been selected).  \\n\\n I\'m continuing to dig into this but have come to the conclusion that tweaking the waitForReplicasToComeUp process is a dead end and it\'s working as well as it can.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13846694\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13846694&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846694\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13846694_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846694_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T20:19:23+0000\'\u003e12\\/Dec\\/13 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ebecause they are waiting on each other;\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat doesn\'t make sense to me - the wait should be until all the replicas for a shard are up - so what exactly are they both waiting on? If they are both waiting, there should be enough replicas up to continue...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13846694_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846694_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T20:19:23+0000\'\u003e12\\/Dec\\/13 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     because they are waiting on each other;  \\n\\n That doesn\'t make sense to me - the wait should be until all the replicas for a shard are up - so what exactly are they both waiting on? If they are both waiting, there should be enough replicas up to continue...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13846755\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13846755&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846755\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13846755_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846755_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T21:25:46+0000\'\u003e12\\/Dec\\/13 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m sorry for being unclear; \\\"waiting\\\" was probably the wrong term ... and they definitely continue right on down the path of selecting the wrong leader. \u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s what I know so far, which admittedly isn\'t much:\u003c\\/p\u003e\\n\\n\u003cp\u003eAs cloud85 (replica before it crashed) is initializing, it enters the wait process in ShardLeaderElectionContext#waitForReplicasToComeUp; this is expected and a good thing.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome short amount of time in the future, cloud84 (leader before it crashed) begins initializing and gets to a point where it adds itself as a possible leader for the shard (by creating a znode under \\/collections\\/cloud\\/leaders_elect\\/shard1\\/election), which leads to cloud85 being able to return from waitForReplicasToComeUp and try to determine who should be the leader.\u003c\\/p\u003e\\n\\n\u003cp\u003ecloud85 then tries to run the SyncStrategy, which can never work because in this scenario the Jetty HTTP listener is not active yet on either node, so all replication work that uses HTTP requests fails on both nodes ... PeerSync treats these failures as indicators that the other replicas in the shard are unavailable (or whatever) and assumes success. Here\'s the log message:\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-11 11:43:25,936 \u003cspan class=\\\"error\\\"\u003e&#91;coreLoadExecutor-3-thread-1&#93;\u003c\\/span\u003e WARN solr.update.PeerSync - PeerSync: core=cloud_shard1_replica1 url=\u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\u003c\\/a\u003e couldn\'t connect to \u003ca href=\\\"http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/\u003c\\/a\u003e, counting as success\u003c\\/p\u003e\\n\\n\u003cp\u003eThe Jetty HTTP listener doesn\'t start accepting connections until long after this process has completed and already selected the wrong leader.\u003c\\/p\u003e\\n\\n\u003cp\u003eFrom what I can see, we seem to have a leader recovery process that is based partly on HTTP requests to the other nodes, but the HTTP listener on those nodes isn\'t active yet. We need a leader recovery process that doesn\'t rely on HTTP requests. Perhaps, leader recovery for a shard w\\/o a current leader may need to work differently than leader election in a shard that has replicas that can respond to HTTP requests? All of what I\'m seeing makes perfect sense for leader election when there are active replicas and the current leader fails.\u003c\\/p\u003e\\n\\n\u003cp\u003eAll this aside, I\'m not asserting that this is the only cause for the out-of-sync issues reported in this ticket, but it definitely seems like it could happen in a real cluster.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13846755_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846755_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T21:25:46+0000\'\u003e12\\/Dec\\/13 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m sorry for being unclear; \\\"waiting\\\" was probably the wrong term ... and they definitely continue right on down the path of selecting the wrong leader.  \\n\\n Here\'s what I know so far, which admittedly isn\'t much: \\n\\n As cloud85 (replica before it crashed) is initializing, it enters the wait process in ShardLeaderElectionContext#waitForReplicasToComeUp; this is expected and a good thing. \\n\\n Some short amount of time in the future, cloud84 (leader before it crashed) begins initializing and gets to a point where it adds itself as a possible leader for the shard (by creating a znode under \\/collections\\/cloud\\/leaders_elect\\/shard1\\/election), which leads to cloud85 being able to return from waitForReplicasToComeUp and try to determine who should be the leader. \\n\\n cloud85 then tries to run the SyncStrategy, which can never work because in this scenario the Jetty HTTP listener is not active yet on either node, so all replication work that uses HTTP requests fails on both nodes ... PeerSync treats these failures as indicators that the other replicas in the shard are unavailable (or whatever) and assumes success. Here\'s the log message: \\n\\n 2013-12-11 11:43:25,936  &#91;coreLoadExecutor-3-thread-1&#93;  WARN solr.update.PeerSync - PeerSync: core=cloud_shard1_replica1 url= http:\\/\\/cloud85:8985\\/solr  couldn\'t connect to  http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica2\\/ , counting as success \\n\\n The Jetty HTTP listener doesn\'t start accepting connections until long after this process has completed and already selected the wrong leader. \\n\\n From what I can see, we seem to have a leader recovery process that is based partly on HTTP requests to the other nodes, but the HTTP listener on those nodes isn\'t active yet. We need a leader recovery process that doesn\'t rely on HTTP requests. Perhaps, leader recovery for a shard w\\/o a current leader may need to work differently than leader election in a shard that has replicas that can respond to HTTP requests? All of what I\'m seeing makes perfect sense for leader election when there are active replicas and the current leader fails. \\n\\n All this aside, I\'m not asserting that this is the only cause for the out-of-sync issues reported in this ticket, but it definitely seems like it could happen in a real cluster.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13846775\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13846775&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846775\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13846775_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846775_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 21:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T21:42:50+0000\'\u003e12\\/Dec\\/13 21:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAh, thanks for the explanation.  I think we should roll that specific issue into a new JIRA issue. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13846775_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846775_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 21:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T21:42:50+0000\'\u003e12\\/Dec\\/13 21:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ah, thanks for the explanation.  I think we should roll that specific issue into a new JIRA issue.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13846812\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13846812&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846812\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13846812_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846812_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 22:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T22:09:46+0000\'\u003e12\\/Dec\\/13 22:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMark -&gt; \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5552\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5552\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13846812_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13846812_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/13 22:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-12T22:09:46+0000\'\u003e12\\/Dec\\/13 22:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mark -&gt;  https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5552               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13855273\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13855273&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13855273\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13855273_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13855273_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/13 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-22T20:57:17+0000\'\u003e22\\/Dec\\/13 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5552\\\" title=\\\"Leader recovery process can select the wrong leader if all replicas for a shard are down and trying to recover as well as lose updates that should have been recovered.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5552\\\"\u003e\u003cdel\u003eSOLR-5552\u003c\\/del\u003e\u003c\\/a\u003e investigation has also led to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5569\\\" title=\\\"A replica should not try and recover from a leader until it has published that it is ACTIVE.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5569\\\"\u003e\u003cdel\u003eSOLR-5569\u003c\\/del\u003e\u003c\\/a\u003e and \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5568\\\" title=\\\"A SolrCore cannot decide to be the leader just because the cluster state says no other SolrCore&#39;s are active.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5568\\\"\u003e\u003cdel\u003eSOLR-5568\u003c\\/del\u003e\u003c\\/a\u003e \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13855273_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13855273_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/13 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-22T20:57:17+0000\'\u003e22\\/Dec\\/13 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                      SOLR-5552   investigation has also led to   SOLR-5569   and   SOLR-5568                 \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13856002\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13856002&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13856002\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13856002_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856002_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/13 23:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-23T23:05:41+0000\'\u003e23\\/Dec\\/13 23:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFound another interesting case that may or may not be valid depending on whether we think HTTP requests between a leader and replica can fail even if the ZooKeeper session on the replica does not drop?\u003c\\/p\u003e\\n\\n\u003cp\u003eSpecifically, what I\'m seeing is that if an update request between the leader and replica fails, but the replica doesn\'t lose it\'s session with ZK, then the replica can get out-of-sync with the leader. In a real network partition, the ZK connection would also likely be lost and the replica would get marked as down. So as long as the HTTP connection timeout between the leader and replica exceeds the ZK client timeout, the replica would probably recover correctly, rendering this test case invalid. So maybe the main question here is whether we think it\'s possible for HTTP requests between a leader and replica to fail even though the ZooKeeper connection stays alive?\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s the steps I used to reproduce this case (all using revision 1553150 in branch_4x):\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cb\u003e&gt; STEP 1: Setup a collection named \\u201Ccloud\\u201D containing 1 shard and 2 replicas on hosts: cloud84 (127.0.0.1:8984) and cloud85 (127.0.0.1:8985)\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eSOLR_TOP=\\/home\\/ec2-user\\/branch_4x\\/solr\u003cbr\\/\u003e\\n$SOLR_TOP\\/cloud84\\/cloud-scripts\\/zkcli.sh -zkhost $ZK_HOST -cmd upconfig -confdir $SOLR_TOP\\/cloud84\\/solr\\/cloud\\/conf -confname cloud\u003cbr\\/\u003e\\nAPI=\u003ca href=\\\"http:\\/\\/localhost:8984\\/solr\\/admin\\/collections\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8984\\/solr\\/admin\\/collections\u003c\\/a\u003e\u003cbr\\/\u003e\\ncurl -v \\\"$API?action=CREATE&amp;name=cloud&amp;replicationFactor=2&amp;numShards=1&amp;collection.configName=cloud\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eReplica on cloud84 is elected as the initial leader. \\/clusterstate.json looks like:\u003c\\/p\u003e\\n\\n\u003cp\u003e{\\\"cloud\\\":{\u003cbr\\/\u003e\\n    \\\"shards\\\":{\\\"shard1\\\":{\u003cbr\\/\u003e\\n        \\\"range\\\":\\\"80000000-7fffffff\\\",\u003cbr\\/\u003e\\n        \\\"state\\\":\\\"active\\\",\u003cbr\\/\u003e\\n        \\\"replicas\\\":{\u003cbr\\/\u003e\\n          \\\"core_node1\\\":\u003c\\/p\u003e\\n{\\n            \\\"state\\\":\\\"active\\\",\\n            \\\"base_url\\\":\\\"http:\\/\\/cloud84:8984\\/solr\\\",\\n            \\\"core\\\":\\\"cloud_shard1_replica1\\\",\\n            \\\"node_name\\\":\\\"cloud84:8984_solr\\\",\\n            \\\"leader\\\":\\\"true\\\"}\\n\u003cp\u003e,\u003cbr\\/\u003e\\n          \\\"core_node2\\\":{\u003cbr\\/\u003e\\n            \\\"state\\\":\\\"active\\\",\u003cbr\\/\u003e\\n            \\\"base_url\\\":\\\"http:\\/\\/cloud85:8985\\/solr\\\",\u003cbr\\/\u003e\\n            \\\"core\\\":\\\"cloud_shard1_replica2\\\",\u003cbr\\/\u003e\\n            \\\"node_name\\\":\\\"cloud85:8985_solr\\\"}}}},\u003cbr\\/\u003e\\n    \\\"maxShardsPerNode\\\":\\\"1\\\",\u003cbr\\/\u003e\\n    \\\"router\\\":\u003c\\/p\u003e\\n{\\\"name\\\":\\\"compositeId\\\"}\\n\u003cp\u003e,\u003cbr\\/\u003e\\n    \\\"replicationFactor\\\":\\\"2\\\"}}\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e\u003cb\u003e&gt; STEP 2: Simulate network partition\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003esudo iptables -I INPUT 1 -i lo -p tcp --sport 8985 -j DROP; sudo iptables -I INPUT 2 -i lo -p tcp --dport 8985 -j DROP\u003c\\/p\u003e\\n\\n\u003cp\u003eVarious ways to do this, but to keep it simple, I\'m just dropping inbound traffic on localhost to port 8985.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cb\u003e&gt; STEP 3: Send document with ID \\u201Cdoc1\\u201D to leader on cloud84\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ecurl \\\"http:\\/\\/localhost:8984\\/solr\\/cloud\\/update\\\" -H \'Content-type:application\\/xml\' \\\\\u003cbr\\/\u003e\\n  --data-binary \'&lt;add&gt;&lt;doc&gt;&lt;field name=\\\"id\\\"&gt;doc1&lt;\\/field&gt;&lt;field name=\\\"foo_s\\\"&gt;bar&lt;\\/field&gt;&lt;\\/doc&gt;&lt;\\/add&gt;\'\u003c\\/p\u003e\\n\\n\u003cp\u003eThe update request takes some time because the replica is down but ultimately succeeds on the leader. In the logs on the leader, we have (some stack trace lines removed for clarity):\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-23 10:59:33,688 \u003cspan class=\\\"error\\\"\u003e&#91;updateExecutor-1-thread-1&#93;\u003c\\/span\u003e ERROR solr.update.StreamingSolrServers  - error\u003cbr\\/\u003e\\norg.apache.http.conn.HttpHostConnectException: Connection to \u003ca href=\\\"http:\\/\\/cloud85:8985\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\u003c\\/a\u003e refused\u003cbr\\/\u003e\\n        at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:190)\u003cbr\\/\u003e\\n        ...\u003cbr\\/\u003e\\n        at org.apache.solr.client.solrj.impl.ConcurrentUpdateSolrServer$Runner.run(ConcurrentUpdateSolrServer.java:232)\u003cbr\\/\u003e\\n        ...\u003cbr\\/\u003e\\nCaused by: java.net.ConnectException: Connection timed out\u003cbr\\/\u003e\\n        ...\u003cbr\\/\u003e\\n2013-12-23 10:59:33,695 \u003cspan class=\\\"error\\\"\u003e&#91;qtp1073932139-16&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cspan class=\\\"error\\\"\u003e&#91;cloud_shard1_replica1&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params={} \u003c\\/p\u003e\\n{add=[doc1 (1455228778490888192)]}\\n\u003cp\u003e 0 63256\u003cbr\\/\u003e\\n2013-12-23 10:59:33,702 \u003cspan class=\\\"error\\\"\u003e&#91;updateExecutor-1-thread-2&#93;\u003c\\/span\u003e INFO  update.processor.DistributedUpdateProcessor  - try and ask \u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\u003c\\/a\u003e to recover\u003cbr\\/\u003e\\n2013-12-23 10:59:48,718 \u003cspan class=\\\"error\\\"\u003e&#91;updateExecutor-1-thread-2&#93;\u003c\\/span\u003e ERROR update.processor.DistributedUpdateProcessor  - \u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr:\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr:\u003c\\/a\u003e Could not tell a replica to recover:org.apache.solr.client.solrj.SolrServerException: IOException occured when talking to server at: \u003ca href=\\\"http:\\/\\/cloud85:8985\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/cloud85:8985\\/solr\u003c\\/a\u003e\u003cbr\\/\u003e\\n        at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:507)\u003cbr\\/\u003e\\n        at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199)\u003cbr\\/\u003e\\n        at org.apache.solr.update.processor.DistributedUpdateProcessor$1.run(DistributedUpdateProcessor.java:657)\u003cbr\\/\u003e\\n        ...\u003cbr\\/\u003e\\nCaused by: org.apache.http.conn.ConnectTimeoutException: Connect to cloud85:8985 timed out\u003cbr\\/\u003e\\n        ...\u003c\\/p\u003e\\n\\n\u003cp\u003eOf course these log messages are expected. The key is that the leader accepted the update and now has one doc with ID \\\"doc1\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; STEP 4: Heal the network partition\u003c\\/p\u003e\\n\\n\u003cp\u003esudo service iptables restart (undoes the DROP rules we added above)\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cb\u003e&gt; STEP 5: Send document with ID \\u201Cdoc2\\u201D to leader on cloud84\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ecurl \\\"http:\\/\\/localhost:8984\\/solr\\/cloud\\/update\\\" -H \'Content-type:application\\/xml\' \\\\\u003cbr\\/\u003e\\n  --data-binary \'&lt;add&gt;&lt;doc&gt;&lt;field name=\\\"id\\\"&gt;doc2&lt;\\/field&gt;&lt;field name=\\\"foo_s\\\"&gt;bar&lt;\\/field&gt;&lt;\\/doc&gt;&lt;\\/add&gt;\'\u003c\\/p\u003e\\n\\n\u003cp\u003eOf course this time the update gets sent successfully to replica ... here are some log messages ...\u003c\\/p\u003e\\n\\n\u003cp\u003efrom the log on cloud84:\u003cbr\\/\u003e\\n2013-12-23 11:00:46,982 \u003cspan class=\\\"error\\\"\u003e&#91;qtp1073932139-18&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cspan class=\\\"error\\\"\u003e&#91;cloud_shard1_replica1&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params={} \u003c\\/p\u003e\\n{add=[doc2 (1455228921389776896)]} 0 162\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\nfrom the log on cloud85 (out-of-sync replica):\u003cbr\\/\u003e\\n2013-12-23 10:47:26,363 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ZkStateReader  - A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/clusterstate.json, has occurred - updating... (live nodes size: 2)\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n*2013-12-23 11:00:46,979 \u003cspan class=\\\"error\\\"\u003e&#91;qtp2124890785-12&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cspan class=\\\"error\\\"\u003e&#91;cloud_shard1_replica2&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params={distrib.from=http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2} {add=[doc2 (1455228921389776896)]}\\n\u003cp\u003e 0 142*\u003c\\/p\u003e\\n\\n\u003cp\u003eNotice that there is no logged activity on cloud85 between 10:47 and 11:00\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cb\u003e&gt; STEP 6: Commit updates\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ecurl \\\"http:\\/\\/localhost:8984\\/solr\\/cloud\\/update\\\" -H \'Content-type:application\\/xml\' --data-binary \\\"&lt;commit waitSearcher=\\\\\\\"true\\\\\\\"\\/&gt;\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cb\u003e&gt; STEP 7: Send non-distributed queries to each replica\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ecurl \\\"http:\\/\\/localhost:8984\\/solr\\/cloud\\/select?q=foo_s:bar&amp;rows=0&amp;wt=json&amp;distrib=false\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003e{\\\"responseHeader\\\":{\\\"status\\\":0,\\\"QTime\\\":1,\\\"params\\\":{\\\"q\\\":\\\"foo_s:bar\\\",\\\"distrib\\\":\\\"false\\\",\\\"wt\\\":\\\"json\\\",\\\"rows\\\":\\\"0\\\"}},\\\"response\\\":{\u003cb\u003e\\\"numFound\\\":2\u003c\\/b\u003e,\\\"start\\\":0,\\\"docs\\\":[]}}\u003c\\/p\u003e\\n\\n\u003cp\u003ecurl \\\"http:\\/\\/localhost:8985\\/solr\\/cloud\\/select?q=foo_s:bar&amp;rows=0&amp;wt=json&amp;distrib=false\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003e{\\\"responseHeader\\\":{\\\"status\\\":0,\\\"QTime\\\":1,\\\"params\\\":{\\\"q\\\":\\\"foo_s:bar\\\",\\\"distrib\\\":\\\"false\\\",\\\"wt\\\":\\\"json\\\",\\\"rows\\\":\\\"0\\\"}},\\\"response\\\":{\u003cb\u003e\\\"numFound\\\":1\u003c\\/b\u003e,\\\"start\\\":0,\\\"docs\\\":[]}}\u003c\\/p\u003e\\n\\n\u003cp\u003eObserve that the leader has 2 docs and the replica on cloud85 only has 1, but should have 2.\u003c\\/p\u003e\\n\\n\u003cp\u003eFrom what I can tell, the replica that missed some updates because of a temporary network partition doesn\'t get any notification that it missed some documents. In other words, the out-of-sync replica doesn\'t know it\'s out-of-sync and it\'s state in ZooKeeper is active. As you can see from the log messages I posted in step 3 above, the leader tried to tell the replica to recovery, but due to the network partition, that request got dropped too.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m wondering if the leader should send a state version tracking ID along with each update request so that a replica can detect that it\'s view of state was stale? I could see the process working as follows:\u003c\\/p\u003e\\n\\n\u003cp\u003e1. Shard leader now keeps track of a Slice state version tracking identifier that gets sent with every update request\u003cbr\\/\u003e\\n2. Leader tries to send an update request (including the state version ID) to a replica and send fails\u003cbr\\/\u003e\\n3. Leader updates the state version to a different value\u003cbr\\/\u003e\\n4. Leader sends another update request to the replica; request includes the updated version ID; replica accepts the request but realizes its state version ID is out-of-date from what the leader sent\u003cbr\\/\u003e\\n5. Replica enters recovery\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13856002_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856002_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/13 23:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-23T23:05:41+0000\'\u003e23\\/Dec\\/13 23:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Found another interesting case that may or may not be valid depending on whether we think HTTP requests between a leader and replica can fail even if the ZooKeeper session on the replica does not drop? \\n\\n Specifically, what I\'m seeing is that if an update request between the leader and replica fails, but the replica doesn\'t lose it\'s session with ZK, then the replica can get out-of-sync with the leader. In a real network partition, the ZK connection would also likely be lost and the replica would get marked as down. So as long as the HTTP connection timeout between the leader and replica exceeds the ZK client timeout, the replica would probably recover correctly, rendering this test case invalid. So maybe the main question here is whether we think it\'s possible for HTTP requests between a leader and replica to fail even though the ZooKeeper connection stays alive? \\n\\n Here\'s the steps I used to reproduce this case (all using revision 1553150 in branch_4x): \\n\\n  &gt; STEP 1: Setup a collection named \\u201Ccloud\\u201D containing 1 shard and 2 replicas on hosts: cloud84 (127.0.0.1:8984) and cloud85 (127.0.0.1:8985)  \\n\\n SOLR_TOP=\\/home\\/ec2-user\\/branch_4x\\/solr \\n$SOLR_TOP\\/cloud84\\/cloud-scripts\\/zkcli.sh -zkhost $ZK_HOST -cmd upconfig -confdir $SOLR_TOP\\/cloud84\\/solr\\/cloud\\/conf -confname cloud \\nAPI= http:\\/\\/localhost:8984\\/solr\\/admin\\/collections  \\ncurl -v \\\"$API?action=CREATE&amp;name=cloud&amp;replicationFactor=2&amp;numShards=1&amp;collection.configName=cloud\\\" \\n\\n Replica on cloud84 is elected as the initial leader. \\/clusterstate.json looks like: \\n\\n {\\\"cloud\\\":{ \\n    \\\"shards\\\":{\\\"shard1\\\":{ \\n        \\\"range\\\":\\\"80000000-7fffffff\\\", \\n        \\\"state\\\":\\\"active\\\", \\n        \\\"replicas\\\":{ \\n          \\\"core_node1\\\": \\n{\\n            \\\"state\\\":\\\"active\\\",\\n            \\\"base_url\\\":\\\"http:\\/\\/cloud84:8984\\/solr\\\",\\n            \\\"core\\\":\\\"cloud_shard1_replica1\\\",\\n            \\\"node_name\\\":\\\"cloud84:8984_solr\\\",\\n            \\\"leader\\\":\\\"true\\\"}\\n , \\n          \\\"core_node2\\\":{ \\n            \\\"state\\\":\\\"active\\\", \\n            \\\"base_url\\\":\\\"http:\\/\\/cloud85:8985\\/solr\\\", \\n            \\\"core\\\":\\\"cloud_shard1_replica2\\\", \\n            \\\"node_name\\\":\\\"cloud85:8985_solr\\\"}}}}, \\n    \\\"maxShardsPerNode\\\":\\\"1\\\", \\n    \\\"router\\\": \\n{\\\"name\\\":\\\"compositeId\\\"}\\n , \\n    \\\"replicationFactor\\\":\\\"2\\\"}} \\n\\n\\n  &gt; STEP 2: Simulate network partition  \\n\\n sudo iptables -I INPUT 1 -i lo -p tcp --sport 8985 -j DROP; sudo iptables -I INPUT 2 -i lo -p tcp --dport 8985 -j DROP \\n\\n Various ways to do this, but to keep it simple, I\'m just dropping inbound traffic on localhost to port 8985. \\n\\n  &gt; STEP 3: Send document with ID \\u201Cdoc1\\u201D to leader on cloud84  \\n\\n curl \\\"http:\\/\\/localhost:8984\\/solr\\/cloud\\/update\\\" -H \'Content-type:application\\/xml\' \\\\ \\n  --data-binary \'&lt;add&gt;&lt;doc&gt;&lt;field name=\\\"id\\\"&gt;doc1&lt;\\/field&gt;&lt;field name=\\\"foo_s\\\"&gt;bar&lt;\\/field&gt;&lt;\\/doc&gt;&lt;\\/add&gt;\' \\n\\n The update request takes some time because the replica is down but ultimately succeeds on the leader. In the logs on the leader, we have (some stack trace lines removed for clarity): \\n\\n 2013-12-23 10:59:33,688  &#91;updateExecutor-1-thread-1&#93;  ERROR solr.update.StreamingSolrServers  - error \\norg.apache.http.conn.HttpHostConnectException: Connection to  http:\\/\\/cloud85:8985  refused \\n        at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:190) \\n        ... \\n        at org.apache.solr.client.solrj.impl.ConcurrentUpdateSolrServer$Runner.run(ConcurrentUpdateSolrServer.java:232) \\n        ... \\nCaused by: java.net.ConnectException: Connection timed out \\n        ... \\n2013-12-23 10:59:33,695  &#91;qtp1073932139-16&#93;  INFO  update.processor.LogUpdateProcessor  -  &#91;cloud_shard1_replica1&#93;  webapp=\\/solr path=\\/update params={}  \\n{add=[doc1 (1455228778490888192)]}\\n  0 63256 \\n2013-12-23 10:59:33,702  &#91;updateExecutor-1-thread-2&#93;  INFO  update.processor.DistributedUpdateProcessor  - try and ask  http:\\/\\/cloud85:8985\\/solr  to recover \\n2013-12-23 10:59:48,718  &#91;updateExecutor-1-thread-2&#93;  ERROR update.processor.DistributedUpdateProcessor  -  http:\\/\\/cloud85:8985\\/solr:  Could not tell a replica to recover:org.apache.solr.client.solrj.SolrServerException: IOException occured when talking to server at:  http:\\/\\/cloud85:8985\\/solr  \\n        at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:507) \\n        at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199) \\n        at org.apache.solr.update.processor.DistributedUpdateProcessor$1.run(DistributedUpdateProcessor.java:657) \\n        ... \\nCaused by: org.apache.http.conn.ConnectTimeoutException: Connect to cloud85:8985 timed out \\n        ... \\n\\n Of course these log messages are expected. The key is that the leader accepted the update and now has one doc with ID \\\"doc1\\\" \\n\\n &gt; STEP 4: Heal the network partition \\n\\n sudo service iptables restart (undoes the DROP rules we added above) \\n\\n  &gt; STEP 5: Send document with ID \\u201Cdoc2\\u201D to leader on cloud84  \\n\\n curl \\\"http:\\/\\/localhost:8984\\/solr\\/cloud\\/update\\\" -H \'Content-type:application\\/xml\' \\\\ \\n  --data-binary \'&lt;add&gt;&lt;doc&gt;&lt;field name=\\\"id\\\"&gt;doc2&lt;\\/field&gt;&lt;field name=\\\"foo_s\\\"&gt;bar&lt;\\/field&gt;&lt;\\/doc&gt;&lt;\\/add&gt;\' \\n\\n Of course this time the update gets sent successfully to replica ... here are some log messages ... \\n\\n from the log on cloud84: \\n2013-12-23 11:00:46,982  &#91;qtp1073932139-18&#93;  INFO  update.processor.LogUpdateProcessor  -  &#91;cloud_shard1_replica1&#93;  webapp=\\/solr path=\\/update params={}  \\n{add=[doc2 (1455228921389776896)]} 0 162 \\n \\nfrom the log on cloud85 (out-of-sync replica): \\n2013-12-23 10:47:26,363  &#91;main-EventThread&#93;  INFO  common.cloud.ZkStateReader  - A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/clusterstate.json, has occurred - updating... (live nodes size: 2) \\n \\n... \\n \\n*2013-12-23 11:00:46,979  &#91;qtp2124890785-12&#93;  INFO  update.processor.LogUpdateProcessor  -  &#91;cloud_shard1_replica2&#93;  webapp=\\/solr path=\\/update params={distrib.from=http:\\/\\/cloud84:8984\\/solr\\/cloud_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2} {add=[doc2 (1455228921389776896)]}\\n  0 142* \\n\\n Notice that there is no logged activity on cloud85 between 10:47 and 11:00 \\n\\n  &gt; STEP 6: Commit updates  \\n\\n curl \\\"http:\\/\\/localhost:8984\\/solr\\/cloud\\/update\\\" -H \'Content-type:application\\/xml\' --data-binary \\\"&lt;commit waitSearcher=\\\\\\\"true\\\\\\\"\\/&gt;\\\" \\n\\n  &gt; STEP 7: Send non-distributed queries to each replica  \\n\\n curl \\\"http:\\/\\/localhost:8984\\/solr\\/cloud\\/select?q=foo_s:bar&amp;rows=0&amp;wt=json&amp;distrib=false\\\" \\n\\n {\\\"responseHeader\\\":{\\\"status\\\":0,\\\"QTime\\\":1,\\\"params\\\":{\\\"q\\\":\\\"foo_s:bar\\\",\\\"distrib\\\":\\\"false\\\",\\\"wt\\\":\\\"json\\\",\\\"rows\\\":\\\"0\\\"}},\\\"response\\\":{ \\\"numFound\\\":2 ,\\\"start\\\":0,\\\"docs\\\":[]}} \\n\\n curl \\\"http:\\/\\/localhost:8985\\/solr\\/cloud\\/select?q=foo_s:bar&amp;rows=0&amp;wt=json&amp;distrib=false\\\" \\n\\n {\\\"responseHeader\\\":{\\\"status\\\":0,\\\"QTime\\\":1,\\\"params\\\":{\\\"q\\\":\\\"foo_s:bar\\\",\\\"distrib\\\":\\\"false\\\",\\\"wt\\\":\\\"json\\\",\\\"rows\\\":\\\"0\\\"}},\\\"response\\\":{ \\\"numFound\\\":1 ,\\\"start\\\":0,\\\"docs\\\":[]}} \\n\\n Observe that the leader has 2 docs and the replica on cloud85 only has 1, but should have 2. \\n\\n From what I can tell, the replica that missed some updates because of a temporary network partition doesn\'t get any notification that it missed some documents. In other words, the out-of-sync replica doesn\'t know it\'s out-of-sync and it\'s state in ZooKeeper is active. As you can see from the log messages I posted in step 3 above, the leader tried to tell the replica to recovery, but due to the network partition, that request got dropped too. \\n\\n I\'m wondering if the leader should send a state version tracking ID along with each update request so that a replica can detect that it\'s view of state was stale? I could see the process working as follows: \\n\\n 1. Shard leader now keeps track of a Slice state version tracking identifier that gets sent with every update request \\n2. Leader tries to send an update request (including the state version ID) to a replica and send fails \\n3. Leader updates the state version to a different value \\n4. Leader sends another update request to the replica; request includes the updated version ID; replica accepts the request but realizes its state version ID is out-of-date from what the leader sent \\n5. Replica enters recovery              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13856009\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13856009&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13856009\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13856009_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856009_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/13 23:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-23T23:14:47+0000\'\u003e23\\/Dec\\/13 23:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYeah, that\'s currently expected. We don\'t expect the case where you can talk to ZooKeeper but not your replicas to be common, so we kind of punted on this scenario for the first phase.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome related JIRA issues:\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5482\\\" title=\\\"We should add an option to the ChaosMonkey&#39;s to do more complicated partition failures on Linux, as well as simulate hard fails of Jetty.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5482\\\"\u003eSOLR-5482\u003c\\/a\u003e\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5450\\\" title=\\\"Harden SolrCloud request for recoveries so that if the failure is not a connection exception, we retry a few times.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5450\\\"\u003eSOLR-5450\u003c\\/a\u003e\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5495\\\" title=\\\"Recovery strategy for leader partitioned from replica case.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5495\\\"\u003e\u003cdel\u003eSOLR-5495\u003c\\/del\u003e\u003c\\/a\u003e \\t\u003c\\/p\u003e\\n\\n\u003cp\u003eI think we should do all that, but the key is really, in this case, we need to pass the order to recover through ZooKeeper to the partitioned off replica. With an eventually consistent model, it can be off for a short time, but it needs to recover in a timely manner.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this is the right solution because the replica is sure to either get the information to recover from ZooKeeper or lose it\'s connection to ZooKeeper in which case it will have to recover anyway.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13856009_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856009_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/13 23:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-23T23:14:47+0000\'\u003e23\\/Dec\\/13 23:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yeah, that\'s currently expected. We don\'t expect the case where you can talk to ZooKeeper but not your replicas to be common, so we kind of punted on this scenario for the first phase. \\n\\n Some related JIRA issues: \\n\\n  SOLR-5482  \\n SOLR-5450  \\n  SOLR-5495   \\t \\n\\n I think we should do all that, but the key is really, in this case, we need to pass the order to recover through ZooKeeper to the partitioned off replica. With an eventually consistent model, it can be off for a short time, but it needs to recover in a timely manner. \\n\\n I think this is the right solution because the replica is sure to either get the information to recover from ZooKeeper or lose it\'s connection to ZooKeeper in which case it will have to recover anyway.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13856013\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13856013&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13856013\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13856013_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856013_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/13 23:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-23T23:17:51+0000\'\u003e23\\/Dec\\/13 23:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eso we kind of punted\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe other thing to note is that if you restart the shard or that node or the cluster, you should be able to do it without losing any data. It will recover from the leader when everything else is working correctly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13856013_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856013_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/13 23:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-23T23:17:51+0000\'\u003e23\\/Dec\\/13 23:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     so we kind of punted  \\n\\n The other thing to note is that if you restart the shard or that node or the cluster, you should be able to do it without losing any data. It will recover from the leader when everything else is working correctly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13856052\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13856052&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13856052\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13856052_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856052_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Dec\\/13 00:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-24T00:36:47+0000\'\u003e24\\/Dec\\/13 00:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Mark, I suspected my test case was a little cherry picked ... something interesting happened when I also severed the connection between the replica and ZK (ie. same test as above but I also dropped the ZK connection on the replica).\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-23 15:39:57,170 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ConnectionManager  - Watcher org.apache.solr.common.cloud.ConnectionManager@4f857c62 name:ZooKeeperConnection Watcher:ec2-54-197-0-103.compute-1.amazonaws.com:2181 got event WatchedEvent state:Disconnected type:None path:null path:null type:None\u003cbr\\/\u003e\\n2013-12-23 15:39:57,170 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ConnectionManager  - zkClient has disconnected\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt;&gt; fixed the connection between replica and ZK here &lt;&lt;&lt;\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-23 15:40:45,579 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ConnectionManager  - Watcher org.apache.solr.common.cloud.ConnectionManager@4f857c62 name:ZooKeeperConnection Watcher:ec2-54-197-0-103.compute-1.amazonaws.com:2181 got event WatchedEvent state:Expired type:None path:null path:null type:None\u003cbr\\/\u003e\\n2013-12-23 15:40:45,579 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ConnectionManager  - Our previous ZooKeeper session was expired. Attempting to reconnect to recover relationship with ZooKeeper...\u003cbr\\/\u003e\\n2013-12-23 15:40:45,580 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.DefaultConnectionStrategy  - Connection expired - starting a new one...\u003cbr\\/\u003e\\n2013-12-23 15:40:45,586 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ConnectionManager  - Waiting for client to connect to ZooKeeper\u003cbr\\/\u003e\\n2013-12-23 15:40:45,595 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ConnectionManager  - Watcher org.apache.solr.common.cloud.ConnectionManager@4f857c62 name:ZooKeeperConnection Watcher:ec2-54-197-0-103.compute-1.amazonaws.com:2181 got event WatchedEvent state:SyncConnected type:None path:null path:null type:None\u003cbr\\/\u003e\\n2013-12-23 15:40:45,595 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ConnectionManager  - Client is connected to ZooKeeper\u003cbr\\/\u003e\\n2013-12-23 15:40:45,595 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ConnectionManager  - Connection with ZooKeeper reestablished.\u003cbr\\/\u003e\\n2013-12-23 15:40:45,596 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e WARN  solr.cloud.RecoveryStrategy  - Stopping recovery for zkNodeName=core_node3core=cloud_shard1_replica3\u003cbr\\/\u003e\\n2013-12-23 15:40:45,597 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  solr.cloud.ZkController  - publishing core=cloud_shard1_replica3 state=down\u003cbr\\/\u003e\\n2013-12-23 15:40:45,597 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  solr.cloud.ZkController  - numShards not found on descriptor - reading it from system property\u003cbr\\/\u003e\\n2013-12-23 15:40:45,905 \u003cspan class=\\\"error\\\"\u003e&#91;qtp2124890785-14&#93;\u003c\\/span\u003e INFO  handler.admin.CoreAdminHandler  - It has been requested that we recover\u003cbr\\/\u003e\\n2013-12-23 15:40:45,906 \u003cspan class=\\\"error\\\"\u003e&#91;qtp2124890785-14&#93;\u003c\\/span\u003e INFO  solr.servlet.SolrDispatchFilter  - \u003cspan class=\\\"error\\\"\u003e&#91;admin&#93;\u003c\\/span\u003e webapp=null path=\\/admin\\/cores params=\u003c\\/p\u003e\\n{action=REQUESTRECOVERY&amp;core=cloud_shard1_replica3&amp;wt=javabin&amp;version=2}\\n\u003cp\u003e status=0 QTime=2 \u003cbr\\/\u003e\\n2013-12-23 15:40:45,909 \u003cspan class=\\\"error\\\"\u003e&#91;Thread-17&#93;\u003c\\/span\u003e INFO  solr.cloud.ZkController  - publishing core=cloud_shard1_replica3 state=recovering\u003cbr\\/\u003e\\n2013-12-23 15:40:45,909 \u003cspan class=\\\"error\\\"\u003e&#91;Thread-17&#93;\u003c\\/span\u003e INFO  solr.cloud.ZkController  - numShards not found on descriptor - reading it from system property\u003cbr\\/\u003e\\n2013-12-23 15:40:45,920 \u003cspan class=\\\"error\\\"\u003e&#91;Thread-17&#93;\u003c\\/span\u003e INFO  solr.update.DefaultSolrCoreState  - Running recovery - first canceling any ongoing recovery\u003cbr\\/\u003e\\n2013-12-23 15:40:45,921 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.cloud.RecoveryStrategy  - Starting recovery process.  core=cloud_shard1_replica3 recoveringAfterStartup=false\u003cbr\\/\u003e\\n2013-12-23 15:40:45,924 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.cloud.ZkController  - publishing core=cloud_shard1_replica3 state=recovering\u003cbr\\/\u003e\\n2013-12-23 15:40:45,924 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.cloud.ZkController  - numShards not found on descriptor - reading it from system property\u003cbr\\/\u003e\\n2013-12-23 15:40:48,613 \u003cspan class=\\\"error\\\"\u003e&#91;qtp2124890785-15&#93;\u003c\\/span\u003e INFO  solr.core.SolrCore  - \u003cspan class=\\\"error\\\"\u003e&#91;cloud_shard1_replica3&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/select params=\u003c\\/p\u003e\\n{q=foo_s:bar&amp;distrib=false&amp;wt=json&amp;rows=0}\\n\u003cp\u003e hits=0 status=0 QTime=1 \u003cbr\\/\u003e\\n2013-12-23 15:42:42,770 \u003cspan class=\\\"error\\\"\u003e&#91;qtp2124890785-13&#93;\u003c\\/span\u003e INFO  solr.core.SolrCore  - \u003cspan class=\\\"error\\\"\u003e&#91;cloud_shard1_replica3&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/select params=\u003c\\/p\u003e\\n{q=foo_s:bar&amp;distrib=false&amp;wt=json&amp;rows=0}\\n\u003cp\u003e hits=0 status=0 QTime=1 \u003cbr\\/\u003e\\n2013-12-23 15:42:45,650 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e ERROR solr.cloud.ZkController  - There was a problem making a request to the leader:org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: I was asked to wait on state down for cloud86:8986_solr but I still do not see the requested state. I see state: recovering live:false\u003cbr\\/\u003e\\n\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:495)\u003cbr\\/\u003e\\n\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199)\u003cbr\\/\u003e\\n\\tat org.apache.solr.cloud.ZkController.waitForLeaderToSeeDownState(ZkController.java:1434)\u003cbr\\/\u003e\\n\\tat org.apache.solr.cloud.ZkController.registerAllCoresAsDown(ZkController.java:347)\u003cbr\\/\u003e\\n\\tat org.apache.solr.cloud.ZkController.access$100(ZkController.java:85)\u003cbr\\/\u003e\\n\\tat org.apache.solr.cloud.ZkController$1.command(ZkController.java:225)\u003cbr\\/\u003e\\n\\tat org.apache.solr.common.cloud.ConnectionManager$1.update(ConnectionManager.java:118)\u003cbr\\/\u003e\\n\\tat org.apache.solr.common.cloud.DefaultConnectionStrategy.reconnect(DefaultConnectionStrategy.java:56)\u003cbr\\/\u003e\\n\\tat org.apache.solr.common.cloud.ConnectionManager.process(ConnectionManager.java:93)\u003cbr\\/\u003e\\n\\tat org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:519)\u003cbr\\/\u003e\\n\\tat org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:495)\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-23 15:42:45,963 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e ERROR solr.cloud.RecoveryStrategy  - Error while trying to recover. core=cloud_shard1_replica3:org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: I was asked to wait on state recovering for cloud86:8986_solr but I still do not see the requested state. I see state: recovering live:false\u003cbr\\/\u003e\\n\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:495)\u003cbr\\/\u003e\\n\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199)\u003cbr\\/\u003e\\n\\tat org.apache.solr.cloud.RecoveryStrategy.sendPrepRecoveryCmd(RecoveryStrategy.java:224)\u003cbr\\/\u003e\\n\\tat org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:371)\u003cbr\\/\u003e\\n\\tat org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:247)\u003c\\/p\u003e\\n\\n\u003cp\u003e2013-12-23 15:42:45,964 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e ERROR solr.cloud.RecoveryStrategy  - Recovery failed - trying again... (0) core=cloud_shard1_replica3\u003cbr\\/\u003e\\n2013-12-23 15:42:45,964 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.cloud.RecoveryStrategy  - Wait 2.0 seconds before trying to recover again (1)\u003cbr\\/\u003e\\n2013-12-23 15:42:47,964 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.cloud.ZkController  - publishing core=cloud_shard1_replica3 state=recovering\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13856052_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856052_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Dec\\/13 00:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-24T00:36:47+0000\'\u003e24\\/Dec\\/13 00:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Mark, I suspected my test case was a little cherry picked ... something interesting happened when I also severed the connection between the replica and ZK (ie. same test as above but I also dropped the ZK connection on the replica). \\n\\n 2013-12-23 15:39:57,170  &#91;main-EventThread&#93;  INFO  common.cloud.ConnectionManager  - Watcher org.apache.solr.common.cloud.ConnectionManager@4f857c62 name:ZooKeeperConnection Watcher:ec2-54-197-0-103.compute-1.amazonaws.com:2181 got event WatchedEvent state:Disconnected type:None path:null path:null type:None \\n2013-12-23 15:39:57,170  &#91;main-EventThread&#93;  INFO  common.cloud.ConnectionManager  - zkClient has disconnected \\n\\n &gt;&gt;&gt; fixed the connection between replica and ZK here &lt;&lt;&lt; \\n\\n 2013-12-23 15:40:45,579  &#91;main-EventThread&#93;  INFO  common.cloud.ConnectionManager  - Watcher org.apache.solr.common.cloud.ConnectionManager@4f857c62 name:ZooKeeperConnection Watcher:ec2-54-197-0-103.compute-1.amazonaws.com:2181 got event WatchedEvent state:Expired type:None path:null path:null type:None \\n2013-12-23 15:40:45,579  &#91;main-EventThread&#93;  INFO  common.cloud.ConnectionManager  - Our previous ZooKeeper session was expired. Attempting to reconnect to recover relationship with ZooKeeper... \\n2013-12-23 15:40:45,580  &#91;main-EventThread&#93;  INFO  common.cloud.DefaultConnectionStrategy  - Connection expired - starting a new one... \\n2013-12-23 15:40:45,586  &#91;main-EventThread&#93;  INFO  common.cloud.ConnectionManager  - Waiting for client to connect to ZooKeeper \\n2013-12-23 15:40:45,595  &#91;main-EventThread&#93;  INFO  common.cloud.ConnectionManager  - Watcher org.apache.solr.common.cloud.ConnectionManager@4f857c62 name:ZooKeeperConnection Watcher:ec2-54-197-0-103.compute-1.amazonaws.com:2181 got event WatchedEvent state:SyncConnected type:None path:null path:null type:None \\n2013-12-23 15:40:45,595  &#91;main-EventThread&#93;  INFO  common.cloud.ConnectionManager  - Client is connected to ZooKeeper \\n2013-12-23 15:40:45,595  &#91;main-EventThread&#93;  INFO  common.cloud.ConnectionManager  - Connection with ZooKeeper reestablished. \\n2013-12-23 15:40:45,596  &#91;main-EventThread&#93;  WARN  solr.cloud.RecoveryStrategy  - Stopping recovery for zkNodeName=core_node3core=cloud_shard1_replica3 \\n2013-12-23 15:40:45,597  &#91;main-EventThread&#93;  INFO  solr.cloud.ZkController  - publishing core=cloud_shard1_replica3 state=down \\n2013-12-23 15:40:45,597  &#91;main-EventThread&#93;  INFO  solr.cloud.ZkController  - numShards not found on descriptor - reading it from system property \\n2013-12-23 15:40:45,905  &#91;qtp2124890785-14&#93;  INFO  handler.admin.CoreAdminHandler  - It has been requested that we recover \\n2013-12-23 15:40:45,906  &#91;qtp2124890785-14&#93;  INFO  solr.servlet.SolrDispatchFilter  -  &#91;admin&#93;  webapp=null path=\\/admin\\/cores params= \\n{action=REQUESTRECOVERY&amp;core=cloud_shard1_replica3&amp;wt=javabin&amp;version=2}\\n  status=0 QTime=2  \\n2013-12-23 15:40:45,909  &#91;Thread-17&#93;  INFO  solr.cloud.ZkController  - publishing core=cloud_shard1_replica3 state=recovering \\n2013-12-23 15:40:45,909  &#91;Thread-17&#93;  INFO  solr.cloud.ZkController  - numShards not found on descriptor - reading it from system property \\n2013-12-23 15:40:45,920  &#91;Thread-17&#93;  INFO  solr.update.DefaultSolrCoreState  - Running recovery - first canceling any ongoing recovery \\n2013-12-23 15:40:45,921  &#91;RecoveryThread&#93;  INFO  solr.cloud.RecoveryStrategy  - Starting recovery process.  core=cloud_shard1_replica3 recoveringAfterStartup=false \\n2013-12-23 15:40:45,924  &#91;RecoveryThread&#93;  INFO  solr.cloud.ZkController  - publishing core=cloud_shard1_replica3 state=recovering \\n2013-12-23 15:40:45,924  &#91;RecoveryThread&#93;  INFO  solr.cloud.ZkController  - numShards not found on descriptor - reading it from system property \\n2013-12-23 15:40:48,613  &#91;qtp2124890785-15&#93;  INFO  solr.core.SolrCore  -  &#91;cloud_shard1_replica3&#93;  webapp=\\/solr path=\\/select params= \\n{q=foo_s:bar&amp;distrib=false&amp;wt=json&amp;rows=0}\\n  hits=0 status=0 QTime=1  \\n2013-12-23 15:42:42,770  &#91;qtp2124890785-13&#93;  INFO  solr.core.SolrCore  -  &#91;cloud_shard1_replica3&#93;  webapp=\\/solr path=\\/select params= \\n{q=foo_s:bar&amp;distrib=false&amp;wt=json&amp;rows=0}\\n  hits=0 status=0 QTime=1  \\n2013-12-23 15:42:45,650  &#91;main-EventThread&#93;  ERROR solr.cloud.ZkController  - There was a problem making a request to the leader:org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: I was asked to wait on state down for cloud86:8986_solr but I still do not see the requested state. I see state: recovering live:false \\n\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:495) \\n\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199) \\n\\tat org.apache.solr.cloud.ZkController.waitForLeaderToSeeDownState(ZkController.java:1434) \\n\\tat org.apache.solr.cloud.ZkController.registerAllCoresAsDown(ZkController.java:347) \\n\\tat org.apache.solr.cloud.ZkController.access$100(ZkController.java:85) \\n\\tat org.apache.solr.cloud.ZkController$1.command(ZkController.java:225) \\n\\tat org.apache.solr.common.cloud.ConnectionManager$1.update(ConnectionManager.java:118) \\n\\tat org.apache.solr.common.cloud.DefaultConnectionStrategy.reconnect(DefaultConnectionStrategy.java:56) \\n\\tat org.apache.solr.common.cloud.ConnectionManager.process(ConnectionManager.java:93) \\n\\tat org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:519) \\n\\tat org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:495) \\n\\n 2013-12-23 15:42:45,963  &#91;RecoveryThread&#93;  ERROR solr.cloud.RecoveryStrategy  - Error while trying to recover. core=cloud_shard1_replica3:org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: I was asked to wait on state recovering for cloud86:8986_solr but I still do not see the requested state. I see state: recovering live:false \\n\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:495) \\n\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199) \\n\\tat org.apache.solr.cloud.RecoveryStrategy.sendPrepRecoveryCmd(RecoveryStrategy.java:224) \\n\\tat org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:371) \\n\\tat org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:247) \\n\\n 2013-12-23 15:42:45,964  &#91;RecoveryThread&#93;  ERROR solr.cloud.RecoveryStrategy  - Recovery failed - trying again... (0) core=cloud_shard1_replica3 \\n2013-12-23 15:42:45,964  &#91;RecoveryThread&#93;  INFO  solr.cloud.RecoveryStrategy  - Wait 2.0 seconds before trying to recover again (1) \\n2013-12-23 15:42:47,964  &#91;RecoveryThread&#93;  INFO  solr.cloud.ZkController  - publishing core=cloud_shard1_replica3 state=recovering              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13856078\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13856078&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13856078\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13856078_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856078_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Dec\\/13 01:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-24T01:57:47+0000\'\u003e24\\/Dec\\/13 01:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat\'s interesting. The logging makes it look like it\'s not creating it\'s new ephemeral live node for some reason...or the leader is not getting an updated view of the live node...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13856078_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13856078_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Dec\\/13 01:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-24T01:57:47+0000\'\u003e24\\/Dec\\/13 01:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That\'s interesting. The logging makes it look like it\'s not creating it\'s new ephemeral live node for some reason...or the leader is not getting an updated view of the live node...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13864141\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13864141&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13864141\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13864141_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13864141_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jan\\/14 12:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-07T12:00:43+0000\'\u003e07\\/Jan\\/14 12:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, I followed all the great work here and in related tickets and yesterday i had the time to rebuild Solr and check for this issue. I hadn\'t seen it yesterday but it is right in front of me again, using a fresh build from January 6th.\u003c\\/p\u003e\\n\\n\u003cp\u003eLeader has Num Docs: 379659\u003cbr\\/\u003e\\nReplica has Num Docs: 379661\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13864141_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13864141_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jan\\/14 12:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-07T12:00:43+0000\'\u003e07\\/Jan\\/14 12:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, I followed all the great work here and in related tickets and yesterday i had the time to rebuild Solr and check for this issue. I hadn\'t seen it yesterday but it is right in front of me again, using a fresh build from January 6th. \\n\\n Leader has Num Docs: 379659 \\nReplica has Num Docs: 379661              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13865724\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13865724&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13865724\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13865724_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865724_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 18:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T18:32:25+0000\'\u003e08\\/Jan\\/14 18:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhile doing some other testing of SolrCloud (branch4x - 4.7-SNAPSHOT rev. 1556055), I hit this issue and here\'s the kicker ... there were no errors in my replica\'s log, the tlogs are identical, and there was no significant GC activity during the time where the replica got out of sync with the leader. I\'m attaching the data directories (index + tlog) for both replicas (demo_shard1_replica1 \u003cspan class=\\\"error\\\"\u003e&#91;leader&#93;\u003c\\/span\u003e, and demo_shard1_replica2) and their log files. When I do a doc-by-doc comparison of the two indexes, here\'s the result:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt; finished querying replica1, found 33537 documents (33537)\u003cbr\\/\u003e\\n&gt;&gt; finished querying replica2, found 33528 documents\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82995&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82995&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-274468088&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.90338105&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.6949391474539932&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668206518274&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82997&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82997&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;301737117&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.6746266&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.26034065188918565&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668206518276&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82996&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82996&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-1768315588&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.6641093&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.23708033183534993&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668206518275&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82991&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82991&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-2057280061&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.27617514&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.7885214691953506&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668206518273&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82987&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82987&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;1051456320&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.51863414&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.7881255443862878&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668206518272&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82986&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82986&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-1356807889&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.2762279&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.003657816979820372&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668205469699&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82984&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82984&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;732678870&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.31199205&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.9848865821766198&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668205469698&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82970&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82970&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;283693979&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.6119651&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.04142006867388914&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668205469696&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;82973&#93;\u003c\\/span\u003e not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82973&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;1343103920&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.5855809&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.6575904716584224&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1456683668205469697&lt;\\/field&gt;&lt;\\/doc&gt;\u003c\\/p\u003e\\n\\n\u003cp\u003eNo amount of committing or reloading of these cores helps. Also, restarting replica2 doesn\'t lead to it being in-sync either, most likely because the tlog is identical to the leader? Here\'s the log messages on replica2 after restarting it.\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-08 13:28:20,112 \u003cspan class=\\\"error\\\"\u003e&#91;searcherExecutor-5-thread-1&#93;\u003c\\/span\u003e INFO  solr.core.SolrCore  - \u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica2&#93;\u003c\\/span\u003e Registered new searcher Searcher@4345de8a main\u003c\\/p\u003e\\n{StandardDirectoryReader(segments_e:38:nrt _d(4.7):C26791 _e(4.7):C3356 _f(4.7):C3381)}\\n\u003cp\u003e2014-01-08 13:28:21,298 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.cloud.RecoveryStrategy  - Attempting to PeerSync from \u003ca href=\\\"http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/\u003c\\/a\u003e core=demo_shard1_replica2 - recoveringAfterStartup=true\u003cbr\\/\u003e\\n2014-01-08 13:28:21,302 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.PeerSync  - PeerSync: core=demo_shard1_replica2 url=\u003ca href=\\\"http:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr\u003c\\/a\u003e START replicas=\u003ca href=\\\"http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/\u003c\\/a\u003e nUpdates=100\u003cbr\\/\u003e\\n2014-01-08 13:28:21,330 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.PeerSync  - PeerSync: core=demo_shard1_replica2 url=\u003ca href=\\\"http:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr\u003c\\/a\u003e  Received 99 versions from ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/\u003cbr\\/\u003e\\n2014-01-08 13:28:21,331 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.PeerSync  - PeerSync: core=demo_shard1_replica2 url=\u003ca href=\\\"http:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr\u003c\\/a\u003e  Our versions are newer. ourLowThreshold=1456683689417113603 otherHigh=1456683689602711553\u003cbr\\/\u003e\\n2014-01-08 13:28:21,331 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.PeerSync  - PeerSync: core=demo_shard1_replica2 url=\u003ca href=\\\"http:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr\u003c\\/a\u003e DONE. sync succeeded\u003cbr\\/\u003e\\n2014-01-08 13:28:21,332 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.UpdateHandler  - start commit\u003c\\/p\u003e\\n{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\\n\u003cp\u003e2014-01-08 13:28:21,332 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.LoggingInfoStream  - \u003cspan class=\\\"error\\\"\u003e&#91;DW&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e: anyChanges? numDocsInRam=0 deletes=false hasTickets:false pendingChangesInFullFlush: false\u003cbr\\/\u003e\\n2014-01-08 13:28:21,333 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.UpdateHandler  - No uncommitted changes. Skipping IW.commit.\u003cbr\\/\u003e\\n2014-01-08 13:28:21,334 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.LoggingInfoStream  - \u003cspan class=\\\"error\\\"\u003e&#91;DW&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e: anyChanges? numDocsInRam=0 deletes=false hasTickets:false pendingChangesInFullFlush: false\u003cbr\\/\u003e\\n2014-01-08 13:28:21,334 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.LoggingInfoStream  - \u003cspan class=\\\"error\\\"\u003e&#91;IW&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e: nrtIsCurrent: infoVersion matches: true; DW changes: false; BD changes: false\u003cbr\\/\u003e\\n2014-01-08 13:28:21,335 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.LoggingInfoStream  - \u003cspan class=\\\"error\\\"\u003e&#91;DW&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e: anyChanges? numDocsInRam=0 deletes=false hasTickets:false pendingChangesInFullFlush: false\u003cbr\\/\u003e\\n2014-01-08 13:28:21,335 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.search.SolrIndexSearcher  - Opening Searcher@5fc2a9d main\u003cbr\\/\u003e\\n2014-01-08 13:28:21,338 \u003cspan class=\\\"error\\\"\u003e&#91;searcherExecutor-5-thread-1&#93;\u003c\\/span\u003e INFO  solr.core.SolrCore  - QuerySenderListener sending requests to Searcher@5fc2a9d main\u003c\\/p\u003e\\n{StandardDirectoryReader(segments_e:38:nrt _d(4.7):C26791 _e(4.7):C3356 _f(4.7):C3381)}\\n\u003cp\u003e2014-01-08 13:28:21,338 \u003cspan class=\\\"error\\\"\u003e&#91;searcherExecutor-5-thread-1&#93;\u003c\\/span\u003e INFO  solr.core.SolrCore  - QuerySenderListener done.\u003cbr\\/\u003e\\n2014-01-08 13:28:21,338 \u003cspan class=\\\"error\\\"\u003e&#91;searcherExecutor-5-thread-1&#93;\u003c\\/span\u003e INFO  solr.core.SolrCore  - \u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica2&#93;\u003c\\/span\u003e Registered new searcher Searcher@5fc2a9d main\u003c\\/p\u003e\\n{StandardDirectoryReader(segments_e:38:nrt _d(4.7):C26791 _e(4.7):C3356 _f(4.7):C3381)}\\n\u003cp\u003e2014-01-08 13:28:21,339 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.update.UpdateHandler  - end_commit_flush\u003cbr\\/\u003e\\n2014-01-08 13:28:21,339 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.cloud.RecoveryStrategy  - PeerSync Recovery was successful - registering as Active. core=demo_shard1_replica2\u003cbr\\/\u003e\\n2014-01-08 13:28:21,339 \u003cspan class=\\\"error\\\"\u003e&#91;RecoveryThread&#93;\u003c\\/span\u003e INFO  solr.cloud.ZkController  - publishing core=demo_shard1_replica2 state=active\u003cbr\\/\u003e\\n2014-01-08 13:28:21,370 \u003cspan class=\\\"error\\\"\u003e&#91;main-EventThread&#93;\u003c\\/span\u003e INFO  common.cloud.ZkStateReader  - A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/clusterstate.json, has occurred - updating... (live nodes size: 6)\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eThus, it would seem there might be some code that\'s outright losing documents (almost feels like a last batch not flushed error but more subtle as it\'s not easy to reproduce this all the time)\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13865724_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865724_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 18:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T18:32:25+0000\'\u003e08\\/Jan\\/14 18:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    While doing some other testing of SolrCloud (branch4x - 4.7-SNAPSHOT rev. 1556055), I hit this issue and here\'s the kicker ... there were no errors in my replica\'s log, the tlogs are identical, and there was no significant GC activity during the time where the replica got out of sync with the leader. I\'m attaching the data directories (index + tlog) for both replicas (demo_shard1_replica1  &#91;leader&#93; , and demo_shard1_replica2) and their log files. When I do a doc-by-doc comparison of the two indexes, here\'s the result: \\n\\n &gt;&gt; finished querying replica1, found 33537 documents (33537) \\n&gt;&gt; finished querying replica2, found 33528 documents \\nDoc  &#91;82995&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82995&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-274468088&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.90338105&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.6949391474539932&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668206518274&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;82997&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82997&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;301737117&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.6746266&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.26034065188918565&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668206518276&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;82996&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82996&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-1768315588&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.6641093&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.23708033183534993&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668206518275&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;82991&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82991&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-2057280061&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.27617514&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.7885214691953506&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668206518273&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;82987&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82987&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;1051456320&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.51863414&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.7881255443862878&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668206518272&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;82986&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82986&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-1356807889&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.2762279&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.003657816979820372&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668205469699&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;82984&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82984&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;732678870&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.31199205&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.9848865821766198&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668205469698&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;82970&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82970&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;283693979&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.6119651&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.04142006867388914&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668205469696&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;82973&#93;  not found in replica2: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;82973&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;1343103920&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.5855809&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.6575904716584224&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1456683668205469697&lt;\\/field&gt;&lt;\\/doc&gt; \\n\\n No amount of committing or reloading of these cores helps. Also, restarting replica2 doesn\'t lead to it being in-sync either, most likely because the tlog is identical to the leader? Here\'s the log messages on replica2 after restarting it. \\n\\n 2014-01-08 13:28:20,112  &#91;searcherExecutor-5-thread-1&#93;  INFO  solr.core.SolrCore  -  &#91;demo_shard1_replica2&#93;  Registered new searcher Searcher@4345de8a main \\n{StandardDirectoryReader(segments_e:38:nrt _d(4.7):C26791 _e(4.7):C3356 _f(4.7):C3381)}\\n 2014-01-08 13:28:21,298  &#91;RecoveryThread&#93;  INFO  solr.cloud.RecoveryStrategy  - Attempting to PeerSync from  http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/  core=demo_shard1_replica2 - recoveringAfterStartup=true \\n2014-01-08 13:28:21,302  &#91;RecoveryThread&#93;  INFO  solr.update.PeerSync  - PeerSync: core=demo_shard1_replica2 url= http:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr  START replicas= http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/  nUpdates=100 \\n2014-01-08 13:28:21,330  &#91;RecoveryThread&#93;  INFO  solr.update.PeerSync  - PeerSync: core=demo_shard1_replica2 url= http:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr   Received 99 versions from ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/ \\n2014-01-08 13:28:21,331  &#91;RecoveryThread&#93;  INFO  solr.update.PeerSync  - PeerSync: core=demo_shard1_replica2 url= http:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr   Our versions are newer. ourLowThreshold=1456683689417113603 otherHigh=1456683689602711553 \\n2014-01-08 13:28:21,331  &#91;RecoveryThread&#93;  INFO  solr.update.PeerSync  - PeerSync: core=demo_shard1_replica2 url= http:\\/\\/ec2-54-209-97-145.compute-1.amazonaws.com:8984\\/solr  DONE. sync succeeded \\n2014-01-08 13:28:21,332  &#91;RecoveryThread&#93;  INFO  solr.update.UpdateHandler  - start commit \\n{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\\n 2014-01-08 13:28:21,332  &#91;RecoveryThread&#93;  INFO  solr.update.LoggingInfoStream  -  &#91;DW&#93;  &#91;RecoveryThread&#93; : anyChanges? numDocsInRam=0 deletes=false hasTickets:false pendingChangesInFullFlush: false \\n2014-01-08 13:28:21,333  &#91;RecoveryThread&#93;  INFO  solr.update.UpdateHandler  - No uncommitted changes. Skipping IW.commit. \\n2014-01-08 13:28:21,334  &#91;RecoveryThread&#93;  INFO  solr.update.LoggingInfoStream  -  &#91;DW&#93;  &#91;RecoveryThread&#93; : anyChanges? numDocsInRam=0 deletes=false hasTickets:false pendingChangesInFullFlush: false \\n2014-01-08 13:28:21,334  &#91;RecoveryThread&#93;  INFO  solr.update.LoggingInfoStream  -  &#91;IW&#93;  &#91;RecoveryThread&#93; : nrtIsCurrent: infoVersion matches: true; DW changes: false; BD changes: false \\n2014-01-08 13:28:21,335  &#91;RecoveryThread&#93;  INFO  solr.update.LoggingInfoStream  -  &#91;DW&#93;  &#91;RecoveryThread&#93; : anyChanges? numDocsInRam=0 deletes=false hasTickets:false pendingChangesInFullFlush: false \\n2014-01-08 13:28:21,335  &#91;RecoveryThread&#93;  INFO  solr.search.SolrIndexSearcher  - Opening Searcher@5fc2a9d main \\n2014-01-08 13:28:21,338  &#91;searcherExecutor-5-thread-1&#93;  INFO  solr.core.SolrCore  - QuerySenderListener sending requests to Searcher@5fc2a9d main \\n{StandardDirectoryReader(segments_e:38:nrt _d(4.7):C26791 _e(4.7):C3356 _f(4.7):C3381)}\\n 2014-01-08 13:28:21,338  &#91;searcherExecutor-5-thread-1&#93;  INFO  solr.core.SolrCore  - QuerySenderListener done. \\n2014-01-08 13:28:21,338  &#91;searcherExecutor-5-thread-1&#93;  INFO  solr.core.SolrCore  -  &#91;demo_shard1_replica2&#93;  Registered new searcher Searcher@5fc2a9d main \\n{StandardDirectoryReader(segments_e:38:nrt _d(4.7):C26791 _e(4.7):C3356 _f(4.7):C3381)}\\n 2014-01-08 13:28:21,339  &#91;RecoveryThread&#93;  INFO  solr.update.UpdateHandler  - end_commit_flush \\n2014-01-08 13:28:21,339  &#91;RecoveryThread&#93;  INFO  solr.cloud.RecoveryStrategy  - PeerSync Recovery was successful - registering as Active. core=demo_shard1_replica2 \\n2014-01-08 13:28:21,339  &#91;RecoveryThread&#93;  INFO  solr.cloud.ZkController  - publishing core=demo_shard1_replica2 state=active \\n2014-01-08 13:28:21,370  &#91;main-EventThread&#93;  INFO  common.cloud.ZkStateReader  - A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/clusterstate.json, has occurred - updating... (live nodes size: 6) \\n\\n\\n Thus, it would seem there might be some code that\'s outright losing documents (almost feels like a last batch not flushed error but more subtle as it\'s not easy to reproduce this all the time) \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13865742\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13865742&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13865742\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13865742_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865742_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 18:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T18:50:40+0000\'\u003e08\\/Jan\\/14 18:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve noticed something like this too - but nothing i could reproduce easily. I imagine it\'s likely an issue in SolrCmdDistributor.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13865742_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865742_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 18:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T18:50:40+0000\'\u003e08\\/Jan\\/14 18:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve noticed something like this too - but nothing i could reproduce easily. I imagine it\'s likely an issue in SolrCmdDistributor.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13865744\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13865744&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13865744\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13865744_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865744_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 18:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T18:51:31+0000\'\u003e08\\/Jan\\/14 18:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlthough that doesn\'t really jive with the tran logs being identical...hmm...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13865744_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865744_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 18:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T18:51:31+0000\'\u003e08\\/Jan\\/14 18:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Although that doesn\'t really jive with the tran logs being identical...hmm...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13865769\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13865769&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13865769\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13865769_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865769_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 19:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T19:19:04+0000\'\u003e08\\/Jan\\/14 19:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNo, wait, it could jive. We only check the last 99 docs on peer sync - if bunch of docs just didn\'t show up well before that, it wouldn\'t be detected by peer sync. I still think SolrCmdDistributor is the first place to look.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13865769_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865769_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 19:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T19:19:04+0000\'\u003e08\\/Jan\\/14 19:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    No, wait, it could jive. We only check the last 99 docs on peer sync - if bunch of docs just didn\'t show up well before that, it wouldn\'t be detected by peer sync. I still think SolrCmdDistributor is the first place to look.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13865963\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13865963&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13865963\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13865963_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865963_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 22:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T22:06:55+0000\'\u003e08\\/Jan\\/14 22:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Timothy Potter - 08\\/Jan\\/14 22:09\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eStill digging into it ... I\'m curious why a batch of 34 adds on the leader gets processed as several sub-batches on the replica? Here\'s what I\'m seeing the logs around the documents that are missing from the replica. Basically, there are 34 docs on the leader and only 25 processed in 4 separate batches (from my counting of the logs) on the replica. Why wouldn\'t it just be one for one? The docs are all roughly the same size ... and what\'s breaking it up? Having trouble seeing that in the logs \\/ code \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eOn the leader:\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-08 12:23:21,501 \u003cspan class=\\\"error\\\"\u003e&#91;qtp604104855-17&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica1&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params=\u003c\\/p\u003e\\n{wt=javabin&amp;version=2} {add=[82900 (1456683668174012416), 82901 (1456683668181352448), 82903 (1456683668181352449), 82904 (1456683668181352450), 82912 (1456683668187643904), 82913 (1456683668188692480), 82914 (1456683668188692481), 82916 (1456683668188692482), 82917 (1456683668188692483), 82918 (1456683668188692484), ... (34 adds)]} 0 34\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n&gt;&gt;&gt;&gt; NOT ALL OF THE 34 DOCS MENTIONED ABOVE MAKE IT TO THE REPLICA &lt;&lt;&lt;&lt;&lt;\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n2014-01-08 12:23:21,600 \u003cspan class=\\\"error\\\"\u003e&#91;qtp604104855-17&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica1&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params={wt=javabin&amp;version=2}\\n\u003cp\u003e \u003c\\/p\u003e\\n{add=[83002 (1456683668280967168), 83005 (1456683668286210048), 83008 (1456683668286210049), 83011 (1456683668286210050), 83012 (1456683668286210051), 83013 (1456683668287258624), 83018 (1456683668287258625), 83019 (1456683668289355776), 83023 (1456683668289355777), 83024 (1456683668289355778), ... (43 adds)]}\\n\u003cp\u003e 0 32\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eOn the replica:\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-08 12:23:21,126 \u003cspan class=\\\"error\\\"\u003e&#91;qtp604104855-22&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica2&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params=\u003c\\/p\u003e\\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n\u003cp\u003e \u003c\\/p\u003e\\n{add=[82900 (1456683668174012416), 82901 (1456683668181352448), 82903 (1456683668181352449)]}\\n\u003cp\u003e 0 1\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-08 12:23:21,134 \u003cspan class=\\\"error\\\"\u003e&#91;qtp604104855-22&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica2&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params=\u003c\\/p\u003e\\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n\u003cp\u003e \u003c\\/p\u003e\\n{add=[82904 (1456683668181352450), 82912 (1456683668187643904), 82913 (1456683668188692480), 82914 (1456683668188692481), 82916 (1456683668188692482), 82917 (1456683668188692483), 82918 (1456683668188692484), 82919 (1456683668188692485), 82922 (1456683668188692486)]}\\n\u003cp\u003e 0 2\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-08 12:23:21,139 \u003cspan class=\\\"error\\\"\u003e&#91;qtp604104855-22&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica2&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params=\u003c\\/p\u003e\\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n\u003cp\u003e \u003c\\/p\u003e\\n{add=[82923 (1456683668188692487), 82926 (1456683668190789632), 82928 (1456683668190789633), 82932 (1456683668190789634), 82939 (1456683668192886784), 82945 (1456683668192886785), 82946 (1456683668192886786), 82947 (1456683668193935360), 82952 (1456683668193935361), 82962 (1456683668193935362), ... (12 adds)]}\\n\u003cp\u003e 0 3\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-08 12:23:21,144 \u003cspan class=\\\"error\\\"\u003e&#91;qtp604104855-22&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica2&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params=\u003c\\/p\u003e\\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n\u003cp\u003e \u003c\\/p\u003e\\n{add=[82967 (1456683668199178240)]}\\n\u003cp\u003e 0 0\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e&gt;&gt;&gt;&gt; 9 Docs Missing here &lt;&lt;&lt;&lt;\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-08 12:23:21,227 \u003cspan class=\\\"error\\\"\u003e&#91;qtp604104855-22&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;demo_shard1_replica2&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params=\u003c\\/p\u003e\\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n\u003cp\u003e \u003c\\/p\u003e\\n{add=[83002 (1456683668280967168), 83005 (1456683668286210048), 83008 (1456683668286210049), 83011 (1456683668286210050), 83012 (1456683668286210051), 83013 (1456683668287258624)]}\\n\u003cp\u003e 0 2\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eNote the add log message starting with doc ID 83002 is just included here for context to show where the leader \\/ replica got out of sync.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13865963_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865963_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 22:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T22:06:55+0000\'\u003e08\\/Jan\\/14 22:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Timothy Potter - 08\\/Jan\\/14 22:09\\\"\u003eedited\u003c\\/span\u003e                   Still digging into it ... I\'m curious why a batch of 34 adds on the leader gets processed as several sub-batches on the replica? Here\'s what I\'m seeing the logs around the documents that are missing from the replica. Basically, there are 34 docs on the leader and only 25 processed in 4 separate batches (from my counting of the logs) on the replica. Why wouldn\'t it just be one for one? The docs are all roughly the same size ... and what\'s breaking it up? Having trouble seeing that in the logs \\/ code   \\n\\n On the leader: \\n\\n 2014-01-08 12:23:21,501  &#91;qtp604104855-17&#93;  INFO  update.processor.LogUpdateProcessor  -  \\n &#91;demo_shard1_replica1&#93;  webapp=\\/solr path=\\/update params= \\n{wt=javabin&amp;version=2} {add=[82900 (1456683668174012416), 82901 (1456683668181352448), 82903 (1456683668181352449), 82904 (1456683668181352450), 82912 (1456683668187643904), 82913 (1456683668188692480), 82914 (1456683668188692481), 82916 (1456683668188692482), 82917 (1456683668188692483), 82918 (1456683668188692484), ... (34 adds)]} 0 34 \\n \\n&gt;&gt;&gt;&gt; NOT ALL OF THE 34 DOCS MENTIONED ABOVE MAKE IT TO THE REPLICA &lt;&lt;&lt;&lt;&lt; \\n \\n2014-01-08 12:23:21,600  &#91;qtp604104855-17&#93;  INFO  update.processor.LogUpdateProcessor  -  \\n &#91;demo_shard1_replica1&#93;  webapp=\\/solr path=\\/update params={wt=javabin&amp;version=2}\\n   \\n{add=[83002 (1456683668280967168), 83005 (1456683668286210048), 83008 (1456683668286210049), 83011 (1456683668286210050), 83012 (1456683668286210051), 83013 (1456683668287258624), 83018 (1456683668287258625), 83019 (1456683668289355776), 83023 (1456683668289355777), 83024 (1456683668289355778), ... (43 adds)]}\\n  0 32 \\n\\n\\n On the replica: \\n\\n 2014-01-08 12:23:21,126  &#91;qtp604104855-22&#93;  INFO  update.processor.LogUpdateProcessor  -  \\n &#91;demo_shard1_replica2&#93;  webapp=\\/solr path=\\/update params= \\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n   \\n{add=[82900 (1456683668174012416), 82901 (1456683668181352448), 82903 (1456683668181352449)]}\\n  0 1 \\n\\n 2014-01-08 12:23:21,134  &#91;qtp604104855-22&#93;  INFO  update.processor.LogUpdateProcessor  -  \\n &#91;demo_shard1_replica2&#93;  webapp=\\/solr path=\\/update params= \\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n   \\n{add=[82904 (1456683668181352450), 82912 (1456683668187643904), 82913 (1456683668188692480), 82914 (1456683668188692481), 82916 (1456683668188692482), 82917 (1456683668188692483), 82918 (1456683668188692484), 82919 (1456683668188692485), 82922 (1456683668188692486)]}\\n  0 2 \\n\\n 2014-01-08 12:23:21,139  &#91;qtp604104855-22&#93;  INFO  update.processor.LogUpdateProcessor  -  \\n &#91;demo_shard1_replica2&#93;  webapp=\\/solr path=\\/update params= \\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n   \\n{add=[82923 (1456683668188692487), 82926 (1456683668190789632), 82928 (1456683668190789633), 82932 (1456683668190789634), 82939 (1456683668192886784), 82945 (1456683668192886785), 82946 (1456683668192886786), 82947 (1456683668193935360), 82952 (1456683668193935361), 82962 (1456683668193935362), ... (12 adds)]}\\n  0 3 \\n\\n 2014-01-08 12:23:21,144  &#91;qtp604104855-22&#93;  INFO  update.processor.LogUpdateProcessor  -  \\n &#91;demo_shard1_replica2&#93;  webapp=\\/solr path=\\/update params= \\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n   \\n{add=[82967 (1456683668199178240)]}\\n  0 0 \\n\\n\\n &gt;&gt;&gt;&gt; 9 Docs Missing here &lt;&lt;&lt;&lt; \\n\\n 2014-01-08 12:23:21,227  &#91;qtp604104855-22&#93;  INFO  update.processor.LogUpdateProcessor  -  \\n &#91;demo_shard1_replica2&#93;  webapp=\\/solr path=\\/update params= \\n{distrib.from=http:\\/\\/ec2-54-209-223-12.compute-1.amazonaws.com:8984\\/solr\\/demo_shard1_replica1\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n   \\n{add=[83002 (1456683668280967168), 83005 (1456683668286210048), 83008 (1456683668286210049), 83011 (1456683668286210050), 83012 (1456683668286210051), 83013 (1456683668287258624)]}\\n  0 2 \\n\\n\\n Note the add log message starting with doc ID 83002 is just included here for context to show where the leader \\/ replica got out of sync.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13865984\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13865984&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13865984\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_13865984_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865984_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 22:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T22:29:04+0000\'\u003e08\\/Jan\\/14 22:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 08\\/Jan\\/14 22:29\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eBasically, there are 34 docs on the leader and only 25 processed in 4 separate batches (from my counting of the logs) on the replica. Why wouldn\'t it just be one for one? The docs are all roughly the same size ... and what\'s breaking it up? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eConcurrentUpdateSolrServer?  If another doc doesn\'t come in quickly enough (250ms by default), it ends the batch.\u003cbr\\/\u003e\\nI thought there used to be a doc count limit too or something... but after a quick scan, I\'m not seeing it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_13865984_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13865984_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 22:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T22:29:04+0000\'\u003e08\\/Jan\\/14 22:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 08\\/Jan\\/14 22:29\\\"\u003eedited\u003c\\/span\u003e                   \\n Basically, there are 34 docs on the leader and only 25 processed in 4 separate batches (from my counting of the logs) on the replica. Why wouldn\'t it just be one for one? The docs are all roughly the same size ... and what\'s breaking it up?   \\n\\n ConcurrentUpdateSolrServer?  If another doc doesn\'t come in quickly enough (250ms by default), it ends the batch. \\nI thought there used to be a doc count limit too or something... but after a quick scan, I\'m not seeing it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13866031\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13866031&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13866031\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13866031_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13866031_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T23:15:45+0000\'\u003e08\\/Jan\\/14 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Timothy Potter - 08\\/Jan\\/14 23:18\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCuss on CUSS \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e Thanks, I sometimes forget that the client-side batch gets broken into individual AddUpdateCommands when sending on to the replicas.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13866031_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13866031_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/14 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-08T23:15:45+0000\'\u003e08\\/Jan\\/14 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Timothy Potter - 08\\/Jan\\/14 23:18\\\"\u003eedited\u003c\\/span\u003e                   Cuss on CUSS   Thanks, I sometimes forget that the client-side batch gets broken into individual AddUpdateCommands when sending on to the replicas.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13869134\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13869134&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13869134\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13869134_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13869134_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/14 20:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-12T20:27:20+0000\'\u003e12\\/Jan\\/14 20:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIn this case there is no wait due to the massive penalty it puts on doc per request speed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13869134_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13869134_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/14 20:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-12T20:27:20+0000\'\u003e12\\/Jan\\/14 20:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    In this case there is no wait due to the massive penalty it puts on doc per request speed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13869137\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13869137&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13869137\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13869137_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13869137_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/14 20:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-12T20:38:16+0000\'\u003e12\\/Jan\\/14 20:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5625\\\" title=\\\"Add to testing for SolrCmdDistributor\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5625\\\"\u003e\u003cdel\u003eSOLR-5625\u003c\\/del\u003e\u003c\\/a\u003e: Add to testing for SolrCmdDistributor\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13869137_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13869137_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/14 20:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-12T20:38:16+0000\'\u003e12\\/Jan\\/14 20:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                      SOLR-5625  : Add to testing for SolrCmdDistributor              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13869916\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13869916&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13869916\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13869916_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13869916_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Jan\\/14 20:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-13T20:12:05+0000\'\u003e13\\/Jan\\/14 20:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMake sense about not waiting because of the penalty now that I\'ve had a chance to get into the details of that code.\u003c\\/p\u003e\\n\\n\u003cp\u003eI spent a lot of time on Friday and over the weekend trying to track down the docs getting dropped. Unfortunately have not been able to track down the source of the issue yet. I\'m fairly certain the issue happens before docs get submitted to CUSS, meaning that the lost docs never seemed to hit the queue in ConcurrentUpdateSolrServer. My original thinking was that given the complex nature of CUSS, there might be some sort of race condition but after having added a log of what hit the queue, it seems that the documents that get lost never hit the queue. Not to mention that the actual use of CUSS is mostly single-threaded because StreamingSolrServers construct them with a threadCount of 1.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs a side note, one thing I noticed while is that direct updates don\'t necessarily hit the correct core initially when a Solr node hosts more than one shard per collection. In other words, if host X had shard1 and shard3 of collection foo, then some update requests would hit shard1 on host X when they should go to shard3 on the same host; shard1 correctly forwards them on but it\'s still an extra hop. Of course that is probably not a big deal in production as it would be rare to host multiple shards of the same collection in the same Solr host, unless they are over-sharding.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn terms of this issue, here\'s what I\'m seeing:\u003c\\/p\u003e\\n\\n\u003cp\u003eAssume a SolrCloud environment with shard1 having replicas on host A and B; A is the current leader\u003cbr\\/\u003e\\nclient sends direct update request to shard1 on host A containing 3 docs (1,2,3) (for example)\u003cbr\\/\u003e\\nbatch from client gets broken up into individual docs (during request parsing)\u003cbr\\/\u003e\\ndocs 1,2,3 get indexed on host A (the leader)\u003cbr\\/\u003e\\ndocs 1 and 2 get queued into CUSS and sent on to the replica on host B (sometimes in the same request, sometimes in separate requests)\u003cbr\\/\u003e\\ndoc 3 never makes it and from what I can tell, never hits the queue\u003c\\/p\u003e\\n\\n\u003cp\u003eThis may be anecdotal but from what I can tell, it\'s always docs on the end of a batch and not in the middle. Meaning that I haven\'t seen a case where 1 and 3 make it and 2 not ... maybe useful, maybe not. The only other thing I\'ll mention is it does seem timing \\/ race condition related as it\'s almost impossible to reproduce this on my Mac when running 2 shards across 2 nodes but much easier to trigger if I ramp up to say 8 shards on 2 nodes, i.e. the busier my CPU is, the easier it is to see docs getting dropped.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13869916_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13869916_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Jan\\/14 20:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-13T20:12:05+0000\'\u003e13\\/Jan\\/14 20:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Make sense about not waiting because of the penalty now that I\'ve had a chance to get into the details of that code. \\n\\n I spent a lot of time on Friday and over the weekend trying to track down the docs getting dropped. Unfortunately have not been able to track down the source of the issue yet. I\'m fairly certain the issue happens before docs get submitted to CUSS, meaning that the lost docs never seemed to hit the queue in ConcurrentUpdateSolrServer. My original thinking was that given the complex nature of CUSS, there might be some sort of race condition but after having added a log of what hit the queue, it seems that the documents that get lost never hit the queue. Not to mention that the actual use of CUSS is mostly single-threaded because StreamingSolrServers construct them with a threadCount of 1. \\n\\n As a side note, one thing I noticed while is that direct updates don\'t necessarily hit the correct core initially when a Solr node hosts more than one shard per collection. In other words, if host X had shard1 and shard3 of collection foo, then some update requests would hit shard1 on host X when they should go to shard3 on the same host; shard1 correctly forwards them on but it\'s still an extra hop. Of course that is probably not a big deal in production as it would be rare to host multiple shards of the same collection in the same Solr host, unless they are over-sharding. \\n\\n In terms of this issue, here\'s what I\'m seeing: \\n\\n Assume a SolrCloud environment with shard1 having replicas on host A and B; A is the current leader \\nclient sends direct update request to shard1 on host A containing 3 docs (1,2,3) (for example) \\nbatch from client gets broken up into individual docs (during request parsing) \\ndocs 1,2,3 get indexed on host A (the leader) \\ndocs 1 and 2 get queued into CUSS and sent on to the replica on host B (sometimes in the same request, sometimes in separate requests) \\ndoc 3 never makes it and from what I can tell, never hits the queue \\n\\n This may be anecdotal but from what I can tell, it\'s always docs on the end of a batch and not in the middle. Meaning that I haven\'t seen a case where 1 and 3 make it and 2 not ... maybe useful, maybe not. The only other thing I\'ll mention is it does seem timing \\/ race condition related as it\'s almost impossible to reproduce this on my Mac when running 2 shards across 2 nodes but much easier to trigger if I ramp up to say 8 shards on 2 nodes, i.e. the busier my CPU is, the easier it is to see docs getting dropped. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13870068\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13870068&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13870068\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13870068_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870068_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Jan\\/14 22:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-13T22:26:14+0000\'\u003e13\\/Jan\\/14 22:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHow many threads are you using to load docs? How large are the batches?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13870068_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870068_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Jan\\/14 22:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-13T22:26:14+0000\'\u003e13\\/Jan\\/14 22:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    How many threads are you using to load docs? How large are the batches?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13870197\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13870197&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13870197\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13870197_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870197_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 00:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T00:49:16+0000\'\u003e14\\/Jan\\/14 00:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOddly enough, just 1 indexing thread on the client side and batches of around 30-40 docs per shard (ie I set my batch size so that direct updates send about 30-40 per shard to the leaders from the client side).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13870197_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870197_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 00:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T00:49:16+0000\'\u003e14\\/Jan\\/14 00:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oddly enough, just 1 indexing thread on the client side and batches of around 30-40 docs per shard (ie I set my batch size so that direct updates send about 30-40 per shard to the leaders from the client side).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13870858\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13870858&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13870858\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13870858_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870858_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 16:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T16:22:18+0000\'\u003e14\\/Jan\\/14 16:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\" class=\\\"user-hover\\\" rel=\\\"markus17\\\"\u003eMarkus Jelsma\u003c\\/a\u003e, are you loading docs via the bulk methods or cuss or what?\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\" class=\\\"user-hover\\\" rel=\\\"tim.potter\\\"\u003eTimothy Potter\u003c\\/a\u003e, I think I\'m seeing your issue. Have not gotten to the bottom of it yet, but if I am seeing the same thing, it seems those docs are being setup to send to 0 replicas. Trying to figure out why\\/how.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13870858_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870858_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 16:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T16:22:18+0000\'\u003e14\\/Jan\\/14 16:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Markus Jelsma , are you loading docs via the bulk methods or cuss or what? \\n\\n  Timothy Potter , I think I\'m seeing your issue. Have not gotten to the bottom of it yet, but if I am seeing the same thing, it seems those docs are being setup to send to 0 replicas. Trying to figure out why\\/how.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13870859\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13870859&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13870859\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13870859_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870859_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T16:23:08+0000\'\u003e14\\/Jan\\/14 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFYI, I also had to overshard to see anything.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13870859_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870859_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T16:23:08+0000\'\u003e14\\/Jan\\/14 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    FYI, I also had to overshard to see anything.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13870865\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13870865&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13870865\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13870865_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870865_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T16:28:09+0000\'\u003e14\\/Jan\\/14 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMark - We use CloudSolrServer and send batches of around 380 documents from Nutch. I am not sure what actual implementation we get back when connecting.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13870865_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870865_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T16:28:09+0000\'\u003e14\\/Jan\\/14 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mark - We use CloudSolrServer and send batches of around 380 documents from Nutch. I am not sure what actual implementation we get back when connecting.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13870868\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13870868&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13870868\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13870868_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870868_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 16:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T16:33:02+0000\'\u003e14\\/Jan\\/14 16:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI also think i\'m seeing this happening right now with a trunk build of yesterday. I am slowly indexing few hundred docs every few minutes for quite some time for fixing a Nutch issue. Looks like i can restart it because replica\'s are already out of sync \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13870868_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870868_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 16:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T16:33:02+0000\'\u003e14\\/Jan\\/14 16:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I also think i\'m seeing this happening right now with a trunk build of yesterday. I am slowly indexing few hundred docs every few minutes for quite some time for fixing a Nutch issue. Looks like i can restart it because replica\'s are already out of sync                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13870984\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13870984&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13870984\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13870984_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870984_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T18:11:43+0000\'\u003e14\\/Jan\\/14 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\" class=\\\"user-hover\\\" rel=\\\"markus17\\\"\u003eMarkus Jelsma\u003c\\/a\u003e, are you indexing to an oversharded cluster?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13870984_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13870984_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/14 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-14T18:11:43+0000\'\u003e14\\/Jan\\/14 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Markus Jelsma , are you indexing to an oversharded cluster?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13871878\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13871878&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13871878\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13871878_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13871878_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jan\\/14 09:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-15T09:59:46+0000\'\u003e15\\/Jan\\/14 09:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 15\\/Jan\\/14 10:12\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMark, no, each node holds a single JVM and single core. We have 5 leaders and five replica\'s, so ten nodes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13871878_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13871878_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jan\\/14 09:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-15T09:59:46+0000\'\u003e15\\/Jan\\/14 09:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 15\\/Jan\\/14 10:12\\\"\u003eedited\u003c\\/span\u003e                   Mark, no, each node holds a single JVM and single core. We have 5 leaders and five replica\'s, so ten nodes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13872666\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13872666&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13872666\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13872666_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13872666_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jan\\/14 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-15T22:07:20+0000\'\u003e15\\/Jan\\/14 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell the affects I was seeing related to having a control collection with a core named collection1 and another collection called collection1. Over shard, and that causes some similar looking effects.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve addressed that and will see if ramping up my tests can spot anything - so far cannot replicate in a test though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13872666_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13872666_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jan\\/14 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-15T22:07:20+0000\'\u003e15\\/Jan\\/14 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well the affects I was seeing related to having a control collection with a core named collection1 and another collection called collection1. Over shard, and that causes some similar looking effects. \\n\\n I\'ve addressed that and will see if ramping up my tests can spot anything - so far cannot replicate in a test though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873303\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873303&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873303\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13873303_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873303_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 11:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T11:56:06+0000\'\u003e16\\/Jan\\/14 11:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 16\\/Jan\\/14 12:14\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDid something crucial change recently? Since at least the 13th, maybe earlier, indexing small segments from Nutch in several cycles (few hundred per cycle), some shards get out of sync really quick! I did lots of tests before that but didn\'t see it happening before.\u003c\\/p\u003e\\n\\n\u003cp\u003eOk, someting did change. I reverted back to a build of the 6th and everything is fine. I can run the index process from Nutch for many cycles and more data. No shard is going out of sync with itself.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13873303_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873303_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 11:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T11:56:06+0000\'\u003e16\\/Jan\\/14 11:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 16\\/Jan\\/14 12:14\\\"\u003eedited\u003c\\/span\u003e                   Did something crucial change recently? Since at least the 13th, maybe earlier, indexing small segments from Nutch in several cycles (few hundred per cycle), some shards get out of sync really quick! I did lots of tests before that but didn\'t see it happening before. \\n\\n Ok, someting did change. I reverted back to a build of the 6th and everything is fine. I can run the index process from Nutch for many cycles and more data. No shard is going out of sync with itself.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873334\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873334&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873334\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13873334_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873334_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 12:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T12:59:55+0000\'\u003e16\\/Jan\\/14 12:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCorrection: it happens on a build of the 6th as well, although it doens\'t look that bad as when index to a 13th build.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13873334_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873334_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 12:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T12:59:55+0000\'\u003e16\\/Jan\\/14 12:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Correction: it happens on a build of the 6th as well, although it doens\'t look that bad as when index to a 13th build.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873457\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873457&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873457\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13873457_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873457_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 14:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T14:56:03+0000\'\u003e16\\/Jan\\/14 14:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSeems autocommit has something to do with triggering the problem, at least in my case.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003e13th build without autocommit: out of sync very soon\u003c\\/li\u003e\\n\\t\u003cli\u003e13th build with autocommit: out of sync after a while\u003c\\/li\u003e\\n\\t\u003cli\u003e6th build without autocommit: out of sync after a while\u003c\\/li\u003e\\n\\t\u003cli\u003e6th build with autocommit: out of sync after many more documents\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13873457_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873457_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 14:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T14:56:03+0000\'\u003e16\\/Jan\\/14 14:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Seems autocommit has something to do with triggering the problem, at least in my case. \\n\\n \\n\\t 13th build without autocommit: out of sync very soon \\n\\t 13th build with autocommit: out of sync after a while \\n\\t 6th build without autocommit: out of sync after a while \\n\\t 6th build with autocommit: out of sync after many more documents \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873638\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873638&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873638\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13873638_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873638_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 17:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T17:29:33+0000\'\u003e16\\/Jan\\/14 17:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe commit behavior is interesting. I\'m seeing docs flushing from the leader to replica following a manual hard commit issued long after indexing has stopped. That means somewhere along the way docs are buffered and waiting for an event to flush them to the replica. I haven\'t figured out just yet where the buffering is occurring but I\'m trying to track it down. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13873638_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873638_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 17:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T17:29:33+0000\'\u003e16\\/Jan\\/14 17:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The commit behavior is interesting. I\'m seeing docs flushing from the leader to replica following a manual hard commit issued long after indexing has stopped. That means somewhere along the way docs are buffered and waiting for an event to flush them to the replica. I haven\'t figured out just yet where the buffering is occurring but I\'m trying to track it down.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873657\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873657&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873657\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873657_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873657_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 17:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T17:48:09+0000\'\u003e16\\/Jan\\/14 17:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI spent some time a while back trying to find a fault in ConcurrentSolrServer#blockUntilFinished - didn\'t uncover anything yet though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873657_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873657_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 17:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T17:48:09+0000\'\u003e16\\/Jan\\/14 17:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I spent some time a while back trying to find a fault in ConcurrentSolrServer#blockUntilFinished - didn\'t uncover anything yet though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873788\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873788&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873788\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13873788_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873788_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 19:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T19:10:35+0000\'\u003e16\\/Jan\\/14 19:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m betting it\'s something in the streaming. This afternoon I\'m going to put some debugging in to see if the docs being flushed by the commit were already written to the stream. My bet is that they were, and that the commit is pushing them all the way through to the replica. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13873788_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873788_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 19:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T19:10:35+0000\'\u003e16\\/Jan\\/14 19:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m betting it\'s something in the streaming. This afternoon I\'m going to put some debugging in to see if the docs being flushed by the commit were already written to the stream. My bet is that they were, and that the commit is pushing them all the way through to the replica.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873841\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873841&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873841\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13873841_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873841_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 19:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T19:53:10+0000\'\u003e16\\/Jan\\/14 19:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI was able to reproduce this issue on EC2 without any over-sharding (on latest rev on branch_4x) ... basically 6 Solr nodes with 3 shards and RF=2, i.e. each replica gets its own Solr instance. Here\'s the output from my client app that traps the inconsistency:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt;&gt;&gt;&gt;&gt;\u003cbr\\/\u003e\\nFound 1 shards with mis-matched doc counts.\u003cbr\\/\u003e\\nAt January 16, 2014 12:18:08 PM MST\u003cbr\\/\u003e\\nshard2: {\u003cbr\\/\u003e\\n\\t\u003ca href=\\\"http:\\/\\/ec2-54-236-245-61.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica2\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-54-236-245-61.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica2\\/\u003c\\/a\u003e = 62984 LEADER\u003cbr\\/\u003e\\n\\t\u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica1\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica1\\/\u003c\\/a\u003e = 62980 diff:4\u003cbr\\/\u003e\\n}\u003cbr\\/\u003e\\nDetails:\u003cbr\\/\u003e\\nshard2\u003cbr\\/\u003e\\n&gt;&gt; finished querying leader, found 62984 documents (62984)\u003cbr\\/\u003e\\n&gt;&gt; finished querying \u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica1\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica1\\/\u003c\\/a\u003e, found 62980 documents\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;182866&#93;\u003c\\/span\u003e not found in replica: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;182866&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-1257345242&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.92657363&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.5259114828332452&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1457415570117885953&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;182859&#93;\u003c\\/span\u003e not found in replica: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;182859&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;991366909&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.5311716&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.10846350752086309&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1457415570117885952&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;182872&#93;\u003c\\/span\u003e not found in replica: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;182872&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;824512897&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.830366&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.6560223698806142&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1457415570117885954&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nDoc \u003cspan class=\\\"error\\\"\u003e&#91;182876&#93;\u003c\\/span\u003e not found in replica: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;182876&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-1657831473&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.4877965&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.9214420679315872&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\"\u003cem\u003eversion\u003c\\/em\u003e\\\"&gt;1457415570117885955&lt;\\/field&gt;&lt;\\/doc&gt;\u003cbr\\/\u003e\\nSending hard commit after mis-match and then will wait for user to handle it ...\u003cbr\\/\u003e\\n&lt;&lt;&lt;&lt;&lt;&lt;\u003c\\/p\u003e\\n\\n\u003cp\u003eSo four missing docs: 182866, 182859, 182872, 182876\u003c\\/p\u003e\\n\\n\u003cp\u003eNow I\'m thinking this might be in the ConcurrentUpdateSolrServer logic. I added some detailed logging to show when JavabinLoader unmarshals a doc and when it is offered on the CUSS queue (to be sent to the replica). On the leader, here\'s the log around some messages that were lost:\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-16 14:16:37,534 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182857\u003cbr\\/\u003e\\n2014-01-16 14:16:37,534 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182857\u003cbr\\/\u003e\\n\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\u003cbr\\/\u003e\\n2014-01-16 14:16:37,552 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182859\u003cbr\\/\u003e\\n2014-01-16 14:16:37,552 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182859\u003cbr\\/\u003e\\n2014-01-16 14:16:37,552 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182866\u003cbr\\/\u003e\\n2014-01-16 14:16:37,552 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182866\u003cbr\\/\u003e\\n2014-01-16 14:16:37,552 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182872\u003cbr\\/\u003e\\n2014-01-16 14:16:37,552 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182872\u003cbr\\/\u003e\\n2014-01-16 14:16:37,552 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182876\u003cbr\\/\u003e\\n2014-01-16 14:16:37,552 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182876\u003cbr\\/\u003e\\n2014-01-16 14:16:37,558 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cspan class=\\\"error\\\"\u003e&#91;test_shard2_replica2&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params=\u003c\\/p\u003e\\n{wt=javabin&amp;version=2}\\n\u003cp\u003e \u003c\\/p\u003e\\n{add=[182704 (1457415570048679936), 182710 (1457415570049728512), 182711 (1457415570049728513), 182717 (1457415570056019968), 182720 (1457415570056019969), 182722 (1457415570057068544), 182723 (1457415570057068545), 182724 (1457415570058117120), 182730 (1457415570058117121), 182735 (1457415570059165696), ... (61 adds)]}\\n\u003cp\u003e 0 72\u003cbr\\/\u003e\\n\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\u003cbr\\/\u003e\\n2014-01-16 14:16:37,764 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182880\u003cbr\\/\u003e\\n2014-01-16 14:16:37,764 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-17&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182880\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eAs you can see, the leader received doc with ID:182859 at 2014-01-16 14:16:37,552 and the queued it on the CUSS queue to be sent to the replica. On the replica, the log shows it receiving 182857 and then 182880 ... the 4 missing docs (182866, 182859, 182872, 182876) were definitely queued in CUSS on the leader. I\'ve checked the logs on all the other replicas and the docs didn\'t go there either.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e2014-01-16 14:16:37,292 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-14&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test_shard2_replica1 add: 182857\u003cbr\\/\u003e\\n2014-01-16 14:16:37,293 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-14&#93;\u003c\\/span\u003e INFO  update.processor.LogUpdateProcessor  - \u003cspan class=\\\"error\\\"\u003e&#91;test_shard2_replica1&#93;\u003c\\/span\u003e webapp=\\/solr path=\\/update params=\u003c\\/p\u003e\\n{distrib.from=http:\\/\\/ec2-54-236-245-61.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica2\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n\u003cp\u003e \u003c\\/p\u003e\\n{add=[182841 (1457415570096914432), 182842 (1457415570096914433), 182843 (1457415570096914434), 182844 (1457415570096914435), 182846 (1457415570097963008), 182848 (1457415570097963009), 182850 (1457415570099011584), 182854 (1457415570099011585), 182857 (1457415570099011586)]}\\n\u003cp\u003e 0 2\u003cbr\\/\u003e\\n2014-01-16 14:16:37,521 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-14&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test_shard2_replica1 add: 182880\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eSo it seems like a \\\"batch\\\" of docs queued on the leader just got missed ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13873841_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873841_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 19:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T19:53:10+0000\'\u003e16\\/Jan\\/14 19:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I was able to reproduce this issue on EC2 without any over-sharding (on latest rev on branch_4x) ... basically 6 Solr nodes with 3 shards and RF=2, i.e. each replica gets its own Solr instance. Here\'s the output from my client app that traps the inconsistency: \\n\\n &gt;&gt;&gt;&gt;&gt;&gt; \\nFound 1 shards with mis-matched doc counts. \\nAt January 16, 2014 12:18:08 PM MST \\nshard2: { \\n\\t http:\\/\\/ec2-54-236-245-61.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica2\\/  = 62984 LEADER \\n\\t http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica1\\/  = 62980 diff:4 \\n} \\nDetails: \\nshard2 \\n&gt;&gt; finished querying leader, found 62984 documents (62984) \\n&gt;&gt; finished querying  http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica1\\/ , found 62980 documents \\nDoc  &#91;182866&#93;  not found in replica: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;182866&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-1257345242&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.92657363&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.5259114828332452&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1457415570117885953&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;182859&#93;  not found in replica: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;182859&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;991366909&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.5311716&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.10846350752086309&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1457415570117885952&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;182872&#93;  not found in replica: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;182872&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;824512897&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.830366&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.6560223698806142&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1457415570117885954&lt;\\/field&gt;&lt;\\/doc&gt; \\nDoc  &#91;182876&#93;  not found in replica: &lt;doc boost=\\\"1.0\\\"&gt;&lt;field name=\\\"id\\\"&gt;182876&lt;\\/field&gt;&lt;field name=\\\"string_s\\\"&gt;test&lt;\\/field&gt;&lt;field name=\\\"int_i\\\"&gt;-1657831473&lt;\\/field&gt;&lt;field name=\\\"float_f\\\"&gt;0.4877965&lt;\\/field&gt;&lt;field name=\\\"double_d\\\"&gt;0.9214420679315872&lt;\\/field&gt;&lt;field name=\\\"text_en\\\"&gt;this is a test&lt;\\/field&gt;&lt;field name=\\\" version \\\"&gt;1457415570117885955&lt;\\/field&gt;&lt;\\/doc&gt; \\nSending hard commit after mis-match and then will wait for user to handle it ... \\n&lt;&lt;&lt;&lt;&lt;&lt; \\n\\n So four missing docs: 182866, 182859, 182872, 182876 \\n\\n Now I\'m thinking this might be in the ConcurrentUpdateSolrServer logic. I added some detailed logging to show when JavabinLoader unmarshals a doc and when it is offered on the CUSS queue (to be sent to the replica). On the leader, here\'s the log around some messages that were lost: \\n\\n 2014-01-16 14:16:37,534  &#91;qtp417447538-17&#93;  INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182857 \\n2014-01-16 14:16:37,534  &#91;qtp417447538-17&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182857 \\n\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/ \\n2014-01-16 14:16:37,552  &#91;qtp417447538-17&#93;  INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182859 \\n2014-01-16 14:16:37,552  &#91;qtp417447538-17&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182859 \\n2014-01-16 14:16:37,552  &#91;qtp417447538-17&#93;  INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182866 \\n2014-01-16 14:16:37,552  &#91;qtp417447538-17&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182866 \\n2014-01-16 14:16:37,552  &#91;qtp417447538-17&#93;  INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182872 \\n2014-01-16 14:16:37,552  &#91;qtp417447538-17&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182872 \\n2014-01-16 14:16:37,552  &#91;qtp417447538-17&#93;  INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182876 \\n2014-01-16 14:16:37,552  &#91;qtp417447538-17&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182876 \\n2014-01-16 14:16:37,558  &#91;qtp417447538-17&#93;  INFO  update.processor.LogUpdateProcessor  -  &#91;test_shard2_replica2&#93;  webapp=\\/solr path=\\/update params= \\n{wt=javabin&amp;version=2}\\n   \\n{add=[182704 (1457415570048679936), 182710 (1457415570049728512), 182711 (1457415570049728513), 182717 (1457415570056019968), 182720 (1457415570056019969), 182722 (1457415570057068544), 182723 (1457415570057068545), 182724 (1457415570058117120), 182730 (1457415570058117121), 182735 (1457415570059165696), ... (61 adds)]}\\n  0 72 \\n\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/ \\n2014-01-16 14:16:37,764  &#91;qtp417447538-17&#93;  INFO  handler.loader.JavabinLoader  - test_shard2_replica2 add: 182880 \\n2014-01-16 14:16:37,764  &#91;qtp417447538-17&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - test_shard2_replica2 queued: 182880 \\n\\n\\n As you can see, the leader received doc with ID:182859 at 2014-01-16 14:16:37,552 and the queued it on the CUSS queue to be sent to the replica. On the replica, the log shows it receiving 182857 and then 182880 ... the 4 missing docs (182866, 182859, 182872, 182876) were definitely queued in CUSS on the leader. I\'ve checked the logs on all the other replicas and the docs didn\'t go there either. \\n\\n\\n 2014-01-16 14:16:37,292  &#91;qtp417447538-14&#93;  INFO  handler.loader.JavabinLoader  - test_shard2_replica1 add: 182857 \\n2014-01-16 14:16:37,293  &#91;qtp417447538-14&#93;  INFO  update.processor.LogUpdateProcessor  -  &#91;test_shard2_replica1&#93;  webapp=\\/solr path=\\/update params= \\n{distrib.from=http:\\/\\/ec2-54-236-245-61.compute-1.amazonaws.com:8985\\/solr\\/test_shard2_replica2\\/&amp;update.distrib=FROMLEADER&amp;wt=javabin&amp;version=2}\\n   \\n{add=[182841 (1457415570096914432), 182842 (1457415570096914433), 182843 (1457415570096914434), 182844 (1457415570096914435), 182846 (1457415570097963008), 182848 (1457415570097963009), 182850 (1457415570099011584), 182854 (1457415570099011585), 182857 (1457415570099011586)]}\\n  0 2 \\n2014-01-16 14:16:37,521  &#91;qtp417447538-14&#93;  INFO  handler.loader.JavabinLoader  - test_shard2_replica1 add: 182880 \\n\\n\\n So it seems like a \\\"batch\\\" of docs queued on the leader just got missed ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873851\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873851&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873851\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shikhar\\\" id=\\\"commentauthor_13873851_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shikhar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shikhar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shikhar Bhushan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873851_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 19:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T19:58:58+0000\'\u003e16\\/Jan\\/14 19:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis may be unrelated - I have not done much digging or looked at the full context, but was just looking at CUSS out of curiosity.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhy do we flush() the OutputStream, but then write() on stuff like ending tags? Shouldn\'t the flush be after all those writes()\'s?\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/github.com\\/apache\\/lucene-solr\\/blob\\/lucene_solr_4_6\\/solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/client\\/solrj\\/impl\\/ConcurrentUpdateSolrServer.java#L205\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/github.com\\/apache\\/lucene-solr\\/blob\\/lucene_solr_4_6\\/solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/client\\/solrj\\/impl\\/ConcurrentUpdateSolrServer.java#L205\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shikhar\\\" id=\\\"commentauthor_13873851_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shikhar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shikhar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shikhar Bhushan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873851_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 19:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T19:58:58+0000\'\u003e16\\/Jan\\/14 19:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This may be unrelated - I have not done much digging or looked at the full context, but was just looking at CUSS out of curiosity. \\n\\n Why do we flush() the OutputStream, but then write() on stuff like ending tags? Shouldn\'t the flush be after all those writes()\'s? \\n\\n  https:\\/\\/github.com\\/apache\\/lucene-solr\\/blob\\/lucene_solr_4_6\\/solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/client\\/solrj\\/impl\\/ConcurrentUpdateSolrServer.java#L205               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873868\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873868&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873868\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873868_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873868_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 20:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T20:04:41+0000\'\u003e16\\/Jan\\/14 20:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI\'ve checked the logs on all the other replicas and the docs didn\'t go there either.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSo strange - it would be a different CUSS instance used for each server....\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873868_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873868_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 20:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T20:04:41+0000\'\u003e16\\/Jan\\/14 20:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I\'ve checked the logs on all the other replicas and the docs didn\'t go there either.  \\n\\n So strange - it would be a different CUSS instance used for each server....              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873874\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873874&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873874\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13873874_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873874_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 20:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T20:11:36+0000\'\u003e16\\/Jan\\/14 20:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat was a blind alley, a faulty test was causing the effect I described above.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13873874_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873874_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 20:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T20:11:36+0000\'\u003e16\\/Jan\\/14 20:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That was a blind alley, a faulty test was causing the effect I described above.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873882\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873882&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873882\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873882_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873882_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 20:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T20:17:38+0000\'\u003e16\\/Jan\\/14 20:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 16\\/Jan\\/14 20:17\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have various theories, but without a test that fails, it\'s hard to test out anything - so I\'ve been putting most of my efforts into a unit test that can get this, but it\'s been surprisingly difficult for me to trigger in a test.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873882_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873882_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 20:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T20:17:38+0000\'\u003e16\\/Jan\\/14 20:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 16\\/Jan\\/14 20:17\\\"\u003eedited\u003c\\/span\u003e                   I have various theories, but without a test that fails, it\'s hard to test out anything - so I\'ve been putting most of my efforts into a unit test that can get this, but it\'s been surprisingly difficult for me to trigger in a test.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873888\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873888&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873888\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13873888_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873888_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 20:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T20:25:22+0000\'\u003e16\\/Jan\\/14 20:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Timothy Potter - 16\\/Jan\\/14 20:34\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eSo strange - it would be a different CUSS instance used for each server....\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eright, I was just mentioning that I did check to make sure there wasn\'t a bug in the routing logic or anything like that but I now see that was silly because it wouldn\'t be able to go to the other replicas because the message was on the correct queue \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eagreed on the need for a unit test to reproduce this and am working on the same.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13873888_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873888_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 20:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T20:25:22+0000\'\u003e16\\/Jan\\/14 20:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Timothy Potter - 16\\/Jan\\/14 20:34\\\"\u003eedited\u003c\\/span\u003e                    So strange - it would be a different CUSS instance used for each server....  \\n\\n right, I was just mentioning that I did check to make sure there wasn\'t a bug in the routing logic or anything like that but I now see that was silly because it wouldn\'t be able to go to the other replicas because the message was on the correct queue   \\n\\n agreed on the need for a unit test to reproduce this and am working on the same.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873951\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873951&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873951\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13873951_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873951_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 21:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T21:15:09+0000\'\u003e16\\/Jan\\/14 21:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAdded some more logging on the leader ... as a bit of context, the replica received doc with ID 41029 and then 41041 and didn\'t receive 41033 and 41038 in between ... here\'s the log on the leader of activity between 41029 and then 41041.\u003c\\/p\u003e\\n\\n\u003cp\u003e2014-01-16 16:03:02,523 \u003cspan class=\\\"error\\\"\u003e&#91;updateExecutor-1-thread-1&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - sent docs to \u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\u003c\\/a\u003e , 41003, 41\u003cbr\\/\u003e\\n005, 41007, 41010, 41014, 41015, 41026, 41029\u003cbr\\/\u003e\\n2014-01-16 16:03:02,527 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test3_shard3_replica2 add: 41033\u003cbr\\/\u003e\\n2014-01-16 16:03:02,527 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  update.processor.DistributedUpdateProcessor  - doLocalAdd 41033\u003cbr\\/\u003e\\n2014-01-16 16:03:02,527 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - test3_shard3_replica2 queued (to: \u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1):\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1):\u003c\\/a\u003e 41033\u003cbr\\/\u003e\\n2014-01-16 16:03:02,528 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  handler.loader.JavabinLoader  - test3_shard3_replica2 add: 41038\u003cbr\\/\u003e\\n2014-01-16 16:03:02,528 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  update.processor.DistributedUpdateProcessor  - doLocalAdd 41038\u003cbr\\/\u003e\\n2014-01-16 16:03:02,528 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - test3_shard3_replica2 queued (to: \u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1):\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1):\u003c\\/a\u003e 41038\u003cbr\\/\u003e\\n2014-01-16 16:03:02,559 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - blockUntilFinished starting \u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\u003c\\/a\u003e\u003cbr\\/\u003e\\n2014-01-16 16:03:02,559 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - blockUntilFinished is done for \u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\u003c\\/a\u003e\u003cbr\\/\u003e\\n2014-01-16 16:03:02,559 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - shutting down CUSS for \u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\u003c\\/a\u003e\u003cbr\\/\u003e\\n2014-01-16 16:03:02,559 \u003cspan class=\\\"error\\\"\u003e&#91;qtp417447538-16&#93;\u003c\\/span\u003e INFO  solrj.impl.ConcurrentUpdateSolrServer  - shut down CUSS for \u003ca href=\\\"http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eNot quite sure what this means but I think you\'re hunch about blockUntilFinished being involved is getting warmer\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13873951_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873951_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 21:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T21:15:09+0000\'\u003e16\\/Jan\\/14 21:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Added some more logging on the leader ... as a bit of context, the replica received doc with ID 41029 and then 41041 and didn\'t receive 41033 and 41038 in between ... here\'s the log on the leader of activity between 41029 and then 41041. \\n\\n 2014-01-16 16:03:02,523  &#91;updateExecutor-1-thread-1&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - sent docs to  http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1  , 41003, 41 \\n005, 41007, 41010, 41014, 41015, 41026, 41029 \\n2014-01-16 16:03:02,527  &#91;qtp417447538-16&#93;  INFO  handler.loader.JavabinLoader  - test3_shard3_replica2 add: 41033 \\n2014-01-16 16:03:02,527  &#91;qtp417447538-16&#93;  INFO  update.processor.DistributedUpdateProcessor  - doLocalAdd 41033 \\n2014-01-16 16:03:02,527  &#91;qtp417447538-16&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - test3_shard3_replica2 queued (to:  http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1):  41033 \\n2014-01-16 16:03:02,528  &#91;qtp417447538-16&#93;  INFO  handler.loader.JavabinLoader  - test3_shard3_replica2 add: 41038 \\n2014-01-16 16:03:02,528  &#91;qtp417447538-16&#93;  INFO  update.processor.DistributedUpdateProcessor  - doLocalAdd 41038 \\n2014-01-16 16:03:02,528  &#91;qtp417447538-16&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - test3_shard3_replica2 queued (to:  http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1):  41038 \\n2014-01-16 16:03:02,559  &#91;qtp417447538-16&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - blockUntilFinished starting  http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1  \\n2014-01-16 16:03:02,559  &#91;qtp417447538-16&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - blockUntilFinished is done for  http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1  \\n2014-01-16 16:03:02,559  &#91;qtp417447538-16&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - shutting down CUSS for  http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1  \\n2014-01-16 16:03:02,559  &#91;qtp417447538-16&#93;  INFO  solrj.impl.ConcurrentUpdateSolrServer  - shut down CUSS for  http:\\/\\/ec2-107-21-55-0.compute-1.amazonaws.com:8985\\/solr\\/test3_shard3_replica1  \\n\\n Not quite sure what this means but I think you\'re hunch about blockUntilFinished being involved is getting warmer              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873964\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873964&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873964\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873964_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873964_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 21:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T21:21:12+0000\'\u003e16\\/Jan\\/14 21:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor a long time, I\'ve wanted to try putting in a check that the queue is empty as well for blockUntilFinished when we use it in this case - I just need a test that sees this so I can check if it works \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eWithout that, it seems there is a window where we can bail before we are done sending everything in the queue. Shutdown doesn\'t help much, because it can\'t even wait for the executor to shutdown in this case.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873964_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873964_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 21:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T21:21:12+0000\'\u003e16\\/Jan\\/14 21:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For a long time, I\'ve wanted to try putting in a check that the queue is empty as well for blockUntilFinished when we use it in this case - I just need a test that sees this so I can check if it works   \\n\\n Without that, it seems there is a window where we can bail before we are done sending everything in the queue. Shutdown doesn\'t help much, because it can\'t even wait for the executor to shutdown in this case.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13873988\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13873988&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13873988\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873988_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873988_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 21:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T21:39:17+0000\'\u003e16\\/Jan\\/14 21:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch attached that does the above.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13873988_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13873988_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 21:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T21:39:17+0000\'\u003e16\\/Jan\\/14 21:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch attached that does the above.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874031\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874031&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874031\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874031_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874031_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 22:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T22:09:12+0000\'\u003e16\\/Jan\\/14 22:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat\'s all I have come up with so far - though I\'m not even completely sold on it. Because we are using CUSS with a single thread, all the previous doc adds should have hit the request method and so a Runner should be going for them if necessary.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s all pretty tricky logic to understand clearly though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874031_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874031_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 22:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T22:09:12+0000\'\u003e16\\/Jan\\/14 22:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That\'s all I have come up with so far - though I\'m not even completely sold on it. Because we are using CUSS with a single thread, all the previous doc adds should have hit the request method and so a Runner should be going for them if necessary. \\n\\n It\'s all pretty tricky logic to understand clearly though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874098\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874098&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874098\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13874098_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874098_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 22:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T22:49:44+0000\'\u003e16\\/Jan\\/14 22:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSo far so good, Mark! I applied the patch to latest rev of branch_4x and have indexed about 3M docs without hitting the issue, before the patch, I would see this issue within a few minutes. So jury is still out and I\'ll keep stress testing it, but looks promising. Nice work!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13874098_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874098_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 22:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T22:49:44+0000\'\u003e16\\/Jan\\/14 22:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    So far so good, Mark! I applied the patch to latest rev of branch_4x and have indexed about 3M docs without hitting the issue, before the patch, I would see this issue within a few minutes. So jury is still out and I\'ll keep stress testing it, but looks promising. Nice work!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874120\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874120&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874120\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13874120_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874120_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 23:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T23:09:12+0000\'\u003e16\\/Jan\\/14 23:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDid another couple of million docs in an oversharded env. 24 replicas on 6 nodes (m1.mediums so I didn\'t want to overload them too much) ... still looking good.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tim.potter\\\" id=\\\"commentauthor_13874120_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tim.potter\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tim.potter\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Timothy Potter\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874120_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/14 23:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-16T23:09:12+0000\'\u003e16\\/Jan\\/14 23:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Did another couple of million docs in an oversharded env. 24 replicas on 6 nodes (m1.mediums so I didn\'t want to overload them too much) ... still looking good.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874194\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874194&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874194\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13874194_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874194_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 00:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T00:10:09+0000\'\u003e17\\/Jan\\/14 00:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI installed the patch and ran it. \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m getting some intermittent null pointers:\u003c\\/p\u003e\\n\\n\u003cp\u003e1578995 \u003cspan class=\\\"error\\\"\u003e&#91;qtp433857665-17&#93;\u003c\\/span\u003e ERROR org.apache.solr.servlet.SolrDispatchFilter  \\u2013 null:java.lang.NullPointerException\u003cbr\\/\u003e\\n\\tat org.apache.solr.client.solrj.impl.ConcurrentUpdateSolrServer.blockUntilFinished(ConcurrentUpdateSolrServer.java:401)\u003cbr\\/\u003e\\n\\tat org.apache.solr.update.StreamingSolrServers.blockUntilFinished(StreamingSolrServers.java:99)\u003cbr\\/\u003e\\n\\tat org.apache.solr.update.SolrCmdDistributor.finish(SolrCmdDistributor.java:69)\u003cbr\\/\u003e\\n\\tat org.apache.solr.update.processor.DistributedUpdateProcessor.doFinish(DistributedUpdateProcessor.java:606)\u003cbr\\/\u003e\\n\\tat org.apache.solr.update.processor.DistributedUpdateProcessor.finish(DistributedUpdateProcessor.java:1449)\u003cbr\\/\u003e\\n\\tat org.apache.solr.update.processor.LogUpdateProcessor.finish(LogUpdateProcessorFactory.java:179)\u003cbr\\/\u003e\\n\\tat org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:83)\u003cbr\\/\u003e\\n\\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\u003cbr\\/\u003e\\n\\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1915)\u003cbr\\/\u003e\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:764)\u003cbr\\/\u003e\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:418)\u003cbr\\/\u003e\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:203)\u003cbr\\/\u003e\\n\\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13874194_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874194_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 00:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T00:10:09+0000\'\u003e17\\/Jan\\/14 00:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I installed the patch and ran it.  \\n\\n I\'m getting some intermittent null pointers: \\n\\n 1578995  &#91;qtp433857665-17&#93;  ERROR org.apache.solr.servlet.SolrDispatchFilter  \\u2013 null:java.lang.NullPointerException \\n\\tat org.apache.solr.client.solrj.impl.ConcurrentUpdateSolrServer.blockUntilFinished(ConcurrentUpdateSolrServer.java:401) \\n\\tat org.apache.solr.update.StreamingSolrServers.blockUntilFinished(StreamingSolrServers.java:99) \\n\\tat org.apache.solr.update.SolrCmdDistributor.finish(SolrCmdDistributor.java:69) \\n\\tat org.apache.solr.update.processor.DistributedUpdateProcessor.doFinish(DistributedUpdateProcessor.java:606) \\n\\tat org.apache.solr.update.processor.DistributedUpdateProcessor.finish(DistributedUpdateProcessor.java:1449) \\n\\tat org.apache.solr.update.processor.LogUpdateProcessor.finish(LogUpdateProcessorFactory.java:179) \\n\\tat org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:83) \\n\\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135) \\n\\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1915) \\n\\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:764) \\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:418) \\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:203) \\n\\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874204\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874204&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874204\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13874204_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874204_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 00:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T00:22:52+0000\'\u003e17\\/Jan\\/14 00:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Joel Bernstein - 17\\/Jan\\/14 00:34\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIn the code snippet below it looks like this line is the culprit:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e ((runner == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e &amp;&amp; queue.isEmpty()) || scheduler.isTerminated())\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e void blockUntilFinished(\u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e waitForEmptyQueue) {\\n    lock = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e CountDownLatch(1);\\n    \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Wait until no runners are running\\n\u003c\\/span\u003e      \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (;;) {\\n        Runner runner;\\n        \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (runners) {\\n          runner = runners.peek();\\n        }\\n        \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (waitForEmptyQueue) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e ((runner == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e &amp;&amp; queue.isEmpty()) || scheduler.isTerminated())\\n            \u003cspan class=\\\"code-keyword\\\"\u003ebreak\u003c\\/span\u003e;\\n        } \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (runner == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e || scheduler.isTerminated())\\n            \u003cspan class=\\\"code-keyword\\\"\u003ebreak\u003c\\/span\u003e;\\n        }\\n        runner.runnerLock.lock();\\n        runner.runnerLock.unlock();\\n      }\\n    } \u003cspan class=\\\"code-keyword\\\"\u003efinally\u003c\\/span\u003e {\\n      lock.countDown();\\n      lock = \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n    }\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13874204_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874204_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 00:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T00:22:52+0000\'\u003e17\\/Jan\\/14 00:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Joel Bernstein - 17\\/Jan\\/14 00:34\\\"\u003eedited\u003c\\/span\u003e                   In the code snippet below it looks like this line is the culprit: \\n\\n  \\n  if  ((runner ==  null  &amp;&amp; queue.isEmpty()) || scheduler.isTerminated())\\n \\n  \\n\\n  \\n   public   synchronized  void blockUntilFinished( boolean  waitForEmptyQueue) {\\n    lock =  new  CountDownLatch(1);\\n     try  {\\n       \\/\\/ Wait until no runners are running\\n        for  (;;) {\\n        Runner runner;\\n         synchronized  (runners) {\\n          runner = runners.peek();\\n        }\\n         if  (waitForEmptyQueue) {\\n           if  ((runner ==  null  &amp;&amp; queue.isEmpty()) || scheduler.isTerminated())\\n             break ;\\n        }  else  {\\n           if  (runner ==  null  || scheduler.isTerminated())\\n             break ;\\n        }\\n        runner.runnerLock.lock();\\n        runner.runnerLock.unlock();\\n      }\\n    }  finally  {\\n      lock.countDown();\\n      lock =  null ;\\n    }\\n  }\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874270\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874270&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874270\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874270_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874270_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:24:52+0000\'\u003e17\\/Jan\\/14 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eStrange Joel - queue and scheduler are both final and set in the constructor.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874270_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874270_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:24:52+0000\'\u003e17\\/Jan\\/14 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Strange Joel - queue and scheduler are both final and set in the constructor.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874294\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874294&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874294\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13874294_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874294_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:43:19+0000\'\u003e17\\/Jan\\/14 01:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt\'s actually the runner that is null:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003erunner.runnerLock.lock();\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe conditions in this statement have changed and I think made it possible for the null pointer to appear.\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e ((runner == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e &amp;&amp; queue.isEmpty()) || scheduler.isTerminated())\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13874294_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874294_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:43:19+0000\'\u003e17\\/Jan\\/14 01:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It\'s actually the runner that is null: \\n  \\n runner.runnerLock.lock();\\n \\n  \\n\\n The conditions in this statement have changed and I think made it possible for the null pointer to appear. \\n  \\n  if  ((runner ==  null  &amp;&amp; queue.isEmpty()) || scheduler.isTerminated())\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874300\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874300&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874300\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874300_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874300_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:48:43+0000\'\u003e17\\/Jan\\/14 01:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558978 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558978\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558978\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: ConcurrentUpdateSolrServer#blockUntilFinished can return before all previously added updates have finished. This could cause distributed updates meant for replicas to be lost.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874300_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874300_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:48:43+0000\'\u003e17\\/Jan\\/14 01:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558978 from  Mark Miller  in branch \'dev\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1558978  ] \\n\\n   SOLR-4260  : ConcurrentUpdateSolrServer#blockUntilFinished can return before all previously added updates have finished. This could cause distributed updates meant for replicas to be lost.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874301\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874301&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874301\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874301_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874301_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:49:28+0000\'\u003e17\\/Jan\\/14 01:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell, this is important for 4.6.1 - given Potter\'s feedback, in it goes. Please help test and review this guys. Especially around this possible NPE.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874301_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874301_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:49:28+0000\'\u003e17\\/Jan\\/14 01:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well, this is important for 4.6.1 - given Potter\'s feedback, in it goes. Please help test and review this guys. Especially around this possible NPE.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874302\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874302&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874302\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874302_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874302_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:50:58+0000\'\u003e17\\/Jan\\/14 01:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558979 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/branch_4x\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558979\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558979\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: ConcurrentUpdateSolrServer#blockUntilFinished can return before all previously added updates have finished. This could cause distributed updates meant for replicas to be lost.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874302_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874302_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:50:58+0000\'\u003e17\\/Jan\\/14 01:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558979 from  Mark Miller  in branch \'dev\\/branches\\/branch_4x\' \\n[  https:\\/\\/svn.apache.org\\/r1558979  ] \\n\\n   SOLR-4260  : ConcurrentUpdateSolrServer#blockUntilFinished can return before all previously added updates have finished. This could cause distributed updates meant for replicas to be lost.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874303\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874303&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874303\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874303_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874303_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:51:09+0000\'\u003e17\\/Jan\\/14 01:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558980 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558980\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558980\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: Add name to CHANGES\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874303_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874303_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:51:09+0000\'\u003e17\\/Jan\\/14 01:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558980 from  Mark Miller  in branch \'dev\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1558980  ] \\n\\n   SOLR-4260  : Add name to CHANGES              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874305\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874305&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874305\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874305_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874305_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:52:10+0000\'\u003e17\\/Jan\\/14 01:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558981 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/branch_4x\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558981\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558981\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: Add name to CHANGES\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874305_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874305_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:52:10+0000\'\u003e17\\/Jan\\/14 01:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558981 from  Mark Miller  in branch \'dev\\/branches\\/branch_4x\' \\n[  https:\\/\\/svn.apache.org\\/r1558981  ] \\n\\n   SOLR-4260  : Add name to CHANGES              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874311\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874311&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874311\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874311_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874311_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:59:45+0000\'\u003e17\\/Jan\\/14 01:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe conditions in this statement have changed and I think made it possible for the null pointer to appear.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAh, nice - thanks. I had already made some changes so couldn\'t line up the src lines - thought you meant the line that was the culprit was the one that the NPE came from.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll take a closer look.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874311_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874311_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 01:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T01:59:45+0000\'\u003e17\\/Jan\\/14 01:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The conditions in this statement have changed and I think made it possible for the null pointer to appear.  \\n\\n Ah, nice - thanks. I had already made some changes so couldn\'t line up the src lines - thought you meant the line that was the culprit was the one that the NPE came from. \\n\\n I\'ll take a closer look.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874314\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874314&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874314\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874314_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874314_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:00:58+0000\'\u003e17\\/Jan\\/14 02:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558982 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/lucene_solr_4_6\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558982\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558982\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: ConcurrentUpdateSolrServer#blockUntilFinished can return before all previously added updates have finished. This could cause distributed updates meant for replicas to be lost.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874314_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874314_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:00:58+0000\'\u003e17\\/Jan\\/14 02:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558982 from  Mark Miller  in branch \'dev\\/branches\\/lucene_solr_4_6\' \\n[  https:\\/\\/svn.apache.org\\/r1558982  ] \\n\\n   SOLR-4260  : ConcurrentUpdateSolrServer#blockUntilFinished can return before all previously added updates have finished. This could cause distributed updates meant for replicas to be lost.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874317\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874317&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874317\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874317_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874317_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:03:07+0000\'\u003e17\\/Jan\\/14 02:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558983 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/lucene_solr_4_6\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558983\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558983\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: Add name to CHANGES\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874317_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874317_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:03:07+0000\'\u003e17\\/Jan\\/14 02:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558983 from  Mark Miller  in branch \'dev\\/branches\\/lucene_solr_4_6\' \\n[  https:\\/\\/svn.apache.org\\/r1558983  ] \\n\\n   SOLR-4260  : Add name to CHANGES              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874320\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874320&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874320\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874320_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874320_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:06:32+0000\'\u003e17\\/Jan\\/14 02:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558985 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558985\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558985\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: Guard against NPE.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874320_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874320_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:06:32+0000\'\u003e17\\/Jan\\/14 02:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558985 from  Mark Miller  in branch \'dev\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1558985  ] \\n\\n   SOLR-4260  : Guard against NPE.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874321\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874321&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874321\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874321_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874321_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:08:01+0000\'\u003e17\\/Jan\\/14 02:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558986 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/branch_4x\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558986\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558986\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: Guard against NPE.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874321_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874321_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:08:01+0000\'\u003e17\\/Jan\\/14 02:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558986 from  Mark Miller  in branch \'dev\\/branches\\/branch_4x\' \\n[  https:\\/\\/svn.apache.org\\/r1558986  ] \\n\\n   SOLR-4260  : Guard against NPE.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874323\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874323&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874323\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874323_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874323_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:10:17+0000\'\u003e17\\/Jan\\/14 02:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558988 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/lucene_solr_4_6\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558988\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558988\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: Guard against NPE.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874323_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874323_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:10:17+0000\'\u003e17\\/Jan\\/14 02:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558988 from  Mark Miller  in branch \'dev\\/branches\\/lucene_solr_4_6\' \\n[  https:\\/\\/svn.apache.org\\/r1558988  ] \\n\\n   SOLR-4260  : Guard against NPE.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874340\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874340&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874340\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874340_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874340_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:28:39+0000\'\u003e17\\/Jan\\/14 02:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eChaosMonkeyNothingIsSafeTest is exposing an issue now with ConcurrentUpdateSolrServer - it looks like it\'s getting stuck in blockUntilFinished because the queue is not empty and no runners are being spawned to empty it.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt may be that NPE that would occurred before in this case just kept the docs from being lost \'silently\', and this is closer to the actual bug?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874340_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874340_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:28:39+0000\'\u003e17\\/Jan\\/14 02:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    ChaosMonkeyNothingIsSafeTest is exposing an issue now with ConcurrentUpdateSolrServer - it looks like it\'s getting stuck in blockUntilFinished because the queue is not empty and no runners are being spawned to empty it. \\n\\n It may be that NPE that would occurred before in this case just kept the docs from being lost \'silently\', and this is closer to the actual bug?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874345\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874345&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874345\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874345_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874345_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:36:27+0000\'\u003e17\\/Jan\\/14 02:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558996 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558996\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558996\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: If in blockUntilFinished and there are no Runners running and the queue is not empty, start a new Runner.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874345_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874345_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:36:27+0000\'\u003e17\\/Jan\\/14 02:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558996 from  Mark Miller  in branch \'dev\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1558996  ] \\n\\n   SOLR-4260  : If in blockUntilFinished and there are no Runners running and the queue is not empty, start a new Runner.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874348\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874348&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874348\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874348_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874348_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:37:36+0000\'\u003e17\\/Jan\\/14 02:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558997 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/branch_4x\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558997\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558997\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: If in blockUntilFinished and there are no Runners running and the queue is not empty, start a new Runner.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874348_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874348_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:37:36+0000\'\u003e17\\/Jan\\/14 02:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558997 from  Mark Miller  in branch \'dev\\/branches\\/branch_4x\' \\n[  https:\\/\\/svn.apache.org\\/r1558997  ] \\n\\n   SOLR-4260  : If in blockUntilFinished and there are no Runners running and the queue is not empty, start a new Runner.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874351\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874351&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874351\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874351_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874351_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:40:30+0000\'\u003e17\\/Jan\\/14 02:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted something for that.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs a separate issue, it seems to me that CUSS#shutdown should probably call blockUntilFinished as it\'s first order of business.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874351_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874351_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:40:30+0000\'\u003e17\\/Jan\\/14 02:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed something for that. \\n\\n As a separate issue, it seems to me that CUSS#shutdown should probably call blockUntilFinished as it\'s first order of business.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874352\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874352&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874352\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874352_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874352_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:40:58+0000\'\u003e17\\/Jan\\/14 02:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1558998 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/lucene_solr_4_6\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1558998\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1558998\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: If in blockUntilFinished and there are no Runners running and the queue is not empty, start a new Runner.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874352_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874352_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:40:58+0000\'\u003e17\\/Jan\\/14 02:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1558998 from  Mark Miller  in branch \'dev\\/branches\\/lucene_solr_4_6\' \\n[  https:\\/\\/svn.apache.org\\/r1558998  ] \\n\\n   SOLR-4260  : If in blockUntilFinished and there are no Runners running and the queue is not empty, start a new Runner.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874364\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874364&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874364\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874364_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874364_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:55:48+0000\'\u003e17\\/Jan\\/14 02:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is a fine fix for SolrCloud, especially for 4.6.1 - but there may be a better general fix hidden still - what seems to happen is that we have docs that enter the queue that don\'t spawn a runner. The current fix means docs can be added that will sit in the queue until you call blockUntilFinished.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874364_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874364_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 02:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T02:55:48+0000\'\u003e17\\/Jan\\/14 02:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is a fine fix for SolrCloud, especially for 4.6.1 - but there may be a better general fix hidden still - what seems to happen is that we have docs that enter the queue that don\'t spawn a runner. The current fix means docs can be added that will sit in the queue until you call blockUntilFinished.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874434\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874434&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874434\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elyograg\\\" id=\\\"commentauthor_13874434_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elyograg\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elyograg\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shawn Heisey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874434_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 04:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T04:59:06+0000\'\u003e17\\/Jan\\/14 04:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis might be old news by now, but I noticed it while updating my test system, so I\'m reporting it.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe lucene_solr_4_6 branch fails to compile with these fixes committed.  One of the changes removes the import for RemoteSolrException from SolrCmdDistributor, but the doRetries method still uses this exception.  That method is very different in 4.6 than it is in branch_4x.  Everything\'s good on branch_4x.  Re-adding the import fixes the problem, but the discrepancy between the two branches needs some investigation.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe specific code that fails to compile with the removed import seems to have been initially added to trunk by revision 1545464 (2013\\/11\\/25) and removed from trunk by revision 1546670 (2013\\/11\\/29).  It was then re-added to lucene_solr_4_6 by revision 1554122 (2013\\/12\\/29).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elyograg\\\" id=\\\"commentauthor_13874434_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elyograg\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elyograg\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shawn Heisey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874434_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 04:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T04:59:06+0000\'\u003e17\\/Jan\\/14 04:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This might be old news by now, but I noticed it while updating my test system, so I\'m reporting it. \\n\\n The lucene_solr_4_6 branch fails to compile with these fixes committed.  One of the changes removes the import for RemoteSolrException from SolrCmdDistributor, but the doRetries method still uses this exception.  That method is very different in 4.6 than it is in branch_4x.  Everything\'s good on branch_4x.  Re-adding the import fixes the problem, but the discrepancy between the two branches needs some investigation. \\n\\n The specific code that fails to compile with the removed import seems to have been initially added to trunk by revision 1545464 (2013\\/11\\/25) and removed from trunk by revision 1546670 (2013\\/11\\/29).  It was then re-added to lucene_solr_4_6 by revision 1554122 (2013\\/12\\/29).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874667\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874667&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874667\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13874667_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874667_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 11:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T11:10:37+0000\'\u003e17\\/Jan\\/14 11:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI believe the whole building now knows i cannot reproduce the problem!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13874667_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874667_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 11:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T11:10:37+0000\'\u003e17\\/Jan\\/14 11:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I believe the whole building now knows i cannot reproduce the problem!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874686\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874686&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874686\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mkhludnev\\\" id=\\\"commentauthor_13874686_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mkhludnev\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mkhludnev\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mikhail Khludnev\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874686_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 11:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T11:24:52+0000\'\u003e17\\/Jan\\/14 11:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat a great hunt, guys! Thanks a lot!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mkhludnev\\\" id=\\\"commentauthor_13874686_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mkhludnev\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mkhludnev\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mikhail Khludnev\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874686_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 11:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T11:24:52+0000\'\u003e17\\/Jan\\/14 11:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What a great hunt, guys! Thanks a lot!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874835\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874835&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874835\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13874835_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874835_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 14:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T14:45:19+0000\'\u003e17\\/Jan\\/14 14:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, just had two clean test runs with trunk. The NPE is no longer occurring and the leaders and replicas are in sync. Running through some more stress tests this morning, but so far so good.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"joel.bernstein\\\" id=\\\"commentauthor_13874835_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"joel.bernstein\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Joel Bernstein\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874835_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 14:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T14:45:19+0000\'\u003e17\\/Jan\\/14 14:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, just had two clean test runs with trunk. The NPE is no longer occurring and the leaders and replicas are in sync. Running through some more stress tests this morning, but so far so good. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874839\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874839&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874839\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874839_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874839_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 14:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T14:54:40+0000\'\u003e17\\/Jan\\/14 14:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1559125 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e in branch \'dev\\/branches\\/lucene_solr_4_6\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1559125\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1559125\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-4260\\\" title=\\\"Inconsistent numDocs between leader and replica\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-4260\\\"\u003e\u003cdel\u003eSOLR-4260\u003c\\/del\u003e\u003c\\/a\u003e: Bring back import still used on 4.6 branch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_13874839_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874839_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 14:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T14:54:40+0000\'\u003e17\\/Jan\\/14 14:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1559125 from  Mark Miller  in branch \'dev\\/branches\\/lucene_solr_4_6\' \\n[  https:\\/\\/svn.apache.org\\/r1559125  ] \\n\\n   SOLR-4260  : Bring back import still used on 4.6 branch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13874841\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13874841&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13874841\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874841_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874841_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 15:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T15:03:26+0000\'\u003e17\\/Jan\\/14 15:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Shawn - fixed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13874841_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13874841_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/14 15:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-17T15:03:26+0000\'\u003e17\\/Jan\\/14 15:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Shawn - fixed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13875755\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13875755&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13875755\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13875755_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13875755_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/14 21:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-18T21:57:41+0000\'\u003e18\\/Jan\\/14 21:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 18\\/Jan\\/14 21:59\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks everyone. I\'ll make a new JIRA issue to properly fix this. I\'m not sure we should remove this logic, it\'s a good failsafe, but ideally, we don\'t want to run out of runners when there are still updates in the queue. Calling blockUntilFinished is not supposed to be required to make sure the queue is emptied.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13875755_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13875755_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/14 21:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-01-18T21:57:41+0000\'\u003e18\\/Jan\\/14 21:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 18\\/Jan\\/14 21:59\\\"\u003eedited\u003c\\/span\u003e                   Thanks everyone. I\'ll make a new JIRA issue to properly fix this. I\'m not sure we should remove this logic, it\'s a good failsafe, but ideally, we don\'t want to run out of runners when there are still updates in the queue. Calling blockUntilFinished is not supposed to be required to make sure the queue is emptied.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13888951\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13888951&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13888951\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13888951_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13888951_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Feb\\/14 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-02T15:19:33+0000\'\u003e02\\/Feb\\/14 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCalling this done for 4.6.1. Let\'s open a new issue for anything further.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13888951_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13888951_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Feb\\/14 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-02T15:19:33+0000\'\u003e02\\/Feb\\/14 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Calling this done for 4.6.1. Let\'s open a new issue for anything further.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13897716\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=13897716&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13897716\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13897716_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13897716_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/14 10:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-11T10:39:36+0000\'\u003e11\\/Feb\\/14 10:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 11\\/Feb\\/14 10:52\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cdel\u003eignore\u003c\\/del\u003e apparently one node did not receive the update. forgive my stupidity\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markus17\\\" id=\\\"commentauthor_13897716_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markus17\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markus17\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Markus Jelsma\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13897716_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/14 10:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-11T10:39:36+0000\'\u003e11\\/Feb\\/14 10:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Markus Jelsma - 11\\/Feb\\/14 10:52\\\"\u003eedited\u003c\\/span\u003e                    ignore  apparently one node did not receive the update. forgive my stupidity              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14496055\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=14496055&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14496055\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"harisekhon\\\" id=\\\"commentauthor_14496055_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=harisekhon\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"harisekhon\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hari Sekhon\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14496055_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Apr\\/15 11:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-04-15T11:15:16+0000\'\u003e15\\/Apr\\/15 11:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Hari Sekhon - 15\\/Apr\\/15 11:37\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve seen discrepancies between leader and followers of much higher numbers on newer versions of Solr than in this ticket when running on HDFS, it might be a separate issue, raised as \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7395\\\" title=\\\"Major numDocs inconsistency between leader and follower replicas in SolrCloud on HDFS\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7395\\\"\u003eSOLR-7395\u003c\\/a\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"harisekhon\\\" id=\\\"commentauthor_14496055_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=harisekhon\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"harisekhon\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hari Sekhon\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14496055_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Apr\\/15 11:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-04-15T11:15:16+0000\'\u003e15\\/Apr\\/15 11:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Hari Sekhon - 15\\/Apr\\/15 11:37\\\"\u003eedited\u003c\\/span\u003e                   I\'ve seen discrepancies between leader and followers of much higher numbers on newer versions of Solr than in this ticket when running on HDFS, it might be a separate issue, raised as  SOLR-7395 .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14499853\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-4260?focusedCommentId=14499853&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14499853\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14499853_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14499853_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Apr\\/15 13:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-04-17T13:51:17+0000\'\u003e17\\/Apr\\/15 13:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis ticket addressed specific issues - please open a new ticket for any further reports.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14499853_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14499853_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Apr\\/15 13:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-04-17T13:51:17+0000\'\u003e17\\/Apr\\/15 13:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This ticket addressed specific issues - please open a new ticket for any further reports.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310230";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310230&amp;avatarId=22151\\\" alt=\\\"Solr\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\"\u003eSolr\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520269382712"> 
    <input type="hidden" title="jira.request.server.time" value="540"> 
    <input type="hidden" title="jira.request.id" value="1023x95438031x4"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="2"> 
    <input type="hidden" title="db.reads.time.in.ms" value="65"> 
    <input type="hidden" title="db.conns.time.in.ms" value="73"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 1023x95438031x4
	          REQUEST TIMESTAMP : [05/Mar/2018:17:03:02 +0000]
	               REQUEST TIME : 0.5400
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 2

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=40, elapsedTotal=65888437, elapsedMin=545505, elapsedMax=31700510, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=44, elapsedTotal=73081357, elapsedMin=570571, elapsedMax=31731769, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>