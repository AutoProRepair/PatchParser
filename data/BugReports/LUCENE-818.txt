<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|2023a71c0a5af34047c43520a06600a3923b61a2|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"135785eaaeebef\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-818"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-818] IndexWriter should detect when it's used after being closed - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-818] IndexWriter should detect when it's used after being closed - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-818">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-818" href="/jira/browse/LUCENE-818" id="key-val" rel="12363642">LUCENE-818</a></li>
                </ol>
                <h1 id="summary-val">IndexWriter should detect when it's used after being closed</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-818"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-818/LUCENE-818.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-818/LUCENE-818.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-818/LUCENE-818.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-818/LUCENE-818.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/minor.svg" title="Minor - Minor loss of function, or other problem where easy workaround is present." width="16"> Minor </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="2.1 ">2.1</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+2.2" title="2.2 ">2.2</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12363642-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Spinoff from this thread on java-user:</p> 
                  <p> <a href="http://www.gossamer-threads.com/lists/lucene/java-user/45986" class="external-link" rel="nofollow">http://www.gossamer-threads.com/lists/lucene/java-user/45986</a></p> 
                  <p>If you call addDocument on IndexWriter after it's closed you'll hit a<br> hard-to-explain NullPointerException (because the RAMDirectory was<br> closed). Before 2.1, apparently you won't hit any exception and the<br> IndexWrite will keep running but will have released it's write lock (I<br> think).</p> 
                  <p>I plan to fix IndexWriter methods to throw an IllegalStateException if<br> it has been closed.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-818?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-818?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-818?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-818?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12352470" data-issue-id="12363642" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12352470/LUCENE-818.patch" draggable="true" data-downloadurl="text/plain:LUCENE-818.patch:https://issues.apache.org/jira/secure/attachment/12352470/LUCENE-818.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12352470/LUCENE-818.patch" title="Latest  02/Mar/07 18:18 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-818.patch:https://issues.apache.org/jira/secure/attachment/12352470/LUCENE-818.patch">LUCENE-818.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-02T18:18:11.577Z">02/Mar/07 18:18</time>
                   </dd>
                   <dd class="attachment-size">
                    70 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12352473" data-issue-id="12363642" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12352473/LUCENE-818.take2.patch" draggable="true" data-downloadurl="text/plain:LUCENE-818.take2.patch:https://issues.apache.org/jira/secure/attachment/12352473/LUCENE-818.take2.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12352473/LUCENE-818.take2.patch" title="Latest  02/Mar/07 18:51 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-818.take2.patch:https://issues.apache.org/jira/secure/attachment/12352473/LUCENE-818.take2.patch">LUCENE-818.take2.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-02T18:51:49.966Z">02/Mar/07 18:51</time>
                   </dd>
                   <dd class="attachment-size">
                    70 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12352540" data-issue-id="12363642" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12352540/LUCENE-818.take3.patch" draggable="true" data-downloadurl="text/plain:LUCENE-818.take3.patch:https://issues.apache.org/jira/secure/attachment/12352540/LUCENE-818.take3.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12352540/LUCENE-818.take3.patch" title="Latest  04/Mar/07 09:44 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-818.take3.patch:https://issues.apache.org/jira/secure/attachment/12352540/LUCENE-818.take3.patch">LUCENE-818.take3.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-04T09:44:05.590Z">04/Mar/07 09:44</time>
                   </dd>
                   <dd class="attachment-size">
                    67 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12352817" data-issue-id="12363642" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12352817/LUCENE-818.take4.patch" draggable="true" data-downloadurl="text/plain:LUCENE-818.take4.patch:https://issues.apache.org/jira/secure/attachment/12352817/LUCENE-818.take4.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12352817/LUCENE-818.take4.patch" title="Latest  07/Mar/07 09:08 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-818.take4.patch:https://issues.apache.org/jira/secure/attachment/12352817/LUCENE-818.take4.patch">LUCENE-818.take4.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-07T09:08:18.810Z">07/Mar/07 09:08</time>
                   </dd>
                   <dd class="attachment-size">
                    68 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12353128" data-issue-id="12363642" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12353128/LUCENE-818.take5.patch" draggable="true" data-downloadurl="text/plain:LUCENE-818.take5.patch:https://issues.apache.org/jira/secure/attachment/12353128/LUCENE-818.take5.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12353128/LUCENE-818.take5.patch" title="Latest  12/Mar/07 17:52 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-818.take5.patch:https://issues.apache.org/jira/secure/attachment/12353128/LUCENE-818.take5.patch">LUCENE-818.take5.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-12T17:52:06.999Z">12/Mar/07 17:52</time>
                   </dd>
                   <dd class="attachment-size">
                    49 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_mikemccand" rel="mikemccand" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Michael McCandless&quot;,&quot;emailAddress&quot;:&quot;lucene@mikemccandless.com&quot;,&quot;username&quot;:&quot;mikemccand&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mikemccand"></span></span> Michael McCandless </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_mikemccand" rel="mikemccand" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Michael McCandless&quot;,&quot;emailAddress&quot;:&quot;lucene@mikemccandless.com&quot;,&quot;username&quot;:&quot;mikemccand&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mikemccand"></span></span> Michael McCandless </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">1</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="26/Feb/07 19:33"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-02-26T19:33:00+0000">26/Feb/07 19:33</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="19/Jun/07 08:14"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-06-19T08:14:54+0000">19/Jun/07 08:14</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="14/Mar/07 18:47"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-03-14T18:47:09+0000">14/Mar/07 18:47</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-818?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-818?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12475987\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12475987&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12475987\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12475987_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12475987_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/07 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-26T20:20:58+0000\'\u003e26\\/Feb\\/07 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI looked at Java IO as a reference for acceptable behavior in this regard. \u003c\\/p\u003e\\n\\n\u003cp\u003eIf you close a file system object and try to use it, \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eRandomAccessFile will throw IOException with: \\\"No such file or directory\\\"\u003c\\/li\u003e\\n\\t\u003cli\u003eFileWriter will throw IOException with \\\"Stream closed\\\"\u003c\\/li\u003e\\n\\t\u003cli\u003eFileOutputStream will throw IOException with \\\"Stream closed\\\"\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eSo you could say that Java did not go all the way with a well defined illegalState exception. \u003cbr\\/\u003e\\nDatabases on the other hand would give you a well definied error code.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t have a strong opinion if this is a must for Lucene or not. \u003c\\/p\u003e\\n\\n\u003cp\u003eBut if this is to be added, one way to do it is to define a Closable interface \u003c\\/p\u003e\\n{ close(); isOpen() }\\n\u003cp\u003e, implement this interface in all public classes that need to check open state (IndexWriter, IndexReader, etc.), add a single static ensureOpen(Closable) method in a utils class that would throw the IllegalState exception, and just call this method from every (public?) open-state open dependent method. I think this would keep the \'noise\' in the code to minimum.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12475987_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12475987_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/07 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-26T20:20:58+0000\'\u003e26\\/Feb\\/07 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I looked at Java IO as a reference for acceptable behavior in this regard.  \\n\\n If you close a file system object and try to use it,  \\n \\n\\t RandomAccessFile will throw IOException with: \\\"No such file or directory\\\" \\n\\t FileWriter will throw IOException with \\\"Stream closed\\\" \\n\\t FileOutputStream will throw IOException with \\\"Stream closed\\\" \\n \\n\\n\\n So you could say that Java did not go all the way with a well defined illegalState exception.  \\nDatabases on the other hand would give you a well definied error code. \\n\\n I don\'t have a strong opinion if this is a must for Lucene or not.  \\n\\n But if this is to be added, one way to do it is to define a Closable interface  \\n{ close(); isOpen() }\\n , implement this interface in all public classes that need to check open state (IndexWriter, IndexReader, etc.), add a single static ensureOpen(Closable) method in a utils class that would throw the IllegalState exception, and just call this method from every (public?) open-state open dependent method. I think this would keep the \'noise\' in the code to minimum. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12476044\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12476044&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12476044\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476044_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476044_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/07 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-26T23:54:40+0000\'\u003e26\\/Feb\\/07 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eThat approach seems a little overkill to me.\u003c\\/p\u003e\\n\\n\u003cp\u003eI would need to create a new Closeable interface, and then a static\u003cbr\\/\u003e\\n\\\"ensureOpen\\\" method somewhere else.  These would probably live in\u003cbr\\/\u003e\\nutil, so then this is all public: users see that these classes\u003cbr\\/\u003e\\nimplement Closeable, yet, it\'s not really a publicly useful feature,\u003cbr\\/\u003e\\nso it adds noise to the javadocs.\u003c\\/p\u003e\\n\\n\u003cp\u003eI was planning instead on just adding a private \\\"ensureOpen()\\\" to\u003cbr\\/\u003e\\nIndexWriter (and I agree I should do IndexReader as well) that throws\u003cbr\\/\u003e\\nIllegalStateException if it\'s closed.  I think noise is kept to the\u003cbr\\/\u003e\\nsame minimum \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/help_16.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e because all public methods that require this just have an\u003cbr\\/\u003e\\nadded ensureOpen() call at the top.  This is how IndexModifier works\u003cbr\\/\u003e\\ntoday.\u003c\\/p\u003e\\n\\n\u003cp\u003eHmm, IndexReader already throws IOException in certain cases if it\'s\u003cbr\\/\u003e\\nalready closed.  So I think I will make a new exception\u003cbr\\/\u003e\\n(AlreadyClosedException?) that subclasses IOException and throw that.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476044_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476044_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/07 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-26T23:54:40+0000\'\u003e26\\/Feb\\/07 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n That approach seems a little overkill to me. \\n\\n I would need to create a new Closeable interface, and then a static \\n\\\"ensureOpen\\\" method somewhere else.  These would probably live in \\nutil, so then this is all public: users see that these classes \\nimplement Closeable, yet, it\'s not really a publicly useful feature, \\nso it adds noise to the javadocs. \\n\\n I was planning instead on just adding a private \\\"ensureOpen()\\\" to \\nIndexWriter (and I agree I should do IndexReader as well) that throws \\nIllegalStateException if it\'s closed.  I think noise is kept to the \\nsame minimum   because all public methods that require this just have an \\nadded ensureOpen() call at the top.  This is how IndexModifier works \\ntoday. \\n\\n Hmm, IndexReader already throws IOException in certain cases if it\'s \\nalready closed.  So I think I will make a new exception \\n(AlreadyClosedException?) that subclasses IOException and throw that.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12476240\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12476240&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12476240\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gsingers\\\" id=\\\"commentauthor_12476240_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gsingers\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gsingers\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Grant Ingersoll\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476240_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 17:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T17:36:50+0000\'\u003e27\\/Feb\\/07 17:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFWIW: Some of the other Readers (actually, IndexInput) are undefined when invoking after close.  I ran into this w\\/ the FieldsReader when working on lazy loading.  See \u003ca href=\\\"http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/34109?search_string=lazy%20field%20loading;#34109\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/34109?search_string=lazy%20field%20loading;#34109\u003c\\/a\u003e\u003cbr\\/\u003e\\nfor reference.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gsingers\\\" id=\\\"commentauthor_12476240_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gsingers\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gsingers\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Grant Ingersoll\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476240_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 17:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T17:36:50+0000\'\u003e27\\/Feb\\/07 17:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    FWIW: Some of the other Readers (actually, IndexInput) are undefined when invoking after close.  I ran into this w\\/ the FieldsReader when working on lazy loading.  See  http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/34109?search_string=lazy%20field%20loading;#34109  \\nfor reference.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12476360\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12476360&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12476360\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476360_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476360_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T20:19:57+0000\'\u003e27\\/Feb\\/07 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI see, so IndexInput indeed does not track isClosed.  It\'s not easy to\u003cbr\\/\u003e\\nfix that since IndexInput is public and non-final?\u003c\\/p\u003e\\n\\n\u003cp\u003eThough I\'m actually less concerned about this one because it\'s very\u003cbr\\/\u003e\\n\\\"internal\\\" to Lucene.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m more concerned about the public paths (IndexWriter, IndexReader).\u003cbr\\/\u003e\\nUsers seem to accidentally close these classes fairly often.  I think\u003cbr\\/\u003e\\nIndexSearcher is OK because on close it at worst closes the underlying\u003cbr\\/\u003e\\nIndexReader, and then any call to that IndexReader will catch that\u003cbr\\/\u003e\\nit\'s closed.\u003c\\/p\u003e\\n\\n\u003cp\u003eOh, I see: this public path will indeed access IndexInput after it\'s\u003cbr\\/\u003e\\nbeen closed:\u003c\\/p\u003e\\n\\n\u003cp\u003e  Open reader\u003cbr\\/\u003e\\n  Get a doc w\\/ lazy field(s)\u003cbr\\/\u003e\\n  Close reader\u003cbr\\/\u003e\\n  Try to get the lazy field\'s value\u003c\\/p\u003e\\n\\n\u003cp\u003eThat last step will clone the cloneableFieldsStream after it had been\u003cbr\\/\u003e\\nclosed.  Hmmm.  Though I think we could just fix this path in\u003cbr\\/\u003e\\nFieldsReader by having it record when it\'s closed &amp; throw an\u003cbr\\/\u003e\\nAlreadyClosedException if the LazyField class is used after that?\u003cbr\\/\u003e\\nThat seems like the simplest fix.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476360_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476360_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T20:19:57+0000\'\u003e27\\/Feb\\/07 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I see, so IndexInput indeed does not track isClosed.  It\'s not easy to \\nfix that since IndexInput is public and non-final? \\n\\n Though I\'m actually less concerned about this one because it\'s very \\n\\\"internal\\\" to Lucene. \\n\\n I\'m more concerned about the public paths (IndexWriter, IndexReader). \\nUsers seem to accidentally close these classes fairly often.  I think \\nIndexSearcher is OK because on close it at worst closes the underlying \\nIndexReader, and then any call to that IndexReader will catch that \\nit\'s closed. \\n\\n Oh, I see: this public path will indeed access IndexInput after it\'s \\nbeen closed: \\n\\n   Open reader \\n  Get a doc w\\/ lazy field(s) \\n  Close reader \\n  Try to get the lazy field\'s value \\n\\n That last step will clone the cloneableFieldsStream after it had been \\nclosed.  Hmmm.  Though I think we could just fix this path in \\nFieldsReader by having it record when it\'s closed &amp; throw an \\nAlreadyClosedException if the LazyField class is used after that? \\nThat seems like the simplest fix.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12476373\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12476373&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12476373\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steven_parkes\\\" id=\\\"commentauthor_12476373_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steven_parkes\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steven_parkes\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steven Parkes\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476373_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 20:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T20:42:34+0000\'\u003e27\\/Feb\\/07 20:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eShades of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-686\\\" title=\\\"Resources not always reclaimed in scorers after each search\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-686\\\"\u003e\u003cdel\u003eLUCENE-686\u003c\\/del\u003e\u003c\\/a\u003e. It\'d be nice to agree on that one, too (though it\'s internal, not external).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steven_parkes\\\" id=\\\"commentauthor_12476373_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steven_parkes\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steven_parkes\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steven Parkes\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476373_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 20:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T20:42:34+0000\'\u003e27\\/Feb\\/07 20:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Shades of   LUCENE-686  . It\'d be nice to agree on that one, too (though it\'s internal, not external).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12476386\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12476386&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12476386\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476386_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476386_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 21:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T21:04:13+0000\'\u003e27\\/Feb\\/07 21:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eI\'m planning on adding o.a.l.store.AlreadyClosedException.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, I\'m back to subclassing this from IllegalStateException (not\u003cbr\\/\u003e\\nIOException).  There are a fair number of methods where we should\u003cbr\\/\u003e\\nthrow this exception but IOException was not already in the throws\u003cbr\\/\u003e\\nclause.  Also, since it\'s rather rare, I think subclassing an\u003cbr\\/\u003e\\nunchecked Exception is appropriate.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe only counter argument is IndexReader which currently throws\u003cbr\\/\u003e\\nIOException if it has been closed but then acquireWriteLock is called\u003cbr\\/\u003e\\n(for one of the \\\"writer\\\" methods).  So this would technically be an\u003cbr\\/\u003e\\nAPI change for this particular case in IndexReader.  But I think it\'s\u003cbr\\/\u003e\\na tiny API change especially because it does not affect user\'s code\u003cbr\\/\u003e\\nsince they already must catch the existing IOException (vs the other\u003cbr\\/\u003e\\nmethods where adding checked \\\"throws IOException\\\" would be a major API\u003cbr\\/\u003e\\nchange).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476386_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476386_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 21:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T21:04:13+0000\'\u003e27\\/Feb\\/07 21:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n I\'m planning on adding o.a.l.store.AlreadyClosedException. \\n\\n But, I\'m back to subclassing this from IllegalStateException (not \\nIOException).  There are a fair number of methods where we should \\nthrow this exception but IOException was not already in the throws \\nclause.  Also, since it\'s rather rare, I think subclassing an \\nunchecked Exception is appropriate. \\n\\n The only counter argument is IndexReader which currently throws \\nIOException if it has been closed but then acquireWriteLock is called \\n(for one of the \\\"writer\\\" methods).  So this would technically be an \\nAPI change for this particular case in IndexReader.  But I think it\'s \\na tiny API change especially because it does not affect user\'s code \\nsince they already must catch the existing IOException (vs the other \\nmethods where adding checked \\\"throws IOException\\\" would be a major API \\nchange).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477395\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477395&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477395\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477395_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477395_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 18:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T18:18:11+0000\'\u003e02\\/Mar\\/07 18:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eI added checks to all public methods in IndexReader (and its\u003cbr\\/\u003e\\nsubclasses in Lucene\'s sources: SegmentReader, MultiReader,\u003cbr\\/\u003e\\nFilteredIndexReader, ParallelReader), IndexWriter and FieldsReader\u003cbr\\/\u003e\\nthat throw AlreadyClosedException if they are used after being closed.\u003c\\/p\u003e\\n\\n\u003cp\u003eI then hit a few tests that were incorrectly closing\u003cbr\\/\u003e\\nreader\\/searcher\\/writer and then continuing to use them (or double\u003cbr\\/\u003e\\nclosing them), so I fixed those.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477395_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477395_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 18:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T18:18:11+0000\'\u003e02\\/Mar\\/07 18:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached patch. \\n\\n I added checks to all public methods in IndexReader (and its \\nsubclasses in Lucene\'s sources: SegmentReader, MultiReader, \\nFilteredIndexReader, ParallelReader), IndexWriter and FieldsReader \\nthat throw AlreadyClosedException if they are used after being closed. \\n\\n I then hit a few tests that were incorrectly closing \\nreader\\/searcher\\/writer and then continuing to use them (or double \\nclosing them), so I fixed those.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477398\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477398&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477398\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12477398_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477398_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 18:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T18:30:27+0000\'\u003e02\\/Mar\\/07 18:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThrowing that exception for close() seems a bit too restrictive...\u003cbr\\/\u003e\\nPerhaps for close() of an already closed object just do nothing?\u003cbr\\/\u003e\\nThis would be more forgiving\\/friendly to \\\"over protecting\\\" (possibly existing) applications.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12477398_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477398_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 18:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T18:30:27+0000\'\u003e02\\/Mar\\/07 18:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Throwing that exception for close() seems a bit too restrictive... \\nPerhaps for close() of an already closed object just do nothing? \\nThis would be more forgiving\\/friendly to \\\"over protecting\\\" (possibly existing) applications. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477399\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477399&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477399\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12477399_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477399_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 18:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T18:35:50+0000\'\u003e02\\/Mar\\/07 18:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Perhaps for close() of an already closed object just do nothing? \u003c\\/p\u003e\\n\\n\u003cp\u003e+1 Double-closing is sometimes hard to avoid.  I\'d rather have it ignored than force folks to, e.g., write more complicated exception handlers.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12477399_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477399_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 18:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T18:35:50+0000\'\u003e02\\/Mar\\/07 18:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Perhaps for close() of an already closed object just do nothing?  \\n\\n +1 Double-closing is sometimes hard to avoid.  I\'d rather have it ignored than force folks to, e.g., write more complicated exception handlers.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477406\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477406&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477406\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477406_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477406_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 18:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T18:51:50+0000\'\u003e02\\/Mar\\/07 18:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eExcellent point.  OK I fixed the patch to silently ignore close() when\u003cbr\\/\u003e\\nthe IndexReader, IndexWriter, FieldsReader was already closed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477406_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477406_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 18:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T18:51:50+0000\'\u003e02\\/Mar\\/07 18:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Excellent point.  OK I fixed the patch to silently ignore close() when \\nthe IndexReader, IndexWriter, FieldsReader was already closed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477412\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477412&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477412\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477412_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477412_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 19:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T19:15:59+0000\'\u003e02\\/Mar\\/07 19:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think that accessing a closed reader should continue to be undefined.\u003cbr\\/\u003e\\nIf we define it to throw an exception, then we have thread safety issues which would be too costly (IMO) to fix.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we are to add checks for a closed reader, it seems like they should only be put on methods where an additional method call would be negligible.  Hand-holding that decreases performance for everyone isn\'t something I like.  Sun often goes too far in this regard, and as a consequence, people end up rewriting their own version of classes to get better performance.\u003c\\/p\u003e\\n\\n\u003cp\u003eAfter all, this is really just making nicer error messages for incorrect programs, right?  Everyone shouldn\'t have to pay for that.  I guess I\'m a minimalist \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477412_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477412_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 19:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T19:15:59+0000\'\u003e02\\/Mar\\/07 19:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think that accessing a closed reader should continue to be undefined. \\nIf we define it to throw an exception, then we have thread safety issues which would be too costly (IMO) to fix. \\n\\n If we are to add checks for a closed reader, it seems like they should only be put on methods where an additional method call would be negligible.  Hand-holding that decreases performance for everyone isn\'t something I like.  Sun often goes too far in this regard, and as a consequence, people end up rewriting their own version of classes to get better performance. \\n\\n After all, this is really just making nicer error messages for incorrect programs, right?  Everyone shouldn\'t have to pay for that.  I guess I\'m a minimalist                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477442\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477442&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477442\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477442_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477442_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 20:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T20:53:10+0000\'\u003e02\\/Mar\\/07 20:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, this is about giving a clear (and prompt) error message when\u003cbr\\/\u003e\\nLucene is used incorrectly.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-140\\\" title=\\\"docs out of order\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-140\\\"\u003e\u003cdel\u003eLUCENE-140\u003c\\/del\u003e\u003c\\/a\u003e was also a similar situation.  In that case incorrect usage\u003cbr\\/\u003e\\ncould lead to index corruption much later.\u003c\\/p\u003e\\n\\n\u003cp\u003eI feel like that is important because it affects the perceived quality\u003cbr\\/\u003e\\nof Lucene.  Enough users seem to hit this (especially common seems to\u003cbr\\/\u003e\\nbe iterating through Hits after the reader is closed).  As Lucene\u003cbr\\/\u003e\\nadoption grows, more users will hit it.\u003c\\/p\u003e\\n\\n\u003cp\u003eBecause detection of this now is so \\\"intermittant\\\" (undefined), a\u003cbr\\/\u003e\\ndeveloper could think everything is OK in testing, push things into\u003cbr\\/\u003e\\ntheir production world, only to suddenly see an error.  Then, the\u003cbr\\/\u003e\\nerror is something strange (eg confusing NullPointerException) which\u003cbr\\/\u003e\\ndoesn\'t make it clear what\'s happened.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the IndexWriter case it\'s potentially devastating because (I\u003cbr\\/\u003e\\nthink?) if you keep using your closed IndexWriter, then, it\'s\u003cbr\\/\u003e\\noperating on the index without holding the write lock (this was pre\u003cbr\\/\u003e\\n2.1).\u003c\\/p\u003e\\n\\n\u003cp\u003eI do agree we shouldn\'t go overboard with this (eg I certainly think\u003cbr\\/\u003e\\nwe should not add checks inside things like TermDocs\\/TermPositions).\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd I agree this is in general a difficult tradeoff.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I think in this case the performance impact is likely very small; I could\u003cbr\\/\u003e\\nwork out a test to be sure.\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe we could remove checking for clearly frequently called methods\u003cbr\\/\u003e\\n(eg isDeleted)?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477442_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477442_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 20:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T20:53:10+0000\'\u003e02\\/Mar\\/07 20:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, this is about giving a clear (and prompt) error message when \\nLucene is used incorrectly. \\n\\n   LUCENE-140   was also a similar situation.  In that case incorrect usage \\ncould lead to index corruption much later. \\n\\n I feel like that is important because it affects the perceived quality \\nof Lucene.  Enough users seem to hit this (especially common seems to \\nbe iterating through Hits after the reader is closed).  As Lucene \\nadoption grows, more users will hit it. \\n\\n Because detection of this now is so \\\"intermittant\\\" (undefined), a \\ndeveloper could think everything is OK in testing, push things into \\ntheir production world, only to suddenly see an error.  Then, the \\nerror is something strange (eg confusing NullPointerException) which \\ndoesn\'t make it clear what\'s happened. \\n\\n In the IndexWriter case it\'s potentially devastating because (I \\nthink?) if you keep using your closed IndexWriter, then, it\'s \\noperating on the index without holding the write lock (this was pre \\n2.1). \\n\\n I do agree we shouldn\'t go overboard with this (eg I certainly think \\nwe should not add checks inside things like TermDocs\\/TermPositions). \\n\\n And I agree this is in general a difficult tradeoff. \\n\\n But I think in this case the performance impact is likely very small; I could \\nwork out a test to be sure. \\n\\n Maybe we could remove checking for clearly frequently called methods \\n(eg isDeleted)?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477457\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477457&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477457\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477457_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477457_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 21:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T21:35:22+0000\'\u003e02\\/Mar\\/07 21:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003e&gt; Then, the error is something strange (eg confusing NullPointerException) which doesn\'t make it clear what\'s happened. \u003c\\/p\u003e\\n\\n\u003cp\u003eI think that depends on context.  Many cases of NPEs are perfectly clear when you look at the stack trace.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; In the IndexWriter case it\'s potentially devastating\u003c\\/p\u003e\\n\\n\u003cp\u003eAgreed... when it affects correctness, we should fix.\u003c\\/p\u003e\\n\\n\u003cp\u003eAdding ensureOpen() to something like maxDoc() does not ensure correctness though - an exception may or may not be thrown in the reader is already closed (because of those thread-safety issues).  It actually increases the variability of behavior.  We need to be careful not to guarantee the throwing of the exception.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; especially common seems to be iterating through Hits after the reader is closed\u003c\\/p\u003e\\n\\n\u003cp\u003eGood point, for document() esp.  I\'m OK with the heavyweight methods.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Maybe we could remove checking for clearly frequently called methods (eg isDeleted)?\u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s one of the ones I had in mind... isDeleted() can be called millions of times for a single query.  Probably numDoc(), maxDoc(), etc, are also candidates.\u003c\\/p\u003e\\n\\n\u003cp\u003eEarlier detection of bugs when the cost is nil is good though...\u003cbr\\/\u003e\\nwhat about setting more things to null when a reader is closed?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477457_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477457_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/07 21:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-02T21:35:22+0000\'\u003e02\\/Mar\\/07 21:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n &gt; Then, the error is something strange (eg confusing NullPointerException) which doesn\'t make it clear what\'s happened.  \\n\\n I think that depends on context.  Many cases of NPEs are perfectly clear when you look at the stack trace. \\n\\n &gt; In the IndexWriter case it\'s potentially devastating \\n\\n Agreed... when it affects correctness, we should fix. \\n\\n Adding ensureOpen() to something like maxDoc() does not ensure correctness though - an exception may or may not be thrown in the reader is already closed (because of those thread-safety issues).  It actually increases the variability of behavior.  We need to be careful not to guarantee the throwing of the exception. \\n\\n &gt; especially common seems to be iterating through Hits after the reader is closed \\n\\n Good point, for document() esp.  I\'m OK with the heavyweight methods. \\n\\n &gt; Maybe we could remove checking for clearly frequently called methods (eg isDeleted)? \\n\\n That\'s one of the ones I had in mind... isDeleted() can be called millions of times for a single query.  Probably numDoc(), maxDoc(), etc, are also candidates. \\n\\n Earlier detection of bugs when the cost is nil is good though... \\nwhat about setting more things to null when a reader is closed?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477604\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477604&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477604\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477604_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477604_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Mar\\/07 10:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-03T10:31:06+0000\'\u003e03\\/Mar\\/07 10:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt;&gt; Then, the error is something strange (eg confusing NullPointerException) which doesn\'t make it clear what\'s happened.\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; I think that depends on context.  Many cases of NPEs are perfectly clear when you look at the stack trace.\u003c\\/p\u003e\\n\\n\u003cp\u003eWell for people familiar with Lucene\'s sources, yes.  But most of our\u003cbr\\/\u003e\\nusers are not and so seeing an \\\"AlreadyClosedException\\\" can make a big\u003cbr\\/\u003e\\ndifference over \u003cspan class=\\\"error\\\"\u003e&#91;possibly rather nested, and, rather delayed&#93;\u003c\\/span\u003e NPE or\u003cbr\\/\u003e\\nsomething else.\u003c\\/p\u003e\\n\\n\u003cp\u003eEG look at the poor user that led to my opening this issue (link in\u003cbr\\/\u003e\\nopening comment).  The user was understandably confused by the NPE\u003cbr\\/\u003e\\ninside the RAMDirectory.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Adding ensureOpen() to something like maxDoc() does not ensure\u003cbr\\/\u003e\\n&gt; correctness though - an exception may or may not be thrown in the\u003cbr\\/\u003e\\n&gt; reader is already closed (because of those thread-safety issues). It\u003cbr\\/\u003e\\n&gt; actually increases the variability of behavior. We need to be\u003cbr\\/\u003e\\n&gt; careful not to guarantee the throwing of the exception.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn the thread safety issue: are you saying if one thread closes the\u003cbr\\/\u003e\\nreader while another thread is using it, there is uncertainty excactly\u003cbr\\/\u003e\\nwhen the 2nd thread will hit the AlreadyClosedException (because of\u003cbr\\/\u003e\\nhow the JVM schedules the threads)?  I think this kind of thread\u003cbr\\/\u003e\\nbehavior is normal\\/expected?\u003c\\/p\u003e\\n\\n\u003cp\u003eOr is the thread safety issue something else?\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt; especially common seems to be iterating through Hits after the reader is closed\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt; Good point, for document() esp. I\'m OK with the heavyweight methods.\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt;&gt; Maybe we could remove checking for clearly frequently called methods (eg isDeleted)?\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; That\'s one of the ones I had in mind... isDeleted() can be called millions of times for a single query. Probably numDoc(), maxDoc(), etc, are also candidates.\u003c\\/p\u003e\\n\\n\u003cp\u003eOK how about we do not call ensureOpen() in these IndexReader methods?:\u003c\\/p\u003e\\n\\n\u003cp\u003e  numDoc()\u003cbr\\/\u003e\\n  maxDoc()\u003cbr\\/\u003e\\n  isDeleted()\u003c\\/p\u003e\\n\\n\u003cp\u003eI think even without checking in those methods we still catch a number\u003cbr\\/\u003e\\nof common cases:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eClose reader then try to run a search (termDocs()\\/termPositions()\u003cbr\\/\u003e\\n    catch the close)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eRun a search, close reader, then try to iterate through Hits\u003cbr\\/\u003e\\n    (document() catches the close)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eClose a reader then try to delete docs or setNorms\u003cbr\\/\u003e\\n    (deleteDocument()\\/setNorm() catch the close)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e&gt; Earlier detection of bugs when the cost is nil is good though...\u003c\\/p\u003e\\n\\n\u003cp\u003eYes I think we in general want \\\"fail-fast\\\" here.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; what about setting more things to null when a reader is closed?\u003c\\/p\u003e\\n\\n\u003cp\u003eWell ... I would prefer not to increase the frequency of getting\u003cbr\\/\u003e\\n\\\"undefined\\\" NPEs out of the reader.  If we are going to cause\u003cbr\\/\u003e\\nadditional exceptions here, I\'d like to make them intelligible to the\u003cbr\\/\u003e\\nuser (ie, AlreadyClosedException).  EG, take SegmentReader\'s \\\"si\\\"\u003cbr\\/\u003e\\n(SegmentInfo).  If we set this to null on close, then numDoc() and\u003cbr\\/\u003e\\nmaxDoc() would hit NPE instead of just returning the correct answer.\u003cbr\\/\u003e\\nI think I\'d prefer returning the correct answer for such cases.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477604_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477604_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Mar\\/07 10:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-03T10:31:06+0000\'\u003e03\\/Mar\\/07 10:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt;&gt; Then, the error is something strange (eg confusing NullPointerException) which doesn\'t make it clear what\'s happened. \\n&gt; \\n&gt; I think that depends on context.  Many cases of NPEs are perfectly clear when you look at the stack trace. \\n\\n Well for people familiar with Lucene\'s sources, yes.  But most of our \\nusers are not and so seeing an \\\"AlreadyClosedException\\\" can make a big \\ndifference over  &#91;possibly rather nested, and, rather delayed&#93;  NPE or \\nsomething else. \\n\\n EG look at the poor user that led to my opening this issue (link in \\nopening comment).  The user was understandably confused by the NPE \\ninside the RAMDirectory. \\n\\n &gt; Adding ensureOpen() to something like maxDoc() does not ensure \\n&gt; correctness though - an exception may or may not be thrown in the \\n&gt; reader is already closed (because of those thread-safety issues). It \\n&gt; actually increases the variability of behavior. We need to be \\n&gt; careful not to guarantee the throwing of the exception. \\n\\n On the thread safety issue: are you saying if one thread closes the \\nreader while another thread is using it, there is uncertainty excactly \\nwhen the 2nd thread will hit the AlreadyClosedException (because of \\nhow the JVM schedules the threads)?  I think this kind of thread \\nbehavior is normal\\/expected? \\n\\n Or is the thread safety issue something else? \\n\\n &gt;&gt; especially common seems to be iterating through Hits after the reader is closed \\n&gt;  \\n&gt; Good point, for document() esp. I\'m OK with the heavyweight methods. \\n&gt; \\n&gt;&gt; Maybe we could remove checking for clearly frequently called methods (eg isDeleted)? \\n&gt; \\n&gt; That\'s one of the ones I had in mind... isDeleted() can be called millions of times for a single query. Probably numDoc(), maxDoc(), etc, are also candidates. \\n\\n OK how about we do not call ensureOpen() in these IndexReader methods?: \\n\\n   numDoc() \\n  maxDoc() \\n  isDeleted() \\n\\n I think even without checking in those methods we still catch a number \\nof common cases: \\n\\n \\n\\t Close reader then try to run a search (termDocs()\\/termPositions() \\n    catch the close) \\n \\n\\n\\n \\n\\t Run a search, close reader, then try to iterate through Hits \\n    (document() catches the close) \\n \\n\\n\\n \\n\\t Close a reader then try to delete docs or setNorms \\n    (deleteDocument()\\/setNorm() catch the close) \\n \\n\\n\\n &gt; Earlier detection of bugs when the cost is nil is good though... \\n\\n Yes I think we in general want \\\"fail-fast\\\" here. \\n\\n &gt; what about setting more things to null when a reader is closed? \\n\\n Well ... I would prefer not to increase the frequency of getting \\n\\\"undefined\\\" NPEs out of the reader.  If we are going to cause \\nadditional exceptions here, I\'d like to make them intelligible to the \\nuser (ie, AlreadyClosedException).  EG, take SegmentReader\'s \\\"si\\\" \\n(SegmentInfo).  If we set this to null on close, then numDoc() and \\nmaxDoc() would hit NPE instead of just returning the correct answer. \\nI think I\'d prefer returning the correct answer for such cases.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477670\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477670&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477670\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477670_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477670_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Mar\\/07 19:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-03T19:50:02+0000\'\u003e03\\/Mar\\/07 19:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; On the thread safety issue: are you saying if one thread closes the\u003cbr\\/\u003e\\n&gt; reader while another thread is using it, there is uncertainty excactly\u003cbr\\/\u003e\\n&gt; when the 2nd thread will hit the AlreadyClosedException (because of\u003cbr\\/\u003e\\n&gt; how the JVM schedules the threads)?\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, but it\'s not just thread scheduling, it\'s also lack of memory barriers.  The 2nd thread may \u003cb\u003enever\u003c\\/b\u003e see the close(), depending on the exact architecture of machine and the JVM.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I think this kind of thread behavior is normal\\/expected? \u003c\\/p\u003e\\n\\n\u003cp\u003eFor a class that isn\'t thread safe, yes.  IndexReader is advertised as being thread safe though.  If we guarantee an exception accessing a closed reader, then that should work 100% of the time. I don\'t think we should make that guarantee. \u003c\\/p\u003e\\n\\n\u003cp\u003eWe can still throw meaningful errors in more cases and make it easier for the user to debug that, but it should not be deemed an error if we don\'t throw an exception.  Users should never rely on getting this exception for flow-control purposes anyway.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; OK how about we do not call ensureOpen() in these IndexReader methods?:\u003cbr\\/\u003e\\n&gt;  numDoc()\u003cbr\\/\u003e\\n&gt;  maxDoc()\u003cbr\\/\u003e\\n&gt;  isDeleted() \u003c\\/p\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cp\u003ehasDeletions() too?\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; &gt; what about setting more things to null when a reader is closed?\u003cbr\\/\u003e\\n&gt; Well ... I would prefer not to increase the frequency of getting \\\"undefined\\\" NPEs out of the reader\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, but not all bugs will be user bugs.  Some will be internal Lucene stuff that bypass public methods.\u003cbr\\/\u003e\\nIt\'s still better that these fail quicker too.  Anyway, that can be handled on a case-by-case basis later.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477670_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477670_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Mar\\/07 19:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-03T19:50:02+0000\'\u003e03\\/Mar\\/07 19:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; On the thread safety issue: are you saying if one thread closes the \\n&gt; reader while another thread is using it, there is uncertainty excactly \\n&gt; when the 2nd thread will hit the AlreadyClosedException (because of \\n&gt; how the JVM schedules the threads)? \\n\\n Yes, but it\'s not just thread scheduling, it\'s also lack of memory barriers.  The 2nd thread may  never  see the close(), depending on the exact architecture of machine and the JVM. \\n\\n &gt; I think this kind of thread behavior is normal\\/expected?  \\n\\n For a class that isn\'t thread safe, yes.  IndexReader is advertised as being thread safe though.  If we guarantee an exception accessing a closed reader, then that should work 100% of the time. I don\'t think we should make that guarantee.  \\n\\n We can still throw meaningful errors in more cases and make it easier for the user to debug that, but it should not be deemed an error if we don\'t throw an exception.  Users should never rely on getting this exception for flow-control purposes anyway. \\n\\n &gt; OK how about we do not call ensureOpen() in these IndexReader methods?: \\n&gt;  numDoc() \\n&gt;  maxDoc() \\n&gt;  isDeleted()  \\n\\n +1 \\n\\n hasDeletions() too? \\n\\n &gt; &gt; what about setting more things to null when a reader is closed? \\n&gt; Well ... I would prefer not to increase the frequency of getting \\\"undefined\\\" NPEs out of the reader \\n\\n Yes, but not all bugs will be user bugs.  Some will be internal Lucene stuff that bypass public methods. \\nIt\'s still better that these fail quicker too.  Anyway, that can be handled on a case-by-case basis later. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477713\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477713&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477713\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477713_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477713_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Mar\\/07 23:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-03T23:57:00+0000\'\u003e03\\/Mar\\/07 23:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt;&gt; On the thread safety issue: are you saying if one thread closes the\u003cbr\\/\u003e\\n&gt;&gt; reader while another thread is using it, there is uncertainty excactly\u003cbr\\/\u003e\\n&gt;&gt; when the 2nd thread will hit the AlreadyClosedException (because of\u003cbr\\/\u003e\\n&gt;&gt; how the JVM schedules the threads)?\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; Yes, but it\'s not just thread scheduling, it\'s also lack of memory\u003cbr\\/\u003e\\n&gt; barriers. The 2nd thread may \u003cb\u003enever\u003c\\/b\u003e see the close(), depending on\u003cbr\\/\u003e\\n&gt; the exact architecture of machine and the JVM.\u003c\\/p\u003e\\n\\n\u003cp\u003eYikes.  Is this the Java memory model issue?  Ie, there is no hard\u003cbr\\/\u003e\\nguarantee on when a \\\"write\\\" from one thread will be visible to other\u003cbr\\/\u003e\\nthreads, unless you use \\\"volatile\\\"?\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt; I think this kind of thread behavior is normal\\/expected?\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; For a class that isn\'t thread safe, yes. IndexReader is advertised\u003cbr\\/\u003e\\n&gt; as being thread safe though. If we guarantee an exception accessing\u003cbr\\/\u003e\\n&gt; a closed reader, then that should work 100% of the time. I don\'t\u003cbr\\/\u003e\\n&gt; think we should make that guarantee.\u003c\\/p\u003e\\n\\n\u003cp\u003eOK I think we shouldn\'t \\\"guarantee\\\" it.  I think listing as \\\"@throws\u003cbr\\/\u003e\\nAlreadyClosedException if this IndexReader is closed\\\" is OK?\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; We can still throw meaningful errors in more cases and make it\u003cbr\\/\u003e\\n&gt; easier for the user to debug that, but it should not be deemed an\u003cbr\\/\u003e\\n&gt; error if we don\'t throw an exception. Users should never rely on\u003cbr\\/\u003e\\n&gt; getting this exception for flow-control purposes anyway.\u003c\\/p\u003e\\n\\n\u003cp\u003eAgreed.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt; OK how about we do not call ensureOpen() in these IndexReader methods?:\u003cbr\\/\u003e\\n&gt;&gt; numDoc()\u003cbr\\/\u003e\\n&gt;&gt; maxDoc()\u003cbr\\/\u003e\\n&gt;&gt; isDeleted()\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; +1\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt; hasDeletions() too?\u003c\\/p\u003e\\n\\n\u003cp\u003eOK I will change to not call ensureOpen() for hasDeletions too.  I\u003cbr\\/\u003e\\nwill roll a new patch with this.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt; &gt; what about setting more things to null when a reader is closed?\u003cbr\\/\u003e\\n&gt;&gt; Well ... I would prefer not to increase the frequency of getting \\\"undefined\\\" NPEs out of the reader\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; Yes, but not all bugs will be user bugs. Some will be internal\u003cbr\\/\u003e\\n&gt; Lucene stuff that bypass public methods.  It\'s still better that\u003cbr\\/\u003e\\n&gt; these fail quicker too. Anyway, that can be handled on a\u003cbr\\/\u003e\\n&gt; case-by-case basis later.\u003c\\/p\u003e\\n\\n\u003cp\u003eOK, I agree.  Better to throw a \\\"fail-fast\\\" NPE than do something\u003cbr\\/\u003e\\nstrange later.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477713_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477713_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Mar\\/07 23:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-03T23:57:00+0000\'\u003e03\\/Mar\\/07 23:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt;&gt; On the thread safety issue: are you saying if one thread closes the \\n&gt;&gt; reader while another thread is using it, there is uncertainty excactly \\n&gt;&gt; when the 2nd thread will hit the AlreadyClosedException (because of \\n&gt;&gt; how the JVM schedules the threads)? \\n&gt; \\n&gt; Yes, but it\'s not just thread scheduling, it\'s also lack of memory \\n&gt; barriers. The 2nd thread may  never  see the close(), depending on \\n&gt; the exact architecture of machine and the JVM. \\n\\n Yikes.  Is this the Java memory model issue?  Ie, there is no hard \\nguarantee on when a \\\"write\\\" from one thread will be visible to other \\nthreads, unless you use \\\"volatile\\\"? \\n\\n &gt;&gt; I think this kind of thread behavior is normal\\/expected? \\n&gt; \\n&gt; For a class that isn\'t thread safe, yes. IndexReader is advertised \\n&gt; as being thread safe though. If we guarantee an exception accessing \\n&gt; a closed reader, then that should work 100% of the time. I don\'t \\n&gt; think we should make that guarantee. \\n\\n OK I think we shouldn\'t \\\"guarantee\\\" it.  I think listing as \\\"@throws \\nAlreadyClosedException if this IndexReader is closed\\\" is OK? \\n\\n &gt; We can still throw meaningful errors in more cases and make it \\n&gt; easier for the user to debug that, but it should not be deemed an \\n&gt; error if we don\'t throw an exception. Users should never rely on \\n&gt; getting this exception for flow-control purposes anyway. \\n\\n Agreed. \\n\\n &gt;&gt; OK how about we do not call ensureOpen() in these IndexReader methods?: \\n&gt;&gt; numDoc() \\n&gt;&gt; maxDoc() \\n&gt;&gt; isDeleted() \\n&gt; \\n&gt; +1 \\n&gt;  \\n&gt; hasDeletions() too? \\n\\n OK I will change to not call ensureOpen() for hasDeletions too.  I \\nwill roll a new patch with this. \\n\\n &gt;&gt; &gt; what about setting more things to null when a reader is closed? \\n&gt;&gt; Well ... I would prefer not to increase the frequency of getting \\\"undefined\\\" NPEs out of the reader \\n&gt; \\n&gt; Yes, but not all bugs will be user bugs. Some will be internal \\n&gt; Lucene stuff that bypass public methods.  It\'s still better that \\n&gt; these fail quicker too. Anyway, that can be handled on a \\n&gt; case-by-case basis later. \\n\\n OK, I agree.  Better to throw a \\\"fail-fast\\\" NPE than do something \\nstrange later.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477716\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477716&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477716\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"djd\\\" id=\\\"commentauthor_12477716_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=djd\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"djd\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel John Debrunner\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477716_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 00:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T00:46:06+0000\'\u003e04\\/Mar\\/07 00:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt;&gt; Yes, but it\'s not just thread scheduling, it\'s also lack of memory\u003cbr\\/\u003e\\n&gt;&gt; barriers. The 2nd thread may \u003cb\u003enever\u003c\\/b\u003e see the close(), depending on\u003cbr\\/\u003e\\n&gt;&gt; the exact architecture of machine and the JVM.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;Yikes. Is this the Java memory model issue? Ie, there is no hard\u003cbr\\/\u003e\\n&gt;guarantee on when a \\\"write\\\" from one thread will be visible to other\u003cbr\\/\u003e\\n&gt;threads, unless you use \\\"volatile\\\"? \u003c\\/p\u003e\\n\\n\u003cp\u003eDoesn\'t crossing a synchronization barrier ensure that all threads will seem the same value of a field?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"djd\\\" id=\\\"commentauthor_12477716_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=djd\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"djd\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel John Debrunner\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477716_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 00:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T00:46:06+0000\'\u003e04\\/Mar\\/07 00:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt;&gt; Yes, but it\'s not just thread scheduling, it\'s also lack of memory \\n&gt;&gt; barriers. The 2nd thread may  never  see the close(), depending on \\n&gt;&gt; the exact architecture of machine and the JVM. \\n\\n &gt;Yikes. Is this the Java memory model issue? Ie, there is no hard \\n&gt;guarantee on when a \\\"write\\\" from one thread will be visible to other \\n&gt;threads, unless you use \\\"volatile\\\"?  \\n\\n Doesn\'t crossing a synchronization barrier ensure that all threads will seem the same value of a field?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477723\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477723&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477723\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477723_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477723_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 01:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T01:35:23+0000\'\u003e04\\/Mar\\/07 01:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Doesn\'t crossing a synchronization barrier ensure that all threads will seem the same value of a field?\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, if the changing thread crosses a write barrier and the reading  thread crosses a read barrier.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe obvious implication that you need to synchronize the sets\\/gets of isClosed.  That\'s not a big deal in some cases, but in anything that could be in an inner loop, it is a big deal.  We already have reports of simple things like isDeleted() being a bottleneck on servers with many CPUs and concurrent threads because of the synchronization.  That particular sync point is something that I\'ve planned to get rid of at some point in the future by having a \\\"read only\\\" IndexReader.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477723_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477723_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 01:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T01:35:23+0000\'\u003e04\\/Mar\\/07 01:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Doesn\'t crossing a synchronization barrier ensure that all threads will seem the same value of a field? \\n\\n Yes, if the changing thread crosses a write barrier and the reading  thread crosses a read barrier. \\n\\n The obvious implication that you need to synchronize the sets\\/gets of isClosed.  That\'s not a big deal in some cases, but in anything that could be in an inner loop, it is a big deal.  We already have reports of simple things like isDeleted() being a bottleneck on servers with many CPUs and concurrent threads because of the synchronization.  That particular sync point is something that I\'ve planned to get rid of at some point in the future by having a \\\"read only\\\" IndexReader.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477724\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477724&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477724\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477724_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477724_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 01:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T01:43:39+0000\'\u003e04\\/Mar\\/07 01:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Yikes. Is this the Java memory model issue?\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, but it\'s not a problem with the Java memory model, it\'s more of a feature.  Threads in general have this problem (or perform very poorly if they don\'t).  It\'s also very much about compiler optimizations as well.  The optimizer may stuff a value in a register, and never check it\'s location in main-memory, and never see the changes.  Even if it doesn\'t then you drop down to problems with the CPU and cache + memory architectue in SMP systems.  Some systems require explicit memory barriers or cache flushes to see memory changes from another CPU.  One CPU writes to a spot in memory, and absent any special instructions, another CPU reading from that spot in memory may not see the change.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12477724_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477724_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 01:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T01:43:39+0000\'\u003e04\\/Mar\\/07 01:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Yikes. Is this the Java memory model issue? \\n\\n Yes, but it\'s not a problem with the Java memory model, it\'s more of a feature.  Threads in general have this problem (or perform very poorly if they don\'t).  It\'s also very much about compiler optimizations as well.  The optimizer may stuff a value in a register, and never check it\'s location in main-memory, and never see the changes.  Even if it doesn\'t then you drop down to problems with the CPU and cache + memory architectue in SMP systems.  Some systems require explicit memory barriers or cache flushes to see memory changes from another CPU.  One CPU writes to a spot in memory, and absent any special instructions, another CPU reading from that spot in memory may not see the change.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477767\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477767&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477767\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477767_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477767_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 09:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T09:44:05+0000\'\u003e04\\/Mar\\/07 09:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached take3, which just removes ensureOpen() checks for IndexReader\'s maxDoc(), numDoc(), hasDeletions(), isDeleted(...).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477767_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477767_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 09:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T09:44:05+0000\'\u003e04\\/Mar\\/07 09:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached take3, which just removes ensureOpen() checks for IndexReader\'s maxDoc(), numDoc(), hasDeletions(), isDeleted(...).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477875\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477875&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477875\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12477875_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477875_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T23:15:29+0000\'\u003e04\\/Mar\\/07 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI havne\'t been following this issue that closely, and i haven\'t read any of the patches, but if the goal is:\u003c\\/p\u003e\\n\\n\u003cp\u003e  \\\"reduce situations where novice users get confusing exceptions when using IndexWriter after closing it\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003e...and the concern is that calling a new \\\"ensureOpen()\\\" method at the begining of every public method may be a performacne issue, then perhaps an alternative would be to catch all exceptions inside public methods and wrap them if not closed, ie...\u003c\\/p\u003e\\n\\n\u003cp\u003e   public Foo somePublicMethod() throws IOException {\u003cbr\\/\u003e\\n       try \u003c\\/p\u003e\\n{\\n          \\/\\/ current method body\\n       }\\n\u003cp\u003e catch (Exception e) {\u003cbr\\/\u003e\\n          if (isOpen()) \u003c\\/p\u003e\\n{\\n             throw e;\\n          }\\n\u003cp\u003e else \u003c\\/p\u003e\\n{\\n             throw new AllreadyClosedException(e);\\n          }\\n\u003cp\u003e       }\u003cbr\\/\u003e\\n    }\u003c\\/p\u003e\\n\\n\u003cp\u003e...that way any performance cost of ensureOpen\\/isOpen is only payed on an existing Exception.  the down side i see to this approach is that since it only explains exceptions hte caller would get anyway, it doesn\'t give any feedback about using a closed writer in cases where the current code returns cleanly (but may not function properly) ... we might be able to solve that by adding better error checking in those specific cases (if we know of any) and throwing explicit exceptions.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12477875_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477875_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Mar\\/07 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-04T23:15:29+0000\'\u003e04\\/Mar\\/07 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I havne\'t been following this issue that closely, and i haven\'t read any of the patches, but if the goal is: \\n\\n   \\\"reduce situations where novice users get confusing exceptions when using IndexWriter after closing it\\\" \\n\\n ...and the concern is that calling a new \\\"ensureOpen()\\\" method at the begining of every public method may be a performacne issue, then perhaps an alternative would be to catch all exceptions inside public methods and wrap them if not closed, ie... \\n\\n    public Foo somePublicMethod() throws IOException { \\n       try  \\n{\\n          \\/\\/ current method body\\n       }\\n  catch (Exception e) { \\n          if (isOpen())  \\n{\\n             throw e;\\n          }\\n  else  \\n{\\n             throw new AllreadyClosedException(e);\\n          }\\n        } \\n    } \\n\\n ...that way any performance cost of ensureOpen\\/isOpen is only payed on an existing Exception.  the down side i see to this approach is that since it only explains exceptions hte caller would get anyway, it doesn\'t give any feedback about using a closed writer in cases where the current code returns cleanly (but may not function properly) ... we might be able to solve that by adding better error checking in those specific cases (if we know of any) and throwing explicit exceptions.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12477957\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12477957&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12477957\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477957_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477957_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/07 09:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-05T09:44:01+0000\'\u003e05\\/Mar\\/07 09:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTo make that work, I think we\'d have to convert the Exception into\u003cbr\\/\u003e\\neither IOException or RuntimeException before throwing it (so we don\'t\u003cbr\\/\u003e\\nhave to change method signature).\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, I think this approach adds more noise to the source code.  Also\u003cbr\\/\u003e\\nbecause it\'s \\\"after the fact\\\" then damage could have been done (I\u003cbr\\/\u003e\\n\u003cb\u003ethink\u003c\\/b\u003e IndexWriter before 2.1 would gleefully keep writing, but\u003cbr\\/\u003e\\nwithout holding the write lock!).  It would only catch cases where an\u003cbr\\/\u003e\\nexception was thrown (many times there is none) whereas I prefer \\\"fail\u003cbr\\/\u003e\\nfast\\\".\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12477957_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12477957_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/07 09:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-05T09:44:01+0000\'\u003e05\\/Mar\\/07 09:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    To make that work, I think we\'d have to convert the Exception into \\neither IOException or RuntimeException before throwing it (so we don\'t \\nhave to change method signature). \\n\\n But, I think this approach adds more noise to the source code.  Also \\nbecause it\'s \\\"after the fact\\\" then damage could have been done (I \\n think  IndexWriter before 2.1 would gleefully keep writing, but \\nwithout holding the write lock!).  It would only catch cases where an \\nexception was thrown (many times there is none) whereas I prefer \\\"fail \\nfast\\\".              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12478166\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12478166&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12478166\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12478166_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478166_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/07 21:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-05T21:32:40+0000\'\u003e05\\/Mar\\/07 21:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e1) my example attempted to be concise ... ideally we would be explicit in our catches.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) the body of the catch clauses could be put into a helper method just like ensureOpen to help reduce code noise\u003c\\/p\u003e\\n\\n\u003cp\u003e3) if there are situations where damage will be done by not testing that we are open before taking some action, that would fall under my \\\"adding better error checking in those specific cases (if we know of any) and throwing explicit exceptions.\\\" ... a lot of this could be achieved (as Yonik suggested) by nulling out more things in close so that the first attempt to do something dangerous after the close triggered a NullPointerException.\u003c\\/p\u003e\\n\\n\u003cp\u003e4) \\\"fail fast\\\" is always good ... except when it makes the non-failure case slow ... i was merely suggesting an alternative that would achieve the same results without penalizing performance of people obeying the rules.\u003c\\/p\u003e\\n\\n\u003cp\u003eas an added bonus, both methodologies could be used... \u003c\\/p\u003e\\n\\n\u003cp\u003eif numDoc(), maxDoc(), isDeleted(), and hasDeletions() are the only mehtods were people are concerned about the performance impacts of calling ensureOpen() everytime, then those methods could be the ones where isOpen could be checked in any exception handling block, and all of the other mehtods could use ensureOpen as orriginal described.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12478166_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478166_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/07 21:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-05T21:32:40+0000\'\u003e05\\/Mar\\/07 21:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    1) my example attempted to be concise ... ideally we would be explicit in our catches. \\n\\n 2) the body of the catch clauses could be put into a helper method just like ensureOpen to help reduce code noise \\n\\n 3) if there are situations where damage will be done by not testing that we are open before taking some action, that would fall under my \\\"adding better error checking in those specific cases (if we know of any) and throwing explicit exceptions.\\\" ... a lot of this could be achieved (as Yonik suggested) by nulling out more things in close so that the first attempt to do something dangerous after the close triggered a NullPointerException. \\n\\n 4) \\\"fail fast\\\" is always good ... except when it makes the non-failure case slow ... i was merely suggesting an alternative that would achieve the same results without penalizing performance of people obeying the rules. \\n\\n as an added bonus, both methodologies could be used...  \\n\\n if numDoc(), maxDoc(), isDeleted(), and hasDeletions() are the only mehtods were people are concerned about the performance impacts of calling ensureOpen() everytime, then those methods could be the ones where isOpen could be checked in any exception handling block, and all of the other mehtods could use ensureOpen as orriginal described.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12478327\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12478327&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12478327\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12478327_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478327_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/07 09:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-06T09:47:49+0000\'\u003e06\\/Mar\\/07 09:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003e&gt; 2) the body of the catch clauses could be put into a helper method just like ensureOpen to help reduce code noise\u003c\\/p\u003e\\n\\n\u003cp\u003eTrue, but I think it\'s still more code noise to have\u003cbr\\/\u003e\\ntry\\/catch\\/call-helper-method than ensureOpen() call?  Esp. since you\'d\u003cbr\\/\u003e\\nhave to handle IOException and RuntimeException as 2 separate catch\u003cbr\\/\u003e\\nclauses (I think?), each of which calls a separate helper.  Ie instead\u003cbr\\/\u003e\\nof:\u003c\\/p\u003e\\n\\n\u003cp\u003e  ensureOpen();\u003cbr\\/\u003e\\n  ...do stuff...\u003c\\/p\u003e\\n\\n\u003cp\u003ewe would need something like:\u003c\\/p\u003e\\n\\n\u003cp\u003e  try \u003c\\/p\u003e\\n{\\n    ...do stuff...\\n  }\\n\u003cp\u003e catch (IOException exc) \u003c\\/p\u003e\\n{\\n    throw ensureOpenAfterIOException(exc);\\n  }\\n\u003cp\u003e catch (RuntimeException exc) \u003c\\/p\u003e\\n{\\n    throw ensureOpenAfterRuntimeException(exc);\\n  }\\n\\n\u003cp\u003eI think?\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; 3) if there are situations where damage will be done by not testing that we are open before taking some action, that would fall under my \\\"adding better error checking in those specific cases (if we know of any) and throwing explicit exceptions.\\\" ... a lot of this could be achieved (as Yonik suggested) by nulling out more things in close so that the first attempt to do something dangerous after the close triggered a NullPointerException.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe thing is we may not know all such cases (yet)?  I prefer taking a\u003cbr\\/\u003e\\ndefensive approach here.  I don\'t really like the null-out solution\u003cbr\\/\u003e\\nbecause I think getting an AlreadyClosedException is clearer to the\u003cbr\\/\u003e\\nuser than a NPE\'s.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; 4) \\\"fail fast\\\" is always good ... except when it makes the non-failure case slow ... i was merely suggesting an alternative that would achieve the same results without penalizing performance of people obeying the rules.\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; if numDoc(), maxDoc(), isDeleted(), and hasDeletions() are the only mehtods were people are concerned about the performance impacts of calling ensureOpen() everytime, then those methods could be the ones where isOpen could be checked in any exception handling block, and all of the other mehtods could use ensureOpen as orriginal described.\u003c\\/p\u003e\\n\\n\u003cp\u003eGood idea!  An added bonus is that these methods do not throw\u003cbr\\/\u003e\\nIOException so the exception handling would just have the one\u003cbr\\/\u003e\\nRuntimeException catch clause above.  OK I will rework patch with this\u003cbr\\/\u003e\\napproach and see how it looks...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12478327_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478327_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/07 09:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-06T09:47:49+0000\'\u003e06\\/Mar\\/07 09:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n &gt; 2) the body of the catch clauses could be put into a helper method just like ensureOpen to help reduce code noise \\n\\n True, but I think it\'s still more code noise to have \\ntry\\/catch\\/call-helper-method than ensureOpen() call?  Esp. since you\'d \\nhave to handle IOException and RuntimeException as 2 separate catch \\nclauses (I think?), each of which calls a separate helper.  Ie instead \\nof: \\n\\n   ensureOpen(); \\n  ...do stuff... \\n\\n we would need something like: \\n\\n   try  \\n{\\n    ...do stuff...\\n  }\\n  catch (IOException exc)  \\n{\\n    throw ensureOpenAfterIOException(exc);\\n  }\\n  catch (RuntimeException exc)  \\n{\\n    throw ensureOpenAfterRuntimeException(exc);\\n  }\\n\\n I think? \\n\\n &gt; 3) if there are situations where damage will be done by not testing that we are open before taking some action, that would fall under my \\\"adding better error checking in those specific cases (if we know of any) and throwing explicit exceptions.\\\" ... a lot of this could be achieved (as Yonik suggested) by nulling out more things in close so that the first attempt to do something dangerous after the close triggered a NullPointerException. \\n\\n The thing is we may not know all such cases (yet)?  I prefer taking a \\ndefensive approach here.  I don\'t really like the null-out solution \\nbecause I think getting an AlreadyClosedException is clearer to the \\nuser than a NPE\'s. \\n\\n &gt; 4) \\\"fail fast\\\" is always good ... except when it makes the non-failure case slow ... i was merely suggesting an alternative that would achieve the same results without penalizing performance of people obeying the rules. \\n&gt; \\n&gt; if numDoc(), maxDoc(), isDeleted(), and hasDeletions() are the only mehtods were people are concerned about the performance impacts of calling ensureOpen() everytime, then those methods could be the ones where isOpen could be checked in any exception handling block, and all of the other mehtods could use ensureOpen as orriginal described. \\n\\n Good idea!  An added bonus is that these methods do not throw \\nIOException so the exception handling would just have the one \\nRuntimeException catch clause above.  OK I will rework patch with this \\napproach and see how it looks...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12478544\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12478544&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12478544\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12478544_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478544_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/07 19:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-06T19:55:29+0000\'\u003e06\\/Mar\\/07 19:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ei would make sure to \u003cb\u003eheavily\u003c\\/b\u003e document each and every use of isOpen\\/ensureOpen to make it clear why they are being used when they are from a performance concern case ... otherwise people will be very confused down the road (\\\"why the hell isn\'t this being checked until the catch block?!?!?!\\\")\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12478544_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478544_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/07 19:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-06T19:55:29+0000\'\u003e06\\/Mar\\/07 19:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    i would make sure to  heavily  document each and every use of isOpen\\/ensureOpen to make it clear why they are being used when they are from a performance concern case ... otherwise people will be very confused down the road (\\\"why the hell isn\'t this being checked until the catch block?!?!?!\\\")              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12478585\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12478585&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12478585\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12478585_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478585_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/07 21:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-06T21:20:51+0000\'\u003e06\\/Mar\\/07 21:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003e&gt; i would make sure to \u003cb\u003eheavily\u003c\\/b\u003e document each and every use of isOpen\\/ensureOpen to make it clear why they are being used when they are from a performance concern case ... otherwise people will be very confused down the road (\\\"why the hell isn\'t this being checked until the catch block?!?!?!\\\")\u003c\\/p\u003e\\n\\n\u003cp\u003eOK I changed my mind.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think we should add the \\\"check if closed after the fact\\\"\u003cbr\\/\u003e\\nlogic.  I reviewed the 4 methods in question (maxDoc, numDocs,\u003cbr\\/\u003e\\nhasDeletions, isDeleted) and for all subclasses of IndexReader these\u003cbr\\/\u003e\\nare very trivial methods that won\'t throw exceptions.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I\'m back to thinking this added complexity (and future confusion to\u003cbr\\/\u003e\\npeople looking @ Lucene source code) isn\'t worthwhile and we should\u003cbr\\/\u003e\\nleave these methods with no checking for whether they are already\u003cbr\\/\u003e\\nclosed.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I will document why ensureOpen is \u003cb\u003enot\u003c\\/b\u003e being called in each of\u003cbr\\/\u003e\\nthese methods.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12478585_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478585_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/07 21:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-06T21:20:51+0000\'\u003e06\\/Mar\\/07 21:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n &gt; i would make sure to  heavily  document each and every use of isOpen\\/ensureOpen to make it clear why they are being used when they are from a performance concern case ... otherwise people will be very confused down the road (\\\"why the hell isn\'t this being checked until the catch block?!?!?!\\\") \\n\\n OK I changed my mind. \\n\\n I don\'t think we should add the \\\"check if closed after the fact\\\" \\nlogic.  I reviewed the 4 methods in question (maxDoc, numDocs, \\nhasDeletions, isDeleted) and for all subclasses of IndexReader these \\nare very trivial methods that won\'t throw exceptions. \\n\\n So I\'m back to thinking this added complexity (and future confusion to \\npeople looking @ Lucene source code) isn\'t worthwhile and we should \\nleave these methods with no checking for whether they are already \\nclosed. \\n\\n But I will document why ensureOpen is  not  being called in each of \\nthese methods.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12478718\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12478718&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12478718\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12478718_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478718_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/07 09:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-07T09:08:18+0000\'\u003e07\\/Mar\\/07 09:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew patch based on above discussion: just re-based to the current trunk, and, added comments on why ensureOpen is not called in the 4 methods.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12478718_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12478718_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/07 09:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-07T09:08:18+0000\'\u003e07\\/Mar\\/07 09:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New patch based on above discussion: just re-based to the current trunk, and, added comments on why ensureOpen is not called in the 4 methods.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12479179\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12479179&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12479179\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12479179_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479179_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 00:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T00:42:54+0000\'\u003e08\\/Mar\\/07 00:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf we aren\'t guaranteeing an exception be thrown after a close, why are we bothering to put the exception in the method signature?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s already apparent to everyone that using something after it\'s closed isn\'t good, so we were just cleaning up the  error messages and making it easier to debug.  People shouldn\'t have specific application logic for this exception... it should be treated as a program error.\u003c\\/p\u003e\\n\\n\u003cp\u003eIMO, listing the exception encourages people to catch it, suggests that they can depend on the exception being thrown, and also makes it more difficult to remove it from certain methods in the future.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12479179_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479179_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 00:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T00:42:54+0000\'\u003e08\\/Mar\\/07 00:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If we aren\'t guaranteeing an exception be thrown after a close, why are we bothering to put the exception in the method signature? \\n\\n It\'s already apparent to everyone that using something after it\'s closed isn\'t good, so we were just cleaning up the  error messages and making it easier to debug.  People shouldn\'t have specific application logic for this exception... it should be treated as a program error. \\n\\n IMO, listing the exception encourages people to catch it, suggests that they can depend on the exception being thrown, and also makes it more difficult to remove it from certain methods in the future.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12479207\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12479207&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12479207\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12479207_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479207_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 03:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T03:25:19+0000\'\u003e08\\/Mar\\/07 03:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; People shouldn\'t have specific application logic for this exception... it should be treated as a program error. \u003cbr\\/\u003e\\n+1 \u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, another candidate for AlreadyClosedException upon using an already closed (RAM)Directory - came up in \u003ca href=\\\"http:\\/\\/www.nabble.com\\/sharing-my-experience-for-upgrading-from-Lucene-1.9-to-Lucene-2.2-dev-tf3366948.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.nabble.com\\/sharing-my-experience-for-upgrading-from-Lucene-1.9-to-Lucene-2.2-dev-tf3366948.html\u003c\\/a\u003e \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12479207_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479207_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 03:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T03:25:19+0000\'\u003e08\\/Mar\\/07 03:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; People shouldn\'t have specific application logic for this exception... it should be treated as a program error.  \\n+1  \\n\\n Also, another candidate for AlreadyClosedException upon using an already closed (RAM)Directory - came up in  http:\\/\\/www.nabble.com\\/sharing-my-experience-for-upgrading-from-Lucene-1.9-to-Lucene-2.2-dev-tf3366948.html   \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12479273\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12479273&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12479273\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12479273_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479273_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 09:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T09:27:03+0000\'\u003e08\\/Mar\\/07 09:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt;&gt; People shouldn\'t have specific application logic for this exception... it should be treated as a program error.\u003cbr\\/\u003e\\n&gt; +1\u003c\\/p\u003e\\n\\n\u003cp\u003eOK, agreed.  I will remove AlreadyClosedException from all @throws\u003cbr\\/\u003e\\nmethod signatures.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Also, another candidate for AlreadyClosedException upon using an already closed (RAM)Directory - came up in \u003ca href=\\\"http:\\/\\/www.nabble.com\\/sharing-my-experience-for-upgrading-from-Lucene-1.9-to-Lucene-2.2-dev-tf3366948.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.nabble.com\\/sharing-my-experience-for-upgrading-from-Lucene-1.9-to-Lucene-2.2-dev-tf3366948.html\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eYeah I saw this too.  Here\'s the relevant excerpt:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; 3. RAMDirectory related changes\u003cbr\\/\u003e\\n&gt;   It took me something to find this out. Previously, after\u003cbr\\/\u003e\\n&gt;     ramDirectory = new RAMDirectory(file)\u003cbr\\/\u003e\\n&gt;   I could ramDirectory.close() to release the resources. And later, I\u003cbr\\/\u003e\\n&gt; could do a check for IndexReader.indexExists(ramDirectory) to see if\u003cbr\\/\u003e\\n&gt; there is an index in the directory. FSDirectory behaves this way also.\u003cbr\\/\u003e\\n&gt;   But with lucene 2.2, NullPointerExceptions came out. It turns out\u003cbr\\/\u003e\\n&gt; when ramDirectory.close(), the instance variable fileMap is set to\u003cbr\\/\u003e\\n&gt; null. And IndexReader.indexExists(ramDirectory) is reading fileMap to\u003cbr\\/\u003e\\n&gt; look for indexes, causing the NPE.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn fact the original user\'s list email that started this bug was also\u003cbr\\/\u003e\\ndue to RAMDirectory setting its fileMap to null, but in that case, it\u003cbr\\/\u003e\\nwas via IndexWriter so detecting that IndexWriter is closed would\u003cbr\\/\u003e\\nprevent that one.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn this case the developer is using a RAMDirectory directly.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this is an example where \\\"nulling things out on close\\\" leads\u003cbr\\/\u003e\\nto developer confusion.  Previously RAMDirectory functioned fine after\u003cbr\\/\u003e\\nbeing closed(); now, it throws a hard to understand (unless you are\u003cbr\\/\u003e\\nfamiliar w\\/ Lucene\'s sources &amp; what specifically we changed in 2.1)\u003cbr\\/\u003e\\nNPE.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think we should fix this?\u003c\\/p\u003e\\n\\n\u003cp\u003eSince RAMDir\'s public methods are fairly hot (eg heavily used building\u003cbr\\/\u003e\\nsingle-doc RAM segment), we can use Hoss\'s neat approach and\u003cbr\\/\u003e\\nspecifically catch the NPE and rethrow as an AlreadyClosedException?\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t mind if the \\\"after close semantics\\\" is \\\"it works just like it\u003cbr\\/\u003e\\ndid when it was open\\\" (ie, close is a no-op).  I also don\'t mind if\u003cbr\\/\u003e\\nyou get a \\\"fail-fast\\\" quick AlreadyClosedException.  But I think\u003cbr\\/\u003e\\nanything in between (NPE or other undefined, intermittant exceptions)\u003cbr\\/\u003e\\nonly confuses our developers.\u003c\\/p\u003e\\n\\n\u003cp\u003eLooking at FSDirectory, it continues to work fine after close with the\u003cbr\\/\u003e\\none spooky exception that it may have been removed from the\u003cbr\\/\u003e\\nDIRECTORIES hashtable, which means if you then open the same canonical\u003cbr\\/\u003e\\npath again you get a different FSDirectory instance.  The comment\u003cbr\\/\u003e\\nstates \\\"this permits synchronization on directories\\\", but I don\'t see\u003cbr\\/\u003e\\nwhere in Lucene we are relying on this?  Ie, what could break if a\u003cbr\\/\u003e\\nuser keeps using a closed FSDirectory thus possibly having more than\u003cbr\\/\u003e\\none FSDirectory instance for a given canonical path?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12479273_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479273_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 09:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T09:27:03+0000\'\u003e08\\/Mar\\/07 09:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt;&gt; People shouldn\'t have specific application logic for this exception... it should be treated as a program error. \\n&gt; +1 \\n\\n OK, agreed.  I will remove AlreadyClosedException from all @throws \\nmethod signatures. \\n\\n &gt; Also, another candidate for AlreadyClosedException upon using an already closed (RAM)Directory - came up in  http:\\/\\/www.nabble.com\\/sharing-my-experience-for-upgrading-from-Lucene-1.9-to-Lucene-2.2-dev-tf3366948.html  \\n\\n Yeah I saw this too.  Here\'s the relevant excerpt: \\n\\n &gt; 3. RAMDirectory related changes \\n&gt;   It took me something to find this out. Previously, after \\n&gt;     ramDirectory = new RAMDirectory(file) \\n&gt;   I could ramDirectory.close() to release the resources. And later, I \\n&gt; could do a check for IndexReader.indexExists(ramDirectory) to see if \\n&gt; there is an index in the directory. FSDirectory behaves this way also. \\n&gt;   But with lucene 2.2, NullPointerExceptions came out. It turns out \\n&gt; when ramDirectory.close(), the instance variable fileMap is set to \\n&gt; null. And IndexReader.indexExists(ramDirectory) is reading fileMap to \\n&gt; look for indexes, causing the NPE. \\n\\n In fact the original user\'s list email that started this bug was also \\ndue to RAMDirectory setting its fileMap to null, but in that case, it \\nwas via IndexWriter so detecting that IndexWriter is closed would \\nprevent that one. \\n\\n In this case the developer is using a RAMDirectory directly. \\n\\n I think this is an example where \\\"nulling things out on close\\\" leads \\nto developer confusion.  Previously RAMDirectory functioned fine after \\nbeing closed(); now, it throws a hard to understand (unless you are \\nfamiliar w\\/ Lucene\'s sources &amp; what specifically we changed in 2.1) \\nNPE. \\n\\n I think we should fix this? \\n\\n Since RAMDir\'s public methods are fairly hot (eg heavily used building \\nsingle-doc RAM segment), we can use Hoss\'s neat approach and \\nspecifically catch the NPE and rethrow as an AlreadyClosedException? \\n\\n I don\'t mind if the \\\"after close semantics\\\" is \\\"it works just like it \\ndid when it was open\\\" (ie, close is a no-op).  I also don\'t mind if \\nyou get a \\\"fail-fast\\\" quick AlreadyClosedException.  But I think \\nanything in between (NPE or other undefined, intermittant exceptions) \\nonly confuses our developers. \\n\\n Looking at FSDirectory, it continues to work fine after close with the \\none spooky exception that it may have been removed from the \\nDIRECTORIES hashtable, which means if you then open the same canonical \\npath again you get a different FSDirectory instance.  The comment \\nstates \\\"this permits synchronization on directories\\\", but I don\'t see \\nwhere in Lucene we are relying on this?  Ie, what could break if a \\nuser keeps using a closed FSDirectory thus possibly having more than \\none FSDirectory instance for a given canonical path?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12479357\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12479357&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12479357\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12479357_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479357_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 16:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T16:56:38+0000\'\u003e08\\/Mar\\/07 16:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; we can use Hoss\'s neat approach and\u003cbr\\/\u003e\\n&gt; specifically catch the NPE and rethrow as an AlreadyClosedException? \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not enough of an expert to know if this would be faster or slower than a simple fileMap==null check.\u003cbr\\/\u003e\\nI would guess it depends on what needs to be set up in the stack frame to potentially catch an exception, and if the try\\/catch\\/throw code prevents any optimizations (such as inlining).\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, catching a NPE seems a little icky to me... so w\\/o more info I\'d lean toward a fileMap==null check (if anything).\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12479357_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479357_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 16:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T16:56:38+0000\'\u003e08\\/Mar\\/07 16:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; we can use Hoss\'s neat approach and \\n&gt; specifically catch the NPE and rethrow as an AlreadyClosedException?  \\n\\n I\'m not enough of an expert to know if this would be faster or slower than a simple fileMap==null check. \\nI would guess it depends on what needs to be set up in the stack frame to potentially catch an exception, and if the try\\/catch\\/throw code prevents any optimizations (such as inlining). \\n\\n Also, catching a NPE seems a little icky to me... so w\\/o more info I\'d lean toward a fileMap==null check (if anything). \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12479373\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12479373&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12479373\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12479373_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479373_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 18:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T18:06:52+0000\'\u003e08\\/Mar\\/07 18:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; I\'m not enough of an expert to know if this would be faster or slower than a simple fileMap==null check.\u003cbr\\/\u003e\\n&gt; I would guess it depends on what needs to be set up in the stack frame to potentially catch an exception, and if the try\\/catch\\/throw code prevents any optimizations (such as inlining).\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt; Also, catching a NPE seems a little icky to me... so w\\/o more info I\'d lean toward a fileMap==null check (if anything).\u003c\\/p\u003e\\n\\n\u003cp\u003eOK, good points.  It is not in fact clear that a try\\/catch solution is\u003cbr\\/\u003e\\nless costly, so, let\'s keep it simple.  I will just add ensureOpen().\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12479373_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12479373_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/07 18:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-08T18:06:52+0000\'\u003e08\\/Mar\\/07 18:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; I\'m not enough of an expert to know if this would be faster or slower than a simple fileMap==null check. \\n&gt; I would guess it depends on what needs to be set up in the stack frame to potentially catch an exception, and if the try\\/catch\\/throw code prevents any optimizations (such as inlining). \\n&gt;  \\n&gt; Also, catching a NPE seems a little icky to me... so w\\/o more info I\'d lean toward a fileMap==null check (if anything). \\n\\n OK, good points.  It is not in fact clear that a try\\/catch solution is \\nless costly, so, let\'s keep it simple.  I will just add ensureOpen().              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12480158\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-818?focusedCommentId=12480158&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12480158\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12480158_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12480158_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Mar\\/07 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-12T17:52:07+0000\'\u003e12\\/Mar\\/07 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached patch: removed AlreadyClosedException from throws clauses &amp; javadocs; added ensureOpen calls inside RAMDirectory as well.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12480158_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12480158_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Mar\\/07 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-12T17:52:07+0000\'\u003e12\\/Mar\\/07 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached patch: removed AlreadyClosedException from throws clauses &amp; javadocs; added ensureOpen calls inside RAMDirectory as well.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520242526581"> 
    <input type="hidden" title="jira.request.server.time" value="224"> 
    <input type="hidden" title="jira.request.id" value="575x94508591x3"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="5"> 
    <input type="hidden" title="db.reads.time.in.ms" value="29"> 
    <input type="hidden" title="db.conns.time.in.ms" value="34"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 575x94508591x3
	          REQUEST TIMESTAMP : [05/Mar/2018:09:35:26 +0000]
	               REQUEST TIME : 0.2240
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 5

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=21, elapsedTotal=29142934, elapsedMin=604710, elapsedMax=12396751, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=25, elapsedTotal=34853509, elapsedMin=630459, elapsedMax=12416798, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>