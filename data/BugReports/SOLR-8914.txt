<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|19386f506dd1dfd0e12986ef87cd35a8ed7df5fb|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"a6a08edd9c61b6\"";
WRM._unparsedData["project-id"]="12310230";
WRM._unparsedData["project-key"]="\"SOLR\"";
WRM._unparsedData["project-name"]="\"Solr\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310230";
WRM._unparsedData["projectKey"]="\"SOLR\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="SOLR-8914"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[SOLR-8914] ZkStateReader's refreshLiveNodes(Watcher) is not thread safe - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[SOLR-8914] ZkStateReader's refreshLiveNodes(Watcher) is not thread safe - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/SOLR" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-8914">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310230" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Solr'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310230&amp;avatarId=22151"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/SOLR">Solr</a></li>
                 <li><a class="issue-link" data-issue-key="SOLR-8914" href="/jira/browse/SOLR-8914" id="key-val" rel="12954025">SOLR-8914</a></li>
                </ol>
                <h1 id="summary-val">ZkStateReader's refreshLiveNodes(Watcher) is not thread safe</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-8914"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/SOLR-8914/SOLR-8914.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/SOLR-8914/SOLR-8914.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/SOLR-8914/SOLR-8914.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/SOLR-8914/SOLR-8914.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="5.4.1 Bugfix release after 5.4.0">5.4.1</span>, <span title="5.5 Major release after 5.4">5.5</span>, <span title="6.0 First 6.x release, Major release after 5.5">6.0</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+5.5.1" title="5.5.1 Bugfix release after 5.5.0">5.5.1</a>, <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+5.6" title="5.6 Major release after 5.5">5.6</a>, <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+6.0.1" title="6.0.1 Bugfix release after 6.0.0">6.0.1</a>, <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+6.1" title="6.1 Major release after 6.0">6.1</a>, <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+7.0" title="7.0 First 7x release, major release after 6.6">7.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12954025-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Jenkin's encountered a failure in TestTolerantUpdateProcessorCloud over the weekend....</p> 
                  <div class="preformatted panel" style="border-width: 1px;">
                   <div class="preformattedContent panelContent"> 
                    <pre>http://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Solaris/32/consoleText
Checking out Revision c46d7686643e7503304cb35dfe546bce9c6684e7 (refs/remotes/origin/branch_6x)
Using Java: 64bit/jdk1.8.0 -XX:+UseCompressedOops -XX:+UseG1GC
</pre> 
                   </div>
                  </div> 
                  <p>The failure happened during the static setup of the test, when a MiniSolrCloudCluster &amp; several clients are initialized – before any code related to TolerantUpdateProcessor is ever used.</p> 
                  <p>I can't reproduce this, or really make sense of what i'm (not) seeing here in the logs, so i'm filing this jira with my analysis in the hopes that someone else can help make sense of it.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/SOLR-8914?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/SOLR-8914?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/SOLR-8914?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/SOLR-8914?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12795668" data-issue-id="12954025" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12795668/jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt" draggable="true" data-downloadurl="text/plain:jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt:https://issues.apache.org/jira/secure/attachment/12795668/jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12795668/jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt" title="Latest  28/Mar/16 18:15 - Hoss Man" draggable="true" data-downloadurl="text/plain:jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt:https://issues.apache.org/jira/secure/attachment/12795668/jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt">jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-03-28T18:15:38.536Z">28/Mar/16 18:15</time>
                   </dd>
                   <dd class="attachment-size">
                    913 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12795946" data-issue-id="12954025" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12795946/live_node_mentions_port56361_with_threadIds.log.txt" draggable="true" data-downloadurl="text/plain:live_node_mentions_port56361_with_threadIds.log.txt:https://issues.apache.org/jira/secure/attachment/12795946/live_node_mentions_port56361_with_threadIds.log.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12795946/live_node_mentions_port56361_with_threadIds.log.txt" title="Latest  29/Mar/16 22:26 - Hoss Man" draggable="true" data-downloadurl="text/plain:live_node_mentions_port56361_with_threadIds.log.txt:https://issues.apache.org/jira/secure/attachment/12795946/live_node_mentions_port56361_with_threadIds.log.txt">live_node_mentions_port56361_with_threadIds.log.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-03-29T22:26:38.381Z">29/Mar/16 22:26</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12795754" data-issue-id="12954025" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12795754/live_nodes_mentions.log.txt" draggable="true" data-downloadurl="text/plain:live_nodes_mentions.log.txt:https://issues.apache.org/jira/secure/attachment/12795754/live_nodes_mentions.log.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12795754/live_nodes_mentions.log.txt" title="Latest  29/Mar/16 02:12 - Hoss Man" draggable="true" data-downloadurl="text/plain:live_nodes_mentions.log.txt:https://issues.apache.org/jira/secure/attachment/12795754/live_nodes_mentions.log.txt">live_nodes_mentions.log.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-03-29T02:12:41.686Z">29/Mar/16 02:12</time>
                   </dd>
                   <dd class="attachment-size">
                    13 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12796126" data-issue-id="12954025" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12796126/SOLR-8914.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-8914.patch:https://issues.apache.org/jira/secure/attachment/12796126/SOLR-8914.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12796126/SOLR-8914.patch" title="Latest  30/Mar/16 18:15 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-8914.patch:https://issues.apache.org/jira/secure/attachment/12796126/SOLR-8914.patch">SOLR-8914.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-03-30T18:15:49.299Z">30/Mar/16 18:15</time>
                   </dd>
                   <dd class="attachment-size">
                    16 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12796101" data-issue-id="12954025" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12796101/SOLR-8914.patch" draggable="true" data-downloadurl="text/plain:SOLR-8914.patch:https://issues.apache.org/jira/secure/attachment/12796101/SOLR-8914.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12796101/SOLR-8914.patch" title=" 30/Mar/16 15:57 - Scott Blum" draggable="true" data-downloadurl="text/plain:SOLR-8914.patch:https://issues.apache.org/jira/secure/attachment/12796101/SOLR-8914.patch">SOLR-8914.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-03-30T15:57:45.504Z">30/Mar/16 15:57</time>
                   </dd>
                   <dd class="attachment-size">
                    16 kB
                   </dd>
                   <dd class="attachment-author">
                    Scott Blum
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12796012" data-issue-id="12954025" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12796012/SOLR-8914.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-8914.patch:https://issues.apache.org/jira/secure/attachment/12796012/SOLR-8914.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12796012/SOLR-8914.patch" title=" 30/Mar/16 04:41 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-8914.patch:https://issues.apache.org/jira/secure/attachment/12796012/SOLR-8914.patch">SOLR-8914.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-03-30T04:41:42.244Z">30/Mar/16 04:41</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12795960" data-issue-id="12954025" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12795960/SOLR-8914.patch" draggable="true" data-downloadurl="text/plain:SOLR-8914.patch:https://issues.apache.org/jira/secure/attachment/12795960/SOLR-8914.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12795960/SOLR-8914.patch" title=" 29/Mar/16 23:08 - Scott Blum" draggable="true" data-downloadurl="text/plain:SOLR-8914.patch:https://issues.apache.org/jira/secure/attachment/12795960/SOLR-8914.patch">SOLR-8914.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2016-03-29T23:08:15.184Z">29/Mar/16 23:08</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Scott Blum
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_dragonsinth" rel="dragonsinth" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Scott Blum&quot;,&quot;emailAddress&quot;:&quot;dragonsinth@gmail.com&quot;,&quot;username&quot;:&quot;dragonsinth&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="dragonsinth"></span></span> Scott Blum </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_hossman" rel="hossman" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Hoss Man&quot;,&quot;emailAddress&quot;:&quot;hossman_apachejira@fucit.org&quot;,&quot;username&quot;:&quot;hossman&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="hossman"></span></span> Hoss Man </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">8</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="28/Mar/16 18:12"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-03-28T18:12:31+0000">28/Mar/16 18:12</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="28/May/16 13:38"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-05-28T13:38:22+0000">28/May/16 13:38</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="20/Apr/16 23:19"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-04-20T23:19:08+0000">20/Apr/16 23:19</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-8914?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/SOLR-8914?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-15214609\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15214609&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15214609\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15214609_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15214609_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Mar\\/16 18:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-28T18:15:38+0000\'\u003e28\\/Mar\\/16 18:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eThe specific assertion that failed had to do with a sanity checking query for 2 docs that are added to ensure that some compositId routing prefixes used throughout the tests do actually corrispond to the expected shard names &#8211; but for the purpose of discussing this particular jenkins failure, the key things to know about this test failure are...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003ethere are 2 shards w\\/ repfactor=2 which are inited successfully &amp; not undergoing recovery\u003c\\/li\u003e\\n\\t\u003cli\u003e2 docs are (successful) added, with prefixes such that one is located on each shard\u003c\\/li\u003e\\n\\t\u003cli\u003ea hard commit is (sucessfully) executed from the perspective of the CloudSolrClient\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003e\u003cfont color=\\\"red\\\"\u003ebut only shard1 logs the commit &amp; newSearcher\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003ea \u003ctt\u003e&#42;:&#42;\u003c\\/tt\u003e query is executed...\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eonly 1 doc is found by this query\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ean error is logged by a shard1 node that \u003cfont color=\\\"red\\\"\u003eno servers hosting shard: shard2\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\\t\u003cli\u003e\u003cfont color=\\\"red\\\"\u003ea shard2 node does in fact log that it was consulted as part of this query\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eWhich raises 2 key questions I can\'t make sense of...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWhy didn\'t either shard2 node ever log (and execute) the commit &amp; opening of a new searcher?\u003c\\/li\u003e\\n\\t\u003cli\u003eWhy did a shard1 node log an error that \\\"no servers hosting shard: shard2\\\" even though the shard2\'s core_node2 clearly received the first phase of the distributed request &amp; responded with a success?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eI\'ve attached the full log file, and provided my detailed notes, line by line (of both the relevant code &amp; the log file) below - NOTE: all \\\"Lxx\\\" line numbers refer to GIT SHA c46d768 since that\'s what jenkins was testing)\u003c\\/p\u003e\\n\\n\u003chr \\/\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eTestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster...\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ebegins by creating a MiniSolrCloudCluster &amp; initializes a collection of 5 nodes with 2 shards and refactor=2\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003etimestamp #1302667 - #1302668\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eTestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L129\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ecall to AbstractDistribZkTestBase.waitForRecoveriesToFinish\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ecan see from the log that all 4 nodes are good to go...\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1302667 INFO  (SUITE-TestTolerantUpdateProcessorCloud-seed#[F0FBD4E7705C29B5]-worker) [    ] o.a.s.c.AbstractDistribZkTestBase Wait for recoveries to finish - collection: test_col failOnTimeout:true timeout (sec):330\\n-\\nreplica:core_node1 rstate:active live:true\\nreplica:core_node4 rstate:active live:true\\nreplica:core_node2 rstate:active live:true\\nreplica:core_node3 rstate:active live:true\\nno one is recoverying\\n1302668 INFO  (SUITE-TestTolerantUpdateProcessorCloud-seed#[F0FBD4E7705C29B5]-worker) [    ] o.a.s.c.AbstractDistribZkTestBase Recoveries finished - collection: test_col\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eTestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L132 - L183\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003etest is inspecting ZK state to init some HTTP SolrClients pointed at the URLs for specific leaders &amp; replicas (these are used to test all possible forwarding situations in the various test methods)\u003c\\/li\u003e\\n\\t\\t\u003cli\u003etimestamp #1302671 shows ZkStateReader used refreshing it\'s live nodes info for this purpose (L141)\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eTestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L184 - L188\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eadding 2 docs with specific routing prefixes\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eultimate goal is to sanity check that the route prefixes match to the expected shards so other parts of test can assume this.\u003c\\/li\u003e\\n\\t\\t\u003cli\u003etimestamp #1302696 - #1302719 record these 2 docs being added to both replicas of shard1 &amp; shard2...\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1302696 INFO  (qtp1904355206-7333) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica2]  webapp=\\/solr path=\\/update params={update.distrib=FROMLEADER&amp;distrib.from=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/&amp;wt=javabin&amp;version=2}{add=[abc!447049285 (1529857595576156160)]} 0 4\\n1302697 INFO  (qtp1409631559-7341) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica1]  webapp=\\/solr path=\\/update params={wt=javabin&amp;version=2}{add=[abc!447049285 (1529857595576156160)]} 0 14\\n1302719 INFO  (qtp797763926-7371) [n:127.0.0.1:51144_solr c:test_col s:shard2 r:core_node3 x:test_col_shard2_replica1] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard2_replica1]  webapp=\\/solr path=\\/update params={update.distrib=FROMLEADER&amp;distrib.from=http:\\/\\/127.0.0.1:33616\\/solr\\/test_col_shard2_replica2\\/&amp;wt=javabin&amp;version=2}{add=[XYZ!701047101 (1529857595596079104)]} 0 7\\n1302719 INFO  (qtp316491708-7355) [n:127.0.0.1:33616_solr c:test_col s:shard2 r:core_node2 x:test_col_shard2_replica2] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard2_replica2]  webapp=\\/solr path=\\/update params={wt=javabin&amp;version=2}{add=[XYZ!701047101 (1529857595596079104)]} 0 18\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eTestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L189\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003edo a commit using the CloudSolrClient\u003c\\/li\u003e\\n\\t\\t\u003cli\u003etimestamps #1302724 - #1302733 show both replicas of shard1 acting on this commit &amp; opening new searchers...\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1302724 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\\n1302724 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\\n1302727 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.c.SolrDeletionPolicy SolrDeletionPolicy.onCommit: commits: num=2\\n\\tcommit{dir=MockDirectoryWrapper(RAMDirectory@21c6a821 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@26734241),segFN=segments_1,generation=1}\\n\\tcommit{dir=MockDirectoryWrapper(RAMDirectory@21c6a821 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@26734241),segFN=segments_2,generation=2}\\n1302727 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.SolrDeletionPolicy SolrDeletionPolicy.onCommit: commits: num=2\\n\\tcommit{dir=MockDirectoryWrapper(RAMDirectory@5616141f lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@6180bc4c),segFN=segments_1,generation=1}\\n\\tcommit{dir=MockDirectoryWrapper(RAMDirectory@5616141f lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@6180bc4c),segFN=segments_2,generation=2}\\n1302728 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.c.SolrDeletionPolicy newest commit generation = 2\\n1302729 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.SolrDeletionPolicy newest commit generation = 2\\n1302730 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@f331408[test_col_shard1_replica1] main]\\n1302730 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.s.SolrIndexSearcher Opening [Searcher@5d1967dd[test_col_shard1_replica2] main]\\n1302730 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.DirectUpdateHandler2 end_commit_flush\\n1302730 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.u.DirectUpdateHandler2 end_commit_flush\\n1302731 INFO  (searcherExecutor-3283-thread-1-processing-n:127.0.0.1:56361_solr x:test_col_shard1_replica1 s:shard1 c:test_col r:core_node1) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.SolrCore [test_col_shard1_replica1] Registered new searcher Searcher@f331408[test_col_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(6.1.0):c1)))}\\n1302732 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica1]  webapp=\\/solr path=\\/update params={update.distrib=FROMLEADER&amp;waitSearcher=true&amp;openSearcher=true&amp;commit=true&amp;softCommit=false&amp;distrib.from=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/&amp;commit_end_point=true&amp;wt=javabin&amp;version=2&amp;expungeDeletes=false}{commit=} 0 7\\n1302732 INFO  (searcherExecutor-3284-thread-1-processing-n:127.0.0.1:34275_solr x:test_col_shard1_replica2 s:shard1 c:test_col r:core_node4) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.c.SolrCore [test_col_shard1_replica2] Registered new searcher Searcher@5d1967dd[test_col_shard1_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(6.1.0):c1)))}\\n1302732 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica2]  webapp=\\/solr path=\\/update params={update.distrib=FROMLEADER&amp;waitSearcher=true&amp;openSearcher=true&amp;commit=true&amp;softCommit=false&amp;distrib.from=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/&amp;commit_end_point=true&amp;wt=javabin&amp;version=2&amp;expungeDeletes=false}{commit=} 0 8\\n1302733 INFO  (qtp1409631559-7345) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica1]  webapp=\\/solr path=\\/update params={_stateVer_=test_col:7&amp;waitSearcher=true&amp;commit=true&amp;softCommit=false&amp;wt=javabin&amp;version=2}{commit=} 0 11\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\\t\u003cli\u003e\u003cfont color=\\\"red\\\"\u003eWhat the hell hapened to shard2 ?! why isn\'t shard#2 logging anything here?!\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eTestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L190\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003edo a \u003ctt\u003e&#42;:&#42;\u003c\\/tt\u003e query using the CloudSolrClient\u003c\\/li\u003e\\n\\t\\t\u003cli\u003egoal is to assert that the \u003ctt\u003e[shard]\u003c\\/tt\u003e value for each of our doc (prefixes) matches the expectation the rest of the test will have\u003c\\/li\u003e\\n\\t\\t\u003cli\u003etimestamp #1302737 shows an error log from a shard1 node indicating that both replicas of shard2 have just vanished completley...\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1302737 ERROR (qtp1409631559-7347) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: no servers hosting shard: shard2\\n\\tat org.apache.solr.handler.component.HttpShardHandler.prepDistributed(HttpShardHandler.java:451)\\n\\tat org.apache.solr.handler.component.SearchHandler.getAndPrepShardHandler(SearchHandler.java:224)\\n\\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:262)\\n\\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:155)\\n\\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2033)\\n\\tat org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:652)\\n\\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:460)\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:229)\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)\\n\\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\\n\\tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:109)\\n\\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\\n\\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\\n\\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\\n\\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)\\n\\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\\n\\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\\n\\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)\\n\\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\\n\\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:462)\\n\\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\\n\\tat org.eclipse.jetty.server.Server.handle(Server.java:518)\\n\\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\\n\\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)\\n\\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\\n\\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\\n\\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)\\n\\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\\n\\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\\n\\tat java.lang.Thread.run(Thread.java:745)\\n\\n1302737 INFO  (qtp1409631559-7347) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.S.Request [test_col_shard1_replica1]  webapp=\\/solr path=\\/select params={q=*:*&amp;_stateVer_=test_col:7&amp;fl=id,expected_shard_s,[shard]&amp;wt=javabin&amp;version=2} status=503 QTime=0\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ebut 5ms latter, timestamp #1302742 shows shard2\'s core_node2 logging it\'s successful response to the initial phase of the distributed query (although with \u003ctt\u003ehits=0\u003c\\/tt\u003e since it never processed the commit or opened a new searcher after the documents where added) ...\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1302742 INFO  (qtp316491708-7357) [n:127.0.0.1:33616_solr c:test_col s:shard2 r:core_node2 x:test_col_shard2_replica2] o.a.s.c.S.Request [test_col_shard2_replica2]  webapp=\\/solr path=\\/select params={distrib=false&amp;_stateVer_=test_col:7&amp;fl=id&amp;fl=score&amp;shards.purpose=4&amp;start=0&amp;fsv=true&amp;shard.url=http:\\/\\/127.0.0.1:33616\\/solr\\/test_col_shard2_replica2\\/|http:\\/\\/127.0.0.1:51144\\/solr\\/test_col_shard2_replica1\\/&amp;rows=10&amp;version=2&amp;q=*:*&amp;NOW=1458985896717&amp;isShard=true&amp;wt=javabin} hits=0 status=0 QTime=0\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eThe test ultimately fails at because the \u003ctt\u003e&#42;:&#42;\u003c\\/tt\u003e sanity check of numDocs=2 fails\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eTestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L192\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eother then the \u003ctt\u003ehits=0\u003c\\/tt\u003e logging mentioned above (#1302742), there is no logging from either of the shard2 nodes between timestamp #1302719 when both replicas accept the doc add, and #1302758 when the test starts shutting down nodes and closing cores.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15214609_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15214609_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Mar\\/16 18:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-28T18:15:38+0000\'\u003e28\\/Mar\\/16 18:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n The specific assertion that failed had to do with a sanity checking query for 2 docs that are added to ensure that some compositId routing prefixes used throughout the tests do actually corrispond to the expected shard names &#8211; but for the purpose of discussing this particular jenkins failure, the key things to know about this test failure are... \\n\\n \\n\\t there are 2 shards w\\/ repfactor=2 which are inited successfully &amp; not undergoing recovery \\n\\t 2 docs are (successful) added, with prefixes such that one is located on each shard \\n\\t a hard commit is (sucessfully) executed from the perspective of the CloudSolrClient\\n\\t \\n\\t\\t  but only shard1 logs the commit &amp; newSearcher  \\n\\t \\n\\t \\n\\t a  &#42;:&#42;  query is executed...\\n\\t \\n\\t\\t only 1 doc is found by this query \\n\\t\\t an error is logged by a shard1 node that  no servers hosting shard: shard2  \\n\\t\\t  a shard2 node does in fact log that it was consulted as part of this query  \\n\\t \\n\\t \\n \\n\\n\\n\\n Which raises 2 key questions I can\'t make sense of... \\n\\n \\n\\t Why didn\'t either shard2 node ever log (and execute) the commit &amp; opening of a new searcher? \\n\\t Why did a shard1 node log an error that \\\"no servers hosting shard: shard2\\\" even though the shard2\'s core_node2 clearly received the first phase of the distributed request &amp; responded with a success? \\n \\n\\n\\n\\n I\'ve attached the full log file, and provided my detailed notes, line by line (of both the relevant code &amp; the log file) below - NOTE: all \\\"Lxx\\\" line numbers refer to GIT SHA c46d768 since that\'s what jenkins was testing) \\n\\n \\n\\n \\n\\t TestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster...\\n\\t \\n\\t\\t begins by creating a MiniSolrCloudCluster &amp; initializes a collection of 5 nodes with 2 shards and refactor=2 \\n\\t \\n\\t \\n\\t timestamp #1302667 - #1302668\\n\\t \\n\\t\\t TestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L129 \\n\\t\\t call to AbstractDistribZkTestBase.waitForRecoveriesToFinish \\n\\t\\t can see from the log that all 4 nodes are good to go...\\n  \\n 1302667 INFO  (SUITE-TestTolerantUpdateProcessorCloud-seed#[F0FBD4E7705C29B5]-worker) [    ] o.a.s.c.AbstractDistribZkTestBase Wait for recoveries to finish - collection: test_col failOnTimeout:true timeout (sec):330\\n-\\nreplica:core_node1 rstate:active live:true\\nreplica:core_node4 rstate:active live:true\\nreplica:core_node2 rstate:active live:true\\nreplica:core_node3 rstate:active live:true\\nno one is recoverying\\n1302668 INFO  (SUITE-TestTolerantUpdateProcessorCloud-seed#[F0FBD4E7705C29B5]-worker) [    ] o.a.s.c.AbstractDistribZkTestBase Recoveries finished - collection: test_col\\n \\n   \\n\\t \\n\\t \\n\\t TestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L132 - L183\\n\\t \\n\\t\\t test is inspecting ZK state to init some HTTP SolrClients pointed at the URLs for specific leaders &amp; replicas (these are used to test all possible forwarding situations in the various test methods) \\n\\t\\t timestamp #1302671 shows ZkStateReader used refreshing it\'s live nodes info for this purpose (L141) \\n\\t \\n\\t \\n\\t TestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L184 - L188\\n\\t \\n\\t\\t adding 2 docs with specific routing prefixes \\n\\t\\t ultimate goal is to sanity check that the route prefixes match to the expected shards so other parts of test can assume this. \\n\\t\\t timestamp #1302696 - #1302719 record these 2 docs being added to both replicas of shard1 &amp; shard2...\\n  \\n 1302696 INFO  (qtp1904355206-7333) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica2]  webapp=\\/solr path=\\/update params={update.distrib=FROMLEADER&amp;distrib.from=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/&amp;wt=javabin&amp;version=2}{add=[abc!447049285 (1529857595576156160)]} 0 4\\n1302697 INFO  (qtp1409631559-7341) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica1]  webapp=\\/solr path=\\/update params={wt=javabin&amp;version=2}{add=[abc!447049285 (1529857595576156160)]} 0 14\\n1302719 INFO  (qtp797763926-7371) [n:127.0.0.1:51144_solr c:test_col s:shard2 r:core_node3 x:test_col_shard2_replica1] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard2_replica1]  webapp=\\/solr path=\\/update params={update.distrib=FROMLEADER&amp;distrib.from=http:\\/\\/127.0.0.1:33616\\/solr\\/test_col_shard2_replica2\\/&amp;wt=javabin&amp;version=2}{add=[XYZ!701047101 (1529857595596079104)]} 0 7\\n1302719 INFO  (qtp316491708-7355) [n:127.0.0.1:33616_solr c:test_col s:shard2 r:core_node2 x:test_col_shard2_replica2] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard2_replica2]  webapp=\\/solr path=\\/update params={wt=javabin&amp;version=2}{add=[XYZ!701047101 (1529857595596079104)]} 0 18\\n \\n   \\n\\t \\n\\t \\n\\t TestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L189\\n\\t \\n\\t\\t do a commit using the CloudSolrClient \\n\\t\\t timestamps #1302724 - #1302733 show both replicas of shard1 acting on this commit &amp; opening new searchers...\\n  \\n 1302724 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\\n1302724 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\\n1302727 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.c.SolrDeletionPolicy SolrDeletionPolicy.onCommit: commits: num=2\\n\\tcommit{dir=MockDirectoryWrapper(RAMDirectory@21c6a821 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@26734241),segFN=segments_1,generation=1}\\n\\tcommit{dir=MockDirectoryWrapper(RAMDirectory@21c6a821 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@26734241),segFN=segments_2,generation=2}\\n1302727 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.SolrDeletionPolicy SolrDeletionPolicy.onCommit: commits: num=2\\n\\tcommit{dir=MockDirectoryWrapper(RAMDirectory@5616141f lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@6180bc4c),segFN=segments_1,generation=1}\\n\\tcommit{dir=MockDirectoryWrapper(RAMDirectory@5616141f lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@6180bc4c),segFN=segments_2,generation=2}\\n1302728 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.c.SolrDeletionPolicy newest commit generation = 2\\n1302729 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.SolrDeletionPolicy newest commit generation = 2\\n1302730 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@f331408[test_col_shard1_replica1] main]\\n1302730 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.s.SolrIndexSearcher Opening [Searcher@5d1967dd[test_col_shard1_replica2] main]\\n1302730 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.DirectUpdateHandler2 end_commit_flush\\n1302730 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.u.DirectUpdateHandler2 end_commit_flush\\n1302731 INFO  (searcherExecutor-3283-thread-1-processing-n:127.0.0.1:56361_solr x:test_col_shard1_replica1 s:shard1 c:test_col r:core_node1) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.SolrCore [test_col_shard1_replica1] Registered new searcher Searcher@f331408[test_col_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(6.1.0):c1)))}\\n1302732 INFO  (qtp1409631559-7343) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica1]  webapp=\\/solr path=\\/update params={update.distrib=FROMLEADER&amp;waitSearcher=true&amp;openSearcher=true&amp;commit=true&amp;softCommit=false&amp;distrib.from=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/&amp;commit_end_point=true&amp;wt=javabin&amp;version=2&amp;expungeDeletes=false}{commit=} 0 7\\n1302732 INFO  (searcherExecutor-3284-thread-1-processing-n:127.0.0.1:34275_solr x:test_col_shard1_replica2 s:shard1 c:test_col r:core_node4) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.c.SolrCore [test_col_shard1_replica2] Registered new searcher Searcher@5d1967dd[test_col_shard1_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(6.1.0):c1)))}\\n1302732 INFO  (qtp1904355206-7330) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica2]  webapp=\\/solr path=\\/update params={update.distrib=FROMLEADER&amp;waitSearcher=true&amp;openSearcher=true&amp;commit=true&amp;softCommit=false&amp;distrib.from=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/&amp;commit_end_point=true&amp;wt=javabin&amp;version=2&amp;expungeDeletes=false}{commit=} 0 8\\n1302733 INFO  (qtp1409631559-7345) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.u.p.LogUpdateProcessorFactory [test_col_shard1_replica1]  webapp=\\/solr path=\\/update params={_stateVer_=test_col:7&amp;waitSearcher=true&amp;commit=true&amp;softCommit=false&amp;wt=javabin&amp;version=2}{commit=} 0 11\\n \\n   \\n\\t\\t  What the hell hapened to shard2 ?! why isn\'t shard#2 logging anything here?!  \\n\\t \\n\\t \\n\\t TestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L190\\n\\t \\n\\t\\t do a  &#42;:&#42;  query using the CloudSolrClient \\n\\t\\t goal is to assert that the  [shard]  value for each of our doc (prefixes) matches the expectation the rest of the test will have \\n\\t\\t timestamp #1302737 shows an error log from a shard1 node indicating that both replicas of shard2 have just vanished completley...\\n  \\n 1302737 ERROR (qtp1409631559-7347) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: no servers hosting shard: shard2\\n\\tat org.apache.solr.handler.component.HttpShardHandler.prepDistributed(HttpShardHandler.java:451)\\n\\tat org.apache.solr.handler.component.SearchHandler.getAndPrepShardHandler(SearchHandler.java:224)\\n\\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:262)\\n\\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:155)\\n\\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2033)\\n\\tat org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:652)\\n\\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:460)\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:229)\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)\\n\\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\\n\\tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:109)\\n\\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\\n\\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\\n\\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\\n\\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)\\n\\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\\n\\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\\n\\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)\\n\\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\\n\\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:462)\\n\\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\\n\\tat org.eclipse.jetty.server.Server.handle(Server.java:518)\\n\\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\\n\\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)\\n\\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\\n\\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\\n\\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)\\n\\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\\n\\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\\n\\tat java.lang.Thread.run(Thread.java:745)\\n\\n1302737 INFO  (qtp1409631559-7347) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.S.Request [test_col_shard1_replica1]  webapp=\\/solr path=\\/select params={q=*:*&amp;_stateVer_=test_col:7&amp;fl=id,expected_shard_s,[shard]&amp;wt=javabin&amp;version=2} status=503 QTime=0\\n \\n   \\n\\t\\t but 5ms latter, timestamp #1302742 shows shard2\'s core_node2 logging it\'s successful response to the initial phase of the distributed query (although with  hits=0  since it never processed the commit or opened a new searcher after the documents where added) ...\\n  \\n 1302742 INFO  (qtp316491708-7357) [n:127.0.0.1:33616_solr c:test_col s:shard2 r:core_node2 x:test_col_shard2_replica2] o.a.s.c.S.Request [test_col_shard2_replica2]  webapp=\\/solr path=\\/select params={distrib=false&amp;_stateVer_=test_col:7&amp;fl=id&amp;fl=score&amp;shards.purpose=4&amp;start=0&amp;fsv=true&amp;shard.url=http:\\/\\/127.0.0.1:33616\\/solr\\/test_col_shard2_replica2\\/|http:\\/\\/127.0.0.1:51144\\/solr\\/test_col_shard2_replica1\\/&amp;rows=10&amp;version=2&amp;q=*:*&amp;NOW=1458985896717&amp;isShard=true&amp;wt=javabin} hits=0 status=0 QTime=0\\n \\n   \\n\\t \\n\\t \\n\\t The test ultimately fails at because the  &#42;:&#42;  sanity check of numDocs=2 fails\\n\\t \\n\\t\\t TestTolerantUpdateProcessorCloud.createMiniSolrCloudCluster @ L192 \\n\\t \\n\\t \\n\\t other then the  hits=0  logging mentioned above (#1302742), there is no logging from either of the shard2 nodes between timestamp #1302719 when both replicas accept the doc add, and #1302758 when the test starts shutting down nodes and closing cores. \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15215090\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15215090&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15215090\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15215090_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15215090_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Mar\\/16 23:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-28T23:31:36+0000\'\u003e28\\/Mar\\/16 23:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI see something weird in there:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e   [junit4]   2&gt; 1301674 INFO  (zkCallback-1136-thread-2-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/collections\\/test_col\\/state.json] \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e collection [test_col] has occurred - updating... (live nodes size: [5])\\n   [junit4]   2&gt; 1301674 INFO  (zkCallback-1143-thread-1-processing-n:127.0.0.1:33616_solr) [n:127.0.0.1:33616_solr    ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/collections\\/test_col\\/state.json] \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e collection [test_col] has occurred - updating... (live nodes size: [5])\\n   [junit4]   2&gt; 1301674 INFO  (zkCallback-1135-thread-2-processing-n:127.0.0.1:56361_solr) [n:127.0.0.1:56361_solr    ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/collections\\/test_col\\/state.json] \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e collection [test_col] has occurred - updating... (live nodes size: [3])\\n   [junit4]   2&gt; 1301675 INFO  (zkCallback-1142-thread-2-processing-n:127.0.0.1:51144_solr) [n:127.0.0.1:51144_solr    ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/collections\\/test_col\\/state.json] \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e collection [test_col] has occurred - updating... (live nodes size: [5])\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWhy is one node seeing a live_nodes size 3, and the others seeing size 5? How many are there supposed to be?  I\'ve suspected for a while there\'s some weirdness involving live_nodes tracking, but I haven\'t been able to pin it down.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15215090_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15215090_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Mar\\/16 23:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-28T23:31:36+0000\'\u003e28\\/Mar\\/16 23:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I see something weird in there: \\n\\n  \\n    [junit4]   2&gt; 1301674 INFO  (zkCallback-1136-thread-2-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/collections\\/test_col\\/state.json]  for  collection [test_col] has occurred - updating... (live nodes size: [5])\\n   [junit4]   2&gt; 1301674 INFO  (zkCallback-1143-thread-1-processing-n:127.0.0.1:33616_solr) [n:127.0.0.1:33616_solr    ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/collections\\/test_col\\/state.json]  for  collection [test_col] has occurred - updating... (live nodes size: [5])\\n   [junit4]   2&gt; 1301674 INFO  (zkCallback-1135-thread-2-processing-n:127.0.0.1:56361_solr) [n:127.0.0.1:56361_solr    ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/collections\\/test_col\\/state.json]  for  collection [test_col] has occurred - updating... (live nodes size: [3])\\n   [junit4]   2&gt; 1301675 INFO  (zkCallback-1142-thread-2-processing-n:127.0.0.1:51144_solr) [n:127.0.0.1:51144_solr    ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:\\/collections\\/test_col\\/state.json]  for  collection [test_col] has occurred - updating... (live nodes size: [5])\\n \\n  \\n\\n Why is one node seeing a live_nodes size 3, and the others seeing size 5? How many are there supposed to be?  I\'ve suspected for a while there\'s some weirdness involving live_nodes tracking, but I haven\'t been able to pin it down.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15215237\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15215237&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15215237\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15215237_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15215237_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 01:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T01:53:08+0000\'\u003e29\\/Mar\\/16 01:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNice catch Scott!\u003c\\/p\u003e\\n\\n\u003cp\u003eFWIW, here\'s a one liner that pulls out all the \\\"live nodes size\\\" messages from the log and distills it down to just the timeestamp, threadIds (showing the port# of the jetty instance) and the current live node count...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003egrep \\\"live nodes size\\\" jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt | perl -ple \'s\\/.*2&gt; (\\\\d+).*?\\\\((.*?)\\\\).*?o.a.s.c.c.ZkStateReader.*?live nodes size: (\\\\[\\\\d+\\\\]).*\\/$1 $2 $3\\/\'\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eusing the output from that command as a refrence point, we can revist some of my earlier observations...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eNOTE: there are 5 nodes in this cluster, but only 2 shards x 2 replicas\u003c\\/li\u003e\\n\\t\u003cli\u003eL122: collection creation\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ewhen the 4 cores for the collection are created, the jetty node that does \u003cem\u003eNOT\u003c\\/em\u003e recieve any core is port #63099...\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1291030 INFO  (OverseerThreadFactory-3272-thread-1-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.OverseerCollectionMessageHandler Creating core test_col_shard1_replica1 as part of shard shard1 of collection test_col on 127.0.0.1:56361_solr\\n1291031 INFO  (OverseerThreadFactory-3272-thread-1-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.OverseerCollectionMessageHandler Creating core test_col_shard2_replica2 as part of shard shard2 of collection test_col on 127.0.0.1:33616_solr\\n1291038 INFO  (OverseerThreadFactory-3272-thread-1-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.OverseerCollectionMessageHandler Creating core test_col_shard2_replica1 as part of shard shard2 of collection test_col on 127.0.0.1:51144_solr\\n1291041 INFO  (OverseerThreadFactory-3272-thread-1-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.OverseerCollectionMessageHandler Creating core test_col_shard1_replica2 as part of shard shard1 of collection test_col on 127.0.0.1:34275_solr\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eL129: call to AbstractDistribZkTestBase.waitForRecoveriesToFinish\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ethis happens between timestamp #1302667 - #1302668\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ethe most recent flurry of log messages mentioning \\\"live nodes size\\\" prior to this timestamp window are...\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1301787 zkCallback-1136-thread-1-processing-n:127.0.0.1:34275_solr [5]\\n1301788 zkCallback-1142-thread-2-processing-n:127.0.0.1:51144_solr [5]\\n1301791 zkCallback-1143-thread-1-processing-n:127.0.0.1:33616_solr [5]\\n1301791 zkCallback-1135-thread-2-processing-n:127.0.0.1:56361_solr [3]\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eNOTE: these log messages are watches on \u003ctt\u003epath:\\/collections\\/test_col\\/state.json\u003c\\/tt\u003e which port#63099 has no reason to watch (since it\'s not hosting any shards of \u003ctt\u003etest_col\u003c\\/tt\u003e so it\'s not unusual that it\'s not logging anything around these times\u003c\\/li\u003e\\n\\t\\t\u003cli\u003e\u003cfont color=\\\"red\\\"\u003ewhy does port #56361 think at this point that there are only 3 live nodes?\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eL184 - L188: adding docs\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ethis is done with CloudSolrClient, so each doc goes to it\'s respective leader regardless of wether any 1 node has a broken view of live_nodes\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eport #56361 hosts test_col_shard1_replica1 which is aparently the leader of shard1 at this moment\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ethe shard1 doc is forwarded correctly to test_col_shard1_replica2 (on port #34275)\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003eso #34275 is evidently in port #56361\'s \\\"view\\\" of live_nodes, and \u003cem\u003enot\u003c\\/em\u003e one of the \\\"missing\\\" live_nodes\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eL189: commit\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ehappens during timestamps #1302724 - #1302733\u003c\\/li\u003e\\n\\t\\t\u003cli\u003e(no new \\\"live nodes size\\\" log messages prior to this time window since the ones mentioned previously)\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eIIUC CloudSolrClient correctly, this is considered a \\\"non routable\\\" update, so it will be sent to a (leader) node picked at random\u003c\\/li\u003e\\n\\t\\t\u003cli\u003efrom the logs, it looks like CloudSolrClient picked port #56361\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eport #56361\'s test_col_shard1_replica1 forwarded to it\'s replica test_col_shard1_replica2 on port #34275\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eas mentioned before shard2 never got the update - aparently because port #56361 didn\'t think that shard2\'s leader was in live_nodes\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eL190: the {{&#42;:&#42;} query\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003etimestamp #1302737 is when port #56361 (who we know has a bogus view of live_nodes) logs that no servesr are hosting shard2, and returns a 503 error code\u003c\\/li\u003e\\n\\t\\t\u003cli\u003e(there are still no new \\\"live nodes size\\\" log messages prior to this error since the ones mentioned previously)\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eSomething that didn\'t occur to me before, is that IIRC CloudSolrServertimestamp will retry some error codes &#8211; i\'m guessing 503 is one of them, because that would explain the subsequent log messages 5ms later...\u003c\\/li\u003e\\n\\t\\t\u003cli\u003etimestamps #1302742 - 1302746, it appears that port #34275 was queried by CloudSolrClient on retry, and it did know that both replicas of shard2 were alive and queried them (but since they never got the commit, they had numFound=0)\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1302742 INFO  (qtp316491708-7357) [n:127.0.0.1:33616_solr c:test_col s:shard2 r:core_node2 x:test_col_shard2_replica2] o.a.s.c.S.Request [test_col_shard2_replica2]  webapp=\\/solr path=\\/select params={distrib=false&amp;_stateVer_=test_col:7&amp;fl=id&amp;fl=score&amp;shards.purpose=4&amp;start=0&amp;fsv=true&amp;shard.url=http:\\/\\/127.0.0.1:33616\\/solr\\/test_col_shard2_replica2\\/|http:\\/\\/127.0.0.1:51144\\/solr\\/test_col_shard2_replica1\\/&amp;rows=10&amp;version=2&amp;q=*:*&amp;NOW=1458985896717&amp;isShard=true&amp;wt=javabin} hits=0 status=0 QTime=0\\n1302742 INFO  (qtp1409631559-7346) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.S.Request [test_col_shard1_replica1]  webapp=\\/solr path=\\/select params={distrib=false&amp;_stateVer_=test_col:7&amp;fl=id&amp;fl=score&amp;shards.purpose=4&amp;start=0&amp;fsv=true&amp;shard.url=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/|http:\\/\\/127.0.0.1:34275\\/solr\\/test_col_shard1_replica2\\/&amp;rows=10&amp;version=2&amp;q=*:*&amp;NOW=1458985896717&amp;isShard=true&amp;wt=javabin} hits=1 status=0 QTime=0\\n1302745 INFO  (qtp1409631559-7344) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.S.Request [test_col_shard1_replica1]  webapp=\\/solr path=\\/select params={q=*:*&amp;distrib=false&amp;_stateVer_=test_col:7&amp;fl=id,expected_shard_s,[shard]&amp;shards.purpose=64&amp;NOW=1458985896717&amp;ids=abc!447049285&amp;isShard=true&amp;shard.url=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/|http:\\/\\/127.0.0.1:34275\\/solr\\/test_col_shard1_replica2\\/&amp;wt=javabin&amp;version=2} status=0 QTime=0\\n1302746 INFO  (qtp1904355206-7332) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.c.S.Request [test_col_shard1_replica2]  webapp=\\/solr path=\\/select params={q=*:*&amp;_stateVer_=test_col:7&amp;fl=id,expected_shard_s,[shard]&amp;wt=javabin&amp;version=2} hits=1 status=0 QTime=7\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eSo to sum up: it appears everything i noted before would be easily explained by a some broken code regarding live nodes that only affected port #56361 while all other nodes had a perfecly accurate view of the world.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15215237_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15215237_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 01:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T01:53:08+0000\'\u003e29\\/Mar\\/16 01:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Nice catch Scott! \\n\\n FWIW, here\'s a one liner that pulls out all the \\\"live nodes size\\\" messages from the log and distills it down to just the timeestamp, threadIds (showing the port# of the jetty instance) and the current live node count... \\n\\n  \\n grep \\\"live nodes size\\\" jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt | perl -ple \'s\\/.*2&gt; (\\\\d+).*?\\\\((.*?)\\\\).*?o.a.s.c.c.ZkStateReader.*?live nodes size: (\\\\[\\\\d+\\\\]).*\\/$1 $2 $3\\/\'\\n \\n  \\n\\n using the output from that command as a refrence point, we can revist some of my earlier observations... \\n\\n \\n\\t NOTE: there are 5 nodes in this cluster, but only 2 shards x 2 replicas \\n\\t L122: collection creation\\n\\t \\n\\t\\t when the 4 cores for the collection are created, the jetty node that does  NOT  recieve any core is port #63099...\\n  \\n 1291030 INFO  (OverseerThreadFactory-3272-thread-1-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.OverseerCollectionMessageHandler Creating core test_col_shard1_replica1 as part of shard shard1 of collection test_col on 127.0.0.1:56361_solr\\n1291031 INFO  (OverseerThreadFactory-3272-thread-1-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.OverseerCollectionMessageHandler Creating core test_col_shard2_replica2 as part of shard shard2 of collection test_col on 127.0.0.1:33616_solr\\n1291038 INFO  (OverseerThreadFactory-3272-thread-1-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.OverseerCollectionMessageHandler Creating core test_col_shard2_replica1 as part of shard shard2 of collection test_col on 127.0.0.1:51144_solr\\n1291041 INFO  (OverseerThreadFactory-3272-thread-1-processing-n:127.0.0.1:34275_solr) [n:127.0.0.1:34275_solr    ] o.a.s.c.OverseerCollectionMessageHandler Creating core test_col_shard1_replica2 as part of shard shard1 of collection test_col on 127.0.0.1:34275_solr\\n \\n   \\n\\t \\n\\t \\n\\t L129: call to AbstractDistribZkTestBase.waitForRecoveriesToFinish\\n\\t \\n\\t\\t this happens between timestamp #1302667 - #1302668 \\n\\t\\t the most recent flurry of log messages mentioning \\\"live nodes size\\\" prior to this timestamp window are...\\n  \\n 1301787 zkCallback-1136-thread-1-processing-n:127.0.0.1:34275_solr [5]\\n1301788 zkCallback-1142-thread-2-processing-n:127.0.0.1:51144_solr [5]\\n1301791 zkCallback-1143-thread-1-processing-n:127.0.0.1:33616_solr [5]\\n1301791 zkCallback-1135-thread-2-processing-n:127.0.0.1:56361_solr [3]\\n \\n   \\n\\t\\t NOTE: these log messages are watches on  path:\\/collections\\/test_col\\/state.json  which port#63099 has no reason to watch (since it\'s not hosting any shards of  test_col  so it\'s not unusual that it\'s not logging anything around these times \\n\\t\\t  why does port #56361 think at this point that there are only 3 live nodes?  \\n\\t \\n\\t \\n\\t L184 - L188: adding docs\\n\\t \\n\\t\\t this is done with CloudSolrClient, so each doc goes to it\'s respective leader regardless of wether any 1 node has a broken view of live_nodes \\n\\t\\t port #56361 hosts test_col_shard1_replica1 which is aparently the leader of shard1 at this moment \\n\\t\\t the shard1 doc is forwarded correctly to test_col_shard1_replica2 (on port #34275)\\n\\t\\t \\n\\t\\t\\t so #34275 is evidently in port #56361\'s \\\"view\\\" of live_nodes, and  not  one of the \\\"missing\\\" live_nodes \\n\\t\\t \\n\\t\\t \\n\\t \\n\\t \\n\\t L189: commit\\n\\t \\n\\t\\t happens during timestamps #1302724 - #1302733 \\n\\t\\t (no new \\\"live nodes size\\\" log messages prior to this time window since the ones mentioned previously) \\n\\t\\t IIUC CloudSolrClient correctly, this is considered a \\\"non routable\\\" update, so it will be sent to a (leader) node picked at random \\n\\t\\t from the logs, it looks like CloudSolrClient picked port #56361 \\n\\t\\t port #56361\'s test_col_shard1_replica1 forwarded to it\'s replica test_col_shard1_replica2 on port #34275 \\n\\t\\t as mentioned before shard2 never got the update - aparently because port #56361 didn\'t think that shard2\'s leader was in live_nodes \\n\\t \\n\\t \\n\\t L190: the {{&#42;:&#42;} query\\n\\t \\n\\t\\t timestamp #1302737 is when port #56361 (who we know has a bogus view of live_nodes) logs that no servesr are hosting shard2, and returns a 503 error code \\n\\t\\t (there are still no new \\\"live nodes size\\\" log messages prior to this error since the ones mentioned previously) \\n\\t\\t Something that didn\'t occur to me before, is that IIRC CloudSolrServertimestamp will retry some error codes &#8211; i\'m guessing 503 is one of them, because that would explain the subsequent log messages 5ms later... \\n\\t\\t timestamps #1302742 - 1302746, it appears that port #34275 was queried by CloudSolrClient on retry, and it did know that both replicas of shard2 were alive and queried them (but since they never got the commit, they had numFound=0)\\n  \\n 1302742 INFO  (qtp316491708-7357) [n:127.0.0.1:33616_solr c:test_col s:shard2 r:core_node2 x:test_col_shard2_replica2] o.a.s.c.S.Request [test_col_shard2_replica2]  webapp=\\/solr path=\\/select params={distrib=false&amp;_stateVer_=test_col:7&amp;fl=id&amp;fl=score&amp;shards.purpose=4&amp;start=0&amp;fsv=true&amp;shard.url=http:\\/\\/127.0.0.1:33616\\/solr\\/test_col_shard2_replica2\\/|http:\\/\\/127.0.0.1:51144\\/solr\\/test_col_shard2_replica1\\/&amp;rows=10&amp;version=2&amp;q=*:*&amp;NOW=1458985896717&amp;isShard=true&amp;wt=javabin} hits=0 status=0 QTime=0\\n1302742 INFO  (qtp1409631559-7346) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.S.Request [test_col_shard1_replica1]  webapp=\\/solr path=\\/select params={distrib=false&amp;_stateVer_=test_col:7&amp;fl=id&amp;fl=score&amp;shards.purpose=4&amp;start=0&amp;fsv=true&amp;shard.url=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/|http:\\/\\/127.0.0.1:34275\\/solr\\/test_col_shard1_replica2\\/&amp;rows=10&amp;version=2&amp;q=*:*&amp;NOW=1458985896717&amp;isShard=true&amp;wt=javabin} hits=1 status=0 QTime=0\\n1302745 INFO  (qtp1409631559-7344) [n:127.0.0.1:56361_solr c:test_col s:shard1 r:core_node1 x:test_col_shard1_replica1] o.a.s.c.S.Request [test_col_shard1_replica1]  webapp=\\/solr path=\\/select params={q=*:*&amp;distrib=false&amp;_stateVer_=test_col:7&amp;fl=id,expected_shard_s,[shard]&amp;shards.purpose=64&amp;NOW=1458985896717&amp;ids=abc!447049285&amp;isShard=true&amp;shard.url=http:\\/\\/127.0.0.1:56361\\/solr\\/test_col_shard1_replica1\\/|http:\\/\\/127.0.0.1:34275\\/solr\\/test_col_shard1_replica2\\/&amp;wt=javabin&amp;version=2} status=0 QTime=0\\n1302746 INFO  (qtp1904355206-7332) [n:127.0.0.1:34275_solr c:test_col s:shard1 r:core_node4 x:test_col_shard1_replica2] o.a.s.c.S.Request [test_col_shard1_replica2]  webapp=\\/solr path=\\/select params={q=*:*&amp;_stateVer_=test_col:7&amp;fl=id,expected_shard_s,[shard]&amp;wt=javabin&amp;version=2} hits=1 status=0 QTime=7\\n \\n   \\n\\t \\n\\t \\n \\n\\n\\n\\n So to sum up: it appears everything i noted before would be easily explained by a some broken code regarding live nodes that only affected port #56361 while all other nodes had a perfecly accurate view of the world.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15215271\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15215271&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15215271\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15215271_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15215271_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 02:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T02:12:41+0000\'\u003e29\\/Mar\\/16 02:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching another interesting view: live_nodes_mentions.log.txt...\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is every log entry from ZkStateReader mentioning \\\"live nodes\\\" (not just \\\"live nodes size\\\", so \\\"Updated live nodes from ZooKeeper...\\\" msgs also show up) distilled down to only the timestamp port# (or TEST if it\'s from the main testing thread via MiniSolrCloudCluster or waitForRecoveries) and log message.\u003c\\/p\u003e\\n\\n\u003cp\u003eGenerated via...\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003egrep -i \u003cspan class=\\\"code-quote\\\"\u003e\\\"live nodes\\\"\u003c\\/span\u003e jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt | perl -ple \u003cspan class=\\\"code-quote\\\"\u003e\'s\\/.*2&gt; (\\\\d+).*?(\\\\[[^\\\\]]*? \\\\]) o.a.s.c.c.ZkStateReader(.*)\\/$1 $2 $3\\/; s\\/\\\\[n:127.0.0.1:(\\\\d+)_solr\\\\s*?\\\\]\\/port $1\\/; s\\/\\\\[\\\\s+\\\\]\\/     TEST \\/\'\u003c\\/span\u003e &gt; live_nodes_mentions.log.txt\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003e... use \u003ctt\u003egrep -v \\\"port 63099\\\"\u003c\\/tt\u003e if you want to only focus on the nodes that host a piece of the collection.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15215271_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15215271_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 02:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T02:12:41+0000\'\u003e29\\/Mar\\/16 02:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching another interesting view: live_nodes_mentions.log.txt... \\n\\n This is every log entry from ZkStateReader mentioning \\\"live nodes\\\" (not just \\\"live nodes size\\\", so \\\"Updated live nodes from ZooKeeper...\\\" msgs also show up) distilled down to only the timestamp port# (or TEST if it\'s from the main testing thread via MiniSolrCloudCluster or waitForRecoveries) and log message. \\n\\n Generated via... \\n  \\n grep -i  \\\"live nodes\\\"  jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt | perl -ple  \'s\\/.*2&gt; (\\\\d+).*?(\\\\[[^\\\\]]*? \\\\]) o.a.s.c.c.ZkStateReader(.*)\\/$1 $2 $3\\/; s\\/\\\\[n:127.0.0.1:(\\\\d+)_solr\\\\s*?\\\\]\\/port $1\\/; s\\/\\\\[\\\\s+\\\\]\\/     TEST \\/\'  &gt; live_nodes_mentions.log.txt\\n \\n  \\n ... use  grep -v \\\"port 63099\\\"  if you want to only focus on the nodes that host a piece of the collection.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15216972\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15216972&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15216972\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15216972_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15216972_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:26:38+0000\'\u003e29\\/Mar\\/16 22:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eHaving read more of \u003ctt\u003eZkStateReader\u003c\\/tt\u003e, and understanding a bit better when\\/why these various log messages are written, it now seems certain to me that ZkStateReader\'s callbacks to watching \u003ctt\u003elive_nodes\u003c\\/tt\u003e and updating that information in the (local) \u003ctt\u003eClusterState\u003c\\/tt\u003e is \u003cb\u003eabsolutely not thread safe\u003c\\/b\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eKey things to note about the ZkStateReader code related to live nodes and live nodes log msgs...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThe following are examples of log message formats that occur when a ZK \u003ctt\u003eWatcher\u003c\\/tt\u003e\'s process method is triggered - in all of these cases the # of live nodes logged is the \u003cem\u003ecurrent\u003c\\/em\u003e number, according to local state, prior to processing the Watcher event...\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eLegacyClusterStateWatcher (old multi-collections state.json)\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003e\u003ctt\u003e\\\"A cluster state change: [{}] for collection [{}] has occurred - updating... (live nodes size: [{}])\\\"\u003c\\/tt\u003e\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003e\u003cem\u003eNOTE: this is the current (local) \u003ctt\u003eliveNodes.size()\u003c\\/tt\u003e, w\\/ no attempt to refresh \u003ctt\u003eliveNodes\u003c\\/tt\u003e from ZK\u003c\\/em\u003e\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eStateWatcher (per collection state.json)\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003e\u003ctt\u003e\\\"A cluster state change: [{}] for collection [{}] has occurred - updating... (live nodes size: [{}])\\\"\u003c\\/tt\u003e\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003e\u003cem\u003eNOTE: this is the current (local) \u003ctt\u003eliveNodes.size()\u003c\\/tt\u003e, w\\/ no attempt to refresh \u003ctt\u003eliveNodes\u003c\\/tt\u003e from ZK\u003c\\/em\u003e\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eLiveNodeWatcher\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003e\u003ctt\u003e\\\"A live node change: [{}], has occurred - updating... (live nodes size: [{}])\\\"\u003c\\/tt\u003e\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003e\u003cb\u003eNOTE: This the \\\"old\\\" value when a LiveNodesWatcher is triggered, prior to refreshing from ZK\u003c\\/b\u003e\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eThe following is what gets logged \u003cem\u003eafter\u003c\\/em\u003e the local cache of the live nodes data has been updated (either by an explicit method call to fetch the data from ZK on startup, or because a LiveNodeWatcher was triggered by ZK)\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003e\u003ctt\u003e\\\"Updated live nodes from ZooKeeper... ({}) -&gt; ({})\\\"\u003c\\/tt\u003e\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eThe full code for how the local cache of \u003ctt\u003eliveNode\u003c\\/tt\u003e is refreshed from ZK (either by an explifit method call on startup or because a LiveNodeWatcher was triggered) is...\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n  List&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; nodeList = zkClient.getChildren(LIVE_NODES_ZKNODE, watcher, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n  newLiveNodes = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e HashSet&lt;&gt;(nodeList);\\n} \u003cspan class=\\\"code-keyword\\\"\u003ecatch\u003c\\/span\u003e (KeeperException.NoNodeException e) {\\n  newLiveNodes = emptySet();\\n}\\nSet&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; oldLiveNodes;\\n\u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (getUpdateLock()) {\\n  oldLiveNodes = \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.liveNodes;\\n  \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.liveNodes = newLiveNodes;\\n  \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (clusterState != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n    clusterState.setLiveNodes(newLiveNodes);\\n  }\\n}\\nLOG.info(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Updated live nodes from ZooKeeper... ({}) -&gt; ({})\\\"\u003c\\/span\u003e, oldLiveNodes.size(), newLiveNodes.size());\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eWith all of that info in mind if we revisi the log file, and focus on the threadIds that log each message for a single port we know is problematic (56361)...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003egrep -i \u003cspan class=\\\"code-quote\\\"\u003e\\\"live nodes\\\"\u003c\\/span\u003e jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt | grep 127.0.0.1:56361_solr | perl -ple \u003cspan class=\\\"code-quote\\\"\u003e\'s\\/.*2&gt; (\\\\d+).*?\\\\((.*?-\\\\d+)(?:-processing-n:127.*?)?\\\\).*o.a.s.c.c.ZkStateReader(.*)\\/$1 $2 $3\\/\'\u003c\\/span\u003e &gt; live_node_mentions_port56361_with_threadIds.log.txt\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003e...it becomes really easy to spot the problem...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e1290004 jetty-launcher-1118-thread-5  Updated live nodes from ZooKeeper... (0) -&gt; (0)\\n1290033 zkCallback-1135-thread-1  A live node change: [WatchedEvent state:SyncConnected type:NodeChildrenChanged path:\\/live_nodes], has occurred - updating... (live nodes size: [0])\\n1290047 zkCallback-1135-thread-2  A live node change: [WatchedEvent state:SyncConnected type:NodeChildrenChanged path:\\/live_nodes], has occurred - updating... (live nodes size: [0])\\n1290052 zkCallback-1135-thread-3  A live node change: [WatchedEvent state:SyncConnected type:NodeChildrenChanged path:\\/live_nodes], has occurred - updating... (live nodes size: [0])\\n1290070 zkCallback-1135-thread-3  Updated live nodes from ZooKeeper... (0) -&gt; (4)\\n1290071 zkCallback-1135-thread-3  A live node change: [WatchedEvent state:SyncConnected type:NodeChildrenChanged path:\\/live_nodes], has occurred - updating... (live nodes size: [4])\\n1290071 zkCallback-1135-thread-3  Updated live nodes from ZooKeeper... (4) -&gt; (5)\\n1290075 zkCallback-1135-thread-1  Updated live nodes from ZooKeeper... (5) -&gt; (1)\\n1290076 zkCallback-1135-thread-2  Updated live nodes from ZooKeeper... (1) -&gt; (3)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003etimestamp #1290004 is when jetty is first starting up, and forcibly asks ZK for the list of live nodes.\u003c\\/li\u003e\\n\\t\u003cli\u003ewe then see 3 threads being spun up in numeric sequence order, to (start) processing LiveNodeWatcher events\u003c\\/li\u003e\\n\\t\u003cli\u003ethread-3 finishes and updates the live nodes to a list of size \\\"4\\\"\u003c\\/li\u003e\\n\\t\u003cli\u003ethread-3 is then re-used to (start) processing another LiveNodeWatcher event\u003c\\/li\u003e\\n\\t\u003cli\u003ethread-3 finishes again and updates the live nodes to a list of size \\\"5\\\"\u003c\\/li\u003e\\n\\t\u003cli\u003ethread-1 now finally finishes, and overwrites the live node list with a list of size \\\"1\\\" \u003cb\u003eeven though it\'s data is almost certainly old\u003c\\/b\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003ethread-1 now finally finishes, and also overwrites the live node list with a list of size \\\"3\\\" \u003cb\u003eeven though this data is almost certainly also old\u003c\\/b\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eFilling in the blanks, a valid sequence of events that fits the code and matches the logs could have been (colors matchg T# thread id)...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"blue\\\"\u003eT1 \u003ctt\u003eprocess()\u003c\\/tt\u003e called, logs \\\"A live node change: ...\\\"\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"blue\\\"\u003eT1 \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e returns a list of 1 live nodes\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"red\\\"\u003eT2 \u003ctt\u003eprocess()\u003c\\/tt\u003e called, logs \\\"A live node change: ...\\\"\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"green\\\"\u003eT3 \u003ctt\u003eprocess()\u003c\\/tt\u003e called, logs \\\"A live node change: ...\\\"\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"red\\\"\u003eT2 \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e returns a list of 3 live nodes\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"green\\\"\u003eT3 \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e returns a list of 4 live nodes\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"green\\\"\u003eT3 \u003ctt\u003eclusterState.setLiveNodes(\\\"4\\\")\u003c\\/tt\u003e called, logs \\\"Updated live nodes...\\\"\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"green\\\"\u003eT3 \u003ctt\u003eprocess()\u003c\\/tt\u003e is now finished, thread is free for re-use\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"green\\\"\u003eT3 \u003ctt\u003eprocess()\u003c\\/tt\u003e called, logs \\\"A live node change: ...\\\"\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"green\\\"\u003eT3 \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e returns a list of 5 live nodes\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"green\\\"\u003eT3 \u003ctt\u003eclusterState.setLiveNodes(\\\"5\\\")\u003c\\/tt\u003e called, logs \\\"Updated live nodes...\\\"\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"green\\\"\u003eT3 \u003ctt\u003eprocess()\u003c\\/tt\u003e is now finished, thread is free for re-use\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"blue\\\"\u003eT1 \u003ctt\u003eclusterState.setLiveNodes(\\\"1\\\")\u003c\\/tt\u003e called, logs \\\"Updated live nodes...\\\"\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"blue\\\"\u003eT1 \u003ctt\u003eprocess()\u003c\\/tt\u003e is now finished, thread is free for re-use\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"red\\\"\u003eT2 \u003ctt\u003eclusterState.setLiveNodes(\\\"3\\\")\u003c\\/tt\u003e called, logs \\\"Updated live nodes...\\\"\u003c\\/font\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003cfont color=\\\"red\\\"\u003eT2 \u003ctt\u003eprocess()\u003c\\/tt\u003e is now finished, thread is free for re-use\u003c\\/font\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e\u003cem\u003e(NOTE: one thing i\'m not clear on is why there are only 4 \u003ctt\u003elive_nodes\u003c\\/tt\u003e NodeChildrenChanged WatchedEvents triggered - i would expect 5 total unless ZK doesn\'t garuntee a unique event for each new child node, does it send a single event if 2 children are added very close together in time?)\u003c\\/em\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eAfter the sequence of events above, port #56361 is hozed. In a real world situation, it will never update it\'s local state to match the \u003cem\u003ereal\u003c\\/em\u003e list of live nodes in ZK unless some other node goes up\\/down triggering the LiveNodesWatcher.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe rest of the \\\"live node\\\" log messages in our log file are either passively reporting the local cached data during other ZK events (specifically: collection creation trigging the state.json watcher) or they are the triggers to the LiveNodeWatcher when MiniSolrCloudCluster starts shutting down nodes after the test has failed.\u003c\\/p\u003e\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15216972_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15216972_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:26:38+0000\'\u003e29\\/Mar\\/16 22:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Having read more of  ZkStateReader , and understanding a bit better when\\/why these various log messages are written, it now seems certain to me that ZkStateReader\'s callbacks to watching  live_nodes  and updating that information in the (local)  ClusterState  is  absolutely not thread safe . \\n\\n Key things to note about the ZkStateReader code related to live nodes and live nodes log msgs... \\n\\n \\n\\t The following are examples of log message formats that occur when a ZK  Watcher \'s process method is triggered - in all of these cases the # of live nodes logged is the  current  number, according to local state, prior to processing the Watcher event...\\n\\t \\n\\t\\t LegacyClusterStateWatcher (old multi-collections state.json)\\n\\t\\t \\n\\t\\t\\t  \\\"A cluster state change: [{}] for collection [{}] has occurred - updating... (live nodes size: [{}])\\\"  \\n\\t\\t\\t  NOTE: this is the current (local)  liveNodes.size() , w\\/ no attempt to refresh  liveNodes  from ZK  \\n\\t\\t \\n\\t\\t \\n\\t\\t StateWatcher (per collection state.json)\\n\\t\\t \\n\\t\\t\\t  \\\"A cluster state change: [{}] for collection [{}] has occurred - updating... (live nodes size: [{}])\\\"  \\n\\t\\t\\t  NOTE: this is the current (local)  liveNodes.size() , w\\/ no attempt to refresh  liveNodes  from ZK  \\n\\t\\t \\n\\t\\t \\n\\t\\t LiveNodeWatcher\\n\\t\\t \\n\\t\\t\\t  \\\"A live node change: [{}], has occurred - updating... (live nodes size: [{}])\\\"  \\n\\t\\t\\t  NOTE: This the \\\"old\\\" value when a LiveNodesWatcher is triggered, prior to refreshing from ZK  \\n\\t\\t \\n\\t\\t \\n\\t \\n\\t \\n\\t The following is what gets logged  after  the local cache of the live nodes data has been updated (either by an explicit method call to fetch the data from ZK on startup, or because a LiveNodeWatcher was triggered by ZK)\\n\\t \\n\\t\\t  \\\"Updated live nodes from ZooKeeper... ({}) -&gt; ({})\\\"  \\n\\t \\n\\t \\n\\t The full code for how the local cache of  liveNode  is refreshed from ZK (either by an explifit method call on startup or because a LiveNodeWatcher was triggered) is...\\n  \\n  try  {\\n  List&lt; String &gt; nodeList = zkClient.getChildren(LIVE_NODES_ZKNODE, watcher,  true );\\n  newLiveNodes =  new  HashSet&lt;&gt;(nodeList);\\n}  catch  (KeeperException.NoNodeException e) {\\n  newLiveNodes = emptySet();\\n}\\nSet&lt; String &gt; oldLiveNodes;\\n synchronized  (getUpdateLock()) {\\n  oldLiveNodes =  this .liveNodes;\\n   this .liveNodes = newLiveNodes;\\n   if  (clusterState !=  null ) {\\n    clusterState.setLiveNodes(newLiveNodes);\\n  }\\n}\\nLOG.info( \\\"Updated live nodes from ZooKeeper... ({}) -&gt; ({})\\\" , oldLiveNodes.size(), newLiveNodes.size());\\n \\n   \\n \\n\\n\\n\\n With all of that info in mind if we revisi the log file, and focus on the threadIds that log each message for a single port we know is problematic (56361)... \\n\\n  \\n grep -i  \\\"live nodes\\\"  jenkins.thetaphi.de_Lucene-Solr-6.x-Solaris_32.log.txt | grep 127.0.0.1:56361_solr | perl -ple  \'s\\/.*2&gt; (\\\\d+).*?\\\\((.*?-\\\\d+)(?:-processing-n:127.*?)?\\\\).*o.a.s.c.c.ZkStateReader(.*)\\/$1 $2 $3\\/\'  &gt; live_node_mentions_port56361_with_threadIds.log.txt\\n \\n  \\n\\n ...it becomes really easy to spot the problem... \\n\\n  \\n 1290004 jetty-launcher-1118-thread-5  Updated live nodes from ZooKeeper... (0) -&gt; (0)\\n1290033 zkCallback-1135-thread-1  A live node change: [WatchedEvent state:SyncConnected type:NodeChildrenChanged path:\\/live_nodes], has occurred - updating... (live nodes size: [0])\\n1290047 zkCallback-1135-thread-2  A live node change: [WatchedEvent state:SyncConnected type:NodeChildrenChanged path:\\/live_nodes], has occurred - updating... (live nodes size: [0])\\n1290052 zkCallback-1135-thread-3  A live node change: [WatchedEvent state:SyncConnected type:NodeChildrenChanged path:\\/live_nodes], has occurred - updating... (live nodes size: [0])\\n1290070 zkCallback-1135-thread-3  Updated live nodes from ZooKeeper... (0) -&gt; (4)\\n1290071 zkCallback-1135-thread-3  A live node change: [WatchedEvent state:SyncConnected type:NodeChildrenChanged path:\\/live_nodes], has occurred - updating... (live nodes size: [4])\\n1290071 zkCallback-1135-thread-3  Updated live nodes from ZooKeeper... (4) -&gt; (5)\\n1290075 zkCallback-1135-thread-1  Updated live nodes from ZooKeeper... (5) -&gt; (1)\\n1290076 zkCallback-1135-thread-2  Updated live nodes from ZooKeeper... (1) -&gt; (3)\\n \\n  \\n\\n \\n\\t timestamp #1290004 is when jetty is first starting up, and forcibly asks ZK for the list of live nodes. \\n\\t we then see 3 threads being spun up in numeric sequence order, to (start) processing LiveNodeWatcher events \\n\\t thread-3 finishes and updates the live nodes to a list of size \\\"4\\\" \\n\\t thread-3 is then re-used to (start) processing another LiveNodeWatcher event \\n\\t thread-3 finishes again and updates the live nodes to a list of size \\\"5\\\" \\n\\t thread-1 now finally finishes, and overwrites the live node list with a list of size \\\"1\\\"  even though it\'s data is almost certainly old  \\n\\t thread-1 now finally finishes, and also overwrites the live node list with a list of size \\\"3\\\"  even though this data is almost certainly also old  \\n \\n\\n\\n Filling in the blanks, a valid sequence of events that fits the code and matches the logs could have been (colors matchg T# thread id)... \\n\\n \\n\\t  T1  process()  called, logs \\\"A live node change: ...\\\"  \\n\\t  T1  zkClient.getChildren(...)  returns a list of 1 live nodes  \\n\\t  T2  process()  called, logs \\\"A live node change: ...\\\"  \\n\\t  T3  process()  called, logs \\\"A live node change: ...\\\"  \\n\\t  T2  zkClient.getChildren(...)  returns a list of 3 live nodes  \\n\\t  T3  zkClient.getChildren(...)  returns a list of 4 live nodes  \\n\\t  T3  clusterState.setLiveNodes(\\\"4\\\")  called, logs \\\"Updated live nodes...\\\"  \\n\\t  T3  process()  is now finished, thread is free for re-use  \\n\\t  T3  process()  called, logs \\\"A live node change: ...\\\"  \\n\\t  T3  zkClient.getChildren(...)  returns a list of 5 live nodes  \\n\\t  T3  clusterState.setLiveNodes(\\\"5\\\")  called, logs \\\"Updated live nodes...\\\"  \\n\\t  T3  process()  is now finished, thread is free for re-use  \\n\\t  T1  clusterState.setLiveNodes(\\\"1\\\")  called, logs \\\"Updated live nodes...\\\"  \\n\\t  T1  process()  is now finished, thread is free for re-use  \\n\\t  T2  clusterState.setLiveNodes(\\\"3\\\")  called, logs \\\"Updated live nodes...\\\"  \\n\\t  T2  process()  is now finished, thread is free for re-use  \\n \\n\\n\\n  (NOTE: one thing i\'m not clear on is why there are only 4  live_nodes  NodeChildrenChanged WatchedEvents triggered - i would expect 5 total unless ZK doesn\'t garuntee a unique event for each new child node, does it send a single event if 2 children are added very close together in time?)  \\n\\n After the sequence of events above, port #56361 is hozed. In a real world situation, it will never update it\'s local state to match the  real  list of live nodes in ZK unless some other node goes up\\/down triggering the LiveNodesWatcher. \\n\\n The rest of the \\\"live node\\\" log messages in our log file are either passively reporting the local cached data during other ZK events (specifically: collection creation trigging the state.json watcher) or they are the triggers to the LiveNodeWatcher when MiniSolrCloudCluster starts shutting down nodes after the test has failed. \\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15216977\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15216977&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15216977\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15216977_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15216977_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:30:03+0000\'\u003e29\\/Mar\\/16 22:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdating summary.\u003c\\/p\u003e\\n\\n\u003cp\u003eI suspect we either need to move the \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e call inside the existing \u003ctt\u003esynchronized (getUpdateLock())\u003c\\/tt\u003e block, or the entire \u003ctt\u003erefreshLiveNodes(Watcher watcher)\u003c\\/tt\u003e method needs to synchronize on some new \\\"liveNodesLock\\\".\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15216977_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15216977_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:30:03+0000\'\u003e29\\/Mar\\/16 22:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updating summary. \\n\\n I suspect we either need to move the  zkClient.getChildren(...)  call inside the existing  synchronized (getUpdateLock())  block, or the entire  refreshLiveNodes(Watcher watcher)  method needs to synchronize on some new \\\"liveNodesLock\\\".              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15216979\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15216979&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15216979\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15216979_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15216979_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:31:31+0000\'\u003e29\\/Mar\\/16 22:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is super troubling....\u003c\\/p\u003e\\n\\n\u003cp\u003e1290071 port 56361  Updated live nodes from ZooKeeper... (4) -&gt; (5)\u003cbr\\/\u003e\\n1290075 port 56361  Updated live nodes from ZooKeeper... (5) -&gt; (1)\u003cbr\\/\u003e\\n1290076 port 56361  Updated live nodes from ZooKeeper... (1) -&gt; (3)\u003c\\/p\u003e\\n\\n\u003cp\u003eWTF?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15216979_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15216979_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:31:31+0000\'\u003e29\\/Mar\\/16 22:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is super troubling.... \\n\\n 1290071 port 56361  Updated live nodes from ZooKeeper... (4) -&gt; (5) \\n1290075 port 56361  Updated live nodes from ZooKeeper... (5) -&gt; (1) \\n1290076 port 56361  Updated live nodes from ZooKeeper... (1) -&gt; (3) \\n\\n WTF?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15216989\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15216989&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15216989\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15216989_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15216989_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:35:14+0000\'\u003e29\\/Mar\\/16 22:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWTF?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eour comments seem to have the same problem as refreshLiveNodes &#8211; concurrent updates.  see the additional analysis i just posted\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15216989_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15216989_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:35:14+0000\'\u003e29\\/Mar\\/16 22:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     WTF?  \\n\\n our comments seem to have the same problem as refreshLiveNodes &#8211; concurrent updates.  see the additional analysis i just posted              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217011\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217011&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217011\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217011_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217011_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:55:24+0000\'\u003e29\\/Mar\\/16 22:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHoss-- great analysis!  I was just looking at this code myself.  The part I don\'t understand is why this watcher is getting fired multiple times on different threads.  I (re)wrote some of this code, and one of my implicit assumptions that was that any given watcher would not get re-fired until the previous watcher invocation had returned.  But maybe that was a really bad assumption that I carried over from Curator, or perhaps the thread model in ZK has changed?\u003c\\/p\u003e\\n\\n\u003cp\u003eEither way, I completely agree that this is broken if we can get multiple concurrent ZK callbacks on the same watcher.\u003c\\/p\u003e\\n\\n\u003cp\u003egetUpdateLock() is an overly broad lock, we should not try to hold that lock while calling ZK.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have a few proposals on how to fix:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) Add a getChildren() variant that returns a Stat object, and use version tracking.  I could make an argument that this is the most sane way to break any versioning ties, since it completely eliminates client-side concurrency issues in the ZK framework code.  If we don\'t do this, we\'re always implicitly depending on our ability to linearly sequence getChildren calls.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) Make the various Watcher objects lock themselves for the duration of process(WatchedEvent event).  That way, subsequent callbacks will have to linearize.\u003c\\/p\u003e\\n\\n\u003cp\u003e3) Similar idea, but put that same set of locks as top-level fields in ZkStateReader.  This is like #2, but also protects against a multiple-watchers scenario.  I\'ve tried to avoid situations of multiple watchers, there\'s no real guard against multiple calls to createClusterStateWatchersAndUpdate().\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217011_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217011_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 22:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T22:55:24+0000\'\u003e29\\/Mar\\/16 22:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hoss-- great analysis!  I was just looking at this code myself.  The part I don\'t understand is why this watcher is getting fired multiple times on different threads.  I (re)wrote some of this code, and one of my implicit assumptions that was that any given watcher would not get re-fired until the previous watcher invocation had returned.  But maybe that was a really bad assumption that I carried over from Curator, or perhaps the thread model in ZK has changed? \\n\\n Either way, I completely agree that this is broken if we can get multiple concurrent ZK callbacks on the same watcher. \\n\\n getUpdateLock() is an overly broad lock, we should not try to hold that lock while calling ZK. \\n\\n I have a few proposals on how to fix: \\n\\n 1) Add a getChildren() variant that returns a Stat object, and use version tracking.  I could make an argument that this is the most sane way to break any versioning ties, since it completely eliminates client-side concurrency issues in the ZK framework code.  If we don\'t do this, we\'re always implicitly depending on our ability to linearly sequence getChildren calls. \\n\\n 2) Make the various Watcher objects lock themselves for the duration of process(WatchedEvent event).  That way, subsequent callbacks will have to linearize. \\n\\n 3) Similar idea, but put that same set of locks as top-level fields in ZkStateReader.  This is like #2, but also protects against a multiple-watchers scenario.  I\'ve tried to avoid situations of multiple watchers, there\'s no real guard against multiple calls to createClusterStateWatchersAndUpdate().              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217032\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217032&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217032\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217032_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217032_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 23:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T23:08:15+0000\'\u003e29\\/Mar\\/16 23:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s a pretty simple patch that I believe should fix.  I think #3 is probably the safest option here.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217032_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217032_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 23:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T23:08:15+0000\'\u003e29\\/Mar\\/16 23:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s a pretty simple patch that I believe should fix.  I think #3 is probably the safest option here.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217033\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217033&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217033\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15217033_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217033_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 23:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T23:09:35+0000\'\u003e29\\/Mar\\/16 23:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eThe part I don\'t understand is why this watcher is getting fired multiple times on different threads. I (re)wrote some of this code, and one of my implicit assumptions that was that any given watcher would not get re-fired until the previous watcher invocation had returned. But maybe that was a really bad assumption that I carried over from Curator, or perhaps the thread model in ZK has changed?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI have no idea what the thread model for ZK is, but let\'s assume your implicit assumption was correct...\u003c\\/p\u003e\\n\\n\u003cp\u003eThat would still match the observed behavior, and a hypothetical sequence of events very similar to the one i outlined, since the \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e calls are passing the LiveNodeWatcher back to ZK.  so T1\'s call to \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e call adds the LiveNodeWatcher back, but before T1 has a chance to write it\'s local state that watcher fires and triggers T2, and T2\'s \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e call adds the LiveNodeWatcher backm but before either T1 or T2 can write to the local state that watcher fires and triggers T3, ... after T3 writes the local state, T1 and T2 overwrite it with their stale data.\u003c\\/p\u003e\\n\\n\u003cp\u003eYour implicit assumption would alos explain the part i was confused about: why there are only 4 \u003ctt\u003elive_nodes\u003c\\/tt\u003e child events triggered instead of 5.  2 nodes must have come online add added themselves to \u003ctt\u003elive_nodes\\/\u003c\\/tt\u003e between the time T2\'s watch even was triggered and when T2 added a new watcher via the \u003ctt\u003ezkClient.getChildren(...)\u003c\\/tt\u003e call (explaining the jump from \\\"1\\\" to \\\"3\\\")\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15217033_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217033_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 23:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T23:09:35+0000\'\u003e29\\/Mar\\/16 23:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n The part I don\'t understand is why this watcher is getting fired multiple times on different threads. I (re)wrote some of this code, and one of my implicit assumptions that was that any given watcher would not get re-fired until the previous watcher invocation had returned. But maybe that was a really bad assumption that I carried over from Curator, or perhaps the thread model in ZK has changed?  \\n\\n I have no idea what the thread model for ZK is, but let\'s assume your implicit assumption was correct... \\n\\n That would still match the observed behavior, and a hypothetical sequence of events very similar to the one i outlined, since the  zkClient.getChildren(...)  calls are passing the LiveNodeWatcher back to ZK.  so T1\'s call to  zkClient.getChildren(...)  call adds the LiveNodeWatcher back, but before T1 has a chance to write it\'s local state that watcher fires and triggers T2, and T2\'s  zkClient.getChildren(...)  call adds the LiveNodeWatcher backm but before either T1 or T2 can write to the local state that watcher fires and triggers T3, ... after T3 writes the local state, T1 and T2 overwrite it with their stale data. \\n\\n Your implicit assumption would alos explain the part i was confused about: why there are only 4  live_nodes  child events triggered instead of 5.  2 nodes must have come online add added themselves to  live_nodes\\/  between the time T2\'s watch even was triggered and when T2 added a new watcher via the  zkClient.getChildren(...)  call (explaining the jump from \\\"1\\\" to \\\"3\\\")              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217036\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217036&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217036\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217036_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217036_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 23:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T23:11:22+0000\'\u003e29\\/Mar\\/16 23:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBTW, a million thanks to Hoss for digging into this.  We\'ve seen this in production in certain circumstances, I think it\'s triggered when we have multiple nodes experiencing long GC pauses at the same time, enough to drop ZK sessions.  The cluster can get into a state where it never fully recovers; but we\'ve found that if we perform a \\\"live_nodes tickle\\\" but dropping a dummy child into \\\"live_nodes\\\" then deleting it, things fix themselves.  I\'m so thankful to finally have an explanation, even if the root cause is my fault!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217036_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217036_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 23:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T23:11:22+0000\'\u003e29\\/Mar\\/16 23:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    BTW, a million thanks to Hoss for digging into this.  We\'ve seen this in production in certain circumstances, I think it\'s triggered when we have multiple nodes experiencing long GC pauses at the same time, enough to drop ZK sessions.  The cluster can get into a state where it never fully recovers; but we\'ve found that if we perform a \\\"live_nodes tickle\\\" but dropping a dummy child into \\\"live_nodes\\\" then deleting it, things fix themselves.  I\'m so thankful to finally have an explanation, even if the root cause is my fault!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217043\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217043&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217043\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217043_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217043_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 23:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T23:14:29+0000\'\u003e29\\/Mar\\/16 23:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYeah, one of the things about ZK is it\'s impossible to view all changes as a strict linear sequence using the client-facing watcher protocol, because the watch events don\'t contain the data you want; by the time you can fetch the data in response to the event, it\'s already stale, so you can absolutely miss transient states. I assume that if you spoke ZK server replication protocol, then you could get a linearized change sequence.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217043_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217043_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/16 23:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-29T23:14:29+0000\'\u003e29\\/Mar\\/16 23:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yeah, one of the things about ZK is it\'s impossible to view all changes as a strict linear sequence using the client-facing watcher protocol, because the watch events don\'t contain the data you want; by the time you can fetch the data in response to the event, it\'s already stale, so you can absolutely miss transient states. I assume that if you spoke ZK server replication protocol, then you could get a linearized change sequence.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217370\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217370&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217370\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15217370_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217370_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 04:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T04:41:42+0000\'\u003e30\\/Mar\\/16 04:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI wrote up a stress test to demonstrate the bug.  I\'ve added it to the patch Scott already worked up &amp; attached.\u003c\\/p\u003e\\n\\n\u003cp\u003eScott: Prior to incorporating your changes, hammering on this stress test would fail within the first 20 attempts.  But with your changes I\'m seeing deadlocks within the first 5 attempts every time i hammer on it...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eFound one Java-level deadlock:\\n=============================\\n\\\"zkCallback-7-thread-2-processing-n:127.0.0.1:48312_solr\\\":\\n  waiting to lock monitor 0x00007f82d40076b8 (object 0x00000000ff3b5b38, a java.lang.Object),\\n  which is held by \\\"zkCallback-7-thread-1-processing-n:127.0.0.1:48312_solr\\\"\\n\\\"zkCallback-7-thread-1-processing-n:127.0.0.1:48312_solr\\\":\\n  waiting to lock monitor 0x00007f82d400be38 (object 0x00000000ff3b5800, a org.apache.solr.common.cloud.ZkStateReader),\\n  which is held by \\\"OverseerStateUpdate-95637266046386179-127.0.0.1:48312_solr-n_0000000000\\\"\\n\\\"OverseerStateUpdate-95637266046386179-127.0.0.1:48312_solr-n_0000000000\\\":\\n  waiting to lock monitor 0x00007f82d40076b8 (object 0x00000000ff3b5b38, a java.lang.Object),\\n  which is held by \\\"zkCallback-7-thread-1-processing-n:127.0.0.1:48312_solr\\\"\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15217370_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217370_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 04:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T04:41:42+0000\'\u003e30\\/Mar\\/16 04:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I wrote up a stress test to demonstrate the bug.  I\'ve added it to the patch Scott already worked up &amp; attached. \\n\\n Scott: Prior to incorporating your changes, hammering on this stress test would fail within the first 20 attempts.  But with your changes I\'m seeing deadlocks within the first 5 attempts every time i hammer on it... \\n\\n  \\n Found one Java-level deadlock:\\n=============================\\n\\\"zkCallback-7-thread-2-processing-n:127.0.0.1:48312_solr\\\":\\n  waiting to lock monitor 0x00007f82d40076b8 (object 0x00000000ff3b5b38, a java.lang.Object),\\n  which is held by \\\"zkCallback-7-thread-1-processing-n:127.0.0.1:48312_solr\\\"\\n\\\"zkCallback-7-thread-1-processing-n:127.0.0.1:48312_solr\\\":\\n  waiting to lock monitor 0x00007f82d400be38 (object 0x00000000ff3b5800, a org.apache.solr.common.cloud.ZkStateReader),\\n  which is held by \\\"OverseerStateUpdate-95637266046386179-127.0.0.1:48312_solr-n_0000000000\\\"\\n\\\"OverseerStateUpdate-95637266046386179-127.0.0.1:48312_solr-n_0000000000\\\":\\n  waiting to lock monitor 0x00007f82d40076b8 (object 0x00000000ff3b5b38, a java.lang.Object),\\n  which is held by \\\"zkCallback-7-thread-1-processing-n:127.0.0.1:48312_solr\\\"\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217379\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217379&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217379\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15217379_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217379_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 04:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T04:58:05+0000\'\u003e30\\/Mar\\/16 04:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m still digesting the discussions in this thread but..\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e...and one of my implicit assumptions that was that any given watcher would not get re-fired until the previous watcher invocation had returned. But maybe that was a really bad assumption that I carried over from Curator, or perhaps the thread model in ZK has changed?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI guess that\'s not true anymore because the watcher invocations are done asynchronously via a thread pool in Solr. So the original guarantees made by ZK don\'t apply anymore?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15217379_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217379_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 04:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T04:58:05+0000\'\u003e30\\/Mar\\/16 04:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m still digesting the discussions in this thread but.. \\n\\n  ...and one of my implicit assumptions that was that any given watcher would not get re-fired until the previous watcher invocation had returned. But maybe that was a really bad assumption that I carried over from Curator, or perhaps the thread model in ZK has changed?  \\n\\n I guess that\'s not true anymore because the watcher invocations are done asynchronously via a thread pool in Solr. So the original guarantees made by ZK don\'t apply anymore?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217413\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217413&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217413\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_15217413_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217413_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 05:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T05:18:53+0000\'\u003e30\\/Mar\\/16 05:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI guess that\'s not true anymore because the watcher invocations are done asynchronously via a thread pool in Solr. So the original guarantees made by ZK don\'t apply anymore?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1 shalin. Even if ZK does the event loop in a single thread, it fires the callback into \u003ctt\u003eSolrZkClient.zkCallbackExecutor\u003c\\/tt\u003e threadpool . So that single thread is free to fire more callbacks. So, we cannot guarantee thread safety in any watcher callback functions\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_15217413_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217413_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 05:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T05:18:53+0000\'\u003e30\\/Mar\\/16 05:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I guess that\'s not true anymore because the watcher invocations are done asynchronously via a thread pool in Solr. So the original guarantees made by ZK don\'t apply anymore?  \\n\\n +1 shalin. Even if ZK does the event loop in a single thread, it fires the callback into  SolrZkClient.zkCallbackExecutor  threadpool . So that single thread is free to fire more callbacks. So, we cannot guarantee thread safety in any watcher callback functions              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217464\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217464&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217464\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_15217464_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217464_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 06:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T06:10:23+0000\'\u003e30\\/Mar\\/16 06:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehoss, what I would like to know is what if it is not threadsafe? The live nodes set is expected to change all the time. So, what if multiple threads update the Set one after other? \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_15217464_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217464_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 06:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T06:10:23+0000\'\u003e30\\/Mar\\/16 06:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    hoss, what I would like to know is what if it is not threadsafe? The live nodes set is expected to change all the time. So, what if multiple threads update the Set one after other?               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217494\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217494&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217494\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217494_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217494_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 06:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T06:29:52+0000\'\u003e30\\/Mar\\/16 06:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe problem is inherently that if you getChildren() three times and get 3 different answers, there\'s currently no guarantee about which of those invocations and answers will ultimately populate the live_nodes var.  At that point, if no more server side changes happen, the watcher never re-fires and you\'re stuck with stale data.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217494_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217494_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 06:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T06:29:52+0000\'\u003e30\\/Mar\\/16 06:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The problem is inherently that if you getChildren() three times and get 3 different answers, there\'s currently no guarantee about which of those invocations and answers will ultimately populate the live_nodes var.  At that point, if no more server side changes happen, the watcher never re-fires and you\'re stuck with stale data.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217497\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217497&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217497\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217497_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217497_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 06:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T06:31:53+0000\'\u003e30\\/Mar\\/16 06:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eShould be easy enough to debug the deadlock.  I\'ll take a look tomorrow.  Thanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217497_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217497_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 06:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T06:31:53+0000\'\u003e30\\/Mar\\/16 06:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Should be easy enough to debug the deadlock.  I\'ll take a look tomorrow.  Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217507\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217507&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217507\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_15217507_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217507_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 06:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T06:41:56+0000\'\u003e30\\/Mar\\/16 06:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK , That is understandable. It makes sense to make the whole \u003ctt\u003eLiveNodeWatcher.process()\u003c\\/tt\u003e synchronized. The current updateLock object is common for the entire cluster state. Should we not have  a separate lock for just livenodes, because live nodes are updated independently of the rest and it changes often.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_15217507_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217507_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 06:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T06:41:56+0000\'\u003e30\\/Mar\\/16 06:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK , That is understandable. It makes sense to make the whole  LiveNodeWatcher.process()  synchronized. The current updateLock object is common for the entire cluster state. Should we not have  a separate lock for just livenodes, because live nodes are updated independently of the rest and it changes often. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217585\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217585&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217585\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217585_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217585_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 07:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T07:32:13+0000\'\u003e30\\/Mar\\/16 07:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYep, that\'s what my patch does.  I just have to debug the deadlock.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217585_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217585_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 07:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T07:32:13+0000\'\u003e30\\/Mar\\/16 07:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yep, that\'s what my patch does.  I just have to debug the deadlock.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217597\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217597&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217597\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217597_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217597_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 07:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T07:39:58+0000\'\u003e30\\/Mar\\/16 07:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOh.. I can see by inspection.  It\'s because createClusterStateWatchersAndUpdate() and updateClusterState() hold the update lock before calling the e.g. refreshLiveNodes().  Perhaps those two big methods should hold a more high-level lock instead of the update lock.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217597_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217597_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 07:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T07:39:58+0000\'\u003e30\\/Mar\\/16 07:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oh.. I can see by inspection.  It\'s because createClusterStateWatchersAndUpdate() and updateClusterState() hold the update lock before calling the e.g. refreshLiveNodes().  Perhaps those two big methods should hold a more high-level lock instead of the update lock.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15217612\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15217612&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15217612\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217612_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217612_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 07:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T07:48:17+0000\'\u003e30\\/Mar\\/16 07:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlternatively I could imagine a more golang channel style formulation like this..\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ We don\'t get a Stat or track versions on getChildren() calls, so force linearization.\\n\u003c\\/span\u003e  \u003cspan class=\\\"code-keyword\\\"\u003eprivate\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e refreshLiveNodesLock = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e();\\n  \u003cspan class=\\\"code-keyword\\\"\u003eprivate\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Queue&lt;Set&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt;&gt; newLiveNodesQueue = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e ConcurrentLinkedQueue&lt;&gt;();\\n\\n  \\/**\\n   * Refresh live_nodes.\\n   *\\/\\n  \u003cspan class=\\\"code-keyword\\\"\u003eprivate\u003c\\/span\u003e void refreshLiveNodes(Watcher watcher) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e KeeperException, InterruptedException {\\n    \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (refreshLiveNodesLock) {\\n      \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n        List&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; nodeList = zkClient.getChildren(LIVE_NODES_ZKNODE, watcher, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n        newLiveNodesQueue.add(\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e HashSet&lt;&gt;(nodeList));\\n      } \u003cspan class=\\\"code-keyword\\\"\u003ecatch\u003c\\/span\u003e (KeeperException.NoNodeException e) {\\n        newLiveNodesQueue.add(emptySet());\\n      }\\n    }\\n    Set&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; oldLiveNodes;\\n    \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (getUpdateLock()) {\\n      Set&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; newLiveNodes = newLiveNodesQueue.remove();\\n      oldLiveNodes = \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.liveNodes;\\n      \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.liveNodes = newLiveNodes;\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (clusterState != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        clusterState.setLiveNodes(newLiveNodes);\\n      }\\n      LOG.info(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Updated live nodes from ZooKeeper... ({}) -&gt; ({})\\\"\u003c\\/span\u003e, oldLiveNodes.size(), newLiveNodes.size());\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (LOG.isDebugEnabled()) {\\n        LOG.debug(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Updated live nodes from ZooKeeper... {} -&gt; {}\\\"\u003c\\/span\u003e, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e TreeSet&lt;&gt;(oldLiveNodes), \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e TreeSet&lt;&gt;(newLiveNodes));\\n      }\\n    }\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eTo avoid the updateLock -&gt; liveNodesLock -&gt; updateLock cycle, but still linearize the results of successive invocations.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15217612_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15217612_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 07:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T07:48:17+0000\'\u003e30\\/Mar\\/16 07:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Alternatively I could imagine a more golang channel style formulation like this.. \\n\\n  \\n    \\/\\/ We don\'t get a Stat or track versions on getChildren() calls, so force linearization.\\n    private   final   Object  refreshLiveNodesLock =  new   Object ();\\n   private   final  Queue&lt;Set&lt; String &gt;&gt; newLiveNodesQueue =  new  ConcurrentLinkedQueue&lt;&gt;();\\n\\n  \\/**\\n   * Refresh live_nodes.\\n   *\\/\\n   private  void refreshLiveNodes(Watcher watcher)  throws  KeeperException, InterruptedException {\\n     synchronized  (refreshLiveNodesLock) {\\n       try  {\\n        List&lt; String &gt; nodeList = zkClient.getChildren(LIVE_NODES_ZKNODE, watcher,  true );\\n        newLiveNodesQueue.add( new  HashSet&lt;&gt;(nodeList));\\n      }  catch  (KeeperException.NoNodeException e) {\\n        newLiveNodesQueue.add(emptySet());\\n      }\\n    }\\n    Set&lt; String &gt; oldLiveNodes;\\n     synchronized  (getUpdateLock()) {\\n      Set&lt; String &gt; newLiveNodes = newLiveNodesQueue.remove();\\n      oldLiveNodes =  this .liveNodes;\\n       this .liveNodes = newLiveNodes;\\n       if  (clusterState !=  null ) {\\n        clusterState.setLiveNodes(newLiveNodes);\\n      }\\n      LOG.info( \\\"Updated live nodes from ZooKeeper... ({}) -&gt; ({})\\\" , oldLiveNodes.size(), newLiveNodes.size());\\n       if  (LOG.isDebugEnabled()) {\\n        LOG.debug( \\\"Updated live nodes from ZooKeeper... {} -&gt; {}\\\" ,  new  TreeSet&lt;&gt;(oldLiveNodes),  new  TreeSet&lt;&gt;(newLiveNodes));\\n      }\\n    }\\n  }\\n \\n  \\n\\n To avoid the updateLock -&gt; liveNodesLock -&gt; updateLock cycle, but still linearize the results of successive invocations.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218204\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218204&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218204\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15218204_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218204_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T15:57:45+0000\'\u003e30\\/Mar\\/16 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch, with a refinement of the channel formulation.  NOTE: I could not get TestStressLiveNodes to fail for me locally, but I believe this should fix the deadlock.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15218204_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218204_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T15:57:45+0000\'\u003e30\\/Mar\\/16 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch, with a refinement of the channel formulation.  NOTE: I could not get TestStressLiveNodes to fail for me locally, but I believe this should fix the deadlock.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218286\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218286&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218286\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_15218286_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218286_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T16:44:31+0000\'\u003e30\\/Mar\\/16 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003elooked at the patch .The block \u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (refreshLiveNodesLock) {\\n      Set&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; newLiveNodes;\\n      \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n        List&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; nodeList = zkClient.getChildren(LIVE_NODES_ZKNODE, watcher, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n        newLiveNodes = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e HashSet&lt;&gt;(nodeList);\\n      } \u003cspan class=\\\"code-keyword\\\"\u003ecatch\u003c\\/span\u003e (KeeperException.NoNodeException e) {\\n        newLiveNodes = emptySet();\\n      }\\n      lastFetchedLiveNodes.set(newLiveNodes);\\n    }\\n\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Can\'t lock getUpdateLock() until we release the other, it would cause deadlock.\\n\u003c\\/span\u003e    Set&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; oldLiveNodes, newLiveNodes;\\n    \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (getUpdateLock()) {\\n      newLiveNodes = lastFetchedLiveNodes.getAndSet(\u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e);\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (newLiveNodes == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Someone \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e won the race to apply the last update, just exit.\\n\u003c\\/span\u003e        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e;\\n      }\\n\\n      oldLiveNodes = \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.liveNodes;\\n      \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.liveNodes = newLiveNodes;\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (clusterState != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        clusterState.setLiveNodes(newLiveNodes);\\n      }\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWhy can\'t  the \u003ctt\u003esynchronized (refreshLiveNodesLock)\u003c\\/tt\u003e block be applied on the entire method and make the code simpler and avoid the race condition altogether.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"noble.paul\\\" id=\\\"commentauthor_15218286_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"noble.paul\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Noble Paul\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218286_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T16:44:31+0000\'\u003e30\\/Mar\\/16 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    looked at the patch .The block  \\n\\n  \\n    synchronized  (refreshLiveNodesLock) {\\n      Set&lt; String &gt; newLiveNodes;\\n       try  {\\n        List&lt; String &gt; nodeList = zkClient.getChildren(LIVE_NODES_ZKNODE, watcher,  true );\\n        newLiveNodes =  new  HashSet&lt;&gt;(nodeList);\\n      }  catch  (KeeperException.NoNodeException e) {\\n        newLiveNodes = emptySet();\\n      }\\n      lastFetchedLiveNodes.set(newLiveNodes);\\n    }\\n\\n     \\/\\/ Can\'t lock getUpdateLock() until we release the other, it would cause deadlock.\\n     Set&lt; String &gt; oldLiveNodes, newLiveNodes;\\n     synchronized  (getUpdateLock()) {\\n      newLiveNodes = lastFetchedLiveNodes.getAndSet( null );\\n       if  (newLiveNodes ==  null ) {\\n         \\/\\/ Someone  else  won the race to apply the last update, just exit.\\n          return ;\\n      }\\n\\n      oldLiveNodes =  this .liveNodes;\\n       this .liveNodes = newLiveNodes;\\n       if  (clusterState !=  null ) {\\n        clusterState.setLiveNodes(newLiveNodes);\\n      }\\n    }\\n \\n  \\n\\n Why can\'t  the  synchronized (refreshLiveNodesLock)  block be applied on the entire method and make the code simpler and avoid the race condition altogether.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218306\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218306&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218306\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15218306_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218306_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 16:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T16:52:31+0000\'\u003e30\\/Mar\\/16 16:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eScott: i\'m hammering on your updated patch now, so far 60 runs w\\/o failure of deadlock (3 times as long as i\'ve ever seen it go w\\/o failure, 10 times longer then your previous patch went w\\/o deadlocks)\u003c\\/p\u003e\\n\\n\u003cp\u003eAs someone unfamiliar with most of the ZkStateReader code, some of the changes are clearly relevant as far as the current bug goes (the lastFetchedLiveNodes AtomicRef and associated refreshLiveNodesLock) but it\'s not immediately obvious to me what the other changes (refreshCollectionListLock etc..) in your patch are for .. are these unrelated to the live nodes bug? \u003c\\/p\u003e\\n\\n\u003cp\u003eIs this a similar bug pattern in watching the list of collections? (ie: two COLLECTIONS_ZKNODE, watchers may fire in rapid succession and updating the local collection states might happen out of order)\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15218306_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218306_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 16:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T16:52:31+0000\'\u003e30\\/Mar\\/16 16:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Scott: i\'m hammering on your updated patch now, so far 60 runs w\\/o failure of deadlock (3 times as long as i\'ve ever seen it go w\\/o failure, 10 times longer then your previous patch went w\\/o deadlocks) \\n\\n As someone unfamiliar with most of the ZkStateReader code, some of the changes are clearly relevant as far as the current bug goes (the lastFetchedLiveNodes AtomicRef and associated refreshLiveNodesLock) but it\'s not immediately obvious to me what the other changes (refreshCollectionListLock etc..) in your patch are for .. are these unrelated to the live nodes bug?  \\n\\n Is this a similar bug pattern in watching the list of collections? (ie: two COLLECTIONS_ZKNODE, watchers may fire in rapid succession and updating the local collection states might happen out of order) \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218423\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218423&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218423\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15218423_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218423_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T17:42:58+0000\'\u003e30\\/Mar\\/16 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m beasting your latest patch too, I\'ll report anything that comes up. Just to make sure, I should be beasting StressTestLiveNodes, right?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15218423_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218423_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T17:42:58+0000\'\u003e30\\/Mar\\/16 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m beasting your latest patch too, I\'ll report anything that comes up. Just to make sure, I should be beasting StressTestLiveNodes, right?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218497\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218497&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218497\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15218497_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218497_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 18:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T18:15:49+0000\'\u003e30\\/Mar\\/16 18:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ei\'ve updated the patch to cleanup the test a bit &#8211; besdies some cosmetic stuff it now does more iterations of smaller \\\"bursts\\\" with more variability in the number of threads used in each burst (which should increase the odds of it failing, eventually, on diff machines regardless of CPU count.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'m beasting your latest patch too, I\'ll report anything that comes up. Just to make sure, I should be beasting StressTestLiveNodes, right?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eTestStressLiveNodes, but otherwise yes.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would also be helpful to know if (and how quickly) you can get TestStressLiveNodes to fail on your machine when beasting w\\/o the rest of the patch (so far i\'m the only one that\'s been able to confirm the bug in practice w\\/o Scott\'s patch - hopefully these changes increase those odds)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15218497_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218497_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 18:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T18:15:49+0000\'\u003e30\\/Mar\\/16 18:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    i\'ve updated the patch to cleanup the test a bit &#8211; besdies some cosmetic stuff it now does more iterations of smaller \\\"bursts\\\" with more variability in the number of threads used in each burst (which should increase the odds of it failing, eventually, on diff machines regardless of CPU count. \\n\\n  I\'m beasting your latest patch too, I\'ll report anything that comes up. Just to make sure, I should be beasting StressTestLiveNodes, right?  \\n\\n TestStressLiveNodes, but otherwise yes. \\n\\n It would also be helpful to know if (and how quickly) you can get TestStressLiveNodes to fail on your machine when beasting w\\/o the rest of the patch (so far i\'m the only one that\'s been able to confirm the bug in practice w\\/o Scott\'s patch - hopefully these changes increase those odds)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218518\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218518&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218518\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15218518_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218518_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 18:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T18:23:24+0000\'\u003e30\\/Mar\\/16 18:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat was actually my first formulation, but that causes deadlock, see previous comments.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15218518_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218518_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 18:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T18:23:24+0000\'\u003e30\\/Mar\\/16 18:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That was actually my first formulation, but that causes deadlock, see previous comments.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218529\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218529&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218529\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15218529_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218529_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 18:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T18:28:24+0000\'\u003e30\\/Mar\\/16 18:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCorrect, the refreshCollectionListLock solves the same class of bug for the collections list as we needed to solve for live_nodes.  However, the implementation is simpler since we don\'t need to hold getUpdateLock() and therefore there\'s no deadlock potential.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe code to check this.legacyClusterStateVersion &gt;= stat.getVersion() solves that class of bug for clusterstate.json; we already have version guarding code for stateformat 2 collections, it was an oversight not to have it for this also.\u003c\\/p\u003e\\n\\n\u003cp\u003eNet-net: my intent (hope?) is this patch should fix this category of race condition for all the major pieces of ZkStateReader.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15218529_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218529_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 18:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T18:28:24+0000\'\u003e30\\/Mar\\/16 18:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Correct, the refreshCollectionListLock solves the same class of bug for the collections list as we needed to solve for live_nodes.  However, the implementation is simpler since we don\'t need to hold getUpdateLock() and therefore there\'s no deadlock potential. \\n\\n The code to check this.legacyClusterStateVersion &gt;= stat.getVersion() solves that class of bug for clusterstate.json; we already have version guarding code for stateformat 2 collections, it was an oversight not to have it for this also. \\n\\n Net-net: my intent (hope?) is this patch should fix this category of race condition for all the major pieces of ZkStateReader.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218692\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218692&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218692\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_15218692_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218692_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 19:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T19:47:20+0000\'\u003e30\\/Mar\\/16 19:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTestStressLiveNodes w\\/o the rest of the patch failed 84\\/100 iterations on my server.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_15218692_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218692_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 19:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T19:47:20+0000\'\u003e30\\/Mar\\/16 19:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    TestStressLiveNodes w\\/o the rest of the patch failed 84\\/100 iterations on my server.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15218949\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15218949&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15218949\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_15218949_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218949_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 21:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T21:55:56+0000\'\u003e30\\/Mar\\/16 21:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWith the full patch 0\\/100 iterations failed.  I\'ll beast another 100 iterations.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_15218949_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15218949_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/16 21:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-30T21:55:56+0000\'\u003e30\\/Mar\\/16 21:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    With the full patch 0\\/100 iterations failed.  I\'ll beast another 100 iterations.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15219119\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15219119&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15219119\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15219119_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15219119_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 00:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T00:29:00+0000\'\u003e31\\/Mar\\/16 00:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI had 4\\/100 iterations fail. Let me try it all again to insure that I applied the right patch, saved the file and all that etc.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15219119_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15219119_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 00:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T00:29:00+0000\'\u003e31\\/Mar\\/16 00:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I had 4\\/100 iterations fail. Let me try it all again to insure that I applied the right patch, saved the file and all that etc.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15219154\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15219154&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15219154\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15219154_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15219154_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 01:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T01:12:08+0000\'\u003e31\\/Mar\\/16 01:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNope, completely re-did the test and got another failure on run 31. Here are the failure snippets\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e FAILURE 94.1s | TestStressLiveNodes.testStress &lt;&lt;&lt;\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; Throwable #1: java.lang.AssertionError: iter1263: \u003cspan class=\\\"error\\\"\u003e&#91;127.0.0.1:53372_solr, thrasher-T1262_0-0&#93;\u003c\\/span\u003e expected:&lt;1&gt; but was:&lt;2&gt;\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat __randomizedtesting.SeedInfo.seed(\u003cspan class=\\\"error\\\"\u003e&#91;3E42073F9773C752:2B597AFE14843F29&#93;\u003c\\/span\u003e:0)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.testStress(TestStressLiveNodes.java:137)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat java.lang.Thread.run(Thread.java:745)\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e   ***********************\u003c\\/p\u003e\\n\\n\u003cp\u003e      \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e FAILURE 75.7s | TestStressLiveNodes.testStress &lt;&lt;&lt;\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; Throwable #1: java.lang.AssertionError: iter2373 6 != 1 expected:&lt;\u003cspan class=\\\"error\\\"\u003e&#91;127.0.0.1:61240_solr, thrasher-T2373_0-0, thrasher-T2373_1-0, thrasher-T2373_2-0, thrasher-T2373_3-0, thrasher-T2373_4-0&#93;\u003c\\/span\u003e&gt; but was:&lt;\u003cspan class=\\\"error\\\"\u003e&#91;127.0.0.1:61240_solr&#93;\u003c\\/span\u003e&gt;\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat __randomizedtesting.SeedInfo.seed(\u003cspan class=\\\"error\\\"\u003e&#91;20645E3B72A746D3:357F23FAF150BEA8&#93;\u003c\\/span\u003e:0)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.testStress(TestStressLiveNodes.java:200)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat java.lang.Thread.run(Thread.java:745)\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e**************************\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e   2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestStressLiveNodes -Dtests.method=testStress -Dtests.seed=E803236A2774DE4C -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=sr-RS -Dtests.timezone=Pacific\\/Majuro -Dtests.asserts=true -Dtests.file.encoding=UTF-8\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e ERROR   62.7s | TestStressLiveNodes.testStress &lt;&lt;&lt;\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; Throwable #1: org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:62845\\/solr within 30000 ms\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat __randomizedtesting.SeedInfo.seed(\u003cspan class=\\\"error\\\"\u003e&#91;E803236A2774DE4C:FD185EABA4832637&#93;\u003c\\/span\u003e:0)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:181)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:115)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:110)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:97)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.newSolrZkClient(TestStressLiveNodes.java:87)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.access$000(TestStressLiveNodes.java:54)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes$LiveNodeTrasher.&lt;init&gt;(TestStressLiveNodes.java:225)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.testStress(TestStressLiveNodes.java:174)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat java.lang.Thread.run(Thread.java:745)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; Caused by: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:62845\\/solr within 30000 ms\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.ConnectionManager.waitForConnected(ConnectionManager.java:228)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:173)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\t... 46 more\u003cbr\\/\u003e\\n   [ju\u003c\\/p\u003e\\n\\n\u003cp\u003e   ***********************************\u003c\\/p\u003e\\n\\n\u003cp\u003e   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e   2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestStressLiveNodes -Dtests.method=testStress -Dtests.seed=6B315674F529C1E2 -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=ar-IQ -Dtests.timezone=Europe\\/Bratislava -Dtests.asserts=true -Dtests.file.encoding=UTF-8\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e ERROR    113s | TestStressLiveNodes.testStress &lt;&lt;&lt;\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; Throwable #1: org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:62849\\/solr within 30000 ms\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat __randomizedtesting.SeedInfo.seed(\u003cspan class=\\\"error\\\"\u003e&#91;6B315674F529C1E2:7E2A2BB576DE3999&#93;\u003c\\/span\u003e:0)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:181)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:115)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:110)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:97)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.newSolrZkClient(TestStressLiveNodes.java:87)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.access$000(TestStressLiveNodes.java:54)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes$LiveNodeTrasher.&lt;init&gt;(TestStressLiveNodes.java:225)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.testStress(TestStressLiveNodes.java:174)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat java.lang.Thread.run(Thread.java:745)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; Caused by: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:62849\\/solr within 30000 ms\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.ConnectionManager.waitForConnected(ConnectionManager.java:228)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:173)\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e    &gt; \\t... 46 more\u003cbr\\/\u003e\\n   \u003cspan class=\\\"error\\\"\u003e&#91;junit4&#93;\u003c\\/span\u003e   2&gt; 116534 INFO  (jetty-launcher-1-thread-2) [    ] o.e.j.s.ServerConnector Stopped ServerConnector@5aa5196c\u003c\\/p\u003e\\n{HTTP\\/1.1,[http\\/1.1]}\\n{127.0.0.1:0}\\n\u003cp\u003e   [juni\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15219154_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15219154_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 01:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T01:12:08+0000\'\u003e31\\/Mar\\/16 01:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Nope, completely re-did the test and got another failure on run 31. Here are the failure snippets \\n\\n  &#91;junit4&#93;  FAILURE 94.1s | TestStressLiveNodes.testStress &lt;&lt;&lt; \\n    &#91;junit4&#93;     &gt; Throwable #1: java.lang.AssertionError: iter1263:  &#91;127.0.0.1:53372_solr, thrasher-T1262_0-0&#93;  expected:&lt;1&gt; but was:&lt;2&gt; \\n    &#91;junit4&#93;     &gt; \\tat __randomizedtesting.SeedInfo.seed( &#91;3E42073F9773C752:2B597AFE14843F29&#93; :0) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.testStress(TestStressLiveNodes.java:137) \\n    &#91;junit4&#93;     &gt; \\tat java.lang.Thread.run(Thread.java:745) \\n\\n\\n    *********************** \\n\\n        &#91;junit4&#93;  FAILURE 75.7s | TestStressLiveNodes.testStress &lt;&lt;&lt; \\n    &#91;junit4&#93;     &gt; Throwable #1: java.lang.AssertionError: iter2373 6 != 1 expected:&lt; &#91;127.0.0.1:61240_solr, thrasher-T2373_0-0, thrasher-T2373_1-0, thrasher-T2373_2-0, thrasher-T2373_3-0, thrasher-T2373_4-0&#93; &gt; but was:&lt; &#91;127.0.0.1:61240_solr&#93; &gt; \\n    &#91;junit4&#93;     &gt; \\tat __randomizedtesting.SeedInfo.seed( &#91;20645E3B72A746D3:357F23FAF150BEA8&#93; :0) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.testStress(TestStressLiveNodes.java:200) \\n    &#91;junit4&#93;     &gt; \\tat java.lang.Thread.run(Thread.java:745) \\n\\n\\n ************************** \\n\\n\\n     &#91;junit4&#93;    2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestStressLiveNodes -Dtests.method=testStress -Dtests.seed=E803236A2774DE4C -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=sr-RS -Dtests.timezone=Pacific\\/Majuro -Dtests.asserts=true -Dtests.file.encoding=UTF-8 \\n    &#91;junit4&#93;  ERROR   62.7s | TestStressLiveNodes.testStress &lt;&lt;&lt; \\n    &#91;junit4&#93;     &gt; Throwable #1: org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:62845\\/solr within 30000 ms \\n    &#91;junit4&#93;     &gt; \\tat __randomizedtesting.SeedInfo.seed( &#91;E803236A2774DE4C:FD185EABA4832637&#93; :0) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:181) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:115) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:110) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:97) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.newSolrZkClient(TestStressLiveNodes.java:87) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.access$000(TestStressLiveNodes.java:54) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes$LiveNodeTrasher.&lt;init&gt;(TestStressLiveNodes.java:225) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.testStress(TestStressLiveNodes.java:174) \\n    &#91;junit4&#93;     &gt; \\tat java.lang.Thread.run(Thread.java:745) \\n    &#91;junit4&#93;     &gt; Caused by: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:62845\\/solr within 30000 ms \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.ConnectionManager.waitForConnected(ConnectionManager.java:228) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:173) \\n    &#91;junit4&#93;     &gt; \\t... 46 more \\n   [ju \\n\\n    *********************************** \\n\\n     &#91;junit4&#93;    2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestStressLiveNodes -Dtests.method=testStress -Dtests.seed=6B315674F529C1E2 -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=ar-IQ -Dtests.timezone=Europe\\/Bratislava -Dtests.asserts=true -Dtests.file.encoding=UTF-8 \\n    &#91;junit4&#93;  ERROR    113s | TestStressLiveNodes.testStress &lt;&lt;&lt; \\n    &#91;junit4&#93;     &gt; Throwable #1: org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:62849\\/solr within 30000 ms \\n    &#91;junit4&#93;     &gt; \\tat __randomizedtesting.SeedInfo.seed( &#91;6B315674F529C1E2:7E2A2BB576DE3999&#93; :0) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:181) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:115) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:110) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:97) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.newSolrZkClient(TestStressLiveNodes.java:87) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.access$000(TestStressLiveNodes.java:54) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes$LiveNodeTrasher.&lt;init&gt;(TestStressLiveNodes.java:225) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.cloud.TestStressLiveNodes.testStress(TestStressLiveNodes.java:174) \\n    &#91;junit4&#93;     &gt; \\tat java.lang.Thread.run(Thread.java:745) \\n    &#91;junit4&#93;     &gt; Caused by: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:62849\\/solr within 30000 ms \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.ConnectionManager.waitForConnected(ConnectionManager.java:228) \\n    &#91;junit4&#93;     &gt; \\tat org.apache.solr.common.cloud.SolrZkClient.&lt;init&gt;(SolrZkClient.java:173) \\n    &#91;junit4&#93;     &gt; \\t... 46 more \\n    &#91;junit4&#93;    2&gt; 116534 INFO  (jetty-launcher-1-thread-2) [    ] o.e.j.s.ServerConnector Stopped ServerConnector@5aa5196c \\n{HTTP\\/1.1,[http\\/1.1]}\\n{127.0.0.1:0}\\n    [juni              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15219286\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15219286&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15219286\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_15219286_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15219286_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 03:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T03:53:22+0000\'\u003e31\\/Mar\\/16 03:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eZero failures on second 100 iterations.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_15219286_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15219286_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 03:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T03:53:22+0000\'\u003e31\\/Mar\\/16 03:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Zero failures on second 100 iterations.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15220288\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15220288&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15220288\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15220288_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15220288_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 17:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T17:37:48+0000\'\u003e31\\/Mar\\/16 17:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust chatting with Steve and there\'s a bit of confusion here. The mini-traces I pasted above are \u003cem\u003ewith\u003c\\/em\u003e the latest patch AFAIK, \u003cem\u003enot\u003c\\/em\u003e with the fixes reverted.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe\'re trying to figure out why my results are different.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15220288_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15220288_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 17:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T17:37:48+0000\'\u003e31\\/Mar\\/16 17:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just chatting with Steve and there\'s a bit of confusion here. The mini-traces I pasted above are  with  the latest patch AFAIK,  not  with the fixes reverted. \\n\\n We\'re trying to figure out why my results are different.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15220429\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15220429&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15220429\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15220429_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15220429_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 18:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T18:42:51+0000\'\u003e31\\/Mar\\/16 18:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eErick, if all the errors you\'re seeing are related to Zookeeper errors, then I\'m not sure you\'re actually running into any of the issues we fixed.  ZkStateReader is meant to be fault tolerant with respect to ZK connectivity, but there\'s no reason to the think that the particular test expectations in TestStressLiveNodes would always hold true in the face of ZK connectivity loss; I would expect that TestStressLiveNodes assumes that the ZkStateReader -&gt; ZK connection is always up.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you\'re seeing a either a deadlock problem, or a data problem in the absence of any ZK errors, then that would be a problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15220429_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15220429_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/16 18:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-31T18:42:51+0000\'\u003e31\\/Mar\\/16 18:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Erick, if all the errors you\'re seeing are related to Zookeeper errors, then I\'m not sure you\'re actually running into any of the issues we fixed.  ZkStateReader is meant to be fault tolerant with respect to ZK connectivity, but there\'s no reason to the think that the particular test expectations in TestStressLiveNodes would always hold true in the face of ZK connectivity loss; I would expect that TestStressLiveNodes assumes that the ZkStateReader -&gt; ZK connection is always up. \\n\\n If you\'re seeing a either a deadlock problem, or a data problem in the absence of any ZK errors, then that would be a problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15222382\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15222382&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15222382\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15222382_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15222382_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/16 21:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-01T21:43:17+0000\'\u003e01\\/Apr\\/16 21:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat\'s the next step here?  I really think, despite the minority report, that this patch should be a drastic improvement on the current situation, and fix a real production bug.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15222382_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15222382_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/16 21:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-01T21:43:17+0000\'\u003e01\\/Apr\\/16 21:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What\'s the next step here?  I really think, despite the minority report, that this patch should be a drastic improvement on the current situation, and fix a real production bug.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15222384\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15222384&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15222384\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15222384_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15222384_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/16 21:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-01T21:43:54+0000\'\u003e01\\/Apr\\/16 21:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMaybe \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\" class=\\\"user-hover\\\" rel=\\\"shalinmangar\\\"\u003eShalin Shekhar Mangar\u003c\\/a\u003e or \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=noble.paul\\\" class=\\\"user-hover\\\" rel=\\\"noble.paul\\\"\u003eNoble Paul\u003c\\/a\u003e would be willing to review\\/commit?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15222384_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15222384_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/16 21:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-01T21:43:54+0000\'\u003e01\\/Apr\\/16 21:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Maybe  Shalin Shekhar Mangar  or  Noble Paul  would be willing to review\\/commit?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15224511\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15224511&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15224511\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15224511_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15224511_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Apr\\/16 16:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-04T16:58:55+0000\'\u003e04\\/Apr\\/16 16:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll take a look this week if no one beats me to it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15224511_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15224511_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Apr\\/16 16:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-04T16:58:55+0000\'\u003e04\\/Apr\\/16 16:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll take a look this week if no one beats me to it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15224542\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15224542&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15224542\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15224542_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15224542_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Apr\\/16 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-04T17:15:59+0000\'\u003e04\\/Apr\\/16 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\" class=\\\"user-hover\\\" rel=\\\"dragonsinth\\\"\u003eScott Blum\u003c\\/a\u003e OK, aside from some connectivity issues, the only thing I see that \u003cem\u003emay\u003c\\/em\u003e be important is two cases that fail on TestStressLiveNodex\u003cspan class=\\\"error\\\"\u003e&#91;200&#93;\u003c\\/span\u003e, these lines:\u003cbr\\/\u003e\\n        \\/\\/ verify our local client knows the correct set of live nodes\u003cbr\\/\u003e\\n        cachedLiveNodes = getCachedLiveNodesFromLocalState(actualLiveNodes.size());\u003cbr\\/\u003e\\n        assertEquals(\\\"iter\\\"\u003cins\u003eiter\u003c\\/ins\u003e\\\" \\\" + actualLiveNodes.size() + \\\" != \\\" + cachedLiveNodes.size(),\u003cbr\\/\u003e\\n                     actualLiveNodes, cachedLiveNodes);\u003c\\/p\u003e\\n\\n\u003cp\u003e16 != 1 on one test (seeds below) and 13 != 1.\u003c\\/p\u003e\\n\\n\u003cp\u003eI tried the first one and it doesn\'t reliably fail, so I\'m not quite sure what to do next or if this test failure is even important to this JIRA, and I really can\'t pursue it more ATM.\u003c\\/p\u003e\\n\\n\u003cp\u003eant test  -Dtestcase=TestStressLiveNodes -Dtests.method=testStress -Dtests.seed=AAD31DA7247CE323 -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=ar-AE -Dtests.timezone=America\\/Santo_Domingo -Dtests.asserts=true -Dtests.file.encoding=UTF-8\u003c\\/p\u003e\\n\\n\u003cp\u003eant test  -Dtestcase=TestStressLiveNodes -Dtests.method=testStress -Dtests.seed=B4786108141B49BD -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=sr-Latn-BA -Dtests.timezone=Europe\\/Budapest -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_15224542_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15224542_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Apr\\/16 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-04T17:15:59+0000\'\u003e04\\/Apr\\/16 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Scott Blum  OK, aside from some connectivity issues, the only thing I see that  may  be important is two cases that fail on TestStressLiveNodex &#91;200&#93; , these lines: \\n        \\/\\/ verify our local client knows the correct set of live nodes \\n        cachedLiveNodes = getCachedLiveNodesFromLocalState(actualLiveNodes.size()); \\n        assertEquals(\\\"iter\\\" iter \\\" \\\" + actualLiveNodes.size() + \\\" != \\\" + cachedLiveNodes.size(), \\n                     actualLiveNodes, cachedLiveNodes); \\n\\n 16 != 1 on one test (seeds below) and 13 != 1. \\n\\n I tried the first one and it doesn\'t reliably fail, so I\'m not quite sure what to do next or if this test failure is even important to this JIRA, and I really can\'t pursue it more ATM. \\n\\n ant test  -Dtestcase=TestStressLiveNodes -Dtests.method=testStress -Dtests.seed=AAD31DA7247CE323 -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=ar-AE -Dtests.timezone=America\\/Santo_Domingo -Dtests.asserts=true -Dtests.file.encoding=UTF-8 \\n\\n ant test  -Dtestcase=TestStressLiveNodes -Dtests.method=testStress -Dtests.seed=B4786108141B49BD -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=sr-Latn-BA -Dtests.timezone=Europe\\/Budapest -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15235573\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15235573&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15235573\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15235573_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15235573_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Apr\\/16 17:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-11T17:44:04+0000\'\u003e11\\/Apr\\/16 17:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Erick!  I\'ll give this a shot myself.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m going to venture to say, however, that we should move forward on committing this patch.  Whether or not there are any lingering race conditions that could manifest in rare cases, the patch for sure fixes some race conditions that we can both see from inspection and reproduce with a lot of reliability.  So I think this patch makes things much better regardless of whether we\'ve ironed out every last race condition.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15235573_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15235573_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Apr\\/16 17:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-11T17:44:04+0000\'\u003e11\\/Apr\\/16 17:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Erick!  I\'ll give this a shot myself. \\n\\n I\'m going to venture to say, however, that we should move forward on committing this patch.  Whether or not there are any lingering race conditions that could manifest in rare cases, the patch for sure fixes some race conditions that we can both see from inspection and reproduce with a lot of reliability.  So I think this patch makes things much better regardless of whether we\'ve ironed out every last race condition.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15235604\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15235604&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15235604\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15235604_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15235604_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Apr\\/16 17:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-11T17:58:21+0000\'\u003e11\\/Apr\\/16 17:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFWIW these both passed for me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15235604_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15235604_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Apr\\/16 17:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-11T17:58:21+0000\'\u003e11\\/Apr\\/16 17:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    FWIW these both passed for me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15239231\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15239231&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15239231\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15239231_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239231_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 13:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T13:31:35+0000\'\u003e13\\/Apr\\/16 13:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll take it. I set my test beasting script on it, and it comes out solid for me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15239231_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239231_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 13:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T13:31:35+0000\'\u003e13\\/Apr\\/16 13:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll take it. I set my test beasting script on it, and it comes out solid for me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15239245\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15239245&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15239245\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15239245_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239245_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 13:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T13:39:08+0000\'\u003e13\\/Apr\\/16 13:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOkay, I\'ve been beasting it since morning. No fails yet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15239245_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239245_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 13:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T13:39:08+0000\'\u003e13\\/Apr\\/16 13:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Okay, I\'ve been beasting it since morning. No fails yet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15239276\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15239276&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15239276\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15239276_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239276_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 13:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T13:55:11+0000\'\u003e13\\/Apr\\/16 13:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 744b419b42a5797700c0a3a5f859d86ae9d05325 in lucene-solr\'s branch refs\\/heads\\/master from markrmiller\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=744b419\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=744b419\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-8914\\\" title=\\\"ZkStateReader&#39;s refreshLiveNodes(Watcher) is not thread safe\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-8914\\\"\u003e\u003cdel\u003eSOLR-8914\u003c\\/del\u003e\u003c\\/a\u003e: ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15239276_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239276_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 13:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T13:55:11+0000\'\u003e13\\/Apr\\/16 13:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 744b419b42a5797700c0a3a5f859d86ae9d05325 in lucene-solr\'s branch refs\\/heads\\/master from markrmiller \\n[  https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=744b419  ] \\n\\n   SOLR-8914  : ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15239328\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15239328&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15239328\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15239328_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239328_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T14:24:37+0000\'\u003e13\\/Apr\\/16 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit fe858858686ba7e2738367bf4b7ef8c621987df9 in lucene-solr\'s branch refs\\/heads\\/branch_6x from markrmiller\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=fe85885\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=fe85885\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-8914\\\" title=\\\"ZkStateReader&#39;s refreshLiveNodes(Watcher) is not thread safe\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-8914\\\"\u003e\u003cdel\u003eSOLR-8914\u003c\\/del\u003e\u003c\\/a\u003e: ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15239328_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239328_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T14:24:37+0000\'\u003e13\\/Apr\\/16 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit fe858858686ba7e2738367bf4b7ef8c621987df9 in lucene-solr\'s branch refs\\/heads\\/branch_6x from markrmiller \\n[  https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=fe85885  ] \\n\\n   SOLR-8914  : ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15239957\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15239957&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15239957\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15239957_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239957_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T20:19:06+0000\'\u003e13\\/Apr\\/16 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYay!  Thanks guys!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15239957_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15239957_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/16 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-13T20:19:06+0000\'\u003e13\\/Apr\\/16 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yay!  Thanks guys!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15248103\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15248103&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15248103\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15248103_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15248103_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/16 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-19T16:28:47+0000\'\u003e19\\/Apr\\/16 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e - is this resolved?\u003c\\/p\u003e\\n\\n\u003cp\u003eis it targeting 6.1 only, or are you thinking it\'s safe\\/good to backport for 6.0.1 and or 5.5.1 ?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15248103_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15248103_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/16 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-19T16:28:47+0000\'\u003e19\\/Apr\\/16 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Mark Miller  - is this resolved? \\n\\n is it targeting 6.1 only, or are you thinking it\'s safe\\/good to backport for 6.0.1 and or 5.5.1 ?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15248325\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15248325&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15248325\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15248325_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15248325_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/16 18:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-19T18:08:27+0000\'\u003e19\\/Apr\\/16 18:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think it\'s definitely work backporting, and I\'m happy to do it.  I already backported it to our own 5.4.1 fork; the live code merges pretty clean but I had to do a little work on the test code as some test infra has changed.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e Should I just do the backports and push commits?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15248325_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15248325_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/16 18:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-19T18:08:27+0000\'\u003e19\\/Apr\\/16 18:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think it\'s definitely work backporting, and I\'m happy to do it.  I already backported it to our own 5.4.1 fork; the live code merges pretty clean but I had to do a little work on the test code as some test infra has changed. \\n\\n  Mark Miller  Should I just do the backports and push commits?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15249004\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15249004&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15249004\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15249004_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15249004_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 00:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T00:15:28+0000\'\u003e20\\/Apr\\/16 00:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=anshumg\\\" class=\\\"user-hover\\\" rel=\\\"anshumg\\\"\u003eAnshum Gupta\u003c\\/a\u003e I think we should backport this to 5.5.1.  Happy to push a commit (i\'ve already done the work locally to backport the test code.)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dragonsinth\\\" id=\\\"commentauthor_15249004_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dragonsinth\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Scott Blum\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15249004_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 00:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T00:15:28+0000\'\u003e20\\/Apr\\/16 00:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Anshum Gupta  I think we should backport this to 5.5.1.  Happy to push a commit (i\'ve already done the work locally to backport the test code.)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15249021\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15249021&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15249021\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"anshumg\\\" id=\\\"commentauthor_15249021_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=anshumg\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"anshumg\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Anshum Gupta\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15249021_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 00:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T00:23:24+0000\'\u003e20\\/Apr\\/16 00:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e+1 for back porting this and thanks for volunteering \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"anshumg\\\" id=\\\"commentauthor_15249021_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=anshumg\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"anshumg\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Anshum Gupta\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15249021_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 00:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T00:23:24+0000\'\u003e20\\/Apr\\/16 00:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    +1 for back porting this and thanks for volunteering                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15250879\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15250879&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15250879\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15250879_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15250879_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 22:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T22:46:44+0000\'\u003e20\\/Apr\\/16 22:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit b93cb2714b7a2ea43ae200d31cc5b04a0b0ecc7c in lucene-solr\'s branch refs\\/heads\\/\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-8914\\\" title=\\\"ZkStateReader&#39;s refreshLiveNodes(Watcher) is not thread safe\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-8914\\\"\u003e\u003cdel\u003eSOLR-8914\u003c\\/del\u003e\u003c\\/a\u003e-6_0 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\" class=\\\"user-hover\\\" rel=\\\"dragonsinth\\\"\u003eScott Blum\u003c\\/a\u003e\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=b93cb27\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=b93cb27\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-8914\\\" title=\\\"ZkStateReader&#39;s refreshLiveNodes(Watcher) is not thread safe\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-8914\\\"\u003e\u003cdel\u003eSOLR-8914\u003c\\/del\u003e\u003c\\/a\u003e: ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15250879_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15250879_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 22:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T22:46:44+0000\'\u003e20\\/Apr\\/16 22:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit b93cb2714b7a2ea43ae200d31cc5b04a0b0ecc7c in lucene-solr\'s branch refs\\/heads\\/  SOLR-8914  -6_0 from  Scott Blum  \\n[  https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=b93cb27  ] \\n\\n   SOLR-8914  : ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15250882\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15250882&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15250882\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15250882_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15250882_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 22:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T22:47:10+0000\'\u003e20\\/Apr\\/16 22:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit b93cb2714b7a2ea43ae200d31cc5b04a0b0ecc7c in lucene-solr\'s branch refs\\/heads\\/branch_6_0 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=dragonsinth\\\" class=\\\"user-hover\\\" rel=\\\"dragonsinth\\\"\u003eScott Blum\u003c\\/a\u003e\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=b93cb27\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=b93cb27\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-8914\\\" title=\\\"ZkStateReader&#39;s refreshLiveNodes(Watcher) is not thread safe\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-8914\\\"\u003e\u003cdel\u003eSOLR-8914\u003c\\/del\u003e\u003c\\/a\u003e: ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15250882_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15250882_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 22:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T22:47:10+0000\'\u003e20\\/Apr\\/16 22:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit b93cb2714b7a2ea43ae200d31cc5b04a0b0ecc7c in lucene-solr\'s branch refs\\/heads\\/branch_6_0 from  Scott Blum  \\n[  https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=b93cb27  ] \\n\\n   SOLR-8914  : ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15250886\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15250886&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15250886\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15250886_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15250886_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T22:48:37+0000\'\u003e20\\/Apr\\/16 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 58f77fed2c45b8ce7da1831954f941dde39d98f9 in lucene-solr\'s branch refs\\/heads\\/branch_5x from markrmiller\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=58f77fe\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=58f77fe\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-8914\\\" title=\\\"ZkStateReader&#39;s refreshLiveNodes(Watcher) is not thread safe\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-8914\\\"\u003e\u003cdel\u003eSOLR-8914\u003c\\/del\u003e\u003c\\/a\u003e: ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15250886_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15250886_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T22:48:37+0000\'\u003e20\\/Apr\\/16 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 58f77fed2c45b8ce7da1831954f941dde39d98f9 in lucene-solr\'s branch refs\\/heads\\/branch_5x from markrmiller \\n[  https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=58f77fe  ] \\n\\n   SOLR-8914  : ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15250912\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15250912&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15250912\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15250912_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15250912_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 23:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T23:13:42+0000\'\u003e20\\/Apr\\/16 23:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit f45fae5c81e68763c99826524bec8b9273dfefd4 in lucene-solr\'s branch refs\\/heads\\/branch_5_5 from markrmiller\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=f45fae5\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=f45fae5\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-8914\\\" title=\\\"ZkStateReader&#39;s refreshLiveNodes(Watcher) is not thread safe\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-8914\\\"\u003e\u003cdel\u003eSOLR-8914\u003c\\/del\u003e\u003c\\/a\u003e: ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_15250912_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15250912_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/16 23:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-04-20T23:13:42+0000\'\u003e20\\/Apr\\/16 23:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit f45fae5c81e68763c99826524bec8b9273dfefd4 in lucene-solr\'s branch refs\\/heads\\/branch_5_5 from markrmiller \\n[  https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=f45fae5  ] \\n\\n   SOLR-8914  : ZkStateReader\'s refreshLiveNodes(Watcher) is not thread safe.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15277242\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15277242&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15277242\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15277242_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15277242_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/May\\/16 22:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-05-09T22:54:01+0000\'\u003e09\\/May\\/16 22:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eManually correcting fixVersion per Step #S5 of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-7271\\\" title=\\\"Cleanup jira&#39;s concept of &#39;master&#39; and &#39;6.0&#39;\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-7271\\\"\u003e\u003cdel\u003eLUCENE-7271\u003c\\/del\u003e\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_15277242_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15277242_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/May\\/16 22:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-05-09T22:54:01+0000\'\u003e09\\/May\\/16 22:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Manually correcting fixVersion per Step #S5 of   LUCENE-7271                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15305356\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-8914?focusedCommentId=15305356&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15305356\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_15305356_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15305356_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/16 13:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-05-28T13:38:22+0000\'\u003e28\\/May\\/16 13:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBulk close issues included in the 6.0.1 release.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_15305356_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15305356_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/16 13:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-05-28T13:38:22+0000\'\u003e28\\/May\\/16 13:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Bulk close issues included in the 6.0.1 release.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310230";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310230&amp;avatarId=22151\\\" alt=\\\"Solr\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\"\u003eSolr\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520342112388"> 
    <input type="hidden" title="jira.request.server.time" value="271"> 
    <input type="hidden" title="jira.request.id" value="795x97504633x4"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="38"> 
    <input type="hidden" title="db.conns.time.in.ms" value="45"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 795x97504633x4
	          REQUEST TIMESTAMP : [06/Mar/2018:13:15:12 +0000]
	               REQUEST TIME : 0.2710
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=21, elapsedTotal=38619805, elapsedMin=586649, elapsedMax=18966283, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=25, elapsedTotal=45830316, elapsedMin=602089, elapsedMax=18995320, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>