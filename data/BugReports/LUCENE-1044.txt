<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|c1d2a558a0144ea3426de9023c559b12e2fbed15|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"2a0681e7ed1a45\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-1044"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-1044] Behavior on hard power shutdown - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-1044] Behavior on hard power shutdown - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-1044">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-1044" href="/jira/browse/LUCENE-1044" id="key-val" rel="12381729">LUCENE-1044</a></li>
                </ol>
                <h1 id="summary-val">Behavior on hard power shutdown</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-1044"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-1044/LUCENE-1044.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-1044/LUCENE-1044.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-1044/LUCENE-1044.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-1044/LUCENE-1044.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+2.4" title="2.4 ">2.4</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12381729-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value"> 
                    <p>Windows Server 2003, Standard Edition, Sun Hotspot Java 1.5</p> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>When indexing a large number of documents, upon a hard power failure (e.g. pull the power cord), the index seems to get corrupted. We start a Java application as an Windows Service, and feed it documents. In some cases (after an index size of 1.7GB, with 30-40 index segment .cfs files) , the following is observed.</p> 
                  <p>The 'segments' file contains only zeros. Its size is 265 bytes - all bytes are zeros.<br> The 'deleted' file also contains only zeros. Its size is 85 bytes - all bytes are zeros.</p> 
                  <p>Before corruption, the segments file and deleted file appear to be correct. After this corruption, the index is corrupted and lost.</p> 
                  <p>This is a problem observed in Lucene 1.4.3. We are not able to upgrade our customer deployments to 1.9 or later version, but would be happy to back-port a patch, if the patch is small enough and if this problem is already solved.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-1044?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-1044?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-1044?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-1044?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12370069" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12370069/FSyncPerfTest.java" draggable="true" data-downloadurl="text/plain:FSyncPerfTest.java:https://issues.apache.org/jira/secure/attachment/12370069/FSyncPerfTest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12370069/FSyncPerfTest.java" title="Latest  22/Nov/07 14:16 - Doron Cohen" draggable="true" data-downloadurl="text/plain:FSyncPerfTest.java:https://issues.apache.org/jira/secure/attachment/12370069/FSyncPerfTest.java">FSyncPerfTest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-22T14:16:10.591Z">22/Nov/07 14:16</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Doron Cohen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12368942" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12368942/LUCENE-1044.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1044.patch:https://issues.apache.org/jira/secure/attachment/12368942/LUCENE-1044.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12368942/LUCENE-1044.patch" title="Latest  04/Nov/07 15:28 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-1044.patch:https://issues.apache.org/jira/secure/attachment/12368942/LUCENE-1044.patch">LUCENE-1044.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-04T15:28:33.196Z">04/Nov/07 15:28</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12368948" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12368948/LUCENE-1044.take2.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take2.patch:https://issues.apache.org/jira/secure/attachment/12368948/LUCENE-1044.take2.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12368948/LUCENE-1044.take2.patch" title="Latest  04/Nov/07 18:29 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take2.patch:https://issues.apache.org/jira/secure/attachment/12368948/LUCENE-1044.take2.patch">LUCENE-1044.take2.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-04T18:29:22.260Z">04/Nov/07 18:29</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12369061" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12369061/LUCENE-1044.take3.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take3.patch:https://issues.apache.org/jira/secure/attachment/12369061/LUCENE-1044.take3.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12369061/LUCENE-1044.take3.patch" title="Latest  06/Nov/07 22:38 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take3.patch:https://issues.apache.org/jira/secure/attachment/12369061/LUCENE-1044.take3.patch">LUCENE-1044.take3.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-06T22:38:47.450Z">06/Nov/07 22:38</time>
                   </dd>
                   <dd class="attachment-size">
                    16 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12370344" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12370344/LUCENE-1044.take4.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take4.patch:https://issues.apache.org/jira/secure/attachment/12370344/LUCENE-1044.take4.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12370344/LUCENE-1044.take4.patch" title="Latest  27/Nov/07 20:14 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take4.patch:https://issues.apache.org/jira/secure/attachment/12370344/LUCENE-1044.take4.patch">LUCENE-1044.take4.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-11-27T20:14:17.457Z">27/Nov/07 20:14</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12371455" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12371455/LUCENE-1044.take5.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take5.patch:https://issues.apache.org/jira/secure/attachment/12371455/LUCENE-1044.take5.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12371455/LUCENE-1044.take5.patch" title="Latest  11/Dec/07 20:20 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take5.patch:https://issues.apache.org/jira/secure/attachment/12371455/LUCENE-1044.take5.patch">LUCENE-1044.take5.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-12-11T20:20:57.375Z">11/Dec/07 20:20</time>
                   </dd>
                   <dd class="attachment-size">
                    86 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12374759" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12374759/LUCENE-1044.take6.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take6.patch:https://issues.apache.org/jira/secure/attachment/12374759/LUCENE-1044.take6.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12374759/LUCENE-1044.take6.patch" title="Latest  05/Feb/08 10:52 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take6.patch:https://issues.apache.org/jira/secure/attachment/12374759/LUCENE-1044.take6.patch">LUCENE-1044.take6.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-05T10:52:56.921Z">05/Feb/08 10:52</time>
                   </dd>
                   <dd class="attachment-size">
                    194 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12374819" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12374819/LUCENE-1044.take7.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take7.patch:https://issues.apache.org/jira/secure/attachment/12374819/LUCENE-1044.take7.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12374819/LUCENE-1044.take7.patch" title="Latest  05/Feb/08 21:19 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take7.patch:https://issues.apache.org/jira/secure/attachment/12374819/LUCENE-1044.take7.patch">LUCENE-1044.take7.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-05T21:19:00.614Z">05/Feb/08 21:19</time>
                   </dd>
                   <dd class="attachment-size">
                    205 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12375106" data-issue-id="12381729" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12375106/LUCENE-1044.take8.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take8.patch:https://issues.apache.org/jira/secure/attachment/12375106/LUCENE-1044.take8.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12375106/LUCENE-1044.take8.patch" title="Latest  08/Feb/08 20:31 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-1044.take8.patch:https://issues.apache.org/jira/secure/attachment/12375106/LUCENE-1044.take8.patch">LUCENE-1044.take8.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-08T20:31:59.185Z">08/Feb/08 20:31</time>
                   </dd>
                   <dd class="attachment-size">
                    206 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_mikemccand" rel="mikemccand" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Michael McCandless&quot;,&quot;emailAddress&quot;:&quot;lucene@mikemccandless.com&quot;,&quot;username&quot;:&quot;mikemccand&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mikemccand"></span></span> Michael McCandless </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_ts01" rel="ts01" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;venkat rangan&quot;,&quot;emailAddress&quot;:&quot;venkat@clearwellsystems.com&quot;,&quot;username&quot;:&quot;ts01&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="ts01"></span></span> venkat rangan </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">1</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">5</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="02/Nov/07 19:07"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-11-02T19:07:15+0000">02/Nov/07 19:07</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="23/Feb/09 17:15"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2009-02-23T17:15:03+0000">23/Feb/09 17:15</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="11/Feb/08 18:59"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2008-02-11T18:59:51+0000">11/Feb/08 18:59</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1044?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1044?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12539787\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12539787&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12539787\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12539787_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12539787_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/07 05:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-03T05:22:50+0000\'\u003e03\\/Nov\\/07 05:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003efirst off: there have been \u003cb\u003enumerous\u003c\\/b\u003e changes to the way lucene writes to files (particularly relating to segment files, write locks, and fault tollerance) between 2.0 and 2.2 (not to mention differences between 1.4.3 and 2.0 that i may not be aware of) &#8211; so you may see many differences in behavior if you upgrade.\u003c\\/p\u003e\\n\\n\u003cp\u003esecond: to quote myself from a recent thread regarding lucene and \\\"kill -9\\\" ...\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/www.nabble.com\\/Help-with-Lucene-Indexer-crash-recovery-tf4572570.html#a13068939\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.nabble.com\\/Help-with-Lucene-Indexer-crash-recovery-tf4572570.html#a13068939\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003e: That said, it should never in fact cause index corruption, as far as I\u003cbr\\/\u003e\\n: know.  Lucene is \\\"semi-transactional\\\": at any &amp; all moments you should\u003cbr\\/\u003e\\n: be able to destroy the JVM and the index will be unharmed. I would\u003cbr\\/\u003e\\n: really like to get to the bottom of why this is not the case here.\u003c\\/p\u003e\\n\\n\u003cp\u003eAt any point you can shutdown the JVM and the index will be unharmed, but\u003cbr\\/\u003e\\n\\\"destroying\\\" it with \\\"kill -9\\\" goes a little farther then that.  \u003c\\/p\u003e\\n\\n\u003cp\u003eLucene can\'t make that claim because the JVM can\'t even garuntee that\u003cbr\\/\u003e\\nbytes are written to physical disk when we close() an OutputStream &#8211; all\u003cbr\\/\u003e\\nit garuntees is that the bytes have been handed to the OS.  When you \\\"kill\u003cbr\\/\u003e\\n-9\\\" a process the OS is free to make \u003cb\u003eEVERYTHING\u003c\\/b\u003e about that process\u003cbr\\/\u003e\\nvanish without cleaning up after it ... i\'m pretty sure even pending IO\u003cbr\\/\u003e\\noperations are fair game for disappearing.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e...what\'s true for \\\"kill -9\\\" is true for hanking the power cord ... if the JVM isn\'t shut down cleanly, there is nothing Lucene or the JVM can do to guarantee that your index is in a consistent state.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12539787_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12539787_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/07 05:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-03T05:22:50+0000\'\u003e03\\/Nov\\/07 05:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    first off: there have been  numerous  changes to the way lucene writes to files (particularly relating to segment files, write locks, and fault tollerance) between 2.0 and 2.2 (not to mention differences between 1.4.3 and 2.0 that i may not be aware of) &#8211; so you may see many differences in behavior if you upgrade. \\n\\n second: to quote myself from a recent thread regarding lucene and \\\"kill -9\\\" ... \\n\\n  http:\\/\\/www.nabble.com\\/Help-with-Lucene-Indexer-crash-recovery-tf4572570.html#a13068939  \\n\\n \\n : That said, it should never in fact cause index corruption, as far as I \\n: know.  Lucene is \\\"semi-transactional\\\": at any &amp; all moments you should \\n: be able to destroy the JVM and the index will be unharmed. I would \\n: really like to get to the bottom of why this is not the case here. \\n\\n At any point you can shutdown the JVM and the index will be unharmed, but \\n\\\"destroying\\\" it with \\\"kill -9\\\" goes a little farther then that.   \\n\\n Lucene can\'t make that claim because the JVM can\'t even garuntee that \\nbytes are written to physical disk when we close() an OutputStream &#8211; all \\nit garuntees is that the bytes have been handed to the OS.  When you \\\"kill \\n-9\\\" a process the OS is free to make  EVERYTHING  about that process \\nvanish without cleaning up after it ... i\'m pretty sure even pending IO \\noperations are fair game for disappearing.  \\n\\n ...what\'s true for \\\"kill -9\\\" is true for hanking the power cord ... if the JVM isn\'t shut down cleanly, there is nothing Lucene or the JVM can do to guarantee that your index is in a consistent state.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12539891\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12539891&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12539891\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@ix.netcom.com\\\" id=\\\"commentauthor_12539891_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40ix.netcom.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@ix.netcom.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12539891_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/07 07:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-03T07:13:30+0000\'\u003e03\\/Nov\\/07 07:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe last comment is not correct, in that, there are many Java based applications (and non-java) that offer true transactional integrity.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt usually involves a log file, and using sync to ensure data is written to disk.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe Lucene structure allows for this VERY easily, as the \'segments\' file controls everything.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf all previous files are \\\"synced\\\", and then the \'segments.new\' file written, and synced (with a marker\\/checksum). Then the old \'segments\' deleted, and \'segments.new\' \'renamed to \'segments\'. It is trivial to ensure transactional integrity.\u003c\\/p\u003e\\n\\n\u003cp\u003eUpon index open, check for segments.new - if doesn\'t exist, or does not have a valid checksum, delete all segments not in \'segments\', if it is valid, then reattempt the rename. Then open the index.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@ix.netcom.com\\\" id=\\\"commentauthor_12539891_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40ix.netcom.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@ix.netcom.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12539891_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/07 07:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-03T07:13:30+0000\'\u003e03\\/Nov\\/07 07:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The last comment is not correct, in that, there are many Java based applications (and non-java) that offer true transactional integrity. \\n\\n It usually involves a log file, and using sync to ensure data is written to disk. \\n\\n The Lucene structure allows for this VERY easily, as the \'segments\' file controls everything. \\n\\n If all previous files are \\\"synced\\\", and then the \'segments.new\' file written, and synced (with a marker\\/checksum). Then the old \'segments\' deleted, and \'segments.new\' \'renamed to \'segments\'. It is trivial to ensure transactional integrity. \\n\\n Upon index open, check for segments.new - if doesn\'t exist, or does not have a valid checksum, delete all segments not in \'segments\', if it is valid, then reattempt the rename. Then open the index.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12540013\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12540013&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12540013\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ts01\\\" id=\\\"commentauthor_12540013_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ts01\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ts01\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e venkat rangan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540013_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/07 21:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-03T21:52:51+0000\'\u003e03\\/Nov\\/07 21:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRobert,\u003cbr\\/\u003e\\nAre your comments applicable for version 1.4.3? The behavior of an all-zero \'segments\' and \'deleted\' files is very easily reproduced. Also, there is no left over \'segments.new\' after a power-cord yank.\u003cbr\\/\u003e\\nThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ts01\\\" id=\\\"commentauthor_12540013_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ts01\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ts01\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e venkat rangan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540013_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/07 21:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-03T21:52:51+0000\'\u003e03\\/Nov\\/07 21:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Robert, \\nAre your comments applicable for version 1.4.3? The behavior of an all-zero \'segments\' and \'deleted\' files is very easily reproduced. Also, there is no left over \'segments.new\' after a power-cord yank. \\nThanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12540056\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12540056&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12540056\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540056_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540056_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/07 10:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-04T10:34:31+0000\'\u003e04\\/Nov\\/07 10:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSee the healthy follow-on discussion here:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \u003ca href=\\\"http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/54300\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/54300\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI plan to add optional argument when calling FSDirectory.getDirectory() to ask all created FSIndexOutputs to always call sync() on the file descriptor before closing it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540056_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540056_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/07 10:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-04T10:34:31+0000\'\u003e04\\/Nov\\/07 10:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    See the healthy follow-on discussion here: \\n\\n      http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/54300  \\n\\n I plan to add optional argument when calling FSDirectory.getDirectory() to ask all created FSIndexOutputs to always call sync() on the file descriptor before closing it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12540071\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12540071&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12540071\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540071_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540071_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/07 14:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-04T14:34:20+0000\'\u003e04\\/Nov\\/07 14:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis recent thread is also relevant here:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \u003ca href=\\\"http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/39898\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/39898\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540071_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540071_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/07 14:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-04T14:34:20+0000\'\u003e04\\/Nov\\/07 14:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This recent thread is also relevant here: \\n\\n      http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/39898               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12540073\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12540073&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12540073\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540073_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540073_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/07 15:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-04T15:28:33+0000\'\u003e04\\/Nov\\/07 15:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached patch that adds optional \\\"doSync\\\" boolean to\u003cbr\\/\u003e\\nFSDirectory.getDirectory(...).  It defaults to \\\"false\\\".  When true, I\u003cbr\\/\u003e\\ncall file.getFD().sync() just before file.close() in\u003cbr\\/\u003e\\nFSIndexOutput.close().\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, I can\'t figure out how to also sync the directory.  Does\u003cbr\\/\u003e\\nanyone know how to do this in Java?\u003c\\/p\u003e\\n\\n\u003cp\u003eAll tests pass if I default it to true or to false.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540073_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540073_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/07 15:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-04T15:28:33+0000\'\u003e04\\/Nov\\/07 15:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached patch that adds optional \\\"doSync\\\" boolean to \\nFSDirectory.getDirectory(...).  It defaults to \\\"false\\\".  When true, I \\ncall file.getFD().sync() just before file.close() in \\nFSIndexOutput.close(). \\n\\n However, I can\'t figure out how to also sync the directory.  Does \\nanyone know how to do this in Java? \\n\\n All tests pass if I default it to true or to false.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12540088\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12540088&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12540088\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540088_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540088_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/07 18:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-04T18:29:22+0000\'\u003e04\\/Nov\\/07 18:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eAttached another rev of the patch, that adds \\\"fsdirectory.dosync\\\"\u003cbr\\/\u003e\\nboolean config option to contrib\\/benchmark.\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran a quick perf test of sync vs no sync.  I indexed all of\u003cbr\\/\u003e\\nWikipedia using this alg:\u003c\\/p\u003e\\n\\n\u003cp\u003e  analyzer=org.apache.lucene.analysis.SimpleAnalyzer\u003c\\/p\u003e\\n\\n\u003col\u003e\\n\\t\u003cli\u003eFeed that knows how to process the line file format:\u003cbr\\/\u003e\\n  doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker\u003c\\/li\u003e\\n\u003c\\/ol\u003e\\n\\n\\n\u003cp\u003e  docs.file=\\/lucene\\/wikifull.txt\u003c\\/p\u003e\\n\\n\u003cp\u003e  doc.maker.forever=false\u003cbr\\/\u003e\\n  ram.flush.mb = 8\u003cbr\\/\u003e\\n  max.buffered = 0\u003cbr\\/\u003e\\n  directory = FSDirectory\u003cbr\\/\u003e\\n  max.field.length = 2147483647\u003cbr\\/\u003e\\n  doc.term.vector=false\u003cbr\\/\u003e\\n  doc.stored=false\u003cbr\\/\u003e\\n  fsdirectory.dosync = true\u003c\\/p\u003e\\n\\n\u003cp\u003e  ResetSystemErase\u003cbr\\/\u003e\\n  CreateIndex\u003cbr\\/\u003e\\n  {AddDoc &gt;: *\u003cbr\\/\u003e\\n  CloseIndex\u003c\\/p\u003e\\n\\n\u003cp\u003e  RepSumByName\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is on a quad core Mac OS X (Mac Pro) with a 4-drive RAID 0 IO\u003cbr\\/\u003e\\nsystem.  The baseline (non-sync) test took 19:54 and the sync test\u003cbr\\/\u003e\\ntook 20:21, which I think is a fairly minor slowdown.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also tried opening the file descriptor with \\\"rws\\\", which I think is\u003cbr\\/\u003e\\noverkill for us (we don\'t need every IO operation to be sync\'d) and it\u003cbr\\/\u003e\\ntook 31:11, which is a major slowdown \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe we should actually make doSync=true the default?  It seems like\u003cbr\\/\u003e\\na small price to pay for the added safety.  The option would still be\u003cbr\\/\u003e\\nthere to turn off if people wanted to made the opposite tradeoff.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540088_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540088_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Nov\\/07 18:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-04T18:29:22+0000\'\u003e04\\/Nov\\/07 18:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Attached another rev of the patch, that adds \\\"fsdirectory.dosync\\\" \\nboolean config option to contrib\\/benchmark. \\n\\n I ran a quick perf test of sync vs no sync.  I indexed all of \\nWikipedia using this alg: \\n\\n   analyzer=org.apache.lucene.analysis.SimpleAnalyzer \\n\\n \\n\\t Feed that knows how to process the line file format: \\n  doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker \\n \\n\\n\\n   docs.file=\\/lucene\\/wikifull.txt \\n\\n   doc.maker.forever=false \\n  ram.flush.mb = 8 \\n  max.buffered = 0 \\n  directory = FSDirectory \\n  max.field.length = 2147483647 \\n  doc.term.vector=false \\n  doc.stored=false \\n  fsdirectory.dosync = true \\n\\n   ResetSystemErase \\n  CreateIndex \\n  {AddDoc &gt;: * \\n  CloseIndex \\n\\n   RepSumByName \\n\\n This is on a quad core Mac OS X (Mac Pro) with a 4-drive RAID 0 IO \\nsystem.  The baseline (non-sync) test took 19:54 and the sync test \\ntook 20:21, which I think is a fairly minor slowdown. \\n\\n I also tried opening the file descriptor with \\\"rws\\\", which I think is \\noverkill for us (we don\'t need every IO operation to be sync\'d) and it \\ntook 31:11, which is a major slowdown   \\n\\n Maybe we should actually make doSync=true the default?  It seems like \\na small price to pay for the added safety.  The option would still be \\nthere to turn off if people wanted to made the opposite tradeoff.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12540612\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12540612&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12540612\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540612_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540612_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/07 22:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-06T22:38:47+0000\'\u003e06\\/Nov\\/07 22:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached another rev of the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eI changed the default to \\\"true\\\": I think the small performance hit is\u003cbr\\/\u003e\\nworth the added safety.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso put a try\\/finally around the the call to sync to make sure we\u003cbr\\/\u003e\\nclose even if we hit exception during sync(), and improved the\u003cbr\\/\u003e\\njavadocs.  I plan to commit in a day or two.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12540612_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12540612_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/07 22:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-06T22:38:47+0000\'\u003e06\\/Nov\\/07 22:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached another rev of the patch. \\n\\n I changed the default to \\\"true\\\": I think the small performance hit is \\nworth the added safety. \\n\\n Also put a try\\/finally around the the call to sync to make sure we \\nclose even if we hit exception during sync(), and improved the \\njavadocs.  I plan to commit in a day or two.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541566\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12541566&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541566\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12541566_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541566_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/07 17:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-10T17:51:55+0000\'\u003e10\\/Nov\\/07 17:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI just committed this.  Thanks Venkat!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12541566_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541566_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/07 17:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-10T17:51:55+0000\'\u003e10\\/Nov\\/07 17:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I just committed this.  Thanks Venkat!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541569\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12541569&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541569\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12541569_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541569_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/07 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-10T18:10:41+0000\'\u003e10\\/Nov\\/07 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThis is on a quad core Mac OS X (Mac Pro) with a 4-drive RAID 0 IO\u003cbr\\/\u003e\\nsystem. The baseline (non-sync) test took 19:54 and the sync test\u003cbr\\/\u003e\\ntook 20:21, which I think is a fairly minor slowdown.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWas that compound or non-compound index format?  I imagine non-compound will take a bigger hit since each file will be synchronized separately and in a serialized fashion.  I also imagine that the hit will be larger for a weaker disk subsystem, and for usage patterns that continually add a few docs and close?\u003c\\/p\u003e\\n\\n\u003cp\u003eIs a sync before every file close really needed, or can some of them be avoided when autocommit==false?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12541569_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541569_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/07 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-10T18:10:41+0000\'\u003e10\\/Nov\\/07 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     This is on a quad core Mac OS X (Mac Pro) with a 4-drive RAID 0 IO \\nsystem. The baseline (non-sync) test took 19:54 and the sync test \\ntook 20:21, which I think is a fairly minor slowdown.  \\n\\n Was that compound or non-compound index format?  I imagine non-compound will take a bigger hit since each file will be synchronized separately and in a serialized fashion.  I also imagine that the hit will be larger for a weaker disk subsystem, and for usage patterns that continually add a few docs and close? \\n\\n Is a sync before every file close really needed, or can some of them be avoided when autocommit==false?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541570\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12541570&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541570\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@ix.netcom.com\\\" id=\\\"commentauthor_12541570_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40ix.netcom.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@ix.netcom.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541570_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/07 18:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-10T18:17:25+0000\'\u003e10\\/Nov\\/07 18:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree. Just for a baseline, I think the test needs to be done on a single drive system.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, the \'sync\' should be optional. BerkleyDB offers similar functionality.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reason being, if the index can be completely recreated from other sources, you might not want to pay the performance hit, instead recreate the index if corruption\\/hard failure occurs.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@ix.netcom.com\\\" id=\\\"commentauthor_12541570_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40ix.netcom.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@ix.netcom.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541570_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/07 18:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-10T18:17:25+0000\'\u003e10\\/Nov\\/07 18:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree. Just for a baseline, I think the test needs to be done on a single drive system. \\n\\n Also, the \'sync\' should be optional. BerkleyDB offers similar functionality. \\n\\n The reason being, if the index can be completely recreated from other sources, you might not want to pay the performance hit, instead recreate the index if corruption\\/hard failure occurs. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541576\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12541576&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541576\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12541576_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541576_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/07 19:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-10T19:04:20+0000\'\u003e10\\/Nov\\/07 19:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eWas that compound or non-compound index format?  I imagine\u003cbr\\/\u003e\\nnon-compound will take a bigger hit since each file will be\u003cbr\\/\u003e\\nsynchronized separately and in a serialized fashion.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe test was with compound file.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, the close() on each component file that goes into the compound\u003cbr\\/\u003e\\nfile also does a sync, so compound file would be a slightly bigger hit\u003cbr\\/\u003e\\nbecause it has one additional sync()?\u003c\\/p\u003e\\n\\n\u003cp\u003eWe can\'t safely remove the sync() on each component file before\u003cbr\\/\u003e\\nbuilding the compound file because we currently do a commit of the new\u003cbr\\/\u003e\\nsegments file before building the compound file.\u003c\\/p\u003e\\n\\n\u003cp\u003eI guess we could revisit whether that commit (before building the\u003cbr\\/\u003e\\ncompound file) is really necessary?  I think it\'s there from when\u003cbr\\/\u003e\\nflushing &amp; merging were the same thing, and you do want to do this\u003cbr\\/\u003e\\nwhen merging to save 1X extra peak on the disk usage, but now that\u003cbr\\/\u003e\\nflushing is separate from merging we could remove that intermediate\u003cbr\\/\u003e\\ncommit?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI also imagine that the hit will be larger for a weaker disk\u003cbr\\/\u003e\\nsubsystem, and for usage patterns that continually add a few docs and\u003cbr\\/\u003e\\nclose?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK I\'ll run the same test, but once on a laptop and once over NFS to\u003cbr\\/\u003e\\nsee what the cost is for those cases.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, continually adding docs &amp; flushing\\/closing your writer will in\u003cbr\\/\u003e\\ntheory be most affected here.  I think for such apps performance is\u003cbr\\/\u003e\\nnot usually top priority (indexing latency is)?  Ie if you wanted\u003cbr\\/\u003e\\nperformance you would batch up the added docs more?  Anyway, for such\u003cbr\\/\u003e\\ncases users can turn off sync() if they want to risk it?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eIs a sync before every file close really needed, or can some of them\u003cbr\\/\u003e\\nbe avoided when autocommit==false?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt\'s somewhat tricky to safely remove sync() even when\u003cbr\\/\u003e\\nautoCommit=false, because you don\'t know at close() whether this file\u003cbr\\/\u003e\\nyou are closing will be referenced (and not merged away) when the\u003cbr\\/\u003e\\ncommit is finally done (when IndexWriter is closed).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf there were a way to sync a file after having closed it (is there?)\u003cbr\\/\u003e\\nthen we could go and sync() all new files we had created that are now\u003cbr\\/\u003e\\nreferenced by the segments file we are writing.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, I was thinking we could start simple (call sync() before every\u003cbr\\/\u003e\\nclose()) and then with time, and if necessary, work out smarter ways\u003cbr\\/\u003e\\nto safely remove some of those sync()\'s.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eAlso, the \'sync\' should be optional. BerkleyDB offers similar\u003cbr\\/\u003e\\nfunctionality.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt is optional: I added doSync boolean to\u003cbr\\/\u003e\\nFSDirectory.getDirectory(...).\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd, I agree: for cases where there is very low cost to regenerate the\u003cbr\\/\u003e\\nindex, and you want absolute best performance, you can turn off\u003cbr\\/\u003e\\nsyncing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12541576_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541576_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/07 19:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-10T19:04:20+0000\'\u003e10\\/Nov\\/07 19:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n \\n Was that compound or non-compound index format?  I imagine \\nnon-compound will take a bigger hit since each file will be \\nsynchronized separately and in a serialized fashion.  \\n\\n The test was with compound file. \\n\\n But, the close() on each component file that goes into the compound \\nfile also does a sync, so compound file would be a slightly bigger hit \\nbecause it has one additional sync()? \\n\\n We can\'t safely remove the sync() on each component file before \\nbuilding the compound file because we currently do a commit of the new \\nsegments file before building the compound file. \\n\\n I guess we could revisit whether that commit (before building the \\ncompound file) is really necessary?  I think it\'s there from when \\nflushing &amp; merging were the same thing, and you do want to do this \\nwhen merging to save 1X extra peak on the disk usage, but now that \\nflushing is separate from merging we could remove that intermediate \\ncommit? \\n\\n \\n I also imagine that the hit will be larger for a weaker disk \\nsubsystem, and for usage patterns that continually add a few docs and \\nclose?  \\n\\n OK I\'ll run the same test, but once on a laptop and once over NFS to \\nsee what the cost is for those cases. \\n\\n Yes, continually adding docs &amp; flushing\\/closing your writer will in \\ntheory be most affected here.  I think for such apps performance is \\nnot usually top priority (indexing latency is)?  Ie if you wanted \\nperformance you would batch up the added docs more?  Anyway, for such \\ncases users can turn off sync() if they want to risk it? \\n\\n \\n Is a sync before every file close really needed, or can some of them \\nbe avoided when autocommit==false?  \\n\\n It\'s somewhat tricky to safely remove sync() even when \\nautoCommit=false, because you don\'t know at close() whether this file \\nyou are closing will be referenced (and not merged away) when the \\ncommit is finally done (when IndexWriter is closed). \\n\\n If there were a way to sync a file after having closed it (is there?) \\nthen we could go and sync() all new files we had created that are now \\nreferenced by the segments file we are writing. \\n\\n Also, I was thinking we could start simple (call sync() before every \\nclose()) and then with time, and if necessary, work out smarter ways \\nto safely remove some of those sync()\'s. \\n\\n \\n Also, the \'sync\' should be optional. BerkleyDB offers similar \\nfunctionality.  \\n\\n It is optional: I added doSync boolean to \\nFSDirectory.getDirectory(...). \\n\\n And, I agree: for cases where there is very low cost to regenerate the \\nindex, and you want absolute best performance, you can turn off \\nsyncing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12541874\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12541874&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12541874\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12541874_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541874_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/07 18:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-12T18:14:06+0000\'\u003e12\\/Nov\\/07 18:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Is a sync before every file close really needed \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e ?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt might be nice if we could use the Linux sync() system call, instead of fsync().  Then we could call that only when the new segments file is moved into place rather than as each file is closed.  We could exec the sync shell command when running on Unix, but I don\'t know whether there\'s an equivalent command for Windows, and it wouldn\'t be Java...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12541874_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12541874_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/07 18:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-12T18:14:06+0000\'\u003e12\\/Nov\\/07 18:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Is a sync before every file close really needed  &#91;...&#93;  ? \\n\\n It might be nice if we could use the Linux sync() system call, instead of fsync().  Then we could call that only when the new segments file is moved into place rather than as each file is closed.  We could exec the sync shell command when running on Unix, but I don\'t know whether there\'s an equivalent command for Windows, and it wouldn\'t be Java...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12542244\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12542244&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12542244\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12542244_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12542244_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/07 21:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-13T21:53:52+0000\'\u003e13\\/Nov\\/07 21:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I ran sync\\/nosync tests across various platforms\\/IO system.  In\u003cbr\\/\u003e\\neach case I ran the test once with doSync=true and once with\u003cbr\\/\u003e\\ndoSync=false, using this alg:\u003c\\/p\u003e\\n\\n\u003cp\u003e  analyzer=org.apache.lucene.analysis.SimpleAnalyzer\u003cbr\\/\u003e\\n  doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker\u003cbr\\/\u003e\\n  docs.file=\\/lucene\\/wikifull.txt\u003c\\/p\u003e\\n\\n\u003cp\u003e  doc.maker.forever=false\u003cbr\\/\u003e\\n  ram.flush.mb = 8\u003cbr\\/\u003e\\n  max.buffered = 0\u003cbr\\/\u003e\\n  directory = FSDirectory\u003cbr\\/\u003e\\n  max.field.length = 2147483647\u003cbr\\/\u003e\\n  doc.term.vector=false\u003cbr\\/\u003e\\n  doc.stored=false\u003cbr\\/\u003e\\n  work.dir = \\/tmp\\/lucene\u003cbr\\/\u003e\\n  fsdirectory.dosync = false\u003c\\/p\u003e\\n\\n\u003cp\u003e  ResetSystemErase\u003cbr\\/\u003e\\n  CreateIndex\u003cbr\\/\u003e\\n  {AddDoc &gt;: 150000\u003cbr\\/\u003e\\n  CloseIndex\u003c\\/p\u003e\\n\\n\u003cp\u003e  RepSumByName\u003c\\/p\u003e\\n\\n\u003cp\u003eIe, time to index the first 150K docs from Wikipedia.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eResults for single hard drive:\u003c\\/p\u003e\\n\\n\u003cp\u003e  Mac mini (10.5 Leopard) single 4200 RPM \\\"notebook\\\" (2.5\\\") drive &#8211; 2.3% slower:\u003c\\/p\u003e\\n\\n\u003cp\u003e      sync - 296.80 sec\u003cbr\\/\u003e\\n    nosync - 290.06 sec\u003c\\/p\u003e\\n\\n\u003cp\u003e  Mac pro (10.4 Tiger), single external drive &#8211; 35.5% slower:\u003c\\/p\u003e\\n\\n\u003cp\u003e      sync - 259.61 sec\u003cbr\\/\u003e\\n    nosync - 191.53 sec\u003c\\/p\u003e\\n\\n\u003cp\u003e  Win XP Pro laptop, single drive &#8211; 38.2% slower\u003c\\/p\u003e\\n\\n\u003cp\u003e      sync - 536.00 sec\u003cbr\\/\u003e\\n    nosync - 387.90 sec\u003c\\/p\u003e\\n\\n\u003cp\u003e  Linux (2.6.22.1), ext3 single drive &#8211; 23% slower\u003c\\/p\u003e\\n\\n\u003cp\u003e      sync - 185.42 sec\u003cbr\\/\u003e\\n    nosync - 150.56 sec\u003c\\/p\u003e\\n\\n\u003cp\u003eResults for multiple hard drives (RAID arrays):\u003c\\/p\u003e\\n\\n\u003cp\u003e  Linux (2.6.22.1), reiserfs 6 drive RAID5 array &#8211; 49% slower (!!)\u003c\\/p\u003e\\n\\n\u003cp\u003e      sync - 239.32 sec\u003cbr\\/\u003e\\n    nosync - 160.56 sec\u003c\\/p\u003e\\n\\n\u003cp\u003e  Mac Pro (10.4 Tiger), 4 drive RAID0 array &#8211; 1% faster\u003c\\/p\u003e\\n\\n\u003cp\u003e      sync - 157.26 sec\u003cbr\\/\u003e\\n    nosync - 158.93 sec\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eSo at this point I\'m torn...\u003c\\/p\u003e\\n\\n\u003cp\u003eThe performance cost of the simplest approach (sync() before close())\u003cbr\\/\u003e\\nis very costly in many cases (not just laptop IO subsystems).  The\u003cbr\\/\u003e\\nreiserfs test was rather shocking.  Then, it\'s oddly very lost cost in\u003cbr\\/\u003e\\nother cases: the Mac Mini test I find amazing.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s frustrating to lose such performance \\\"out of the box\\\" for the\u003cbr\\/\u003e\\npresumably extremely rare event of OS\\/machine crash\\/power cut.\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe we should leave the default as false for now?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12542244_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12542244_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/07 21:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-13T21:53:52+0000\'\u003e13\\/Nov\\/07 21:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I ran sync\\/nosync tests across various platforms\\/IO system.  In \\neach case I ran the test once with doSync=true and once with \\ndoSync=false, using this alg: \\n\\n   analyzer=org.apache.lucene.analysis.SimpleAnalyzer \\n  doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker \\n  docs.file=\\/lucene\\/wikifull.txt \\n\\n   doc.maker.forever=false \\n  ram.flush.mb = 8 \\n  max.buffered = 0 \\n  directory = FSDirectory \\n  max.field.length = 2147483647 \\n  doc.term.vector=false \\n  doc.stored=false \\n  work.dir = \\/tmp\\/lucene \\n  fsdirectory.dosync = false \\n\\n   ResetSystemErase \\n  CreateIndex \\n  {AddDoc &gt;: 150000 \\n  CloseIndex \\n\\n   RepSumByName \\n\\n Ie, time to index the first 150K docs from Wikipedia. \\n\\n\\n Results for single hard drive: \\n\\n   Mac mini (10.5 Leopard) single 4200 RPM \\\"notebook\\\" (2.5\\\") drive &#8211; 2.3% slower: \\n\\n       sync - 296.80 sec \\n    nosync - 290.06 sec \\n\\n   Mac pro (10.4 Tiger), single external drive &#8211; 35.5% slower: \\n\\n       sync - 259.61 sec \\n    nosync - 191.53 sec \\n\\n   Win XP Pro laptop, single drive &#8211; 38.2% slower \\n\\n       sync - 536.00 sec \\n    nosync - 387.90 sec \\n\\n   Linux (2.6.22.1), ext3 single drive &#8211; 23% slower \\n\\n       sync - 185.42 sec \\n    nosync - 150.56 sec \\n\\n Results for multiple hard drives (RAID arrays): \\n\\n   Linux (2.6.22.1), reiserfs 6 drive RAID5 array &#8211; 49% slower (!!) \\n\\n       sync - 239.32 sec \\n    nosync - 160.56 sec \\n\\n   Mac Pro (10.4 Tiger), 4 drive RAID0 array &#8211; 1% faster \\n\\n       sync - 157.26 sec \\n    nosync - 158.93 sec \\n\\n\\n So at this point I\'m torn... \\n\\n The performance cost of the simplest approach (sync() before close()) \\nis very costly in many cases (not just laptop IO subsystems).  The \\nreiserfs test was rather shocking.  Then, it\'s oddly very lost cost in \\nother cases: the Mac Mini test I find amazing. \\n\\n It\'s frustrating to lose such performance \\\"out of the box\\\" for the \\npresumably extremely rare event of OS\\/machine crash\\/power cut. \\n\\n Maybe we should leave the default as false for now?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12542261\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12542261&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12542261\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12542261_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12542261_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/07 22:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-13T22:47:05+0000\'\u003e13\\/Nov\\/07 22:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Maybe we should leave the default as false for now?\u003c\\/p\u003e\\n\\n\u003cp\u003ePerhaps for the short-term, but long-term it would be better to find a solution that\'s both reliable and doesn\'t have such a big performance impact.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe really don\'t need to sync until we commit.  It would be interesting to know how much it slows things to do that.  As a quick hack we could try running the \'sync\' command line program at each commit.  If performance looks good, then we might look into implementing this in pure Java, changing FSDirectory.close() to queue FileDescriptors, add a background thread that syncs queued files, and add a Directory.sync() method that blocks until the queue is empty.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12542261_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12542261_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Nov\\/07 22:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-13T22:47:05+0000\'\u003e13\\/Nov\\/07 22:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Maybe we should leave the default as false for now? \\n\\n Perhaps for the short-term, but long-term it would be better to find a solution that\'s both reliable and doesn\'t have such a big performance impact. \\n\\n We really don\'t need to sync until we commit.  It would be interesting to know how much it slows things to do that.  As a quick hack we could try running the \'sync\' command line program at each commit.  If performance looks good, then we might look into implementing this in pure Java, changing FSDirectory.close() to queue FileDescriptors, add a background thread that syncs queued files, and add a Directory.sync() method that blocks until the queue is empty.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12542397\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12542397&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12542397\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12542397_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12542397_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Nov\\/07 10:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-14T10:24:19+0000\'\u003e14\\/Nov\\/07 10:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003ePerhaps for the short-term, but long-term it would be better to find a solution that\'s both reliable and doesn\'t have such a big performance impact.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAgreed.  I will default doSync back to false, for now.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eWe really don\'t need to sync until we commit. It would be interesting to know how much it slows things to do that. As a quick hack we could try running the \'sync\' command line program at each commit.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI will test this as a hack first just to see how performance compares\u003cbr\\/\u003e\\nto the current approach.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eIf performance looks good, then we might look into implementing this in pure Java, changing FSDirectory.close() to queue FileDescriptors, add a background thread that syncs queued files, and add a Directory.sync() method that blocks until the queue is empty.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWill do!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12542397_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12542397_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Nov\\/07 10:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-14T10:24:19+0000\'\u003e14\\/Nov\\/07 10:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Perhaps for the short-term, but long-term it would be better to find a solution that\'s both reliable and doesn\'t have such a big performance impact.  \\n\\n Agreed.  I will default doSync back to false, for now. \\n\\n \\n We really don\'t need to sync until we commit. It would be interesting to know how much it slows things to do that. As a quick hack we could try running the \'sync\' command line program at each commit.  \\n\\n I will test this as a hack first just to see how performance compares \\nto the current approach. \\n\\n \\n If performance looks good, then we might look into implementing this in pure Java, changing FSDirectory.close() to queue FileDescriptors, add a background thread that syncs queued files, and add a Directory.sync() method that blocks until the queue is empty.  \\n\\n Will do!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544115\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12544115&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544115\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12544115_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544115_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 23:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T23:19:56+0000\'\u003e20\\/Nov\\/07 23:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, I tested calling command-line \\\"sync\\\", after writing each segments\u003cbr\\/\u003e\\nfile.  It\'s in fact even slower than fsync on each file for these 3\u003cbr\\/\u003e\\ncases:\u003c\\/p\u003e\\n\\n\u003cp\u003eLinux (2.6.22.1), reiserfs 6 drive RAID5 array 93% slower\u003cbr\\/\u003e\\n      sync - 330.74\u003cbr\\/\u003e\\n    nosync - 171.24\u003c\\/p\u003e\\n\\n\u003cp\u003eLinux (2.6.22.1), ext3 single drive 60% slower\u003cbr\\/\u003e\\n      sync - 242.02\u003cbr\\/\u003e\\n    nosync - 150.91\u003c\\/p\u003e\\n\\n\u003cp\u003eMac Pro (10.4 Tiger), 4 drive RAID0 array 28% slower\u003cbr\\/\u003e\\n      sync - 204.77\u003cbr\\/\u003e\\n    nosync - 159.90\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll look into the separate thread to sync\\/close files in the\u003cbr\\/\u003e\\nbackground next...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12544115_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544115_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 23:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T23:19:56+0000\'\u003e20\\/Nov\\/07 23:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, I tested calling command-line \\\"sync\\\", after writing each segments \\nfile.  It\'s in fact even slower than fsync on each file for these 3 \\ncases: \\n\\n Linux (2.6.22.1), reiserfs 6 drive RAID5 array 93% slower \\n      sync - 330.74 \\n    nosync - 171.24 \\n\\n Linux (2.6.22.1), ext3 single drive 60% slower \\n      sync - 242.02 \\n    nosync - 150.91 \\n\\n Mac Pro (10.4 Tiger), 4 drive RAID0 array 28% slower \\n      sync - 204.77 \\n    nosync - 159.90 \\n\\n I\'ll look into the separate thread to sync\\/close files in the \\nbackground next...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544730\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12544730&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544730\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12544730_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544730_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 08:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T08:38:43+0000\'\u003e22\\/Nov\\/07 08:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think changing the only constructor in FSDirectory.FSIndexOutput is\u003cbr\\/\u003e\\nan API change. I have a class that extends FSIndexOutput and it \u003cbr\\/\u003e\\ndoesn\'t compile anymore after switching to the 2.3-dev jar.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think we should put this ctr back:\u003cbr\\/\u003e\\npublic FSIndexOutput(File path) throws IOException {\u003cbr\\/\u003e\\n  this(path, DEFAULT_DO_SYNC);\u003cbr\\/\u003e\\n}\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12544730_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544730_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 08:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T08:38:43+0000\'\u003e22\\/Nov\\/07 08:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think changing the only constructor in FSDirectory.FSIndexOutput is \\nan API change. I have a class that extends FSIndexOutput and it  \\ndoesn\'t compile anymore after switching to the 2.3-dev jar. \\n\\n I think we should put this ctr back: \\npublic FSIndexOutput(File path) throws IOException { \\n  this(path, DEFAULT_DO_SYNC); \\n}              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544758\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12544758&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544758\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12544758_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544758_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 10:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T10:32:48+0000\'\u003e22\\/Nov\\/07 10:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWoops, OK I will put it back ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12544758_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544758_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 10:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T10:32:48+0000\'\u003e22\\/Nov\\/07 10:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Woops, OK I will put it back ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544803\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12544803&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544803\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12544803_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544803_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 13:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T13:27:23+0000\'\u003e22\\/Nov\\/07 13:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI\'ll look into the separate thread to sync\\/close files in the\u003cbr\\/\u003e\\nbackground next...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI was wondering if delaying sync to actual commit point would run faster\u003cbr\\/\u003e\\nthan a background thread. I thought it would, because the background\u003cbr\\/\u003e\\nthread, though not holding current thread from continue with indexing, \u003cbr\\/\u003e\\ndoes force the sync \u003cb\u003enow\u003c\\/b\u003e rather than letting the IO subsystem actually \u003cbr\\/\u003e\\nwrite stuff on its time. I was also hoping that by doing them later, \u003cbr\\/\u003e\\nsome of the syncs would become no-ops, and hence faster. I found\u003cbr\\/\u003e\\nout however that delaying the syncs (but intending to sync) also \u003cbr\\/\u003e\\nmeans keeping the file handles open, and therefore  this is not \u003cbr\\/\u003e\\na practical approach. Still it was interesting to compare. \u003c\\/p\u003e\\n\\n\u003cp\u003eSo... my small test sequentially writes M characters to N files \u003cbr\\/\u003e\\nand either do not sync (just close), or does sync in one of three \u003cbr\\/\u003e\\nways: (1) at the end, (2) immediately, (3) in a background thread. \u003cbr\\/\u003e\\nThe results (in millis) on my Windows XP were:\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003e num files \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e num chars per file \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e No Sync \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e Sync At End \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e Background Sync \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e Immediate Sync \u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   100 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   631 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   5778 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   5729 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   5828 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   100 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   581 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   4486 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   4117 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   4687 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1612 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  38996 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  34900 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  35852 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1432 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  37153 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  35051 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  37263 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   100 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10335 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 154262 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 162103 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 174251 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   100 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 11276 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 147752 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 159480 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 222450 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eEach configuration ran twice and there are fluctuations, \u003cbr\\/\u003e\\nbut it is obvious (as Mike noticed) that no-sync is much faster\u003cbr\\/\u003e\\nthen sync. In fact in my test no-sync is at least 10 times faster\u003cbr\\/\u003e\\nthan any sync approach, while in Mike\'s test which is using \u003cbr\\/\u003e\\nLucene the penalty is smaller. Difference might be because \u003cbr\\/\u003e\\nin my test there is no CPU work involved, just IO. \u003c\\/p\u003e\\n\\n\u003cp\u003eComparing \\\"immediate\\\" to \\\"background\\\" I it is not clearly worth it \u003cbr\\/\u003e\\nto add a background thread (unless Mike\'s test proves otherwise..)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12544803_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544803_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 13:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T13:27:23+0000\'\u003e22\\/Nov\\/07 13:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I\'ll look into the separate thread to sync\\/close files in the \\nbackground next...  \\n\\n I was wondering if delaying sync to actual commit point would run faster \\nthan a background thread. I thought it would, because the background \\nthread, though not holding current thread from continue with indexing,  \\ndoes force the sync  now  rather than letting the IO subsystem actually  \\nwrite stuff on its time. I was also hoping that by doing them later,  \\nsome of the syncs would become no-ops, and hence faster. I found \\nout however that delaying the syncs (but intending to sync) also  \\nmeans keeping the file handles open, and therefore  this is not  \\na practical approach. Still it was interesting to compare.  \\n\\n So... my small test sequentially writes M characters to N files  \\nand either do not sync (just close), or does sync in one of three  \\nways: (1) at the end, (2) immediately, (3) in a background thread.  \\nThe results (in millis) on my Windows XP were: \\n\\n \\n  \\n \\n  num files  \\n  num chars per file  \\n  No Sync  \\n  Sync At End  \\n  Background Sync  \\n  Immediate Sync  \\n \\n \\n    100  \\n  10000  \\n    631  \\n    5778  \\n    5729  \\n    5828  \\n \\n \\n    100  \\n  10000  \\n    581  \\n    4486  \\n    4117  \\n    4687  \\n \\n \\n   1000  \\n   1000  \\n   1612  \\n   38996  \\n   34900  \\n   35852  \\n \\n \\n   1000  \\n   1000  \\n   1432  \\n   37153  \\n   35051  \\n   37263  \\n \\n \\n  10000  \\n    100  \\n  10335  \\n  154262  \\n  162103  \\n  174251  \\n \\n \\n  10000  \\n    100  \\n  11276  \\n  147752  \\n  159480  \\n  222450  \\n \\n  \\n \\n\\n\\n Each configuration ran twice and there are fluctuations,  \\nbut it is obvious (as Mike noticed) that no-sync is much faster \\nthen sync. In fact in my test no-sync is at least 10 times faster \\nthan any sync approach, while in Mike\'s test which is using  \\nLucene the penalty is smaller. Difference might be because  \\nin my test there is no CPU work involved, just IO.  \\n\\n Comparing \\\"immediate\\\" to \\\"background\\\" I it is not clearly worth it  \\nto add a background thread (unless Mike\'s test proves otherwise..)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544811\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12544811&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544811\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12544811_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544811_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T14:11:59+0000\'\u003e22\\/Nov\\/07 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWith some artificial CPU activity added to the test program:\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003e num files \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e num chars per file \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e No Sync \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e Sync At End \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e Background Sync \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e Immediate Sync \u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   100 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  6690  \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  11516 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  10706 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  11216 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   100 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  7200  \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  11006 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  10575 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  10846 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  8002  \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  48570 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  48479 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  51825 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  1000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  7801  \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  43142 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  43693 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e  43342 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   100 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 16303  \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 152730 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 326810 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 207939 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10000 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e   100 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 17805  \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 156375 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 160040 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 165398 \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12544811_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544811_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T14:11:59+0000\'\u003e22\\/Nov\\/07 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    With some artificial CPU activity added to the test program: \\n \\n  \\n \\n  num files  \\n  num chars per file  \\n  No Sync  \\n  Sync At End  \\n  Background Sync  \\n  Immediate Sync  \\n \\n \\n    100  \\n  10000  \\n   6690   \\n   11516  \\n   10706  \\n   11216  \\n \\n \\n    100  \\n  10000  \\n   7200   \\n   11006  \\n   10575  \\n   10846  \\n \\n \\n   1000  \\n   1000  \\n   8002   \\n   48570  \\n   48479  \\n   51825  \\n \\n \\n   1000  \\n   1000  \\n   7801   \\n   43142  \\n   43693  \\n   43342  \\n \\n \\n  10000  \\n    100  \\n  16303   \\n  152730  \\n  326810  \\n  207939  \\n \\n \\n  10000  \\n    100  \\n  17805   \\n  156375  \\n  160040  \\n  165398  \\n \\n  \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544812\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12544812&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544812\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12544812_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544812_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 14:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T14:16:10+0000\'\u003e22\\/Nov\\/07 14:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Doron Cohen - 22\\/Nov\\/07 14:16\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached FSyncPerfTest.java is the standalone (non Lucene) perf test that I used.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12544812_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544812_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/07 14:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-22T14:16:10+0000\'\u003e22\\/Nov\\/07 14:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Doron Cohen - 22\\/Nov\\/07 14:16\\\"\u003eedited\u003c\\/span\u003e                   Attached FSyncPerfTest.java is the standalone (non Lucene) perf test that I used.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12545535\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12545535&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12545535\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12545535_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12545535_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Nov\\/07 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-26T18:13:03+0000\'\u003e26\\/Nov\\/07 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; I found out however that delaying the syncs (but intending to sync) also\u003cbr\\/\u003e\\nmeans keeping the file handles open \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eNot necessarily.  You could just queue the file names for sync, close them, and then have the background thread open, sync and close them.  The close could trigger the OS to sync things faster in the background.  Then the open\\/sync\\/close could mostly be a no-op.  Might be worth a try.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12545535_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12545535_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Nov\\/07 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-26T18:13:03+0000\'\u003e26\\/Nov\\/07 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; I found out however that delaying the syncs (but intending to sync) also \\nmeans keeping the file handles open  &#91;...&#93;  \\n\\n Not necessarily.  You could just queue the file names for sync, close them, and then have the background thread open, sync and close them.  The close could trigger the OS to sync things faster in the background.  Then the open\\/sync\\/close could mostly be a no-op.  Might be worth a try.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12545993\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12545993&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12545993\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12545993_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12545993_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/07 20:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-27T20:14:17+0000\'\u003e27\\/Nov\\/07 20:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I did a simplistic patch (attached) whereby FSDirectory has a\u003cbr\\/\u003e\\nbackground thread that re-opens, syncs, and closes those files that\u003cbr\\/\u003e\\nLucene has written.  (I\'m using a modified version of the class from\u003cbr\\/\u003e\\nDoron\'s test).\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch is nowhere near ready to commit; I just coded up enough so\u003cbr\\/\u003e\\nwe could get a rough measure of performance cost of syncing.  EG we\u003cbr\\/\u003e\\nmust prevent deletion of a commit point until a future commit point is\u003cbr\\/\u003e\\nfully sync\'d to stable storage; we must also take care not to sync a\u003cbr\\/\u003e\\nfile that has been deleted before we sync\'d it; don\'t sync until the\u003cbr\\/\u003e\\nend when running with autoCommit=false; merges if run by\u003cbr\\/\u003e\\nConcurrentMergeScheduler should \u003cspan class=\\\"error\\\"\u003e&#91;maybe&#93;\u003c\\/span\u003e sync in the foreground; maybe\u003cbr\\/\u003e\\nforcefully throttle back updates if syncing is falling too far behind;\u003cbr\\/\u003e\\netc.\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran the same alg as the tests above (index first 150K docs of\u003cbr\\/\u003e\\nWikipedia).  I ran CFS and no CFS X sync and nosync (4 tests) for each\u003cbr\\/\u003e\\nIO system.  Time is the fastest of 2 runs:\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003e IO System \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e CFS sync \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e CFS nosync \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e CFS % slower \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e non-CFS sync \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e non-CFS nosync \u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e non-CFS % slower \u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e ReiserFS 6-drive RAID5 array Linux (2.6.22.1) \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 188 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 157 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 19.7% \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 143 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 147 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e -2.7% \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e EXT3 single internal drive Linux (2.6.22.1) \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 173 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 157 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 10.2% \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 136 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 132 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 3.0% \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 4 drive RAID0 array Mac Pro (10.4 Tiger) \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 153 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 152 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 0.7% \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 150 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 149 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 0.7% \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e Win XP Pro laptop, single drive \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 463 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 352 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 31.5% \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 343 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 335 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 2.4% \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e Mac Pro single external drive \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 463 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 352 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 31.5% \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 343 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 335 \u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e 2.4% \u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eThe good news is, the non-CFS case shows very little cost when we do\u003cbr\\/\u003e\\nBG sync\'ing!\u003c\\/p\u003e\\n\\n\u003cp\u003eThe bad news is, the CFS case still shows a high cost.  However, by\u003cbr\\/\u003e\\nnot sync\'ing the files that go into the CFS (and also not committing a\u003cbr\\/\u003e\\nnew segments_N file until after the CFS is written) I expect that cost\u003cbr\\/\u003e\\nto go way down.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne caveat: I\'m using a 8 MB RAM buffer for all of these tests.  As\u003cbr\\/\u003e\\nYonik pointed out, if you have a smaller buffer, or, you add just a\u003cbr\\/\u003e\\nfew docs and then close your writer, the sync cost as a pctg of net\u003cbr\\/\u003e\\nindexing time will be quite a bit higher.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12545993_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12545993_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/07 20:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-27T20:14:17+0000\'\u003e27\\/Nov\\/07 20:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I did a simplistic patch (attached) whereby FSDirectory has a \\nbackground thread that re-opens, syncs, and closes those files that \\nLucene has written.  (I\'m using a modified version of the class from \\nDoron\'s test). \\n\\n This patch is nowhere near ready to commit; I just coded up enough so \\nwe could get a rough measure of performance cost of syncing.  EG we \\nmust prevent deletion of a commit point until a future commit point is \\nfully sync\'d to stable storage; we must also take care not to sync a \\nfile that has been deleted before we sync\'d it; don\'t sync until the \\nend when running with autoCommit=false; merges if run by \\nConcurrentMergeScheduler should  &#91;maybe&#93;  sync in the foreground; maybe \\nforcefully throttle back updates if syncing is falling too far behind; \\netc. \\n\\n I ran the same alg as the tests above (index first 150K docs of \\nWikipedia).  I ran CFS and no CFS X sync and nosync (4 tests) for each \\nIO system.  Time is the fastest of 2 runs: \\n\\n \\n  \\n \\n  IO System  \\n  CFS sync  \\n  CFS nosync  \\n  CFS % slower  \\n  non-CFS sync  \\n  non-CFS nosync  \\n  non-CFS % slower  \\n \\n \\n  ReiserFS 6-drive RAID5 array Linux (2.6.22.1)  \\n  188  \\n  157  \\n  19.7%  \\n  143  \\n  147  \\n  -2.7%  \\n \\n \\n  EXT3 single internal drive Linux (2.6.22.1)  \\n  173  \\n  157  \\n  10.2%  \\n  136  \\n  132  \\n  3.0%  \\n \\n \\n  4 drive RAID0 array Mac Pro (10.4 Tiger)  \\n  153  \\n  152  \\n  0.7%  \\n  150  \\n  149  \\n  0.7%  \\n \\n \\n  Win XP Pro laptop, single drive  \\n  463  \\n  352  \\n  31.5%  \\n  343  \\n  335  \\n  2.4%  \\n \\n \\n  Mac Pro single external drive  \\n  463  \\n  352  \\n  31.5%  \\n  343  \\n  335  \\n  2.4%  \\n \\n  \\n \\n\\n\\n The good news is, the non-CFS case shows very little cost when we do \\nBG sync\'ing! \\n\\n The bad news is, the CFS case still shows a high cost.  However, by \\nnot sync\'ing the files that go into the CFS (and also not committing a \\nnew segments_N file until after the CFS is written) I expect that cost \\nto go way down. \\n\\n One caveat: I\'m using a 8 MB RAM buffer for all of these tests.  As \\nYonik pointed out, if you have a smaller buffer, or, you add just a \\nfew docs and then close your writer, the sync cost as a pctg of net \\nindexing time will be quite a bit higher.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12546039\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12546039&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12546039\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546039_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546039_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/07 22:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-27T22:56:33+0000\'\u003e27\\/Nov\\/07 22:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWoops, the last line in the table above is wrong (it\'s a copy of the line before it).  I\'ll re-run the test.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546039_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546039_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/07 22:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-27T22:56:33+0000\'\u003e27\\/Nov\\/07 22:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Woops, the last line in the table above is wrong (it\'s a copy of the line before it).  I\'ll re-run the test.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12546042\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12546042&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12546042\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546042_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546042_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/07 23:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-27T23:06:08+0000\'\u003e27\\/Nov\\/07 23:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eHow about if we don\'t sync every single commit point?\u003c\\/p\u003e\\n\\n\u003cp\u003eI think on a crash what\'s important when you come back up is 1) index\u003cbr\\/\u003e\\nis consistent and 2) you have not lost that many docs from your index.\u003cbr\\/\u003e\\nLosing the last N (up to mergeFactor) flushes might be acceptable?\u003c\\/p\u003e\\n\\n\u003cp\u003eEG we could force a full sync only when we commit the merge, before we\u003cbr\\/\u003e\\nremove the merged segments.  This would mean on a crash that you\'re\u003cbr\\/\u003e\\n\\\"guaranteed\\\" to have the last successfully committed &amp; sync\'d merge to\u003cbr\\/\u003e\\nfall back to, and possibly a newer commit point if the OS had sync\'d\u003cbr\\/\u003e\\nthose files on its own?\u003c\\/p\u003e\\n\\n\u003cp\u003eThat would be a big simplification because I think we could just do\u003cbr\\/\u003e\\nthe sync() in the foreground since ConcurrentMergeScheduler is already\u003cbr\\/\u003e\\nusing BG threads to do merges.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis would also mean we cannot delete the commit points that were not\u003cbr\\/\u003e\\nsync\'d.  So the first 10 flushes would result in 10 segments_N files.\u003cbr\\/\u003e\\nBut then when the merge of these segments completes, and the result is\u003cbr\\/\u003e\\nsync\'d, those files could all be deleted.\u003c\\/p\u003e\\n\\n\u003cp\u003ePlus we would have to fix retry logic on loading the segments file to\u003cbr\\/\u003e\\ntry more than just the 2 most recent commit points but that\'s a pretty\u003cbr\\/\u003e\\nminor change.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think it should mean better performance, because the longer you wait\u003cbr\\/\u003e\\nto call sync() presumably the more likely it is a no-op if the OS has\u003cbr\\/\u003e\\nalready sync\'d the file.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546042_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546042_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/07 23:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-27T23:06:08+0000\'\u003e27\\/Nov\\/07 23:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n How about if we don\'t sync every single commit point? \\n\\n I think on a crash what\'s important when you come back up is 1) index \\nis consistent and 2) you have not lost that many docs from your index. \\nLosing the last N (up to mergeFactor) flushes might be acceptable? \\n\\n EG we could force a full sync only when we commit the merge, before we \\nremove the merged segments.  This would mean on a crash that you\'re \\n\\\"guaranteed\\\" to have the last successfully committed &amp; sync\'d merge to \\nfall back to, and possibly a newer commit point if the OS had sync\'d \\nthose files on its own? \\n\\n That would be a big simplification because I think we could just do \\nthe sync() in the foreground since ConcurrentMergeScheduler is already \\nusing BG threads to do merges. \\n\\n This would also mean we cannot delete the commit points that were not \\nsync\'d.  So the first 10 flushes would result in 10 segments_N files. \\nBut then when the merge of these segments completes, and the result is \\nsync\'d, those files could all be deleted. \\n\\n Plus we would have to fix retry logic on loading the segments file to \\ntry more than just the 2 most recent commit points but that\'s a pretty \\nminor change. \\n\\n I think it should mean better performance, because the longer you wait \\nto call sync() presumably the more likely it is a no-op if the OS has \\nalready sync\'d the file.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12546051\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12546051&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12546051\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12546051_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546051_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/07 23:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-27T23:58:03+0000\'\u003e27\\/Nov\\/07 23:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; How about if we don\'t sync every single commit point?\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m confused.  The semantics of commit should be that all changes prior are made permanent, and no subsequent changes are permanent until the next commit.  So syncs, if any, should map 1:1 to commits, no?  Folks can make indexing faster by committing\\/syncing less often.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12546051_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546051_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/07 23:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-27T23:58:03+0000\'\u003e27\\/Nov\\/07 23:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; How about if we don\'t sync every single commit point? \\n\\n I\'m confused.  The semantics of commit should be that all changes prior are made permanent, and no subsequent changes are permanent until the next commit.  So syncs, if any, should map 1:1 to commits, no?  Folks can make indexing faster by committing\\/syncing less often.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12546277\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12546277&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12546277\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546277_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546277_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 15:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T15:39:17+0000\'\u003e28\\/Nov\\/07 15:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI\'m confused. The semantics of commit should be that all changes prior are made permanent, and no subsequent changes are permanent until the next commit. So syncs, if any, should map 1:1 to commits, no? Folks can make indexing faster by committing\\/syncing less often.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBut must every \\\"automatic buffer flush\\\" by IndexWriter really be a\u003cbr\\/\u003e\\n\\\"permanent commit\\\"?  I do agree that when you close an IndexWriter, we\u003cbr\\/\u003e\\nshould should do a \\\"permanent commit\\\" (and block until it\'s done).\u003c\\/p\u003e\\n\\n\u003cp\u003eEven if we use that policy, the BG sync thread can still fall behind\u003cbr\\/\u003e\\nsuch that the last few\\/many flushes are still in-process of being made\u003cbr\\/\u003e\\npermanent (eg I see this happening while a merge is running).  In fact\u003cbr\\/\u003e\\nI\'ll have to block further flushes if syncing falls \\\"too far\\\" behind,\u003cbr\\/\u003e\\nby some metric.  So, we already won\'t have any \\\"guarantee\\\" on when a\u003cbr\\/\u003e\\ngiven flush actually becomes permanent even if we adopt this policy.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think \\\"merge finished\\\" should be made a \\\"permanent commit\\\" because\u003cbr\\/\u003e\\notherwise we are tying up potentially alot of disk space,\u003cbr\\/\u003e\\ntemporarily.  But for a flush there\'s only a tiny amount of space (the\u003cbr\\/\u003e\\nold segments_N files) being tied up.\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe we could make some flushes permanent but not all, depending on\u003cbr\\/\u003e\\nhow far behind the sync thread is.  EG if you do a flush, but, the\u003cbr\\/\u003e\\nsync thread is still trying to make the last flush permanent, don\'t\u003cbr\\/\u003e\\nforce the new flush to be permanent?\u003c\\/p\u003e\\n\\n\u003cp\u003eIn general, I think the longer we can wait after flushing before\u003cbr\\/\u003e\\nforcing the OS to make those writes \\\"permanent\\\", the better the\u003cbr\\/\u003e\\nchances that the OS has in fact already sync\'d those files anyway, and\u003cbr\\/\u003e\\nso the sync cost should be lower.  So maybe we could make every flush\u003cbr\\/\u003e\\npermanent, but wait a little while before doing so?\u003c\\/p\u003e\\n\\n\u003cp\u003eRegardless of what policy we choose here (which commits must be made\u003cbr\\/\u003e\\n\\\"permanent\\\", and, when) I think the approach requires that\u003cbr\\/\u003e\\nIndexFileDeleter query the Directory so that it\'s only allowed to\u003cbr\\/\u003e\\ndelete older commit points once a newer commit point has successfully\u003cbr\\/\u003e\\nbecome permanent.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also worry about those applications that are accidentally flushing\u003cbr\\/\u003e\\ntoo often now.  Say your app now sets maxBufferedDocs=100.  Right now,\u003cbr\\/\u003e\\nthat gives you poor performance but not disastrous, but I fear if we\u003cbr\\/\u003e\\ndo the \\\"every commit is permanent\\\" policy then performance could\u003cbr\\/\u003e\\neasily become disastrous.  People who upgrade will suddenly get much\u003cbr\\/\u003e\\nworse performance.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546277_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546277_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 15:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T15:39:17+0000\'\u003e28\\/Nov\\/07 15:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I\'m confused. The semantics of commit should be that all changes prior are made permanent, and no subsequent changes are permanent until the next commit. So syncs, if any, should map 1:1 to commits, no? Folks can make indexing faster by committing\\/syncing less often.  \\n\\n But must every \\\"automatic buffer flush\\\" by IndexWriter really be a \\n\\\"permanent commit\\\"?  I do agree that when you close an IndexWriter, we \\nshould should do a \\\"permanent commit\\\" (and block until it\'s done). \\n\\n Even if we use that policy, the BG sync thread can still fall behind \\nsuch that the last few\\/many flushes are still in-process of being made \\npermanent (eg I see this happening while a merge is running).  In fact \\nI\'ll have to block further flushes if syncing falls \\\"too far\\\" behind, \\nby some metric.  So, we already won\'t have any \\\"guarantee\\\" on when a \\ngiven flush actually becomes permanent even if we adopt this policy. \\n\\n I think \\\"merge finished\\\" should be made a \\\"permanent commit\\\" because \\notherwise we are tying up potentially alot of disk space, \\ntemporarily.  But for a flush there\'s only a tiny amount of space (the \\nold segments_N files) being tied up. \\n\\n Maybe we could make some flushes permanent but not all, depending on \\nhow far behind the sync thread is.  EG if you do a flush, but, the \\nsync thread is still trying to make the last flush permanent, don\'t \\nforce the new flush to be permanent? \\n\\n In general, I think the longer we can wait after flushing before \\nforcing the OS to make those writes \\\"permanent\\\", the better the \\nchances that the OS has in fact already sync\'d those files anyway, and \\nso the sync cost should be lower.  So maybe we could make every flush \\npermanent, but wait a little while before doing so? \\n\\n Regardless of what policy we choose here (which commits must be made \\n\\\"permanent\\\", and, when) I think the approach requires that \\nIndexFileDeleter query the Directory so that it\'s only allowed to \\ndelete older commit points once a newer commit point has successfully \\nbecome permanent. \\n\\n I also worry about those applications that are accidentally flushing \\ntoo often now.  Say your app now sets maxBufferedDocs=100.  Right now, \\nthat gives you poor performance but not disastrous, but I fear if we \\ndo the \\\"every commit is permanent\\\" policy then performance could \\neasily become disastrous.  People who upgrade will suddenly get much \\nworse performance.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12546306\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12546306&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12546306\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12546306_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546306_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 17:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T17:20:20+0000\'\u003e28\\/Nov\\/07 17:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; But must every \\\"automatic buffer flush\\\" by IndexWriter really be a\u003cbr\\/\u003e\\n\\\"permanent commit\\\"?\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen autoCommit is true, then we should periodically commit automatically.  When autoCommit is false, then nothing should be committed until the IndexWriter is closed.  The ambiguous case is flush().  I think the reason for exposing flush() was to permit folks to commit without closing, so I think flush() should commit too, but we could add a separate commit() method that flushes and commits.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; People who upgrade will suddenly get much worse performance.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, that would be bad.  Perhaps the semantics of autoCommit=true should be altered so that it commits less than every flush.  Is that what you were proposing?  If so, then I think it\'s a good solution.  Prior to 2.2 the commit semantics were poorly defined.  Folks were encouraged to close() their IndexWriter to persist changes, and that\'s about all we said.  2.2\'s docs say that things are committed at every flush, but there was no sync, so I don\'t think changing this could break any applications.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I\'m +1 for changing autoCommit=true to sync less than every flush, e.g., only after merges.  I\'d also argue that we should be vague in the documentation about precisely when autoCommit=true commits.  If someone needs to know exactly when things are committed then they should be encouraged to explicitly flush(), not to rely on autoCommit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12546306_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546306_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 17:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T17:20:20+0000\'\u003e28\\/Nov\\/07 17:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; But must every \\\"automatic buffer flush\\\" by IndexWriter really be a \\n\\\"permanent commit\\\"? \\n\\n When autoCommit is true, then we should periodically commit automatically.  When autoCommit is false, then nothing should be committed until the IndexWriter is closed.  The ambiguous case is flush().  I think the reason for exposing flush() was to permit folks to commit without closing, so I think flush() should commit too, but we could add a separate commit() method that flushes and commits. \\n\\n &gt; People who upgrade will suddenly get much worse performance. \\n\\n Yes, that would be bad.  Perhaps the semantics of autoCommit=true should be altered so that it commits less than every flush.  Is that what you were proposing?  If so, then I think it\'s a good solution.  Prior to 2.2 the commit semantics were poorly defined.  Folks were encouraged to close() their IndexWriter to persist changes, and that\'s about all we said.  2.2\'s docs say that things are committed at every flush, but there was no sync, so I don\'t think changing this could break any applications. \\n\\n So I\'m +1 for changing autoCommit=true to sync less than every flush, e.g., only after merges.  I\'d also argue that we should be vague in the documentation about precisely when autoCommit=true commits.  If someone needs to know exactly when things are committed then they should be encouraged to explicitly flush(), not to rely on autoCommit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12546309\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12546309&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12546309\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546309_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546309_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 17:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T17:33:44+0000\'\u003e28\\/Nov\\/07 17:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eI modified the CFS sync case to NOT bother syncing the files that go\u003cbr\\/\u003e\\ninto the CFS.  I also turned off syncing of segments.gen.  I also\u003cbr\\/\u003e\\ntested on a Windows Server 2003 box.\u003c\\/p\u003e\\n\\n\u003cp\u003eNew patched attached (still a hack just to test performance!) and new\u003cbr\\/\u003e\\nresults.  All tests are with the \\\"sync every commit\\\" policy:\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003eIO System\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eCFS sync\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eCFS nosync\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eCFS % slower\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003enon-CFS sync\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003enon-CFS nosync\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003enon-CFS % slower\u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e2 drive RAID0 Windows 2003 Server R2 Enterprise x64\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e250\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e244\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e2.6%\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e241\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e241\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e0.1%\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eReiserFS 6-drive RAID5 array Linux (2.6.22.1)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e186\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e166\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.9%\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e145\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e142\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e2.0%\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eEXT3 single internal drive Linux (2.6.22.1)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e160\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e158\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e0.9%\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e142\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e135\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.8%\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4 drive RAID0 array Mac Pro (10.4 Tiger)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e152\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e155\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e-2.4%\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e149\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e147\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1.3%\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eWin XP Pro laptop, single drive\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e408\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e398\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e2.6%\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e343\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e346\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e-1.1%\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eMac Pro single external drive\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e211\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e209\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1.0%\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e167\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e149\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e12.4%\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546309_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546309_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 17:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T17:33:44+0000\'\u003e28\\/Nov\\/07 17:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n I modified the CFS sync case to NOT bother syncing the files that go \\ninto the CFS.  I also turned off syncing of segments.gen.  I also \\ntested on a Windows Server 2003 box. \\n\\n New patched attached (still a hack just to test performance!) and new \\nresults.  All tests are with the \\\"sync every commit\\\" policy: \\n\\n \\n  \\n \\n IO System \\n CFS sync \\n CFS nosync \\n CFS % slower \\n non-CFS sync \\n non-CFS nosync \\n non-CFS % slower \\n \\n \\n 2 drive RAID0 Windows 2003 Server R2 Enterprise x64 \\n 250 \\n 244 \\n 2.6% \\n 241 \\n 241 \\n 0.1% \\n \\n \\n ReiserFS 6-drive RAID5 array Linux (2.6.22.1) \\n 186 \\n 166 \\n 11.9% \\n 145 \\n 142 \\n 2.0% \\n \\n \\n EXT3 single internal drive Linux (2.6.22.1) \\n 160 \\n 158 \\n 0.9% \\n 142 \\n 135 \\n 4.8% \\n \\n \\n 4 drive RAID0 array Mac Pro (10.4 Tiger) \\n 152 \\n 155 \\n -2.4% \\n 149 \\n 147 \\n 1.3% \\n \\n \\n Win XP Pro laptop, single drive \\n 408 \\n 398 \\n 2.6% \\n 343 \\n 346 \\n -1.1% \\n \\n \\n Mac Pro single external drive \\n 211 \\n 209 \\n 1.0% \\n 167 \\n 149 \\n 12.4% \\n \\n  \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12546312\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12546312&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12546312\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546312_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546312_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 17:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T17:46:08+0000\'\u003e28\\/Nov\\/07 17:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eWhen autoCommit is true, then we should periodically commit automatically. When autoCommit is false, then nothing should be committed until the IndexWriter is closed. The ambiguous case is flush(). I think the reason for exposing flush() was to permit folks to commit without closing, so I think flush() should commit too, but we could add a separate commit() method that flushes and commits.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think deprecating flush(), renaming it to commit(), and clarifying\u003cbr\\/\u003e\\nthe semantics to mean that commit() flushes pending docs\\/deletes,\u003cbr\\/\u003e\\ncommits a new segments_N, syncs all files referenced by this commit,\u003cbr\\/\u003e\\nand blocks until the sync is complete, would make sense?  And,\u003cbr\\/\u003e\\ncommit() would in fact commit even when autoCommit is false (flush()\u003cbr\\/\u003e\\ndoesn\'t commit now when autoCommit=false, which is indeed confusing).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003ePerhaps the semantics of autoCommit=true should be altered so that it commits less than every flush. Is that what you were proposing? If so, then I think it\'s a good solution. Prior to 2.2 the commit semantics were poorly defined. Folks were encouraged to close() their IndexWriter to persist changes, and that\'s about all we said. 2.2\'s docs say that things are committed at every flush, but there was no sync, so I don\'t think changing this could break any applications.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I\'m +1 for changing autoCommit=true to sync less than every flush, e.g., only after merges. I\'d also argue that we should be vague in the documentation about precisely when autoCommit=true commits. If someone needs to know exactly when things are committed then they should be encouraged to explicitly flush(), not to rely on autoCommit.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK, I will test the \\\"sync only when committing a merge\\\" approach for\u003cbr\\/\u003e\\nperformance.  Hopefully a foreground sync() is fine given that with\u003cbr\\/\u003e\\nConcurrentMergePolicy that\'s already in a background thread.  This\u003cbr\\/\u003e\\nwould be a nice simplification.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd I agree we should be vague about, and users should never rely on,\u003cbr\\/\u003e\\nprecisely when Lucene has really committed (sync\'d) the changes to\u003cbr\\/\u003e\\ndisk.  I\'ll fix the javadocs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12546312_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546312_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 17:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T17:46:08+0000\'\u003e28\\/Nov\\/07 17:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n When autoCommit is true, then we should periodically commit automatically. When autoCommit is false, then nothing should be committed until the IndexWriter is closed. The ambiguous case is flush(). I think the reason for exposing flush() was to permit folks to commit without closing, so I think flush() should commit too, but we could add a separate commit() method that flushes and commits.  \\n\\n I think deprecating flush(), renaming it to commit(), and clarifying \\nthe semantics to mean that commit() flushes pending docs\\/deletes, \\ncommits a new segments_N, syncs all files referenced by this commit, \\nand blocks until the sync is complete, would make sense?  And, \\ncommit() would in fact commit even when autoCommit is false (flush() \\ndoesn\'t commit now when autoCommit=false, which is indeed confusing). \\n\\n \\n Perhaps the semantics of autoCommit=true should be altered so that it commits less than every flush. Is that what you were proposing? If so, then I think it\'s a good solution. Prior to 2.2 the commit semantics were poorly defined. Folks were encouraged to close() their IndexWriter to persist changes, and that\'s about all we said. 2.2\'s docs say that things are committed at every flush, but there was no sync, so I don\'t think changing this could break any applications. \\n\\n So I\'m +1 for changing autoCommit=true to sync less than every flush, e.g., only after merges. I\'d also argue that we should be vague in the documentation about precisely when autoCommit=true commits. If someone needs to know exactly when things are committed then they should be encouraged to explicitly flush(), not to rely on autoCommit.  \\n\\n OK, I will test the \\\"sync only when committing a merge\\\" approach for \\nperformance.  Hopefully a foreground sync() is fine given that with \\nConcurrentMergePolicy that\'s already in a background thread.  This \\nwould be a nice simplification. \\n\\n And I agree we should be vague about, and users should never rely on, \\nprecisely when Lucene has really committed (sync\'d) the changes to \\ndisk.  I\'ll fix the javadocs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12546352\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12546352&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12546352\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12546352_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546352_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 18:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T18:55:17+0000\'\u003e28\\/Nov\\/07 18:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; I think deprecating flush(), renaming it to commit()\u003c\\/p\u003e\\n\\n\u003cp\u003e+1  That\'s clearer, since flushes are internal optimizations, while commits are important events to clients.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12546352_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12546352_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Nov\\/07 18:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-28T18:55:17+0000\'\u003e28\\/Nov\\/07 18:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; I think deprecating flush(), renaming it to commit() \\n\\n +1  That\'s clearer, since flushes are internal optimizations, while commits are important events to clients.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12547122\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12547122&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12547122\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12547122_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547122_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/07 13:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-30T13:10:40+0000\'\u003e30\\/Nov\\/07 13:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eYou could just queue the file names for sync, close them, and then have the background thread open, sync and close them. The close could trigger the OS to sync things faster in the background. Then the open\\/sync\\/close could mostly be a no-op. Might be worth a try.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI am taking this approach now, but one nagging question I have is: do\u003cbr\\/\u003e\\nwe know with some certainty that re-opening a file and then sync\'ing\u003cbr\\/\u003e\\nit in fact syncs all writes that were ever done to this file in this\u003cbr\\/\u003e\\nJVM, even with previously opened and now closed descriptors?  VS, eg,\u003cbr\\/\u003e\\nonly sync\'ing any new writes done with that particular descriptor?\u003c\\/p\u003e\\n\\n\u003cp\u003eIn code:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003efile = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RandomAccess(path, \u003cspan class=\\\"code-quote\\\"\u003e\\\"rw\\\"\u003c\\/span\u003e);\\n&lt;\u003cspan class=\\\"code-keyword\\\"\u003edo\u003c\\/span\u003e many writes to file&gt;\\nfile.close();\\n\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RandomAccess(path, \u003cspan class=\\\"code-quote\\\"\u003e\\\"rw\\\"\u003c\\/span\u003e).getFD().sync();\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\t\\n\\n\u003cp\u003eAre we pretty sure that all of the \\\"many writes\\\" will in fact be\u003cbr\\/\u003e\\nsync\'d by that sync call, on all OSs?\u003c\\/p\u003e\\n\\n\u003cp\u003eI haven\'t been able to find convincing evidence one way or another.  I\u003cbr\\/\u003e\\ndid run a timing test comparing overall time if you sync with the same\u003cbr\\/\u003e\\ndescriptor you used for writing vs closing it, opening a new one, and\u003cbr\\/\u003e\\nsyncing with that one, and on Linux at least it seems both approaches\u003cbr\\/\u003e\\nseem to be syncing because the total elapsed time is roughly the\u003cbr\\/\u003e\\nsame.\u003c\\/p\u003e\\n\\n\u003cp\u003eRobert do you know?\u003c\\/p\u003e\\n\\n\u003cp\u003eI sure hope the answer is yes ... because if not, the alternative is\u003cbr\\/\u003e\\nwe must sync() before closing the original descriptor, which makes\u003cbr\\/\u003e\\nthings less flexible because eg we cannot cleanly implement\u003cbr\\/\u003e\\nIndexWriter.commit().\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12547122_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547122_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/07 13:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-30T13:10:40+0000\'\u003e30\\/Nov\\/07 13:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n You could just queue the file names for sync, close them, and then have the background thread open, sync and close them. The close could trigger the OS to sync things faster in the background. Then the open\\/sync\\/close could mostly be a no-op. Might be worth a try.  \\n\\n I am taking this approach now, but one nagging question I have is: do \\nwe know with some certainty that re-opening a file and then sync\'ing \\nit in fact syncs all writes that were ever done to this file in this \\nJVM, even with previously opened and now closed descriptors?  VS, eg, \\nonly sync\'ing any new writes done with that particular descriptor? \\n\\n In code: \\n\\n  \\n file =  new  RandomAccess(path,  \\\"rw\\\" );\\n&lt; do  many writes to file&gt;\\nfile.close();\\n new  RandomAccess(path,  \\\"rw\\\" ).getFD().sync();\\n \\n  \\t\\n\\n Are we pretty sure that all of the \\\"many writes\\\" will in fact be \\nsync\'d by that sync call, on all OSs? \\n\\n I haven\'t been able to find convincing evidence one way or another.  I \\ndid run a timing test comparing overall time if you sync with the same \\ndescriptor you used for writing vs closing it, opening a new one, and \\nsyncing with that one, and on Linux at least it seems both approaches \\nseem to be syncing because the total elapsed time is roughly the \\nsame. \\n\\n Robert do you know? \\n\\n I sure hope the answer is yes ... because if not, the alternative is \\nwe must sync() before closing the original descriptor, which makes \\nthings less flexible because eg we cannot cleanly implement \\nIndexWriter.commit().              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12547168\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12547168&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12547168\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12547168_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547168_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/07 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-30T15:00:40+0000\'\u003e30\\/Nov\\/07 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnother nuance here is ... say we do a \\\"soft commit\\\" (write a new\u003cbr\\/\u003e\\nsegment &amp; segments_N but do not sync the files), and, the machine\u003cbr\\/\u003e\\ncrashes.  This is fine because there will always be an earlier commit\u003cbr\\/\u003e\\npoint (segments_M) that was a \\\"hard commit\\\" (sync was done).\u003c\\/p\u003e\\n\\n\u003cp\u003eThen, machine comes back up and we open a reader.  The reader sees\u003cbr\\/\u003e\\nboth segments_M (the hard commit) and segments_N (the soft commit) and\u003cbr\\/\u003e\\nchooses segments_N because it\'s more recent.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe have retry logic in SegmentInfos to fallback to segments_M if we\u003cbr\\/\u003e\\nhit an IOException on opening the index described by segments_N.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, the problem is: the extent of the \\\"corruption\\\" caused by the\u003cbr\\/\u003e\\ncrash could be somewhat subtle.  EG a given file might be the right\u003cbr\\/\u003e\\nlength, but, filled w\\/ zeroes.  This is a problem because we may not\u003cbr\\/\u003e\\nthen hit an IOException while opening the reader, but only later hit\u003cbr\\/\u003e\\nsome exception while searching.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this means when we do a \\\"soft commit\\\" we should not in fact\u003cbr\\/\u003e\\nwrite a new segments_N file (as we do today).  When we do a \\\"hard\u003cbr\\/\u003e\\ncommit\\\" we should first sync all files except the new segments_N file,\u003cbr\\/\u003e\\nthen write the segments_N file, then sync it.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe thing is, while we have been (and want to continue to be) vague\u003cbr\\/\u003e\\nabout exactly when a \\\"commit\\\" takes place as you add docs to\u003cbr\\/\u003e\\nIndexWriter, users have presumably gotten used to every flush (when\u003cbr\\/\u003e\\nautoCommit=true) committing a new segments_N file that an IndexReader\u003cbr\\/\u003e\\ncan then see.  So, this change (do not write segments_N file except\u003cbr\\/\u003e\\nfor a hard commit) will break that behavior.  Maybe, with the addition\u003cbr\\/\u003e\\nof the explicit commit() method, this is OK?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12547168_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547168_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/07 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-30T15:00:40+0000\'\u003e30\\/Nov\\/07 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Another nuance here is ... say we do a \\\"soft commit\\\" (write a new \\nsegment &amp; segments_N but do not sync the files), and, the machine \\ncrashes.  This is fine because there will always be an earlier commit \\npoint (segments_M) that was a \\\"hard commit\\\" (sync was done). \\n\\n Then, machine comes back up and we open a reader.  The reader sees \\nboth segments_M (the hard commit) and segments_N (the soft commit) and \\nchooses segments_N because it\'s more recent. \\n\\n We have retry logic in SegmentInfos to fallback to segments_M if we \\nhit an IOException on opening the index described by segments_N. \\n\\n But, the problem is: the extent of the \\\"corruption\\\" caused by the \\ncrash could be somewhat subtle.  EG a given file might be the right \\nlength, but, filled w\\/ zeroes.  This is a problem because we may not \\nthen hit an IOException while opening the reader, but only later hit \\nsome exception while searching. \\n\\n I think this means when we do a \\\"soft commit\\\" we should not in fact \\nwrite a new segments_N file (as we do today).  When we do a \\\"hard \\ncommit\\\" we should first sync all files except the new segments_N file, \\nthen write the segments_N file, then sync it. \\n\\n The thing is, while we have been (and want to continue to be) vague \\nabout exactly when a \\\"commit\\\" takes place as you add docs to \\nIndexWriter, users have presumably gotten used to every flush (when \\nautoCommit=true) committing a new segments_N file that an IndexReader \\ncan then see.  So, this change (do not write segments_N file except \\nfor a hard commit) will break that behavior.  Maybe, with the addition \\nof the explicit commit() method, this is OK?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12547217\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12547217&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12547217\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12547217_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547217_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/07 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-30T17:34:52+0000\'\u003e30\\/Nov\\/07 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFrom java-dev, Robert Engels wrote:\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eMy reading of the Unix specification shows it should work (the _commit under Windows is less clear, and since Windows is not inode based, there may be different issues).\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/www.opengroup.org\\/onlinepubs\\/007908799\\/xsh\\/fsync.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.opengroup.org\\/onlinepubs\\/007908799\\/xsh\\/fsync.html\u003c\\/a\u003e\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK thanks Robert.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think very likely this approach (let\'s call it \\\"sync after close\\\")\u003cbr\\/\u003e\\nwill work.  The _commit docs (for WIN32) also seems to indicate that\u003cbr\\/\u003e\\nthe file referenced by the descriptor is fully flushed (as we want):\u003c\\/p\u003e\\n\\n\u003cp\u003e  \u003ca href=\\\"http:\\/\\/msdn2.microsoft.com\\/en-us\\/library\\/17618685\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/msdn2.microsoft.com\\/en-us\\/library\\/17618685\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso at least PostgreSQL and Berkeley DB \\\"trust\\\" _commit as the\u003cbr\\/\u003e\\nequivalent of fsync (though I have no idea if they use it the same way\u003cbr\\/\u003e\\nwe want to).\u003c\\/p\u003e\\n\\n\u003cp\u003eThough ... I am also a bit concerned about opening files for writing\u003cbr\\/\u003e\\nthat we had already previously closed.  It arguably makes Lucene \\\"not\u003cbr\\/\u003e\\nquite\\\" write-once.  And, we may need a retry loop on syncing because\u003cbr\\/\u003e\\non Windows, various tools might wake up and peek into a file right\u003cbr\\/\u003e\\nafter we close them, possibly interfering w\\/ our reopening\\/syncing.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the alternative (\\\"sync before close\\\") is something like:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAdd a new method IndexOutput.close(boolean doSync)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWhen a merge finishes, it must close all of its files with\u003cbr\\/\u003e\\n    doSync=true; and write the new segments_N with doSync=true.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eTo implement commit() ... I think we\'d have to force a merge of\u003cbr\\/\u003e\\n    all written segments that were not sync\'d.  And on closing the\u003cbr\\/\u003e\\n    writer we\'d call commit().  This is obviously non-ideal because\u003cbr\\/\u003e\\n    you can get very different sized level 1 segments out.  Although\u003cbr\\/\u003e\\n    the cost would be contained since it\'s only up to mergeFactor\u003cbr\\/\u003e\\n    level 0 segments that we will merge.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eOK ... I\'m leaning towards sticking with \\\"sync after close\\\", so I\'ll\u003cbr\\/\u003e\\nkeep coding up this approach for now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12547217_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547217_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/07 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-30T17:34:52+0000\'\u003e30\\/Nov\\/07 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    From java-dev, Robert Engels wrote: \\n\\n \\n My reading of the Unix specification shows it should work (the _commit under Windows is less clear, and since Windows is not inode based, there may be different issues). \\n\\n  http:\\/\\/www.opengroup.org\\/onlinepubs\\/007908799\\/xsh\\/fsync.html   \\n\\n OK thanks Robert. \\n\\n I think very likely this approach (let\'s call it \\\"sync after close\\\") \\nwill work.  The _commit docs (for WIN32) also seems to indicate that \\nthe file referenced by the descriptor is fully flushed (as we want): \\n\\n    http:\\/\\/msdn2.microsoft.com\\/en-us\\/library\\/17618685  \\n\\n Also at least PostgreSQL and Berkeley DB \\\"trust\\\" _commit as the \\nequivalent of fsync (though I have no idea if they use it the same way \\nwe want to). \\n\\n Though ... I am also a bit concerned about opening files for writing \\nthat we had already previously closed.  It arguably makes Lucene \\\"not \\nquite\\\" write-once.  And, we may need a retry loop on syncing because \\non Windows, various tools might wake up and peek into a file right \\nafter we close them, possibly interfering w\\/ our reopening\\/syncing. \\n\\n I think the alternative (\\\"sync before close\\\") is something like: \\n\\n \\n\\t Add a new method IndexOutput.close(boolean doSync) \\n \\n\\n\\n \\n\\t When a merge finishes, it must close all of its files with \\n    doSync=true; and write the new segments_N with doSync=true. \\n \\n\\n\\n \\n\\t To implement commit() ... I think we\'d have to force a merge of \\n    all written segments that were not sync\'d.  And on closing the \\n    writer we\'d call commit().  This is obviously non-ideal because \\n    you can get very different sized level 1 segments out.  Although \\n    the cost would be contained since it\'s only up to mergeFactor \\n    level 0 segments that we will merge. \\n \\n\\n\\n OK ... I\'m leaning towards sticking with \\\"sync after close\\\", so I\'ll \\nkeep coding up this approach for now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12547351\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12547351&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12547351\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12547351_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547351_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Dec\\/07 00:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-01T00:28:00+0000\'\u003e01\\/Dec\\/07 00:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; I think this means when we do a \\\"soft commit\\\" we should not in fact\u003cbr\\/\u003e\\n&gt; write a new segments_N file (as we do today).\u003c\\/p\u003e\\n\\n\u003cp\u003e+1  As long as we commit periodically when autoCommit=true I don\'t think we\'re breaking any previously advertised contract.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12547351_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12547351_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Dec\\/07 00:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-01T00:28:00+0000\'\u003e01\\/Dec\\/07 00:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; I think this means when we do a \\\"soft commit\\\" we should not in fact \\n&gt; write a new segments_N file (as we do today). \\n\\n +1  As long as we commit periodically when autoCommit=true I don\'t think we\'re breaking any previously advertised contract.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12549104\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12549104&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12549104\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12549104_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12549104_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 17:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T17:33:50+0000\'\u003e06\\/Dec\\/07 17:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve moved this issue to 2.4.  I think it\'s too risky to rush it in\u003cbr\\/\u003e\\njust before 2.3 is released vs committing just after 2.3 and\u003cbr\\/\u003e\\ngiving it more time on the trunk.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, I think for 2.3 we should revert the optional \\\"doSync\\\" argument\u003cbr\\/\u003e\\nto FSDirectory: I believe the performance impact of syncing is low enough\u003cbr\\/\u003e\\nwith the approach we\'re now taking, so I don\'t think we should make it\u003cbr\\/\u003e\\nso trivial to turn it off.  I\'ve added a sync() method to Directory,\u003cbr\\/\u003e\\nso if someone really wants to prevent syncing they will be able to\u003cbr\\/\u003e\\nsubclass FSDirectory and make that method a noop.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12549104_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12549104_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 17:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T17:33:50+0000\'\u003e06\\/Dec\\/07 17:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve moved this issue to 2.4.  I think it\'s too risky to rush it in \\njust before 2.3 is released vs committing just after 2.3 and \\ngiving it more time on the trunk. \\n\\n But, I think for 2.3 we should revert the optional \\\"doSync\\\" argument \\nto FSDirectory: I believe the performance impact of syncing is low enough \\nwith the approach we\'re now taking, so I don\'t think we should make it \\nso trivial to turn it off.  I\'ve added a sync() method to Directory, \\nso if someone really wants to prevent syncing they will be able to \\nsubclass FSDirectory and make that method a noop.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12549203\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12549203&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12549203\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12549203_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12549203_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 21:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T21:54:08+0000\'\u003e06\\/Dec\\/07 21:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eThough ... I am also a bit concerned about opening files for writing\u003cbr\\/\u003e\\nthat we had already previously closed. It arguably makes Lucene \\\"not\u003cbr\\/\u003e\\nquite\\\" write-once. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI think this would work too?\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eFileInputStream fis = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e FileInputStream(path);\\nfis.getFD().sync();\\nfis.close();\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12549203_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12549203_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 21:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T21:54:08+0000\'\u003e06\\/Dec\\/07 21:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Though ... I am also a bit concerned about opening files for writing \\nthat we had already previously closed. It arguably makes Lucene \\\"not \\nquite\\\" write-once.   \\n I think this would work too? \\n  \\n FileInputStream fis =  new  FileInputStream(path);\\nfis.getFD().sync();\\nfis.close();\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12549213\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12549213&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12549213\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12549213_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12549213_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 22:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T22:21:16+0000\'\u003e06\\/Dec\\/07 22:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI think this would work too?\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eFileInputStream fis = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e FileInputStream(path);\\nfis.getFD().sync();\\nfis.close();\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis was suggested &amp; debated on the java-dev list. But, the man page\u003cbr\\/\u003e\\nfor \\\"fsync\\\" on Linux lists this as one of the errors:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eERRORS\\n       EBADF  fd is not a valid file descriptor open \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e writing.\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eAnd Yonik found at least one JVM implementation (I think Harmony) that\u003cbr\\/\u003e\\nsimply skipped if the descriptor was not open for write.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think we\'re walking on thin ice if we do that...\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12549213_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12549213_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 22:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T22:21:16+0000\'\u003e06\\/Dec\\/07 22:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I think this would work too? \\n  \\n FileInputStream fis =  new  FileInputStream(path);\\nfis.getFD().sync();\\nfis.close();\\n \\n   \\n\\n This was suggested &amp; debated on the java-dev list. But, the man page \\nfor \\\"fsync\\\" on Linux lists this as one of the errors: \\n\\n  \\n ERRORS\\n       EBADF  fd is not a valid file descriptor open  for  writing.\\n \\n  \\n\\n And Yonik found at least one JVM implementation (I think Harmony) that \\nsimply skipped if the descriptor was not open for write. \\n\\n I think we\'re walking on thin ice if we do that... \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12549221\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12549221&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12549221\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12549221_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12549221_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 22:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T22:42:24+0000\'\u003e06\\/Dec\\/07 22:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI think we\'re walking on thin ice if we do that...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eOh, I skimmed too fast that part of the discussion in the \u003cbr\\/\u003e\\ndev list.  I agree with \\\"thin ice\\\" now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12549221_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12549221_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/07 22:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-06T22:42:24+0000\'\u003e06\\/Dec\\/07 22:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I think we\'re walking on thin ice if we do that...  \\n Oh, I skimmed too fast that part of the discussion in the  \\ndev list.  I agree with \\\"thin ice\\\" now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12550704\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12550704&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12550704\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12550704_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12550704_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/07 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-11T20:20:57+0000\'\u003e11\\/Dec\\/07 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eInitial patch attached:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eCreated new commit() method; deprecated public flush() method\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eChanged IndexWriter to not write segments_N when flushing, only\u003cbr\\/\u003e\\n    when syncing (added new private sync() for this).  The current\u003cbr\\/\u003e\\n    \\\"policy\\\" is to sync only after merges are committed.  When\u003cbr\\/\u003e\\n    autoCommit=false we do not sync until close() or commit() is\u003cbr\\/\u003e\\n    called\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAdded MockRAMDirectory.crash() to simulate a machine crash.  It\u003cbr\\/\u003e\\n    keeps track of un-synced files, and then in crash() it goes and\u003cbr\\/\u003e\\n    corrupts any unsynced files rather aggressively.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAdded a new unit test, TestCrash, to crash the MockRAMDirectory at\u003cbr\\/\u003e\\n    various interesting times &amp; make sure we can still load the\u003cbr\\/\u003e\\n    resulting index.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAdded new Directory.sync() method.  In FSDirectory.sync, if I hit\u003cbr\\/\u003e\\n    an IOException when opening or sync\'ing, I retry (currently after\u003cbr\\/\u003e\\n    waiting 5 msec, and retrying up to 5 times).  If it still fails\u003cbr\\/\u003e\\n    after that, the original exception is thrown and the new\u003cbr\\/\u003e\\n    segments_N will not be written (and, the previous commit will also\u003cbr\\/\u003e\\n    not be deleted).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAll tests now pass, but there is still alot to do, eg at least:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eJavadocs\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eRefactor syncing code so DirectoryIndexReader.doCommit can use it\u003cbr\\/\u003e\\n    as well.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eChange format of segments_N to include a hash of its contents, at\u003cbr\\/\u003e\\n    the end.  I think this is now necessary in case we crash after\u003cbr\\/\u003e\\n    writing segments_N but before we can sync it, to ensure that\u003cbr\\/\u003e\\n    whoever next opens the reader can detect corruption in this\u003cbr\\/\u003e\\n    segments_N file.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12550704_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12550704_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/07 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-12-11T20:20:57+0000\'\u003e11\\/Dec\\/07 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Initial patch attached: \\n\\n \\n\\t Created new commit() method; deprecated public flush() method \\n \\n\\n\\n \\n\\t Changed IndexWriter to not write segments_N when flushing, only \\n    when syncing (added new private sync() for this).  The current \\n    \\\"policy\\\" is to sync only after merges are committed.  When \\n    autoCommit=false we do not sync until close() or commit() is \\n    called \\n \\n\\n\\n \\n\\t Added MockRAMDirectory.crash() to simulate a machine crash.  It \\n    keeps track of un-synced files, and then in crash() it goes and \\n    corrupts any unsynced files rather aggressively. \\n \\n\\n\\n \\n\\t Added a new unit test, TestCrash, to crash the MockRAMDirectory at \\n    various interesting times &amp; make sure we can still load the \\n    resulting index. \\n \\n\\n\\n \\n\\t Added new Directory.sync() method.  In FSDirectory.sync, if I hit \\n    an IOException when opening or sync\'ing, I retry (currently after \\n    waiting 5 msec, and retrying up to 5 times).  If it still fails \\n    after that, the original exception is thrown and the new \\n    segments_N will not be written (and, the previous commit will also \\n    not be deleted). \\n \\n\\n\\n All tests now pass, but there is still alot to do, eg at least: \\n\\n \\n\\t Javadocs \\n \\n\\n\\n \\n\\t Refactor syncing code so DirectoryIndexReader.doCommit can use it \\n    as well. \\n \\n\\n\\n \\n\\t Change format of segments_N to include a hash of its contents, at \\n    the end.  I think this is now necessary in case we crash after \\n    writing segments_N but before we can sync it, to ensure that \\n    whoever next opens the reader can detect corruption in this \\n    segments_N file. \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12560789\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12560789&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12560789\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"zhanghuangzhu\\\" id=\\\"commentauthor_12560789_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=zhanghuangzhu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"zhanghuangzhu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Zhang\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12560789_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/08 09:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-01-20T09:56:39+0000\'\u003e20\\/Jan\\/08 09:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi, Any progress on this issue? \u003c\\/p\u003e\\n\\n\u003cp\u003eI found sync call was removed from the source code. Is there an alternative to solve this problem? Thanks a lot!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"zhanghuangzhu\\\" id=\\\"commentauthor_12560789_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=zhanghuangzhu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"zhanghuangzhu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Zhang\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12560789_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/08 09:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-01-20T09:56:39+0000\'\u003e20\\/Jan\\/08 09:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, Any progress on this issue?  \\n\\n I found sync call was removed from the source code. Is there an alternative to solve this problem? Thanks a lot!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12560790\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12560790&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12560790\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12560790_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12560790_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/08 10:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-01-20T10:27:23+0000\'\u003e20\\/Jan\\/08 10:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is still in progress.  It\'s clearly a serious bug since it\'s something out of your control that can easily cause index corruption.\u003c\\/p\u003e\\n\\n\u003cp\u003esync was removed because the simple approach is far too costly on some IO systems.  The new approach (sync only on committing a merge) has more reasonable performance, but is not quite done yet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12560790_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12560790_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/08 10:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-01-20T10:27:23+0000\'\u003e20\\/Jan\\/08 10:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is still in progress.  It\'s clearly a serious bug since it\'s something out of your control that can easily cause index corruption. \\n\\n sync was removed because the simple approach is far too costly on some IO systems.  The new approach (sync only on committing a merge) has more reasonable performance, but is not quite done yet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12565698\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12565698&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12565698\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12565698_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565698_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 10:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T10:52:57+0000\'\u003e05\\/Feb\\/08 10:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew rev of this patch.  All tests pass.  I think it\'s ready to\u003cbr\\/\u003e\\ncommit, but I\'ll wait a few days for comments.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch has a small change to the segments_N file: it adds a\u003cbr\\/\u003e\\nchecksum to the end.  I added ChecksumIndexInput\\/Output that wrap an\u003cbr\\/\u003e\\nexisting IndexInput\\/Output for this.  This is used to verify the file\u003cbr\\/\u003e\\nis \\\"intact\\\" before trusting its contents when opening the index.  We\u003cbr\\/\u003e\\nneed this to guard against the machine crashing after we\'ve written\u003cbr\\/\u003e\\nsegments_N and before we\'ve succeeded in syncing it.\u003c\\/p\u003e\\n\\n\u003cp\u003eUnfortunately, in testing performance, I still see a sizable (~30-50%)\u003cbr\\/\u003e\\nperformance hit to indexing throughput, on windows computers (XP Pro\u003cbr\\/\u003e\\nlaptop &amp; Win 2003 Server R64 computer).  It seems that calling sync\u003cbr\\/\u003e\\nwas causing IO in other threads (ie flushing a new segment) to\u003cbr\\/\u003e\\ndrasically slow down.  Note that this is only when autoCommit=true; if\u003cbr\\/\u003e\\nit\'s false then performance is only slightly worse (because only on\u003cbr\\/\u003e\\nclosing the writer do we sync)\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I tried sleeping, after writing and before syncing.  I sleep based\u003cbr\\/\u003e\\non number of bytes written, for up to 10 seconds, and amazingly, this\u003cbr\\/\u003e\\ngreadly reduces the performance loss on the windows computers, and\u003cbr\\/\u003e\\ndoesn\'t hurt performance on Linux\\/OS X computers.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this must be because calling sync immediately forces the OS to\u003cbr\\/\u003e\\nwrite dirty buffers to disk \\\"in a rush\\\" (severely impacting IO writes\u003cbr\\/\u003e\\nfrom other threads), whereas if you wait first, you let the OS\u003cbr\\/\u003e\\nschedule those writes on its own, at good times (maybe when IO system\u003cbr\\/\u003e\\nis \\\"relatively\\\" idle).\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s disappointing to have to \\\"game\\\" the OS to gain back this\u003cbr\\/\u003e\\nperformance.  I wish Java had a \\\"waitUntilSync\'d\\\" to do the same\u003cbr\\/\u003e\\nthings as fsync, but without \\\"rushing\\\" the OS.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn Linux 2.6.22 on a RAID5 array I still see a net performance cost of\u003cbr\\/\u003e\\n~12%, sleeping or no sleeping.  On Mac OS X it\'s ~3% loss.\u003c\\/p\u003e\\n\\n\u003cp\u003eOther fixes:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eDirectoryIndexReader\'s doCommit now also syncs\u003c\\/li\u003e\\n\\t\u003cli\u003eImproved logic on when we must sync-before-CFS: it\'s not necessary\u003cbr\\/\u003e\\n    if the just-merged segments are not referenced by the last commit\u003cbr\\/\u003e\\n    point (ie if they were all flushed during this writer session)\u003c\\/li\u003e\\n\\t\u003cli\u003eCreated SegmentInfos.commit() method, which writes and then syncs\u003cbr\\/\u003e\\n    the next segments_N file\u003c\\/li\u003e\\n\\t\u003cli\u003eSimplified sync() logic now that merge threads are stopped before\u003cbr\\/\u003e\\n    writer is closed\u003c\\/li\u003e\\n\\t\u003cli\u003eChanged CMS.newMergeThread to name its threads\u003c\\/li\u003e\\n\\t\u003cli\u003eMore test cases\u003c\\/li\u003e\\n\\t\u003cli\u003eVarious other small fixes\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eHere are test details.  I index first 200K Wikipedia docs with this\u003cbr\\/\u003e\\nalg:\u003c\\/p\u003e\\n\\n\u003cp\u003e  analyzer=org.apache.lucene.analysis.standard.StandardAnalyzer\u003cbr\\/\u003e\\n  doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker\u003cbr\\/\u003e\\n  docs.file=\\/Volumes\\/External\\/lucene\\/wiki.txt\u003cbr\\/\u003e\\n  doc.stored = true\u003cbr\\/\u003e\\n  doc.term.vector = true\u003cbr\\/\u003e\\n  doc.term.vector.offsets = true\u003cbr\\/\u003e\\n  doc.term.vector.positions = true\u003c\\/p\u003e\\n\\n\u003cp\u003e  doc.maker.forever = false\u003cbr\\/\u003e\\n  directory=FSDirectory\u003c\\/p\u003e\\n\\n\u003cp\u003e  { \\\"BuildIndex\\\"\u003cbr\\/\u003e\\n    CreateIndex\u003c\\/p\u003e\\n    { \\\"AddDocs\\\" AddDoc &gt; : 200000\\n    CloseIndex\\n  }\\n\\n\u003cp\u003e  RepSumByPref BuildIndex\u003c\\/p\u003e\\n\\n\u003cp\u003eWin2003 R64, JVM 1.6.0_03\u003cbr\\/\u003e\\n  trunk: 523 sec\u003cbr\\/\u003e\\n  patch: 547 sec (5% slower)\u003c\\/p\u003e\\n\\n\u003cp\u003eWin XP Pro, laptop hard drive, JVM 1.4.2_15-b02\u003cbr\\/\u003e\\n  trunk: 1237 sec\u003cbr\\/\u003e\\n  patch: 1278 sec (3% slower)\u003c\\/p\u003e\\n\\n\u003cp\u003eLinux ReiserFS on 6 drive RAID 5 array, JVM 1.5.0_08\u003cbr\\/\u003e\\n  trunk: 483 sec\u003cbr\\/\u003e\\n  patch: 539 sec (12% slower)\u003c\\/p\u003e\\n\\n\u003cp\u003eMac OS X 10.4 4-drive RAID 0 array, JVM 1.5.0_13\u003cbr\\/\u003e\\n  trunk: 268 sec\u003cbr\\/\u003e\\n  patch: 276 sec (3% slower)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12565698_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565698_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 10:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T10:52:57+0000\'\u003e05\\/Feb\\/08 10:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New rev of this patch.  All tests pass.  I think it\'s ready to \\ncommit, but I\'ll wait a few days for comments. \\n\\n This patch has a small change to the segments_N file: it adds a \\nchecksum to the end.  I added ChecksumIndexInput\\/Output that wrap an \\nexisting IndexInput\\/Output for this.  This is used to verify the file \\nis \\\"intact\\\" before trusting its contents when opening the index.  We \\nneed this to guard against the machine crashing after we\'ve written \\nsegments_N and before we\'ve succeeded in syncing it. \\n\\n Unfortunately, in testing performance, I still see a sizable (~30-50%) \\nperformance hit to indexing throughput, on windows computers (XP Pro \\nlaptop &amp; Win 2003 Server R64 computer).  It seems that calling sync \\nwas causing IO in other threads (ie flushing a new segment) to \\ndrasically slow down.  Note that this is only when autoCommit=true; if \\nit\'s false then performance is only slightly worse (because only on \\nclosing the writer do we sync) \\n\\n So I tried sleeping, after writing and before syncing.  I sleep based \\non number of bytes written, for up to 10 seconds, and amazingly, this \\ngreadly reduces the performance loss on the windows computers, and \\ndoesn\'t hurt performance on Linux\\/OS X computers. \\n\\n I think this must be because calling sync immediately forces the OS to \\nwrite dirty buffers to disk \\\"in a rush\\\" (severely impacting IO writes \\nfrom other threads), whereas if you wait first, you let the OS \\nschedule those writes on its own, at good times (maybe when IO system \\nis \\\"relatively\\\" idle). \\n\\n It\'s disappointing to have to \\\"game\\\" the OS to gain back this \\nperformance.  I wish Java had a \\\"waitUntilSync\'d\\\" to do the same \\nthings as fsync, but without \\\"rushing\\\" the OS. \\n\\n On Linux 2.6.22 on a RAID5 array I still see a net performance cost of \\n~12%, sleeping or no sleeping.  On Mac OS X it\'s ~3% loss. \\n\\n Other fixes: \\n \\n\\t DirectoryIndexReader\'s doCommit now also syncs \\n\\t Improved logic on when we must sync-before-CFS: it\'s not necessary \\n    if the just-merged segments are not referenced by the last commit \\n    point (ie if they were all flushed during this writer session) \\n\\t Created SegmentInfos.commit() method, which writes and then syncs \\n    the next segments_N file \\n\\t Simplified sync() logic now that merge threads are stopped before \\n    writer is closed \\n\\t Changed CMS.newMergeThread to name its threads \\n\\t More test cases \\n\\t Various other small fixes \\n \\n\\n\\n Here are test details.  I index first 200K Wikipedia docs with this \\nalg: \\n\\n   analyzer=org.apache.lucene.analysis.standard.StandardAnalyzer \\n  doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker \\n  docs.file=\\/Volumes\\/External\\/lucene\\/wiki.txt \\n  doc.stored = true \\n  doc.term.vector = true \\n  doc.term.vector.offsets = true \\n  doc.term.vector.positions = true \\n\\n   doc.maker.forever = false \\n  directory=FSDirectory \\n\\n   { \\\"BuildIndex\\\" \\n    CreateIndex \\n    { \\\"AddDocs\\\" AddDoc &gt; : 200000\\n    CloseIndex\\n  }\\n\\n   RepSumByPref BuildIndex \\n\\n Win2003 R64, JVM 1.6.0_03 \\n  trunk: 523 sec \\n  patch: 547 sec (5% slower) \\n\\n Win XP Pro, laptop hard drive, JVM 1.4.2_15-b02 \\n  trunk: 1237 sec \\n  patch: 1278 sec (3% slower) \\n\\n Linux ReiserFS on 6 drive RAID 5 array, JVM 1.5.0_08 \\n  trunk: 483 sec \\n  patch: 539 sec (12% slower) \\n\\n Mac OS X 10.4 4-drive RAID 0 array, JVM 1.5.0_13 \\n  trunk: 268 sec \\n  patch: 276 sec (3% slower)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12565701\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12565701&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12565701\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12565701_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565701_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 10:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T10:59:38+0000\'\u003e05\\/Feb\\/08 10:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOn thinking through the above costs of committing, I now think we\u003cbr\\/\u003e\\nshould deprecate autoCommit=true entirely, making autocommit=false the\u003cbr\\/\u003e\\nonly choice in 3.0.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith that change, when you use an IndexWriter, its changes are never\u003cbr\\/\u003e\\nvisible to a reader until you call commit() or close().  I think this\u003cbr\\/\u003e\\nis how KinoSearch and Ferret work, for example.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere are some reasons:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eCommit has now become a costly event, because sync() is costly,\u003cbr\\/\u003e\\n    and is forcing us to use this \\\"syncPause\\\" logic (hack) to game the\u003cbr\\/\u003e\\n    OS, which really is ugly, dependent on OS\\/IO particulars, etc.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eSince we make no guarantee on when a commit specifically happens,\u003cbr\\/\u003e\\n    and this fix in particular will reduce its frequency from \\\"every\u003cbr\\/\u003e\\n    flush\\\" to \\\"every merge\\\", autoCommit=true really is not that useful\u003cbr\\/\u003e\\n    for applications (ie, they will have to call commit() on their\u003cbr\\/\u003e\\n    anyway if they need to rely on its frequency).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eIt\'s always possible to build an autocommit layer above\u003cbr\\/\u003e\\n    IndexWriter by calling commit on your own schedule, to tradeoff\u003cbr\\/\u003e\\n    performance for commit frequency (but not vice\\/versa).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eNot autocommitting by default opens up some good future\u003cbr\\/\u003e\\n    optimizations on merging since we don\'t have to flush real\u003cbr\\/\u003e\\n    segments to disk until commit.  One simple example is we could\u003cbr\\/\u003e\\n    skip building CFS files as we flush, and only merge &amp; build CFS on\u003cbr\\/\u003e\\n    commit\\/close.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eWhat do people think?\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we do this, I would right now deprecate all ctors that take\u003cbr\\/\u003e\\nautoCommit and add comment explaining that in 3.0 autoCommit is wired\u003cbr\\/\u003e\\nto \\\"false\\\".  I would leave the \\\"syncPause\\\" logic in there for now,\u003cbr\\/\u003e\\nbecause it\'s such a sizable performance gain on windows, but deprecate\u003cbr\\/\u003e\\nit, stating that with it will be removed when we switch to\u003cbr\\/\u003e\\nautoCommit=false in 3.0.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12565701_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565701_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 10:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T10:59:38+0000\'\u003e05\\/Feb\\/08 10:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    On thinking through the above costs of committing, I now think we \\nshould deprecate autoCommit=true entirely, making autocommit=false the \\nonly choice in 3.0. \\n\\n With that change, when you use an IndexWriter, its changes are never \\nvisible to a reader until you call commit() or close().  I think this \\nis how KinoSearch and Ferret work, for example. \\n\\n Here are some reasons: \\n\\n \\n\\t Commit has now become a costly event, because sync() is costly, \\n    and is forcing us to use this \\\"syncPause\\\" logic (hack) to game the \\n    OS, which really is ugly, dependent on OS\\/IO particulars, etc. \\n \\n\\n\\n \\n\\t Since we make no guarantee on when a commit specifically happens, \\n    and this fix in particular will reduce its frequency from \\\"every \\n    flush\\\" to \\\"every merge\\\", autoCommit=true really is not that useful \\n    for applications (ie, they will have to call commit() on their \\n    anyway if they need to rely on its frequency). \\n \\n\\n\\n \\n\\t It\'s always possible to build an autocommit layer above \\n    IndexWriter by calling commit on your own schedule, to tradeoff \\n    performance for commit frequency (but not vice\\/versa). \\n \\n\\n\\n \\n\\t Not autocommitting by default opens up some good future \\n    optimizations on merging since we don\'t have to flush real \\n    segments to disk until commit.  One simple example is we could \\n    skip building CFS files as we flush, and only merge &amp; build CFS on \\n    commit\\/close. \\n \\n\\n\\n What do people think? \\n\\n If we do this, I would right now deprecate all ctors that take \\nautoCommit and add comment explaining that in 3.0 autoCommit is wired \\nto \\\"false\\\".  I would leave the \\\"syncPause\\\" logic in there for now, \\nbecause it\'s such a sizable performance gain on windows, but deprecate \\nit, stating that with it will be removed when we switch to \\nautoCommit=false in 3.0.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12565815\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12565815&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12565815\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12565815_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565815_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 17:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T17:03:17+0000\'\u003e05\\/Feb\\/08 17:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; deprecate autoCommit=true entirely\u003c\\/p\u003e\\n\\n\u003cp\u003e+1  This sounds like a good plan.\u003c\\/p\u003e\\n\\n\u003cp\u003eAre your performance numbers above with autoCommit true or false?\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, why not only sleep if Constants.WINDOWS?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12565815_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565815_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 17:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T17:03:17+0000\'\u003e05\\/Feb\\/08 17:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; deprecate autoCommit=true entirely \\n\\n +1  This sounds like a good plan. \\n\\n Are your performance numbers above with autoCommit true or false? \\n\\n Also, why not only sleep if Constants.WINDOWS?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12565830\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12565830&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12565830\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12565830_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565830_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 17:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T17:38:02+0000\'\u003e05\\/Feb\\/08 17:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003e&gt; deprecate autoCommit=true entirely\u003c\\/p\u003e\\n\\n\u003cp\u003e+1 This sounds like a good plan.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eOK I\'ll work out a new patch with this approach.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eAre your performance numbers above with autoCommit true or false?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThey were all with autoCommit=true.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eAlso, why not only sleep if Constants.WINDOWS?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eGood, I\'ll take that approach!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12565830_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565830_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 17:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T17:38:02+0000\'\u003e05\\/Feb\\/08 17:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n &gt; deprecate autoCommit=true entirely \\n\\n +1 This sounds like a good plan.  \\n OK I\'ll work out a new patch with this approach. \\n\\n \\n Are your performance numbers above with autoCommit true or false?  \\n They were all with autoCommit=true. \\n\\n \\n Also, why not only sleep if Constants.WINDOWS?  \\n Good, I\'ll take that approach!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12565894\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12565894&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12565894\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12565894_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565894_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 21:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T21:19:00+0000\'\u003e05\\/Feb\\/08 21:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I updated the patch:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eDeprecate all IW ctors that take autoCommit param, and updated javadocs stating that autoCommit will be hardwired to false starting in 3.0\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eDefault maxSyncPause to 10 seconds when Constant.WINDOWS; else, to 0\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI\'ll wait until end of week to commit!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12565894_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12565894_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Feb\\/08 21:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-05T21:19:00+0000\'\u003e05\\/Feb\\/08 21:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I updated the patch: \\n\\n \\n\\t Deprecate all IW ctors that take autoCommit param, and updated javadocs stating that autoCommit will be hardwired to false starting in 3.0 \\n \\n\\n\\n \\n\\t Default maxSyncPause to 10 seconds when Constant.WINDOWS; else, to 0 \\n \\n\\n\\n I\'ll wait until end of week to commit!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567190\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12567190&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567190\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12567190_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567190_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Feb\\/08 20:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-08T20:31:59+0000\'\u003e08\\/Feb\\/08 20:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached new rev of the patch.  Only changes were to add caveats in javadcos about IO devices that ignore fsync, and, updated patch to apply cleanly on current trunk.\u003c\\/p\u003e\\n\\n\u003cp\u003eI plan to commit in a day or two.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12567190_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567190_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Feb\\/08 20:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-08T20:31:59+0000\'\u003e08\\/Feb\\/08 20:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached new rev of the patch.  Only changes were to add caveats in javadcos about IO devices that ignore fsync, and, updated patch to apply cleanly on current trunk. \\n\\n I plan to commit in a day or two.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12675759\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12675759&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12675759\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yeliz\\\" id=\\\"commentauthor_12675759_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yeliz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yeliz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yeliz Eseryel\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12675759_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/09 04:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-02-23T04:22:34+0000\'\u003e23\\/Feb\\/09 04:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI had been following this thread. Just curious if the patch was committed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yeliz\\\" id=\\\"commentauthor_12675759_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yeliz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yeliz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yeliz Eseryel\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12675759_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/09 04:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-02-23T04:22:34+0000\'\u003e23\\/Feb\\/09 04:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I had been following this thread. Just curious if the patch was committed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12675841\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12675841&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12675841\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12675841_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12675841_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/09 10:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-02-23T10:22:24+0000\'\u003e23\\/Feb\\/09 10:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, this is committed and available as of 2.4.0.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12675841_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12675841_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/09 10:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-02-23T10:22:24+0000\'\u003e23\\/Feb\\/09 10:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, this is committed and available as of 2.4.0.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12675983\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1044?focusedCommentId=12675983&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12675983\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yeliz\\\" id=\\\"commentauthor_12675983_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yeliz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yeliz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yeliz Eseryel\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12675983_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/09 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-02-23T17:15:03+0000\'\u003e23\\/Feb\\/09 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Michael!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yeliz\\\" id=\\\"commentauthor_12675983_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yeliz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yeliz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yeliz Eseryel\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12675983_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/09 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-02-23T17:15:03+0000\'\u003e23\\/Feb\\/09 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Michael!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520242649513"> 
    <input type="hidden" title="jira.request.server.time" value="285"> 
    <input type="hidden" title="jira.request.id" value="577x94513514x3"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="6"> 
    <input type="hidden" title="db.reads.time.in.ms" value="27"> 
    <input type="hidden" title="db.conns.time.in.ms" value="36"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 577x94513514x3
	          REQUEST TIMESTAMP : [05/Mar/2018:09:37:29 +0000]
	               REQUEST TIME : 0.2850
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 6

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=16, elapsedTotal=27840196, elapsedMin=637690, elapsedMax=12026193, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=22, elapsedTotal=36953986, elapsedMin=658718, elapsedMax=12073178, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>