<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|c55fbb36b7fc796b868129526247b6a89fa493ea|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"57444192f9bfbf\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-5552"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-5552] Derby threads hanging when using ClientXADataSource and a deadlock or lock timeout occurs - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-5552] Derby threads hanging when using ClientXADataSource and a deadlock or lock timeout occurs - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-5552">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-5552" href="/jira/browse/DERBY-5552" id="key-val" rel="12536170">DERBY-5552</a></li>
                </ol>
                <h1 id="summary-val">Derby threads hanging when using ClientXADataSource and a deadlock or lock timeout occurs</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-5552"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-5552/DERBY-5552.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-5552/DERBY-5552.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-5552/DERBY-5552.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-5552/DERBY-5552.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/blocker.svg" title="Blocker - Blocks development and/or testing work, production could not run" width="16"> Blocker </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.1.3.1 ">10.1.3.1</span>, <span title="10.2.2.0 ">10.2.2.0</span>, <span title="10.3.3.0 ">10.3.3.0</span>, <span title="10.4.2.0 ">10.4.2.0</span>, <span title="10.5.3.0 Next release after 10.5.2.0 release candidate #1">10.5.3.0</span>, <span title="10.6.2.1 Derby 10.6.2.1 Release">10.6.2.1</span>, <span title="10.7.1.1 First release on the 10.7 branch.">10.7.1.1</span>, <span title="10.8.1.2 First release on the 10.8 branch">10.8.1.2</span>, <span title="10.8.2.2 second release on the 10.8 branch">10.8.2.2</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.5.3.1" title="10.5.3.1 Old head of 10.5 branch">10.5.3.1</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.6.2.2" title="10.6.2.2 Old head of 10.6 branch">10.6.2.2</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.7.1.4" title="10.7.1.4 Head of 10.7 branch as of 2010-11-29">10.7.1.4</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.8.3.0" title="10.8.3.0 Third release on the 10.8 branch">10.8.3.0</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.9.1.0" title="10.9.1.0 First release on the 10.9 branch">10.9.1.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+%22Network+Server%22" title="Network Server ">Network Server</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <ul class="labels" id="labels-12536170-value"> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+derby_triage10_9" title="derby_triage10_9"><span>derby_triage10_9</span></a></li> 
                    </ul> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     Solaris 10, Glassfish V2.1.1, 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310050" class="item"> 
                     <div class="wrap"> 
                      <strong title="Urgency" class="name">Urgency:</strong> 
                      <div id="customfield_12310050-val" class="value type-select" data-fieldtype="select" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        Urgent 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310090" class="item"> 
                     <div class="wrap"> 
                      <strong title="Issue &amp; fix info" class="name">Issue &amp; fix info:</strong> 
                      <div id="customfield_12310090-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310090-field"> 
                        <span>Patch Available</span>, 
                        <span>Repro attached</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310200" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bug behavior facts" class="name">Bug behavior facts:</strong> 
                      <div id="customfield_12310200-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310200-field"> 
                        <span>Crash</span>, 
                        <span>Seen in production</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>The issue arrives when multiple XA transactions are done in parallel and there is either a lock timeout or a lock deadlock detected. When this happens the connection is leaked in the Glassfish connection pool and the client thread hangs in "org.apache.derby.client.netReply.fill(Reply.java:172)". </p> 
                  <p>Shutting down the app server fails because the thread has a lock in "org.apache.derby.client.net.NetConnection40" and another task is calling "org.apache.derby.client.ClientPooledConnection.close(ClientPooledConnection.java:214)" which is waiting for the lock.</p> 
                  <p>Killing the appsever using "kill" and then attempting to shutdown Derby network server causes the Network Server to hang. One of the threads hangs waiting for a lock at "org.apache.derby.impl.drda.NeworkServerControlImpl.removeFromSessionTable(NetworkServerControlImpl.java:1525)" and the "main" thread has this locked at "org.apache.derby.impl.drda.NetworkServerControlImpl.executeWork(NetworkServerControlImpl.java:2242)" and it itself is waiting for a lock which belongs to a thread that is stuck at "org.apache.derby.impl.services.locks.ActiveLock.waitForGrant(ActiveLock.java:118) which is in the TIMED_WAITING state.</p> 
                  <p>Only by killing the Network Server using "kill" is possible at this point.</p> 
                  <p>There are transactions left even though all clients have been removed. </p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-5552?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-5552?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-5552?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-5552?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12508403" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12508403/appserverstack.txt" draggable="true" data-downloadurl="text/plain:appserverstack.txt:https://issues.apache.org/jira/secure/attachment/12508403/appserverstack.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12508403/appserverstack.txt" title="Latest  22/Dec/11 16:03 - Brett Bergquist" draggable="true" data-downloadurl="text/plain:appserverstack.txt:https://issues.apache.org/jira/secure/attachment/12508403/appserverstack.txt">appserverstack.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-22T16:03:53.670Z">22/Dec/11 16:03</time>
                   </dd>
                   <dd class="attachment-size">
                    63 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12508401" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12508401/client.tar.Z" draggable="true" data-downloadurl="application/x-compress:client.tar.Z:https://issues.apache.org/jira/secure/attachment/12508401/client.tar.Z"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12508401/client.tar.Z" title="Latest  22/Dec/11 16:02 - Brett Bergquist" draggable="true" data-downloadurl="application/x-compress:client.tar.Z:https://issues.apache.org/jira/secure/attachment/12508401/client.tar.Z">client.tar.Z</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-22T16:02:15.786Z">22/Dec/11 16:02</time>
                   </dd>
                   <dd class="attachment-size">
                    69 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12508400" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12508400/derby.log" draggable="true" data-downloadurl="text/plain:derby.log:https://issues.apache.org/jira/secure/attachment/12508400/derby.log"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12508400/derby.log" title="Latest  22/Dec/11 15:58 - Brett Bergquist" draggable="true" data-downloadurl="text/plain:derby.log:https://issues.apache.org/jira/secure/attachment/12508400/derby.log">derby.log</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-22T15:58:30.388Z">22/Dec/11 15:58</time>
                   </dd>
                   <dd class="attachment-size">
                    320 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12515815" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12515815/derby-5552_withexpanded_test_diff.txt" draggable="true" data-downloadurl="text/plain:derby-5552_withexpanded_test_diff.txt:https://issues.apache.org/jira/secure/attachment/12515815/derby-5552_withexpanded_test_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12515815/derby-5552_withexpanded_test_diff.txt" title="Latest  23/Feb/12 21:01 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:derby-5552_withexpanded_test_diff.txt:https://issues.apache.org/jira/secure/attachment/12515815/derby-5552_withexpanded_test_diff.txt">derby-5552_withexpanded_test_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-02-23T21:01:30.600Z">23/Feb/12 21:01</time>
                   </dd>
                   <dd class="attachment-size">
                    9 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12513867" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12513867/derby-5552_withtest_diff.txt" draggable="true" data-downloadurl="text/plain:derby-5552_withtest_diff.txt:https://issues.apache.org/jira/secure/attachment/12513867/derby-5552_withtest_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12513867/derby-5552_withtest_diff.txt" title="Latest  08/Feb/12 21:48 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:derby-5552_withtest_diff.txt:https://issues.apache.org/jira/secure/attachment/12513867/derby-5552_withtest_diff.txt">derby-5552_withtest_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-02-08T21:48:41.830Z">08/Feb/12 21:48</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12512868" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12512868/derby-5552_withtest_diff.txt" draggable="true" data-downloadurl="text/plain:derby-5552_withtest_diff.txt:https://issues.apache.org/jira/secure/attachment/12512868/derby-5552_withtest_diff.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12512868/derby-5552_withtest_diff.txt" title=" 01/Feb/12 23:37 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:derby-5552_withtest_diff.txt:https://issues.apache.org/jira/secure/attachment/12512868/derby-5552_withtest_diff.txt">derby-5552_withtest_diff.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-02-01T23:37:42.092Z">01/Feb/12 23:37</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12509290" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12509290/DERBY-5552-p1.patch" draggable="true" data-downloadurl="text/plain:DERBY-5552-p1.patch:https://issues.apache.org/jira/secure/attachment/12509290/DERBY-5552-p1.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12509290/DERBY-5552-p1.patch" title="Latest  03/Jan/12 14:29 - Brett Bergquist" draggable="true" data-downloadurl="text/plain:DERBY-5552-p1.patch:https://issues.apache.org/jira/secure/attachment/12509290/DERBY-5552-p1.patch">DERBY-5552-p1.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-01-03T14:29:43.845Z">03/Jan/12 14:29</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12509291" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12509291/DERBY-5552-p2.patch" draggable="true" data-downloadurl="text/plain:DERBY-5552-p2.patch:https://issues.apache.org/jira/secure/attachment/12509291/DERBY-5552-p2.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12509291/DERBY-5552-p2.patch" title="Latest  03/Jan/12 14:37 - Brett Bergquist" draggable="true" data-downloadurl="text/plain:DERBY-5552-p2.patch:https://issues.apache.org/jira/secure/attachment/12509291/DERBY-5552-p2.patch">DERBY-5552-p2.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-01-03T14:37:08.738Z">03/Jan/12 14:37</time>
                   </dd>
                   <dd class="attachment-size">
                    0.5 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12508404" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12508404/derbystackatshutdown.txt" draggable="true" data-downloadurl="text/plain:derbystackatshutdown.txt:https://issues.apache.org/jira/secure/attachment/12508404/derbystackatshutdown.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12508404/derbystackatshutdown.txt" title="Latest  22/Dec/11 16:04 - Brett Bergquist" draggable="true" data-downloadurl="text/plain:derbystackatshutdown.txt:https://issues.apache.org/jira/secure/attachment/12508404/derbystackatshutdown.txt">derbystackatshutdown.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-22T16:04:53.598Z">22/Dec/11 16:04</time>
                   </dd>
                   <dd class="attachment-size">
                    29 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12508456" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12508456/execute.patch" draggable="true" data-downloadurl="text/plain:execute.patch:https://issues.apache.org/jira/secure/attachment/12508456/execute.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12508456/execute.patch" title="Latest  22/Dec/11 22:30 - Brett Bergquist" draggable="true" data-downloadurl="text/plain:execute.patch:https://issues.apache.org/jira/secure/attachment/12508456/execute.patch">execute.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-22T22:30:22.631Z">22/Dec/11 22:30</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12516005" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12516005/ReproDerby5552DB2.java" draggable="true" data-downloadurl="text/x-java:ReproDerby5552DB2.java:https://issues.apache.org/jira/secure/attachment/12516005/ReproDerby5552DB2.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12516005/ReproDerby5552DB2.java" title="Latest  25/Feb/12 00:24 - Kathey Marsden" draggable="true" data-downloadurl="text/x-java:ReproDerby5552DB2.java:https://issues.apache.org/jira/secure/attachment/12516005/ReproDerby5552DB2.java">ReproDerby5552DB2.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-02-25T00:24:40.603Z">25/Feb/12 00:24</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12509477" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12509477/ReproDerby5552LockTimeout.java" draggable="true" data-downloadurl="java/*:ReproDerby5552LockTimeout.java:https://issues.apache.org/jira/secure/attachment/12509477/ReproDerby5552LockTimeout.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12509477/ReproDerby5552LockTimeout.java" title="Latest  04/Jan/12 23:49 - Kathey Marsden" draggable="true" data-downloadurl="java/*:ReproDerby5552LockTimeout.java:https://issues.apache.org/jira/secure/attachment/12509477/ReproDerby5552LockTimeout.java">ReproDerby5552LockTimeout.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-01-04T23:49:54.890Z">04/Jan/12 23:49</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12508402" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12508402/transactionsleft.txt" draggable="true" data-downloadurl="text/plain:transactionsleft.txt:https://issues.apache.org/jira/secure/attachment/12508402/transactionsleft.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12508402/transactionsleft.txt" title="Latest  22/Dec/11 16:03 - Brett Bergquist" draggable="true" data-downloadurl="text/plain:transactionsleft.txt:https://issues.apache.org/jira/secure/attachment/12508402/transactionsleft.txt">transactionsleft.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-22T16:03:04.851Z">22/Dec/11 16:03</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Bergquist
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12516004" data-issue-id="12536170" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12516004/utilXid.java" draggable="true" data-downloadurl="text/x-java:utilXid.java:https://issues.apache.org/jira/secure/attachment/12516004/utilXid.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12516004/utilXid.java" title="Latest  25/Feb/12 00:24 - Kathey Marsden" draggable="true" data-downloadurl="text/x-java:utilXid.java:https://issues.apache.org/jira/secure/attachment/12516004/utilXid.java">utilXid.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-02-25T00:24:40.575Z">25/Feb/12 00:24</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="incorporates">
                   incorporates
                  </dt> 
                  <dd id="internal-12544462_12310010"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-5633: Add tests for state transition and behavior with Lock Timeout in XA Transaction (DERBY-5552 testing task)"> <a href="/jira/browse/DERBY-5633" data-issue-key="DERBY-5633" class="issue-link link-title resolution">DERBY-5633</a> <span class="link-summary">Add tests for state transition and behavior with Lock Timeout in XA Transaction (DERBY-5552 testing task)</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12536233_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5553: System property for client tracing -Dderby.client.traceDirectory does not work with XADataSource"> <a href="/jira/browse/DERBY-5553" data-issue-key="DERBY-5553" class="issue-link link-title resolution">DERBY-5553</a> <span class="link-summary">System property for client tracing -Dderby.client.traceDirectory does not work with XADataSource</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_brettw" rel="brettw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Brett Wooldridge&quot;,&quot;emailAddress&quot;:&quot;brett.wooldridge@gmail.com&quot;,&quot;username&quot;:&quot;brettw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="brettw"></span></span> Brett Wooldridge </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_bbergquist" rel="bbergquist" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Brett Bergquist&quot;,&quot;emailAddress&quot;:&quot;brett@thebergquistfamily.com&quot;,&quot;username&quot;:&quot;bbergquist&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="bbergquist"></span></span> Brett Bergquist </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">1</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="22/Dec/11 15:54"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-12-22T15:54:55+0000">22/Dec/11 15:54</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="15/Nov/13 08:15"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-11-15T08:15:07+0000">15/Nov/13 08:15</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="28/Feb/12 19:06"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-02-28T19:06:14+0000">28/Feb/12 19:06</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-5552?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-5552?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13174860\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13174860&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174860\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174860_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174860_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 15:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T15:58:30+0000\'\u003e22\\/Dec\\/11 15:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDerby log file of showing the deadlock reporting and lock timeout reporting\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174860_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174860_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 15:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T15:58:30+0000\'\u003e22\\/Dec\\/11 15:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Derby log file of showing the deadlock reporting and lock timeout reporting              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13174865\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13174865&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174865\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174865_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174865_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T16:02:15+0000\'\u003e22\\/Dec\\/11 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eClient side trace files\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174865_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174865_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T16:02:15+0000\'\u003e22\\/Dec\\/11 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Client side trace files              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13174869\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13174869&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174869\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174869_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174869_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T16:03:05+0000\'\u003e22\\/Dec\\/11 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe transactions left over when there is no client connected (other than IJ querying this)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174869_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174869_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T16:03:05+0000\'\u003e22\\/Dec\\/11 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The transactions left over when there is no client connected (other than IJ querying this)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13174870\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13174870&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174870\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174870_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174870_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T16:03:53+0000\'\u003e22\\/Dec\\/11 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe application server stack trace from jstack when the application server is hung at shutdown.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174870_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174870_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T16:03:53+0000\'\u003e22\\/Dec\\/11 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The application server stack trace from jstack when the application server is hung at shutdown.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13174871\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13174871&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174871\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174871_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174871_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 16:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T16:04:53+0000\'\u003e22\\/Dec\\/11 16:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe Network Server stack trace using jstack when hung at shutdown\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13174871_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174871_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 16:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T16:04:53+0000\'\u003e22\\/Dec\\/11 16:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The Network Server stack trace using jstack when hung at shutdown              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13175022\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13175022&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13175022\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13175022_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175022_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 20:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T20:10:56+0000\'\u003e22\\/Dec\\/11 20:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI found one problem.  In BasicNoPutResultImpl.java around line 250 is the code:\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\ttry {\u003cbr\\/\u003e\\n\\t\\t\\tLanguageConnectionContext lcc = getLanguageConnectionContext();\u003cbr\\/\u003e\\n\\t\\t\\tif(lcc.getRunTimeStatisticsMode() &amp;&amp; lcc.getXplainOnlyMode()) \u003c\\/p\u003e\\n{\\n\\t\\t\\t\\t\\/\\/ do nothing\\n\\t\\t\\t}\\n\u003cp\u003e else \u003c\\/p\u003e\\n{\\n\\t\\t\\t\\topenCore();\\n\\t\\t\\t}\\n\\n\u003cp\u003e\\t\\t} catch (StandardException se) \u003c\\/p\u003e\\n{\\n\\t\\t\\tactivation.checkStatementValidity();\\n\\t\\t\\tthrow se;\\n\\t\\t}\\n\\n\u003cp\u003eFor whatever reason (looks like something in my code), a lock timeout is being detected while executing in \\u201CopenCore\\u201D and a StandardException is being thrown with SQLState \\u201C40XL2\\u201D and a report = 2 (REPORT_ALWAYS I Believe).  The exception is caught and then the \u003c\\/p\u003e\\n\\n\u003cp\u003e\\tActivation.checkStatementValidity()\u003c\\/p\u003e\\n\\n\u003cp\u003eIs being called.  The statement appears not to be valid at that point and a new StandardExceptis thrown with SQLState.LANG_STATEMENT_NEEDS_RECOMPILE and report = REPORT_NEVER.  \u003c\\/p\u003e\\n\\n\u003cp\u003eThe effect is that the Lock timeout exception is swallowed and the statement is recompiled and executed again.    This occurs over and over and the loop never ends.     This looks like the cause that the Network Server cannot shutdown in the bug.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to me that if the exception being caught above is to be \\u201CREPORT_ALWAYS\\u201D, then the code should never check the statement validity and should just rethrow the original exception.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13175022_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175022_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 20:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T20:10:56+0000\'\u003e22\\/Dec\\/11 20:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I found one problem.  In BasicNoPutResultImpl.java around line 250 is the code: \\n\\n \\t\\ttry { \\n\\t\\t\\tLanguageConnectionContext lcc = getLanguageConnectionContext(); \\n\\t\\t\\tif(lcc.getRunTimeStatisticsMode() &amp;&amp; lcc.getXplainOnlyMode())  \\n{\\n\\t\\t\\t\\t\\/\\/ do nothing\\n\\t\\t\\t}\\n  else  \\n{\\n\\t\\t\\t\\topenCore();\\n\\t\\t\\t}\\n\\n \\t\\t} catch (StandardException se)  \\n{\\n\\t\\t\\tactivation.checkStatementValidity();\\n\\t\\t\\tthrow se;\\n\\t\\t}\\n\\n For whatever reason (looks like something in my code), a lock timeout is being detected while executing in \\u201CopenCore\\u201D and a StandardException is being thrown with SQLState \\u201C40XL2\\u201D and a report = 2 (REPORT_ALWAYS I Believe).  The exception is caught and then the  \\n\\n \\tActivation.checkStatementValidity() \\n\\n Is being called.  The statement appears not to be valid at that point and a new StandardExceptis thrown with SQLState.LANG_STATEMENT_NEEDS_RECOMPILE and report = REPORT_NEVER.   \\n\\n The effect is that the Lock timeout exception is swallowed and the statement is recompiled and executed again.    This occurs over and over and the loop never ends.     This looks like the cause that the Network Server cannot shutdown in the bug. \\n\\n It seems to me that if the exception being caught above is to be \\u201CREPORT_ALWAYS\\u201D, then the code should never check the statement validity and should just rethrow the original exception. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13175112\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13175112&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13175112\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13175112_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175112_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 22:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T22:28:53+0000\'\u003e22\\/Dec\\/11 22:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI patched the files to look like this and am running my test setup now.  So far so good.  In fact I am not seeing the deadlocks or lock timeouts at all now.   Not sure why but it is all running smoothly with these changes:\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eIndex: BasicNoPutResultSetImpl.java\u003cbr\\/\u003e\\n===================================================================\u003cbr\\/\u003e\\n&#8212; BasicNoPutResultSetImpl.java\\t(revision 1222480)\u003cbr\\/\u003e\\n+++ BasicNoPutResultSetImpl.java\\t(working copy)\u003cbr\\/\u003e\\n@@ -256,7 +256,9 @@\u003cbr\\/\u003e\\n \\t\\t\\t}\u003c\\/p\u003e\\n\\n\u003cp\u003e \\t\\t} catch (StandardException se) {\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eactivation.checkStatementValidity();\u003cbr\\/\u003e\\n+            if (se.report() != StandardException.REPORT_ALWAYS) \\n{\\n+                activation.checkStatementValidity();\\n+            }\\n\u003cp\u003e \\t\\t\\tthrow se;\u003cbr\\/\u003e\\n \\t\\t}\u003c\\/p\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIndex: DeleteResultSet.java\u003cbr\\/\u003e\\n===================================================================\u003cbr\\/\u003e\\n&#8212; DeleteResultSet.java\\t(revision 1222480)\u003cbr\\/\u003e\\n+++ DeleteResultSet.java\\t(working copy)\u003cbr\\/\u003e\\n@@ -201,7 +201,9 @@\u003cbr\\/\u003e\\n         \\t\\tsource.reopenCore();\u003cbr\\/\u003e\\n \\t\\t\\t}\u003cbr\\/\u003e\\n \\t\\t} catch (StandardException se) {\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eactivation.checkStatementValidity();\u003cbr\\/\u003e\\n+            if (se.report() != se.REPORT_ALWAYS) \\n{\\n+    \\t\\t\\tactivation.checkStatementValidity();\\n+            }\\n\u003cp\u003e \\t\\t\\tthrow se;\u003c\\/p\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e \\t\\t}\u003cbr\\/\u003e\\nIndex: RowChangerImpl.java\u003cbr\\/\u003e\\n===================================================================\u003cbr\\/\u003e\\n&#8212; RowChangerImpl.java\\t(revision 1222480)\u003cbr\\/\u003e\\n+++ RowChangerImpl.java\\t(working copy)\u003cbr\\/\u003e\\n@@ -372,7 +372,7 @@\u003cbr\\/\u003e\\n \\t\\t}\u003c\\/p\u003e\\n\\n\u003cp\u003e \\t\\t} catch (StandardException se) \u003c\\/p\u003e\\n{\\n-\\t\\t\\tif (activation != null)\\n+\\t\\t\\tif (se.report() != StandardException.REPORT_ALWAYS &amp;&amp; activation != null)\\n \\t\\t\\t\\tactivation.checkStatementValidity();\\n \\t\\t\\tthrow se;\\n \\t\\t} \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13175112_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175112_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 22:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T22:28:53+0000\'\u003e22\\/Dec\\/11 22:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I patched the files to look like this and am running my test setup now.  So far so good.  In fact I am not seeing the deadlocks or lock timeouts at all now.   Not sure why but it is all running smoothly with these changes: \\n\\n\\n Index: BasicNoPutResultSetImpl.java \\n=================================================================== \\n&#8212; BasicNoPutResultSetImpl.java\\t(revision 1222480) \\n+++ BasicNoPutResultSetImpl.java\\t(working copy) \\n@@ -256,7 +256,9 @@ \\n \\t\\t\\t} \\n\\n  \\t\\t} catch (StandardException se) { \\n \\n\\t activation.checkStatementValidity(); \\n+            if (se.report() != StandardException.REPORT_ALWAYS) \\n{\\n+                activation.checkStatementValidity();\\n+            }\\n  \\t\\t\\tthrow se; \\n \\t\\t}  \\n \\n\\n\\n Index: DeleteResultSet.java \\n=================================================================== \\n&#8212; DeleteResultSet.java\\t(revision 1222480) \\n+++ DeleteResultSet.java\\t(working copy) \\n@@ -201,7 +201,9 @@ \\n         \\t\\tsource.reopenCore(); \\n \\t\\t\\t} \\n \\t\\t} catch (StandardException se) { \\n \\n\\t activation.checkStatementValidity(); \\n+            if (se.report() != se.REPORT_ALWAYS) \\n{\\n+    \\t\\t\\tactivation.checkStatementValidity();\\n+            }\\n  \\t\\t\\tthrow se;  \\n \\n\\n\\n  \\t\\t} \\nIndex: RowChangerImpl.java \\n=================================================================== \\n&#8212; RowChangerImpl.java\\t(revision 1222480) \\n+++ RowChangerImpl.java\\t(working copy) \\n@@ -372,7 +372,7 @@ \\n \\t\\t} \\n\\n  \\t\\t} catch (StandardException se)  \\n{\\n-\\t\\t\\tif (activation != null)\\n+\\t\\t\\tif (se.report() != StandardException.REPORT_ALWAYS &amp;&amp; activation != null)\\n \\t\\t\\t\\tactivation.checkStatementValidity();\\n \\t\\t\\tthrow se;\\n \\t\\t}             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13175113\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13175113&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13175113\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13175113_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175113_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 22:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T22:30:23+0000\'\u003e22\\/Dec\\/11 22:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is the patch that I did to the 10.8 branch.  Basically all I did is to make sure not to swallow the exceptions if the \u003c\\/p\u003e\\n\\n\u003cp\u003eStandardException.report() == StandardException.REPORT_ALWAYS\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13175113_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175113_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 22:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T22:30:23+0000\'\u003e22\\/Dec\\/11 22:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is the patch that I did to the 10.8 branch.  Basically all I did is to make sure not to swallow the exceptions if the  \\n\\n StandardException.report() == StandardException.REPORT_ALWAYS              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13175151\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13175151&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13175151\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13175151_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175151_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 23:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T23:33:37+0000\'\u003e22\\/Dec\\/11 23:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Brett,\u003c\\/p\u003e\\n\\n\u003cp\u003eI am glad you are making progress as I was clearly misunderstanding your scenario.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlthough the residual xa transactions are there in the database, I looked at the client traces and don\'t see any indication that XA transactions are being used in the test in fact even the names of the the trace files \u003cem\u003edriver\u003c\\/em\u003e? indicate a driver manager connection and not an xa datasource connection which would have been created in files \u003cem\u003exads\u003c\\/em\u003e?. Since there were no XA transactions, there was not the  SYNCCTL with possible missing   SYNCCRD exchanges that I was looking for.\u003c\\/p\u003e\\n\\n\u003cp\u003eYour logic on the above change sounds reasonable to me, but I don\'t think I am the best person to review that change.  After you run tests, post a patch and mark patch available and I am sure the community will review and expedite commit of the change if it is the right thing. I think it would definitely be good to get a test checked in too so we don\'t regress.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13175151_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175151_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 23:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T23:33:37+0000\'\u003e22\\/Dec\\/11 23:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Brett, \\n\\n I am glad you are making progress as I was clearly misunderstanding your scenario. \\n\\n Although the residual xa transactions are there in the database, I looked at the client traces and don\'t see any indication that XA transactions are being used in the test in fact even the names of the the trace files  driver ? indicate a driver manager connection and not an xa datasource connection which would have been created in files  xads ?. Since there were no XA transactions, there was not the  SYNCCTL with possible missing   SYNCCRD exchanges that I was looking for. \\n\\n Your logic on the above change sounds reasonable to me, but I don\'t think I am the best person to review that change.  After you run tests, post a patch and mark patch available and I am sure the community will review and expedite commit of the change if it is the right thing. I think it would definitely be good to get a test checked in too so we don\'t regress. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13175192\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13175192&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13175192\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13175192_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175192_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/11 00:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-23T00:19:30+0000\'\u003e23\\/Dec\\/11 00:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI guess I am confused as well Kathey as I had the debugger attached and do see it going through the XA code in Derby on the client side.  The application server is setup with the ClientXADataSource and I do see it calling xa.commit and xa.end for example.   The ClientXADataSource is required otherwise the error:\u003c\\/p\u003e\\n\\n\u003cp\u003e\\tLocal transaction already has 1 non-XA Resource: cannot add more resources. \u003c\\/p\u003e\\n\\n\u003cp\u003eoccurs.  So although there is one database (Derby), it is using XA.   The database is being accessed through EJB\'s and through Eclipselink and also through a custom JCA interface driving Message Driven Beans.  \u003c\\/p\u003e\\n\\n\u003cp\u003eFor the test case, I had to limit things to get my sanity.  So I stopped as much access to the database as I could but still trigger the problem.  Eventually I got down to one thread of control being processed by EJB\'s which do start new transactions.  Even with this one access going on, I hit the lockup issue that I posted.  That is when I found the issue that I mention.  So whether or not this is the real issue, I don\'t know but when I tried to get as simple a condition as possible, I ran into this.\u003c\\/p\u003e\\n\\n\u003cp\u003eThinking now, I don\'t understand why this would not be hit in a normal case of a lock timeout being thrown. The only thing that I can think of is that the Activation.checkStatementValidity() is seeing the statement as valid and not going to try to recompile it.  Why it occurred in my case where I see the \\\"isValid\\\" member set to false, I don\'t know.  I will try to hitch up the debugger and try to determine the difference so that I can understand it better.\u003c\\/p\u003e\\n\\n\u003cp\u003eI do believe that the code should not swallow and exception such as a lock timeout being reported regardless if the statement is no longer reporting to be valid.  This is definitely a condition that will cause an infinite loop of processing.\u003c\\/p\u003e\\n\\n\u003cp\u003eAgain, I appreciate the help and your time.  If I gain an understanding of how the condition is triggered, I will look to write a test case for it.  I am reading the Derby testing docs that are relating to use JUnit which I assume is the correct path for newer test cases, correct?\u003c\\/p\u003e\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13175192_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175192_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/11 00:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-23T00:19:30+0000\'\u003e23\\/Dec\\/11 00:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I guess I am confused as well Kathey as I had the debugger attached and do see it going through the XA code in Derby on the client side.  The application server is setup with the ClientXADataSource and I do see it calling xa.commit and xa.end for example.   The ClientXADataSource is required otherwise the error: \\n\\n \\tLocal transaction already has 1 non-XA Resource: cannot add more resources.  \\n\\n occurs.  So although there is one database (Derby), it is using XA.   The database is being accessed through EJB\'s and through Eclipselink and also through a custom JCA interface driving Message Driven Beans.   \\n\\n For the test case, I had to limit things to get my sanity.  So I stopped as much access to the database as I could but still trigger the problem.  Eventually I got down to one thread of control being processed by EJB\'s which do start new transactions.  Even with this one access going on, I hit the lockup issue that I posted.  That is when I found the issue that I mention.  So whether or not this is the real issue, I don\'t know but when I tried to get as simple a condition as possible, I ran into this. \\n\\n Thinking now, I don\'t understand why this would not be hit in a normal case of a lock timeout being thrown. The only thing that I can think of is that the Activation.checkStatementValidity() is seeing the statement as valid and not going to try to recompile it.  Why it occurred in my case where I see the \\\"isValid\\\" member set to false, I don\'t know.  I will try to hitch up the debugger and try to determine the difference so that I can understand it better. \\n\\n I do believe that the code should not swallow and exception such as a lock timeout being reported regardless if the statement is no longer reporting to be valid.  This is definitely a condition that will cause an infinite loop of processing. \\n\\n Again, I appreciate the help and your time.  If I gain an understanding of how the condition is triggered, I will look to write a test case for it.  I am reading the Derby testing docs that are relating to use JUnit which I assume is the correct path for newer test cases, correct? \\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13175216\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13175216&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13175216\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13175216_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175216_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/11 01:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-23T01:17:32+0000\'\u003e23\\/Dec\\/11 01:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, definitely you want your test to be the new Junit style so that is the place to look.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think I have solved the mystery of the missing XA client  traces and filed \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-5553\\\" title=\\\"System property for client tracing -Dderby.client.traceDirectory does not work with XADataSource\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-5553\\\"\u003e\u003cdel\u003eDERBY-5553\u003c\\/del\u003e\u003c\\/a\u003e for that issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am trying to think of a scenario where we we execute a valid statement would get a lock timeout and then at the time of processing the exception the statement would have become invalid.  One reason for a statement becoming invalid would be for instance if a table had been altered, for example if we had a prepared statement \\\"SELECT * FROM TAB\\\" and then a column was added or dropped.  In that scenario the statement would be recompiled long before the lock timeout occurred.  If the problem statement is the one with the lock timeout it would seem to be:\u003c\\/p\u003e\\n\\n\u003cp\u003e SELECT DISTINCT t3.ID, t3.OPLOCK FROM PKG_9145E10G.PLPM_PAIR t3, PKG_9145E10G.PLPM_CHASSIS_9145E10G_USER t2, CORE_V1.DEVICE_ENTITY_USER t1, CORE_V1.DEVICE_ENTITY t0 WHERE ((t0.ID = CAST (? AS INTEGER )) AND (((t2.PLPM_PAIR_ID = t3.ID) AND ((t2.ID = t1.ID) AND (t1.DTYPE = \'PlpmChassis9145E10GUser\'))) AND (t0.ID = t1.DEVICE_ENTITY_ID))) with 1 parameters begin parameter #1: 249360 :end parameter \u003cbr\\/\u003e\\nERROR 40XL2: A lock could not be obtained within the time requested.  The lockTable dump is: \u003cbr\\/\u003e\\nThu Dec 22 07:03:07 PST 2011\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eI am not sure how that could have gone invalid between the initial execution and the lock time out.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13175216_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13175216_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Dec\\/11 01:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-23T01:17:32+0000\'\u003e23\\/Dec\\/11 01:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, definitely you want your test to be the new Junit style so that is the place to look. \\n\\n I think I have solved the mystery of the missing XA client  traces and filed   DERBY-5553   for that issue. \\n\\n I am trying to think of a scenario where we we execute a valid statement would get a lock timeout and then at the time of processing the exception the statement would have become invalid.  One reason for a statement becoming invalid would be for instance if a table had been altered, for example if we had a prepared statement \\\"SELECT * FROM TAB\\\" and then a column was added or dropped.  In that scenario the statement would be recompiled long before the lock timeout occurred.  If the problem statement is the one with the lock timeout it would seem to be: \\n\\n  SELECT DISTINCT t3.ID, t3.OPLOCK FROM PKG_9145E10G.PLPM_PAIR t3, PKG_9145E10G.PLPM_CHASSIS_9145E10G_USER t2, CORE_V1.DEVICE_ENTITY_USER t1, CORE_V1.DEVICE_ENTITY t0 WHERE ((t0.ID = CAST (? AS INTEGER )) AND (((t2.PLPM_PAIR_ID = t3.ID) AND ((t2.ID = t1.ID) AND (t1.DTYPE = \'PlpmChassis9145E10GUser\'))) AND (t0.ID = t1.DEVICE_ENTITY_ID))) with 1 parameters begin parameter #1: 249360 :end parameter  \\nERROR 40XL2: A lock could not be obtained within the time requested.  The lockTable dump is:  \\nThu Dec 22 07:03:07 PST 2011 \\n\\n\\n I am not sure how that could have gone invalid between the initial execution and the lock time out. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13176215\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13176215&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13176215\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13176215_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13176215_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Dec\\/11 16:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-27T16:11:32+0000\'\u003e27\\/Dec\\/11 16:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt is the IndexStatisticsDaemonImpl that is invalidating the statement.  To verify this, I got my test case where it was in this loop.  With my printouts I was seeing that the isValid was being set by the thread that was stuck right after the timeout occurred and then I immediately saw makeInvalid being called with action = 40 (UPDATE_STATISTICS).  So I attached the debugger to the database engine and set a breakpoint in IndexStatisticsDaemonImpl  and then set  \\\"daemonDisabled\\\" to be \\\"false\\\".   Immediately the lock timeout got reported and the loop terminated and my test case continued on the way it should.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo the IndexStatisticsDaemonImpl has the ability to invalidate statements in use by other threads.  In this case, it is being invoked right after lock timeout occurs and before the lock timeout exception is being processed.  The code sees that the statement is invalid and swallows the lock exception and sets up to recompile and run the statement again.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13176215_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13176215_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Dec\\/11 16:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-27T16:11:32+0000\'\u003e27\\/Dec\\/11 16:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It is the IndexStatisticsDaemonImpl that is invalidating the statement.  To verify this, I got my test case where it was in this loop.  With my printouts I was seeing that the isValid was being set by the thread that was stuck right after the timeout occurred and then I immediately saw makeInvalid being called with action = 40 (UPDATE_STATISTICS).  So I attached the debugger to the database engine and set a breakpoint in IndexStatisticsDaemonImpl  and then set  \\\"daemonDisabled\\\" to be \\\"false\\\".   Immediately the lock timeout got reported and the loop terminated and my test case continued on the way it should. \\n\\n So the IndexStatisticsDaemonImpl has the ability to invalidate statements in use by other threads.  In this case, it is being invoked right after lock timeout occurs and before the lock timeout exception is being processed.  The code sees that the statement is invalid and swallows the lock exception and sets up to recompile and run the statement again.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13176216\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13176216&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13176216\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13176216_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13176216_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Dec\\/11 16:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-27T16:11:57+0000\'\u003e27\\/Dec\\/11 16:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf I disable the istat daemon, I still the the timeout but now the error is reported as it should and the transaction is aborted and my code continues.  With the itstat deamon enabled, then the lock timeout is discovered and signaled by exception being thrown but between the time it gets caught and processed, the istat daemon has set the \\\"isValid\\\" property of the statement to \\\"false\\\".  The original lock timeout exception is caught but then the \u003c\\/p\u003e\\n\\n\u003cp\u003e    Activation.checkStatementValidity()\u003c\\/p\u003e\\n\\n\u003cp\u003eis called in the exception handler.  This finds that the statement is not valid (isValid == false) and throws its own exception indicating that a recompilation is required, swallowing the original lock timeout exception in the process.  This causes the existing statement to be rebuilt and re-executed but the locks are still present, the lock timeout will occur again, the lock timeout exception will be thrown, the istat daemon will set the \\\"isValid\\\" to false again, etc.  The process just continues forever.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch that I attached to the bug only calls\u003c\\/p\u003e\\n\\n\u003cp\u003e    Activation.checkStatementValidity()\u003c\\/p\u003e\\n\\n\u003cp\u003ein the exception handler if the caught exception is not set to REPORT_ALWAYS.  This seem okay and to make sense because if the code is handling an exception that is to be REPORT_ALWAYS, there is no sense looking for a statement that is invalid; just report the exception.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13176216_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13176216_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Dec\\/11 16:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-27T16:11:57+0000\'\u003e27\\/Dec\\/11 16:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If I disable the istat daemon, I still the the timeout but now the error is reported as it should and the transaction is aborted and my code continues.  With the itstat deamon enabled, then the lock timeout is discovered and signaled by exception being thrown but between the time it gets caught and processed, the istat daemon has set the \\\"isValid\\\" property of the statement to \\\"false\\\".  The original lock timeout exception is caught but then the  \\n\\n     Activation.checkStatementValidity() \\n\\n is called in the exception handler.  This finds that the statement is not valid (isValid == false) and throws its own exception indicating that a recompilation is required, swallowing the original lock timeout exception in the process.  This causes the existing statement to be rebuilt and re-executed but the locks are still present, the lock timeout will occur again, the lock timeout exception will be thrown, the istat daemon will set the \\\"isValid\\\" to false again, etc.  The process just continues forever. \\n\\n The patch that I attached to the bug only calls \\n\\n     Activation.checkStatementValidity() \\n\\n in the exception handler if the caught exception is not set to REPORT_ALWAYS.  This seem okay and to make sense because if the code is handling an exception that is to be REPORT_ALWAYS, there is no sense looking for a statement that is invalid; just report the exception.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13177292\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13177292&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13177292\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13177292_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13177292_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Dec\\/11 18:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-29T18:02:38+0000\'\u003e29\\/Dec\\/11 18:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have found the cause of the problem.  When a lock timeout or deadlock is detected, the server calls XATransactionState.cleanupOnError.   This looks like:\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e\\tpublic void cleanupOnError(Throwable t) {\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\tif (t instanceof StandardException) {\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\t\\tStandardException se = (StandardException) t;\u003c\\/p\u003e\\n\\n\u003cp\u003e            if (se.getSeverity() &gt;= ExceptionSeverity.SESSION_SEVERITY) \u003c\\/p\u003e\\n{\\n                popMe();\\n                return;\\n            }\\n\\n\u003cp\u003e\\t\\t\\tif (se.getSeverity() == ExceptionSeverity.TRANSACTION_SEVERITY) {\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\t\\t\\tsynchronized (this) \u003c\\/p\u003e\\n{\\n\\t\\t\\t\\t\\t\\/\\/ disable use of the connection until it is cleaned up.\\n\\t\\t\\t\\t\\tconn.setApplicationConnection(null);\\n\\t\\t\\t\\t\\tnotifyAll();\\n\\t\\t\\t\\t\\tassociationState = TRO_FAIL;\\n\\t\\t\\t\\t\\tif (SQLState.DEADLOCK.equals(se.getMessageId()))\\n\\t\\t\\t\\t\\t\\trollbackOnlyCode = XAException.XA_RBDEADLOCK;\\n\\t\\t\\t\\t\\telse if (SQLState.LOCK_TIMEOUT.equals(se.getMessageId()))\\n\\t\\t\\t\\t\\t\\trollbackOnlyCode = XAException.XA_RBTIMEOUT;\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\telse\\n\\t\\t\\t\\t\\t\\trollbackOnlyCode = XAException.XA_RBOTHER;\\n\\t\\t\\t\\t}\\n\u003cp\u003e\\t\\t\\t}\u003cbr\\/\u003e\\n\\t\\t}\u003cbr\\/\u003e\\n\\t}\u003c\\/p\u003e\\n\\n\u003cp\u003eThe problem is the line of code:\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\t\\t\\t\\tconn.setApplicationConnection(null);\u003c\\/p\u003e\\n\\n\u003cp\u003eThe problem that occurs is on the client side, when the SQLException is received, it ends up calling Sqlca.getMessage() to retrieve the formatted exception message.  This makes a call back down to the server on the connection and ends up calling EmbedStatement.checkStatus() and now the EmbedConnection has a null \\\"applicationConnection\\\" and a noCurrentConnection is throw.   DRDA code that receives this exception in processing of Sqlca.getMessage() determines that there is a protocol error and disconnects from the server.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe XA transaction that was in process never has \\\"end\\\" called on it and the XA transaction on the client side is now lost.  Derby now has a XA transaction that will never end causing all kinds of havoc such as logging all new transactions in case the one lost ever does get rolled back.  The file system fill up with transaction logs, restarting the database engine takes days, etc.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have commented out the above line and now the proper lock error is actually reported at the client.  I don\'t know if there are any ramifications of doing so at this point however.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13177292_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13177292_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Dec\\/11 18:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-29T18:02:38+0000\'\u003e29\\/Dec\\/11 18:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have found the cause of the problem.  When a lock timeout or deadlock is detected, the server calls XATransactionState.cleanupOnError.   This looks like: \\n\\n\\n \\tpublic void cleanupOnError(Throwable t) { \\n\\n \\t\\tif (t instanceof StandardException) { \\n\\n \\t\\t\\tStandardException se = (StandardException) t; \\n\\n             if (se.getSeverity() &gt;= ExceptionSeverity.SESSION_SEVERITY)  \\n{\\n                popMe();\\n                return;\\n            }\\n\\n \\t\\t\\tif (se.getSeverity() == ExceptionSeverity.TRANSACTION_SEVERITY) { \\n\\n \\t\\t\\t\\tsynchronized (this)  \\n{\\n\\t\\t\\t\\t\\t\\/\\/ disable use of the connection until it is cleaned up.\\n\\t\\t\\t\\t\\tconn.setApplicationConnection(null);\\n\\t\\t\\t\\t\\tnotifyAll();\\n\\t\\t\\t\\t\\tassociationState = TRO_FAIL;\\n\\t\\t\\t\\t\\tif (SQLState.DEADLOCK.equals(se.getMessageId()))\\n\\t\\t\\t\\t\\t\\trollbackOnlyCode = XAException.XA_RBDEADLOCK;\\n\\t\\t\\t\\t\\telse if (SQLState.LOCK_TIMEOUT.equals(se.getMessageId()))\\n\\t\\t\\t\\t\\t\\trollbackOnlyCode = XAException.XA_RBTIMEOUT;\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\telse\\n\\t\\t\\t\\t\\t\\trollbackOnlyCode = XAException.XA_RBOTHER;\\n\\t\\t\\t\\t}\\n \\t\\t\\t} \\n\\t\\t} \\n\\t} \\n\\n The problem is the line of code: \\n\\n \\t\\t\\t\\t\\tconn.setApplicationConnection(null); \\n\\n The problem that occurs is on the client side, when the SQLException is received, it ends up calling Sqlca.getMessage() to retrieve the formatted exception message.  This makes a call back down to the server on the connection and ends up calling EmbedStatement.checkStatus() and now the EmbedConnection has a null \\\"applicationConnection\\\" and a noCurrentConnection is throw.   DRDA code that receives this exception in processing of Sqlca.getMessage() determines that there is a protocol error and disconnects from the server. \\n\\n The XA transaction that was in process never has \\\"end\\\" called on it and the XA transaction on the client side is now lost.  Derby now has a XA transaction that will never end causing all kinds of havoc such as logging all new transactions in case the one lost ever does get rolled back.  The file system fill up with transaction logs, restarting the database engine takes days, etc. \\n\\n I have commented out the above line and now the proper lock error is actually reported at the client.  I don\'t know if there are any ramifications of doing so at this point however.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13178750\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13178750&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13178750\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13178750_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13178750_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T14:29:43+0000\'\u003e03\\/Jan\\/12 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch makes sure that if a StandardException is set to REPORT_ALWAYS, no check is made to see if the statement is invalid and rebuild; the exception is just thrown.  This stops lock timeouts and deadlocks from being swallowed.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13178750_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13178750_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T14:29:43+0000\'\u003e03\\/Jan\\/12 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch makes sure that if a StandardException is set to REPORT_ALWAYS, no check is made to see if the statement is invalid and rebuild; the exception is just thrown.  This stops lock timeouts and deadlocks from being swallowed. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13178752\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13178752&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13178752\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13178752_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13178752_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 14:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T14:37:08+0000\'\u003e03\\/Jan\\/12 14:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch removed the null\'ing out of the application connection during cleanup from a lock timeout or lock deadlock.  The application connection is needed because the client code calls back on the connection to retrieve the formatted exception message and if this application connection is null, then a NoCurrentConnection SQLException is thrown during this.  This causes the client to see a DRDA protocol exception and terminate without ever ending an in progress XA transaction.   The XA transaction is now hanging around in the database, the client side has lost track of it, and all manner of things go wrong from that point.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13178752_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13178752_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 14:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T14:37:08+0000\'\u003e03\\/Jan\\/12 14:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch removed the null\'ing out of the application connection during cleanup from a lock timeout or lock deadlock.  The application connection is needed because the client code calls back on the connection to retrieve the formatted exception message and if this application connection is null, then a NoCurrentConnection SQLException is thrown during this.  This causes the client to see a DRDA protocol exception and terminate without ever ending an in progress XA transaction.   The XA transaction is now hanging around in the database, the client side has lost track of it, and all manner of things go wrong from that point. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13178857\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13178857&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13178857\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13178857_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13178857_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 17:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T17:49:22+0000\'\u003e03\\/Jan\\/12 17:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll work on a test case for this issue and run the patch through regression tests.  I wouldn\'t  think a lock timeout wouldn\'t be a transaction level error but a deadlock would be.\u003c\\/p\u003e\\n\\n\u003cp\u003e\\tif (se.getSeverity() == ExceptionSeverity.TRANSACTION_SEVERITY) {\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\t\\t\\tsynchronized (this) {\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\/\\/ disable use of the connection until it is cleaned up.\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\tconn.setApplicationConnection(null);\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eIt makes sense that the connection is needed to retrieve the error message text, but clearly someone at some point thought it was important not to let anything happen on this connection until the transaction was cleaned up.  It would be good to understand the scenarios for which this this code was introduced.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13178857_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13178857_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 17:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T17:49:22+0000\'\u003e03\\/Jan\\/12 17:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll work on a test case for this issue and run the patch through regression tests.  I wouldn\'t  think a lock timeout wouldn\'t be a transaction level error but a deadlock would be. \\n\\n \\tif (se.getSeverity() == ExceptionSeverity.TRANSACTION_SEVERITY) { \\n\\n \\t\\t\\t\\tsynchronized (this) { \\n\\t\\t\\t\\t\\t\\/\\/ disable use of the connection until it is cleaned up. \\n\\t\\t\\t\\t\\tconn.setApplicationConnection(null); \\n\\n\\n It makes sense that the connection is needed to retrieve the error message text, but clearly someone at some point thought it was important not to let anything happen on this connection until the transaction was cleaned up.  It would be good to understand the scenarios for which this this code was introduced. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13178913\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13178913&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13178913\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13178913_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13178913_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 18:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T18:53:34+0000\'\u003e03\\/Jan\\/12 18:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI checked the original code and this has been in there since the initial import as far as I can tell from Subversion\'s history.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI also just check the code more.  The cleanup is synchronous (I believe this is true), so that thread of control will not use the connection until it returns. \u003c\\/p\u003e\\n\\n\u003cp\u003eAs for other threads, each of the other methods are synchronized on the XATransactionState instance so no other thread will be allowed on the XATransactionState instance while the cleanup is in progress as it also synchronizes on the XATransactionState instance.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are 3 other places where conn.setApplicationConnection(null) is called but all three are in XATransactionState.end(), which again, is synchronized on the XATransactionState instance.  \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13178913_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13178913_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 18:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T18:53:34+0000\'\u003e03\\/Jan\\/12 18:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I checked the original code and this has been in there since the initial import as far as I can tell from Subversion\'s history.   \\n\\n I also just check the code more.  The cleanup is synchronous (I believe this is true), so that thread of control will not use the connection until it returns.  \\n\\n As for other threads, each of the other methods are synchronized on the XATransactionState instance so no other thread will be allowed on the XATransactionState instance while the cleanup is in progress as it also synchronizes on the XATransactionState instance. \\n\\n There are 3 other places where conn.setApplicationConnection(null) is called but all three are in XATransactionState.end(), which again, is synchronized on the XATransactionState instance.   \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13179094\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13179094&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13179094\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_13179094_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13179094_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 22:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T22:44:08+0000\'\u003e03\\/Jan\\/12 22:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat about getApplicationState which reads applicationConnection? For example, it seems this is called unsynchronized, e.g from EmbedResultSet#movePosition -&gt; checkExecIfClosed -&gt; getEmbedConnection().getApplicationConnection(). If applicationConnection is no nulled, could that break the logic in checkExecIfClosed? There are other cases of calls to getApplicationState which I didn\'t look at yet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_13179094_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13179094_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/12 22:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-03T22:44:08+0000\'\u003e03\\/Jan\\/12 22:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What about getApplicationState which reads applicationConnection? For example, it seems this is called unsynchronized, e.g from EmbedResultSet#movePosition -&gt; checkExecIfClosed -&gt; getEmbedConnection().getApplicationConnection(). If applicationConnection is no nulled, could that break the logic in checkExecIfClosed? There are other cases of calls to getApplicationState which I didn\'t look at yet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13179221\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13179221&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13179221\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13179221_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13179221_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/12 01:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-04T01:51:11+0000\'\u003e04\\/Jan\\/12 01:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI guess where I am coming from is that the cleanup for a lock timeout or deadlock is NOT closing the connection nor should it be.  The connection IS going to be used again right after the cleanup returns the error to retrieve the exception message text.  So nulling out the connection is wrong the way it is.  The other places where the connection is nulled out are when the XA end is being processed.  Now the application level connection is no longer being used because XA has been signaled that there is no more interaction using the connection, so to me this make sense.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne thing to remember is that the change is only affecting the XA transactions, not the general usagen.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs for the other calls not being synchronized, maybe they should be but I don\'t know.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13179221_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13179221_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/12 01:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-04T01:51:11+0000\'\u003e04\\/Jan\\/12 01:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I guess where I am coming from is that the cleanup for a lock timeout or deadlock is NOT closing the connection nor should it be.  The connection IS going to be used again right after the cleanup returns the error to retrieve the exception message text.  So nulling out the connection is wrong the way it is.  The other places where the connection is nulled out are when the XA end is being processed.  Now the application level connection is no longer being used because XA has been signaled that there is no more interaction using the connection, so to me this make sense. \\n\\n One thing to remember is that the change is only affecting the XA transactions, not the general usagen. \\n\\n As for the other calls not being synchronized, maybe they should be but I don\'t know.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13179995\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13179995&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13179995\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13179995_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13179995_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/12 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-04T23:49:55+0000\'\u003e04\\/Jan\\/12 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe attached reproduction ReproDerby5552LockTimeout.java shows the loss of connection with a lock timeout and resulting protocol error.   It doesn\'t show the hang, but as I understand it that might be a separate synchronization issue.\u003cbr\\/\u003e\\n$ java ReproDerby5552LockTimeout\u003cbr\\/\u003e\\nWed Jan 04 15:34:10 PST 2012 : Apache Derby Network Server - 10.9.0.0 alpha - (1227344) started and ready to accept conn\u003cbr\\/\u003e\\nections on port 1597\u003cbr\\/\u003e\\nExpected Exception java.sql.SQLTransactionRollbackException: DERBY SQL error: SQLCODE: -1, SQLSTATE: 40XL1, SQLERRMC: 40\u003cbr\\/\u003e\\nXL1\u003cbr\\/\u003e\\nConnection ok. got right value\u003cbr\\/\u003e\\nException in thread \\\"main\\\" java.sql.SQLNonTransientConnectionException: A network protocol error was encountered and the\u003cbr\\/\u003e\\n connection has been terminated: the requested command encountered an unarchitected and implementation-specific conditio\u003cbr\\/\u003e\\nn for which there was no architected message (additional information may be available in the derby.log file on the serve\u003cbr\\/\u003e\\nr)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:364)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.Connection.createStatement(Connection.java:379)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.LogicalConnection.createStatement(LogicalConnection.java:164)\u003cbr\\/\u003e\\n        at ReproDerby5552LockTimeout.checkConn(ReproDerby5552LockTimeout.java:85)\u003cbr\\/\u003e\\n        at ReproDerby5552LockTimeout.main(ReproDerby5552LockTimeout.java:66)\u003cbr\\/\u003e\\nCaused by: org.apache.derby.client.am.SqlException: A network protocol error was encountered and the connection has been\u003cbr\\/\u003e\\n terminated: the requested command encountered an unarchitected and implementation-specific condition for which there wa\u003cbr\\/\u003e\\ns no architected message (additional information may be available in the derby.log file on the server)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.SqlException.copyAsUnchainedSQLException(SqlException.java:511)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.Sqlca.chainDeferredExceptionsToAgentOrAsConnectionWarnings(Sqlca.java:346)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.Sqlca.getJDBCMessage(Sqlca.java:308)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.SqlException.getMessage(SqlException.java:408)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:364)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.Statement.executeQuery(Statement.java:486)\u003cbr\\/\u003e\\n        at ReproDerby5552LockTimeout.main(ReproDerby5552LockTimeout.java:57)\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13179995_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13179995_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/12 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-04T23:49:55+0000\'\u003e04\\/Jan\\/12 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The attached reproduction ReproDerby5552LockTimeout.java shows the loss of connection with a lock timeout and resulting protocol error.   It doesn\'t show the hang, but as I understand it that might be a separate synchronization issue. \\n$ java ReproDerby5552LockTimeout \\nWed Jan 04 15:34:10 PST 2012 : Apache Derby Network Server - 10.9.0.0 alpha - (1227344) started and ready to accept conn \\nections on port 1597 \\nExpected Exception java.sql.SQLTransactionRollbackException: DERBY SQL error: SQLCODE: -1, SQLSTATE: 40XL1, SQLERRMC: 40 \\nXL1 \\nConnection ok. got right value \\nException in thread \\\"main\\\" java.sql.SQLNonTransientConnectionException: A network protocol error was encountered and the \\n connection has been terminated: the requested command encountered an unarchitected and implementation-specific conditio \\nn for which there was no architected message (additional information may be available in the derby.log file on the serve \\nr) \\n        at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71) \\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:364) \\n        at org.apache.derby.client.am.Connection.createStatement(Connection.java:379) \\n        at org.apache.derby.client.am.LogicalConnection.createStatement(LogicalConnection.java:164) \\n        at ReproDerby5552LockTimeout.checkConn(ReproDerby5552LockTimeout.java:85) \\n        at ReproDerby5552LockTimeout.main(ReproDerby5552LockTimeout.java:66) \\nCaused by: org.apache.derby.client.am.SqlException: A network protocol error was encountered and the connection has been \\n terminated: the requested command encountered an unarchitected and implementation-specific condition for which there wa \\ns no architected message (additional information may be available in the derby.log file on the server) \\n        at org.apache.derby.client.am.SqlException.copyAsUnchainedSQLException(SqlException.java:511) \\n        at org.apache.derby.client.am.Sqlca.chainDeferredExceptionsToAgentOrAsConnectionWarnings(Sqlca.java:346) \\n        at org.apache.derby.client.am.Sqlca.getJDBCMessage(Sqlca.java:308) \\n        at org.apache.derby.client.am.SqlException.getMessage(SqlException.java:408) \\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:364) \\n        at org.apache.derby.client.am.Statement.executeQuery(Statement.java:486) \\n        at ReproDerby5552LockTimeout.main(ReproDerby5552LockTimeout.java:57) \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13180258\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13180258&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13180258\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_13180258_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13180258_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jan\\/12 09:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-05T09:52:51+0000\'\u003e05\\/Jan\\/12 09:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTried the repro, I had to replace \\\"new utilXid\\\" with XATestUtil.getXid calls, then it worked. FYI, the timeout property is misspelt as \\\"derby.locks.locktimeout\\\", I had to change it to \\\"derby.locks.waitTimeout\\\", not that it matters, I just was suprprised I had to wait to long (default is 60s) for the timeout to happen. \u003c\\/p\u003e\\n\\n\u003cp\u003eInterestingly, if I use EmbeddedXADataSource instead of client ditto, the following call throws:\u003c\\/p\u003e\\n\\n\u003cp\u003e     checkConn(conn2);\u003c\\/p\u003e\\n\\n\u003cp\u003eagain, due to the error cleanup having nulled out\u003cbr\\/\u003e\\n\\\"applicationConnection\\\", cf. in this stack trace the frame\u003cbr\\/\u003e\\nEmbedStatement#getConnection which has this code:\u003c\\/p\u003e\\n\\n\u003cp\u003e   java.sql.Connection appConn = getEmbedConnection().getApplicationConnection();\u003c\\/p\u003e\\n\\n\u003cp\u003e   if ((appConn != applicationConnection) || (appConn == null)) {\u003cbr\\/\u003e\\n      throw Util.noCurrentConnection();\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e---------------------------------------------------------------- repro output\u003cbr\\/\u003e\\nExpected Exception java.sql.SQLTransactionRollbackException: A\u003cbr\\/\u003e\\nlock could not be obtained within the time requested Connection\u003cbr\\/\u003e\\nok. got right value Exception in thread \\\"main\\\"\u003cbr\\/\u003e\\njava.sql.SQLNonTransientConnectionException: No current connection.\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:77)\u003cbr\\/\u003e\\nat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\u003cbr\\/\u003e\\nat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:158)\u003cbr\\/\u003e\\nat org.apache.derby.impl.jdbc.Util.noCurrentConnection(Util.java:262)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.impl.jdbc.EmbedStatement.getConnection(EmbedStatement.java:1039)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.iapi.jdbc.BrokeredStatement.controlCheck(BrokeredStatement.java:525)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.iapi.jdbc.BrokeredStatement.getResultSetHoldability(BrokeredStatement.java:469)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.iapi.jdbc.BrokeredStatement.&lt;init&gt;(BrokeredStatement.java:63)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.iapi.jdbc.BrokeredStatement40.&lt;init&gt;(BrokeredStatement40.java:37)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.iapi.jdbc.BrokeredConnection40.newBrokeredStatement(BrokeredConnection40.java:260)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.jdbc.XAStatementControl.&lt;init&gt;(XAStatementControl.java:64)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.jdbc.EmbedXAConnection.wrapStatement(EmbedXAConnection.java:192)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.iapi.jdbc.BrokeredConnection.createStatement(BrokeredConnection.java:100)\u003cbr\\/\u003e\\nat derby5552repro.Derby5552Repro.checkConn(Derby5552Repro.java:96) at\u003cbr\\/\u003e\\nderby5552repro.Derby5552Repro.main(Derby5552Repro.java:76) Caused by:\u003cbr\\/\u003e\\njava.sql.SQLException: No current connection.  at\u003cbr\\/\u003e\\norg.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)\u003cbr\\/\u003e\\nat\u003cbr\\/\u003e\\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\u003cbr\\/\u003e\\n... 14 more Java Result: 1 BUILD SUCCESSFUL (total time: 21 minutes 51\u003cbr\\/\u003e\\nseconds)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_13180258_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13180258_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jan\\/12 09:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-05T09:52:51+0000\'\u003e05\\/Jan\\/12 09:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Tried the repro, I had to replace \\\"new utilXid\\\" with XATestUtil.getXid calls, then it worked. FYI, the timeout property is misspelt as \\\"derby.locks.locktimeout\\\", I had to change it to \\\"derby.locks.waitTimeout\\\", not that it matters, I just was suprprised I had to wait to long (default is 60s) for the timeout to happen.  \\n\\n Interestingly, if I use EmbeddedXADataSource instead of client ditto, the following call throws: \\n\\n      checkConn(conn2); \\n\\n again, due to the error cleanup having nulled out \\n\\\"applicationConnection\\\", cf. in this stack trace the frame \\nEmbedStatement#getConnection which has this code: \\n\\n    java.sql.Connection appConn = getEmbedConnection().getApplicationConnection(); \\n\\n    if ((appConn != applicationConnection) || (appConn == null)) { \\n      throw Util.noCurrentConnection(); \\n\\n\\n ---------------------------------------------------------------- repro output \\nExpected Exception java.sql.SQLTransactionRollbackException: A \\nlock could not be obtained within the time requested Connection \\nok. got right value Exception in thread \\\"main\\\" \\njava.sql.SQLNonTransientConnectionException: No current connection. \\nat \\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:77) \\nat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) \\nat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:158) \\nat org.apache.derby.impl.jdbc.Util.noCurrentConnection(Util.java:262) \\nat \\norg.apache.derby.impl.jdbc.EmbedStatement.getConnection(EmbedStatement.java:1039) \\nat \\norg.apache.derby.iapi.jdbc.BrokeredStatement.controlCheck(BrokeredStatement.java:525) \\nat \\norg.apache.derby.iapi.jdbc.BrokeredStatement.getResultSetHoldability(BrokeredStatement.java:469) \\nat \\norg.apache.derby.iapi.jdbc.BrokeredStatement.&lt;init&gt;(BrokeredStatement.java:63) \\nat \\norg.apache.derby.iapi.jdbc.BrokeredStatement40.&lt;init&gt;(BrokeredStatement40.java:37) \\nat \\norg.apache.derby.iapi.jdbc.BrokeredConnection40.newBrokeredStatement(BrokeredConnection40.java:260) \\nat \\norg.apache.derby.jdbc.XAStatementControl.&lt;init&gt;(XAStatementControl.java:64) \\nat \\norg.apache.derby.jdbc.EmbedXAConnection.wrapStatement(EmbedXAConnection.java:192) \\nat \\norg.apache.derby.iapi.jdbc.BrokeredConnection.createStatement(BrokeredConnection.java:100) \\nat derby5552repro.Derby5552Repro.checkConn(Derby5552Repro.java:96) at \\nderby5552repro.Derby5552Repro.main(Derby5552Repro.java:76) Caused by: \\njava.sql.SQLException: No current connection.  at \\norg.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42) \\nat \\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122) \\nat \\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71) \\n... 14 more Java Result: 1 BUILD SUCCESSFUL (total time: 21 minutes 51 \\nseconds)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13198327\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13198327&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13198327\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13198327_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13198327_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/12 23:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-01T23:37:42+0000\'\u003e01\\/Feb\\/12 23:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is Brett\'s patch with a regression test. I am still not clear on the reason that the application connection was being set to null. There are other instances in the same files where this same approach is used on failure.  The connection seems still perfectly valid for use after the rollback.\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13198327_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13198327_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/12 23:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-01T23:37:42+0000\'\u003e01\\/Feb\\/12 23:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is Brett\'s patch with a regression test. I am still not clear on the reason that the application connection was being set to null. There are other instances in the same files where this same approach is used on failure.  The connection seems still perfectly valid for use after the rollback. \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13204029\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13204029&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13204029\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13204029_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13204029_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Feb\\/12 21:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-08T21:48:41+0000\'\u003e08\\/Feb\\/12 21:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ereattaching patch to make minor comment correction. I still would like someone more familiar with this area to look and see removing the nulling of the connection is going to cause problems in some scenarios and what those scenarios might be.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13204029_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13204029_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Feb\\/12 21:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-08T21:48:41+0000\'\u003e08\\/Feb\\/12 21:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    reattaching patch to make minor comment correction. I still would like someone more familiar with this area to look and see removing the nulling of the connection is going to cause problems in some scenarios and what those scenarios might be.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13208194\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13208194&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13208194\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13208194_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13208194_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Feb\\/12 02:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-15T02:22:52+0000\'\u003e15\\/Feb\\/12 02:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ei tried to review the change, but am not familar with the assumptions at this level.  I agree with your concern that previous comment\u003cbr\\/\u003e\\nseems to be indicating it wants to disable the connection.  The comment \\\"disable use of the connection until it is cleaned up.\\\", seems\u003cbr\\/\u003e\\nto indicate maybe it meant to reenable it after the work of:\u003cbr\\/\u003e\\n                    notifyAll();\u003cbr\\/\u003e\\n                    associationState = TRO_FAIL;\u003cbr\\/\u003e\\n                    if (SQLState.DEADLOCK.equals(se.getMessageId()))\u003cbr\\/\u003e\\n                        rollbackOnlyCode = XAException.XA_RBDEADLOCK;\u003cbr\\/\u003e\\n                    else if (se.isLockTimeout())\u003cbr\\/\u003e\\n                        rollbackOnlyCode = XAException.XA_RBTIMEOUT;\u003cbr\\/\u003e\\n                    else\u003cbr\\/\u003e\\n                        rollbackOnlyCode = XAException.XA_RBOTHER;\u003c\\/p\u003e\\n\\n\u003cp\u003eI reviewed the other comments in the issue, and agree with Brett\'s analysis of calls to cleanupOnError, and the single thread nature.\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes anyone think it worthwhile to null out the connection, perform the above code, and then reset the connection?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13208194_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13208194_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Feb\\/12 02:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-15T02:22:52+0000\'\u003e15\\/Feb\\/12 02:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    i tried to review the change, but am not familar with the assumptions at this level.  I agree with your concern that previous comment \\nseems to be indicating it wants to disable the connection.  The comment \\\"disable use of the connection until it is cleaned up.\\\", seems \\nto indicate maybe it meant to reenable it after the work of: \\n                    notifyAll(); \\n                    associationState = TRO_FAIL; \\n                    if (SQLState.DEADLOCK.equals(se.getMessageId())) \\n                        rollbackOnlyCode = XAException.XA_RBDEADLOCK; \\n                    else if (se.isLockTimeout()) \\n                        rollbackOnlyCode = XAException.XA_RBTIMEOUT; \\n                    else \\n                        rollbackOnlyCode = XAException.XA_RBOTHER; \\n\\n I reviewed the other comments in the issue, and agree with Brett\'s analysis of calls to cleanupOnError, and the single thread nature. \\n\\n Does anyone think it worthwhile to null out the connection, perform the above code, and then reset the connection? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13208434\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13208434&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13208434\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13208434_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13208434_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Feb\\/12 12:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-15T12:36:59+0000\'\u003e15\\/Feb\\/12 12:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt would be great to have picked the mind of the author of the comment and code but it appeared this was this way since the beginning.  I don\'t think it would hurt to do what you suggest but just to let you know, this code is not in production being exercised extensively (private build with this in it as I had a need to fix the problem now) with no issues found.  Just some empirical testing results.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for taking the time to look at it.\u003c\\/p\u003e\\n\\n\u003cp\u003eBrett\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bbergquist\\\" id=\\\"commentauthor_13208434_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bbergquist\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bbergquist\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Bergquist\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13208434_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Feb\\/12 12:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-15T12:36:59+0000\'\u003e15\\/Feb\\/12 12:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It would be great to have picked the mind of the author of the comment and code but it appeared this was this way since the beginning.  I don\'t think it would hurt to do what you suggest but just to let you know, this code is not in production being exercised extensively (private build with this in it as I had a need to fix the problem now) with no issues found.  Just some empirical testing results. \\n\\n Thanks for taking the time to look at it. \\n\\n Brett \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13210477\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13210477&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13210477\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13210477_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13210477_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/12 19:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-17T19:50:44+0000\'\u003e17\\/Feb\\/12 19:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTriage for 10.9. \u003cbr\\/\u003e\\nThis issue is in progress and should be committed soon.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think I am going to just double check that subsequent operations on the connection start a new local transaction and that the old global transaction is really dead.  The test confirms we cannot do an XA end but should probably also check the transaction table. If all that checks out I will  check in the change as is.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks Mike and Brett for the input.\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13210477_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13210477_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/12 19:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-17T19:50:44+0000\'\u003e17\\/Feb\\/12 19:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Triage for 10.9.  \\nThis issue is in progress and should be committed soon. \\n\\n I think I am going to just double check that subsequent operations on the connection start a new local transaction and that the old global transaction is really dead.  The test confirms we cannot do an XA end but should probably also check the transaction table. If all that checks out I will  check in the change as is. \\n\\n Thanks Mike and Brett for the input. \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13215046\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13215046&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13215046\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13215046_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13215046_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/12 21:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-23T21:01:30+0000\'\u003e23\\/Feb\\/12 21:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is a new patch derby-5552_withexpanded_test_diff.txt which expands the test to check the state of the connections and the transaction table after the lock timeout.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI think most things are working as expected. \u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThe transaction (xid2) that was rolled back due the lock timeout  is no longer in the transaction table after the lock time out.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eNew statements on the connection after the lock timeout start a new local transaction.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eXAResource.end()  on xid2 fails with an RB_TIMEOUT\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eEven though it is not in the transaction table and is holding no locks, xid2  has to be explicitly rolled back before it can be reused.  This is the one I am not sure about. Should this be necessary?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13215046_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13215046_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/12 21:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-23T21:01:30+0000\'\u003e23\\/Feb\\/12 21:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is a new patch derby-5552_withexpanded_test_diff.txt which expands the test to check the state of the connections and the transaction table after the lock timeout.   \\n\\n I think most things are working as expected.  \\n\\n \\n\\t The transaction (xid2) that was rolled back due the lock timeout  is no longer in the transaction table after the lock time out. \\n \\n\\n\\n \\n\\t New statements on the connection after the lock timeout start a new local transaction. \\n \\n\\n\\n \\n\\t XAResource.end()  on xid2 fails with an RB_TIMEOUT \\n \\n\\n\\n \\n\\t Even though it is not in the transaction table and is holding no locks, xid2  has to be explicitly rolled back before it can be reused.  This is the one I am not sure about. Should this be necessary? \\n \\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13215209\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13215209&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13215209\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13215209_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13215209_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/12 23:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-23T23:45:11+0000\'\u003e23\\/Feb\\/12 23:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRunning derbyall I see one failure a test specifically for this case expecting no connection.\u003cbr\\/\u003e\\n$ cat xaSimpleNegative.diff\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003e\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003e\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003eStart: xaSimpleNegative jdk1.7.0 derbyall:xa 2012-02-23 14:23:29 ***\u003cbr\\/\u003e\\n202 del\u003cbr\\/\u003e\\n&lt; ERROR 08003: No current connection.\u003cbr\\/\u003e\\n202a202,204\u003cbr\\/\u003e\\n&gt; A         |B\u003cbr\\/\u003e\\n&gt; ----------------------\u003cbr\\/\u003e\\n&gt; ERROR 40XL1: A lock could not be obtained within the time requested\u003cbr\\/\u003e\\nTest Failed.\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003eEnd:   xaSimpleNegative jdk1.7.0 derbyall:xa 2012-02-23 14:23:45 ***\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eSpecifically the master xaSimpleNegative.out shows we were expecting the connection to go away after the lock timeout. It also shows that we expected to be able to  still explicitly rollback the transaction. I think that is not something that would be persistent as the transaction is no longer in the transaction table.\u003c\\/p\u003e\\n\\n\u003cp\u003eij(XA)&gt; &#8211; ERROR: deadlock, transaction trashed\u003cbr\\/\u003e\\nselect * from APP.negative;\u003cbr\\/\u003e\\nA         |B          \u003cbr\\/\u003e\\n----------------------\u003cbr\\/\u003e\\nERROR 40XL1: A lock could not be obtained within the time requested\u003cbr\\/\u003e\\nij(XA)&gt; &#8211; ERROR: should have no connection underneath\u003cbr\\/\u003e\\nselect * from APP.negative;\u003cbr\\/\u003e\\nERROR 08003: No current connection.\u003cbr\\/\u003e\\nij(XA)&gt; &#8211; ERROR: should have no connection underneath and xid 2 is gone\u003cbr\\/\u003e\\nxa_end xa_suspend 2;\u003cbr\\/\u003e\\nIJ ERROR: XA_RBTIMEOUT \u003cbr\\/\u003e\\nij(XA)&gt; &#8211; ERROR: should have no connection underneath and xid 2 is gone\u003cbr\\/\u003e\\nxa_end xa_fail 2;\u003cbr\\/\u003e\\nIJ ERROR: XA_RBTIMEOUT \u003cbr\\/\u003e\\nij(XA)&gt; xa_rollback 2;\u003cbr\\/\u003e\\nij(XA)&gt; disconnect;\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I am not sure exactly what to think.   Maybe it would be worthwhile to see what other databases do.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs an aside in my google research, I noticed I actually asked about this back in 2004!\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/mail-archives.apache.org\\/mod_mbox\\/db-derby-dev\\/200411.mbox\\/%3C4186AA22.7000305@Sourcery.Org%3E\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/mail-archives.apache.org\\/mod_mbox\\/db-derby-dev\\/200411.mbox\\/%3C4186AA22.7000305@Sourcery.Org%3E\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13215209_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13215209_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/12 23:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-23T23:45:11+0000\'\u003e23\\/Feb\\/12 23:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Running derbyall I see one failure a test specifically for this case expecting no connection. \\n$ cat xaSimpleNegative.diff \\n \\n\\t \\n\\t \\n\\t\\t \\n\\t\\t \\n\\t\\t\\t Start: xaSimpleNegative jdk1.7.0 derbyall:xa 2012-02-23 14:23:29 *** \\n202 del \\n&lt; ERROR 08003: No current connection. \\n202a202,204 \\n&gt; A         |B \\n&gt; ---------------------- \\n&gt; ERROR 40XL1: A lock could not be obtained within the time requested \\nTest Failed. \\n\\t\\t\\t End:   xaSimpleNegative jdk1.7.0 derbyall:xa 2012-02-23 14:23:45 *** \\n\\t\\t \\n\\t\\t \\n\\t \\n\\t \\n \\n\\n\\n\\n Specifically the master xaSimpleNegative.out shows we were expecting the connection to go away after the lock timeout. It also shows that we expected to be able to  still explicitly rollback the transaction. I think that is not something that would be persistent as the transaction is no longer in the transaction table. \\n\\n ij(XA)&gt; &#8211; ERROR: deadlock, transaction trashed \\nselect * from APP.negative; \\nA         |B           \\n---------------------- \\nERROR 40XL1: A lock could not be obtained within the time requested \\nij(XA)&gt; &#8211; ERROR: should have no connection underneath \\nselect * from APP.negative; \\nERROR 08003: No current connection. \\nij(XA)&gt; &#8211; ERROR: should have no connection underneath and xid 2 is gone \\nxa_end xa_suspend 2; \\nIJ ERROR: XA_RBTIMEOUT  \\nij(XA)&gt; &#8211; ERROR: should have no connection underneath and xid 2 is gone \\nxa_end xa_fail 2; \\nIJ ERROR: XA_RBTIMEOUT  \\nij(XA)&gt; xa_rollback 2; \\nij(XA)&gt; disconnect; \\n\\n So I am not sure exactly what to think.   Maybe it would be worthwhile to see what other databases do. \\n\\n As an aside in my google research, I noticed I actually asked about this back in 2004! \\n http:\\/\\/mail-archives.apache.org\\/mod_mbox\\/db-derby-dev\\/200411.mbox\\/%3C4186AA22.7000305@Sourcery.Org%3E               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13216159\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13216159&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13216159\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13216159_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13216159_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/12 00:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-25T00:24:40+0000\'\u003e25\\/Feb\\/12 00:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell, I tried this out with DB2 and things are interesting and different.  The first thing of note is that the default for DB2 is no lock timeout. I had to go into Control Center and change the database application parameter LOCKTIMEOUT to be something other than -1. \u003c\\/p\u003e\\n\\n\u003cp\u003eWith DB2 after the lock timeout DB2 doesn\'t let you use the connection saying \u003cbr\\/\u003e\\nException trying to check conn2 after lock timeout but before explicit rollback\u003cbr\\/\u003e\\ncom.ibm.db2.jcc.am.SqlException: \u003cspan class=\\\"error\\\"\u003e&#91;jcc&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;t4&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;10342&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;11669&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;4.12.55&#93;\u003c\\/span\u003e Application must execute a rollback. The unit of w\u003cbr\\/\u003e\\nhas already been rolled back in the database but other resource managers involved in this unit of work might not. To\u003cbr\\/\u003e\\nure integrity of this application, all SQL requests will be rejected until the application issues a rollback.  ERROR\u003cbr\\/\u003e\\n=-4497, SQLSTATE=null\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eThen it won\'t actually let you do a rollback, but will let you do an end.  If you try rollback it fails with XAER_PROTO but a rollback after end fails with XAER_NOTA if you try to rollback after end. Statements after the end fail with XA_RBTIMEOUT  so I am not sure actually how one could use the connection again.\u003c\\/p\u003e\\n\\n\u003cp\u003eBelow is the output and attached is the program I was playing with in case anyone is interested, but I think the main thing I have learned is that since the spec doesn\'t really offer any guidance on this, we just need to do something reasonable and make sure that the global transaction doesn\'t get used again except to rollback, which I think the behavior with the patch does effectively as the activity that happens on the connection after the implicit rollback happens in a new local transaction.\u003cbr\\/\u003e\\nSo I will go ahead and check in the latest patch  with the expanded test.\u003c\\/p\u003e\\n\\n\u003cp\u003e$ java -Duser=xxxxx  -Dpassword=xxx  ReproDerby5552DB2\u003cbr\\/\u003e\\nGot Expected Lock Timeout Exception DB2 SQL Error: SQLCODE=-911, SQLSTATE=40001, SQLERRMC=68, DRIVER=4.12.55\u003cbr\\/\u003e\\nConnection ok. got right value\u003cbr\\/\u003e\\nException trying to check conn2 after lock timeout but before explicit rollback\u003cbr\\/\u003e\\ncom.ibm.db2.jcc.am.SqlException: \u003cspan class=\\\"error\\\"\u003e&#91;jcc&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;t4&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;10342&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;11669&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;4.12.55&#93;\u003c\\/span\u003e Application must execute a rollback. The unit of work\u003cbr\\/\u003e\\nhas already been rolled back in the database but other resource managers involved in this unit of work might not. To ens\u003cbr\\/\u003e\\nure integrity of this application, all SQL requests will be rejected until the application issues a rollback.  ERRORCODE\u003cbr\\/\u003e\\n=-4497, SQLSTATE=null\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:660)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:60)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:75)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.o.f(o.java:537)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.o.a(o.java:495)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.Sqlca.getJDBCMessage(Sqlca.java:334)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.SqlExceptionContainer.getMessage(SqlExceptionContainer.java:78)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.SqlTransactionRollbackException.getMessage(SqlTransactionRollbackException.java:52)\u003cbr\\/\u003e\\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:61)\u003cbr\\/\u003e\\nDid not get exception on end as with Derby\u003cbr\\/\u003e\\nGot Exception checking conn2 after end\u003cbr\\/\u003e\\ncom.ibm.db2.jcc.am.SqlException: \u003cspan class=\\\"error\\\"\u003e&#91;jcc&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;t4&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;2041&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;11392&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;4.12.55&#93;\u003c\\/span\u003e Error executing XAResource.end().  Server returned XA_R\u003cbr\\/\u003e\\nBTIMEOUT. ERRORCODE=-4203, SQLSTATE=null\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:660)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:60)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:94)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.zb.a(zb.java:2755)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.c.Xb(c.java:271)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.o.g(o.java:340)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.a.g(a.java:631)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.o.a(o.java:214)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.mn.a(mn.java:3073)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.mn.a(mn.java:686)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.mn.executeQuery(mn.java:670)\u003cbr\\/\u003e\\n        at ReproDerby5552DB2.checkConn(ReproDerby5552DB2.java:106)\u003cbr\\/\u003e\\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:86)\u003cbr\\/\u003e\\nRolling back xid2\u003cbr\\/\u003e\\nException in thread \\\"main\\\" com.ibm.db2.jcc.am.XaException: \u003cspan class=\\\"error\\\"\u003e&#91;jcc&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;t4&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;2041&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;12326&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;4.12.55&#93;\u003c\\/span\u003e Error executing XAResource.ro\u003cbr\\/\u003e\\nllback().  Server returned XAER_NOTA. ERRORCODE=-4203, SQLSTATE=null\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.c(hd.java:453)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.zb.b(zb.java:2773)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.b(ac.java:1546)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.a(ac.java:1326)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.a(ac.java:1321)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.rollback(ac.java:1310)\u003cbr\\/\u003e\\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:94)\u003c\\/p\u003e\\n\\n\u003cp\u003ekmarsden@IBM-JDPM42DBIO2 ~\\/repro\\/derby-5552\u003cbr\\/\u003e\\n$\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\u003cp\u003e$ java ReproDerby5552DB2\u003cbr\\/\u003e\\nGot Expected Lock Timeout Exception DB2 SQL Error: SQLCODE=-911, SQLSTATE=40001, SQLERRMC=6\u003cbr\\/\u003e\\nConnection ok. got right value\u003cbr\\/\u003e\\nException trying to check conn2 after lock timeout but before explicit rollback\u003cbr\\/\u003e\\ncom.ibm.db2.jcc.am.SqlException: \u003cspan class=\\\"error\\\"\u003e&#91;jcc&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;t4&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;10342&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;11669&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;4.12.55&#93;\u003c\\/span\u003e Application must execute\u003cbr\\/\u003e\\nhas already been rolled back in the database but other resource managers involved in this u\u003cbr\\/\u003e\\nure integrity of this application, all SQL requests will be rejected until the application\u003cbr\\/\u003e\\n=-4497, SQLSTATE=null\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:660)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:60)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.a(hd.java:75)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.o.f(o.java:537)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.o.a(o.java:495)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.Sqlca.getJDBCMessage(Sqlca.java:334)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.SqlExceptionContainer.getMessage(SqlExceptionContainer.java:7\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.SqlTransactionRollbackException.getMessage(SqlTransactionRoll\u003cbr\\/\u003e\\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:61)\u003cbr\\/\u003e\\nDid not get exception on end as with Derby\u003cbr\\/\u003e\\nRolling back xid2\u003cbr\\/\u003e\\nException in thread \\\"main\\\" com.ibm.db2.jcc.am.XaException: \u003cspan class=\\\"error\\\"\u003e&#91;jcc&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;t4&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;2041&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;12326&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;4.12.55&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nllback().  Server returned XAER_NOTA. ERRORCODE=-4203, SQLSTATE=null\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.c(hd.java:453)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.zb.b(zb.java:2773)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.b(ac.java:1546)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.a(ac.java:1326)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.a(ac.java:1321)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.rollback(ac.java:1310)\u003cbr\\/\u003e\\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:86)\u003cbr\\/\u003e\\nCaused by: com.ibm.db2.jcc.am.XaException: \u003cspan class=\\\"error\\\"\u003e&#91;jcc&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;t4&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;2041&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;12326&#93;\u003c\\/span\u003e\u003cspan class=\\\"error\\\"\u003e&#91;4.12.55&#93;\u003c\\/span\u003e Error executing\u003cbr\\/\u003e\\nurned XA_RBTIMEOUT. ERRORCODE=-4203, SQLSTATE=null\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.am.hd.c(hd.java:453)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.zb.b(zb.java:2773)\u003cbr\\/\u003e\\n        at com.ibm.db2.jcc.t4.ac.b(ac.java:1520)\u003cbr\\/\u003e\\n        ... 4 more\u003c\\/p\u003e\\n\\n\u003cp\u003ekmarsden@IBM-JDPM42DBIO2 ~\\/repro\\/derby-5552\u003cbr\\/\u003e\\n$\u003c\\/p\u003e\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13216159_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13216159_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/12 00:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-25T00:24:40+0000\'\u003e25\\/Feb\\/12 00:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well, I tried this out with DB2 and things are interesting and different.  The first thing of note is that the default for DB2 is no lock timeout. I had to go into Control Center and change the database application parameter LOCKTIMEOUT to be something other than -1.  \\n\\n With DB2 after the lock timeout DB2 doesn\'t let you use the connection saying  \\nException trying to check conn2 after lock timeout but before explicit rollback \\ncom.ibm.db2.jcc.am.SqlException:  &#91;jcc&#93;  &#91;t4&#93;  &#91;10342&#93;  &#91;11669&#93;  &#91;4.12.55&#93;  Application must execute a rollback. The unit of w \\nhas already been rolled back in the database but other resource managers involved in this unit of work might not. To \\nure integrity of this application, all SQL requests will be rejected until the application issues a rollback.  ERROR \\n=-4497, SQLSTATE=null \\n\\n\\n Then it won\'t actually let you do a rollback, but will let you do an end.  If you try rollback it fails with XAER_PROTO but a rollback after end fails with XAER_NOTA if you try to rollback after end. Statements after the end fail with XA_RBTIMEOUT  so I am not sure actually how one could use the connection again. \\n\\n Below is the output and attached is the program I was playing with in case anyone is interested, but I think the main thing I have learned is that since the spec doesn\'t really offer any guidance on this, we just need to do something reasonable and make sure that the global transaction doesn\'t get used again except to rollback, which I think the behavior with the patch does effectively as the activity that happens on the connection after the implicit rollback happens in a new local transaction. \\nSo I will go ahead and check in the latest patch  with the expanded test. \\n\\n $ java -Duser=xxxxx  -Dpassword=xxx  ReproDerby5552DB2 \\nGot Expected Lock Timeout Exception DB2 SQL Error: SQLCODE=-911, SQLSTATE=40001, SQLERRMC=68, DRIVER=4.12.55 \\nConnection ok. got right value \\nException trying to check conn2 after lock timeout but before explicit rollback \\ncom.ibm.db2.jcc.am.SqlException:  &#91;jcc&#93;  &#91;t4&#93;  &#91;10342&#93;  &#91;11669&#93;  &#91;4.12.55&#93;  Application must execute a rollback. The unit of work \\nhas already been rolled back in the database but other resource managers involved in this unit of work might not. To ens \\nure integrity of this application, all SQL requests will be rejected until the application issues a rollback.  ERRORCODE \\n=-4497, SQLSTATE=null \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:660) \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:60) \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:75) \\n        at com.ibm.db2.jcc.am.o.f(o.java:537) \\n        at com.ibm.db2.jcc.am.o.a(o.java:495) \\n        at com.ibm.db2.jcc.am.Sqlca.getJDBCMessage(Sqlca.java:334) \\n        at com.ibm.db2.jcc.am.SqlExceptionContainer.getMessage(SqlExceptionContainer.java:78) \\n        at com.ibm.db2.jcc.am.SqlTransactionRollbackException.getMessage(SqlTransactionRollbackException.java:52) \\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:61) \\nDid not get exception on end as with Derby \\nGot Exception checking conn2 after end \\ncom.ibm.db2.jcc.am.SqlException:  &#91;jcc&#93;  &#91;t4&#93;  &#91;2041&#93;  &#91;11392&#93;  &#91;4.12.55&#93;  Error executing XAResource.end().  Server returned XA_R \\nBTIMEOUT. ERRORCODE=-4203, SQLSTATE=null \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:660) \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:60) \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:94) \\n        at com.ibm.db2.jcc.t4.zb.a(zb.java:2755) \\n        at com.ibm.db2.jcc.t4.c.Xb(c.java:271) \\n        at com.ibm.db2.jcc.am.o.g(o.java:340) \\n        at com.ibm.db2.jcc.t4.a.g(a.java:631) \\n        at com.ibm.db2.jcc.am.o.a(o.java:214) \\n        at com.ibm.db2.jcc.am.mn.a(mn.java:3073) \\n        at com.ibm.db2.jcc.am.mn.a(mn.java:686) \\n        at com.ibm.db2.jcc.am.mn.executeQuery(mn.java:670) \\n        at ReproDerby5552DB2.checkConn(ReproDerby5552DB2.java:106) \\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:86) \\nRolling back xid2 \\nException in thread \\\"main\\\" com.ibm.db2.jcc.am.XaException:  &#91;jcc&#93;  &#91;t4&#93;  &#91;2041&#93;  &#91;12326&#93;  &#91;4.12.55&#93;  Error executing XAResource.ro \\nllback().  Server returned XAER_NOTA. ERRORCODE=-4203, SQLSTATE=null \\n        at com.ibm.db2.jcc.am.hd.c(hd.java:453) \\n        at com.ibm.db2.jcc.t4.zb.b(zb.java:2773) \\n        at com.ibm.db2.jcc.t4.ac.b(ac.java:1546) \\n        at com.ibm.db2.jcc.t4.ac.a(ac.java:1326) \\n        at com.ibm.db2.jcc.t4.ac.a(ac.java:1321) \\n        at com.ibm.db2.jcc.t4.ac.rollback(ac.java:1310) \\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:94) \\n\\n kmarsden@IBM-JDPM42DBIO2 ~\\/repro\\/derby-5552 \\n$ \\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n $ java ReproDerby5552DB2 \\nGot Expected Lock Timeout Exception DB2 SQL Error: SQLCODE=-911, SQLSTATE=40001, SQLERRMC=6 \\nConnection ok. got right value \\nException trying to check conn2 after lock timeout but before explicit rollback \\ncom.ibm.db2.jcc.am.SqlException:  &#91;jcc&#93;  &#91;t4&#93;  &#91;10342&#93;  &#91;11669&#93;  &#91;4.12.55&#93;  Application must execute \\nhas already been rolled back in the database but other resource managers involved in this u \\nure integrity of this application, all SQL requests will be rejected until the application \\n=-4497, SQLSTATE=null \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:660) \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:60) \\n        at com.ibm.db2.jcc.am.hd.a(hd.java:75) \\n        at com.ibm.db2.jcc.am.o.f(o.java:537) \\n        at com.ibm.db2.jcc.am.o.a(o.java:495) \\n        at com.ibm.db2.jcc.am.Sqlca.getJDBCMessage(Sqlca.java:334) \\n        at com.ibm.db2.jcc.am.SqlExceptionContainer.getMessage(SqlExceptionContainer.java:7 \\n        at com.ibm.db2.jcc.am.SqlTransactionRollbackException.getMessage(SqlTransactionRoll \\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:61) \\nDid not get exception on end as with Derby \\nRolling back xid2 \\nException in thread \\\"main\\\" com.ibm.db2.jcc.am.XaException:  &#91;jcc&#93;  &#91;t4&#93;  &#91;2041&#93;  &#91;12326&#93;  &#91;4.12.55&#93;  \\nllback().  Server returned XAER_NOTA. ERRORCODE=-4203, SQLSTATE=null \\n        at com.ibm.db2.jcc.am.hd.c(hd.java:453) \\n        at com.ibm.db2.jcc.t4.zb.b(zb.java:2773) \\n        at com.ibm.db2.jcc.t4.ac.b(ac.java:1546) \\n        at com.ibm.db2.jcc.t4.ac.a(ac.java:1326) \\n        at com.ibm.db2.jcc.t4.ac.a(ac.java:1321) \\n        at com.ibm.db2.jcc.t4.ac.rollback(ac.java:1310) \\n        at ReproDerby5552DB2.main(ReproDerby5552DB2.java:86) \\nCaused by: com.ibm.db2.jcc.am.XaException:  &#91;jcc&#93;  &#91;t4&#93;  &#91;2041&#93;  &#91;12326&#93;  &#91;4.12.55&#93;  Error executing \\nurned XA_RBTIMEOUT. ERRORCODE=-4203, SQLSTATE=null \\n        at com.ibm.db2.jcc.am.hd.c(hd.java:453) \\n        at com.ibm.db2.jcc.t4.zb.b(zb.java:2773) \\n        at com.ibm.db2.jcc.t4.ac.b(ac.java:1520) \\n        ... 4 more \\n\\n kmarsden@IBM-JDPM42DBIO2 ~\\/repro\\/derby-5552 \\n$ \\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13216171\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13216171&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13216171\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13216171_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13216171_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/12 00:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-25T00:34:15+0000\'\u003e25\\/Feb\\/12 00:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eChange fix version to 10.9. Leaving open for backport.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13216171_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13216171_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/12 00:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-25T00:34:15+0000\'\u003e25\\/Feb\\/12 00:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Change fix version to 10.9. Leaving open for backport.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13216174\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13216174&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13216174\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13216174_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13216174_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/12 00:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-25T00:38:16+0000\'\u003e25\\/Feb\\/12 00:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis issue has always been here. Changing affects version accordingly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13216174_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13216174_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/12 00:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-25T00:38:16+0000\'\u003e25\\/Feb\\/12 00:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This issue has always been here. Changing affects version accordingly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13218468\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13218468&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13218468\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13218468_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13218468_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/12 18:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-28T18:54:40+0000\'\u003e28\\/Feb\\/12 18:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003elink to testing task\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13218468_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13218468_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/12 18:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-28T18:54:40+0000\'\u003e28\\/Feb\\/12 18:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    link to testing task              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13218483\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13218483&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13218483\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13218483_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13218483_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/12 19:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-28T19:05:13+0000\'\u003e28\\/Feb\\/12 19:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI backported the fix and test  to 10.5.   Reassigning to Brett who provided the code patch.\u003cbr\\/\u003e\\nFiled \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-5633\\\" title=\\\"Add tests for state transition and behavior with Lock Timeout in XA Transaction (DERBY-5552 testing task)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-5633\\\"\u003e\u003cdel\u003eDERBY-5633\u003c\\/del\u003e\u003c\\/a\u003e for the testing.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13218483_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13218483_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/12 19:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-28T19:05:13+0000\'\u003e28\\/Feb\\/12 19:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I backported the fix and test  to 10.5.   Reassigning to Brett who provided the code patch. \\nFiled   DERBY-5633   for the testing. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13218487\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13218487&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13218487\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13218487_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13218487_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/12 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-28T19:06:14+0000\'\u003e28\\/Feb\\/12 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eResolving. I only went back as far is 10.5 but it certainly would be appropriate to backport further if needed.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks Brett for tthe fix!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_13218487_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13218487_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/12 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-02-28T19:06:14+0000\'\u003e28\\/Feb\\/12 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Resolving. I only went back as far is 10.5 but it certainly would be appropriate to backport further if needed. \\n\\n Thanks Brett for tthe fix!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13823391\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-5552?focusedCommentId=13823391&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13823391\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13823391_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823391_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 08:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T08:15:07+0000\'\u003e15\\/Nov\\/13 08:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;bulk update: close all resolved issues that haven&#39;t had any activity the last year&#93;\u003c\\/span\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13823391_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13823391_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/13 08:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-15T08:15:07+0000\'\u003e15\\/Nov\\/13 08:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;bulk update: close all resolved issues that haven&#39;t had any activity the last year&#93;               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520240399161"> 
    <input type="hidden" title="jira.request.server.time" value="288"> 
    <input type="hidden" title="jira.request.id" value="539x94423829x4"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="2"> 
    <input type="hidden" title="db.reads.time.in.ms" value="47"> 
    <input type="hidden" title="db.conns.time.in.ms" value="54"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 539x94423829x4
	          REQUEST TIMESTAMP : [05/Mar/2018:08:59:59 +0000]
	               REQUEST TIME : 0.2880
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 2

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=21, elapsedTotal=47707560, elapsedMin=594504, elapsedMax=15232767, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=25, elapsedTotal=54892601, elapsedMin=579172, elapsedMax=15331979, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>