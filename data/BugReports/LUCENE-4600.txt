<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|6f6b12a78a15c0982ce6ce9645d871e3fd1e7485|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"f185c1078a527f\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-4600"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-4600] Explore facets aggregation during documents collection - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-4600] Explore facets aggregation during documents collection - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-4600">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-4600" href="/jira/browse/LUCENE-4600" id="key-val" rel="12622946">LUCENE-4600</a></li>
                </ol>
                <h1 id="summary-val">Explore facets aggregation during documents collection</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-4600"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-4600/LUCENE-4600.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-4600/LUCENE-4600.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-4600/LUCENE-4600.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-4600/LUCENE-4600.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.2" title="4.2 Major release after 4.1">4.2</a>, <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+6.0" title="6.0 Major release after 5.5">6.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22modules%2Ffacet%22" title="modules/facet Faceted Indexing &amp; Search module">modules/facet</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12622946-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span>, 
                        <span>Patch Available</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Today the facet module simply gathers all hits (as a bitset, optionally with a float[] to hold scores as well, if you will aggregate them) during collection, and then at the end when you call getFacetsResults(), it makes a 2nd pass over all those hits doing the actual aggregation.</p> 
                  <p>We should investigate just aggregating as we collect instead, so we don't have to tie up transient RAM (fairly small for the bit set but possibly big for the float[]).</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-4600?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-4600?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-4600?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-4600?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12565734" data-issue-id="12622946" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12565734/LUCENE-4600.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565734/LUCENE-4600.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12565734/LUCENE-4600.patch" title="Latest  21/Jan/13 06:17 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565734/LUCENE-4600.patch">LUCENE-4600.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-01-21T06:17:01.336Z">21/Jan/13 06:17</time>
                   </dd>
                   <dd class="attachment-size">
                    96 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12565688" data-issue-id="12622946" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12565688/LUCENE-4600.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565688/LUCENE-4600.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12565688/LUCENE-4600.patch" title=" 20/Jan/13 15:20 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565688/LUCENE-4600.patch">LUCENE-4600.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-01-20T15:20:28.937Z">20/Jan/13 15:20</time>
                   </dd>
                   <dd class="attachment-size">
                    114 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12565670" data-issue-id="12622946" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12565670/LUCENE-4600.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565670/LUCENE-4600.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12565670/LUCENE-4600.patch" title=" 20/Jan/13 06:37 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565670/LUCENE-4600.patch">LUCENE-4600.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-01-20T06:37:24.452Z">20/Jan/13 06:37</time>
                   </dd>
                   <dd class="attachment-size">
                    110 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12565549" data-issue-id="12622946" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12565549/LUCENE-4600.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565549/LUCENE-4600.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12565549/LUCENE-4600.patch" title=" 18/Jan/13 20:27 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565549/LUCENE-4600.patch">LUCENE-4600.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-01-18T20:27:49.250Z">18/Jan/13 20:27</time>
                   </dd>
                   <dd class="attachment-size">
                    85 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12565479" data-issue-id="12622946" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12565479/LUCENE-4600.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565479/LUCENE-4600.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12565479/LUCENE-4600.patch" title=" 18/Jan/13 14:59 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12565479/LUCENE-4600.patch">LUCENE-4600.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-01-18T14:59:04.481Z">18/Jan/13 14:59</time>
                   </dd>
                   <dd class="attachment-size">
                    85 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12560047" data-issue-id="12622946" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12560047/LUCENE-4600.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12560047/LUCENE-4600.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12560047/LUCENE-4600.patch" title=" 08/Dec/12 21:19 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12560047/LUCENE-4600.patch">LUCENE-4600.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-12-08T21:19:50.015Z">08/Dec/12 21:19</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12560039" data-issue-id="12622946" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12560039/LUCENE-4600.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12560039/LUCENE-4600.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12560039/LUCENE-4600.patch" title=" 08/Dec/12 18:58 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-4600.patch:https://issues.apache.org/jira/secure/attachment/12560039/LUCENE-4600.patch">LUCENE-4600.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-12-08T18:58:14.924Z">08/Dec/12 18:58</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12560107" data-issue-id="12622946" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12560107/LUCENE-4600-cli.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4600-cli.patch:https://issues.apache.org/jira/secure/attachment/12560107/LUCENE-4600-cli.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12560107/LUCENE-4600-cli.patch" title="Latest  09/Dec/12 18:37 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-4600-cli.patch:https://issues.apache.org/jira/secure/attachment/12560107/LUCENE-4600-cli.patch">LUCENE-4600-cli.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-12-09T18:37:00.690Z">09/Dec/12 18:37</time>
                   </dd>
                   <dd class="attachment-size">
                    24 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="contains">
                   contains
                  </dt> 
                  <dd id="internal-12623543_12310060"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="LUCENE-4619: Create a specialized path for facets counting"> <a href="/jira/browse/LUCENE-4619" data-issue-key="LUCENE-4619" class="issue-link link-title resolution">LUCENE-4619</a> <span class="link-summary">Create a specialized path for facets counting</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_shaie" rel="shaie" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Shai Erera&quot;,&quot;emailAddress&quot;:&quot;serera@gmail.com&quot;,&quot;username&quot;:&quot;shaie&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="shaie"></span></span> Shai Erera </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_mikemccand" rel="mikemccand" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Michael McCandless&quot;,&quot;emailAddress&quot;:&quot;lucene@mikemccandless.com&quot;,&quot;username&quot;:&quot;mikemccand&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mikemccand"></span></span> Michael McCandless </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">3</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="07/Dec/12 18:37"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-12-07T18:37:32+0000">07/Dec/12 18:37</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="09/May/16 18:38"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-05-09T18:38:25+0000">09/May/16 18:38</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="21/Jan/13 16:22"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-01-21T16:22:28+0000">21/Jan/13 16:22</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4600?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4600?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13526630\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13526630&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13526630\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13526630_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13526630_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/12 18:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-07T18:43:59+0000\'\u003e07\\/Dec\\/12 18:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust one comment, sampling benefits from this two pass, because that way we can guarantee a minimum sample set size. Maybe there\'s way to achieve that with in-collection aggregation too, but noting it here so that it\'s in our minds.\u003c\\/p\u003e\\n\\n\u003cp\u003eSee my comment on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4598\\\" title=\\\"Change PayloadIterator to not use top-level reader API\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4598\\\"\u003e\u003cdel\u003eLUCENE-4598\u003c\\/del\u003e\u003c\\/a\u003e, the bitset may not be that small \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13526630_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13526630_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/12 18:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-07T18:43:59+0000\'\u003e07\\/Dec\\/12 18:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just one comment, sampling benefits from this two pass, because that way we can guarantee a minimum sample set size. Maybe there\'s way to achieve that with in-collection aggregation too, but noting it here so that it\'s in our minds. \\n\\n See my comment on   LUCENE-4598  , the bitset may not be that small  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13526678\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13526678&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13526678\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13526678_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13526678_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/12 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-07T19:23:29+0000\'\u003e07\\/Dec\\/12 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003esampling benefits from this two pass, because that way we can guarantee a minimum sample set size.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAhh true ...\u003c\\/p\u003e\\n\\n\u003cp\u003eWe have talked about adding a Scorer.getEstimatedHitCount (somewhere Robert has a patch...), so that eg BooleanQuery can do a better job ordering its sub-scorers, but I think we could use it for facets too (ie to pick sampling collector or not).\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, if the estimate was off (which it\'s allowed to be) ... then it could get tricky for facets, eg you may have to re-run the query with the non-sampling collector (or with higher sampling %tg) ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13526678_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13526678_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/12 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-07T19:23:29+0000\'\u003e07\\/Dec\\/12 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     sampling benefits from this two pass, because that way we can guarantee a minimum sample set size.  \\n\\n Ahh true ... \\n\\n We have talked about adding a Scorer.getEstimatedHitCount (somewhere Robert has a patch...), so that eg BooleanQuery can do a better job ordering its sub-scorers, but I think we could use it for facets too (ie to pick sampling collector or not). \\n\\n But, if the estimate was off (which it\'s allowed to be) ... then it could get tricky for facets, eg you may have to re-run the query with the non-sampling collector (or with higher sampling %tg) ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13526716\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13526716&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13526716\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13526716_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13526716_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/12 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-07T19:49:27+0000\'\u003e07\\/Dec\\/12 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'d rather if we rename this issue to something like \\\"implement an in-collection FacetsAccumulator\\/Collector\\\". I don\'t think that \\\"facets should\\\" aggregate only one way. There are many faceting examples, and some will have different flavors than others.\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, if this new Collector will perform better on a \'common\' case, then I\'m +1 for making it the default.\u003c\\/p\u003e\\n\\n\u003cp\u003eNote that I put \'common\' in quotes. The benchmark that you\'re doing indexing Wikipedia w\\/ a single Date facet dimension is not common. I think that we should define the common case, maybe following how Solr users use facets. I.e., is it the eCommerce case, where each document is associated with &lt;10 dimensions, and each dimension is not very deep (say, depth &lt;= 3)? If so, let\'s say that the facets defaults are tuned for that case, and then we benchmark it.\u003c\\/p\u003e\\n\\n\u003cp\u003eAfter we have such benchmark, we can compare the two aggregating collectors and decide which should be default.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd we should also define other scenarios too: few dimensions, flat taxonomies, but with hundred thousands or millions of categories &#8211; what FacetsAccumulator\\/Collector (including maybe an entirely different indexing chain) suits that case?\u003c\\/p\u003e\\n\\n\u003cp\u003eWe then document some recipes on the Wiki, and recommend the best configuration for each case.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13526716_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13526716_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/12 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-07T19:49:27+0000\'\u003e07\\/Dec\\/12 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'d rather if we rename this issue to something like \\\"implement an in-collection FacetsAccumulator\\/Collector\\\". I don\'t think that \\\"facets should\\\" aggregate only one way. There are many faceting examples, and some will have different flavors than others. \\n\\n However, if this new Collector will perform better on a \'common\' case, then I\'m +1 for making it the default. \\n\\n Note that I put \'common\' in quotes. The benchmark that you\'re doing indexing Wikipedia w\\/ a single Date facet dimension is not common. I think that we should define the common case, maybe following how Solr users use facets. I.e., is it the eCommerce case, where each document is associated with &lt;10 dimensions, and each dimension is not very deep (say, depth &lt;= 3)? If so, let\'s say that the facets defaults are tuned for that case, and then we benchmark it. \\n\\n After we have such benchmark, we can compare the two aggregating collectors and decide which should be default. \\n\\n And we should also define other scenarios too: few dimensions, flat taxonomies, but with hundred thousands or millions of categories &#8211; what FacetsAccumulator\\/Collector (including maybe an entirely different indexing chain) suits that case? \\n\\n We then document some recipes on the Wiki, and recommend the best configuration for each case.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13526734\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13526734&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13526734\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13526734_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13526734_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/12 20:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-07T20:13:50+0000\'\u003e07\\/Dec\\/12 20:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree we should keep \\\"do all aggregation at the end\\\" ... it could be for some use-cases (sampling) it\'s better.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo the \\\"aggregate as you collect\\\" should be an option, and not necessarily the default until we can see if it\'s better for the \\\"common\\\" case.\u003c\\/p\u003e\\n\\n\u003cp\u003eFeel free to change the title of this issue!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13526734_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13526734_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/12 20:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-07T20:13:50+0000\'\u003e07\\/Dec\\/12 20:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree we should keep \\\"do all aggregation at the end\\\" ... it could be for some use-cases (sampling) it\'s better. \\n\\n So the \\\"aggregate as you collect\\\" should be an option, and not necessarily the default until we can see if it\'s better for the \\\"common\\\" case. \\n\\n Feel free to change the title of this issue!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527077\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527077&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527077\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gilad\\\" id=\\\"commentauthor_13527077_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gilad\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gilad\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gilad Barkai\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527077_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/12 06:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-08T06:05:45+0000\'\u003e08\\/Dec\\/12 06:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAggregating all doc ids first also make it easier to compute actual results after sampling. \u003cbr\\/\u003e\\nThat is done by taking the sampling result top-(c)K and calculating their true value over all matching documents, giving the benefit of sampling and results which could make sense to the user (e.g in counting the end number would actually be the number of matching documents to this category).\u003c\\/p\u003e\\n\\n\u003cp\u003eAs for aggregating \'on the fly\' it has some other issues\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eIt (was?) believed that accessing the counting array during query execution may lead to memory cache issues. The entire counting array could be accessed for every document over and over, and it\'s not guaranteed it would fit into the cache (that\'s the CPU\'s one). That might not be a problem on modern hardware\u003c\\/li\u003e\\n\\t\u003cli\u003eWhile the OS can cache all payload data itself, it gets difficult as the index grows. If the OS fails to cache the file, it is (again, was?) believed that going over the file in sequential manner once without seeks (at least by the current thread) would make it faster.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIt sort of becoming a religion with all those \\\"believes\\\", as some scenarios used to make sense a few years ago. I\'m not sure they still do. \u003cbr\\/\u003e\\nCan\'t wait to see how some of these co-exist with the benchmark results.\u003cbr\\/\u003e\\nIf all religions could have been benchmarked... \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gilad\\\" id=\\\"commentauthor_13527077_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gilad\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gilad\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gilad Barkai\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527077_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/12 06:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-08T06:05:45+0000\'\u003e08\\/Dec\\/12 06:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Aggregating all doc ids first also make it easier to compute actual results after sampling.  \\nThat is done by taking the sampling result top-(c)K and calculating their true value over all matching documents, giving the benefit of sampling and results which could make sense to the user (e.g in counting the end number would actually be the number of matching documents to this category). \\n\\n As for aggregating \'on the fly\' it has some other issues \\n \\n\\t It (was?) believed that accessing the counting array during query execution may lead to memory cache issues. The entire counting array could be accessed for every document over and over, and it\'s not guaranteed it would fit into the cache (that\'s the CPU\'s one). That might not be a problem on modern hardware \\n\\t While the OS can cache all payload data itself, it gets difficult as the index grows. If the OS fails to cache the file, it is (again, was?) believed that going over the file in sequential manner once without seeks (at least by the current thread) would make it faster. \\n \\n\\n\\n It sort of becoming a religion with all those \\\"believes\\\", as some scenarios used to make sense a few years ago. I\'m not sure they still do.  \\nCan\'t wait to see how some of these co-exist with the benchmark results. \\nIf all religions could have been benchmarked...   \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527233\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527233&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527233\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527233_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527233_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/12 18:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-08T18:58:14+0000\'\u003e08\\/Dec\\/12 18:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eInitial prototype patch ... I created a CountingFacetsCollector that aggregates per-segment, and it \\\"hardwires\\\" a dgap\\/vint decoding.\u003c\\/p\u003e\\n\\n\u003cp\u003eI tested using luceneutil\'s date faceting and it gives decent speedups for TermQuery:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                HighTerm        0.54      (2.7%)        0.63      (1.4%)   17.6% (  13% -   22%)\\n                 LowTerm        7.69      (1.6%)        9.15      (2.1%)   18.9% (  14% -   23%)\\n                 MedTerm        3.39      (1.2%)        4.48      (1.3%)   32.2% (  29% -   35%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527233_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527233_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/12 18:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-08T18:58:14+0000\'\u003e08\\/Dec\\/12 18:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Initial prototype patch ... I created a CountingFacetsCollector that aggregates per-segment, and it \\\"hardwires\\\" a dgap\\/vint decoding. \\n\\n I tested using luceneutil\'s date faceting and it gives decent speedups for TermQuery: \\n  \\n                 HighTerm        0.54      (2.7%)        0.63      (1.4%)   17.6% (  13% -   22%)\\n                 LowTerm        7.69      (1.6%)        9.15      (2.1%)   18.9% (  14% -   23%)\\n                 MedTerm        3.39      (1.2%)        4.48      (1.3%)   32.2% (  29% -   35%)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527264\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527264&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527264\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527264_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527264_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/12 21:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-08T21:19:50+0000\'\u003e08\\/Dec\\/12 21:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew patch, adding a hacked up CachedCountingFacetsCollector.\u003c\\/p\u003e\\n\\n\u003cp\u003eAll it does is first pre-load all payloads into a PackedBytes (just like DocValues), and then during aggregation, instead of pulling the byte[] from payloads it pulls it from this RAM cache.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis results in an unexpectedly big speedup:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm        0.53      (0.9%)        1.00      (2.5%)   87.3% (  83% -   91%)\\n                 LowTerm        7.59      (0.6%)       26.75     (12.9%)  252.6% ( 237% -  267%)\\n                 MedTerm        3.35      (0.7%)       12.71      (9.0%)  279.8% ( 268% -  291%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe only \\\"real\\\" difference is that I\'m pulling the byte[] from RAM instead of from payloads, ie I still pay the vInt+dgap decode cost per hit ... so it\'s surprising payloads add THAT MUCH overhead?  (The test was \\\"hot\\\" so payloads were coming from OS\'s IO cache via MMapDir).\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the reason why HighTerm sees the least gains is because .advance is much less costly for it, since often the target is in the already-loaded block.\u003c\\/p\u003e\\n\\n\u003cp\u003eI had separately previously tested the existing int[][][] cache (CategoryListCache) but it had smaller gains than this (73% for MedTerm), and it required more RAM (1.9 GB vs 377 RAM for this patch).\u003c\\/p\u003e\\n\\n\u003cp\u003eNet\\/net I think we should offer an easy-to-use DV-backed facets impl...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527264_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527264_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/12 21:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-08T21:19:50+0000\'\u003e08\\/Dec\\/12 21:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New patch, adding a hacked up CachedCountingFacetsCollector. \\n\\n All it does is first pre-load all payloads into a PackedBytes (just like DocValues), and then during aggregation, instead of pulling the byte[] from payloads it pulls it from this RAM cache. \\n\\n This results in an unexpectedly big speedup: \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm        0.53      (0.9%)        1.00      (2.5%)   87.3% (  83% -   91%)\\n                 LowTerm        7.59      (0.6%)       26.75     (12.9%)  252.6% ( 237% -  267%)\\n                 MedTerm        3.35      (0.7%)       12.71      (9.0%)  279.8% ( 268% -  291%)\\n \\n  \\n\\n The only \\\"real\\\" difference is that I\'m pulling the byte[] from RAM instead of from payloads, ie I still pay the vInt+dgap decode cost per hit ... so it\'s surprising payloads add THAT MUCH overhead?  (The test was \\\"hot\\\" so payloads were coming from OS\'s IO cache via MMapDir). \\n\\n I think the reason why HighTerm sees the least gains is because .advance is much less costly for it, since often the target is in the already-loaded block. \\n\\n I had separately previously tested the existing int[][][] cache (CategoryListCache) but it had smaller gains than this (73% for MedTerm), and it required more RAM (1.9 GB vs 377 RAM for this patch). \\n\\n Net\\/net I think we should offer an easy-to-use DV-backed facets impl...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527353\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527353&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527353\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527353_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527353_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 06:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T06:39:41+0000\'\u003e09\\/Dec\\/12 06:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eNet\\/net I think we should offer an easy-to-use DV-backed facets impl...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf only DV could handle multi-values. Can they handle a single byte[]? Because essentially that\'s what the facets API needs today - it stores everything in the payload, which is byte[]. Having a multi-val DV could benefit us by e.g. not needing to write an iterator on the payload to get the category ordinals ...\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch looks very good. Few comments\\/questions:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eDo I understand correctly that the caching Collector is reusable? Otherwise I don\'t see how the CachedBytes help.\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ePreferably, if we had an AtomicReader which caches these bytes, then you wouldn\'t need to reuse the Collector?\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eHmmm, what if you used the in-mem Codec, for loading just this term\'s posting list into RAM? Do you think that you would gain the same?\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIf you want to make this a class that can be reused by other scenarios, then few tips that can enable that:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eInstead of referencing CatListParams.DEFAULT_TERM, you can pull the CLP from FacetSearchParams.getFacetIndexingParams().getCLP(new CP()).getTerm().\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAlso, you can obtain the right IntDecoder from the CLP for decoding the ordinals. That would remove the hard dependency on VInt+gap, and allow e.g. to use a PackedInts decoder.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eNot sure that we should, but this class supports only one CLP. I think it\'s ok to leave it like that, and get the CLP.term() at ctor, but then we must be able to cache the bytes at the reader level. That way, if an app uses multiple CLPs, it can initialize multi such Collectors.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI think it\'s ok to rely on the top Query to not call us for deleted docs, and therefore pass liveDocs=null. If a Query wants to iterate on deleted docs, we should count facets for them too.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eMaybe you should take the IntArrayAllocator from the outside? That class can be initialized by the app once to e.g. use maxArrays=10 (e.g. if it expects max 10 queries in parallel), and then the int[] are reused whenever possible. The way the patch is now, if you reuse that Collector, you can only reuse one array.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eIn setNextReader you sync on the cache only in case someone executes a search w\\/ an ExecutorService? That\'s another point where caching at the Codec\\/AtomicReader level would be better, right?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWhy is acceptDocsOutOfOrder false? Is it because of how the cache works? Because facet counting is not limited to in-order only.\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eFor the non-caching one that\'s true, because we can only advance on the fulltree posting. But if the posting is entirely in RAM, we can random access it?\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI wonder if we can write a good single Collector, and optimize the caching stuff through the Reader, or DV. Collectors in Lucene are usually not reusable? At least, I haven\'t seen such pattern. The current FacetsCollector isn\'t reusable (b\\/c of the bitset and potential scores array). So I\'m worried users might be confused and won\'t benefit the most from that Collector, b\\/c they won\'t reuse it ..\u003cbr\\/\u003e\\nOn the other hand, saying that we have a FacetsIndexReader (composite) which per configuration initializes the right FacetAtomicReader would be more consumable by apps.\u003c\\/p\u003e\\n\\n\u003cp\u003eAbout the results, just to clarify &#8211; in both runs the \'QPS base\' refers to current facet counting and \'QPS comp\' refers to the two new collectors respectively? I\'m surprised that the int[][][] didn\'t perform much better, since you don\'t need to do the decoding for every document, for every query. But then, perhaps it\'s because the RAM size is so large, and we pay a lot swapping in\\/out from CPU cache ...\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, note that you wrote a specialized code for decoding the payload, vs. using an API to do that (e.g. PackedInts \\/ IntDecoder). I wonder how would that compare to the base collection, i.e. would we still see the big difference between int[][][] and the byte[] caching.\u003c\\/p\u003e\\n\\n\u003cp\u003eOverall though, great work Mike !\u003c\\/p\u003e\\n\\n\u003cp\u003eWe must get this code in. It\'s clear that it can potentially gain a lot for some scenarios ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527353_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527353_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 06:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T06:39:41+0000\'\u003e09\\/Dec\\/12 06:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Net\\/net I think we should offer an easy-to-use DV-backed facets impl...  \\n\\n If only DV could handle multi-values. Can they handle a single byte[]? Because essentially that\'s what the facets API needs today - it stores everything in the payload, which is byte[]. Having a multi-val DV could benefit us by e.g. not needing to write an iterator on the payload to get the category ordinals ... \\n\\n The patch looks very good. Few comments\\/questions: \\n\\n \\n\\t Do I understand correctly that the caching Collector is reusable? Otherwise I don\'t see how the CachedBytes help.\\n\\t \\n\\t\\t Preferably, if we had an AtomicReader which caches these bytes, then you wouldn\'t need to reuse the Collector? \\n\\t\\t Hmmm, what if you used the in-mem Codec, for loading just this term\'s posting list into RAM? Do you think that you would gain the same? \\n\\t \\n\\t \\n \\n\\n\\n If you want to make this a class that can be reused by other scenarios, then few tips that can enable that: \\n\\n \\n\\t Instead of referencing CatListParams.DEFAULT_TERM, you can pull the CLP from FacetSearchParams.getFacetIndexingParams().getCLP(new CP()).getTerm(). \\n \\n\\n\\n \\n\\t Also, you can obtain the right IntDecoder from the CLP for decoding the ordinals. That would remove the hard dependency on VInt+gap, and allow e.g. to use a PackedInts decoder. \\n \\n\\n\\n \\n\\t Not sure that we should, but this class supports only one CLP. I think it\'s ok to leave it like that, and get the CLP.term() at ctor, but then we must be able to cache the bytes at the reader level. That way, if an app uses multiple CLPs, it can initialize multi such Collectors. \\n \\n\\n\\n \\n\\t I think it\'s ok to rely on the top Query to not call us for deleted docs, and therefore pass liveDocs=null. If a Query wants to iterate on deleted docs, we should count facets for them too. \\n \\n\\n\\n \\n\\t Maybe you should take the IntArrayAllocator from the outside? That class can be initialized by the app once to e.g. use maxArrays=10 (e.g. if it expects max 10 queries in parallel), and then the int[] are reused whenever possible. The way the patch is now, if you reuse that Collector, you can only reuse one array. \\n \\n\\n\\n \\n\\t In setNextReader you sync on the cache only in case someone executes a search w\\/ an ExecutorService? That\'s another point where caching at the Codec\\/AtomicReader level would be better, right? \\n \\n\\n\\n \\n\\t Why is acceptDocsOutOfOrder false? Is it because of how the cache works? Because facet counting is not limited to in-order only.\\n\\t \\n\\t\\t For the non-caching one that\'s true, because we can only advance on the fulltree posting. But if the posting is entirely in RAM, we can random access it? \\n\\t \\n\\t \\n \\n\\n\\n I wonder if we can write a good single Collector, and optimize the caching stuff through the Reader, or DV. Collectors in Lucene are usually not reusable? At least, I haven\'t seen such pattern. The current FacetsCollector isn\'t reusable (b\\/c of the bitset and potential scores array). So I\'m worried users might be confused and won\'t benefit the most from that Collector, b\\/c they won\'t reuse it .. \\nOn the other hand, saying that we have a FacetsIndexReader (composite) which per configuration initializes the right FacetAtomicReader would be more consumable by apps. \\n\\n About the results, just to clarify &#8211; in both runs the \'QPS base\' refers to current facet counting and \'QPS comp\' refers to the two new collectors respectively? I\'m surprised that the int[][][] didn\'t perform much better, since you don\'t need to do the decoding for every document, for every query. But then, perhaps it\'s because the RAM size is so large, and we pay a lot swapping in\\/out from CPU cache ... \\n\\n Also, note that you wrote a specialized code for decoding the payload, vs. using an API to do that (e.g. PackedInts \\/ IntDecoder). I wonder how would that compare to the base collection, i.e. would we still see the big difference between int[][][] and the byte[] caching. \\n\\n Overall though, great work Mike ! \\n\\n We must get this code in. It\'s clear that it can potentially gain a lot for some scenarios ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527356\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527356&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527356\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527356_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527356_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 06:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T06:50:05+0000\'\u003e09\\/Dec\\/12 06:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eChanging the title, which got me thinking &#8211; Mike, if we do the Reader\\/DV caching approach, that could benefit post-collection performance too, right? Is it possile that you hack the current FacetsCollector to do the aggregation over CachedBytes and then compare the difference?\u003c\\/p\u003e\\n\\n\u003cp\u003eBecause your first results show that during-collection are not that much faster than post-collection, I am just wondering if it\'ll be the same when we cache the bytes outside the collector entirely.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf so, I think it should push us to do this caching outside, because we\'ve already identified cases where post-collection is needed (e.g. sampling) too.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527356_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527356_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 06:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T06:50:05+0000\'\u003e09\\/Dec\\/12 06:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Changing the title, which got me thinking &#8211; Mike, if we do the Reader\\/DV caching approach, that could benefit post-collection performance too, right? Is it possile that you hack the current FacetsCollector to do the aggregation over CachedBytes and then compare the difference? \\n\\n Because your first results show that during-collection are not that much faster than post-collection, I am just wondering if it\'ll be the same when we cache the bytes outside the collector entirely. \\n\\n If so, I think it should push us to do this caching outside, because we\'ve already identified cases where post-collection is needed (e.g. sampling) too.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527418\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527418&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527418\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527418_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527418_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 12:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T12:12:03+0000\'\u003e09\\/Dec\\/12 12:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eNet\\/net I think we should offer an easy-to-use DV-backed facets impl...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf only DV could handle multi-values. Can they handle a single byte[]?\u003c\\/p\u003e\\n\\n\u003cp\u003eBecause essentially that\'s what the facets API needs today - it stores everything in the payload, which is byte[]. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThey can handle byte[], so I think we should just offer that.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eHaving a multi-val DV could benefit us by e.g. not needing to write an iterator on the payload to get the category ordinals ...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRight, though in the special (common?) case where a given facet field\u003cbr\\/\u003e\\nis single-valued, like the Date facets I added to luceneutil \\/\u003cbr\\/\u003e\\nnightlybench (see the graph here:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/TermDateFacets.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/TermDateFacets.html\u003c\\/a\u003e\u003cbr\\/\u003e\\n&#8211; only 3 data points so far!), we could also use DV\'s int fields and\u003cbr\\/\u003e\\nlet it encode the single ord (eg with packed ints) and then aggreggate\u003cbr\\/\u003e\\nup the taxonomy after aggregation of the leaf ords is done.  I\'m\u003cbr\\/\u003e\\nplaying with a prototype patch for this ...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eDo I understand correctly that the caching Collector is reusable? Otherwise I don\'t see how the CachedBytes help.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNo no: this is all just a hack (the CachedBytes \\/ static cache).  We\u003cbr\\/\u003e\\nshould somehow cleanly switch to DV ... it wasn\'t clear to me how to\u003cbr\\/\u003e\\ndo that ...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eHmmm, what if you used the in-mem Codec, for loading just this term\'s posting list into RAM? Do you think that you would gain the same?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMaybe!  Have to test ...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIf you want to make this a class that can be reused by other scenarios, then few tips that can enable that:\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI do!  If ... making it fully generic doesn\'t hurt perf much.  The\u003cbr\\/\u003e\\ndecode chain (w\\/ separate reInit called per doc) seems heavyish ...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eInstead of referencing CatListParams.DEFAULT_TERM, you can pull the CLP from FacetSearchParams.getFacetIndexingParams().getCLP(new CP()).getTerm().\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAhh ok.  I\'ll fix that.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAlso, you can obtain the right IntDecoder from the CLP for decoding the ordinals. That would remove the hard dependency on VInt+gap, and allow e.g. to use a PackedInts decoder.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK I\'ll try that.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eNot sure that we should, but this class supports only one CLP. I think it\'s ok to leave it like that, and get the CLP.term() at ctor, but then we must be able to cache the bytes at the reader level. That way, if an app uses multiple CLPs, it can initialize multi such Collectors.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think it\'s ok to rely on the top Query to not call us for deleted docs, and therefore pass liveDocs=null. If a Query wants to iterate on deleted docs, we should count facets for them too.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK good.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMaybe you should take the IntArrayAllocator from the outside? That class can be initialized by the app once to e.g. use maxArrays=10 (e.g. if it expects max 10 queries in parallel), and then the int[] are reused whenever possible. The way the patch is now, if you reuse that Collector, you can only reuse one array.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAhh I\'ll do that.\u003c\\/p\u003e\\n\\n\u003cp\u003eSeparately I was wondering if we should sometimes do aggregation\u003cbr\\/\u003e\\nbacked by an int[] hashmap, and have it \\\"upgrade\\\" to a non-sparse\u003cbr\\/\u003e\\narray only once the number collected got too large.  Not sure it\'s\u003cbr\\/\u003e\\nTHAT important since it would only serve to keep fast queries fast but\u003cbr\\/\u003e\\nwould make slow queries a bit slower...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIn setNextReader you sync on the cache only in case someone executes a search w\\/ an ExecutorService? That\'s another point where caching at the Codec\\/AtomicReader level would be better, right?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAlso for multiple threads running at once ... but it\'s all a hack anyway ...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eWhy is acceptDocsOutOfOrder false? Is it because of how the cache works? Because facet counting is not limited to in-order only.\u003cbr\\/\u003e\\nFor the non-caching one that\'s true, because we can only advance on the fulltree posting. But if the posting is entirely in RAM, we can random access it?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOh good point &#8211; the DV\\/cache collectors can accept out of order.\u003cbr\\/\u003e\\nI\'ll fix.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI wonder if we can write a good single Collector, and optimize the caching stuff through the Reader, or DV. Collectors in Lucene are usually not reusable? At least, I haven\'t seen such pattern. The current FacetsCollector isn\'t reusable (b\\/c of the bitset and potential scores array). So I\'m worried users might be confused and won\'t benefit the most from that Collector, b\\/c they won\'t reuse it ..\u003cbr\\/\u003e\\nOn the other hand, saying that we have a FacetsIndexReader (composite) which per configuration initializes the right FacetAtomicReader would be more consumable by apps.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think we should have two new collectors here?  One keeps using\u003cbr\\/\u003e\\npayloads but operates per segment and aggregates on the fly (if, on\u003cbr\\/\u003e\\nmaking it generic again, we still see gains).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe other stores the byte[] in DV.  But somehow we have to make \\\"send\u003cbr\\/\u003e\\nthe byte[] to DV not payloads at index time\\\" easy ... I\'m not sure how \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eAbout the results, just to clarify \\u2013 in both runs the \'QPS base\' refers to current facet counting and \'QPS comp\' refers to the two new collectors respectively?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRight: base = current trunk, comp = the two new collectors.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'m surprised that the int[][][] didn\'t perform much better, since you don\'t need to do the decoding for every document, for every query. But then, perhaps it\'s because the RAM size is so large, and we pay a lot swapping in\\/out from CPU cache ...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis also surprised me, but I suspect it\'s the per-doc pointer\u003cbr\\/\u003e\\ndereferencing that\'s costing us.  I saw the same problem with\u003cbr\\/\u003e\\nDirectPostingsFormat ... This also ties up tons of extra RAM (pointer\u003cbr\\/\u003e\\n= 4 or 8 bytes; int[] object overhead maybe 8 bytes?).  I bet if we\u003cbr\\/\u003e\\nmade a single int[], and did our own addressing (eg another int[] that\u003cbr\\/\u003e\\nmaps docID to its address) then that would be faster than byte[] via\u003cbr\\/\u003e\\ncache\\/DV.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAlso, note that you wrote a specialized code for decoding the payload, vs. using an API to do that (e.g. PackedInts \\/ IntDecoder). I wonder how would that compare to the base collection, i.e. would we still see the big difference between int[][][] and the byte[] caching.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah good question.  I\'ll separately test the specialized decode to\u003cbr\\/\u003e\\nsee how much it\'s helping....\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMike, if we do the Reader\\/DV caching approach, that could benefit post-collection performance too, right? Is it possile that you hack the current FacetsCollector to do the aggregation over CachedBytes and then compare the difference?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRight!  DV vs payloads is decoupled from during- vs post-collection\u003cbr\\/\u003e\\naggregation.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll open a separate issue to allow byte[] DV backing for facets....\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eBecause your first results show that during-collection are not that much faster than post-collection, I am just wondering if it\'ll be the same when we cache the bytes outside the collector entirely.\u003cbr\\/\u003e\\nIf so, I think it should push us to do this caching outside, because we\'ve already identified cases where post-collection is needed (e.g. sampling) too.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eDefinitely.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eOverall though, great work Mike !\u003cbr\\/\u003e\\nWe must get this code in. It\'s clear that it can potentially gain a lot for some scenarios ...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThanks!  I want to see that graph jump \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527418_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527418_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 12:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T12:12:03+0000\'\u003e09\\/Dec\\/12 12:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n  Net\\/net I think we should offer an easy-to-use DV-backed facets impl...  \\n\\n If only DV could handle multi-values. Can they handle a single byte[]? \\n\\n Because essentially that\'s what the facets API needs today - it stores everything in the payload, which is byte[].   \\n\\n They can handle byte[], so I think we should just offer that. \\n\\n  Having a multi-val DV could benefit us by e.g. not needing to write an iterator on the payload to get the category ordinals ...  \\n\\n Right, though in the special (common?) case where a given facet field \\nis single-valued, like the Date facets I added to luceneutil \\/ \\nnightlybench (see the graph here: \\n http:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/TermDateFacets.html  \\n&#8211; only 3 data points so far!), we could also use DV\'s int fields and \\nlet it encode the single ord (eg with packed ints) and then aggreggate \\nup the taxonomy after aggregation of the leaf ords is done.  I\'m \\nplaying with a prototype patch for this ... \\n\\n  Do I understand correctly that the caching Collector is reusable? Otherwise I don\'t see how the CachedBytes help.  \\n\\n No no: this is all just a hack (the CachedBytes \\/ static cache).  We \\nshould somehow cleanly switch to DV ... it wasn\'t clear to me how to \\ndo that ... \\n\\n  Hmmm, what if you used the in-mem Codec, for loading just this term\'s posting list into RAM? Do you think that you would gain the same?  \\n\\n Maybe!  Have to test ... \\n\\n  If you want to make this a class that can be reused by other scenarios, then few tips that can enable that:  \\n\\n I do!  If ... making it fully generic doesn\'t hurt perf much.  The \\ndecode chain (w\\/ separate reInit called per doc) seems heavyish ... \\n\\n  Instead of referencing CatListParams.DEFAULT_TERM, you can pull the CLP from FacetSearchParams.getFacetIndexingParams().getCLP(new CP()).getTerm().  \\n\\n Ahh ok.  I\'ll fix that. \\n\\n  Also, you can obtain the right IntDecoder from the CLP for decoding the ordinals. That would remove the hard dependency on VInt+gap, and allow e.g. to use a PackedInts decoder.  \\n\\n OK I\'ll try that. \\n\\n \\n Not sure that we should, but this class supports only one CLP. I think it\'s ok to leave it like that, and get the CLP.term() at ctor, but then we must be able to cache the bytes at the reader level. That way, if an app uses multiple CLPs, it can initialize multi such Collectors. \\n\\n I think it\'s ok to rely on the top Query to not call us for deleted docs, and therefore pass liveDocs=null. If a Query wants to iterate on deleted docs, we should count facets for them too.  \\n\\n OK good. \\n\\n  Maybe you should take the IntArrayAllocator from the outside? That class can be initialized by the app once to e.g. use maxArrays=10 (e.g. if it expects max 10 queries in parallel), and then the int[] are reused whenever possible. The way the patch is now, if you reuse that Collector, you can only reuse one array.  \\n\\n Ahh I\'ll do that. \\n\\n Separately I was wondering if we should sometimes do aggregation \\nbacked by an int[] hashmap, and have it \\\"upgrade\\\" to a non-sparse \\narray only once the number collected got too large.  Not sure it\'s \\nTHAT important since it would only serve to keep fast queries fast but \\nwould make slow queries a bit slower... \\n\\n  In setNextReader you sync on the cache only in case someone executes a search w\\/ an ExecutorService? That\'s another point where caching at the Codec\\/AtomicReader level would be better, right?  \\n\\n Also for multiple threads running at once ... but it\'s all a hack anyway ... \\n\\n \\n Why is acceptDocsOutOfOrder false? Is it because of how the cache works? Because facet counting is not limited to in-order only. \\nFor the non-caching one that\'s true, because we can only advance on the fulltree posting. But if the posting is entirely in RAM, we can random access it?  \\n\\n Oh good point &#8211; the DV\\/cache collectors can accept out of order. \\nI\'ll fix. \\n\\n \\n I wonder if we can write a good single Collector, and optimize the caching stuff through the Reader, or DV. Collectors in Lucene are usually not reusable? At least, I haven\'t seen such pattern. The current FacetsCollector isn\'t reusable (b\\/c of the bitset and potential scores array). So I\'m worried users might be confused and won\'t benefit the most from that Collector, b\\/c they won\'t reuse it .. \\nOn the other hand, saying that we have a FacetsIndexReader (composite) which per configuration initializes the right FacetAtomicReader would be more consumable by apps.  \\n\\n I think we should have two new collectors here?  One keeps using \\npayloads but operates per segment and aggregates on the fly (if, on \\nmaking it generic again, we still see gains). \\n\\n The other stores the byte[] in DV.  But somehow we have to make \\\"send \\nthe byte[] to DV not payloads at index time\\\" easy ... I\'m not sure how   \\n\\n \\n About the results, just to clarify \\u2013 in both runs the \'QPS base\' refers to current facet counting and \'QPS comp\' refers to the two new collectors respectively?  \\n\\n Right: base = current trunk, comp = the two new collectors. \\n\\n  I\'m surprised that the int[][][] didn\'t perform much better, since you don\'t need to do the decoding for every document, for every query. But then, perhaps it\'s because the RAM size is so large, and we pay a lot swapping in\\/out from CPU cache ...  \\n\\n This also surprised me, but I suspect it\'s the per-doc pointer \\ndereferencing that\'s costing us.  I saw the same problem with \\nDirectPostingsFormat ... This also ties up tons of extra RAM (pointer \\n= 4 or 8 bytes; int[] object overhead maybe 8 bytes?).  I bet if we \\nmade a single int[], and did our own addressing (eg another int[] that \\nmaps docID to its address) then that would be faster than byte[] via \\ncache\\/DV. \\n\\n  Also, note that you wrote a specialized code for decoding the payload, vs. using an API to do that (e.g. PackedInts \\/ IntDecoder). I wonder how would that compare to the base collection, i.e. would we still see the big difference between int[][][] and the byte[] caching.  \\n\\n Yeah good question.  I\'ll separately test the specialized decode to \\nsee how much it\'s helping.... \\n\\n  Mike, if we do the Reader\\/DV caching approach, that could benefit post-collection performance too, right? Is it possile that you hack the current FacetsCollector to do the aggregation over CachedBytes and then compare the difference?  \\n\\n Right!  DV vs payloads is decoupled from during- vs post-collection \\naggregation. \\n\\n I\'ll open a separate issue to allow byte[] DV backing for facets.... \\n\\n \\n Because your first results show that during-collection are not that much faster than post-collection, I am just wondering if it\'ll be the same when we cache the bytes outside the collector entirely. \\nIf so, I think it should push us to do this caching outside, because we\'ve already identified cases where post-collection is needed (e.g. sampling) too.  \\n\\n Definitely. \\n\\n \\n Overall though, great work Mike ! \\nWe must get this code in. It\'s clear that it can potentially gain a lot for some scenarios ...  \\n\\n Thanks!  I want to see that graph jump                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527425\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527425&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527425\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527425_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527425_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 12:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T12:29:31+0000\'\u003e09\\/Dec\\/12 12:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI would like to see one ordinals-store, I don\'t think that we should allow either payload or DV. If DV lets us write byte[], and we could read it off-disk or RAM, we should make the cut to DV.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut note that DV means ugrading existing indexes. How do you move from a payload to DV? Is it something that can be done in addIndexes? If facets could determine where the data is written, per-segment, the indexes will be migrated on-the-fly, as segments are merged.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut if there\'s a clean way to do a one-time index upgrade to DV, then let\'s just write it once, and then DVs are migratable, so that\'s another +1 for DV.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you want to simulate DVs, you\'ll need to implement few classes. First, instead of CategoryDocBuilder, you can constuct your own Document, while adding DVFields. Just make sure that when you resolve a CP to its ord, you also resolve all its parents and add all of them to the DV - to compare today(payload) to today(DV) (today == writing all parents).\u003c\\/p\u003e\\n\\n\u003cp\u003eThen, I think that you should also write your CategoryListIterator, to iterate on the DV.\u003c\\/p\u003e\\n\\n\u003cp\u003eThose are the base classes for sure, maybe you\'ll need a few others to get the CLI into the chain.\u003c\\/p\u003e\\n\\n\u003cp\u003eI hope that I related to all the comments, but I might have missed a question \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527425_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527425_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 12:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T12:29:31+0000\'\u003e09\\/Dec\\/12 12:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I would like to see one ordinals-store, I don\'t think that we should allow either payload or DV. If DV lets us write byte[], and we could read it off-disk or RAM, we should make the cut to DV. \\n\\n But note that DV means ugrading existing indexes. How do you move from a payload to DV? Is it something that can be done in addIndexes? If facets could determine where the data is written, per-segment, the indexes will be migrated on-the-fly, as segments are merged. \\n\\n But if there\'s a clean way to do a one-time index upgrade to DV, then let\'s just write it once, and then DVs are migratable, so that\'s another +1 for DV. \\n\\n If you want to simulate DVs, you\'ll need to implement few classes. First, instead of CategoryDocBuilder, you can constuct your own Document, while adding DVFields. Just make sure that when you resolve a CP to its ord, you also resolve all its parents and add all of them to the DV - to compare today(payload) to today(DV) (today == writing all parents). \\n\\n Then, I think that you should also write your CategoryListIterator, to iterate on the DV. \\n\\n Those are the base classes for sure, maybe you\'ll need a few others to get the CLI into the chain. \\n\\n I hope that I related to all the comments, but I might have missed a question  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527436\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527436&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527436\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527436_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527436_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 13:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T13:00:28+0000\'\u003e09\\/Dec\\/12 13:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnother point about DV - that\'s actually a design thing. One important hook is IntEncoder\\/Decoder. It determines how the fulltree is encoded\\/decoded. For example, you used one method (VInt+DGap), but there are other encoders. In one application, every document added almost unique facets and so the ordinals returned had a gap of 1-2. Therefore we have a FourOnes and EightOnes encoders.\u003c\\/p\u003e\\n\\n\u003cp\u003ePoint is, this abstract layer should remain. I know that you\'re in the exploration phase, but keep that in mind. In fact, if we\'re able to make the cut to DV as an internal change, we could also benefit from the existing test suite, to make sure everything\'s working.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527436_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527436_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 13:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T13:00:28+0000\'\u003e09\\/Dec\\/12 13:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Another point about DV - that\'s actually a design thing. One important hook is IntEncoder\\/Decoder. It determines how the fulltree is encoded\\/decoded. For example, you used one method (VInt+DGap), but there are other encoders. In one application, every document added almost unique facets and so the ordinals returned had a gap of 1-2. Therefore we have a FourOnes and EightOnes encoders. \\n\\n Point is, this abstract layer should remain. I know that you\'re in the exploration phase, but keep that in mind. In fact, if we\'re able to make the cut to DV as an internal change, we could also benefit from the existing test suite, to make sure everything\'s working.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527512\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527512&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527512\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527512_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527512_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 15:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T15:58:19+0000\'\u003e09\\/Dec\\/12 15:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI would like to see one ordinals-store, I don\'t think that we should allow either payload or DV. If DV lets us write byte[], and we could read it off-disk or RAM, we should make the cut to DV.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1, though we should test the on-disk DV vs current payloads to be sure.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBut note that DV means ugrading existing indexes.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm it would be nice to somehow migrate on the fly ... not sure how.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBut if there\'s a clean way to do a one-time index upgrade to DV, then let\'s just write it once, and then DVs are migratable, so that\'s another +1 for DV.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf we do the migrate-on-the-fly then users can use IndexUpgrader to migrate entire index.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003ePoint is, this abstract layer should remain. I know that you\'re in the exploration phase, but keep that in mind. In fact, if we\'re able to make the cut to DV as an internal change, we could also benefit from the existing test suite, to make sure everything\'s working.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1, the abstractions are nice an generic.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll test to see how much these abstraction are hurting the hotspots ... we can always make\\/pick specialized collectors (like the patch) if necessary, and keep generic collectors for the fully general cases ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527512_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527512_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 15:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T15:58:19+0000\'\u003e09\\/Dec\\/12 15:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I would like to see one ordinals-store, I don\'t think that we should allow either payload or DV. If DV lets us write byte[], and we could read it off-disk or RAM, we should make the cut to DV.  \\n\\n +1, though we should test the on-disk DV vs current payloads to be sure. \\n\\n  But note that DV means ugrading existing indexes.  \\n\\n Hmm it would be nice to somehow migrate on the fly ... not sure how. \\n\\n  But if there\'s a clean way to do a one-time index upgrade to DV, then let\'s just write it once, and then DVs are migratable, so that\'s another +1 for DV.  \\n\\n If we do the migrate-on-the-fly then users can use IndexUpgrader to migrate entire index. \\n\\n \\n Point is, this abstract layer should remain. I know that you\'re in the exploration phase, but keep that in mind. In fact, if we\'re able to make the cut to DV as an internal change, we could also benefit from the existing test suite, to make sure everything\'s working.  \\n\\n +1, the abstractions are nice an generic. \\n\\n I\'ll test to see how much these abstraction are hurting the hotspots ... we can always make\\/pick specialized collectors (like the patch) if necessary, and keep generic collectors for the fully general cases ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527516\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527516&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527516\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527516_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527516_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 16:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T16:14:22+0000\'\u003e09\\/Dec\\/12 16:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI created \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4602\\\" title=\\\"Use DocValues to store per-doc facet ord\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4602\\\"\u003e\u003cdel\u003eLUCENE-4602\u003c\\/del\u003e\u003c\\/a\u003e to cutover to DV.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527516_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527516_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 16:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T16:14:22+0000\'\u003e09\\/Dec\\/12 16:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I created   LUCENE-4602   to cutover to DV.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527566\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527566&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527566\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527566_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527566_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 18:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T18:37:00+0000\'\u003e09\\/Dec\\/12 18:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAlso, you can obtain the right IntDecoder from the CLP for decoding the ordinals. That would remove the hard dependency on VInt+gap, and allow e.g. to use a PackedInts decoder.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI tried this, changing the CountingFacetsCollector to the attached\u003cbr\\/\u003e\\npatch (to use CategoryListIterator), but alas those abstractions are\u003cbr\\/\u003e\\napparently costing us in this hotspot (unless I screwed something up\u003cbr\\/\u003e\\nin the patch?  Eg, that null I pass is kinda spooky!):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm        0.86      (4.7%)        0.56      (0.4%)  -34.4% ( -37% -  -30%)\\n                 MedTerm        5.85      (1.0%)        5.04      (0.5%)  -13.9% ( -15% -  -12%)\\n                 LowTerm       11.82      (0.6%)       11.02      (0.5%)   -6.8% (  -7% -   -5%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003ebase is the original CountingFacetsCollector and comp is the new one\u003cbr\\/\u003e\\nusing the CategoryListIterator API.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think we should try to invoke specialized collectors when possible?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527566_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527566_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 18:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T18:37:00+0000\'\u003e09\\/Dec\\/12 18:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Also, you can obtain the right IntDecoder from the CLP for decoding the ordinals. That would remove the hard dependency on VInt+gap, and allow e.g. to use a PackedInts decoder.  \\n\\n I tried this, changing the CountingFacetsCollector to the attached \\npatch (to use CategoryListIterator), but alas those abstractions are \\napparently costing us in this hotspot (unless I screwed something up \\nin the patch?  Eg, that null I pass is kinda spooky!): \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm        0.86      (4.7%)        0.56      (0.4%)  -34.4% ( -37% -  -30%)\\n                 MedTerm        5.85      (1.0%)        5.04      (0.5%)  -13.9% ( -15% -  -12%)\\n                 LowTerm       11.82      (0.6%)       11.02      (0.5%)   -6.8% (  -7% -   -5%)\\n \\n  \\n\\n base is the original CountingFacetsCollector and comp is the new one \\nusing the CategoryListIterator API. \\n\\n I think we should try to invoke specialized collectors when possible?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527601\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527601&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527601\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527601_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527601_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 19:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T19:56:14+0000\'\u003e09\\/Dec\\/12 19:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eMaybe you should take the IntArrayAllocator from the outside?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis actually makes me sort of nervous, because if the app passes 10 to IntArrayAllocator, it means we hold onto 10 int[] sized to the number of ords right?\u003c\\/p\u003e\\n\\n\u003cp\u003eWhy try to recycle the int[]\'s?  Why not let GC handle it...?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13527601_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527601_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 19:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T19:56:14+0000\'\u003e09\\/Dec\\/12 19:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Maybe you should take the IntArrayAllocator from the outside?  \\n\\n This actually makes me sort of nervous, because if the app passes 10 to IntArrayAllocator, it means we hold onto 10 int[] sized to the number of ords right? \\n\\n Why try to recycle the int[]\'s?  Why not let GC handle it...?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527621\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13527621&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527621\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527621_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527621_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 20:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T20:29:03+0000\'\u003e09\\/Dec\\/12 20:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhy try to recycle the int[]\'s? Why not let GC handle it...?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt was Gilad who mentioned \\\"believes\\\" and \\\"religions\\\" .. that code is written since Java 1.4. Not sure that at the time Java was very good at allocating and disposing arrays ... Also, it\'s not like this is unique to facets. IIRC, IndexWriter also holds onto some char[] or byte[] arrays? At least, few days ago someone asked me how come IW never releases some 100 MB of char[] - since he set RAM buffer size to 128 MB, it made sense to me ...\u003c\\/p\u003e\\n\\n\u003cp\u003ePerhaps leave it for now, and separately (new issue? \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e) we can test if allocating a new array is costly? If it turns out that this is actually important, we can have a cleanup thread to reclaim the unused ones?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13527621_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527621_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/12 20:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-09T20:29:03+0000\'\u003e09\\/Dec\\/12 20:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Why try to recycle the int[]\'s? Why not let GC handle it...?  \\n\\n It was Gilad who mentioned \\\"believes\\\" and \\\"religions\\\" .. that code is written since Java 1.4. Not sure that at the time Java was very good at allocating and disposing arrays ... Also, it\'s not like this is unique to facets. IIRC, IndexWriter also holds onto some char[] or byte[] arrays? At least, few days ago someone asked me how come IW never releases some 100 MB of char[] - since he set RAM buffer size to 128 MB, it made sense to me ... \\n\\n Perhaps leave it for now, and separately (new issue?  ) we can test if allocating a new array is costly? If it turns out that this is actually important, we can have a cleanup thread to reclaim the unused ones?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13528402\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13528402&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13528402\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13528402_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13528402_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/12 23:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-10T23:01:23+0000\'\u003e10\\/Dec\\/12 23:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAlso, it\'s not like this is unique to facets. IIRC, IndexWriter also holds onto some char[] or byte[] arrays? At least, few days ago someone asked me how come IW never releases some 100 MB of char[] - since he set RAM buffer size to 128 MB, it made sense to me ...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eActually we stopped recycling with DWPT ... now we let GC do its job.  But, also, when IW did this, it was internal (no public API was affected) ... I don\'t like that the app can\\/should pass in IntArrayAllocator to the public APIs.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ePerhaps leave it for now, and separately (new issue? ) we can test if allocating a new array is costly? If it turns out that this is actually important, we can have a cleanup thread to reclaim the unused ones?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK I\'ll open a new issue.  Rather than adding a cleanup thread to the current impl, I think we should remove Int\\/FloatArrayAllocator and just do new int[]\\/float[]?  And only add it back if we can prove there\'s a performance gain?  I think we should let Java\\/GC do its job ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13528402_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13528402_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/12 23:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-10T23:01:23+0000\'\u003e10\\/Dec\\/12 23:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Also, it\'s not like this is unique to facets. IIRC, IndexWriter also holds onto some char[] or byte[] arrays? At least, few days ago someone asked me how come IW never releases some 100 MB of char[] - since he set RAM buffer size to 128 MB, it made sense to me ...  \\n\\n Actually we stopped recycling with DWPT ... now we let GC do its job.  But, also, when IW did this, it was internal (no public API was affected) ... I don\'t like that the app can\\/should pass in IntArrayAllocator to the public APIs. \\n\\n  Perhaps leave it for now, and separately (new issue? ) we can test if allocating a new array is costly? If it turns out that this is actually important, we can have a cleanup thread to reclaim the unused ones?  \\n\\n OK I\'ll open a new issue.  Rather than adding a cleanup thread to the current impl, I think we should remove Int\\/FloatArrayAllocator and just do new int[]\\/float[]?  And only add it back if we can prove there\'s a performance gain?  I think we should let Java\\/GC do its job ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13528660\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13528660&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13528660\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13528660_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13528660_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/12 04:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-11T04:31:12+0000\'\u003e11\\/Dec\\/12 04:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, let\'s continue the discussion on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4615\\\" title=\\\"Remove Int\\/FloatArrayAllocator from facet module?\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4615\\\"\u003e\u003cdel\u003eLUCENE-4615\u003c\\/del\u003e\u003c\\/a\u003e. The Allocator is also used to pass the array between different objects, but perhaps there are other ways too.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13528660_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13528660_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Dec\\/12 04:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-11T04:31:12+0000\'\u003e11\\/Dec\\/12 04:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, let\'s continue the discussion on   LUCENE-4615  . The Allocator is also used to pass the array between different objects, but perhaps there are other ways too.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13557256\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13557256&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13557256\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13557256_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557256_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 14:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T14:59:04+0000\'\u003e18\\/Jan\\/13 14:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch introduces CountingFacetsCollector, very similar to Mike\'s version, only \\\"productized\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eMade FacetsCollector abstract with a utility create() method which returns either CountingFacetsCollector or StandardFacetsCollector (previously, FC), given the parameters.\u003c\\/p\u003e\\n\\n\u003cp\u003eAll tests were migrated to use FC.create and all pass (utilizing the new collector). Still, I wrote a dedicated test for the new Collector too.\u003c\\/p\u003e\\n\\n\u003cp\u003ePreliminary results that we have, show nice improvements w\\/ this Collector. Mike, can you paste them here?\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are some nocommits, which I will resolve before committing. But before that, I\'d like to compare this Collector to ones that use different abstractions from the code, e.g. IntDecoder (vs hard-wiring to dgap+vint), CategoryListIterator etc.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, I also want to compare this Collector to one that in collect() marks a bitset, and does all the work in getFacetResults.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13557256_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557256_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 14:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T14:59:04+0000\'\u003e18\\/Jan\\/13 14:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch introduces CountingFacetsCollector, very similar to Mike\'s version, only \\\"productized\\\". \\n\\n Made FacetsCollector abstract with a utility create() method which returns either CountingFacetsCollector or StandardFacetsCollector (previously, FC), given the parameters. \\n\\n All tests were migrated to use FC.create and all pass (utilizing the new collector). Still, I wrote a dedicated test for the new Collector too. \\n\\n Preliminary results that we have, show nice improvements w\\/ this Collector. Mike, can you paste them here? \\n\\n There are some nocommits, which I will resolve before committing. But before that, I\'d like to compare this Collector to ones that use different abstractions from the code, e.g. IntDecoder (vs hard-wiring to dgap+vint), CategoryListIterator etc. \\n\\n Also, I also want to compare this Collector to one that in collect() marks a bitset, and does all the work in getFacetResults.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13557263\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13557263&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13557263\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13557263_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557263_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 15:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T15:12:33+0000\'\u003e18\\/Jan\\/13 15:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch looks great: +1\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd this is a healthy speedup, on the Wikipedia 1M \\/ 25 ords per doc test:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                PKLookup      239.18      (1.5%)      238.87      (1.1%)   -0.1% (  -2% -    2%)\\n                 LowTerm       98.99      (3.1%)      135.95      (1.8%)   37.3% (  31% -   43%)\\n                HighTerm       20.95      (1.2%)       29.08      (2.4%)   38.8% (  34% -   42%)\\n                 MedTerm       34.55      (1.5%)       48.31      (2.0%)   39.8% (  35% -   43%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13557263_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557263_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 15:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T15:12:33+0000\'\u003e18\\/Jan\\/13 15:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch looks great: +1 \\n\\n And this is a healthy speedup, on the Wikipedia 1M \\/ 25 ords per doc test: \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                PKLookup      239.18      (1.5%)      238.87      (1.1%)   -0.1% (  -2% -    2%)\\n                 LowTerm       98.99      (3.1%)      135.95      (1.8%)   37.3% (  31% -   43%)\\n                HighTerm       20.95      (1.2%)       29.08      (2.4%)   38.8% (  34% -   42%)\\n                 MedTerm       34.55      (1.5%)       48.31      (2.0%)   39.8% (  35% -   43%)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13557570\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13557570&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13557570\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13557570_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557570_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 20:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T20:27:49+0000\'\u003e18\\/Jan\\/13 20:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehandle some nocommits. Now there\'s no translation from OrdinalValue to FRNImpl in getFacetResults (the latter is used directly in the queue). I wonder if this buys us anything.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13557570_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557570_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 20:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T20:27:49+0000\'\u003e18\\/Jan\\/13 20:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    handle some nocommits. Now there\'s no translation from OrdinalValue to FRNImpl in getFacetResults (the latter is used directly in the queue). I wonder if this buys us anything.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13557581\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13557581&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13557581\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13557581_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557581_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 20:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T20:37:53+0000\'\u003e18\\/Jan\\/13 20:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt\'s faster!\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                PKLookup      239.75      (1.2%)      237.59      (1.0%)   -0.9% (  -3% -    1%)\\n                HighTerm       21.21      (1.5%)       29.80      (2.6%)   40.5% (  35% -   45%)\\n                 MedTerm       34.90      (1.9%)       50.24      (1.9%)   44.0% (  39% -   48%)\\n                 LowTerm       99.85      (3.7%)      152.40      (1.1%)   52.6% (  46% -   59%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13557581_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13557581_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/13 20:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-18T20:37:53+0000\'\u003e18\\/Jan\\/13 20:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It\'s faster! \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                PKLookup      239.75      (1.2%)      237.59      (1.0%)   -0.9% (  -3% -    1%)\\n                HighTerm       21.21      (1.5%)       29.80      (2.6%)   40.5% (  35% -   45%)\\n                 MedTerm       34.90      (1.9%)       50.24      (1.9%)   44.0% (  39% -   48%)\\n                 LowTerm       99.85      (3.7%)      152.40      (1.1%)   52.6% (  46% -   59%)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558171\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558171&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558171\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558171_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558171_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 06:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T06:37:24+0000\'\u003e20\\/Jan\\/13 06:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch adds two Collectors:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eDecoderCountingFacetsCollector, which uses the IntDecoder abstraction (but the rest is like CountingFacetsCollector)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003ePostCollectionCountingFacetsCollector, which moves the work from collect() to getFacetResults(). In collect(), it keeps a per-DocValues.Source bits (FixedBitSet) of the matching docs.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI wonder how these two compare to CountingFacetsCollector. I modified FacetsCollector.create() to return any of the 3, so just make sure to comment out the irrelevant ones in the benchmark.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558171_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558171_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 06:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T06:37:24+0000\'\u003e20\\/Jan\\/13 06:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch adds two Collectors: \\n\\n \\n\\t DecoderCountingFacetsCollector, which uses the IntDecoder abstraction (but the rest is like CountingFacetsCollector) \\n \\n\\n\\n \\n\\t PostCollectionCountingFacetsCollector, which moves the work from collect() to getFacetResults(). In collect(), it keeps a per-DocValues.Source bits (FixedBitSet) of the matching docs. \\n \\n\\n\\n I wonder how these two compare to CountingFacetsCollector. I modified FacetsCollector.create() to return any of the 3, so just make sure to comment out the irrelevant ones in the benchmark.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558247\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558247&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558247\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558247_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558247_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 13:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T13:46:39+0000\'\u003e20\\/Jan\\/13 13:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBase = DecoderCountingFacetsCollector; comp=CountingFacetsCollector:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       25.67      (1.6%)       30.45      (1.9%)   18.6% (  14% -   22%)\\n                 LowTerm      145.87      (1.0%)      154.38      (0.8%)    5.8% (   4% -    7%)\\n                 MedTerm       44.45      (1.4%)       51.01      (1.5%)   14.8% (  11% -   17%)\\n                PKLookup      240.08      (0.9%)      239.94      (1.0%)   -0.1% (  -1% -    1%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo it seems like the IntDecoder abstractions hurt ...\u003c\\/p\u003e\\n\\n\u003cp\u003eBase = DecoderCountingFacetsCollector; comp=PostCollectionCountingFacetsCollector:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       30.46      (0.8%)       30.16      (2.1%)   -1.0% (  -3% -    2%)\\n                 LowTerm      142.89      (0.5%)      153.94      (0.8%)    7.7% (   6% -    9%)\\n                 MedTerm       50.46      (0.8%)       50.65      (1.8%)    0.4% (  -2% -    2%)\\n                PKLookup      238.65      (1.1%)      238.55      (0.9%)   -0.0% (  -2% -    2%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThis is very interesting!  And good news for sampling?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558247_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558247_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 13:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T13:46:39+0000\'\u003e20\\/Jan\\/13 13:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Base = DecoderCountingFacetsCollector; comp=CountingFacetsCollector: \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       25.67      (1.6%)       30.45      (1.9%)   18.6% (  14% -   22%)\\n                 LowTerm      145.87      (1.0%)      154.38      (0.8%)    5.8% (   4% -    7%)\\n                 MedTerm       44.45      (1.4%)       51.01      (1.5%)   14.8% (  11% -   17%)\\n                PKLookup      240.08      (0.9%)      239.94      (1.0%)   -0.1% (  -1% -    1%)\\n \\n  \\n\\n So it seems like the IntDecoder abstractions hurt ... \\n\\n Base = DecoderCountingFacetsCollector; comp=PostCollectionCountingFacetsCollector: \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       30.46      (0.8%)       30.16      (2.1%)   -1.0% (  -3% -    2%)\\n                 LowTerm      142.89      (0.5%)      153.94      (0.8%)    7.7% (   6% -    9%)\\n                 MedTerm       50.46      (0.8%)       50.65      (1.8%)    0.4% (  -2% -    2%)\\n                PKLookup      238.65      (1.1%)      238.55      (0.9%)   -0.0% (  -2% -    2%)\\n \\n  \\n\\n This is very interesting!  And good news for sampling?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558252\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558252&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558252\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558252_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558252_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 13:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T13:55:17+0000\'\u003e20\\/Jan\\/13 13:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eok so the Decoder abstraction hurts ... that\'s a bummer. While dgap+vint specialization is simple, specializing e.g. a packed-ints (or whatever other block encoding algorithm we\'ll come up with on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4609\\\" title=\\\"Write a PackedIntsEncoder\\/Decoder for facets\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4609\\\"\u003e\u003cdel\u003eLUCENE-4609\u003c\\/del\u003e\u003c\\/a\u003e) will make the code uglier \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks like PostCollection doesn\'t hurt much? Can you compare it to Counting directly? I\'m confused by the results ... they seem to improve the Decoder collector, but not sure how it will match to Counting. If the differences are miniscule (to any direction), then it could mean good news to sampling, because then we will be able to fold in sampling to this specialized Collector. But it would also mean that we can fold in complements (TotalFacetCounts).\u003c\\/p\u003e\\n\\n\u003cp\u003eSo it looks like using any abstraction will hurt us. I didn\'t even try Aggregator, because it needs to either use the decoder, or do bulk-API (i.e. the Collector will decode into an IntsRef, not using IntDecoder, and then delegate to Aggregator) &#8211; seems useless to me, as counting + default decoding are the common scenario that we want to target.\u003c\\/p\u003e\\n\\n\u003cp\u003eBased on the Counting vs PostCollection results, we should decide whether to always do post-collection in Counting, or not. Folding in Sampling and Complements should be done separately, because they are not so easy to bring in w\\/ the current state of the API.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558252_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558252_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 13:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T13:55:17+0000\'\u003e20\\/Jan\\/13 13:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    ok so the Decoder abstraction hurts ... that\'s a bummer. While dgap+vint specialization is simple, specializing e.g. a packed-ints (or whatever other block encoding algorithm we\'ll come up with on   LUCENE-4609  ) will make the code uglier  . \\n\\n It looks like PostCollection doesn\'t hurt much? Can you compare it to Counting directly? I\'m confused by the results ... they seem to improve the Decoder collector, but not sure how it will match to Counting. If the differences are miniscule (to any direction), then it could mean good news to sampling, because then we will be able to fold in sampling to this specialized Collector. But it would also mean that we can fold in complements (TotalFacetCounts). \\n\\n So it looks like using any abstraction will hurt us. I didn\'t even try Aggregator, because it needs to either use the decoder, or do bulk-API (i.e. the Collector will decode into an IntsRef, not using IntDecoder, and then delegate to Aggregator) &#8211; seems useless to me, as counting + default decoding are the common scenario that we want to target. \\n\\n Based on the Counting vs PostCollection results, we should decide whether to always do post-collection in Counting, or not. Folding in Sampling and Complements should be done separately, because they are not so easy to bring in w\\/ the current state of the API.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558274\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558274&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558274\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558274_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558274_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T15:19:28+0000\'\u003e20\\/Jan\\/13 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmm, it occurred to me that maybe your second comparison was between PostCollection and Counting? If so, then while it\'s indeed interesting, it\'s puzzling. PostCollection allocates FixedBitSet for every segment and in the end obtains a DISI from each FBS. As much as I know, DISIs over bitsets are not so cheap, especially when nextDoc() is called, because they need to find the next set bit ... if indeed it\'s faster, we must get to the bottom of it. It could mean other Collector could benefit from such post-collection technique ...\u003c\\/p\u003e\\n\\n\u003cp\u003eWhile on that, is the best way to iterate on a bitset\'s set bits via DISI? I\'m looking at OpenBitSetDISI.nextDoc() and it looks much more expensive than FixedBitSet.nextSetBit(). I modified PostCollection to do:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003ewhile\u003c\\/span\u003e (doc &lt; length &amp;&amp; (doc = bits.nextSetBit(doc)) != -1) {\\n  .. the previous code\\n  ++doc;\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eAnd all tests pass with this change too. I wonder if that\'s faster than DISI.\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW, while making this change I noticed that I have a slight inefficiency in all 3 Collectors. If the document has not facets, I should have returned, but I forgot the return statement, e.g.:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (buf.length == 0) {\\n      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e document has no facets\\n\u003c\\/span\u003e      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e; \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ THAT LINE WAS MISSING!\\n\u003c\\/span\u003e    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe code is still correct, just doing some redundant extra instructions. I\'ll upload an updated patch, with both changes shortly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558274_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558274_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T15:19:28+0000\'\u003e20\\/Jan\\/13 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmm, it occurred to me that maybe your second comparison was between PostCollection and Counting? If so, then while it\'s indeed interesting, it\'s puzzling. PostCollection allocates FixedBitSet for every segment and in the end obtains a DISI from each FBS. As much as I know, DISIs over bitsets are not so cheap, especially when nextDoc() is called, because they need to find the next set bit ... if indeed it\'s faster, we must get to the bottom of it. It could mean other Collector could benefit from such post-collection technique ... \\n\\n While on that, is the best way to iterate on a bitset\'s set bits via DISI? I\'m looking at OpenBitSetDISI.nextDoc() and it looks much more expensive than FixedBitSet.nextSetBit(). I modified PostCollection to do: \\n\\n  \\n  while  (doc &lt; length &amp;&amp; (doc = bits.nextSetBit(doc)) != -1) {\\n  .. the previous code\\n  ++doc;\\n}\\n \\n  \\n\\n And all tests pass with this change too. I wonder if that\'s faster than DISI. \\n\\n BTW, while making this change I noticed that I have a slight inefficiency in all 3 Collectors. If the document has not facets, I should have returned, but I forgot the return statement, e.g.: \\n\\n  \\n      if  (buf.length == 0) {\\n       \\/\\/  this  document has no facets\\n        return ;  \\/\\/ THAT LINE WAS MISSING!\\n     }\\n \\n  \\n\\n The code is still correct, just doing some redundant extra instructions. I\'ll upload an updated patch, with both changes shortly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558275\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558275&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558275\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558275_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558275_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 15:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T15:20:28+0000\'\u003e20\\/Jan\\/13 15:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch fixes the missing return statement in all 3 collectors, as well as moves from DISI to nextSetBit.\u003c\\/p\u003e\\n\\n\u003cp\u003eMike, is it possible to compare Counting and PostCollection to trunk, instead of to each other?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558275_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558275_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 15:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T15:20:28+0000\'\u003e20\\/Jan\\/13 15:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch fixes the missing return statement in all 3 collectors, as well as moves from DISI to nextSetBit. \\n\\n Mike, is it possible to compare Counting and PostCollection to trunk, instead of to each other?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558287\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558287&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558287\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558287_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558287_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 15:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T15:52:25+0000\'\u003e20\\/Jan\\/13 15:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eCan you compare it to Counting directly?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eUgh, sorry, that is in fact what I ran but I put the wrong base\\/comp above it.  The test was actually base = PostCollectionCountingFacetsCollector, comp = CountingFacetsCollector.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558287_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558287_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 15:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T15:52:25+0000\'\u003e20\\/Jan\\/13 15:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Can you compare it to Counting directly?  \\n\\n Ugh, sorry, that is in fact what I ran but I put the wrong base\\/comp above it.  The test was actually base = PostCollectionCountingFacetsCollector, comp = CountingFacetsCollector.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558295\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558295&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558295\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558295_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558295_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 16:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T16:15:33+0000\'\u003e20\\/Jan\\/13 16:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eStandardFacetsCollector (base) vs DecoderCountingFacetsCollector (comp):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       21.44      (1.4%)       25.71      (1.3%)   19.9% (  16% -   22%)\\n                 LowTerm       99.73      (3.2%)      145.71      (1.2%)   46.1% (  40% -   52%)\\n                 MedTerm       35.13      (1.6%)       44.46      (1.1%)   26.6% (  23% -   29%)\\n                PKLookup      241.15      (1.0%)      238.90      (1.0%)   -0.9% (  -2% -    1%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eStandardFacetsCollector (base) vs PostCollectionCountingFacetsCollector (comp):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       21.26      (0.9%)       31.36      (1.4%)   47.5% (  44% -   50%)\\n                 LowTerm       99.84      (3.2%)      159.17      (0.7%)   59.4% (  53% -   65%)\\n                 MedTerm       34.91      (1.3%)       52.65      (1.2%)   50.8% (  47% -   54%)\\n                PKLookup      238.08      (1.3%)      238.26      (1.2%)    0.1% (  -2% -    2%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eStandardFacetsCollector (base) vs CountingFacetsCollector (comp):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       21.35      (1.3%)       30.26      (2.9%)   41.7% (  37% -   46%)\\n                 LowTerm      100.45      (4.0%)      153.26      (1.1%)   52.6% (  45% -   60%)\\n                 MedTerm       35.02      (1.9%)       50.77      (2.0%)   45.0% (  40% -   49%)\\n                PKLookup      237.88      (2.4%)      239.34      (0.9%)    0.6% (  -2% -    4%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558295_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558295_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 16:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T16:15:33+0000\'\u003e20\\/Jan\\/13 16:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    StandardFacetsCollector (base) vs DecoderCountingFacetsCollector (comp): \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       21.44      (1.4%)       25.71      (1.3%)   19.9% (  16% -   22%)\\n                 LowTerm       99.73      (3.2%)      145.71      (1.2%)   46.1% (  40% -   52%)\\n                 MedTerm       35.13      (1.6%)       44.46      (1.1%)   26.6% (  23% -   29%)\\n                PKLookup      241.15      (1.0%)      238.90      (1.0%)   -0.9% (  -2% -    1%)\\n \\n  \\n\\n StandardFacetsCollector (base) vs PostCollectionCountingFacetsCollector (comp): \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       21.26      (0.9%)       31.36      (1.4%)   47.5% (  44% -   50%)\\n                 LowTerm       99.84      (3.2%)      159.17      (0.7%)   59.4% (  53% -   65%)\\n                 MedTerm       34.91      (1.3%)       52.65      (1.2%)   50.8% (  47% -   54%)\\n                PKLookup      238.08      (1.3%)      238.26      (1.2%)    0.1% (  -2% -    2%)\\n \\n  \\n\\n StandardFacetsCollector (base) vs CountingFacetsCollector (comp): \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       21.35      (1.3%)       30.26      (2.9%)   41.7% (  37% -   46%)\\n                 LowTerm      100.45      (4.0%)      153.26      (1.1%)   52.6% (  45% -   60%)\\n                 MedTerm       35.02      (1.9%)       50.77      (2.0%)   45.0% (  40% -   49%)\\n                PKLookup      237.88      (2.4%)      239.34      (0.9%)    0.6% (  -2% -    4%)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558303\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558303&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558303\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558303_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558303_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 16:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T16:26:19+0000\'\u003e20\\/Jan\\/13 16:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI re-ran CountingFacetsCollector (base) vs PostCollectionCountingFacetsCollector (comp):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       30.15      (1.4%)       30.97      (1.1%)    2.7% (   0% -    5%)\\n                 LowTerm      153.06      (0.4%)      158.26      (0.7%)    3.4% (   2% -    4%)\\n                 MedTerm       50.69      (0.9%)       52.29      (0.9%)    3.2% (   1% -    5%)\\n                PKLookup      238.04      (1.3%)      236.79      (1.8%)   -0.5% (  -3% -    2%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eI think the cutover away from DISI made it faster ... and it\'s surprising this (allocate bit set, set the bits, revisit the set bits in the end) is faster than count-as-you-go.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558303_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558303_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 16:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T16:26:19+0000\'\u003e20\\/Jan\\/13 16:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I re-ran CountingFacetsCollector (base) vs PostCollectionCountingFacetsCollector (comp): \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                HighTerm       30.15      (1.4%)       30.97      (1.1%)    2.7% (   0% -    5%)\\n                 LowTerm      153.06      (0.4%)      158.26      (0.7%)    3.4% (   2% -    4%)\\n                 MedTerm       50.69      (0.9%)       52.29      (0.9%)    3.2% (   1% -    5%)\\n                PKLookup      238.04      (1.3%)      236.79      (1.8%)   -0.5% (  -3% -    2%)\\n \\n  \\n I think the cutover away from DISI made it faster ... and it\'s surprising this (allocate bit set, set the bits, revisit the set bits in the end) is faster than count-as-you-go.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558328\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558328&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558328\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558328_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558328_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 17:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T17:48:04+0000\'\u003e20\\/Jan\\/13 17:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m surprised too. Throwing off a wild idea, maybe the post collection buys us a locality of reference in terms of the counts[] (and maybe even DocValues.Source?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt almost feels counter-intuitive, right? CountingFC\'s operations are a subset of PostCollectionCFC. The latter adds many bitwise operations, ifs, loops and what not. So what do we do? Stick w\\/ post-collection? \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558328_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558328_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 17:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T17:48:04+0000\'\u003e20\\/Jan\\/13 17:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m surprised too. Throwing off a wild idea, maybe the post collection buys us a locality of reference in terms of the counts[] (and maybe even DocValues.Source? \\n\\n It almost feels counter-intuitive, right? CountingFC\'s operations are a subset of PostCollectionCFC. The latter adds many bitwise operations, ifs, loops and what not. So what do we do? Stick w\\/ post-collection?                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558330\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558330&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558330\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558330_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558330_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 17:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T17:58:02+0000\'\u003e20\\/Jan\\/13 17:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran the same test, but w\\/ the full set of query categories:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n              AndHighLow      111.98      (1.0%)      110.10      (1.0%)   -1.7% (  -3% -    0%)\\n            HighSpanNear      128.42      (1.4%)      126.32      (1.1%)   -1.6% (  -4% -    0%)\\n             LowSpanNear      128.68      (1.4%)      126.59      (1.0%)   -1.6% (  -3% -    0%)\\n             MedSpanNear      128.18      (1.3%)      126.29      (1.1%)   -1.5% (  -3% -    0%)\\n                 Respell       55.79      (3.9%)       55.35      (4.8%)   -0.8% (  -9% -    8%)\\n                PKLookup      206.89      (1.1%)      208.08      (1.5%)    0.6% (  -2% -    3%)\\n                  Fuzzy2       36.21      (1.3%)       36.49      (2.3%)    0.8% (  -2% -    4%)\\n               MedPhrase       56.42      (1.4%)       56.94      (1.3%)    0.9% (  -1% -    3%)\\n                Wildcard       64.26      (3.8%)       64.88      (2.0%)    1.0% (  -4% -    7%)\\n              AndHighMed       51.80      (0.7%)       52.44      (1.2%)    1.2% (   0% -    3%)\\n                  IntNRQ       18.49      (4.8%)       18.78      (5.5%)    1.6% (  -8% -   12%)\\n                 LowTerm       41.15      (0.6%)       41.82      (0.9%)    1.6% (   0% -    3%)\\n                 Prefix3       46.94      (4.3%)       47.92      (3.4%)    2.1% (  -5% -   10%)\\n                 MedTerm       18.47      (0.8%)       18.92      (1.3%)    2.4% (   0% -    4%)\\n              HighPhrase       15.16      (6.2%)       15.77      (4.3%)    4.0% (  -6% -   15%)\\n                HighTerm        6.76      (1.2%)        7.07      (1.2%)    4.5% (   2% -    7%)\\n         LowSloppyPhrase       17.14      (3.8%)       17.96      (2.3%)    4.8% (  -1% -   11%)\\n                  Fuzzy1       27.29      (0.8%)       28.62      (1.4%)    4.9% (   2% -    7%)\\n         MedSloppyPhrase       17.64      (2.4%)       18.90      (1.0%)    7.2% (   3% -   10%)\\n             AndHighHigh       11.11      (0.5%)       11.97      (0.9%)    7.7% (   6% -    9%)\\n        HighSloppyPhrase        0.83     (10.5%)        0.91      (5.9%)   10.1% (  -5% -   29%)\\n               LowPhrase       15.83      (3.2%)       17.45      (0.2%)   10.2% (   6% -   14%)\\n              OrHighHigh        3.22      (0.7%)        3.80      (1.5%)   18.1% (  15% -   20%)\\n               OrHighLow        5.68      (0.3%)        6.73      (1.5%)   18.4% (  16% -   20%)\\n               OrHighMed        5.61      (0.5%)        6.66      (1.6%)   18.7% (  16% -   20%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSomehow post-collection is a big gain for the Or queries ... I wonder if somehow we are not getting the out of order scorer (BooleanScorer) w\\/ CountingCollector ... but looking at both collectors they both return true from acceptsDocsOutOfOrder ...\u003c\\/p\u003e\\n\\n\u003cp\u003eNet\\/net it seems like we should stick with post collection?  The possible downside is memory use of the temporary bit set I guess ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558330_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558330_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 17:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T17:58:02+0000\'\u003e20\\/Jan\\/13 17:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran the same test, but w\\/ the full set of query categories: \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n              AndHighLow      111.98      (1.0%)      110.10      (1.0%)   -1.7% (  -3% -    0%)\\n            HighSpanNear      128.42      (1.4%)      126.32      (1.1%)   -1.6% (  -4% -    0%)\\n             LowSpanNear      128.68      (1.4%)      126.59      (1.0%)   -1.6% (  -3% -    0%)\\n             MedSpanNear      128.18      (1.3%)      126.29      (1.1%)   -1.5% (  -3% -    0%)\\n                 Respell       55.79      (3.9%)       55.35      (4.8%)   -0.8% (  -9% -    8%)\\n                PKLookup      206.89      (1.1%)      208.08      (1.5%)    0.6% (  -2% -    3%)\\n                  Fuzzy2       36.21      (1.3%)       36.49      (2.3%)    0.8% (  -2% -    4%)\\n               MedPhrase       56.42      (1.4%)       56.94      (1.3%)    0.9% (  -1% -    3%)\\n                Wildcard       64.26      (3.8%)       64.88      (2.0%)    1.0% (  -4% -    7%)\\n              AndHighMed       51.80      (0.7%)       52.44      (1.2%)    1.2% (   0% -    3%)\\n                  IntNRQ       18.49      (4.8%)       18.78      (5.5%)    1.6% (  -8% -   12%)\\n                 LowTerm       41.15      (0.6%)       41.82      (0.9%)    1.6% (   0% -    3%)\\n                 Prefix3       46.94      (4.3%)       47.92      (3.4%)    2.1% (  -5% -   10%)\\n                 MedTerm       18.47      (0.8%)       18.92      (1.3%)    2.4% (   0% -    4%)\\n              HighPhrase       15.16      (6.2%)       15.77      (4.3%)    4.0% (  -6% -   15%)\\n                HighTerm        6.76      (1.2%)        7.07      (1.2%)    4.5% (   2% -    7%)\\n         LowSloppyPhrase       17.14      (3.8%)       17.96      (2.3%)    4.8% (  -1% -   11%)\\n                  Fuzzy1       27.29      (0.8%)       28.62      (1.4%)    4.9% (   2% -    7%)\\n         MedSloppyPhrase       17.64      (2.4%)       18.90      (1.0%)    7.2% (   3% -   10%)\\n             AndHighHigh       11.11      (0.5%)       11.97      (0.9%)    7.7% (   6% -    9%)\\n        HighSloppyPhrase        0.83     (10.5%)        0.91      (5.9%)   10.1% (  -5% -   29%)\\n               LowPhrase       15.83      (3.2%)       17.45      (0.2%)   10.2% (   6% -   14%)\\n              OrHighHigh        3.22      (0.7%)        3.80      (1.5%)   18.1% (  15% -   20%)\\n               OrHighLow        5.68      (0.3%)        6.73      (1.5%)   18.4% (  16% -   20%)\\n               OrHighMed        5.61      (0.5%)        6.66      (1.6%)   18.7% (  16% -   20%)\\n \\n  \\n\\n Somehow post-collection is a big gain for the Or queries ... I wonder if somehow we are not getting the out of order scorer (BooleanScorer) w\\/ CountingCollector ... but looking at both collectors they both return true from acceptsDocsOutOfOrder ... \\n\\n Net\\/net it seems like we should stick with post collection?  The possible downside is memory use of the temporary bit set I guess ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558334\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558334&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558334\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558334_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558334_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 18:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T18:09:45+0000\'\u003e20\\/Jan\\/13 18:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI confirmed that the Or queries are using BooleanScorer in both base and comp, so those gains are \\\"real\\\".\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558334_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558334_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 18:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T18:09:45+0000\'\u003e20\\/Jan\\/13 18:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I confirmed that the Or queries are using BooleanScorer in both base and comp, so those gains are \\\"real\\\".              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558361\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558361&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558361\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558361_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558361_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T19:49:00+0000\'\u003e20\\/Jan\\/13 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eResults if I rebuild the index with NO_PARENTS (just to make sure the locality gains are not due to frequently visiting the parent ords in the count array):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                 Respell       55.59      (3.9%)       54.45      (3.4%)   -2.0% (  -8% -    5%)\\n                  IntNRQ       18.34      (7.1%)       18.04      (6.4%)   -1.7% ( -14% -   12%)\\n              AndHighLow       86.87      (0.6%)       86.26      (1.9%)   -0.7% (  -3% -    1%)\\n             MedSpanNear       97.31      (0.9%)       96.63      (1.8%)   -0.7% (  -3% -    1%)\\n                 Prefix3       46.40      (5.6%)       46.11      (4.6%)   -0.6% ( -10% -   10%)\\n             LowSpanNear       97.76      (0.9%)       97.28      (1.8%)   -0.5% (  -3% -    2%)\\n                  Fuzzy2       31.88      (1.6%)       31.77      (2.7%)   -0.3% (  -4% -    3%)\\n                Wildcard       62.53      (2.9%)       62.34      (2.5%)   -0.3% (  -5% -    5%)\\n                PKLookup      210.69      (1.5%)      210.37      (1.8%)   -0.1% (  -3% -    3%)\\n            HighSpanNear       97.44      (1.4%)       97.35      (1.7%)   -0.1% (  -3% -    3%)\\n               MedPhrase       49.87      (2.4%)       50.18      (2.5%)    0.6% (  -4% -    5%)\\n              HighPhrase       14.32      (8.8%)       14.42      (8.8%)    0.7% ( -15% -   20%)\\n                 LowTerm       37.64      (0.5%)       37.90      (1.3%)    0.7% (  -1% -    2%)\\n              AndHighMed       45.23      (0.6%)       45.74      (1.1%)    1.1% (   0% -    2%)\\n                 MedTerm       22.53      (1.0%)       23.00      (1.3%)    2.1% (   0% -    4%)\\n         LowSloppyPhrase       16.27      (2.5%)       16.65      (5.7%)    2.3% (  -5% -   10%)\\n                  Fuzzy1       24.86      (1.7%)       25.87      (1.4%)    4.1% (   0% -    7%)\\n                HighTerm        7.67      (1.6%)        8.00      (2.4%)    4.3% (   0% -    8%)\\n         MedSloppyPhrase       16.67      (1.2%)       17.58      (3.1%)    5.5% (   1% -    9%)\\n        HighSloppyPhrase        0.81      (6.6%)        0.86     (12.8%)    6.9% ( -11% -   28%)\\n             AndHighHigh       11.38      (0.8%)       12.18      (1.2%)    7.1% (   5% -    9%)\\n               LowPhrase       14.69      (4.7%)       15.82      (5.7%)    7.6% (  -2% -   18%)\\n              OrHighHigh        3.60      (2.3%)        4.32      (3.3%)   20.0% (  14% -   26%)\\n               OrHighMed        6.20      (1.9%)        7.51      (3.0%)   21.1% (  15% -   26%)\\n               OrHighLow        6.25      (2.0%)        7.60      (2.4%)   21.7% (  17% -   26%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo net\\/net post is still better!  Separately it looks like NO_PARENTS is maybe ~10% faster for the high-cost queries, but slower for the low cost queries ... which is expected because iterating over 2.2 M ords in the end is a fixed non-trivial cost ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558361_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558361_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T19:49:00+0000\'\u003e20\\/Jan\\/13 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Results if I rebuild the index with NO_PARENTS (just to make sure the locality gains are not due to frequently visiting the parent ords in the count array): \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                 Respell       55.59      (3.9%)       54.45      (3.4%)   -2.0% (  -8% -    5%)\\n                  IntNRQ       18.34      (7.1%)       18.04      (6.4%)   -1.7% ( -14% -   12%)\\n              AndHighLow       86.87      (0.6%)       86.26      (1.9%)   -0.7% (  -3% -    1%)\\n             MedSpanNear       97.31      (0.9%)       96.63      (1.8%)   -0.7% (  -3% -    1%)\\n                 Prefix3       46.40      (5.6%)       46.11      (4.6%)   -0.6% ( -10% -   10%)\\n             LowSpanNear       97.76      (0.9%)       97.28      (1.8%)   -0.5% (  -3% -    2%)\\n                  Fuzzy2       31.88      (1.6%)       31.77      (2.7%)   -0.3% (  -4% -    3%)\\n                Wildcard       62.53      (2.9%)       62.34      (2.5%)   -0.3% (  -5% -    5%)\\n                PKLookup      210.69      (1.5%)      210.37      (1.8%)   -0.1% (  -3% -    3%)\\n            HighSpanNear       97.44      (1.4%)       97.35      (1.7%)   -0.1% (  -3% -    3%)\\n               MedPhrase       49.87      (2.4%)       50.18      (2.5%)    0.6% (  -4% -    5%)\\n              HighPhrase       14.32      (8.8%)       14.42      (8.8%)    0.7% ( -15% -   20%)\\n                 LowTerm       37.64      (0.5%)       37.90      (1.3%)    0.7% (  -1% -    2%)\\n              AndHighMed       45.23      (0.6%)       45.74      (1.1%)    1.1% (   0% -    2%)\\n                 MedTerm       22.53      (1.0%)       23.00      (1.3%)    2.1% (   0% -    4%)\\n         LowSloppyPhrase       16.27      (2.5%)       16.65      (5.7%)    2.3% (  -5% -   10%)\\n                  Fuzzy1       24.86      (1.7%)       25.87      (1.4%)    4.1% (   0% -    7%)\\n                HighTerm        7.67      (1.6%)        8.00      (2.4%)    4.3% (   0% -    8%)\\n         MedSloppyPhrase       16.67      (1.2%)       17.58      (3.1%)    5.5% (   1% -    9%)\\n        HighSloppyPhrase        0.81      (6.6%)        0.86     (12.8%)    6.9% ( -11% -   28%)\\n             AndHighHigh       11.38      (0.8%)       12.18      (1.2%)    7.1% (   5% -    9%)\\n               LowPhrase       14.69      (4.7%)       15.82      (5.7%)    7.6% (  -2% -   18%)\\n              OrHighHigh        3.60      (2.3%)        4.32      (3.3%)   20.0% (  14% -   26%)\\n               OrHighMed        6.20      (1.9%)        7.51      (3.0%)   21.1% (  15% -   26%)\\n               OrHighLow        6.25      (2.0%)        7.60      (2.4%)   21.7% (  17% -   26%)\\n \\n  \\n\\n So net\\/net post is still better!  Separately it looks like NO_PARENTS is maybe ~10% faster for the high-cost queries, but slower for the low cost queries ... which is expected because iterating over 2.2 M ords in the end is a fixed non-trivial cost ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558377\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558377&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558377\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558377_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558377_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 20:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T20:32:43+0000\'\u003e20\\/Jan\\/13 20:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGood. So I\'ll consolidate Post and Counting into one, an also add handling for NO_PARENTS case. Unfortunately, we cannot compare trunk vs patch for the NO_PARENTS case, unless we write a lot of redundant code (e.g. a NoParentsAccumulator). We\'ll have to suffice w\\/ the absolute QPS numbers I guess, which is about 12% improvements.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558377_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558377_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/13 20:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-20T20:32:43+0000\'\u003e20\\/Jan\\/13 20:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Good. So I\'ll consolidate Post and Counting into one, an also add handling for NO_PARENTS case. Unfortunately, we cannot compare trunk vs patch for the NO_PARENTS case, unless we write a lot of redundant code (e.g. a NoParentsAccumulator). We\'ll have to suffice w\\/ the absolute QPS numbers I guess, which is about 12% improvements.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558559\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558559&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558559\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558559_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558559_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 06:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T06:17:01+0000\'\u003e21\\/Jan\\/13 06:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch finalizes CountingFacetsCollector to handle the specialized case of facets counting, doing the counting in post-aggregation. Also, it can handle OrdinalPolicy.NO_PARENTS, allowing to index only leaf ordinals, and counting up the parents after the leafs\' counts have been resolved.\u003c\\/p\u003e\\n\\n\u003cp\u003eAdded a CHANGES entry, and updated some javadocs.\u003c\\/p\u003e\\n\\n\u003cp\u003eWould be good if we can give this version a final comparison against trunk. For the ALL_PARENTS case, we can compare the pct diff, while for NO_PARENTS we can only compare absolute QPS for now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558559_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558559_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 06:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T06:17:01+0000\'\u003e21\\/Jan\\/13 06:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch finalizes CountingFacetsCollector to handle the specialized case of facets counting, doing the counting in post-aggregation. Also, it can handle OrdinalPolicy.NO_PARENTS, allowing to index only leaf ordinals, and counting up the parents after the leafs\' counts have been resolved. \\n\\n Added a CHANGES entry, and updated some javadocs. \\n\\n Would be good if we can give this version a final comparison against trunk. For the ALL_PARENTS case, we can compare the pct diff, while for NO_PARENTS we can only compare absolute QPS for now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558738\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558738&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558738\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558738_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558738_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 13:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T13:03:20+0000\'\u003e21\\/Jan\\/13 13:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eALL_PARENTS StandardFacetsCollector (base) vs CountingFacetsCollector (comp):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                 Respell       55.89      (3.2%)       55.13      (3.9%)   -1.4% (  -8% -    5%)\\n                PKLookup      207.52      (1.6%)      206.95      (1.4%)   -0.3% (  -3% -    2%)\\n                Wildcard       62.22      (3.2%)       62.94      (2.7%)    1.2% (  -4% -    7%)\\n                  IntNRQ       17.88      (5.2%)       18.16      (5.7%)    1.6% (  -8% -   13%)\\n                 Prefix3       45.56      (4.9%)       46.48      (4.1%)    2.0% (  -6% -   11%)\\n        HighSloppyPhrase        0.80      (9.7%)        0.84      (8.5%)    4.9% ( -12% -   25%)\\n              HighPhrase       13.52      (7.7%)       15.09      (8.1%)   11.6% (  -3% -   29%)\\n         LowSloppyPhrase       15.02      (3.9%)       17.15      (4.0%)   14.1% (   5% -   22%)\\n               LowPhrase       14.14      (4.3%)       16.77      (4.9%)   18.6% (   8% -   29%)\\n         MedSloppyPhrase       14.81      (2.6%)       18.33      (2.7%)   23.7% (  17% -   29%)\\n                  Fuzzy2       27.57      (2.6%)       34.95      (3.1%)   26.8% (  20% -   33%)\\n             AndHighHigh        9.39      (1.6%)       11.92      (1.4%)   27.0% (  23% -   30%)\\n                 MedTerm       14.63      (2.2%)       18.89      (1.7%)   29.1% (  24% -   33%)\\n                HighTerm        5.28      (1.8%)        7.02      (2.4%)   33.0% (  28% -   37%)\\n                  Fuzzy1       20.79      (2.1%)       27.71      (2.8%)   33.3% (  27% -   39%)\\n               OrHighLow        4.82      (1.8%)        6.70      (2.6%)   39.1% (  34% -   44%)\\n               OrHighMed        4.74      (1.8%)        6.61      (3.0%)   39.4% (  34% -   44%)\\n              OrHighHigh        2.68      (1.8%)        3.77      (2.9%)   40.9% (  35% -   46%)\\n               MedPhrase       39.21      (3.6%)       55.35      (3.6%)   41.2% (  32% -   50%)\\n              AndHighMed       36.29      (3.5%)       51.92      (2.0%)   43.1% (  36% -   50%)\\n                 LowTerm       27.96      (3.2%)       41.47      (2.2%)   48.3% (  41% -   55%)\\n              AndHighLow       64.36      (5.4%)      107.94      (5.7%)   67.7% (  53% -   83%)\\n             MedSpanNear       70.17      (6.1%)      123.23      (7.4%)   75.6% (  58% -   94%)\\n             LowSpanNear       70.35      (6.0%)      123.59      (7.1%)   75.7% (  58% -   94%)\\n            HighSpanNear       70.35      (6.1%)      123.69      (7.8%)   75.8% (  58% -   95%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThese are nice gains!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558738_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558738_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 13:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T13:03:20+0000\'\u003e21\\/Jan\\/13 13:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    ALL_PARENTS StandardFacetsCollector (base) vs CountingFacetsCollector (comp): \\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                 Respell       55.89      (3.2%)       55.13      (3.9%)   -1.4% (  -8% -    5%)\\n                PKLookup      207.52      (1.6%)      206.95      (1.4%)   -0.3% (  -3% -    2%)\\n                Wildcard       62.22      (3.2%)       62.94      (2.7%)    1.2% (  -4% -    7%)\\n                  IntNRQ       17.88      (5.2%)       18.16      (5.7%)    1.6% (  -8% -   13%)\\n                 Prefix3       45.56      (4.9%)       46.48      (4.1%)    2.0% (  -6% -   11%)\\n        HighSloppyPhrase        0.80      (9.7%)        0.84      (8.5%)    4.9% ( -12% -   25%)\\n              HighPhrase       13.52      (7.7%)       15.09      (8.1%)   11.6% (  -3% -   29%)\\n         LowSloppyPhrase       15.02      (3.9%)       17.15      (4.0%)   14.1% (   5% -   22%)\\n               LowPhrase       14.14      (4.3%)       16.77      (4.9%)   18.6% (   8% -   29%)\\n         MedSloppyPhrase       14.81      (2.6%)       18.33      (2.7%)   23.7% (  17% -   29%)\\n                  Fuzzy2       27.57      (2.6%)       34.95      (3.1%)   26.8% (  20% -   33%)\\n             AndHighHigh        9.39      (1.6%)       11.92      (1.4%)   27.0% (  23% -   30%)\\n                 MedTerm       14.63      (2.2%)       18.89      (1.7%)   29.1% (  24% -   33%)\\n                HighTerm        5.28      (1.8%)        7.02      (2.4%)   33.0% (  28% -   37%)\\n                  Fuzzy1       20.79      (2.1%)       27.71      (2.8%)   33.3% (  27% -   39%)\\n               OrHighLow        4.82      (1.8%)        6.70      (2.6%)   39.1% (  34% -   44%)\\n               OrHighMed        4.74      (1.8%)        6.61      (3.0%)   39.4% (  34% -   44%)\\n              OrHighHigh        2.68      (1.8%)        3.77      (2.9%)   40.9% (  35% -   46%)\\n               MedPhrase       39.21      (3.6%)       55.35      (3.6%)   41.2% (  32% -   50%)\\n              AndHighMed       36.29      (3.5%)       51.92      (2.0%)   43.1% (  36% -   50%)\\n                 LowTerm       27.96      (3.2%)       41.47      (2.2%)   48.3% (  41% -   55%)\\n              AndHighLow       64.36      (5.4%)      107.94      (5.7%)   67.7% (  53% -   83%)\\n             MedSpanNear       70.17      (6.1%)      123.23      (7.4%)   75.6% (  58% -   94%)\\n             LowSpanNear       70.35      (6.0%)      123.59      (7.1%)   75.7% (  58% -   94%)\\n            HighSpanNear       70.35      (6.1%)      123.69      (7.8%)   75.8% (  58% -   95%)\\n \\n  \\n\\n These are nice gains!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558752\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558752&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558752\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558752_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558752_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 13:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T13:25:21+0000\'\u003e21\\/Jan\\/13 13:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNO_PARENTS CountingFacetsCollector vs itself (ie all differences are noise).  Use the absolute QPS to compare to the \\\"QPS comp\\\" column above, eg MedTerm was 18.89 QPS above with ALL_PARENTS and with NO_PARENTS MedTerm is 22.67-22.80 QPS:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n              AndHighLow       85.20      (5.0%)       83.74      (5.7%)   -1.7% ( -11% -    9%)\\n             LowSpanNear       95.25      (5.5%)       93.67      (6.8%)   -1.7% ( -13% -   11%)\\n            HighSpanNear       95.19      (5.4%)       93.80      (6.7%)   -1.5% ( -12% -   11%)\\n             MedSpanNear       94.97      (5.4%)       93.59      (6.8%)   -1.5% ( -12% -   11%)\\n              AndHighMed       45.68      (2.8%)       45.29      (2.9%)   -0.9% (  -6% -    4%)\\n               OrHighLow        7.62      (2.2%)        7.55      (2.2%)   -0.8% (  -5% -    3%)\\n              OrHighHigh        4.33      (2.2%)        4.29      (2.2%)   -0.8% (  -5% -    3%)\\n                 LowTerm       38.17      (2.0%)       37.90      (2.2%)   -0.7% (  -4% -    3%)\\n               OrHighMed        7.54      (2.2%)        7.49      (2.1%)   -0.7% (  -4% -    3%)\\n                 Prefix3       45.95      (4.3%)       45.68      (4.4%)   -0.6% (  -8% -    8%)\\n                 MedTerm       22.80      (2.2%)       22.67      (2.1%)   -0.6% (  -4% -    3%)\\n                  Fuzzy1       26.16      (1.9%)       26.04      (2.0%)   -0.4% (  -4% -    3%)\\n                  IntNRQ       17.94      (6.1%)       17.86      (6.2%)   -0.4% ( -11% -   12%)\\n             AndHighHigh       12.33      (1.2%)       12.29      (1.3%)   -0.4% (  -2% -    2%)\\n                  Fuzzy2       32.00      (2.8%)       31.89      (3.0%)   -0.3% (  -5% -    5%)\\n               MedPhrase       49.48      (3.9%)       49.32      (4.4%)   -0.3% (  -8% -    8%)\\n                HighTerm        8.02      (2.1%)        8.00      (2.0%)   -0.2% (  -4% -    3%)\\n                PKLookup      211.76      (1.4%)      211.32      (1.8%)   -0.2% (  -3% -    3%)\\n                Wildcard       62.37      (2.3%)       62.28      (2.3%)   -0.1% (  -4% -    4%)\\n         MedSloppyPhrase       17.49      (2.5%)       17.52      (2.7%)    0.2% (  -4% -    5%)\\n                 Respell       55.68      (5.0%)       55.85      (3.3%)    0.3% (  -7% -    9%)\\n         LowSloppyPhrase       16.29      (4.7%)       16.43      (5.2%)    0.9% (  -8% -   11%)\\n               LowPhrase       15.68      (5.3%)       15.81      (5.4%)    0.9% (  -9% -   12%)\\n              HighPhrase       14.22      (8.7%)       14.45      (8.9%)    1.6% ( -14% -   21%)\\n        HighSloppyPhrase        0.83      (9.3%)        0.85     (11.9%)    2.1% ( -17% -   25%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558752_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558752_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 13:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T13:25:21+0000\'\u003e21\\/Jan\\/13 13:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    NO_PARENTS CountingFacetsCollector vs itself (ie all differences are noise).  Use the absolute QPS to compare to the \\\"QPS comp\\\" column above, eg MedTerm was 18.89 QPS above with ALL_PARENTS and with NO_PARENTS MedTerm is 22.67-22.80 QPS: \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n              AndHighLow       85.20      (5.0%)       83.74      (5.7%)   -1.7% ( -11% -    9%)\\n             LowSpanNear       95.25      (5.5%)       93.67      (6.8%)   -1.7% ( -13% -   11%)\\n            HighSpanNear       95.19      (5.4%)       93.80      (6.7%)   -1.5% ( -12% -   11%)\\n             MedSpanNear       94.97      (5.4%)       93.59      (6.8%)   -1.5% ( -12% -   11%)\\n              AndHighMed       45.68      (2.8%)       45.29      (2.9%)   -0.9% (  -6% -    4%)\\n               OrHighLow        7.62      (2.2%)        7.55      (2.2%)   -0.8% (  -5% -    3%)\\n              OrHighHigh        4.33      (2.2%)        4.29      (2.2%)   -0.8% (  -5% -    3%)\\n                 LowTerm       38.17      (2.0%)       37.90      (2.2%)   -0.7% (  -4% -    3%)\\n               OrHighMed        7.54      (2.2%)        7.49      (2.1%)   -0.7% (  -4% -    3%)\\n                 Prefix3       45.95      (4.3%)       45.68      (4.4%)   -0.6% (  -8% -    8%)\\n                 MedTerm       22.80      (2.2%)       22.67      (2.1%)   -0.6% (  -4% -    3%)\\n                  Fuzzy1       26.16      (1.9%)       26.04      (2.0%)   -0.4% (  -4% -    3%)\\n                  IntNRQ       17.94      (6.1%)       17.86      (6.2%)   -0.4% ( -11% -   12%)\\n             AndHighHigh       12.33      (1.2%)       12.29      (1.3%)   -0.4% (  -2% -    2%)\\n                  Fuzzy2       32.00      (2.8%)       31.89      (3.0%)   -0.3% (  -5% -    5%)\\n               MedPhrase       49.48      (3.9%)       49.32      (4.4%)   -0.3% (  -8% -    8%)\\n                HighTerm        8.02      (2.1%)        8.00      (2.0%)   -0.2% (  -4% -    3%)\\n                PKLookup      211.76      (1.4%)      211.32      (1.8%)   -0.2% (  -3% -    3%)\\n                Wildcard       62.37      (2.3%)       62.28      (2.3%)   -0.1% (  -4% -    4%)\\n         MedSloppyPhrase       17.49      (2.5%)       17.52      (2.7%)    0.2% (  -4% -    5%)\\n                 Respell       55.68      (5.0%)       55.85      (3.3%)    0.3% (  -7% -    9%)\\n         LowSloppyPhrase       16.29      (4.7%)       16.43      (5.2%)    0.9% (  -8% -   11%)\\n               LowPhrase       15.68      (5.3%)       15.81      (5.4%)    0.9% (  -9% -   12%)\\n              HighPhrase       14.22      (8.7%)       14.45      (8.9%)    1.6% ( -14% -   21%)\\n        HighSloppyPhrase        0.83      (9.3%)        0.85     (11.9%)    2.1% ( -17% -   25%)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558759\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558759&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558759\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558759_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558759_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 13:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T13:36:26+0000\'\u003e21\\/Jan\\/13 13:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlso, total _\u003cb\u003e_dv.\u003c\\/b\u003e file size is 445 MB for ALL_PARENTS and 351 MB for\u003cbr\\/\u003e\\nNO_PARENTS.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558759_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558759_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 13:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T13:36:26+0000\'\u003e21\\/Jan\\/13 13:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Also, total _ _dv.  file size is 445 MB for ALL_PARENTS and 351 MB for \\nNO_PARENTS.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558819\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558819&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558819\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558819_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558819_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T15:05:52+0000\'\u003e21\\/Jan\\/13 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Michael McCandless - 21\\/Jan\\/13 15:06\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebase = ALL_PARENTS, comp = NO_PARENTS:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e\\n                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n             MedSpanNear      125.77      (2.0%)       79.31      (0.8%)  -36.9% ( -38% -  -34%)\\n             LowSpanNear      124.86      (2.7%)       79.23      (0.5%)  -36.5% ( -38% -  -34%)\\n            HighSpanNear      124.23      (2.3%)       79.44      (0.8%)  -36.1% ( -38% -  -33%)\\n              AndHighLow      107.24      (1.4%)       72.70      (0.7%)  -32.2% ( -33% -  -30%)\\n               MedPhrase       55.98      (0.6%)       44.89      (1.4%)  -19.8% ( -21% -  -17%)\\n              AndHighMed       52.06      (0.7%)       43.20      (0.0%)  -17.0% ( -17% -  -16%)\\n                  Fuzzy2       35.71      (0.6%)       30.42      (1.6%)  -14.8% ( -16% -  -12%)\\n               LowPhrase       17.27      (0.3%)       15.21      (3.2%)  -11.9% ( -15% -   -8%)\\n              HighPhrase       15.20      (6.2%)       13.50      (4.7%)  -11.2% ( -20% -    0%)\\n                 LowTerm       41.68      (0.4%)       37.49      (0.4%)  -10.1% ( -10% -   -9%)\\n         LowSloppyPhrase       17.31      (2.9%)       15.75      (0.9%)   -9.0% ( -12% -   -5%)\\n                  Fuzzy1       28.11      (0.3%)       25.63      (0.0%)   -8.8% (  -9% -   -8%)\\n         MedSloppyPhrase       18.42      (1.5%)       17.25      (0.1%)   -6.3% (  -7% -   -4%)\\n                 Respell       56.32      (0.3%)       54.41      (2.2%)   -3.4% (  -5% -    0%)\\n        HighSloppyPhrase        0.83      (6.8%)        0.81      (1.0%)   -2.3% (  -9% -    5%)\\n                Wildcard       63.43      (1.9%)       61.96      (0.3%)   -2.3% (  -4% -    0%)\\n                 Prefix3       45.60      (0.5%)       45.70      (0.7%)    0.2% (  -1% -    1%)\\n                  IntNRQ       17.54      (0.6%)       17.60      (1.4%)    0.3% (  -1% -    2%)\\n                PKLookup      205.89      (0.5%)      210.73      (0.7%)    2.4% (   1% -    3%)\\n             AndHighHigh       11.89      (0.2%)       12.48      (0.3%)    5.0% (   4% -    5%)\\n                HighTerm        7.00      (0.2%)        8.09      (0.1%)   15.6% (  15% -   16%)\\n              OrHighHigh        3.77      (0.6%)        4.36      (0.3%)   15.6% (  14% -   16%)\\n               OrHighLow        6.65      (0.1%)        7.69      (1.5%)   15.6% (  14% -   17%)\\n               OrHighMed        6.61      (0.4%)        7.66      (0.2%)   15.8% (  15% -   16%)\\n                 MedTerm       18.86      (0.4%)       22.13      (0.4%)   17.3% (  16% -   18%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI think because this test has 2.5M ords ... the cost of \\\"rolling up\\\" in the end is non-trivial ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558819_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558819_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T15:05:52+0000\'\u003e21\\/Jan\\/13 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Michael McCandless - 21\\/Jan\\/13 15:06\\\"\u003eedited\u003c\\/span\u003e                   base = ALL_PARENTS, comp = NO_PARENTS: \\n  \\n \\n                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n             MedSpanNear      125.77      (2.0%)       79.31      (0.8%)  -36.9% ( -38% -  -34%)\\n             LowSpanNear      124.86      (2.7%)       79.23      (0.5%)  -36.5% ( -38% -  -34%)\\n            HighSpanNear      124.23      (2.3%)       79.44      (0.8%)  -36.1% ( -38% -  -33%)\\n              AndHighLow      107.24      (1.4%)       72.70      (0.7%)  -32.2% ( -33% -  -30%)\\n               MedPhrase       55.98      (0.6%)       44.89      (1.4%)  -19.8% ( -21% -  -17%)\\n              AndHighMed       52.06      (0.7%)       43.20      (0.0%)  -17.0% ( -17% -  -16%)\\n                  Fuzzy2       35.71      (0.6%)       30.42      (1.6%)  -14.8% ( -16% -  -12%)\\n               LowPhrase       17.27      (0.3%)       15.21      (3.2%)  -11.9% ( -15% -   -8%)\\n              HighPhrase       15.20      (6.2%)       13.50      (4.7%)  -11.2% ( -20% -    0%)\\n                 LowTerm       41.68      (0.4%)       37.49      (0.4%)  -10.1% ( -10% -   -9%)\\n         LowSloppyPhrase       17.31      (2.9%)       15.75      (0.9%)   -9.0% ( -12% -   -5%)\\n                  Fuzzy1       28.11      (0.3%)       25.63      (0.0%)   -8.8% (  -9% -   -8%)\\n         MedSloppyPhrase       18.42      (1.5%)       17.25      (0.1%)   -6.3% (  -7% -   -4%)\\n                 Respell       56.32      (0.3%)       54.41      (2.2%)   -3.4% (  -5% -    0%)\\n        HighSloppyPhrase        0.83      (6.8%)        0.81      (1.0%)   -2.3% (  -9% -    5%)\\n                Wildcard       63.43      (1.9%)       61.96      (0.3%)   -2.3% (  -4% -    0%)\\n                 Prefix3       45.60      (0.5%)       45.70      (0.7%)    0.2% (  -1% -    1%)\\n                  IntNRQ       17.54      (0.6%)       17.60      (1.4%)    0.3% (  -1% -    2%)\\n                PKLookup      205.89      (0.5%)      210.73      (0.7%)    2.4% (   1% -    3%)\\n             AndHighHigh       11.89      (0.2%)       12.48      (0.3%)    5.0% (   4% -    5%)\\n                HighTerm        7.00      (0.2%)        8.09      (0.1%)   15.6% (  15% -   16%)\\n              OrHighHigh        3.77      (0.6%)        4.36      (0.3%)   15.6% (  14% -   16%)\\n               OrHighLow        6.65      (0.1%)        7.69      (1.5%)   15.6% (  14% -   17%)\\n               OrHighMed        6.61      (0.4%)        7.66      (0.2%)   15.8% (  15% -   16%)\\n                 MedTerm       18.86      (0.4%)       22.13      (0.4%)   17.3% (  16% -   18%)\\n \\n  \\n\\n I think because this test has 2.5M ords ... the cost of \\\"rolling up\\\" in the end is non-trivial ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558838\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558838&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558838\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558838_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558838_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 15:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T15:29:43+0000\'\u003e21\\/Jan\\/13 15:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for running this. I think that given these results, making NO_PARENTS the default policy is not that good. I anyway think it\'s not a good default, because it forces the user to stop and think if the documents that he\'ll index share or not parents. This looks like an advanced setting to me, i.e. if you want to get \\\"expert\\\" and really know your content, then you can choose to index like so. Plus, given those statistics, I\'d say that you have to test before you go to production with it (i.e. looks like it may be expensive as the number of ordinals grow...).\u003c\\/p\u003e\\n\\n\u003cp\u003eMike found a bug in how I count up the parents in the NO_PARENTS case, so I fixed it (and added a test). I\'ll run tests a couple of times and commit this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558838_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558838_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 15:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T15:29:43+0000\'\u003e21\\/Jan\\/13 15:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for running this. I think that given these results, making NO_PARENTS the default policy is not that good. I anyway think it\'s not a good default, because it forces the user to stop and think if the documents that he\'ll index share or not parents. This looks like an advanced setting to me, i.e. if you want to get \\\"expert\\\" and really know your content, then you can choose to index like so. Plus, given those statistics, I\'d say that you have to test before you go to production with it (i.e. looks like it may be expensive as the number of ordinals grow...). \\n\\n Mike found a bug in how I count up the parents in the NO_PARENTS case, so I fixed it (and added a test). I\'ll run tests a couple of times and commit this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558853\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558853&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558853\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558853_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558853_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 15:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T15:51:39+0000\'\u003e21\\/Jan\\/13 15:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe performance depends heavily on how many ords your taxo index has ... my last test was ~2.5M ords, but when I build an index leaving out the two dimensions (categories, username) with the most ords, leaving 4703 unique ords, the numbers are much better:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                 Prefix3      161.48      (6.1%)      161.99      (7.4%)    0.3% ( -12% -   14%)\\n                PKLookup      235.50      (2.4%)      236.41      (2.1%)    0.4% (  -4% -    5%)\\n                 Respell       85.41      (4.4%)       85.92      (4.2%)    0.6% (  -7% -    9%)\\n              AndHighLow     1196.56      (2.1%)     1204.67      (3.4%)    0.7% (  -4% -    6%)\\n                  IntNRQ      104.88      (6.7%)      105.77      (9.0%)    0.9% ( -13% -   17%)\\n                Wildcard      215.17      (2.2%)      217.13      (2.6%)    0.9% (  -3% -    5%)\\n        HighSloppyPhrase        3.24      (8.2%)        3.27      (9.2%)    1.0% ( -15% -   19%)\\n             LowSpanNear       42.80      (3.0%)       43.68      (2.8%)    2.1% (  -3% -    8%)\\n                  Fuzzy2       84.83      (3.6%)       86.70      (2.8%)    2.2% (  -4% -    8%)\\n            HighSpanNear       11.42      (1.9%)       11.70      (2.3%)    2.4% (  -1% -    6%)\\n               LowPhrase       71.69      (6.8%)       73.91      (6.2%)    3.1% (  -9% -   17%)\\n                  Fuzzy1       75.53      (3.4%)       78.81      (2.7%)    4.3% (  -1% -   10%)\\n              HighPhrase       42.58     (11.4%)       44.61     (11.5%)    4.8% ( -16% -   31%)\\n         LowSloppyPhrase       80.22      (2.3%)       84.49      (3.1%)    5.3% (   0% -   10%)\\n             MedSpanNear       85.37      (1.9%)       91.16      (1.8%)    6.8% (   3% -   10%)\\n         MedSloppyPhrase       86.55      (2.7%)       92.84      (3.2%)    7.3% (   1% -   13%)\\n               MedPhrase      145.23      (5.6%)      156.11      (6.1%)    7.5% (  -3% -   20%)\\n              AndHighMed      321.74      (1.2%)      346.20      (1.5%)    7.6% (   4% -   10%)\\n             AndHighHigh       84.28      (1.6%)       96.80      (1.7%)   14.9% (  11% -   18%)\\n              OrHighHigh       35.03      (2.9%)       42.53      (4.6%)   21.4% (  13% -   29%)\\n               OrHighMed       51.75      (3.0%)       63.90      (4.6%)   23.5% (  15% -   32%)\\n               OrHighLow       50.41      (3.0%)       62.51      (4.7%)   24.0% (  15% -   32%)\\n                HighTerm       58.55      (3.0%)       74.59      (4.2%)   27.4% (  19% -   35%)\\n                 LowTerm      355.14      (1.6%)      480.44      (2.3%)   35.3% (  30% -   39%)\\n                 MedTerm      206.44      (2.0%)      286.54      (3.1%)   38.8% (  33% -   44%)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI also separately fixed a silly bug in luceneutil which was causing the \u003cb\u003eSpan\u003c\\/b\u003e queries to get 0 hits.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13558853_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558853_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 15:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T15:51:39+0000\'\u003e21\\/Jan\\/13 15:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The performance depends heavily on how many ords your taxo index has ... my last test was ~2.5M ords, but when I build an index leaving out the two dimensions (categories, username) with the most ords, leaving 4703 unique ords, the numbers are much better: \\n\\n  \\n                     Task    QPS base      StdDev    QPS comp      StdDev                Pct diff\\n                 Prefix3      161.48      (6.1%)      161.99      (7.4%)    0.3% ( -12% -   14%)\\n                PKLookup      235.50      (2.4%)      236.41      (2.1%)    0.4% (  -4% -    5%)\\n                 Respell       85.41      (4.4%)       85.92      (4.2%)    0.6% (  -7% -    9%)\\n              AndHighLow     1196.56      (2.1%)     1204.67      (3.4%)    0.7% (  -4% -    6%)\\n                  IntNRQ      104.88      (6.7%)      105.77      (9.0%)    0.9% ( -13% -   17%)\\n                Wildcard      215.17      (2.2%)      217.13      (2.6%)    0.9% (  -3% -    5%)\\n        HighSloppyPhrase        3.24      (8.2%)        3.27      (9.2%)    1.0% ( -15% -   19%)\\n             LowSpanNear       42.80      (3.0%)       43.68      (2.8%)    2.1% (  -3% -    8%)\\n                  Fuzzy2       84.83      (3.6%)       86.70      (2.8%)    2.2% (  -4% -    8%)\\n            HighSpanNear       11.42      (1.9%)       11.70      (2.3%)    2.4% (  -1% -    6%)\\n               LowPhrase       71.69      (6.8%)       73.91      (6.2%)    3.1% (  -9% -   17%)\\n                  Fuzzy1       75.53      (3.4%)       78.81      (2.7%)    4.3% (  -1% -   10%)\\n              HighPhrase       42.58     (11.4%)       44.61     (11.5%)    4.8% ( -16% -   31%)\\n         LowSloppyPhrase       80.22      (2.3%)       84.49      (3.1%)    5.3% (   0% -   10%)\\n             MedSpanNear       85.37      (1.9%)       91.16      (1.8%)    6.8% (   3% -   10%)\\n         MedSloppyPhrase       86.55      (2.7%)       92.84      (3.2%)    7.3% (   1% -   13%)\\n               MedPhrase      145.23      (5.6%)      156.11      (6.1%)    7.5% (  -3% -   20%)\\n              AndHighMed      321.74      (1.2%)      346.20      (1.5%)    7.6% (   4% -   10%)\\n             AndHighHigh       84.28      (1.6%)       96.80      (1.7%)   14.9% (  11% -   18%)\\n              OrHighHigh       35.03      (2.9%)       42.53      (4.6%)   21.4% (  13% -   29%)\\n               OrHighMed       51.75      (3.0%)       63.90      (4.6%)   23.5% (  15% -   32%)\\n               OrHighLow       50.41      (3.0%)       62.51      (4.7%)   24.0% (  15% -   32%)\\n                HighTerm       58.55      (3.0%)       74.59      (4.2%)   27.4% (  19% -   35%)\\n                 LowTerm      355.14      (1.6%)      480.44      (2.3%)   35.3% (  30% -   39%)\\n                 MedTerm      206.44      (2.0%)      286.54      (3.1%)   38.8% (  33% -   44%)\\n \\n  \\n\\n I also separately fixed a silly bug in luceneutil which was causing the  Span  queries to get 0 hits.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558866\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558866&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558866\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13558866_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558866_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 16:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T16:08:24+0000\'\u003e21\\/Jan\\/13 16:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;trunk commit&#93;\u003c\\/span\u003e Shai Erera\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1436435\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1436435\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4600\\\" title=\\\"Explore facets aggregation during documents collection\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4600\\\"\u003e\u003cdel\u003eLUCENE-4600\u003c\\/del\u003e\u003c\\/a\u003e: add CountingFacetsCollector\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13558866_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558866_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 16:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T16:08:24+0000\'\u003e21\\/Jan\\/13 16:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;trunk commit&#93;  Shai Erera \\n http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1436435  \\n\\n   LUCENE-4600  : add CountingFacetsCollector              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558876\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558876&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558876\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13558876_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558876_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 16:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T16:18:12+0000\'\u003e21\\/Jan\\/13 16:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;branch_4x commit&#93;\u003c\\/span\u003e Shai Erera\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1436446\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1436446\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4600\\\" title=\\\"Explore facets aggregation during documents collection\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4600\\\"\u003e\u003cdel\u003eLUCENE-4600\u003c\\/del\u003e\u003c\\/a\u003e: add CountingFacetsCollector\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"commit-tag-bot\\\" id=\\\"commentauthor_13558876_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=commit-tag-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"commit-tag-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Commit Tag Bot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558876_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 16:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T16:18:12+0000\'\u003e21\\/Jan\\/13 16:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;branch_4x commit&#93;  Shai Erera \\n http:\\/\\/svn.apache.org\\/viewvc?view=revision&amp;revision=1436446  \\n\\n   LUCENE-4600  : add CountingFacetsCollector              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13558880\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13558880&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13558880\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558880_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558880_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 16:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T16:22:28+0000\'\u003e21\\/Jan\\/13 16:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted to trunk and 4x. Let\'s see if it makes nightly happy! \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_13558880_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13558880_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/13 16:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-21T16:22:28+0000\'\u003e21\\/Jan\\/13 16:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed to trunk and 4x. Let\'s see if it makes nightly happy!                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13653795\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4600?focusedCommentId=13653795&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13653795\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13653795_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13653795_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/13 10:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-05-10T10:33:00+0000\'\u003e10\\/May\\/13 10:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eClosed after release.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13653795_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13653795_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/13 10:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-05-10T10:33:00+0000\'\u003e10\\/May\\/13 10:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Closed after release.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516204443475"> 
    <input type="hidden" title="jira.request.server.time" value="6095"> 
    <input type="hidden" title="jira.request.id" value="954x7758394x6"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="32"> 
    <input type="hidden" title="db.reads.time.in.ms" value="80"> 
    <input type="hidden" title="db.conns.time.in.ms" value="100"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 954x7758394x6
	          REQUEST TIMESTAMP : [17/Jan/2018:15:54:03 +0000]
	               REQUEST TIME : 6.0950
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 32

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=26, elapsedTotal=80077942, elapsedMin=578146, elapsedMax=45942932, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=30, elapsedTotal=100040802, elapsedMin=596832, elapsedMax=46001833, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>