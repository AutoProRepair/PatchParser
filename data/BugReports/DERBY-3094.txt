<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|a29ee0b6c08dd4d0e408d131f21decfa40bfc94e|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"26ec34612501b0\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-3094"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-3094] Grouping of expressions causes NullPointerException - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-3094] Grouping of expressions causes NullPointerException - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-3094">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-3094" href="/jira/browse/DERBY-3094" id="key-val" rel="12379465">DERBY-3094</a></li>
                </ol>
                <h1 id="summary-val">Grouping of expressions causes NullPointerException</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-3094"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-3094/DERBY-3094.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-3094/DERBY-3094.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-3094/DERBY-3094.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-3094/DERBY-3094.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/critical.svg" title="Critical - Crashes, loss of data, severe memory leak." width="16"> Critical </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.3.1.4 ">10.3.1.4</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.3.3.0" title="10.3.3.0 ">10.3.3.0</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.4.1.3" title="10.4.1.3 ">10.4.1.3</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+SQL" title="SQL ">SQL</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12379465-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     Windows XP, Eclipse 3.2.2, java 1.5.0.11 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Following steps to reproduce the bug:</p> 
                  <p>create table xx (a double, b double);<br> insert into xx values (2, 3);</p> 
                  <p>select a, a*(b/100.000000), count<img class="emoticon" src="/jira/images/icons/emoticons/star_yellow.png" height="16" width="16" align="absmiddle" alt="" border="0"> from xx group by a, a*(b/100.000000);</p> 
                  <p>Starting run</p> 
                  <p>select a, a*(b/100.000000), count<img class="emoticon" src="/jira/images/icons/emoticons/star_yellow.png" height="16" width="16" align="absmiddle" alt="" border="0"> from xx <br> group by a, a*(b/100.000000)</p> 
                  <p>Run successful</p> 
                  <p>SQL State = 38000 SQL Code = 20000 SQL Message = Bei der Auswertung eines Ausdrucks wurde die Ausnahme 'java.lang.NullPointerException' ausgelöst. Exception message = java.sql.SQLException: Bei der Auswertung eines Ausdrucks wurde die Ausnahme 'java.lang.NullPointerException' ausgelöst.</p> 
                  <p>Work around:</p> 
                  <p>select a, a*(b/100.000000), count<img class="emoticon" src="/jira/images/icons/emoticons/star_yellow.png" height="16" width="16" align="absmiddle" alt="" border="0"> from xx group by a, b, a*(b/100.000000) </p> 
                  <p>Stack trace from application:</p> 
                  <p>java.sql.SQLException: Bei der Auswertung eines Ausdrucks wurde die Ausnahme 'java.lang.NullPointerException' ausgelöst.<br> at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)<br> at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)<br> at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source)<br> at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)<br> at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)<br> at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)<br> at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)<br> at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(Unknown Source)<br> at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(Unknown Source)<br> at org.apache.derby.impl.jdbc.EmbedResultSet.next(Unknown Source)<br> at de.arcor.billy.report.views.designer.ReportViewerView.setInput(ReportViewerView.java:255)<br> at de.arcor.billy.report.views.designer.ReportViewerView.createPartControl(ReportViewerView.java:113)<br> at org.eclipse.ui.internal.ViewReference.createPartHelper(ViewReference.java:332)<br> at org.eclipse.ui.internal.ViewReference.createPart(ViewReference.java:197)<br> at org.eclipse.ui.internal.WorkbenchPartReference.getPart(WorkbenchPartReference.java:566)<br> at org.eclipse.ui.internal.Perspective.showView(Perspective.java:1675)<br> at org.eclipse.ui.internal.WorkbenchPage.busyShowView(WorkbenchPage.java:987)<br> at org.eclipse.ui.internal.WorkbenchPage.access$13(WorkbenchPage.java:968)<br> at org.eclipse.ui.internal.WorkbenchPage$13.run(WorkbenchPage.java:3514)<br> at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)<br> at org.eclipse.ui.internal.WorkbenchPage.showView(WorkbenchPage.java:3511)<br> at de.arcor.billy.report.data.ReportDataAdvisor$2.perspectiveChanged(ReportDataAdvisor.java:268)<br> at de.arcor.billy.system.actions.AbstractOpenPerspectiveActionDelegate$1.run(AbstractOpenPerspectiveActionDelegate.java:66)<br> at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)<br> at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123)<br> at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3325)<br> at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2971)<br> at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1930)<br> at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1894)<br> at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:422)<br> at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)<br> at de.arcor.billy.product.Billy.run(Billy.java:15)<br> at org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)<br> at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)<br> at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)<br> at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)<br> at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)<br> at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br> at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)<br> at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)<br> at java.lang.reflect.Method.invoke(Unknown Source)<br> at org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)<br> at org.eclipse.core.launcher.Main.basicRun(Main.java:280)<br> at org.eclipse.core.launcher.Main.run(Main.java:977)<br> at org.eclipse.core.launcher.Main.main(Main.java:952)<br> Caused by: java.sql.SQLException: Java-Ausnahme: ': java.lang.NullPointerException'.<br> at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)<br> at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)<br> at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)<br> at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)<br> ... 42 more<br> Caused by: java.lang.NullPointerException<br> at org.apache.derby.exe.ac9b638174x0115x5f93x1332x0000046fd8a01b.e10(Unknown Source)<br> at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br> at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)<br> at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)<br> at java.lang.reflect.Method.invoke(Unknown Source)<br> at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source)<br> at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.doProjection(Unknown Source)<br> at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(Unknown Source)<br> at org.apache.derby.impl.sql.execute.ScrollInsensitiveResultSet.getNextRowFromSource(Unknown Source)<br> at org.apache.derby.impl.sql.execute.ScrollInsensitiveResultSet.getNextRowCore(Unknown Source)<br> at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(Unknown Source)<br> ... 37 more</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-3094?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-3094?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-3094?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-3094?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12376250" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12376250/d3094_followup.htm" draggable="true" data-downloadurl="text/html:d3094_followup.htm:https://issues.apache.org/jira/secure/attachment/12376250/d3094_followup.htm"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="HTML File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12376250/d3094_followup.htm" title="Latest  22/Feb/08 18:33 - A B" draggable="true" data-downloadurl="text/html:d3094_followup.htm:https://issues.apache.org/jira/secure/attachment/12376250/d3094_followup.htm">d3094_followup.htm</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-22T18:33:31.454Z">22/Feb/08 18:33</time>
                   </dd>
                   <dd class="attachment-size">
                    43 kB
                   </dd>
                   <dd class="attachment-author">
                    A B
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12375303" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12375303/modifyVisitorDoesntWork.diff" draggable="true" data-downloadurl="text/x-patch:modifyVisitorDoesntWork.diff:https://issues.apache.org/jira/secure/attachment/12375303/modifyVisitorDoesntWork.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12375303/modifyVisitorDoesntWork.diff" title="Latest  12/Feb/08 03:33 - Bryan Pendleton" draggable="true" data-downloadurl="text/x-patch:modifyVisitorDoesntWork.diff:https://issues.apache.org/jira/secure/attachment/12375303/modifyVisitorDoesntWork.diff">modifyVisitorDoesntWork.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-12T03:33:53.378Z">12/Feb/08 03:33</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12376236" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12376236/notes.html" draggable="true" data-downloadurl="text/html:notes.html:https://issues.apache.org/jira/secure/attachment/12376236/notes.html"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="HTML File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12376236/notes.html" title="Latest  22/Feb/08 15:39 - Bryan Pendleton" draggable="true" data-downloadurl="text/html:notes.html:https://issues.apache.org/jira/secure/attachment/12376236/notes.html">notes.html</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-22T15:39:58.255Z">22/Feb/08 15:39</time>
                   </dd>
                   <dd class="attachment-size">
                    20 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12376592" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12376592/sortExpressions.diff" draggable="true" data-downloadurl="text/x-patch:sortExpressions.diff:https://issues.apache.org/jira/secure/attachment/12376592/sortExpressions.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12376592/sortExpressions.diff" title="Latest  27/Feb/08 03:33 - Bryan Pendleton" draggable="true" data-downloadurl="text/x-patch:sortExpressions.diff:https://issues.apache.org/jira/secure/attachment/12376592/sortExpressions.diff">sortExpressions.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-27T03:33:14.578Z">27/Feb/08 03:33</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12376790" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12376790/sortExpressionsFinal.diff" draggable="true" data-downloadurl="text/x-patch:sortExpressionsFinal.diff:https://issues.apache.org/jira/secure/attachment/12376790/sortExpressionsFinal.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12376790/sortExpressionsFinal.diff" title="Latest  29/Feb/08 04:22 - Bryan Pendleton" draggable="true" data-downloadurl="text/x-patch:sortExpressionsFinal.diff:https://issues.apache.org/jira/secure/attachment/12376790/sortExpressionsFinal.diff">sortExpressionsFinal.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-29T04:22:32.452Z">29/Feb/08 04:22</time>
                   </dd>
                   <dd class="attachment-size">
                    11 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12375866" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12375866/twoPass.diff" draggable="true" data-downloadurl="text/x-patch:twoPass.diff:https://issues.apache.org/jira/secure/attachment/12375866/twoPass.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12375866/twoPass.diff" title="Latest  18/Feb/08 22:59 - Bryan Pendleton" draggable="true" data-downloadurl="text/x-patch:twoPass.diff:https://issues.apache.org/jira/secure/attachment/12375866/twoPass.diff">twoPass.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-18T22:59:45.480Z">18/Feb/08 22:59</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12376050" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12376050/TwoPassForHavingClauseAlso.diff" draggable="true" data-downloadurl="application/octet-stream:TwoPassForHavingClauseAlso.diff:https://issues.apache.org/jira/secure/attachment/12376050/TwoPassForHavingClauseAlso.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12376050/TwoPassForHavingClauseAlso.diff" title="Latest  20/Feb/08 20:19 - Bryan Pendleton" draggable="true" data-downloadurl="application/octet-stream:TwoPassForHavingClauseAlso.diff:https://issues.apache.org/jira/secure/attachment/12376050/TwoPassForHavingClauseAlso.diff">TwoPassForHavingClauseAlso.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-20T20:19:06.667Z">20/Feb/08 20:19</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12375954" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12375954/TwoPassVisitor.diff" draggable="true" data-downloadurl="application/octet-stream:TwoPassVisitor.diff:https://issues.apache.org/jira/secure/attachment/12375954/TwoPassVisitor.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12375954/TwoPassVisitor.diff" title="Latest  19/Feb/08 18:31 - Bryan Pendleton" draggable="true" data-downloadurl="application/octet-stream:TwoPassVisitor.diff:https://issues.apache.org/jira/secure/attachment/12375954/TwoPassVisitor.diff">TwoPassVisitor.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-19T18:31:51.605Z">19/Feb/08 18:31</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12375996" data-issue-id="12379465" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12375996/TwoPassVisitorWithCommentsAndTests.diff" draggable="true" data-downloadurl="text/x-patch:TwoPassVisitorWithCommentsAndTests.diff:https://issues.apache.org/jira/secure/attachment/12375996/TwoPassVisitorWithCommentsAndTests.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12375996/TwoPassVisitorWithCommentsAndTests.diff" title="Latest  20/Feb/08 05:18 - Bryan Pendleton" draggable="true" data-downloadurl="text/x-patch:TwoPassVisitorWithCommentsAndTests.diff:https://issues.apache.org/jira/secure/attachment/12375996/TwoPassVisitorWithCommentsAndTests.diff">TwoPassVisitorWithCommentsAndTests.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2008-02-20T05:18:28.950Z">20/Feb/08 05:18</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="blocks">
                   blocks
                  </dt> 
                  <dd id="internal-12365064_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-2457: Use of column aliases in group by / having clauses can cause queries to fail"> <a href="/jira/browse/DERBY-2457" data-issue-key="DERBY-2457" class="issue-link link-title resolution">DERBY-2457</a> <span class="link-summary">Use of column aliases in group by / having clauses can cause queries to fail</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12328186_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-883: Enhance GROUP BY clause to support expressions instead of just column references."> <a href="/jira/browse/DERBY-883" data-issue-key="DERBY-883" class="issue-link link-title resolution">DERBY-883</a> <span class="link-summary">Enhance GROUP BY clause to support expressions instead of just column references.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12347089_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-1624: use of direct column name rather than alias make aggregation fail (Hibernate depends on that)"> <a href="/jira/browse/DERBY-1624" data-issue-key="DERBY-1624" class="issue-link link-title resolution">DERBY-1624</a> <span class="link-summary">use of direct column name rather than alias make aggregation fail (Hibernate depends on that)</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12379534_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-3097: Unnecessary if statement can be removed from BaseActivation.getColumnFromNow"> <a href="/jira/browse/DERBY-3097" data-issue-key="DERBY-3097" class="issue-link link-title resolution">DERBY-3097</a> <span class="link-summary">Unnecessary if statement can be removed from BaseActivation.getColumnFromNow</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_bryanpendleton" rel="bryanpendleton" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Bryan Pendleton&quot;,&quot;emailAddress&quot;:&quot;bpendleton.derby@gmail.com&quot;,&quot;username&quot;:&quot;bryanpendleton&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="bryanpendleton"></span></span> Bryan Pendleton </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_peterb" rel="peterb" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Peter Balon&quot;,&quot;emailAddress&quot;:&quot;balonp@googlemail.com&quot;,&quot;username&quot;:&quot;peterb&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="peterb"></span></span> Peter Balon </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="02/Oct/07 08:12"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-10-02T08:12:35+0000">02/Oct/07 08:12</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="21/Jan/11 17:50"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-01-21T17:50:53+0000">21/Jan/11 17:50</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="02/Mar/08 16:16"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2008-03-02T16:16:35+0000">02/Mar/08 16:16</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-3094?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-3094?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12531805\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12531805&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12531805\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12531805_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12531805_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Oct\\/07 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-02T14:11:20+0000\'\u003e02\\/Oct\\/07 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePossibly the same as \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2352\\\" title=\\\"Assertion Failure with order by and group by expression\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2352\\\"\u003e\u003cdel\u003eDERBY-2352\u003c\\/del\u003e\u003c\\/a\u003e, which may have a different error message\u003cbr\\/\u003e\\nbecause it\'s in a SANE build and this one is in an INSANE build.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12531805_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12531805_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Oct\\/07 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-10-02T14:11:20+0000\'\u003e02\\/Oct\\/07 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Possibly the same as   DERBY-2352  , which may have a different error message \\nbecause it\'s in a SANE build and this one is in an INSANE build.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12543876\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12543876&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12543876\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12543876_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543876_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 11:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T11:52:47+0000\'\u003e20\\/Nov\\/07 11:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI reproduced this in my sandbox even with the ready-to-commit patch for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2352\\\" title=\\\"Assertion Failure with order by and group by expression\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2352\\\"\u003e\u003cdel\u003eDERBY-2352\u003c\\/del\u003e\u003c\\/a\u003e applied, so it\'s not a dup of 2352.\u003c\\/p\u003e\\n\\n\u003cp\u003eGood news is it throws the NPE with both sane and insane builds, and here\'s the callstack with line numbers\u003cbr\\/\u003e\\n&#8212;\u003cbr\\/\u003e\\n2007-11-20 11:43:05.545 GMT Thread\u003cspan class=\\\"error\\\"\u003e&#91;main,5,main&#93;\u003c\\/span\u003e (XID = 173), (SESSIONID = 0), (DATABASE = d3094), (DRDAID = null), Failed Statement is: select a, a*(b\\/100.000000), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a, a*(b\\/100.000000)\u003cbr\\/\u003e\\nERROR 38000: The exception \'java.lang.NullPointerException\' was thrown while evaluating an expression.\u003cbr\\/\u003e\\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:294)\u003cbr\\/\u003e\\n        at org.apache.derby.iapi.error.StandardException.unexpectedUserException(StandardException.java:554)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:164)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.doProjection(ProjectRestrictResultSet.java:488)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:291)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:463)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:424)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:368)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:382)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:338)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:241)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:229)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:435)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:509)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:350)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:73)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.ij.main(ij.java:59)\u003cbr\\/\u003e\\nCaused by: java.lang.NullPointerException\u003cbr\\/\u003e\\n        at org.apache.derby.exe.ac601a400fx0116x5cddx8367x000000107e400.e3(Unknown Source)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:145)\u003cbr\\/\u003e\\n        ... 17 more\u003cbr\\/\u003e\\n============= begin nested exception, level (1) ===========\u003cbr\\/\u003e\\njava.lang.NullPointerException\u003cbr\\/\u003e\\n        at org.apache.derby.exe.ac601a400fx0116x5cddx8367x000000107e400.e3(Unknown Source)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:145)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.doProjection(ProjectRestrictResultSet.java:488)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:291)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:463)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:424)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:368)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:382)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:338)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:241)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:229)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:435)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:509)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:350)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:73)\u003cbr\\/\u003e\\n        at org.apache.derby.tools.ij.main(ij.java:59)\u003cbr\\/\u003e\\n&#8211;\u003c\\/p\u003e\\n\\n\u003cp\u003eProjectRestrictResultSet seems to consider the obvious case where projection == null, but it still fails\u003cbr\\/\u003e\\n   \\/\\/ Use reflection to do as much of projection as required\u003cbr\\/\u003e\\n   if (projection != null)\u003c\\/p\u003e\\n   {\\n      result = (ExecRow) projection.invoke(activation);          &lt;== ln 488\\n   }\\n\u003cp\u003e   else\u003c\\/p\u003e\\n   {\\n      result = mappedResultRow;\\n   } \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12543876_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543876_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 11:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T11:52:47+0000\'\u003e20\\/Nov\\/07 11:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I reproduced this in my sandbox even with the ready-to-commit patch for   DERBY-2352   applied, so it\'s not a dup of 2352. \\n\\n Good news is it throws the NPE with both sane and insane builds, and here\'s the callstack with line numbers \\n&#8212; \\n2007-11-20 11:43:05.545 GMT Thread &#91;main,5,main&#93;  (XID = 173), (SESSIONID = 0), (DATABASE = d3094), (DRDAID = null), Failed Statement is: select a, a*(b\\/100.000000), count  from xx group by a, a*(b\\/100.000000) \\nERROR 38000: The exception \'java.lang.NullPointerException\' was thrown while evaluating an expression. \\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:294) \\n        at org.apache.derby.iapi.error.StandardException.unexpectedUserException(StandardException.java:554) \\n        at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:164) \\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.doProjection(ProjectRestrictResultSet.java:488) \\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:291) \\n        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:463) \\n        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:424) \\n        at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:368) \\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:382) \\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:338) \\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:241) \\n        at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:229) \\n        at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:435) \\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:509) \\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:350) \\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248) \\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:215) \\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181) \\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:73) \\n        at org.apache.derby.tools.ij.main(ij.java:59) \\nCaused by: java.lang.NullPointerException \\n        at org.apache.derby.exe.ac601a400fx0116x5cddx8367x000000107e400.e3(Unknown Source) \\n        at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:145) \\n        ... 17 more \\n============= begin nested exception, level (1) =========== \\njava.lang.NullPointerException \\n        at org.apache.derby.exe.ac601a400fx0116x5cddx8367x000000107e400.e3(Unknown Source) \\n        at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:145) \\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.doProjection(ProjectRestrictResultSet.java:488) \\n        at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:291) \\n        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:463) \\n        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:424) \\n        at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:368) \\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:382) \\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:338) \\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:241) \\n        at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:229) \\n        at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:435) \\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:509) \\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:350) \\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248) \\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:215) \\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181) \\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:73) \\n        at org.apache.derby.tools.ij.main(ij.java:59) \\n&#8211; \\n\\n ProjectRestrictResultSet seems to consider the obvious case where projection == null, but it still fails \\n   \\/\\/ Use reflection to do as much of projection as required \\n   if (projection != null) \\n   {\\n      result = (ExecRow) projection.invoke(activation);          &lt;== ln 488\\n   }\\n    else \\n   {\\n      result = mappedResultRow;\\n   }             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12543878\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12543878&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12543878\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12543878_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543878_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 12:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T12:19:52+0000\'\u003e20\\/Nov\\/07 12:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDropping the count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e in the debugger actually works:\u003c\\/p\u003e\\n\\n\u003cp\u003eij&gt; select a, a*(b\\/100.000000) from xx group by a, a*(b\\/100.000000);\u003cbr\\/\u003e\\nA                     |2                     \u003cbr\\/\u003e\\n---------------------------------------------\u003cbr\\/\u003e\\n2.0                   |0.06                  \u003c\\/p\u003e\\n\\n\u003cp\u003e1 row selected\u003c\\/p\u003e\\n\\n\u003cp\u003eI traced through the ProjectRestrictResultSet code and its source GroupedAggregateResultSet, but could not immediately see where the NPE originated.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12543878_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543878_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 12:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T12:19:52+0000\'\u003e20\\/Nov\\/07 12:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Dropping the count  in the debugger actually works: \\n\\n ij&gt; select a, a*(b\\/100.000000) from xx group by a, a*(b\\/100.000000); \\nA                     |2                      \\n--------------------------------------------- \\n2.0                   |0.06                   \\n\\n 1 row selected \\n\\n I traced through the ProjectRestrictResultSet code and its source GroupedAggregateResultSet, but could not immediately see where the NPE originated.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12543886\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12543886&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12543886\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12543886_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543886_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 12:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T12:55:30+0000\'\u003e20\\/Nov\\/07 12:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI wasn\'t really going to hunt this one down, but tracing a little further I see BaseActivation.getColumnFromRow() returns null @ 1359 with a comment that \\\"this happens\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003e if( row\u003cspan class=\\\"error\\\"\u003e&#91;rsNumber&#93;\u003c\\/span\u003e == null)\u003c\\/p\u003e\\n        {\\n            \\/* This actually happens. NoPutResultSetImpl.clearOrderableCache attempts to prefetch invariant values\\n             * into a cache. This fails in some deeply nested joins. See Beetle 4736 and 4880.\\n             *\\/\\n            return null;     &lt;==ln 1359\\n        }\\n\\n\u003cp\u003eThis in turn makes BaseActivation.getDataValueFactory() return null, and in the end DataValueFactoryImpl.getDecimalDataValue(NumberValue) returning null. And the NPE surfaces.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12543886_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543886_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 12:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T12:55:30+0000\'\u003e20\\/Nov\\/07 12:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I wasn\'t really going to hunt this one down, but tracing a little further I see BaseActivation.getColumnFromRow() returns null @ 1359 with a comment that \\\"this happens\\\". \\n\\n  if( row &#91;rsNumber&#93;  == null) \\n        {\\n            \\/* This actually happens. NoPutResultSetImpl.clearOrderableCache attempts to prefetch invariant values\\n             * into a cache. This fails in some deeply nested joins. See Beetle 4736 and 4880.\\n             *\\/\\n            return null;     &lt;==ln 1359\\n        }\\n\\n This in turn makes BaseActivation.getDataValueFactory() return null, and in the end DataValueFactoryImpl.getDecimalDataValue(NumberValue) returning null. And the NPE surfaces. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12543963\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12543963&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12543963\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12543963_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543963_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T17:42:15+0000\'\u003e20\\/Nov\\/07 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Thomas, thanks for investigating this. Your analysis is very interesting. You might\u003cbr\\/\u003e\\nwant to have a look at \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3097\\\" title=\\\"Unnecessary if statement can be removed from BaseActivation.getColumnFromNow\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3097\\\"\u003e\u003cdel\u003eDERBY-3097\u003c\\/del\u003e\u003c\\/a\u003e, which refers to precisely the \\\"if\\\" statement that\u003cbr\\/\u003e\\nyou are studying.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12543963_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12543963_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/07 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-20T17:42:15+0000\'\u003e20\\/Nov\\/07 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Thomas, thanks for investigating this. Your analysis is very interesting. You might \\nwant to have a look at   DERBY-3097  , which refers to precisely the \\\"if\\\" statement that \\nyou are studying.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544188\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12544188&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544188\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12544188_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544188_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/07 08:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-21T08:10:01+0000\'\u003e21\\/Nov\\/07 08:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe patch for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3097\\\" title=\\\"Unnecessary if statement can be removed from BaseActivation.getColumnFromNow\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3097\\\"\u003e\u003cdel\u003eDERBY-3097\u003c\\/del\u003e\u003c\\/a\u003e removes the if() handling row\u003cspan class=\\\"error\\\"\u003e&#91;rsNumber&#93;\u003c\\/span\u003e == null.\u003cbr\\/\u003e\\nNot surprisingly we run into another NPE in BaseActivation on the return line following the original if() after patching.\u003c\\/p\u003e\\n\\n\u003cp\u003e   return row\u003cspan class=\\\"error\\\"\u003e&#91;rsNumber&#93;\u003c\\/span\u003e.getColumn(colId);\u003c\\/p\u003e\\n\\n\u003cp\u003eas row\u003cspan class=\\\"error\\\"\u003e&#91;rsNumber&#93;\u003c\\/span\u003e still is null in our case.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would initially seem both \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3097\\\" title=\\\"Unnecessary if statement can be removed from BaseActivation.getColumnFromNow\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3097\\\"\u003e\u003cdel\u003eDERBY-3097\u003c\\/del\u003e\u003c\\/a\u003e and this jira have the same, or a similar, root cause? Could it be the proposed patch for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3097\\\" title=\\\"Unnecessary if statement can be removed from BaseActivation.getColumnFromNow\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3097\\\"\u003e\u003cdel\u003eDERBY-3097\u003c\\/del\u003e\u003c\\/a\u003e only remove the symptoms seen with the if(), and not the actual underlying problem?\u003c\\/p\u003e\\n\\n\u003cp\u003eIf the patch for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3097\\\" title=\\\"Unnecessary if statement can be removed from BaseActivation.getColumnFromNow\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3097\\\"\u003e\u003cdel\u003eDERBY-3097\u003c\\/del\u003e\u003c\\/a\u003e is applied (and fixes other problems), we will still see this one.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12544188_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544188_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/07 08:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-21T08:10:01+0000\'\u003e21\\/Nov\\/07 08:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The patch for   DERBY-3097   removes the if() handling row &#91;rsNumber&#93;  == null. \\nNot surprisingly we run into another NPE in BaseActivation on the return line following the original if() after patching. \\n\\n    return row &#91;rsNumber&#93; .getColumn(colId); \\n\\n as row &#91;rsNumber&#93;  still is null in our case. \\n\\n It would initially seem both   DERBY-3097   and this jira have the same, or a similar, root cause? Could it be the proposed patch for   DERBY-3097   only remove the symptoms seen with the if(), and not the actual underlying problem? \\n\\n If the patch for   DERBY-3097   is applied (and fixes other problems), we will still see this one.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544190\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12544190&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544190\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12544190_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544190_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/07 08:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-21T08:21:37+0000\'\u003e21\\/Nov\\/07 08:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt also seems that this bug only manifests itself if there is an aggregation function \u003cb\u003eand\u003c\\/b\u003e a decimal operation.\u003c\\/p\u003e\\n\\n\u003cp\u003eNo aggregation works:\u003cbr\\/\u003e\\nij&gt; select a, a*(b\\/100.000000) from xx group by a, a*(b\\/100.000000);\u003cbr\\/\u003e\\nA                     |2\u003cbr\\/\u003e\\n---------------------------------------------\u003cbr\\/\u003e\\n2.0                   |0.06\u003c\\/p\u003e\\n\\n\u003cp\u003e1 row selected\u003c\\/p\u003e\\n\\n\u003cp\u003eNo decimal operation works:\u003cbr\\/\u003e\\nij&gt; select a, b, count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a, b;\u003cbr\\/\u003e\\nA                     |B                     |3\u003cbr\\/\u003e\\n---------------------------------------------------------\u003cbr\\/\u003e\\n2.0                   |3.0                   |1\u003c\\/p\u003e\\n\\n\u003cp\u003e1 row selected\u003c\\/p\u003e\\n\\n\u003cp\u003eSeemingly independent of type of decimal operation:\u003cbr\\/\u003e\\nij&gt; select a, a\\/b  from xx group by a, a\\/b;\u003cbr\\/\u003e\\nA                     |2\u003cbr\\/\u003e\\n---------------------------------------------\u003cbr\\/\u003e\\n2.0                   |0.6666666666666666\u003c\\/p\u003e\\n\\n\u003cp\u003e1 row selected\u003c\\/p\u003e\\n\\n\u003cp\u003eBut add the aggregate \u003cb\u003eand\u003c\\/b\u003e the decimal operation, and we see the NPE.\u003cbr\\/\u003e\\nij&gt; select a, a*b, count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a, a*b;\u003cbr\\/\u003e\\nA                     |2                     |3\u003cbr\\/\u003e\\n---------------------------------------------------------\u003cbr\\/\u003e\\nERROR 38000: The exception \'java.lang.NullPointerException\' was thrown while evaluating an expression.\u003cbr\\/\u003e\\nERROR XJ001: Java exception: \': java.lang.NullPointerException\'.\u003cbr\\/\u003e\\nij&gt;\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thomanie\\\" id=\\\"commentauthor_12544190_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thomanie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thomanie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Thomas Nielsen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544190_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/07 08:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-21T08:21:37+0000\'\u003e21\\/Nov\\/07 08:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It also seems that this bug only manifests itself if there is an aggregation function  and  a decimal operation. \\n\\n No aggregation works: \\nij&gt; select a, a*(b\\/100.000000) from xx group by a, a*(b\\/100.000000); \\nA                     |2 \\n--------------------------------------------- \\n2.0                   |0.06 \\n\\n 1 row selected \\n\\n No decimal operation works: \\nij&gt; select a, b, count  from xx group by a, b; \\nA                     |B                     |3 \\n--------------------------------------------------------- \\n2.0                   |3.0                   |1 \\n\\n 1 row selected \\n\\n Seemingly independent of type of decimal operation: \\nij&gt; select a, a\\/b  from xx group by a, a\\/b; \\nA                     |2 \\n--------------------------------------------- \\n2.0                   |0.6666666666666666 \\n\\n 1 row selected \\n\\n But add the aggregate  and  the decimal operation, and we see the NPE. \\nij&gt; select a, a*b, count  from xx group by a, a*b; \\nA                     |2                     |3 \\n--------------------------------------------------------- \\nERROR 38000: The exception \'java.lang.NullPointerException\' was thrown while evaluating an expression. \\nERROR XJ001: Java exception: \': java.lang.NullPointerException\'. \\nij&gt;              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12544485\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12544485&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12544485\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12544485_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544485_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/07 14:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-21T14:53:08+0000\'\u003e21\\/Nov\\/07 14:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Thomas, thanks for studying this problem. I think you should mark the issue as assigned\u003cbr\\/\u003e\\nto you to indicate that you are actively studying it.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; row\u003cspan class=\\\"error\\\"\u003e&#91;rsNumber&#93;\u003c\\/span\u003e still is null in our case\u003c\\/p\u003e\\n\\n\u003cp\u003eSorry, Thomas, I think I wasn\'t very clear in my other comment. \u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3097\\\" title=\\\"Unnecessary if statement can be removed from BaseActivation.getColumnFromNow\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3097\\\"\u003e\u003cdel\u003eDERBY-3097\u003c\\/del\u003e\u003c\\/a\u003e is definitely not a fix for this problem;\u003cbr\\/\u003e\\nit\'s related only in the sense that it discusses the getColumnFromRow() code.\u003c\\/p\u003e\\n\\n\u003cp\u003eMy belief is that the \\\"if\\\" statement in getColumnFromRow is unnecessary and incorrect,\u003cbr\\/\u003e\\nbecause there should be no situations in which Derby ever needs to fetch a column\'s\u003cbr\\/\u003e\\nvalue from a row prior to the initialization\\/population of that row with valid values.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe various cases that I looked at before filing \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3097\\\" title=\\\"Unnecessary if statement can be removed from BaseActivation.getColumnFromNow\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3097\\\"\u003e\u003cdel\u003eDERBY-3097\u003c\\/del\u003e\u003c\\/a\u003e all involved situations in\u003cbr\\/\u003e\\nwhich, due to other problems, Derby was accessing the internal row\\/column data structures\u003cbr\\/\u003e\\nin an inconsistent manner.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor example, with this particular problem, I think that you could investigate how the\u003cbr\\/\u003e\\nResultColumn instances for the aggregate function and the arithmetic expression column\u003cbr\\/\u003e\\nare built up, and how their row and column number values are manipulated during bind\u003cbr\\/\u003e\\nprocessing.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere are some things to pay particular attention to:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhen the invalid call to getColumnFromRow is made, which actual table and column\u003cbr\\/\u003e\\n   is being dereferenced?\u003c\\/li\u003e\\n\\t\u003cli\u003ewhat does the generated \\\"e3\\\" method for your case look like? You can view this code\u003cbr\\/\u003e\\n   using the techniques described at \u003ca href=\\\"http:\\/\\/wiki.apache.org\\/db-derby\\/DumpClassFile\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/wiki.apache.org\\/db-derby\\/DumpClassFile\u003c\\/a\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12544485_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12544485_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/07 14:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-11-21T14:53:08+0000\'\u003e21\\/Nov\\/07 14:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Thomas, thanks for studying this problem. I think you should mark the issue as assigned \\nto you to indicate that you are actively studying it. \\n\\n &gt; row &#91;rsNumber&#93;  still is null in our case \\n\\n Sorry, Thomas, I think I wasn\'t very clear in my other comment.  \\n  DERBY-3097   is definitely not a fix for this problem; \\nit\'s related only in the sense that it discusses the getColumnFromRow() code. \\n\\n My belief is that the \\\"if\\\" statement in getColumnFromRow is unnecessary and incorrect, \\nbecause there should be no situations in which Derby ever needs to fetch a column\'s \\nvalue from a row prior to the initialization\\/population of that row with valid values. \\n\\n The various cases that I looked at before filing   DERBY-3097   all involved situations in \\nwhich, due to other problems, Derby was accessing the internal row\\/column data structures \\nin an inconsistent manner. \\n\\n For example, with this particular problem, I think that you could investigate how the \\nResultColumn instances for the aggregate function and the arithmetic expression column \\nare built up, and how their row and column number values are manipulated during bind \\nprocessing. \\n\\n Here are some things to pay particular attention to: \\n \\n\\t when the invalid call to getColumnFromRow is made, which actual table and column \\n   is being dereferenced? \\n\\t what does the generated \\\"e3\\\" method for your case look like? You can view this code \\n   using the techniques described at  http:\\/\\/wiki.apache.org\\/db-derby\\/DumpClassFile  \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567333\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12567333&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567333\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567333_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567333_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/08 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-09T16:55:44+0000\'\u003e09\\/Feb\\/08 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGenerated method \\\"e3\\\" is the \\\"projection\\\" method for the generated ProjectRestrictResultSet.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere is a snippet of the generated code:\u003c\\/p\u003e\\n\\n\u003cp\u003e    private ResultSet fillResultSet()\u003cbr\\/\u003e\\n        throws StandardException\u003c\\/p\u003e\\n    {\\n        getLanguageConnectionContext().getAuthorizer().authorize(this, 1);\\n        return getResultSetFactory().getScrollInsensitiveResultSet(\\n            getResultSetFactory().getProjectRestrictResultSet(\\n                getResultSetFactory().getGroupedAggregateResultSet(\\n                    getResultSetFactory().getProjectRestrictResultSet(\\n                        getResultSetFactory().getBulkTableScanResultSet(\\n                            this, 1024, 5, getMethod(\\\"e0\\\"), 2, null, -1,\\n                            null, -1, true, e1, \\\"XX\\\", null, null, false,\\n                            false, -1, -1, 7, false, 0, 16, false,\\n                            6D, 100.404D),\\n                        null, getMethod(\\\"e1\\\"), 3, null, 4, false, true,\\n                        6D, 100.404D),\\n                    false, 3, 2, getMethod(\\\"e2\\\"), 224, 1, 6D, 100.404D),\\n                null, getMethod(\\\"e3\\\"), 4, null, 1, false, true, 1D, 100.404D),\\n            this, 0, 3, getScrollable(), 1D, 100.404D);\\n    }\\n\\n\u003cp\u003eNote that getMethod(\\\"e3\\\") is the 3rd argument to getProjectRestrictResultset()\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567333_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567333_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/08 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-09T16:55:44+0000\'\u003e09\\/Feb\\/08 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Generated method \\\"e3\\\" is the \\\"projection\\\" method for the generated ProjectRestrictResultSet. \\n\\n Here is a snippet of the generated code: \\n\\n     private ResultSet fillResultSet() \\n        throws StandardException \\n    {\\n        getLanguageConnectionContext().getAuthorizer().authorize(this, 1);\\n        return getResultSetFactory().getScrollInsensitiveResultSet(\\n            getResultSetFactory().getProjectRestrictResultSet(\\n                getResultSetFactory().getGroupedAggregateResultSet(\\n                    getResultSetFactory().getProjectRestrictResultSet(\\n                        getResultSetFactory().getBulkTableScanResultSet(\\n                            this, 1024, 5, getMethod(\\\"e0\\\"), 2, null, -1,\\n                            null, -1, true, e1, \\\"XX\\\", null, null, false,\\n                            false, -1, -1, 7, false, 0, 16, false,\\n                            6D, 100.404D),\\n                        null, getMethod(\\\"e1\\\"), 3, null, 4, false, true,\\n                        6D, 100.404D),\\n                    false, 3, 2, getMethod(\\\"e2\\\"), 224, 1, 6D, 100.404D),\\n                null, getMethod(\\\"e3\\\"), 4, null, 1, false, true, 1D, 100.404D),\\n            this, 0, 3, getScrollable(), 1D, 100.404D);\\n    }\\n\\n Note that getMethod(\\\"e3\\\") is the 3rd argument to getProjectRestrictResultset()              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567336\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12567336&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567336\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567336_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567336_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/08 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-09T17:56:44+0000\'\u003e09\\/Feb\\/08 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNote that there are \u003cb\u003etwo\u003c\\/b\u003e ProjectRestrictResultSet instances in the tree:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethe inner PRN operates on the bulk table scan, and projects columns\u003cbr\\/\u003e\\n   \\\"a\\\" and \\\"b\\\" from table \\\"xx\\\" out of the table scan using projection \\\"e1\\\".\u003c\\/li\u003e\\n\\t\u003cli\u003ethen the GroupedAggregateResultSet processes the rows, and\u003cbr\\/\u003e\\n   computes the COUNT\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e into the 3rd column of the template row\u003c\\/li\u003e\\n\\t\u003cli\u003ethen the outer PRN takes the grouped results and projects columns\u003cbr\\/\u003e\\n   \\\"a\\\", \\\"(expression)\\\", and \\\"COUNT\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\\\" out of the grouped result row.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAt the instant of the crash, the outer PRN is performing that final\u003cbr\\/\u003e\\nprojection, and it is looking for a row from result set 2.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut this is wrong; it ought to be looking for a row from result set 1.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the debugger, I can see that result set 1\'s current row is correct:\u003cbr\\/\u003e\\nit has the right columns, with the right values.\u003c\\/p\u003e\\n\\n\u003cp\u003eI can also see that, \u003cb\u003elater\u003c\\/b\u003e in projection method \\\"e3\\\", there is another\u003cbr\\/\u003e\\ncall to getColumnFromRow() which passes result set number 1.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo that seems like additional evidence that the core of the problem is\u003cbr\\/\u003e\\nthat projection method \\\"e3\\\" generated invalid code which is\u003cbr\\/\u003e\\ntrying to access result set 2 when it should have been accessing\u003cbr\\/\u003e\\nresult set 1.\u003c\\/p\u003e\\n\\n\u003cp\u003eSince the column in question is column 2, which is the expression\u003cbr\\/\u003e\\na*(b\\/100.000000), I\'m wondering whether the inner PRN and the\u003cbr\\/\u003e\\nouter PRN are somehow accidentally sharing the expression\u003cbr\\/\u003e\\ninformation for this result column expression, when one of them should\u003cbr\\/\u003e\\nhave renumbered the result set for the expression to point to the\u003cbr\\/\u003e\\ndifferent result set.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis feels really familiar, like we just worked on some problems with\u003cbr\\/\u003e\\nresult set number handling and result column expressions recently;\u003cbr\\/\u003e\\nI\'ll spend a bit of time searching JIRA to see if I can refresh that memory.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567336_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567336_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/08 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-09T17:56:44+0000\'\u003e09\\/Feb\\/08 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Note that there are  two  ProjectRestrictResultSet instances in the tree: \\n \\n\\t the inner PRN operates on the bulk table scan, and projects columns \\n   \\\"a\\\" and \\\"b\\\" from table \\\"xx\\\" out of the table scan using projection \\\"e1\\\". \\n\\t then the GroupedAggregateResultSet processes the rows, and \\n   computes the COUNT  into the 3rd column of the template row \\n\\t then the outer PRN takes the grouped results and projects columns \\n   \\\"a\\\", \\\"(expression)\\\", and \\\"COUNT \\\" out of the grouped result row. \\n \\n\\n\\n At the instant of the crash, the outer PRN is performing that final \\nprojection, and it is looking for a row from result set 2. \\n\\n But this is wrong; it ought to be looking for a row from result set 1. \\n\\n In the debugger, I can see that result set 1\'s current row is correct: \\nit has the right columns, with the right values. \\n\\n I can also see that,  later  in projection method \\\"e3\\\", there is another \\ncall to getColumnFromRow() which passes result set number 1. \\n\\n So that seems like additional evidence that the core of the problem is \\nthat projection method \\\"e3\\\" generated invalid code which is \\ntrying to access result set 2 when it should have been accessing \\nresult set 1. \\n\\n Since the column in question is column 2, which is the expression \\na*(b\\/100.000000), I\'m wondering whether the inner PRN and the \\nouter PRN are somehow accidentally sharing the expression \\ninformation for this result column expression, when one of them should \\nhave renumbered the result set for the expression to point to the \\ndifferent result set. \\n\\n This feels really familiar, like we just worked on some problems with \\nresult set number handling and result column expressions recently; \\nI\'ll spend a bit of time searching JIRA to see if I can refresh that memory.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567389\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12567389&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567389\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567389_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567389_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/08 00:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-10T00:49:08+0000\'\u003e10\\/Feb\\/08 00:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAt generate time, as the code analyzes the expression a*(b\\/100.000000),\u003cbr\\/\u003e\\nfor the outer PRN, the sourceColumn\'s resultSetNumber for the\u003cbr\\/\u003e\\nColumnReference \\\"a\\\" is \'1\', while for \\\"b\\\" it is \'2\'.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo the overall expression is inconsistent; some of the column\u003cbr\\/\u003e\\nreference point to the correct result set, others do not.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis makes me wonder whether there is some code which\u003cbr\\/\u003e\\ntraverses ResultColumn expression trees, updating the resultSetNumber,\u003cbr\\/\u003e\\nthat mistakenly visits the leftOperand of the expression tree but does\u003cbr\\/\u003e\\nnot visit the rightOperand.\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"a\\\" is seen while visiting the leftOperand, but to visit \\\"b\\\" one must visit\u003cbr\\/\u003e\\nthe rightOperand.\u003c\\/p\u003e\\n\\n\u003cp\u003eI thought this was a theory worth recording.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567389_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567389_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/08 00:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-10T00:49:08+0000\'\u003e10\\/Feb\\/08 00:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    At generate time, as the code analyzes the expression a*(b\\/100.000000), \\nfor the outer PRN, the sourceColumn\'s resultSetNumber for the \\nColumnReference \\\"a\\\" is \'1\', while for \\\"b\\\" it is \'2\'. \\n\\n So the overall expression is inconsistent; some of the column \\nreference point to the correct result set, others do not. \\n\\n This makes me wonder whether there is some code which \\ntraverses ResultColumn expression trees, updating the resultSetNumber, \\nthat mistakenly visits the leftOperand of the expression tree but does \\nnot visit the rightOperand. \\n\\n \\\"a\\\" is seen while visiting the leftOperand, but to visit \\\"b\\\" one must visit \\nthe rightOperand. \\n\\n I thought this was a theory worth recording.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567393\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12567393&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567393\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567393_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567393_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/08 02:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-10T02:02:45+0000\'\u003e10\\/Feb\\/08 02:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAs Thomas noted, it\'s interesting to see the differences between what provokes\u003cbr\\/\u003e\\nthis problem, and what does not. For example, this query works fine:\u003c\\/p\u003e\\n\\n\u003cp\u003e   select a*(b\\/1.0), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a*(b\\/1.0);\u003c\\/p\u003e\\n\\n\u003cp\u003ebut this one gets the NPE:\u003c\\/p\u003e\\n\\n\u003cp\u003e   select a*(b\\/1.0), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a,a*(b\\/1.0);\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567393_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567393_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/08 02:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-10T02:02:45+0000\'\u003e10\\/Feb\\/08 02:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    As Thomas noted, it\'s interesting to see the differences between what provokes \\nthis problem, and what does not. For example, this query works fine: \\n\\n    select a*(b\\/1.0), count  from xx group by a*(b\\/1.0); \\n\\n but this one gets the NPE: \\n\\n    select a*(b\\/1.0), count  from xx group by a,a*(b\\/1.0);              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567449\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12567449&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567449\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567449_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567449_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/08 16:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-10T16:59:00+0000\'\u003e10\\/Feb\\/08 16:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve pretty much convinced myself that the problem happens during GroupByNode.init(),\u003cbr\\/\u003e\\nwhere we take the original PRNode for the core SELECT statement, and re-write\u003cbr\\/\u003e\\nthat section of the tree to insert a new GroupByNode above that PRNode, and a new\u003cbr\\/\u003e\\nPRNode above the GroupByNode, and manipulate the various ResultColumn lists\u003cbr\\/\u003e\\nin various ways.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I\'m not sure precisely what\'s going wrong:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eis ResultColumnList.cloneMe failing to process sub-expression column references?\u003c\\/li\u003e\\n\\t\u003cli\u003eare the bindResultColumnToExpression calls in addUnAggColumns supposed\u003cbr\\/\u003e\\n   to examine the sub-expressions?\u003c\\/li\u003e\\n\\t\u003cli\u003eor perhaps somewhere else entirely in GroupByNode.init?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567449_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567449_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/08 16:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-10T16:59:00+0000\'\u003e10\\/Feb\\/08 16:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve pretty much convinced myself that the problem happens during GroupByNode.init(), \\nwhere we take the original PRNode for the core SELECT statement, and re-write \\nthat section of the tree to insert a new GroupByNode above that PRNode, and a new \\nPRNode above the GroupByNode, and manipulate the various ResultColumn lists \\nin various ways. \\n\\n But I\'m not sure precisely what\'s going wrong: \\n \\n\\t is ResultColumnList.cloneMe failing to process sub-expression column references? \\n\\t are the bindResultColumnToExpression calls in addUnAggColumns supposed \\n   to examine the sub-expressions? \\n\\t or perhaps somewhere else entirely in GroupByNode.init? \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567471\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12567471&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567471\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567471_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567471_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/08 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-10T20:19:22+0000\'\u003e10\\/Feb\\/08 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, I think I\'m getting close. Note the following:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eselect a*(b\\/1.0), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a*(b\\/1.0);    &#8211; WORKS\u003c\\/li\u003e\\n\\t\u003cli\u003eselect a*(b\\/1.0), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a,a*(b\\/1.0);  &#8211; FAILS\u003c\\/li\u003e\\n\\t\u003cli\u003eselect a*(b\\/1.0), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a,b,a*(b\\/1.0);  &#8211; WORKS\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI think the problem is related to these lines in GroupByNode.java\u003cbr\\/\u003e\\n(near line 388 or so):\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\t\\tSubstituteExpressionVisitor se = \u003cbr\\/\u003e\\n\\t\\t\\t\\tnew SubstituteExpressionVisitor(\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\tgbc.getColumnExpression(),\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\tvc,\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\t\\tAggregateNode.class);\u003cbr\\/\u003e\\n\\t\\t\\tparent.getResultColumns().accept(se);\u003c\\/p\u003e\\n\\n\u003cp\u003eThis code is processing the ResultColumn instances in the\u003cbr\\/\u003e\\n\\\"parent\\\" (outer) PRNode to update their ColumnReference values.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut (I think) this code only updates the ColumnReference values\u003cbr\\/\u003e\\nfor those columns which are directly referenced as column references\u003cbr\\/\u003e\\nin the grouping list. That\'s why the references to column \\\"a\\\" in the\u003cbr\\/\u003e\\nexpression are correctly fixed up, but ther references to column \\\"b\\\"\u003cbr\\/\u003e\\nare not, because \\\"b\\\" wasn\'t directly in the group by list.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf true, this suggests a possible workaround: include all columns\u003cbr\\/\u003e\\nthat are mentioned by any expressions in the group by list\u003cbr\\/\u003e\\nredundantly, as simple column references.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll continue to study GroupByNode.addUnAggColumns, to see if I\u003cbr\\/\u003e\\ncan construct a possible alternate way to process the columns.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567471_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567471_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/08 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-10T20:19:22+0000\'\u003e10\\/Feb\\/08 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, I think I\'m getting close. Note the following: \\n \\n\\t select a*(b\\/1.0), count  from xx group by a*(b\\/1.0);    &#8211; WORKS \\n\\t select a*(b\\/1.0), count  from xx group by a,a*(b\\/1.0);  &#8211; FAILS \\n\\t select a*(b\\/1.0), count  from xx group by a,b,a*(b\\/1.0);  &#8211; WORKS \\n \\n\\n\\n I think the problem is related to these lines in GroupByNode.java \\n(near line 388 or so): \\n\\n \\t\\t\\tSubstituteExpressionVisitor se =  \\n\\t\\t\\t\\tnew SubstituteExpressionVisitor( \\n\\t\\t\\t\\t\\t\\tgbc.getColumnExpression(), \\n\\t\\t\\t\\t\\t\\tvc, \\n\\t\\t\\t\\t\\t\\tAggregateNode.class); \\n\\t\\t\\tparent.getResultColumns().accept(se); \\n\\n This code is processing the ResultColumn instances in the \\n\\\"parent\\\" (outer) PRNode to update their ColumnReference values. \\n\\n But (I think) this code only updates the ColumnReference values \\nfor those columns which are directly referenced as column references \\nin the grouping list. That\'s why the references to column \\\"a\\\" in the \\nexpression are correctly fixed up, but ther references to column \\\"b\\\" \\nare not, because \\\"b\\\" wasn\'t directly in the group by list. \\n\\n If true, this suggests a possible workaround: include all columns \\nthat are mentioned by any expressions in the group by list \\nredundantly, as simple column references. \\n\\n I\'ll continue to study GroupByNode.addUnAggColumns, to see if I \\ncan construct a possible alternate way to process the columns.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567666\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12567666&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567666\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567666_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567666_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/08 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-11T15:34:30+0000\'\u003e11\\/Feb\\/08 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eReversing the order of the items in the group by list also avoids the NPE:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eselect a*(b\\/1.0), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a*(b\\/1.0), a; &#8211; WORKS\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThis possibly provides a simpler workaround.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567666_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567666_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/08 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-11T15:34:30+0000\'\u003e11\\/Feb\\/08 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Reversing the order of the items in the group by list also avoids the NPE: \\n\\n \\n\\t select a*(b\\/1.0), count  from xx group by a*(b\\/1.0), a; &#8211; WORKS \\n \\n\\n\\n This possibly provides a simpler workaround.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12567939\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12567939&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12567939\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567939_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567939_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Feb\\/08 03:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-12T03:33:53+0000\'\u003e12\\/Feb\\/08 03:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy first attempt to fix this was a failure.\u003c\\/p\u003e\\n\\n\u003cp\u003eI made the repro script pass, but broke various other\u003cbr\\/\u003e\\nGROUP BY constructions.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m attaching the diff anyway (modifyVisitorDoesntWork.diff),\u003cbr\\/\u003e\\nbecause I feel like it\'s at least going in the right direction.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m convinced that the problem involves the various\u003cbr\\/\u003e\\nmanipulations of the result column lists performed by\u003cbr\\/\u003e\\nGroupByNode.init, but I\'m not yet sure what change to make.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think it\'s instructive to note that, with this patch applied, the\u003cbr\\/\u003e\\nfollowing statement gets \\\"b\\\" and \\\"a\\\" backward:\u003cbr\\/\u003e\\nij&gt; select b, a, count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by b, a;\u003cbr\\/\u003e\\nB                     |A                     |3\u003cbr\\/\u003e\\n---------------------------------------------------------\u003cbr\\/\u003e\\n2.0                   |3.0                   |1\u003c\\/p\u003e\\n\\n\u003cp\u003eThe proper answer, of course, would be (3.0, 2.0, 1)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12567939_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12567939_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Feb\\/08 03:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-12T03:33:53+0000\'\u003e12\\/Feb\\/08 03:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My first attempt to fix this was a failure. \\n\\n I made the repro script pass, but broke various other \\nGROUP BY constructions. \\n\\n I\'m attaching the diff anyway (modifyVisitorDoesntWork.diff), \\nbecause I feel like it\'s at least going in the right direction. \\n\\n I\'m convinced that the problem involves the various \\nmanipulations of the result column lists performed by \\nGroupByNode.init, but I\'m not yet sure what change to make. \\n\\n I think it\'s instructive to note that, with this patch applied, the \\nfollowing statement gets \\\"b\\\" and \\\"a\\\" backward: \\nij&gt; select b, a, count  from xx group by b, a; \\nB                     |A                     |3 \\n--------------------------------------------------------- \\n2.0                   |3.0                   |1 \\n\\n The proper answer, of course, would be (3.0, 2.0, 1)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12569749\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12569749&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12569749\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12569749_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12569749_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/08 20:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-17T20:07:02+0000\'\u003e17\\/Feb\\/08 20:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been contemplating the following short script, trying to figure out what the\u003cbr\\/\u003e\\ncorrect behavior of Derby ought to be. Note that I haven\'t yet thrown in any ORDER BY\u003cbr\\/\u003e\\nor HAVING examples; I\'m just trying to understand the interaction between the\u003cbr\\/\u003e\\nselect list and the group by list.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome of these queries work, some are rejected, and one is the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3094\\\" title=\\\"Grouping of expressions causes NullPointerException\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3094\\\"\u003e\u003cdel\u003eDERBY-3094\u003c\\/del\u003e\u003c\\/a\u003e query.\u003cbr\\/\u003e\\nSome of the queries which are rejected seem like they ought to work, and some of\u003cbr\\/\u003e\\nthe queries which work seem like they ought to be rejected.\u003c\\/p\u003e\\n\\n\u003cp\u003ecreate table test (c1 int, c2 int, c3 int, c4 int);\u003cbr\\/\u003e\\ninsert into test values (1, 10, 100, 1000);\u003cbr\\/\u003e\\ninsert into test values (1, 11, 100, 1001);\u003cbr\\/\u003e\\ninsert into test values (2, 10, 100, 1000);\u003cbr\\/\u003e\\ninsert into test values (2, 11, 101, 1001);\u003cbr\\/\u003e\\ninsert into test values (2, 11, 101, 1000);\u003cbr\\/\u003e\\nselect * from test;\u003cbr\\/\u003e\\nselect c1+c2, sum(c3) from test group by c1,c2;\u003cbr\\/\u003e\\nselect c1+c2, sum(c3) from test group by c1+c2;\u003cbr\\/\u003e\\nselect c1+c2, sum(c3) from test group by c1+c2,c1;\u003cbr\\/\u003e\\nselect c1,c2, sum(c3) from test group by c1,c2,c1+c2;\u003cbr\\/\u003e\\n&#8211; Next query is refused with 42Y30 (select list contains invalid expression):\u003cbr\\/\u003e\\nselect c1+c2, sum(c3) from test group by c1;\u003cbr\\/\u003e\\n&#8211; Next query gets a runtime NPE (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3094\\\" title=\\\"Grouping of expressions causes NullPointerException\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3094\\\"\u003e\u003cdel\u003eDERBY-3094\u003c\\/del\u003e\u003c\\/a\u003e):\u003cbr\\/\u003e\\nselect c1+c2, sum(c3) from test group by c1,c1+c2;\u003cbr\\/\u003e\\n&#8211; Next query is refused with 42Y30 (select list contains invalid expression):\u003cbr\\/\u003e\\nselect c1,c2, sum(c3) from test group by c1+c2,c1;\u003cbr\\/\u003e\\n&#8211; Next query is refused with 42Y30 (select list contains invalid expression):\u003cbr\\/\u003e\\nselect c1+c2, sum(c3) from test group by 1;\u003cbr\\/\u003e\\n&#8211; Next query is refused with 42X04 (Column \'EXPR\' not in any table)\u003cbr\\/\u003e\\nselect c1+c2 as expr, sum(c3) from test group by expr;\u003cbr\\/\u003e\\n&#8211; Next query is refused with 42X04 (Column \'C1A\' not in any table)\u003cbr\\/\u003e\\nselect c1 as c1a, c2, sum(c3) from test group by c1a,c2;\u003cbr\\/\u003e\\nselect c1 as c2, sum(c3) from test group by c1,c2;\u003cbr\\/\u003e\\n&#8211; Next query is refused with 42Y30 (select list contains invalid expression):\u003cbr\\/\u003e\\nselect c1 as c2, sum(c3) from test group by c2;\u003cbr\\/\u003e\\nselect c1 as c2, sum(c3) from test group by c1;\u003c\\/p\u003e\\n\\n\u003cp\u003eThe challenge is \u003cbr\\/\u003e\\na) to ensure that we understand what the intended behavior of Derby should be\u003cbr\\/\u003e\\nb) to construct a modification to the current head of trunk that resolves the NPE\u003cbr\\/\u003e\\nbut still preserves all the other desired behaviors.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m hoping that collecting various test cases like this will help me understand this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12569749_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12569749_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/08 20:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-17T20:07:02+0000\'\u003e17\\/Feb\\/08 20:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve been contemplating the following short script, trying to figure out what the \\ncorrect behavior of Derby ought to be. Note that I haven\'t yet thrown in any ORDER BY \\nor HAVING examples; I\'m just trying to understand the interaction between the \\nselect list and the group by list. \\n\\n Some of these queries work, some are rejected, and one is the   DERBY-3094   query. \\nSome of the queries which are rejected seem like they ought to work, and some of \\nthe queries which work seem like they ought to be rejected. \\n\\n create table test (c1 int, c2 int, c3 int, c4 int); \\ninsert into test values (1, 10, 100, 1000); \\ninsert into test values (1, 11, 100, 1001); \\ninsert into test values (2, 10, 100, 1000); \\ninsert into test values (2, 11, 101, 1001); \\ninsert into test values (2, 11, 101, 1000); \\nselect * from test; \\nselect c1+c2, sum(c3) from test group by c1,c2; \\nselect c1+c2, sum(c3) from test group by c1+c2; \\nselect c1+c2, sum(c3) from test group by c1+c2,c1; \\nselect c1,c2, sum(c3) from test group by c1,c2,c1+c2; \\n&#8211; Next query is refused with 42Y30 (select list contains invalid expression): \\nselect c1+c2, sum(c3) from test group by c1; \\n&#8211; Next query gets a runtime NPE (  DERBY-3094  ): \\nselect c1+c2, sum(c3) from test group by c1,c1+c2; \\n&#8211; Next query is refused with 42Y30 (select list contains invalid expression): \\nselect c1,c2, sum(c3) from test group by c1+c2,c1; \\n&#8211; Next query is refused with 42Y30 (select list contains invalid expression): \\nselect c1+c2, sum(c3) from test group by 1; \\n&#8211; Next query is refused with 42X04 (Column \'EXPR\' not in any table) \\nselect c1+c2 as expr, sum(c3) from test group by expr; \\n&#8211; Next query is refused with 42X04 (Column \'C1A\' not in any table) \\nselect c1 as c1a, c2, sum(c3) from test group by c1a,c2; \\nselect c1 as c2, sum(c3) from test group by c1,c2; \\n&#8211; Next query is refused with 42Y30 (select list contains invalid expression): \\nselect c1 as c2, sum(c3) from test group by c2; \\nselect c1 as c2, sum(c3) from test group by c1; \\n\\n The challenge is  \\na) to ensure that we understand what the intended behavior of Derby should be \\nb) to construct a modification to the current head of trunk that resolves the NPE \\nbut still preserves all the other desired behaviors. \\n\\n I\'m hoping that collecting various test cases like this will help me understand this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570030\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570030&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570030\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570030_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570030_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Feb\\/08 22:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-18T22:37:49+0000\'\u003e18\\/Feb\\/08 22:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGroupByExpressionTest.java contains the following statement:\u003c\\/p\u003e\\n\\n\u003cp\u003e   select (c1+c2)+1, sum(c3) from test group by c1+c2\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the current Derby code, this statement is accepted as legal and produces results.\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, I\'m not sure it ought to be accepted, as the select list contains\u003cbr\\/\u003e\\na non-aggregate expression which does not appear in the group by list.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570030_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570030_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Feb\\/08 22:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-18T22:37:49+0000\'\u003e18\\/Feb\\/08 22:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    GroupByExpressionTest.java contains the following statement: \\n\\n    select (c1+c2)+1, sum(c3) from test group by c1+c2 \\n\\n With the current Derby code, this statement is accepted as legal and produces results. \\n\\n However, I\'m not sure it ought to be accepted, as the select list contains \\na non-aggregate expression which does not appear in the group by list.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570032\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570032&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570032\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570032_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570032_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Feb\\/08 22:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-18T22:45:15+0000\'\u003e18\\/Feb\\/08 22:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGroupByExpressionTest.java also contains this very intriguing statement:\u003c\\/p\u003e\\n\\n\u003cp\u003e  select (c1+c2), sum(c3)+(c1+c2) from test group by c1+c2\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the current Derby code, this statement is accepted as legal and produces results.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570032_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570032_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Feb\\/08 22:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-18T22:45:15+0000\'\u003e18\\/Feb\\/08 22:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    GroupByExpressionTest.java also contains this very intriguing statement: \\n\\n   select (c1+c2), sum(c3)+(c1+c2) from test group by c1+c2 \\n\\n With the current Derby code, this statement is accepted as legal and produces results.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570036\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570036&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570036\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570036_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570036_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Feb\\/08 22:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-18T22:59:45+0000\'\u003e18\\/Feb\\/08 22:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is \'twoPass.diff\', a patch proposal.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe idea of this patch is that, during the GroupBy tree rewriting,\u003cbr\\/\u003e\\nwe replace ResultColumn expressions with VirtualColumnNode\u003cbr\\/\u003e\\nreferences in two passes:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewe first handle all expression replacements\u003c\\/li\u003e\\n\\t\u003cli\u003ethen once all the expressions have been replaced,\u003cbr\\/\u003e\\n   we replace all column references.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThis patch fixes the repro script, and makes \u003cb\u003ealmost all\u003c\\/b\u003e\u003cbr\\/\u003e\\nof the regression tests pass.\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, two of the test cases in GroupByExpressionTest.java\u003cbr\\/\u003e\\nfail; these are the two test cases that I listed in my previous\u003cbr\\/\u003e\\ntwo comments.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s not clear to me whether these two test cases are valid or not,\u003cbr\\/\u003e\\nthey are certainly very unusual expressions and I think an argument\u003cbr\\/\u003e\\ncan be made that they should be rejected by the compiler as invalid.\u003c\\/p\u003e\\n\\n\u003cp\u003ePlease consider this patch as \\\"for discussion\\\", intended to\u003cbr\\/\u003e\\nrecord a possible alternate implementation, and to stimulate\u003cbr\\/\u003e\\nsome feedback regarding what the correct rules ought to be\u003cbr\\/\u003e\\nfor correlating elements in the GROUP BY list against elements\u003cbr\\/\u003e\\nin the SELECT list.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570036_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570036_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Feb\\/08 22:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-18T22:59:45+0000\'\u003e18\\/Feb\\/08 22:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is \'twoPass.diff\', a patch proposal. \\n\\n The idea of this patch is that, during the GroupBy tree rewriting, \\nwe replace ResultColumn expressions with VirtualColumnNode \\nreferences in two passes: \\n \\n\\t we first handle all expression replacements \\n\\t then once all the expressions have been replaced, \\n   we replace all column references. \\n \\n\\n\\n This patch fixes the repro script, and makes  almost all  \\nof the regression tests pass. \\n\\n However, two of the test cases in GroupByExpressionTest.java \\nfail; these are the two test cases that I listed in my previous \\ntwo comments. \\n\\n It\'s not clear to me whether these two test cases are valid or not, \\nthey are certainly very unusual expressions and I think an argument \\ncan be made that they should be rejected by the compiler as invalid. \\n\\n Please consider this patch as \\\"for discussion\\\", intended to \\nrecord a possible alternate implementation, and to stimulate \\nsome feedback regarding what the correct rules ought to be \\nfor correlating elements in the GROUP BY list against elements \\nin the SELECT list.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570055\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570055&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570055\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12570055_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570055_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/08 00:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-19T00:01:19+0000\'\u003e19\\/Feb\\/08 00:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; It\'s not clear to me whether [two of the test cases in\u003cbr\\/\u003e\\n&gt; GroupByExpressionTest.java] are valid or not,\u003c\\/p\u003e\\n\\n\u003cp\u003eI have not yet had a chance to look at the patch, but I ran those two queries-\u003cdel\u003ealong with all of the queries posted in your Feb 17 comment\u003c\\/del\u003e\u003cdel\u003eagainst DB2 v8.  From what I can tell, the (clean) Derby trunk and DB2 v8 agree in all of these cases\u003c\\/del\u003e-i.e. they either both throw an error or they return the same results (with the notable exception of the NPE that this issue is trying to fix).  Not sure if that\'s helpful or not...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12570055_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570055_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/08 00:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-19T00:01:19+0000\'\u003e19\\/Feb\\/08 00:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; It\'s not clear to me whether [two of the test cases in \\n&gt; GroupByExpressionTest.java] are valid or not, \\n\\n I have not yet had a chance to look at the patch, but I ran those two queries- along with all of the queries posted in your Feb 17 comment  against DB2 v8.  From what I can tell, the (clean) Derby trunk and DB2 v8 agree in all of these cases -i.e. they either both throw an error or they return the same results (with the notable exception of the NPE that this issue is trying to fix).  Not sure if that\'s helpful or not...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570074\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570074&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570074\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570074_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570074_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/08 01:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-19T01:28:38+0000\'\u003e19\\/Feb\\/08 01:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s an interesting essay on the sort of subtle problems that can arise\u003cbr\\/\u003e\\nfrom not being crystal-clear about the semantics of column references and\u003cbr\\/\u003e\\nexpressions in GROUP BY clauses:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/odetocode.com\\/Blogs\\/scott\\/archive\\/2005\\/04\\/17\\/1214.aspx\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/odetocode.com\\/Blogs\\/scott\\/archive\\/2005\\/04\\/17\\/1214.aspx\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570074_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570074_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/08 01:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-19T01:28:38+0000\'\u003e19\\/Feb\\/08 01:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s an interesting essay on the sort of subtle problems that can arise \\nfrom not being crystal-clear about the semantics of column references and \\nexpressions in GROUP BY clauses: \\n http:\\/\\/odetocode.com\\/Blogs\\/scott\\/archive\\/2005\\/04\\/17\\/1214.aspx               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570079\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570079&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570079\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570079_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570079_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/08 01:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-19T01:53:13+0000\'\u003e19\\/Feb\\/08 01:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe Postgres docs (\u003ca href=\\\"http:\\/\\/www.postgresql.org\\/docs\\/8.0\\/interactive\\/sql-select.html#SQL-GROUPBY\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.postgresql.org\\/docs\\/8.0\\/interactive\\/sql-select.html#SQL-GROUPBY\u003c\\/a\u003e)\u003cbr\\/\u003e\\nhave this to say about the column-name-versus-column-alias subtlety referred\u003cbr\\/\u003e\\nto in the previous comment:\u003c\\/p\u003e\\n\\n\u003cp\u003e       In case of ambiguity, a GROUP BY name will be interpreted as an input-column name \u003cbr\\/\u003e\\n       rather than an output column name.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to me preferable to reject the ambiguous query rather than producing possibly\u003cbr\\/\u003e\\nsurprising results, but I can see why ambiguity-resolving behaviors are also worthwhile.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570079_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570079_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/08 01:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-19T01:53:13+0000\'\u003e19\\/Feb\\/08 01:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The Postgres docs ( http:\\/\\/www.postgresql.org\\/docs\\/8.0\\/interactive\\/sql-select.html#SQL-GROUPBY ) \\nhave this to say about the column-name-versus-column-alias subtlety referred \\nto in the previous comment: \\n\\n        In case of ambiguity, a GROUP BY name will be interpreted as an input-column name  \\n       rather than an output column name. \\n\\n It seems to me preferable to reject the ambiguous query rather than producing possibly \\nsurprising results, but I can see why ambiguity-resolving behaviors are also worthwhile.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570358\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570358&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570358\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570358_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570358_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/08 18:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-19T18:31:51+0000\'\u003e19\\/Feb\\/08 18:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is \'TwoPassVisitor.diff\', the first working code proposal.\u003cbr\\/\u003e\\nWith this patch, the repro script passes, and all regression tests pass.\u003c\\/p\u003e\\n\\n\u003cp\u003eI still need to:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eadd a bunch of new test cases\u003c\\/li\u003e\\n\\t\u003cli\u003eadd comments to the code\u003c\\/li\u003e\\n\\t\u003cli\u003eadd a writeup explaining the ideas behind this patch\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eBut at least I now have code that appears to add the desired\u003cbr\\/\u003e\\nnew behavior while not breaking any (known) existing behaviors.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570358_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570358_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Feb\\/08 18:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-19T18:31:51+0000\'\u003e19\\/Feb\\/08 18:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is \'TwoPassVisitor.diff\', the first working code proposal. \\nWith this patch, the repro script passes, and all regression tests pass. \\n\\n I still need to: \\n \\n\\t add a bunch of new test cases \\n\\t add comments to the code \\n\\t add a writeup explaining the ideas behind this patch \\n \\n\\n\\n But at least I now have code that appears to add the desired \\nnew behavior while not breaking any (known) existing behaviors.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570561\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570561&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570561\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570561_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570561_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 03:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T03:59:04+0000\'\u003e20\\/Feb\\/08 03:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Army for checking the queries against DB2, that\'s quite helpful.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570561_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570561_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 03:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T03:59:04+0000\'\u003e20\\/Feb\\/08 03:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Army for checking the queries against DB2, that\'s quite helpful.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570569\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570569&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570569\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570569_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570569_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 04:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T04:23:49+0000\'\u003e20\\/Feb\\/08 04:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt seems like there might be a similar problem with the HAVING clause. Consider:\u003c\\/p\u003e\\n\\n\u003cp\u003eij&gt; select c1+c2, sum(c3) from test group by c1+c2;\u003cbr\\/\u003e\\n1          |2\u003cbr\\/\u003e\\n-----------------------\u003cbr\\/\u003e\\n11         |100\u003cbr\\/\u003e\\n12         |200\u003cbr\\/\u003e\\n13         |202\u003c\\/p\u003e\\n\\n\u003cp\u003e3 rows selected\u003cbr\\/\u003e\\nij&gt; select c1+c2, sum(c3) from test group by c1,c1+c2;\u003cbr\\/\u003e\\n1          |2\u003cbr\\/\u003e\\n-----------------------\u003cbr\\/\u003e\\n11         |100\u003cbr\\/\u003e\\n12         |100\u003cbr\\/\u003e\\n12         |100\u003cbr\\/\u003e\\n13         |202\u003c\\/p\u003e\\n\\n\u003cp\u003e4 rows selected\u003cbr\\/\u003e\\nij&gt; select c1+c2, sum(c3) from test group by c1+c2 having c1+c2 &gt; 11;\u003cbr\\/\u003e\\n1          |2\u003cbr\\/\u003e\\n-----------------------\u003cbr\\/\u003e\\n12         |200\u003cbr\\/\u003e\\n13         |202\u003c\\/p\u003e\\n\\n\u003cp\u003e2 rows selected\u003cbr\\/\u003e\\nij&gt; select c1+c2, sum(c3) from test group by c1, c1+c2 having c1+c2 &gt; 11;\u003cbr\\/\u003e\\nERROR 42X24: Column C2 is referenced in the HAVING clause but is not in the GROUP BY list.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think that the proper results for that last query should have been:\u003cbr\\/\u003e\\n1          |2\u003cbr\\/\u003e\\n-----------------------\u003cbr\\/\u003e\\n12         |100\u003cbr\\/\u003e\\n12         |100\u003cbr\\/\u003e\\n13         |202\u003c\\/p\u003e\\n\\n\u003cp\u003e3 rows selected\u003c\\/p\u003e\\n\\n\u003cp\u003eWe could either investigate HAVING behaviors as part of this JIRA, or we could open a new one.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570569_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570569_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 04:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T04:23:49+0000\'\u003e20\\/Feb\\/08 04:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It seems like there might be a similar problem with the HAVING clause. Consider: \\n\\n ij&gt; select c1+c2, sum(c3) from test group by c1+c2; \\n1          |2 \\n----------------------- \\n11         |100 \\n12         |200 \\n13         |202 \\n\\n 3 rows selected \\nij&gt; select c1+c2, sum(c3) from test group by c1,c1+c2; \\n1          |2 \\n----------------------- \\n11         |100 \\n12         |100 \\n12         |100 \\n13         |202 \\n\\n 4 rows selected \\nij&gt; select c1+c2, sum(c3) from test group by c1+c2 having c1+c2 &gt; 11; \\n1          |2 \\n----------------------- \\n12         |200 \\n13         |202 \\n\\n 2 rows selected \\nij&gt; select c1+c2, sum(c3) from test group by c1, c1+c2 having c1+c2 &gt; 11; \\nERROR 42X24: Column C2 is referenced in the HAVING clause but is not in the GROUP BY list. \\n\\n I think that the proper results for that last query should have been: \\n1          |2 \\n----------------------- \\n12         |100 \\n12         |100 \\n13         |202 \\n\\n 3 rows selected \\n\\n We could either investigate HAVING behaviors as part of this JIRA, or we could open a new one.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570577\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570577&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570577\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570577_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570577_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 05:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T05:18:28+0000\'\u003e20\\/Feb\\/08 05:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached TwoPassVisitorWithCommentsAndTests.diff,\u003cbr\\/\u003e\\nwhich adds a brief comment to the GroupByNode code\u003cbr\\/\u003e\\nexplaining the reasoning behind the two pass ResultColumn\u003cbr\\/\u003e\\nrewriting algorithm, and adds a number of new tests to\u003cbr\\/\u003e\\nGroupByExpressionTest.java.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570577_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570577_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 05:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T05:18:28+0000\'\u003e20\\/Feb\\/08 05:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached TwoPassVisitorWithCommentsAndTests.diff, \\nwhich adds a brief comment to the GroupByNode code \\nexplaining the reasoning behind the two pass ResultColumn \\nrewriting algorithm, and adds a number of new tests to \\nGroupByExpressionTest.java.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570783\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570783&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570783\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12570783_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570783_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T18:13:04+0000\'\u003e20\\/Feb\\/08 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThank you for the updated patch, Bryan.  Is there a more detailed writeup forthcoming for this change, or are the code comments the extent of it?\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reason I ask is that, after reading the code comments and the comments in this issue, I can\'t quite see the correlation between the patch and the NPE that it fixes.  That is, it\'s clear that the patch fixes the issue, but I think I\'m missing the details on \u003cem\u003ewhy\u003c\\/em\u003e.  The code comments say:\u003c\\/p\u003e\\n\\n\u003cp\u003e \\/\\/ then we don\'t want the replacement of the\u003cbr\\/\u003e\\n \\/\\/ simple column reference C1 to affect the\u003cbr\\/\u003e\\n \\/\\/ compound expression C1 * (C2 \\/ 100).\u003c\\/p\u003e\\n\\n\u003cp\u003ebut it\'s not clear to me how replacement of the simple column reference can negatively affect the compound expressions.  Is it an issue of VCN\'s pointing to the wrong place?  If so, any idea as to why that happens?  Similarly, in an earlier comment you noted:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I think it\'s instructive to note that, with this patch applied, the\u003cbr\\/\u003e\\n&gt; following statement gets \\\"b\\\" and \\\"a\\\" backward:\u003cbr\\/\u003e\\n&gt; ij&gt; select b, a, count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by b, a;\u003cbr\\/\u003e\\n&gt; B |A |3\u003cbr\\/\u003e\\n&gt; ---------------------------------------------------------\u003cbr\\/\u003e\\n&gt; 2.0 |3.0 |1\u003c\\/p\u003e\\n\\n\u003cp\u003eIs it possible to say what it is about processing simple column references \u003cem\u003eafter\u003c\\/em\u003e compound expressions that fixes this problem?\u003c\\/p\u003e\\n\\n\u003cp\u003eApologies if I\'m missing something obvious.  I\'m not by any means opposed to the patch, I\'m just hoping to gain an understanding about why it resolves the discussion\\/issues raised thus far for this issue...\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd thanks for your continued diligence with this one, Bryan.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12570783_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570783_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T18:13:04+0000\'\u003e20\\/Feb\\/08 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thank you for the updated patch, Bryan.  Is there a more detailed writeup forthcoming for this change, or are the code comments the extent of it? \\n\\n The reason I ask is that, after reading the code comments and the comments in this issue, I can\'t quite see the correlation between the patch and the NPE that it fixes.  That is, it\'s clear that the patch fixes the issue, but I think I\'m missing the details on  why .  The code comments say: \\n\\n  \\/\\/ then we don\'t want the replacement of the \\n \\/\\/ simple column reference C1 to affect the \\n \\/\\/ compound expression C1 * (C2 \\/ 100). \\n\\n but it\'s not clear to me how replacement of the simple column reference can negatively affect the compound expressions.  Is it an issue of VCN\'s pointing to the wrong place?  If so, any idea as to why that happens?  Similarly, in an earlier comment you noted: \\n\\n &gt; I think it\'s instructive to note that, with this patch applied, the \\n&gt; following statement gets \\\"b\\\" and \\\"a\\\" backward: \\n&gt; ij&gt; select b, a, count  from xx group by b, a; \\n&gt; B |A |3 \\n&gt; --------------------------------------------------------- \\n&gt; 2.0 |3.0 |1 \\n\\n Is it possible to say what it is about processing simple column references  after  compound expressions that fixes this problem? \\n\\n Apologies if I\'m missing something obvious.  I\'m not by any means opposed to the patch, I\'m just hoping to gain an understanding about why it resolves the discussion\\/issues raised thus far for this issue... \\n\\n And thanks for your continued diligence with this one, Bryan.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12570822\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12570822&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12570822\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570822_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570822_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T20:19:06+0000\'\u003e20\\/Feb\\/08 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is TwoPassForHavingClauseAlso.diff, which\u003cbr\\/\u003e\\naddresses the problem I noted with the HAVING clause\u003cbr\\/\u003e\\nin an earlier comment.\u003c\\/p\u003e\\n\\n\u003cp\u003eArmy, thanks for having a look at the patch. I am still\u003cbr\\/\u003e\\nintending to complete a more thorough description\u003cbr\\/\u003e\\nof the \\\"why\\\" behind the changes that should hopefully\u003cbr\\/\u003e\\nmake it more clear.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut for now, two quick responses:\u003cbr\\/\u003e\\n1) substituting the column references with VCN\'s during\u003cbr\\/\u003e\\ngroup-by rewriting changes which result set is pointed to,\u003cbr\\/\u003e\\nbut when we process the C1 portion of the compound\u003cbr\\/\u003e\\nexpression but not the compound expression as a whole,\u003cbr\\/\u003e\\nwe never correct the C2 column reference (since C2 by\u003cbr\\/\u003e\\nitself is not a grouping column), leaving the compound\u003cbr\\/\u003e\\nexpression with C1 pointing to the correct result set, but C2\u003cbr\\/\u003e\\npointing to a non-existing result set, causing an NPE at runtime.\u003cbr\\/\u003e\\n2) the earlier comment about getting \\\"b\\\" and \\\"a\\\" backward\u003cbr\\/\u003e\\nwas simply a red herring. That particular patch attempt\u003cbr\\/\u003e\\n(modifyVisitorDoesntWork.diff) was simply flat-out wrong. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll try to get a more thorough writeup completed soon.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12570822_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12570822_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Feb\\/08 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-20T20:19:06+0000\'\u003e20\\/Feb\\/08 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is TwoPassForHavingClauseAlso.diff, which \\naddresses the problem I noted with the HAVING clause \\nin an earlier comment. \\n\\n Army, thanks for having a look at the patch. I am still \\nintending to complete a more thorough description \\nof the \\\"why\\\" behind the changes that should hopefully \\nmake it more clear. \\n\\n But for now, two quick responses: \\n1) substituting the column references with VCN\'s during \\ngroup-by rewriting changes which result set is pointed to, \\nbut when we process the C1 portion of the compound \\nexpression but not the compound expression as a whole, \\nwe never correct the C2 column reference (since C2 by \\nitself is not a grouping column), leaving the compound \\nexpression with C1 pointing to the correct result set, but C2 \\npointing to a non-existing result set, causing an NPE at runtime. \\n2) the earlier comment about getting \\\"b\\\" and \\\"a\\\" backward \\nwas simply a red herring. That particular patch attempt \\n(modifyVisitorDoesntWork.diff) was simply flat-out wrong.   \\n\\n I\'ll try to get a more thorough writeup completed soon.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12571445\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12571445&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12571445\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12571445_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571445_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Feb\\/08 15:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-22T15:39:58+0000\'\u003e22\\/Feb\\/08 15:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached an attempt at a descriptive writeup. Please let me know if it\u003cbr\\/\u003e\\nmakes the patch more comprehensible.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12571445_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571445_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Feb\\/08 15:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-22T15:39:58+0000\'\u003e22\\/Feb\\/08 15:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached an attempt at a descriptive writeup. Please let me know if it \\nmakes the patch more comprehensible.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12571516\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12571516&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12571516\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12571516_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571516_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Feb\\/08 18:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-22T18:33:31+0000\'\u003e22\\/Feb\\/08 18:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks a ton for the detailed write-up, Bryan, that definitely makes it clear as to what is going on with this issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn reading through the document I gained an understanding of what the problem is, and then I began wondering if this is only an issue when a ColumnReference appears in a compound expression--or is it also an issue when one expression appears within another expression.  I came up with the following query:\u003c\\/p\u003e\\n\\n\u003cp\u003e  select a*((a+b)\\/1.0), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from xx group by a+b, a*((a+b)\\/1.0)\u003c\\/p\u003e\\n\\n\u003cp\u003ewhich fails with an NPE even after TwoPassForHavingClauseAlso.diff is applied.  I\'m attaching d3094_followup.htm, which (in theory) walks through this query in the same way that your \\\"notes.html\\\" walked through another example.  I did this mostly for my own understanding, but thought it might be useful to post it as a writeup to this issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo quote the conclusion:\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"\u003cspan class=\\\"error\\\"\u003e&#91;T&#93;\u003c\\/span\u003ehe TwoPassVisitorWithCommentsAndTests.diff solves the specific query that was reported (and described in \\\"notes.html\\\"), and so it makes things better, which is great.  Thus I think it would be fine to commit the patch as it is and either deal with queries like the one above in a follow-up patch, or file a separate Jira altogether.\\\"\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12571516_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571516_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Feb\\/08 18:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-22T18:33:31+0000\'\u003e22\\/Feb\\/08 18:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks a ton for the detailed write-up, Bryan, that definitely makes it clear as to what is going on with this issue. \\n\\n In reading through the document I gained an understanding of what the problem is, and then I began wondering if this is only an issue when a ColumnReference appears in a compound expression--or is it also an issue when one expression appears within another expression.  I came up with the following query: \\n\\n   select a*((a+b)\\/1.0), count  from xx group by a+b, a*((a+b)\\/1.0) \\n\\n which fails with an NPE even after TwoPassForHavingClauseAlso.diff is applied.  I\'m attaching d3094_followup.htm, which (in theory) walks through this query in the same way that your \\\"notes.html\\\" walked through another example.  I did this mostly for my own understanding, but thought it might be useful to post it as a writeup to this issue. \\n\\n To quote the conclusion: \\n\\n \\\" &#91;T&#93; he TwoPassVisitorWithCommentsAndTests.diff solves the specific query that was reported (and described in \\\"notes.html\\\"), and so it makes things better, which is great.  Thus I think it would be fine to commit the patch as it is and either deal with queries like the one above in a follow-up patch, or file a separate Jira altogether.\\\"              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12571751\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12571751&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12571751\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12571751_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571751_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/08 16:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-23T16:10:30+0000\'\u003e23\\/Feb\\/08 16:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Army! That\'s a keen insight about the underlying issue, and\u003cbr\\/\u003e\\na great writeup and test case.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s yet another variant that\'s hard to explain: the first statement\u003cbr\\/\u003e\\nworks, the second is refused with error 42Y30:\u003c\\/p\u003e\\n\\n\u003cp\u003eselect (a+b)+c, count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from t group by c, a+b;\u003cbr\\/\u003e\\nselect a+(b+c), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from t group by c, a+b;\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not quite sure how to push this problem further. The only idea\u003cbr\\/\u003e\\nI had was as follows: perhaps we could automatically and silently\u003cbr\\/\u003e\\npull up \u003cb\u003eevery\u003c\\/b\u003e column reference that is present in any GROUP BY\u003cbr\\/\u003e\\nexpression, and include that column as an extra column reference\u003cbr\\/\u003e\\nat the end of the group by list. So we could rewrite the above queries,\u003cbr\\/\u003e\\nfor example, as:\u003c\\/p\u003e\\n\\n\u003cp\u003eselect (a+b)+c, count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from t group by c, a+b, a, b;\u003cbr\\/\u003e\\nselect a+(b+c), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from t group by c, a+b, a, b;\u003c\\/p\u003e\\n\\n\u003cp\u003eThat might mean we\'d always have \\\"enough\\\" column references\u003cbr\\/\u003e\\nso that we could perform substitution on all the result columns\u003cbr\\/\u003e\\nin the select list successfully.\u003c\\/p\u003e\\n\\n\u003cp\u003eYet I\'m nervous about this strategy; we wouldn\'t want these pulled\u003cbr\\/\u003e\\nup columns to be used for the actual grouping (because it could\u003cbr\\/\u003e\\nsubdivide the actual groups further than the user intended), so we\'d\u003cbr\\/\u003e\\nhave to mark these columns as \\\"special columns to be used for\u003cbr\\/\u003e\\nresolving column references, but not to be used for grouping.\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll continue to think about it, but I\'m increasingly tempted to\u003cbr\\/\u003e\\ntake your suggestion to be satisfied with the patch as is, and\u003cbr\\/\u003e\\nfile some of these other issues separately to be studied more\u003cbr\\/\u003e\\nin the future. This is similar to the way that we marked \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1624\\\" title=\\\"use of direct column name rather than alias make aggregation fail (Hibernate depends on that)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1624\\\"\u003e\u003cdel\u003eDERBY-1624\u003c\\/del\u003e\u003c\\/a\u003e\u003cbr\\/\u003e\\nas resolved, while shifting the unresolved portion out to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2457\\\" title=\\\"Use of column aliases in group by \\/ having clauses can cause queries to fail\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2457\\\"\u003e\u003cdel\u003eDERBY-2457\u003c\\/del\u003e\u003c\\/a\u003e. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12571751_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571751_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/08 16:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-23T16:10:30+0000\'\u003e23\\/Feb\\/08 16:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Army! That\'s a keen insight about the underlying issue, and \\na great writeup and test case. \\n\\n Here\'s yet another variant that\'s hard to explain: the first statement \\nworks, the second is refused with error 42Y30: \\n\\n select (a+b)+c, count  from t group by c, a+b; \\nselect a+(b+c), count  from t group by c, a+b; \\n\\n I\'m not quite sure how to push this problem further. The only idea \\nI had was as follows: perhaps we could automatically and silently \\npull up  every  column reference that is present in any GROUP BY \\nexpression, and include that column as an extra column reference \\nat the end of the group by list. So we could rewrite the above queries, \\nfor example, as: \\n\\n select (a+b)+c, count  from t group by c, a+b, a, b; \\nselect a+(b+c), count  from t group by c, a+b, a, b; \\n\\n That might mean we\'d always have \\\"enough\\\" column references \\nso that we could perform substitution on all the result columns \\nin the select list successfully. \\n\\n Yet I\'m nervous about this strategy; we wouldn\'t want these pulled \\nup columns to be used for the actual grouping (because it could \\nsubdivide the actual groups further than the user intended), so we\'d \\nhave to mark these columns as \\\"special columns to be used for \\nresolving column references, but not to be used for grouping.\\\" \\n\\n I\'ll continue to think about it, but I\'m increasingly tempted to \\ntake your suggestion to be satisfied with the patch as is, and \\nfile some of these other issues separately to be studied more \\nin the future. This is similar to the way that we marked   DERBY-1624   \\nas resolved, while shifting the unresolved portion out to   DERBY-2457  .               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12571810\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12571810&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12571810\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12571810_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571810_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Feb\\/08 00:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-24T00:30:18+0000\'\u003e24\\/Feb\\/08 00:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s one other idea that might work:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eDefine the \\\"level\\\" of a GROUP BY expression to be\u003cbr\\/\u003e\\n   the number of column references in that expression.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e   For example, in this clause:\u003c\\/p\u003e\\n\\n\u003cp\u003e        GROUP BY a, b, a+b, a+(b+c), a*(b\\/100.0), a*((a+b)\\/1.0)\u003c\\/p\u003e\\n\\n\u003cp\u003e   the level of the various elements in the list are:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ea: 1\u003c\\/li\u003e\\n\\t\u003cli\u003eb: 1\u003c\\/li\u003e\\n\\t\u003cli\u003ea+b: 2\u003c\\/li\u003e\\n\\t\u003cli\u003ea+(b+c): 3\u003c\\/li\u003e\\n\\t\u003cli\u003ea*(b\\/100.0): 2\u003c\\/li\u003e\\n\\t\u003cli\u003ea*((a+b)\\/1.0): 3\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThen, when performing VCN substitution into the\u003cbr\\/\u003e\\n    parent PRNode\'s ResultColumnList entries from\u003cbr\\/\u003e\\n   the GroupByNode\'s entries, process the entires\u003cbr\\/\u003e\\n   in descending order by level, and left-to-right within\u003cbr\\/\u003e\\n   the same level. So the entries from the GROUP BY above\u003cbr\\/\u003e\\n   would be processed in the order:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e   a+(b+c), a*((a+b)\\/1.0), a+b, a*(b\\/100.0), a, b\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes this algorithm seem like it would be worth investigating?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12571810_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12571810_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Feb\\/08 00:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-24T00:30:18+0000\'\u003e24\\/Feb\\/08 00:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s one other idea that might work: \\n\\n \\n\\t Define the \\\"level\\\" of a GROUP BY expression to be \\n   the number of column references in that expression. \\n \\n\\n\\n    For example, in this clause: \\n\\n         GROUP BY a, b, a+b, a+(b+c), a*(b\\/100.0), a*((a+b)\\/1.0) \\n\\n    the level of the various elements in the list are: \\n\\n \\n\\t a: 1 \\n\\t b: 1 \\n\\t a+b: 2 \\n\\t a+(b+c): 3 \\n\\t a*(b\\/100.0): 2 \\n\\t a*((a+b)\\/1.0): 3 \\n \\n\\n\\n \\n\\t Then, when performing VCN substitution into the \\n    parent PRNode\'s ResultColumnList entries from \\n   the GroupByNode\'s entries, process the entires \\n   in descending order by level, and left-to-right within \\n   the same level. So the entries from the GROUP BY above \\n   would be processed in the order: \\n \\n\\n\\n    a+(b+c), a*((a+b)\\/1.0), a+b, a*(b\\/100.0), a, b \\n\\n Does this algorithm seem like it would be worth investigating?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12572144\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12572144&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12572144\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12572144_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12572144_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/08 17:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-25T17:44:46+0000\'\u003e25\\/Feb\\/08 17:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Here\'s yet another variant that\'s hard to explain: the first statement\u003cbr\\/\u003e\\n&gt; works, the second is refused with error 42Y30:\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt; select (a+b)+c, count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from t group by c, a+b;\u003cbr\\/\u003e\\n&gt; select a+(b+c), count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from t group by c, a+b; \u003c\\/p\u003e\\n\\n\u003cp\u003eThe tree for \\\"(a+b)\u003cins\u003ec\\\" contains the subtree \\\"a+b\\\" as the left-hand side of the top-most binary operator and \\\"c\\\" as the right-hand side.  Since each of those matches a stand-alone expression in the GROUP BY, the equivalence checking for GROUP BY processing passes.  But the tree for \\\"a\u003c\\/ins\u003e(b+c)\\\" has \\\"a\\\" on one side and \\\"b+c\\\" on the other, neither of which shows up as a stand-alone GROUP BY expression, so the second query is rejected.  I agree it\'s a tad non-inuititive, but it appears to be \\\"explainable\\\", for what that\'s worth...\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Here\'s one other idea that might work: \u003c\\/p\u003e\\n\\n\u003cp\u003e[ snip ]\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Does this algorithm seem like it would be worth investigating?\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I definitely think this is worth investigating.  From what I can tell it solves the problem of sub-expression substitution, and it seems a tad safer than pulling unneeded columns into the GROUP BY expression.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere\'s a CollectNodesVisitor class which finds all instances of a specified class within the subtree beneath a given ValueNode, so you might be able to use that to count the number of ColumnReferences in the expression.  Though ColumnReferences tend to appear in lots of places, so it\'ll be interesting to see if a simple CollectNodesVisitor is good enough--or will it end up counting ColumnReferences that shouldn\'t be counted...?\u003c\\/p\u003e\\n\\n\u003cp\u003eIn any event, +1 to further pursuit of the suggested approach.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12572144_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12572144_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/08 17:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-25T17:44:46+0000\'\u003e25\\/Feb\\/08 17:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Here\'s yet another variant that\'s hard to explain: the first statement \\n&gt; works, the second is refused with error 42Y30: \\n&gt;  \\n&gt; select (a+b)+c, count  from t group by c, a+b; \\n&gt; select a+(b+c), count  from t group by c, a+b;  \\n\\n The tree for \\\"(a+b) c\\\" contains the subtree \\\"a+b\\\" as the left-hand side of the top-most binary operator and \\\"c\\\" as the right-hand side.  Since each of those matches a stand-alone expression in the GROUP BY, the equivalence checking for GROUP BY processing passes.  But the tree for \\\"a (b+c)\\\" has \\\"a\\\" on one side and \\\"b+c\\\" on the other, neither of which shows up as a stand-alone GROUP BY expression, so the second query is rejected.  I agree it\'s a tad non-inuititive, but it appears to be \\\"explainable\\\", for what that\'s worth... \\n\\n &gt; Here\'s one other idea that might work:  \\n\\n [ snip ] \\n\\n &gt; Does this algorithm seem like it would be worth investigating? \\n\\n Yes, I definitely think this is worth investigating.  From what I can tell it solves the problem of sub-expression substitution, and it seems a tad safer than pulling unneeded columns into the GROUP BY expression. \\n\\n There\'s a CollectNodesVisitor class which finds all instances of a specified class within the subtree beneath a given ValueNode, so you might be able to use that to count the number of ColumnReferences in the expression.  Though ColumnReferences tend to appear in lots of places, so it\'ll be interesting to see if a simple CollectNodesVisitor is good enough--or will it end up counting ColumnReferences that shouldn\'t be counted...? \\n\\n In any event, +1 to further pursuit of the suggested approach.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12572771\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12572771&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12572771\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12572771_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12572771_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/08 03:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-27T03:33:14+0000\'\u003e27\\/Feb\\/08 03:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is sortExpressions.diff, which proposes to sort\u003cbr\\/\u003e\\nthe expressions based on the number of ColumnReferences\u003cbr\\/\u003e\\nthat each contains, using the technique suggested by Army\u003cbr\\/\u003e\\nof counting those refs using the CollectNodesVisitor.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to handle all the existing test cases, as well\u003cbr\\/\u003e\\nas a few new ones that I added to GroupByExpressionTest.java\u003cbr\\/\u003e\\nas part of this patch.\u003c\\/p\u003e\\n\\n\u003cp\u003ePlease have a look and tell me what you think.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12572771_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12572771_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/08 03:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-27T03:33:14+0000\'\u003e27\\/Feb\\/08 03:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is sortExpressions.diff, which proposes to sort \\nthe expressions based on the number of ColumnReferences \\nthat each contains, using the technique suggested by Army \\nof counting those refs using the CollectNodesVisitor. \\n\\n It seems to handle all the existing test cases, as well \\nas a few new ones that I added to GroupByExpressionTest.java \\nas part of this patch. \\n\\n Please have a look and tell me what you think.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12573053\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12573053&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12573053\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12573053_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573053_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/08 20:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-27T20:05:04+0000\'\u003e27\\/Feb\\/08 20:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003esortExpressions.diff looks good to me.  Thanks for continuing with that approach, Bryan.  Assuming derbyall and suites.All run cleanly, I say +1 to commit since it fixes all of the known queries and seems algorithmically correct as far as I can tell.  If additional issues\\/queries are discovered later, I think they can be addressed as they are found.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne nit: it seems the creation of a new ArrayList for havingRefsToSubstitute could be conditional upon the presence of a non-null havingClause, and that a single ExpressionSorter() could be used instead of two.  But in both cases the code may be easier to read as it is, so I\'m not sure it\'s really worth changing...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12573053_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573053_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/08 20:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-27T20:05:04+0000\'\u003e27\\/Feb\\/08 20:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    sortExpressions.diff looks good to me.  Thanks for continuing with that approach, Bryan.  Assuming derbyall and suites.All run cleanly, I say +1 to commit since it fixes all of the known queries and seems algorithmically correct as far as I can tell.  If additional issues\\/queries are discovered later, I think they can be addressed as they are found. \\n\\n One nit: it seems the creation of a new ArrayList for havingRefsToSubstitute could be conditional upon the presence of a non-null havingClause, and that a single ExpressionSorter() could be used instead of two.  But in both cases the code may be easier to read as it is, so I\'m not sure it\'s really worth changing...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12573309\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12573309&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12573309\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12573309_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573309_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/08 14:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-28T14:50:31+0000\'\u003e28\\/Feb\\/08 14:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Army, those are good suggestions.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m intending to move ahead with final testing, cleanup, and commit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12573309_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573309_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/08 14:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-28T14:50:31+0000\'\u003e28\\/Feb\\/08 14:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Army, those are good suggestions. \\n\\n I\'m intending to move ahead with final testing, cleanup, and commit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12573585\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12573585&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12573585\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12573585_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573585_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Feb\\/08 04:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-29T04:22:32+0000\'\u003e29\\/Feb\\/08 04:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is sortExpressionsFinal.diff, which incorporates\u003cbr\\/\u003e\\nthe last few suggestions from reviews, as well as some\u003cbr\\/\u003e\\nadditional comments.\u003c\\/p\u003e\\n\\n\u003cp\u003ederbyall and junit-all were cleaning, so I\'m proceeding\u003cbr\\/\u003e\\nto commit this patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12573585_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573585_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Feb\\/08 04:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-29T04:22:32+0000\'\u003e29\\/Feb\\/08 04:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is sortExpressionsFinal.diff, which incorporates \\nthe last few suggestions from reviews, as well as some \\nadditional comments. \\n\\n derbyall and junit-all were cleaning, so I\'m proceeding \\nto commit this patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12573588\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12573588&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12573588\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12573588_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573588_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Feb\\/08 04:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-29T04:25:25+0000\'\u003e29\\/Feb\\/08 04:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted sortExpressionsFinal.diff to the trunk as revision 632221.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll investigate merging this change back to the 10.3 branch. Until then,\u003cbr\\/\u003e\\nI\'ll leave this issue open.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12573588_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12573588_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Feb\\/08 04:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-02-29T04:25:25+0000\'\u003e29\\/Feb\\/08 04:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed sortExpressionsFinal.diff to the trunk as revision 632221. \\n\\n I\'ll investigate merging this change back to the 10.3 branch. Until then, \\nI\'ll leave this issue open.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12574227\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-3094?focusedCommentId=12574227&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12574227\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12574227_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12574227_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/08 16:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-02T16:16:35+0000\'\u003e02\\/Mar\\/08 16:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI merged revision 632221 to the 10.3 branch without incident.\u003cbr\\/\u003e\\nMy build and test runs were clean, so I committed the\u003cbr\\/\u003e\\nchange to the 10.3 branch as revision 632779.\u003c\\/p\u003e\\n\\n\u003cp\u003eMarking the issue as resolved.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12574227_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12574227_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Mar\\/08 16:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2008-03-02T16:16:35+0000\'\u003e02\\/Mar\\/08 16:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I merged revision 632221 to the 10.3 branch without incident. \\nMy build and test runs were clean, so I committed the \\nchange to the 10.3 branch as revision 632779. \\n\\n Marking the issue as resolved.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520239163783"> 
    <input type="hidden" title="jira.request.server.time" value="295"> 
    <input type="hidden" title="jira.request.id" value="519x94381116x10"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="56"> 
    <input type="hidden" title="db.conns.time.in.ms" value="63"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 519x94381116x10
	          REQUEST TIMESTAMP : [05/Mar/2018:08:39:23 +0000]
	               REQUEST TIME : 0.2950
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=27, elapsedTotal=56034385, elapsedMin=355584, elapsedMax=23632672, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=31, elapsedTotal=63676528, elapsedMin=389157, elapsedMax=23660893, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>