<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|c2375c73ddeea53c54006ada30d6b61ac9d61af4|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"3a825c942a2a09\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-4100"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-4100] Maxscore - Efficient Scoring - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-4100] Maxscore - Efficient Scoring - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-4100">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-4100" href="/jira/browse/LUCENE-4100" id="key-val" rel="12559049">LUCENE-4100</a></li>
                </ol>
                <h1 id="summary-val">Maxscore - Efficient Scoring</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-4100"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-4100/LUCENE-4100.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-4100/LUCENE-4100.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-4100/LUCENE-4100.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-4100/LUCENE-4100.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+%22master+%288.0%29%22" title="master (8.0) Current unstable dev">master (8.0)</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Fcodecs%22" title="core/codecs issues with Codecs code">core/codecs</a>, <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Fquery%2Fscoring%22" title="core/query/scoring issues related/isolated to a Query implementation, including Spans">core/query/scoring</a>, <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Fsearch%22" title="core/search issues with search code">core/search</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <ul class="labels" id="labels-12559049-value"> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+api-change" title="api-change"><span>api-change</span></a></li> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+gsoc2014" title="gsoc2014"><span>gsoc2014</span></a></li> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+patch" title="patch"><span>patch</span></a></li> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+performance" title="performance"><span>performance</span></a></li> 
                    </ul> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span>, 
                        <span>Patch Available</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>At Berlin Buzzwords 2012, I will be presenting 'maxscore', an efficient algorithm first published in the IR domain in 1995 by H. Turtle &amp; J. Flood, that I find deserves more attention among Lucene users (and developers).<br> I implemented a proof of concept and did some performance measurements with example queries and lucenebench, the package of Mike McCandless, resulting in very significant speedups.</p> 
                  <p>This ticket is to get started the discussion on including the implementation into Lucene's codebase. Because the technique requires awareness about it from the Lucene user/developer, it seems best to become a contrib/module package so that it consciously can be chosen to be used.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-4100?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-4100?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-4100?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-4100?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12530651" data-issue-id="12559049" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12530651/contrib_maxscore.tgz" draggable="true" data-downloadurl="application/x-compressed-tar:contrib_maxscore.tgz:https://issues.apache.org/jira/secure/attachment/12530651/contrib_maxscore.tgz"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12530651/contrib_maxscore.tgz" title="Latest  02/Jun/12 15:47 - Stefan Pohl" draggable="true" data-downloadurl="application/x-compressed-tar:contrib_maxscore.tgz:https://issues.apache.org/jira/secure/attachment/12530651/contrib_maxscore.tgz">contrib_maxscore.tgz</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-02T15:47:52.835Z">02/Jun/12 15:47</time>
                   </dd>
                   <dd class="attachment-size">
                    26 kB
                   </dd>
                   <dd class="attachment-author">
                    Stefan Pohl
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12900042" data-issue-id="12559049" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12900042/LUCENE-4100.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4100.patch:https://issues.apache.org/jira/secure/attachment/12900042/LUCENE-4100.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12900042/LUCENE-4100.patch" title="Latest  30/Nov/17 15:00 - Adrien Grand" draggable="true" data-downloadurl="text/x-patch:LUCENE-4100.patch:https://issues.apache.org/jira/secure/attachment/12900042/LUCENE-4100.patch">LUCENE-4100.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-11-30T15:00:13.700Z">30/Nov/17 15:00</time>
                   </dd>
                   <dd class="attachment-size">
                    445 kB
                   </dd>
                   <dd class="attachment-author">
                    Adrien Grand
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12893706" data-issue-id="12559049" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12893706/LUCENE-4100.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4100.patch:https://issues.apache.org/jira/secure/attachment/12893706/LUCENE-4100.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12893706/LUCENE-4100.patch" title=" 24/Oct/17 08:41 - Adrien Grand" draggable="true" data-downloadurl="text/x-patch:LUCENE-4100.patch:https://issues.apache.org/jira/secure/attachment/12893706/LUCENE-4100.patch">LUCENE-4100.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-10-24T08:41:28.936Z">24/Oct/17 08:41</time>
                   </dd>
                   <dd class="attachment-size">
                    440 kB
                   </dd>
                   <dd class="attachment-author">
                    Adrien Grand
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12891744" data-issue-id="12559049" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12891744/LUCENE-4100.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4100.patch:https://issues.apache.org/jira/secure/attachment/12891744/LUCENE-4100.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12891744/LUCENE-4100.patch" title=" 12/Oct/17 15:39 - Adrien Grand" draggable="true" data-downloadurl="text/x-patch:LUCENE-4100.patch:https://issues.apache.org/jira/secure/attachment/12891744/LUCENE-4100.patch">LUCENE-4100.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-10-12T15:39:06.970Z">12/Oct/17 15:39</time>
                   </dd>
                   <dd class="attachment-size">
                    407 kB
                   </dd>
                   <dd class="attachment-author">
                    Adrien Grand
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12891228" data-issue-id="12559049" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12891228/LUCENE-4100.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-4100.patch:https://issues.apache.org/jira/secure/attachment/12891228/LUCENE-4100.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12891228/LUCENE-4100.patch" title=" 10/Oct/17 09:32 - Adrien Grand" draggable="true" data-downloadurl="text/x-patch:LUCENE-4100.patch:https://issues.apache.org/jira/secure/attachment/12891228/LUCENE-4100.patch">LUCENE-4100.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-10-10T09:32:52.003Z">10/Oct/17 09:32</time>
                   </dd>
                   <dd class="attachment-size">
                    20 kB
                   </dd>
                   <dd class="attachment-author">
                    Adrien Grand
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12530652" data-issue-id="12559049" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12530652/maxscore.patch" draggable="true" data-downloadurl="text/x-patch:maxscore.patch:https://issues.apache.org/jira/secure/attachment/12530652/maxscore.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12530652/maxscore.patch" title="Latest  02/Jun/12 15:47 - Stefan Pohl" draggable="true" data-downloadurl="text/x-patch:maxscore.patch:https://issues.apache.org/jira/secure/attachment/12530652/maxscore.patch">maxscore.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-02T15:47:52.845Z">02/Jun/12 15:47</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Stefan Pohl
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-13110149_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Wish - General wishlist item." alt="Wish - General wishlist item."> <span title="LUCENE-7996: Should we require positive scores?"> <a href="/jira/browse/LUCENE-7996" data-issue-key="LUCENE-7996" class="issue-link link-title resolution">LUCENE-7996</a> <span class="link-summary">Should we require positive scores?</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="view-subtasks" class="module toggle-wrap">
               <div id="view-subtasks_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="subtask-view-options" class="aui-list-section aui-first aui-last">
                     <li class="aui-list-item"><a id="subtasks-show-all" href="/jira/browse/LUCENE-4100?subTaskView=all#issuetable" class="aui-list-checked aui-checked aui-list-item-link" title="Show All"><span>Show All</span></a></li>
                     <li class="aui-list-item"><a id="subtasks-show-open" href="/jira/browse/LUCENE-4100?subTaskView=unresolved#issuetable" class="aui-list-checked aui-list-item-link" title="Show Open"><span>Show Open</span></a></li>
                     <li class="aui-list-item"><a id="subtasks-bulk-operation" href="/jira/issue/bulkedit/BulkEdit1!default.jspa?reset=true&amp;searchParent=LUCENE-4100" class="aui-list-checked aui-list-item-link" title="Bulk operation"><span>Bulk operation</span></a></li>
                     <li class="aui-list-item"><a id="subtasks-open-issue-navigator" href="/jira/issues/?jql=parent%3DLUCENE-4100" class="aui-list-checked aui-list-item-link" title="Open issue navigator"><span>Open issue navigator</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Sub-Tasks</h2>
               </div>
               <div class="mod-content">
                <div class="mod-content intform subtask-table-container"> 
                 <issuetable-web-component> 
                  <table id="issuetable"> 
                   <tbody>
                    <tr id="issuerow12597647" rel="12597647" data-issuekey="LUCENE-4198" class="issuerow"> 
                     <td class="stsequence">
                      <div rel="0">
                       1.
                      </div> </td> 
                     <td class="stsummary"><a class="issue-link" data-issue-key="LUCENE-4198" href="/jira/browse/LUCENE-4198">Allow codecs to index term impacts</a></td> 
                     <td class="issuetype"> <a class="issue-link" data-issue-key="LUCENE-4198" href="/jira/browse/LUCENE-4198"> <img src="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21146&amp;avatarType=issuetype" height="16" width="16" border="0" align="absmiddle" alt="Sub-task" title="Sub-task - The sub-task of the issue"> </a> </td> 
                     <td class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </td> 
                     <td class="assignee"> <em>Unassigned</em> </td> 
                    </tr> 
                   </tbody> 
                  </table> 
                 </issuetable-web-component> 
                 <div class="end-of-stable-message"></div> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10453"></span></span> Unassigned </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_spo" rel="spo" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Stefan Pohl&quot;,&quot;emailAddress&quot;:&quot;spohl.mail@gmail.com&quot;,&quot;username&quot;:&quot;spo&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="spo"></span></span> Stefan Pohl </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">8</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">17</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="02/Jun/12 15:38"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-06-02T15:38:54+0000">02/Jun/12 15:38</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="19/Dec/17 10:25"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2017-12-19T10:25:10+0000">19/Dec/17 10:25</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="19/Dec/17 10:25"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2017-12-19T10:25:10+0000">19/Dec/17 10:25</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4100?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4100?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13287963\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13287963&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13287963\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13287963_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13287963_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Jun\\/12 15:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-02T15:47:52+0000\'\u003e02\\/Jun\\/12 15:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Stefan Pohl - 02\\/Jun\\/12 15:49\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is a tarball that includes maxscore code (to be unpacked in \\/lucene\\/contrib\\/), and a patch that integrates it into core Lucene (for now, basis for both is Lucene40 trunk r1300967).\u003c\\/p\u003e\\n\\n\u003cp\u003eFrom the README, included in the tarball:\u003cbr\\/\u003e\\nThis contrib package implements the \'maxscore\' optimization, orginally presented by in the IR domain in 1995 by H. Turtle &amp; J. Flood.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you\'d like to play with this implementation, for instance, to estimate its usefulness for your kind of queries and index data, follow these steps:\u003cbr\\/\u003e\\n1) Build a normal Lucene40 index with your data\u003cbr\\/\u003e\\n2) Rewrite this index using the main method of the class\u003cbr\\/\u003e\\n   org.apache.lucene.index.IndexRewriter\u003cbr\\/\u003e\\n   with source and destination directories as arguments. This class will iterate over your index segments, parse them, compute a maxscore for each term using collection statistics of the source index and write them to the destination directory using the Lucene40Maxscore codec. The resulting index should be slightly bigger. Currently, Lucene\'s DefaultSimilarity will be used to estimate maxscores, meaning that this has to be the Similarity used at querying time for maxscore to be effective.\u003cbr\\/\u003e\\n3) Apply the patch to a checkout of Lucene4 trunk revision 1300967 and place the maxscore code directory below \\/lucene\\/contrib\\/.\u003cbr\\/\u003e\\n4) After the patch, there should be the required logic in org.apache.lucene.search.BooleanQuery to use the MaxscoreScorer on the index in 2) when the index is searched as usual:\u003c\\/p\u003e\\n\\n\u003cp\u003e   int topk = 10;\u003cbr\\/\u003e\\n   searcher.setSimilarity(new DefaultSimilarity());\u003cbr\\/\u003e\\n   Query q = queryparser.parse(\\\"t1 t2 t3 t4\\\");\u003cbr\\/\u003e\\n   MaxscoreDocCollector ms_coll = new MaxscoreDocCollector(topk);\u003cbr\\/\u003e\\n   searcher.search(q, ms_coll);\u003c\\/p\u003e\\n\\n\u003cp\u003eNote:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eYour index at 1) does not have to be \'optimized\' (it does not have to consist of one index segment only). In fact, maxscore can be more efficient with multiple segments because multiple maxscores are computed for many frequent terms for subsets of documents, resulting in tighter bounds and more effective pruning.\u003c\\/li\u003e\\n\\t\u003cli\u003eDon\'t expect totalHits to return the same counts as before. MaxscoreDocCollector sole purpose is to notify you about this by throwing an exception when you try to use the getter.\u003c\\/li\u003e\\n\\t\u003cli\u003eCurrently, purely disjunctive, flat queries are supported\u003c\\/li\u003e\\n\\t\u003cli\u003eDefaultSimilarity tested only\u003c\\/li\u003e\\n\\t\u003cli\u003e@experimental !\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13287963_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13287963_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Jun\\/12 15:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-02T15:47:52+0000\'\u003e02\\/Jun\\/12 15:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Stefan Pohl - 02\\/Jun\\/12 15:49\\\"\u003eedited\u003c\\/span\u003e                   Attached is a tarball that includes maxscore code (to be unpacked in \\/lucene\\/contrib\\/), and a patch that integrates it into core Lucene (for now, basis for both is Lucene40 trunk r1300967). \\n\\n From the README, included in the tarball: \\nThis contrib package implements the \'maxscore\' optimization, orginally presented by in the IR domain in 1995 by H. Turtle &amp; J. Flood. \\n\\n If you\'d like to play with this implementation, for instance, to estimate its usefulness for your kind of queries and index data, follow these steps: \\n1) Build a normal Lucene40 index with your data \\n2) Rewrite this index using the main method of the class \\n   org.apache.lucene.index.IndexRewriter \\n   with source and destination directories as arguments. This class will iterate over your index segments, parse them, compute a maxscore for each term using collection statistics of the source index and write them to the destination directory using the Lucene40Maxscore codec. The resulting index should be slightly bigger. Currently, Lucene\'s DefaultSimilarity will be used to estimate maxscores, meaning that this has to be the Similarity used at querying time for maxscore to be effective. \\n3) Apply the patch to a checkout of Lucene4 trunk revision 1300967 and place the maxscore code directory below \\/lucene\\/contrib\\/. \\n4) After the patch, there should be the required logic in org.apache.lucene.search.BooleanQuery to use the MaxscoreScorer on the index in 2) when the index is searched as usual: \\n\\n    int topk = 10; \\n   searcher.setSimilarity(new DefaultSimilarity()); \\n   Query q = queryparser.parse(\\\"t1 t2 t3 t4\\\"); \\n   MaxscoreDocCollector ms_coll = new MaxscoreDocCollector(topk); \\n   searcher.search(q, ms_coll); \\n\\n Note: \\n \\n\\t Your index at 1) does not have to be \'optimized\' (it does not have to consist of one index segment only). In fact, maxscore can be more efficient with multiple segments because multiple maxscores are computed for many frequent terms for subsets of documents, resulting in tighter bounds and more effective pruning. \\n\\t Don\'t expect totalHits to return the same counts as before. MaxscoreDocCollector sole purpose is to notify you about this by throwing an exception when you try to use the getter. \\n\\t Currently, purely disjunctive, flat queries are supported \\n\\t DefaultSimilarity tested only \\n\\t @experimental ! \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13406992\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13406992&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13406992\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13406992_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13406992_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/12 11:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-05T11:11:22+0000\'\u003e05\\/Jul\\/12 11:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHello, thank you for working on this! \u003c\\/p\u003e\\n\\n\u003cp\u003eI have just taken a rough glance at the code, and think we should probably look at what API changes would make \u003cbr\\/\u003e\\nthis sort of thing fit better into Lucene and it easier to implement.\u003c\\/p\u003e\\n\\n\u003cp\u003eRandom thoughts:\u003c\\/p\u003e\\n\\n\u003cp\u003eSpecifically: what you are doing in the PostingsWriter is similar to computing impacts (I don\'t have a copy of\u003cbr\\/\u003e\\nthe paper so admittedly don\'t know the exact algorithm you are using). But it seems to me that you are putting \u003cbr\\/\u003e\\na maxScore in the term dictionary metadata for all of the terms postings (as a float).\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the tool you provide, this works because you have access to e.g. the segment\'s length normalization information\u003cbr\\/\u003e\\netc (your postingswriter takes a reader). But we would have to think about how to give postingswriters access to this \u003cbr\\/\u003e\\non flush... it seems possible to me though.\u003c\\/p\u003e\\n\\n\u003cp\u003eGiving the postingswriter full statistics (e.g. docfreq) for Similarity computation seems difficult: while I think\u003cbr\\/\u003e\\nwe could accum this stuff in FreqProxTermsWriter before we flush to the codec, it wouldn\'t solve the problem at merge time,\u003cbr\\/\u003e\\nso you would have to do a 2-pass merge in the codec somehow...\u003c\\/p\u003e\\n\\n\u003cp\u003eBut the alternative of splitting the \\\"impact\\\" (tf\\/norm) from the document-independent weight (e.g. IDF) isn\'t that pretty\u003cbr\\/\u003e\\neither, because it limits the scoring systems (Similarity implementations) that could use the optimization.\u003c\\/p\u003e\\n\\n\u003cp\u003eas many terms will be low frequency (e.g. docfreq=1), i think its not\u003cbr\\/\u003e\\nworth it to encode the maxscore for these low freq terms: we could save space by omitting maxscore for low freq terms \u003cbr\\/\u003e\\nand just treat it as infinitely large?\u003c\\/p\u003e\\n\\n\u003cp\u003ethe opposite problem: is it really optimal to encode maxscore for the entire term? or would it be better for high-freq\u003cbr\\/\u003e\\nterms to encode maxScore for a range of postings (e.g. block). This way, you could skip over ranges of postings that cannot\u003cbr\\/\u003e\\ncompete (rather than limiting the optimization to an entire term). A codec could put this information into a block header,\u003cbr\\/\u003e\\nor at certain intervals, into the skip data, etc.\u003c\\/p\u003e\\n\\n\u003cp\u003edo we really need a full 4-byte float? How well would the algorithm work with degraded precision: e.g. something like\u003cbr\\/\u003e\\nSmallFloat. (I think this SmallFloat currently computes a lower bound, we would have to bump to the next byte to make an upper bound).\u003c\\/p\u003e\\n\\n\u003cp\u003eanother idea: it might be nice if this optimization could sit underneath the codec, such that you dont need a special\u003cbr\\/\u003e\\nScorer. One idea here would be for your collector to set an attribute on the DocsEnum (maxScore): of course a normal\u003cbr\\/\u003e\\ncodec would totally ignore this and proceed as today. But codecs like this one could return NO_MORE_DOCS when postings\u003cbr\\/\u003e\\nfor that term can no longer compete. I\'m just not positive if this algorithm can be refactored in this way, and this\u003cbr\\/\u003e\\nwould also require some clean way of getting these attributes from Collector -&gt; Scorer -&gt; DocsEnum. Currently Scorer\u003cbr\\/\u003e\\nis in the way here \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eJust some random thoughts, I\'ll try to get a copy of this paper so I have a better idea whats going on with this particular\u003cbr\\/\u003e\\noptimization...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13406992_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13406992_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/12 11:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-05T11:11:22+0000\'\u003e05\\/Jul\\/12 11:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hello, thank you for working on this!  \\n\\n I have just taken a rough glance at the code, and think we should probably look at what API changes would make  \\nthis sort of thing fit better into Lucene and it easier to implement. \\n\\n Random thoughts: \\n\\n Specifically: what you are doing in the PostingsWriter is similar to computing impacts (I don\'t have a copy of \\nthe paper so admittedly don\'t know the exact algorithm you are using). But it seems to me that you are putting  \\na maxScore in the term dictionary metadata for all of the terms postings (as a float). \\n\\n With the tool you provide, this works because you have access to e.g. the segment\'s length normalization information \\netc (your postingswriter takes a reader). But we would have to think about how to give postingswriters access to this  \\non flush... it seems possible to me though. \\n\\n Giving the postingswriter full statistics (e.g. docfreq) for Similarity computation seems difficult: while I think \\nwe could accum this stuff in FreqProxTermsWriter before we flush to the codec, it wouldn\'t solve the problem at merge time, \\nso you would have to do a 2-pass merge in the codec somehow... \\n\\n But the alternative of splitting the \\\"impact\\\" (tf\\/norm) from the document-independent weight (e.g. IDF) isn\'t that pretty \\neither, because it limits the scoring systems (Similarity implementations) that could use the optimization. \\n\\n as many terms will be low frequency (e.g. docfreq=1), i think its not \\nworth it to encode the maxscore for these low freq terms: we could save space by omitting maxscore for low freq terms  \\nand just treat it as infinitely large? \\n\\n the opposite problem: is it really optimal to encode maxscore for the entire term? or would it be better for high-freq \\nterms to encode maxScore for a range of postings (e.g. block). This way, you could skip over ranges of postings that cannot \\ncompete (rather than limiting the optimization to an entire term). A codec could put this information into a block header, \\nor at certain intervals, into the skip data, etc. \\n\\n do we really need a full 4-byte float? How well would the algorithm work with degraded precision: e.g. something like \\nSmallFloat. (I think this SmallFloat currently computes a lower bound, we would have to bump to the next byte to make an upper bound). \\n\\n another idea: it might be nice if this optimization could sit underneath the codec, such that you dont need a special \\nScorer. One idea here would be for your collector to set an attribute on the DocsEnum (maxScore): of course a normal \\ncodec would totally ignore this and proceed as today. But codecs like this one could return NO_MORE_DOCS when postings \\nfor that term can no longer compete. I\'m just not positive if this algorithm can be refactored in this way, and this \\nwould also require some clean way of getting these attributes from Collector -&gt; Scorer -&gt; DocsEnum. Currently Scorer \\nis in the way here   \\n\\n Just some random thoughts, I\'ll try to get a copy of this paper so I have a better idea whats going on with this particular \\noptimization...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13407472\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13407472&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13407472\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13407472_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13407472_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/12 20:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-05T20:46:19+0000\'\u003e05\\/Jul\\/12 20:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI spun off a sub-issue (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4198\\\" title=\\\"Allow codecs to index term impacts\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4198\\\"\u003eLUCENE-4198\u003c\\/a\u003e) to see how we can first fix this Codec API so that\u003cbr\\/\u003e\\nyou don\'t need an IndexRewriter and this patch could work \\\"live\\\".\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13407472_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13407472_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/12 20:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-05T20:46:19+0000\'\u003e05\\/Jul\\/12 20:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I spun off a sub-issue ( LUCENE-4198 ) to see how we can first fix this Codec API so that \\nyou don\'t need an IndexRewriter and this patch could work \\\"live\\\".              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13412304\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13412304&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13412304\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13412304_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13412304_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 23:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T23:03:45+0000\'\u003e11\\/Jul\\/12 23:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebulk cleanup of 4.0-ALPHA \\/ 4.0 Jira versioning. all bulk edited issues have hoss20120711-bulk-40-change in a comment\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13412304_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13412304_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 23:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T23:03:45+0000\'\u003e11\\/Jul\\/12 23:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bulk cleanup of 4.0-ALPHA \\/ 4.0 Jira versioning. all bulk edited issues have hoss20120711-bulk-40-change in a comment              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13413055\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13413055&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13413055\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13413055_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13413055_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jul\\/12 18:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-12T18:34:04+0000\'\u003e12\\/Jul\\/12 18:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eYour index at 1) does not have to be \'optimized\' (it does not have to consist of one index segment only). In fact, maxscore can be more efficient with multiple segments because multiple maxscores are computed for many frequent terms for subsets of documents, resulting in tighter bounds and more effective pruning.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'ve been thinking about this a lot lately: while what you say is true, thats because you reprocess all segments with IndexRewriter (which is fine for a static collection).\u003c\\/p\u003e\\n\\n\u003cp\u003eBut this algorithm in general is not rank safe with incremental indexing: the problem is that when doing actual scoring,\u003cbr\\/\u003e\\nscores consist of per-segment\\/within document stats (term frequency, document length), but also are affected by collection-wide\u003cbr\\/\u003e\\nstatistics from many other segments (IDF, average document length, ...) or even machines in a distributed collection.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I think for this to work and remain rank-safe, we cannot write the entire score into the segment, because the score\u003cbr\\/\u003e\\nat actual search time is dependent on all the other segments being searched. Instead I think this can only work when\u003cbr\\/\u003e\\nwe can easily factor out an impact (e.g. in the case of DefaultSimilarity the indexed maxscore excludes the IDF component,\u003cbr\\/\u003e\\nthis is instead multiplied in at search time).\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t see how it can be rank-safe with algorithms like BM25 and incremental indexing, where parameters like average document\u003cbr\\/\u003e\\nlength are not simple multiplicative factors into the formula: and determine exactly how important tf versus document length play\u003cbr\\/\u003e\\na role in the score, but I\'ll think about it some more.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13413055_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13413055_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jul\\/12 18:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-12T18:34:04+0000\'\u003e12\\/Jul\\/12 18:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Your index at 1) does not have to be \'optimized\' (it does not have to consist of one index segment only). In fact, maxscore can be more efficient with multiple segments because multiple maxscores are computed for many frequent terms for subsets of documents, resulting in tighter bounds and more effective pruning.  \\n\\n I\'ve been thinking about this a lot lately: while what you say is true, thats because you reprocess all segments with IndexRewriter (which is fine for a static collection). \\n\\n But this algorithm in general is not rank safe with incremental indexing: the problem is that when doing actual scoring, \\nscores consist of per-segment\\/within document stats (term frequency, document length), but also are affected by collection-wide \\nstatistics from many other segments (IDF, average document length, ...) or even machines in a distributed collection. \\n\\n So I think for this to work and remain rank-safe, we cannot write the entire score into the segment, because the score \\nat actual search time is dependent on all the other segments being searched. Instead I think this can only work when \\nwe can easily factor out an impact (e.g. in the case of DefaultSimilarity the indexed maxscore excludes the IDF component, \\nthis is instead multiplied in at search time). \\n\\n I don\'t see how it can be rank-safe with algorithms like BM25 and incremental indexing, where parameters like average document \\nlength are not simple multiplicative factors into the formula: and determine exactly how important tf versus document length play \\na role in the score, but I\'ll think about it some more.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13413246\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13413246&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13413246\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13413246_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13413246_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jul\\/12 21:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-12T21:33:42+0000\'\u003e12\\/Jul\\/12 21:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the feedback! You\'re on spot with everything you\'re saying.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, the methods as suggested in the different papers have (semi-)static indexes in mind, that is, such that batch-index many new documents, then recompute maxscores (hence, IndexRewriter) and roll out the new version of the indexes. This is a Lucene use-case common to many large installations (or part thereof) and as such important. Moreover, this approach can easily be generalized to the other Similarities, without that they necessarily have to know about maxscore, and can be simplified by some minor API changes within Lucene. The PoC code as-is might be of help to showcase dependencies in general, and such that currently are not well supported within Lucene (because there was no need for it yet).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you really want to go the full distance: I already thought about doing maxscore live and got some ideas in this regard, see below.\u003c\\/p\u003e\\n\\n\u003cp\u003eComments to your thoughts:\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;PostingsWriter&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nYou\'re right. For simplicity, I was computing each term\'s overall contribution (as explained in the talk), including all but query-dependent factors. You can consider this as un-quantized impacts (in the sense of Anh et al.) which necessitates a second pass over a static index, hence IndexRewriter.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs a side note: I noticed a drop in the PKLookup benchmark, suggesting that it might be better not to extend the size of dictionary items, but to store maxscores in the beginning of inverted lists, or next to skip data. This effect should be smaller or disappear though when maxscores are not stored for many terms.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;Length normalization&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nYes, this might be a necessary dependency. It should be a general design-principle though to have as many as possible statistics at hand everywhere, as long as it doesn\'t hurt performance in terms of efficiency.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;splitting impacts \\/ incremental indexing&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nYes, this would be more intrusive, requiring Similarity-dependent maxscore computations. Here is how it could work:\u003cbr\\/\u003e\\nVery exotic scoring functions simply don\'t have to support maxscore and will thus fall back to the current score-all behaviour.\u003cbr\\/\u003e\\nDefaultSimilarity is simple, but BM25 and LMDirichlet can\'t as easily be factored out, as you correctly point out, but we could come up with bounds for collection statistics (those that go into the score) within which it is safe to use maxscore, otherwise we fallback to score-all until a merge occurs, or we notify the user to better do a merge\\/optimize, or Lucene does a segment-rewrite with new maxscore and bound computations on basis of more current collection stats. I got first ideas for an algorithm to compute these bounds.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;docfreq=1 treatment&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nDefinitely agree. Possibly, terms with docfreq &lt; x=10? could not store a maxscore. x configurable and default to be evaluated; x should be stored in index so that it can be determined which terms don\'t contain maxscores.\u003cbr\\/\u003e\\nHaving a special treatment for these terms (not considering them for exclusion within the algorithm) allows for easier exchange of the core of the algorithm to get the WAND algorithm, or also to ignore a maxscore for a term for which collection stats went out of bounds.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;maxscores per posting ranges&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\n+1. As indicated in the description, having multiple maxscores per term can be more efficient, possibly leading to tighter bounds and more skipping. Chakrabarti\'11 opted for one extreme, computing a maxscore for each compressed posting block, whereas the optimal choice might have been a multiple of blocks, or a postings range not well aligned with block size.\u003cbr\\/\u003e\\nOptimal choice will be very dependent on skip list implementation and its parameters, but also posting de-compression overhead.\u003cbr\\/\u003e\\nThe question is how to get access to this codec-dependent information inside of the scoring algorithm, tunneled through the TermQuery?\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;store &lt;4 bytes per maxscore&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nPossible. As long as the next higher representable real number is stored (ceil, not floor), no docs will be missed and the algorithm remains correct. But because of more loose bounds the efficiency gain will be affected at some point with too few bits.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf the score is anyway factored out, it might be better to simply store all document-dependent stats (TF, doclen) of the document with the maximum score contribution (as ints) instead of one aggregate intermediate float score contribution.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;implementation inside codec&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nPlease be aware that while terms are at some point excluded from merging, they still are advanced to the docs in other lists to gain complete document knowledge and compute exact scores. Maxscores can also be used to minimize how often this happens, but the gains are often compensated by the more complex scoring. Still having to skip inside of excluded terms complicates your suggested implementation. But we definitely should consider architecture alternatives. The MaxscoreCollector, for instance, does currently only have a user interface function, keeping track of the top-k and their entry threshold could well be done inside the Maxscorer.\u003cbr\\/\u003e\\nI was thinking though to extend the MaxscoreCollector to provide different scoring information, e.g. an approximation of the number of hits next to the actual number of scored documents (currently totalHits).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13413246_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13413246_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jul\\/12 21:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-12T21:33:42+0000\'\u003e12\\/Jul\\/12 21:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the feedback! You\'re on spot with everything you\'re saying. \\n\\n Yes, the methods as suggested in the different papers have (semi-)static indexes in mind, that is, such that batch-index many new documents, then recompute maxscores (hence, IndexRewriter) and roll out the new version of the indexes. This is a Lucene use-case common to many large installations (or part thereof) and as such important. Moreover, this approach can easily be generalized to the other Similarities, without that they necessarily have to know about maxscore, and can be simplified by some minor API changes within Lucene. The PoC code as-is might be of help to showcase dependencies in general, and such that currently are not well supported within Lucene (because there was no need for it yet). \\n\\n If you really want to go the full distance: I already thought about doing maxscore live and got some ideas in this regard, see below. \\n\\n Comments to your thoughts: \\n\\n  &#91;PostingsWriter&#93;  \\nYou\'re right. For simplicity, I was computing each term\'s overall contribution (as explained in the talk), including all but query-dependent factors. You can consider this as un-quantized impacts (in the sense of Anh et al.) which necessitates a second pass over a static index, hence IndexRewriter. \\n\\n As a side note: I noticed a drop in the PKLookup benchmark, suggesting that it might be better not to extend the size of dictionary items, but to store maxscores in the beginning of inverted lists, or next to skip data. This effect should be smaller or disappear though when maxscores are not stored for many terms. \\n\\n  &#91;Length normalization&#93;  \\nYes, this might be a necessary dependency. It should be a general design-principle though to have as many as possible statistics at hand everywhere, as long as it doesn\'t hurt performance in terms of efficiency. \\n\\n  &#91;splitting impacts \\/ incremental indexing&#93;  \\nYes, this would be more intrusive, requiring Similarity-dependent maxscore computations. Here is how it could work: \\nVery exotic scoring functions simply don\'t have to support maxscore and will thus fall back to the current score-all behaviour. \\nDefaultSimilarity is simple, but BM25 and LMDirichlet can\'t as easily be factored out, as you correctly point out, but we could come up with bounds for collection statistics (those that go into the score) within which it is safe to use maxscore, otherwise we fallback to score-all until a merge occurs, or we notify the user to better do a merge\\/optimize, or Lucene does a segment-rewrite with new maxscore and bound computations on basis of more current collection stats. I got first ideas for an algorithm to compute these bounds. \\n\\n  &#91;docfreq=1 treatment&#93;  \\nDefinitely agree. Possibly, terms with docfreq &lt; x=10? could not store a maxscore. x configurable and default to be evaluated; x should be stored in index so that it can be determined which terms don\'t contain maxscores. \\nHaving a special treatment for these terms (not considering them for exclusion within the algorithm) allows for easier exchange of the core of the algorithm to get the WAND algorithm, or also to ignore a maxscore for a term for which collection stats went out of bounds. \\n\\n  &#91;maxscores per posting ranges&#93;  \\n+1. As indicated in the description, having multiple maxscores per term can be more efficient, possibly leading to tighter bounds and more skipping. Chakrabarti\'11 opted for one extreme, computing a maxscore for each compressed posting block, whereas the optimal choice might have been a multiple of blocks, or a postings range not well aligned with block size. \\nOptimal choice will be very dependent on skip list implementation and its parameters, but also posting de-compression overhead. \\nThe question is how to get access to this codec-dependent information inside of the scoring algorithm, tunneled through the TermQuery? \\n\\n  &#91;store &lt;4 bytes per maxscore&#93;  \\nPossible. As long as the next higher representable real number is stored (ceil, not floor), no docs will be missed and the algorithm remains correct. But because of more loose bounds the efficiency gain will be affected at some point with too few bits. \\n\\n If the score is anyway factored out, it might be better to simply store all document-dependent stats (TF, doclen) of the document with the maximum score contribution (as ints) instead of one aggregate intermediate float score contribution. \\n\\n  &#91;implementation inside codec&#93;  \\nPlease be aware that while terms are at some point excluded from merging, they still are advanced to the docs in other lists to gain complete document knowledge and compute exact scores. Maxscores can also be used to minimize how often this happens, but the gains are often compensated by the more complex scoring. Still having to skip inside of excluded terms complicates your suggested implementation. But we definitely should consider architecture alternatives. The MaxscoreCollector, for instance, does currently only have a user interface function, keeping track of the top-k and their entry threshold could well be done inside the Maxscorer. \\nI was thinking though to extend the MaxscoreCollector to provide different scoring information, e.g. an approximation of the number of hits next to the actual number of scored documents (currently totalHits).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13413335\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13413335&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13413335\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13413335_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13413335_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jul\\/12 23:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-12T23:48:12+0000\'\u003e12\\/Jul\\/12 23:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eAs a side note: I noticed a drop in the PKLookup benchmark, suggesting that it might be better not to extend the size of dictionary items, but to store maxscores in the beginning of inverted lists, or next to skip data. This effect should be smaller or disappear though when maxscores are not stored for many terms.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI wouldn\'t worry about this, I noticed a few things that might speed that up:\u003c\\/p\u003e\\n\\n\u003cp\u003e1. Currently it does writeVInt(Float.floatToIntBits(term.maxscoreScore)) . But I think this should be writeInt, not writeVInt?\u003cbr\\/\u003e\\nSo I think currently we often write 5 bytes here, with all the vint checks for each byte, and as an Int it would always be 4 and faster.\u003cbr\\/\u003e\\n2. Yes, with low freq terms (e.g. docFreq &lt; skipMinimum), its probably best to just omit this at both read and write time. Then PK lookup would be fine.\u003cbr\\/\u003e\\n3. As far as &lt; 4 bytes ceiling, my motivation there was not to save in the term dictionary, but instead to make these smaller and allow us to add these at regular intervals. We can take advantage of a few things, e.g. it should never be a negative number for a \u003cbr\\/\u003e\\nwell-formed Similarity (i think that would screw up the algorithm looking at your tests anyway).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eDefaultSimilarity is simple, but BM25 and LMDirichlet can\'t as easily be factored out, as you correctly point out, but we could come up with bounds for collection statistics (those that go into the score) within which it is safe to use maxscore, otherwise we fallback to score-all until a merge occurs, or we notify the user to better do a merge\\/optimize, or Lucene does a segment-rewrite with new maxscore and bound computations on basis of more current collection stats. I got first ideas for an algorithm to compute these bounds.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOk, I\'m not sure I totally see how the bounds computation can work, but if it can we might be ok in general. If the different segments are somewhat homogeneous then these stats should pretty much be very close anyway.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe other idea i had was more intrusive, adding a computeImpact() etc to Similarity or whatever.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eIf the score is anyway factored out, it might be better to simply store all document-dependent stats (TF, doclen) of the document with the maximum score contribution (as ints) instead of one aggregate intermediate float score contribution.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat might be a good idea. with TF as a vint and doclen as a byte, we would typically only have two bytes but not actually lose any information (by default, all these sims encode doclen as a byte anyway).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;implementation inside codec&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\nPlease be aware that while terms are at some point excluded from merging, they still are advanced to the docs in other lists to gain complete document knowledge and compute exact scores. Maxscores can also be used to minimize how often this happens, but the gains are often compensated by the more complex scoring. Still having to skip inside of excluded terms complicates your suggested implementation. But we definitely should consider architecture alternatives. The MaxscoreCollector, for instance, does currently only have a user interface function, keeping track of the top-k and their entry threshold could well be done inside the Maxscorer.\u003cbr\\/\u003e\\nI was thinking though to extend the MaxscoreCollector to provide different scoring information, e.g. an approximation of the number of hits next to the actual number of scored documents (currently totalHits).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMy current line of thinking is even crazier, but I don\'t yet have anything close to a plan.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs a start, I do think that IndexSearcher.search() methods should take a \\\"Score Mode\\\" of sorts from the user (some enum), which would allow Lucene to do less work if its not necessary. We would pass this down via Weight.scorer() as a parameter... solely\u003cbr\\/\u003e\\nlooking at the search side I think this would open up opportunities in general for us to optimize things: e.g. instantiate the appropriate Collector impl, and for Weights to create the most optimal Scorers. Not yet sure how it would tie into the code API.\u003c\\/p\u003e\\n\\n\u003cp\u003eI started hacking up on a prototype that looks like this (I might have tried to refactor too hard also shoving the Sort options in here...)\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e\\/**\\n * Different modes of search.\\n *\\/\\npublic enum ScoreMode {\\n  \\/** \\n   * No guarantees that the ranking is correct,\\n   * the results may come back in a different order than if all\\n   * documents were actually scored. Total hit count may be \\n   * unavailable or approximate.\\n   *\\/\\n  APPROXIMATE,\\n  \\/** \\n   * Ranking is the same as {@link COMPLETE}, but total hit \\n   * count may be unavailable or approximate.\\n   *\\/\\n  SAFE,\\n  \\/**\\n   * Guarantees complete iteration over all documents, but scores\\n   * may be unavailable.\\n   *\\/\\n  COMPLETE_NO_SCORES,\\n  \\/**\\n   * Guarantees complete iteration over all documents, and scores\\n   * will be computed, but the maximum score may be unavailable \\n   *\\/\\n  COMPLETE_NO_MAX_SCORE,\\n  \\/**\\n   * Guarantees complete iteration and scoring of all documents.\\n   *\\/\\n  COMPLETE,\\n};\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13413335_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13413335_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jul\\/12 23:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-12T23:48:12+0000\'\u003e12\\/Jul\\/12 23:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n As a side note: I noticed a drop in the PKLookup benchmark, suggesting that it might be better not to extend the size of dictionary items, but to store maxscores in the beginning of inverted lists, or next to skip data. This effect should be smaller or disappear though when maxscores are not stored for many terms.  \\n\\n I wouldn\'t worry about this, I noticed a few things that might speed that up: \\n\\n 1. Currently it does writeVInt(Float.floatToIntBits(term.maxscoreScore)) . But I think this should be writeInt, not writeVInt? \\nSo I think currently we often write 5 bytes here, with all the vint checks for each byte, and as an Int it would always be 4 and faster. \\n2. Yes, with low freq terms (e.g. docFreq &lt; skipMinimum), its probably best to just omit this at both read and write time. Then PK lookup would be fine. \\n3. As far as &lt; 4 bytes ceiling, my motivation there was not to save in the term dictionary, but instead to make these smaller and allow us to add these at regular intervals. We can take advantage of a few things, e.g. it should never be a negative number for a  \\nwell-formed Similarity (i think that would screw up the algorithm looking at your tests anyway). \\n\\n \\n DefaultSimilarity is simple, but BM25 and LMDirichlet can\'t as easily be factored out, as you correctly point out, but we could come up with bounds for collection statistics (those that go into the score) within which it is safe to use maxscore, otherwise we fallback to score-all until a merge occurs, or we notify the user to better do a merge\\/optimize, or Lucene does a segment-rewrite with new maxscore and bound computations on basis of more current collection stats. I got first ideas for an algorithm to compute these bounds.  \\n\\n Ok, I\'m not sure I totally see how the bounds computation can work, but if it can we might be ok in general. If the different segments are somewhat homogeneous then these stats should pretty much be very close anyway. \\n\\n The other idea i had was more intrusive, adding a computeImpact() etc to Similarity or whatever. \\n\\n \\n If the score is anyway factored out, it might be better to simply store all document-dependent stats (TF, doclen) of the document with the maximum score contribution (as ints) instead of one aggregate intermediate float score contribution.  \\n\\n That might be a good idea. with TF as a vint and doclen as a byte, we would typically only have two bytes but not actually lose any information (by default, all these sims encode doclen as a byte anyway). \\n\\n \\n  &#91;implementation inside codec&#93;  \\nPlease be aware that while terms are at some point excluded from merging, they still are advanced to the docs in other lists to gain complete document knowledge and compute exact scores. Maxscores can also be used to minimize how often this happens, but the gains are often compensated by the more complex scoring. Still having to skip inside of excluded terms complicates your suggested implementation. But we definitely should consider architecture alternatives. The MaxscoreCollector, for instance, does currently only have a user interface function, keeping track of the top-k and their entry threshold could well be done inside the Maxscorer. \\nI was thinking though to extend the MaxscoreCollector to provide different scoring information, e.g. an approximation of the number of hits next to the actual number of scored documents (currently totalHits).  \\n\\n My current line of thinking is even crazier, but I don\'t yet have anything close to a plan. \\n\\n As a start, I do think that IndexSearcher.search() methods should take a \\\"Score Mode\\\" of sorts from the user (some enum), which would allow Lucene to do less work if its not necessary. We would pass this down via Weight.scorer() as a parameter... solely \\nlooking at the search side I think this would open up opportunities in general for us to optimize things: e.g. instantiate the appropriate Collector impl, and for Weights to create the most optimal Scorers. Not yet sure how it would tie into the code API. \\n\\n I started hacking up on a prototype that looks like this (I might have tried to refactor too hard also shoving the Sort options in here...) \\n  \\n \\/**\\n * Different modes of search.\\n *\\/\\npublic enum ScoreMode {\\n  \\/** \\n   * No guarantees that the ranking is correct,\\n   * the results may come back in a different order than if all\\n   * documents were actually scored. Total hit count may be \\n   * unavailable or approximate.\\n   *\\/\\n  APPROXIMATE,\\n  \\/** \\n   * Ranking is the same as {@link COMPLETE}, but total hit \\n   * count may be unavailable or approximate.\\n   *\\/\\n  SAFE,\\n  \\/**\\n   * Guarantees complete iteration over all documents, but scores\\n   * may be unavailable.\\n   *\\/\\n  COMPLETE_NO_SCORES,\\n  \\/**\\n   * Guarantees complete iteration over all documents, and scores\\n   * will be computed, but the maximum score may be unavailable \\n   *\\/\\n  COMPLETE_NO_MAX_SCORE,\\n  \\/**\\n   * Guarantees complete iteration and scoring of all documents.\\n   *\\/\\n  COMPLETE,\\n};\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13429696\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13429696&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13429696\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13429696_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13429696_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/12 03:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-07T03:41:21+0000\'\u003e07\\/Aug\\/12 03:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ermuir20120906-bulk-40-change\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13429696_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13429696_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/12 03:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-07T03:41:21+0000\'\u003e07\\/Aug\\/12 03:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    rmuir20120906-bulk-40-change              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13540741\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13540741&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13540741\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13540741_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13540741_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Dec\\/12 03:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-29T03:18:30+0000\'\u003e29\\/Dec\\/12 03:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eStefan, this sounds exciting.  What sort of speedups did you get?  Are you still looking to include this into Lucene (4.1)?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13540741_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13540741_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Dec\\/12 03:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-29T03:18:30+0000\'\u003e29\\/Dec\\/12 03:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Stefan, this sounds exciting.  What sort of speedups did you get?  Are you still looking to include this into Lucene (4.1)?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13542058\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13542058&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13542058\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13542058_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13542058_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Jan\\/13 08:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-02T08:38:53+0000\'\u003e02\\/Jan\\/13 08:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOtis, thank you for your interest and I wish everyone a happy New Year!\u003c\\/p\u003e\\n\\n\u003cp\u003eRegarding speedups, have a look at \u003ca href=\\\"http:\\/\\/vimeo.com\\/44300228\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/vimeo.com\\/44300228\u003c\\/a\u003e from 12 minutes onwards. It obviously depends on your mix of queries and collection size, but on average more than 100% should be achievable for large collections and typical query sets, and much higher speedups for problem queries (many frequent terms).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe contribution as-is (after adaptation to latest Lucene API\\/code-base) could already be included as a separate Lucene module for people to use who can live with its current limitations (for static indexes only, smaller totalHitCount).\u003cbr\\/\u003e\\nIn my spare time (unfortunately not much of that recently), I continue working on different approaches to make this more general, but this is pure experimentation and any production-ready offspring of that will take longer than 4.x and might require API changes (such as the ones suggested above by Robert), so perhaps 5.0 is a good aim.\u003c\\/p\u003e\\n\\n\u003cp\u003eI suggest to continue rolling this ticket forward, or only attach version 5.0 to it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13542058_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13542058_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Jan\\/13 08:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-02T08:38:53+0000\'\u003e02\\/Jan\\/13 08:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Otis, thank you for your interest and I wish everyone a happy New Year! \\n\\n Regarding speedups, have a look at  http:\\/\\/vimeo.com\\/44300228  from 12 minutes onwards. It obviously depends on your mix of queries and collection size, but on average more than 100% should be achievable for large collections and typical query sets, and much higher speedups for problem queries (many frequent terms). \\n\\n The contribution as-is (after adaptation to latest Lucene API\\/code-base) could already be included as a separate Lucene module for people to use who can live with its current limitations (for static indexes only, smaller totalHitCount). \\nIn my spare time (unfortunately not much of that recently), I continue working on different approaches to make this more general, but this is pure experimentation and any production-ready offspring of that will take longer than 4.x and might require API changes (such as the ones suggested above by Robert), so perhaps 5.0 is a good aim. \\n\\n I suggest to continue rolling this ticket forward, or only attach version 5.0 to it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13717004\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13717004&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13717004\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_13717004_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13717004_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jul\\/13 18:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-23T18:44:37+0000\'\u003e23\\/Jul\\/13 18:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBulk move 4.4 issues to 4.5 and 5.0\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_13717004_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13717004_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jul\\/13 18:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-23T18:44:37+0000\'\u003e23\\/Jul\\/13 18:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Bulk move 4.4 issues to 4.5 and 5.0              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13831784\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13831784&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13831784\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"daubman\\\" id=\\\"commentauthor_13831784_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=daubman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"daubman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Aaron Daubman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13831784_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Nov\\/13 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-25T19:03:07+0000\'\u003e25\\/Nov\\/13 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\" class=\\\"user-hover\\\" rel=\\\"spo\\\"\u003eStefan Pohl\u003c\\/a\u003e Stefan, I am curious if there has been any continued work on this? I know early this year you mentioned there hasn\'t been much time to work on it. It sounds very promising to me, so I hope it does not bit-rot! =)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"daubman\\\" id=\\\"commentauthor_13831784_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=daubman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"daubman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Aaron Daubman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13831784_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Nov\\/13 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-25T19:03:07+0000\'\u003e25\\/Nov\\/13 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Stefan Pohl  Stefan, I am curious if there has been any continued work on this? I know early this year you mentioned there hasn\'t been much time to work on it. It sounds very promising to me, so I hope it does not bit-rot! =)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13832677\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13832677&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13832677\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13832677_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13832677_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Nov\\/13 15:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-26T15:45:29+0000\'\u003e26\\/Nov\\/13 15:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThere is at least one step we made for the codec API (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-5123\\\" title=\\\"invert the codec postings API\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-5123\\\"\u003e\u003cdel\u003eLUCENE-5123\u003c\\/del\u003e\u003c\\/a\u003e) that might make it easier: the codec has the freedom to \\\"pull\\\" the data rather than push it now, so it can more easily calculate interesting things that it wants.\u003c\\/p\u003e\\n\\n\u003cp\u003eStill, there remains some fairly major challenges in my eyes:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003ehow to safely implement the optimization for dynamic indexes: See Stefan\'s note above. I do agree there are use cases for static indexes, the problem is: its lucene, people will try to use it with dynamic indexes regardless.\u003c\\/li\u003e\\n\\t\u003cli\u003ehow to connect such optimizations in a fairly clean way to the scoring api. This is perhaps the hardest part. There is a lot of separation between the scoring API (e.g. pluggable similarity, Scorer, etc) and the codec API.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eBut i don\'t want to discourage anyone, just saying its probably even more difficult from an API perspective than the stuff to support something \\\"different\\\" like BooleanScorer.java.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13832677_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13832677_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Nov\\/13 15:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-26T15:45:29+0000\'\u003e26\\/Nov\\/13 15:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    There is at least one step we made for the codec API (  LUCENE-5123  ) that might make it easier: the codec has the freedom to \\\"pull\\\" the data rather than push it now, so it can more easily calculate interesting things that it wants. \\n\\n Still, there remains some fairly major challenges in my eyes: \\n \\n\\t how to safely implement the optimization for dynamic indexes: See Stefan\'s note above. I do agree there are use cases for static indexes, the problem is: its lucene, people will try to use it with dynamic indexes regardless. \\n\\t how to connect such optimizations in a fairly clean way to the scoring api. This is perhaps the hardest part. There is a lot of separation between the scoring API (e.g. pluggable similarity, Scorer, etc) and the codec API. \\n \\n\\n\\n But i don\'t want to discourage anyone, just saying its probably even more difficult from an API perspective than the stuff to support something \\\"different\\\" like BooleanScorer.java.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13833573\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13833573&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13833573\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13833573_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13833573_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/13 08:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-27T08:21:47+0000\'\u003e27\\/Nov\\/13 08:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for your interest, \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=daubman\\\" class=\\\"user-hover\\\" rel=\\\"daubman\\\"\u003eAaron Daubman\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\" class=\\\"user-hover\\\" rel=\\\"rcmuir\\\"\u003eRobert Muir\u003c\\/a\u003e accurately describes the current status and challenges here. There have to be made quite a few major and even more minor steps to eventually arrive at anything general-purpose and user-ready.\u003cbr\\/\u003e\\nHowever, given the feedback that I got so far (there seem to be many people that don\'t have extremely high NRT-requirements and who rebuild their whole indexes every few hours\\/days anyways), I still think that it would be worthwhile to have this as-is (with the limitation to static indexes) in a separate contrib-package that users are discouraged to use, except they really know what they are doing. Adding a few exceptions to guard users from wrong behaviour\\/misusage might also be useful.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs long as I, as the reporter, don\'t close the issue, it won\'t \'bite rot\', don\'t worry \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e I also got to hear of quite some interest when I mentioned it at this year\'s Lucene\\/Solr-Revolutions.EU conference.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13833573_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13833573_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/13 08:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-27T08:21:47+0000\'\u003e27\\/Nov\\/13 08:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for your interest,  Aaron Daubman . \\n\\n  Robert Muir  accurately describes the current status and challenges here. There have to be made quite a few major and even more minor steps to eventually arrive at anything general-purpose and user-ready. \\nHowever, given the feedback that I got so far (there seem to be many people that don\'t have extremely high NRT-requirements and who rebuild their whole indexes every few hours\\/days anyways), I still think that it would be worthwhile to have this as-is (with the limitation to static indexes) in a separate contrib-package that users are discouraged to use, except they really know what they are doing. Adding a few exceptions to guard users from wrong behaviour\\/misusage might also be useful. \\n\\n As long as I, as the reporter, don\'t close the issue, it won\'t \'bite rot\', don\'t worry   I also got to hear of quite some interest when I mentioned it at this year\'s Lucene\\/Solr-Revolutions.EU conference.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13833812\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13833812&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13833812\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"daubman\\\" id=\\\"commentauthor_13833812_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=daubman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"daubman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Aaron Daubman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13833812_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/13 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-27T13:53:21+0000\'\u003e27\\/Nov\\/13 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the update \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\" class=\\\"user-hover\\\" rel=\\\"spo\\\"\u003eStefan Pohl\u003c\\/a\u003e - My particular use-case seems tailor made for this. I have several decently large (10-30G indices) solr instances, all of which run in read-only mode and are created ~2x a day via a snapshot process that rolls the index out to load-balanced servers. Several of these instances routinely match 30-80% (custom MLT-like queries) of the 2-25M docs in the index per-query, so efficient scoring would be a huge win here.\u003c\\/p\u003e\\n\\n\u003cp\u003eI already have to patch and custom-build solr for our use (until I get around to creating required tests to haver \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2052\\\" title=\\\"Allow for a list of filter queries and a single docset filter in QueryComponent\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2052\\\"\u003eSOLR-2052\u003c\\/a\u003e accepted) and am wondering if you have any thoughts\\/guidance on trying out your patch?\u003c\\/p\u003e\\n\\n\u003cp\u003eThe main use-case is from a custom extension of QueryComponent that overrides perpare() and essentially builds up a custom boosted boolean query and uses rb.setQueryString and rb.setFilters...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"daubman\\\" id=\\\"commentauthor_13833812_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=daubman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"daubman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Aaron Daubman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13833812_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Nov\\/13 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-27T13:53:21+0000\'\u003e27\\/Nov\\/13 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the update  Stefan Pohl  - My particular use-case seems tailor made for this. I have several decently large (10-30G indices) solr instances, all of which run in read-only mode and are created ~2x a day via a snapshot process that rolls the index out to load-balanced servers. Several of these instances routinely match 30-80% (custom MLT-like queries) of the 2-25M docs in the index per-query, so efficient scoring would be a huge win here. \\n\\n I already have to patch and custom-build solr for our use (until I get around to creating required tests to haver  SOLR-2052  accepted) and am wondering if you have any thoughts\\/guidance on trying out your patch? \\n\\n The main use-case is from a custom extension of QueryComponent that overrides perpare() and essentially builds up a custom boosted boolean query and uses rb.setQueryString and rb.setFilters...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13837654\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13837654&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13837654\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13837654_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13837654_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Dec\\/13 13:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-03T13:06:40+0000\'\u003e03\\/Dec\\/13 13:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Aaron,\u003cbr\\/\u003e\\nI can\'t say much about any possible complications Solr might add here, but if you can get your index building and submitting some test queries code compile with the SVN-revision mentioned above (some almost 4.0 revision), and you\'re fine with the current limitations mentioned above (DefaultSimilarity, flat queries = BooleanQuery of TermQueries) you can simply try it out. The patch should cleanly apply and be functional.\u003cbr\\/\u003e\\nIt also shouldn\'t be too hard to upgrade the code to newer Lucene versions that use BlockPostingsFormat (4.1) and the new pull-based codec API (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-5123\\\" title=\\\"invert the codec postings API\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-5123\\\"\u003e\u003cdel\u003eLUCENE-5123\u003c\\/del\u003e\u003c\\/a\u003e).\u003c\\/p\u003e\\n\\n\u003cp\u003eEither way, it would be very interesting to hear of speedups with respect to MLT-like-queries.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"spo\\\" id=\\\"commentauthor_13837654_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=spo\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"spo\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stefan Pohl\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13837654_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Dec\\/13 13:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-12-03T13:06:40+0000\'\u003e03\\/Dec\\/13 13:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Aaron, \\nI can\'t say much about any possible complications Solr might add here, but if you can get your index building and submitting some test queries code compile with the SVN-revision mentioned above (some almost 4.0 revision), and you\'re fine with the current limitations mentioned above (DefaultSimilarity, flat queries = BooleanQuery of TermQueries) you can simply try it out. The patch should cleanly apply and be functional. \\nIt also shouldn\'t be too hard to upgrade the code to newer Lucene versions that use BlockPostingsFormat (4.1) and the new pull-based codec API (  LUCENE-5123  ). \\n\\n Either way, it would be very interesting to hear of speedups with respect to MLT-like-queries.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13934226\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13934226&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13934226\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13934226_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13934226_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Mar\\/14 22:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-13T22:31:10+0000\'\u003e13\\/Mar\\/14 22:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch seems almost 2 years old.\u003cbr\\/\u003e\\nWould it make sense to label this for GSoC?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13934226_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13934226_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Mar\\/14 22:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-13T22:31:10+0000\'\u003e13\\/Mar\\/14 22:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch seems almost 2 years old. \\nWould it make sense to label this for GSoC?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13936440\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13936440&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13936440\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rowanto\\\" id=\\\"commentauthor_13936440_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rowanto\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rowanto\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rowanto Rowanto\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13936440_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/14 05:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-16T05:47:44+0000\'\u003e16\\/Mar\\/14 05:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi,\u003c\\/p\u003e\\n\\n\u003cp\u003ethank you for your email. Unfortunately, I\'m not in the office until 4. April 2014.\u003cbr\\/\u003e\\nPlease contact my team for important issue.\u003cbr\\/\u003e\\nZX-BER-DG-DevTeam-Gold@zanox.com\u003c\\/p\u003e\\n\\n\u003cp\u003eI apologize for the inconvenient it might have caused.\u003cbr\\/\u003e\\nThank you for your understanding.\u003c\\/p\u003e\\n\\n\u003cp\u003eRowanto\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rowanto\\\" id=\\\"commentauthor_13936440_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rowanto\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rowanto\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rowanto Rowanto\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13936440_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/14 05:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-16T05:47:44+0000\'\u003e16\\/Mar\\/14 05:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, \\n\\n thank you for your email. Unfortunately, I\'m not in the office until 4. April 2014. \\nPlease contact my team for important issue. \\nZX-BER-DG-DevTeam-Gold@zanox.com \\n\\n I apologize for the inconvenient it might have caused. \\nThank you for your understanding. \\n\\n Rowanto              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13970874\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=13970874&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13970874\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13970874_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13970874_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/14 12:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-16T12:54:46+0000\'\u003e16\\/Apr\\/14 12:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMove issue to Lucene 4.9.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13970874_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13970874_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/14 12:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-16T12:54:46+0000\'\u003e16\\/Apr\\/14 12:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Move issue to Lucene 4.9.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15192554\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=15192554&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15192554\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kamaci\\\" id=\\\"commentauthor_15192554_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kamaci\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10432\\\" alt=\\\"kamaci\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Furkan KAMACI\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15192554_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Mar\\/16 22:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-13T22:22:06+0000\'\u003e13\\/Mar\\/16 22:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI would like to apply this issue as aGSoC project if someone is volunteer for being a mentor.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kamaci\\\" id=\\\"commentauthor_15192554_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kamaci\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10432\\\" alt=\\\"kamaci\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Furkan KAMACI\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15192554_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Mar\\/16 22:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-03-13T22:22:06+0000\'\u003e13\\/Mar\\/16 22:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I would like to apply this issue as aGSoC project if someone is volunteer for being a mentor.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16136601\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16136601&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16136601\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16136601_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16136601_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/17 10:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-08-22T10:13:59+0000\'\u003e22\\/Aug\\/17 10:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ehow to safely implement the optimization for dynamic indexes: See Stefan\'s note above. I do agree there are use cases for static indexes, the problem is: its lucene, people will try to use it with dynamic indexes regardless\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMaybe BM25 is making our lives easier with this? Scores are bounded by \u003ctt\u003eIDF * (k1 + 1)\u003c\\/tt\u003e if I\'m not mistaken so we could use it to feed the MAXSCORE algorithm? It would not be as good as the initial patch since we are totally ignoring the range of values that the term frequency and document length may take but this would not require any index-time changes, does not require the index to be static and might already allow for good speedups if query terms have very different IDF values?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16136601_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16136601_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/17 10:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-08-22T10:13:59+0000\'\u003e22\\/Aug\\/17 10:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     how to safely implement the optimization for dynamic indexes: See Stefan\'s note above. I do agree there are use cases for static indexes, the problem is: its lucene, people will try to use it with dynamic indexes regardless  \\n\\n Maybe BM25 is making our lives easier with this? Scores are bounded by  IDF * (k1 + 1)  if I\'m not mistaken so we could use it to feed the MAXSCORE algorithm? It would not be as good as the initial patch since we are totally ignoring the range of values that the term frequency and document length may take but this would not require any index-time changes, does not require the index to be static and might already allow for good speedups if query terms have very different IDF values? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16198424\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16198424&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16198424\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16198424_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16198424_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Oct\\/17 09:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-10T09:37:50+0000\'\u003e10\\/Oct\\/17 09:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have been exploring how we could make this optimization a bit less inconvenient by not requiring that indices be static or codec-level changes, even though this might make the optimization a bit less efficient. Here is a patch that demonstrates the idea:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003e\u003ctt\u003eSimScorer.maxScore()\u003c\\/tt\u003e returns the maximum score that may be produced by SimScorer.score(). The BM25 impl returns \u003ctt\u003eIDF * (k1 + 1)\u003c\\/tt\u003e. POSITIVE_INFINITY is a fine return value in case a SimScorer doesn\'t have an upper bound on the produced scores.\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003ctt\u003eScorer.maxScore()\u003c\\/tt\u003e returns the maximum score that may be produced by Scorer.score(). For TermScorer, this method delegates to SimScorer.maxScore().\u003c\\/li\u003e\\n\\t\u003cli\u003e\u003ctt\u003eScorer.setMinCompetitiveScore(float)\u003c\\/tt\u003e is used to tell the scorer that documents that produce scores that are less than the given score \u003cem\u003emay\u003c\\/em\u003e safely be ignored. This method is called by TopScoreDocCollector whenever the top of the priority queue is updated. Scorer impls are free to ignore it.\u003c\\/li\u003e\\n\\t\u003cli\u003eThere is a new \u003ctt\u003eMaxScoreScorer\u003c\\/tt\u003e, which only works on pure disjunctions and is largely inspired from \u003ctt\u003eMinShouldMatchSumScorer\u003c\\/tt\u003e except that instead of ensuring that freq &gt;= minShouldMatch, it tries to ensure that sum_of_max_scores &gt;= minCompetitiveScore.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIt is largely untested, but luceneutil finds the same top docs with and without the patch so I expect it to not be completely broken (I had to disable the check that hit counts are the same since Maxscore doesn\'t give total hit counts). It yields interesting speedups on wikimedium10M, even for \u003ctt\u003eOrHighHigh\u003c\\/tt\u003e:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    TaskQPS baseline      StdDev   QPS patch      StdDev                Pct diff\\r\\n   HighTermDayOfYearSort      102.75      (4.8%)       57.26      (3.7%)  -44.3% ( -50% -  -37%)\\r\\n                 LowTerm      708.14      (5.0%)      696.51      (5.4%)   -1.6% ( -11% -    9%)\\r\\n              HighPhrase       68.06      (4.0%)       67.00      (3.7%)   -1.6% (  -8% -    6%)\\r\\n            HighSpanNear        2.84      (3.4%)        2.80      (3.6%)   -1.3% (  -7% -    5%)\\r\\n             MedSpanNear       24.12      (2.5%)       23.90      (2.6%)   -0.9% (  -5% -    4%)\\r\\n               MedPhrase       49.14      (2.8%)       48.81      (2.8%)   -0.7% (  -6% -    5%)\\r\\n             LowSpanNear       20.48      (2.8%)       20.36      (2.9%)   -0.6% (  -6% -    5%)\\r\\n               LowPhrase       24.11      (2.6%)       24.01      (2.5%)   -0.4% (  -5% -    4%)\\r\\n              AndHighMed      316.86      (2.7%)      315.66      (2.7%)   -0.4% (  -5% -    5%)\\r\\n                 MedTerm      334.25      (3.1%)      333.01      (3.2%)   -0.4% (  -6% -    6%)\\r\\n                 Respell      261.62      (3.4%)      260.86      (5.5%)   -0.3% (  -8% -    8%)\\r\\n             AndHighHigh       62.76      (2.2%)       62.59      (2.4%)   -0.3% (  -4% -    4%)\\r\\n                HighTerm       86.17      (3.9%)       86.24      (2.8%)    0.1% (  -6% -    6%)\\r\\n                  IntNRQ       15.03      (6.5%)       15.20      (5.2%)    1.1% (  -9% -   13%)\\r\\n         LowSloppyPhrase       99.72      (3.3%)      100.83      (3.3%)    1.1% (  -5% -    8%)\\r\\n                 Prefix3       34.06      (7.2%)       34.48      (5.0%)    1.3% ( -10% -   14%)\\r\\n                Wildcard      159.32      (8.4%)      161.37      (6.8%)    1.3% ( -12% -   18%)\\r\\n         MedSloppyPhrase       42.17      (3.2%)       42.81      (3.0%)    1.5% (  -4% -    7%)\\r\\n              AndHighLow     1059.03      (3.6%)     1075.73      (2.9%)    1.6% (  -4% -    8%)\\r\\n            OrNotHighLow     1774.47      (4.1%)     1805.36      (4.7%)    1.7% (  -6% -   10%)\\r\\n        HighSloppyPhrase       32.84      (4.0%)       33.46      (3.4%)    1.9% (  -5% -    9%)\\r\\n            OrNotHighMed      295.65      (6.4%)      309.03      (4.7%)    4.5% (  -6% -   16%)\\r\\n       HighTermMonthSort      227.22      (9.9%)      241.42      (8.7%)    6.2% ( -11% -   27%)\\r\\n           OrNotHighHigh       43.19      (3.2%)       48.56      (3.1%)   12.4% (   5% -   19%)\\r\\n            OrHighNotMed       93.61      (3.5%)      113.32      (4.8%)   21.1% (  12% -   30%)\\r\\n           OrHighNotHigh       13.58      (3.2%)       16.44      (4.9%)   21.1% (  12% -   30%)\\r\\n                  Fuzzy1      190.81      (5.2%)      236.11     (14.4%)   23.7% (   3% -   45%)\\r\\n            OrHighNotLow       68.12      (3.9%)       85.99      (6.1%)   26.2% (  15% -   37%)\\r\\n              OrHighHigh       37.43      (5.4%)       51.96      (5.0%)   38.8% (  26% -   52%)\\r\\n               OrHighMed       55.45      (5.2%)      130.78      (9.0%)  135.8% ( 115% -  158%)\\r\\n                  Fuzzy2       24.33      (4.6%)       81.51     (24.2%)  235.0% ( 197% -  276%)\\r\\n               OrHighLow       32.37      (4.4%)      451.34     (47.8%) 1294.2% (1189% - 1408%)\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eTODO:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003edocs, tests\u003c\\/li\u003e\\n\\t\u003cli\u003eAdd a \u003ctt\u003eboolean needsTotalHits\u003c\\/tt\u003e to \u003ctt\u003eQuery.createWeight\u003c\\/tt\u003e and \u003ctt\u003eCollector\u003c\\/tt\u003e similarly to the existing \u003ctt\u003eboolean needsScores\u003c\\/tt\u003e.\u003c\\/li\u003e\\n\\t\u003cli\u003eHow should we deal with TopDocs instances that don\'t have correct total hit counts? Set it to \u003ctt\u003e-1\u003c\\/tt\u003e? Or maybe \u003ctt\u003e-1 - num_collected_docs\u003c\\/tt\u003e so that users can get a lower bound of the number of matches?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eFollow-ups:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eRequire that scores are always positive or null so that such optimizations are easier to reason about and generalize in the future?\u003c\\/li\u003e\\n\\t\u003cli\u003eCall the \u003ctt\u003esetMinCompetitiveScore\u003c\\/tt\u003e API from \u003ctt\u003eTopFieldDocCollector\u003c\\/tt\u003e too when the first sort field is the score.\u003c\\/li\u003e\\n\\t\u003cli\u003ePropagate \u003ctt\u003eScorer.setMinCompetitiveScore(float)\u003c\\/tt\u003e whenever possible so that eg. filtered disjunctions could benefit from the optimization too.\u003c\\/li\u003e\\n\\t\u003cli\u003eImplement \u003ctt\u003eScorer.setMinCompetitiveScore(float)\u003c\\/tt\u003e on other scorers.\u003c\\/li\u003e\\n\\t\u003cli\u003eStore more metadata in order to be able to compute better higher bounds for the scores, like the maximum term frequency. Maybe even allow similarity-specific stats?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16198424_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16198424_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Oct\\/17 09:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-10T09:37:50+0000\'\u003e10\\/Oct\\/17 09:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have been exploring how we could make this optimization a bit less inconvenient by not requiring that indices be static or codec-level changes, even though this might make the optimization a bit less efficient. Here is a patch that demonstrates the idea: \\n \\n\\t  SimScorer.maxScore()  returns the maximum score that may be produced by SimScorer.score(). The BM25 impl returns  IDF * (k1 + 1) . POSITIVE_INFINITY is a fine return value in case a SimScorer doesn\'t have an upper bound on the produced scores. \\n\\t  Scorer.maxScore()  returns the maximum score that may be produced by Scorer.score(). For TermScorer, this method delegates to SimScorer.maxScore(). \\n\\t  Scorer.setMinCompetitiveScore(float)  is used to tell the scorer that documents that produce scores that are less than the given score  may  safely be ignored. This method is called by TopScoreDocCollector whenever the top of the priority queue is updated. Scorer impls are free to ignore it. \\n\\t There is a new  MaxScoreScorer , which only works on pure disjunctions and is largely inspired from  MinShouldMatchSumScorer  except that instead of ensuring that freq &gt;= minShouldMatch, it tries to ensure that sum_of_max_scores &gt;= minCompetitiveScore. \\n \\n\\n\\n It is largely untested, but luceneutil finds the same top docs with and without the patch so I expect it to not be completely broken (I had to disable the check that hit counts are the same since Maxscore doesn\'t give total hit counts). It yields interesting speedups on wikimedium10M, even for  OrHighHigh : \\n\\n  \\n                     TaskQPS baseline      StdDev   QPS patch      StdDev                Pct diff\\r\\n   HighTermDayOfYearSort      102.75      (4.8%)       57.26      (3.7%)  -44.3% ( -50% -  -37%)\\r\\n                 LowTerm      708.14      (5.0%)      696.51      (5.4%)   -1.6% ( -11% -    9%)\\r\\n              HighPhrase       68.06      (4.0%)       67.00      (3.7%)   -1.6% (  -8% -    6%)\\r\\n            HighSpanNear        2.84      (3.4%)        2.80      (3.6%)   -1.3% (  -7% -    5%)\\r\\n             MedSpanNear       24.12      (2.5%)       23.90      (2.6%)   -0.9% (  -5% -    4%)\\r\\n               MedPhrase       49.14      (2.8%)       48.81      (2.8%)   -0.7% (  -6% -    5%)\\r\\n             LowSpanNear       20.48      (2.8%)       20.36      (2.9%)   -0.6% (  -6% -    5%)\\r\\n               LowPhrase       24.11      (2.6%)       24.01      (2.5%)   -0.4% (  -5% -    4%)\\r\\n              AndHighMed      316.86      (2.7%)      315.66      (2.7%)   -0.4% (  -5% -    5%)\\r\\n                 MedTerm      334.25      (3.1%)      333.01      (3.2%)   -0.4% (  -6% -    6%)\\r\\n                 Respell      261.62      (3.4%)      260.86      (5.5%)   -0.3% (  -8% -    8%)\\r\\n             AndHighHigh       62.76      (2.2%)       62.59      (2.4%)   -0.3% (  -4% -    4%)\\r\\n                HighTerm       86.17      (3.9%)       86.24      (2.8%)    0.1% (  -6% -    6%)\\r\\n                  IntNRQ       15.03      (6.5%)       15.20      (5.2%)    1.1% (  -9% -   13%)\\r\\n         LowSloppyPhrase       99.72      (3.3%)      100.83      (3.3%)    1.1% (  -5% -    8%)\\r\\n                 Prefix3       34.06      (7.2%)       34.48      (5.0%)    1.3% ( -10% -   14%)\\r\\n                Wildcard      159.32      (8.4%)      161.37      (6.8%)    1.3% ( -12% -   18%)\\r\\n         MedSloppyPhrase       42.17      (3.2%)       42.81      (3.0%)    1.5% (  -4% -    7%)\\r\\n              AndHighLow     1059.03      (3.6%)     1075.73      (2.9%)    1.6% (  -4% -    8%)\\r\\n            OrNotHighLow     1774.47      (4.1%)     1805.36      (4.7%)    1.7% (  -6% -   10%)\\r\\n        HighSloppyPhrase       32.84      (4.0%)       33.46      (3.4%)    1.9% (  -5% -    9%)\\r\\n            OrNotHighMed      295.65      (6.4%)      309.03      (4.7%)    4.5% (  -6% -   16%)\\r\\n       HighTermMonthSort      227.22      (9.9%)      241.42      (8.7%)    6.2% ( -11% -   27%)\\r\\n           OrNotHighHigh       43.19      (3.2%)       48.56      (3.1%)   12.4% (   5% -   19%)\\r\\n            OrHighNotMed       93.61      (3.5%)      113.32      (4.8%)   21.1% (  12% -   30%)\\r\\n           OrHighNotHigh       13.58      (3.2%)       16.44      (4.9%)   21.1% (  12% -   30%)\\r\\n                  Fuzzy1      190.81      (5.2%)      236.11     (14.4%)   23.7% (   3% -   45%)\\r\\n            OrHighNotLow       68.12      (3.9%)       85.99      (6.1%)   26.2% (  15% -   37%)\\r\\n              OrHighHigh       37.43      (5.4%)       51.96      (5.0%)   38.8% (  26% -   52%)\\r\\n               OrHighMed       55.45      (5.2%)      130.78      (9.0%)  135.8% ( 115% -  158%)\\r\\n                  Fuzzy2       24.33      (4.6%)       81.51     (24.2%)  235.0% ( 197% -  276%)\\r\\n               OrHighLow       32.37      (4.4%)      451.34     (47.8%) 1294.2% (1189% - 1408%)\\r\\n \\n  \\n\\n TODO: \\n \\n\\t docs, tests \\n\\t Add a  boolean needsTotalHits  to  Query.createWeight  and  Collector  similarly to the existing  boolean needsScores . \\n\\t How should we deal with TopDocs instances that don\'t have correct total hit counts? Set it to  -1 ? Or maybe  -1 - num_collected_docs  so that users can get a lower bound of the number of matches? \\n \\n\\n\\n Follow-ups: \\n \\n\\t Require that scores are always positive or null so that such optimizations are easier to reason about and generalize in the future? \\n\\t Call the  setMinCompetitiveScore  API from  TopFieldDocCollector  too when the first sort field is the score. \\n\\t Propagate  Scorer.setMinCompetitiveScore(float)  whenever possible so that eg. filtered disjunctions could benefit from the optimization too. \\n\\t Implement  Scorer.setMinCompetitiveScore(float)  on other scorers. \\n\\t Store more metadata in order to be able to compute better higher bounds for the scores, like the maximum term frequency. Maybe even allow similarity-specific stats? \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16202135\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16202135&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16202135\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16202135_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16202135_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/17 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-12T15:50:13+0000\'\u003e12\\/Oct\\/17 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is a patch:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003emore docs and tests\u003c\\/li\u003e\\n\\t\u003cli\u003ereplaces needsScores with a SearchMode enum as suggested by Robert\u003c\\/li\u003e\\n\\t\u003cli\u003ethe MAXSCORE optimization work with top-level disjunctions and filtered disjunctions (FILTER or MUST_NOT)\u003c\\/li\u003e\\n\\t\u003cli\u003eTopScoreDocsCollector sets the totalHitCount to -1 when the optimization is used since the total hit count is unknown\u003c\\/li\u003e\\n\\t\u003cli\u003eMaxScoreScorer was changed to reason on integers rather than doubles to avoid floating-point arithmetic issues. To do that it scales all max scores into 0..2^16, rounding up when working on the max scores of sub clauses, and down when rounding the min competitive score in order to make sure to not miss matches (at the cost of potentially more false positives, but this is fine)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe patch is alreay huge (due to the needsScore\\/searchMode change mostly) so I wanted to do the strict minimum here for this feature to be useful, but we\'ll need follow-ups to make the optimization work with the paging collector, conjunctions that have more than one scoring clause, TopFieldCollector when the first sort field is the score, integrate it with IndexSearcher (currently you need to create the collector manually to use it), etc.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16202135_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16202135_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/17 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-12T15:50:13+0000\'\u003e12\\/Oct\\/17 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is a patch: \\n \\n\\t more docs and tests \\n\\t replaces needsScores with a SearchMode enum as suggested by Robert \\n\\t the MAXSCORE optimization work with top-level disjunctions and filtered disjunctions (FILTER or MUST_NOT) \\n\\t TopScoreDocsCollector sets the totalHitCount to -1 when the optimization is used since the total hit count is unknown \\n\\t MaxScoreScorer was changed to reason on integers rather than doubles to avoid floating-point arithmetic issues. To do that it scales all max scores into 0..2^16, rounding up when working on the max scores of sub clauses, and down when rounding the min competitive score in order to make sure to not miss matches (at the cost of potentially more false positives, but this is fine) \\n \\n\\n\\n The patch is alreay huge (due to the needsScore\\/searchMode change mostly) so I wanted to do the strict minimum here for this feature to be useful, but we\'ll need follow-ups to make the optimization work with the paging collector, conjunctions that have more than one scoring clause, TopFieldCollector when the first sort field is the score, integrate it with IndexSearcher (currently you need to create the collector manually to use it), etc.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16203051\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16203051&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16203051\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16203051_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203051_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 04:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T04:52:57+0000\'\u003e13\\/Oct\\/17 04:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan we avoid the ScoreMode.merge? This seems really, really confusing. In general I don\'t think we should support such merging in MultiCollector or anywhere else, we should simply throw exception if things are different.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the enum should be further revisited\\/simplified: essentially at the minimum it must capture 2 booleans from the user: whether scores are needed, and whether exact total hit count is needed. Perhaps instead of the enum two booleans would be easier for now.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t understand why we should set the totalHitCount to -1, vs setting to a useful approximation, like google. The user said they didn\'t need the exact total hit count, so it should be no surprise, and its a hell of a lot more useful than a negative number.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16203051_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203051_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 04:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T04:52:57+0000\'\u003e13\\/Oct\\/17 04:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can we avoid the ScoreMode.merge? This seems really, really confusing. In general I don\'t think we should support such merging in MultiCollector or anywhere else, we should simply throw exception if things are different. \\n\\n I think the enum should be further revisited\\/simplified: essentially at the minimum it must capture 2 booleans from the user: whether scores are needed, and whether exact total hit count is needed. Perhaps instead of the enum two booleans would be easier for now. \\n\\n I don\'t understand why we should set the totalHitCount to -1, vs setting to a useful approximation, like google. The user said they didn\'t need the exact total hit count, so it should be no surprise, and its a hell of a lot more useful than a negative number.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16203135\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16203135&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16203135\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16203135_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203135_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 07:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T07:01:30+0000\'\u003e13\\/Oct\\/17 07:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for looking!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eCan we avoid the ScoreMode.merge? This seems really, really confusing. In general I don\'t think we should support such merging in MultiCollector or anywhere else, we should simply throw exception if things are different.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe have been allowing it until now (by ORing the needsScores booleans) so I didn\'t want to break this behaviour. I can remove this method and make the logic contained in MultiCollector by essentially returning COMPLETE if any of the collectors\' score modes are different but I think failing would be surprising to many users and would probably need to be a 8.0 change if we decide to do it?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ePerhaps instead of the enum two booleans would be easier for now.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis is what I wanted to do first but I didn\'l like the fact that it would allow passing needsScores=false and needsTotalHits=false, which doesn\'t make sense. If you still prefer the two booleans approach despite this, I\'m happy to make the change.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI don\'t understand why we should set the totalHitCount to -1, vs setting to a useful approximation, like google. The user said they didn\'t need the exact total hit count, so it should be no surprise, and its a hell of a lot more useful than a negative number.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree with that statement, but how do we compute a good estimate? It sounds challenging as the number of collected documents might be much less than the actual number of hits while the cost of the scorer can be highly overestimated, eg. for phrase queries. Should I return the number of collected documents and add documentation that this is a lower bound of the total number of hits?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16203135_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203135_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 07:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T07:01:30+0000\'\u003e13\\/Oct\\/17 07:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for looking! \\n\\n  Can we avoid the ScoreMode.merge? This seems really, really confusing. In general I don\'t think we should support such merging in MultiCollector or anywhere else, we should simply throw exception if things are different.  \\n\\n We have been allowing it until now (by ORing the needsScores booleans) so I didn\'t want to break this behaviour. I can remove this method and make the logic contained in MultiCollector by essentially returning COMPLETE if any of the collectors\' score modes are different but I think failing would be surprising to many users and would probably need to be a 8.0 change if we decide to do it? \\n\\n  Perhaps instead of the enum two booleans would be easier for now.  \\n\\n This is what I wanted to do first but I didn\'l like the fact that it would allow passing needsScores=false and needsTotalHits=false, which doesn\'t make sense. If you still prefer the two booleans approach despite this, I\'m happy to make the change. \\n\\n  I don\'t understand why we should set the totalHitCount to -1, vs setting to a useful approximation, like google. The user said they didn\'t need the exact total hit count, so it should be no surprise, and its a hell of a lot more useful than a negative number.  \\n\\n I agree with that statement, but how do we compute a good estimate? It sounds challenging as the number of collected documents might be much less than the actual number of hits while the cost of the scorer can be highly overestimated, eg. for phrase queries. Should I return the number of collected documents and add documentation that this is a lower bound of the total number of hits?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16203384\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16203384&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16203384\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16203384_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203384_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 11:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T11:07:26+0000\'\u003e13\\/Oct\\/17 11:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eThis is what I wanted to do first but I didn\'l like the fact that it would allow passing needsScores=false and needsTotalHits=false, which doesn\'t make sense. If you still prefer the two booleans approach despite this, I\'m happy to make the change.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhy doesn\'t it make sense? If i do a query, sorting by reverse time (recency), and retrieve the top 20, then i don\'t need scores, why do i need an exact hit count too? I think an approximation would suffice.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI agree with that statement, but how do we compute a good estimate? It sounds challenging as the number of collected documents might be much less than the actual number of hits while the cost of the scorer can be highly overestimated, eg. for phrase queries. Should I return the number of collected documents and add documentation that this is a lower bound of the total number of hits?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think naively we want to base it on where we early terminate (as oppose to maxdoc) but i get the idea with many clauses. still, i think this estimate may be \\\"good enough\\\" because as you paginate, the estimate would get better?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16203384_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203384_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 11:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T11:07:26+0000\'\u003e13\\/Oct\\/17 11:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n This is what I wanted to do first but I didn\'l like the fact that it would allow passing needsScores=false and needsTotalHits=false, which doesn\'t make sense. If you still prefer the two booleans approach despite this, I\'m happy to make the change.  \\n\\n Why doesn\'t it make sense? If i do a query, sorting by reverse time (recency), and retrieve the top 20, then i don\'t need scores, why do i need an exact hit count too? I think an approximation would suffice. \\n\\n \\n I agree with that statement, but how do we compute a good estimate? It sounds challenging as the number of collected documents might be much less than the actual number of hits while the cost of the scorer can be highly overestimated, eg. for phrase queries. Should I return the number of collected documents and add documentation that this is a lower bound of the total number of hits?  \\n\\n I think naively we want to base it on where we early terminate (as oppose to maxdoc) but i get the idea with many clauses. still, i think this estimate may be \\\"good enough\\\" because as you paginate, the estimate would get better?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16203596\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16203596&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16203596\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16203596_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203596_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 13:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T13:58:46+0000\'\u003e13\\/Oct\\/17 13:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhy doesn\'t it make sense? If i do a query, sorting by reverse time (recency), and retrieve the top 20, then i don\'t need scores, why do i need an exact hit count too? I think an approximation would suffice.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSorry I wrote \u003ctt\u003eneedsTotalHits\u003c\\/tt\u003e because this is the option name I used on the TopScoreDocCollector factory method, but on the weight we\'d need something different. Because there are two situations in which you would need scores but not visit all matches:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003esorting by score\u003c\\/li\u003e\\n\\t\u003cli\u003esorting by a field (potentially with early-termination) then score\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eYet these cases are different since we can only apply MAXSCORE in the first case. So what we need is more something like \u003ctt\u003ecanSkipNonCompetitiveScores\u003c\\/tt\u003e but then this implies that \u003ctt\u003eneedsScores\u003c\\/tt\u003e is true, so there would be illegal combinations. Which is why I went with the enum.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI think naively we want to base it on where we early terminate (as oppose to maxdoc) but i get the idea with many clauses. still, i think this estimate may be \\\"good enough\\\" because as you paginate, the estimate would get better?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK I\'ll give this approach a go.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16203596_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203596_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 13:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T13:58:46+0000\'\u003e13\\/Oct\\/17 13:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Why doesn\'t it make sense? If i do a query, sorting by reverse time (recency), and retrieve the top 20, then i don\'t need scores, why do i need an exact hit count too? I think an approximation would suffice.  \\n\\n Sorry I wrote  needsTotalHits  because this is the option name I used on the TopScoreDocCollector factory method, but on the weight we\'d need something different. Because there are two situations in which you would need scores but not visit all matches: \\n \\n\\t sorting by score \\n\\t sorting by a field (potentially with early-termination) then score \\n \\n\\n\\n Yet these cases are different since we can only apply MAXSCORE in the first case. So what we need is more something like  canSkipNonCompetitiveScores  but then this implies that  needsScores  is true, so there would be illegal combinations. Which is why I went with the enum. \\n\\n  I think naively we want to base it on where we early terminate (as oppose to maxdoc) but i get the idea with many clauses. still, i think this estimate may be \\\"good enough\\\" because as you paginate, the estimate would get better?  \\n\\n OK I\'ll give this approach a go.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16203603\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16203603&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16203603\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16203603_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203603_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 14:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T14:03:55+0000\'\u003e13\\/Oct\\/17 14:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eSorry I wrote needsTotalHits because this is the option name I used on the TopScoreDocCollector factory method, but on the weight we\'d need something different. Because there are two situations in which you would need scores but not visit all matches:\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m not sure thats true. There is another case right? There is the current sorted-index case today, but you have to be a rocket scientist (custom collector) to use it. Surely the API should handle that case? (it should \\\"just work\\\" from indexsearcher). \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16203603_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203603_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 14:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T14:03:55+0000\'\u003e13\\/Oct\\/17 14:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Sorry I wrote needsTotalHits because this is the option name I used on the TopScoreDocCollector factory method, but on the weight we\'d need something different. Because there are two situations in which you would need scores but not visit all matches:  \\n\\n I\'m not sure thats true. There is another case right? There is the current sorted-index case today, but you have to be a rocket scientist (custom collector) to use it. Surely the API should handle that case? (it should \\\"just work\\\" from indexsearcher).               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16203676\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16203676&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16203676\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16203676_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203676_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T15:05:43+0000\'\u003e13\\/Oct\\/17 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, but this 3rd case is fine since it can be handled solely from the collector side, so we don\'t need to make weights aware of it?\u003c\\/p\u003e\\n\\n\u003cp\u003eIdeally we would not need another parameter on \u003ctt\u003eQuery.createWeight\u003c\\/tt\u003e for \u003ctt\u003eMAXSCORE\u003c\\/tt\u003e either, but the issue is that depending on whether you want to collect all hits or only the top-scoring ones, then we need different Scorer impls.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThere is the current sorted-index case today, but you have to be a rocket scientist (custom collector) to use it\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1 to fix it and bake support for early termination in TopFieldDocCollector.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16203676_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203676_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T15:05:43+0000\'\u003e13\\/Oct\\/17 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, but this 3rd case is fine since it can be handled solely from the collector side, so we don\'t need to make weights aware of it? \\n\\n Ideally we would not need another parameter on  Query.createWeight  for  MAXSCORE  either, but the issue is that depending on whether you want to collect all hits or only the top-scoring ones, then we need different Scorer impls. \\n\\n  There is the current sorted-index case today, but you have to be a rocket scientist (custom collector) to use it  \\n\\n +1 to fix it and bake support for early termination in TopFieldDocCollector.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16203693\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16203693&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16203693\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16203693_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203693_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 15:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T15:21:05+0000\'\u003e13\\/Oct\\/17 15:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eyeah, I think i am looking at it from the top-down (indexsearcher) vs bottom up (queries).\u003c\\/p\u003e\\n\\n\u003cp\u003eindexsearcher already knows if scores are needed (e.g. from the Sort), but there is no way to tell it that approximate total hit count is acceptable. If we can do that, then I think we can make the early termination case really easy for the sorted case, index order case, and also this maxscore case.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eIdeally we would not need another parameter on Query.createWeight for MAXSCORE either, but the issue is that depending on whether you want to collect all hits or only the top-scoring ones, then we need different Scorer impls.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ewe do? (genuine question). We added needsScores because previously scorers had to always be ready for you to \\\"lazily\\\" call score(), and this prevented scoring from doing much more interesting things up-front like caching whole bitsets, but is it really the case for maxScore? I\'m just asking because the new scorer here looks a hell of a lot like a disjunction scorer \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e If we truly need a different impl, we should maybe still think it thru because of stuff like setMinCompetitiveScore() method, which would make no sense except for that case. I do like that in your patch AssertingScorer checks all that stuff, but there it is a bit confusing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16203693_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203693_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 15:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T15:21:05+0000\'\u003e13\\/Oct\\/17 15:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    yeah, I think i am looking at it from the top-down (indexsearcher) vs bottom up (queries). \\n\\n indexsearcher already knows if scores are needed (e.g. from the Sort), but there is no way to tell it that approximate total hit count is acceptable. If we can do that, then I think we can make the early termination case really easy for the sorted case, index order case, and also this maxscore case. \\n\\n \\n Ideally we would not need another parameter on Query.createWeight for MAXSCORE either, but the issue is that depending on whether you want to collect all hits or only the top-scoring ones, then we need different Scorer impls.  \\n\\n we do? (genuine question). We added needsScores because previously scorers had to always be ready for you to \\\"lazily\\\" call score(), and this prevented scoring from doing much more interesting things up-front like caching whole bitsets, but is it really the case for maxScore? I\'m just asking because the new scorer here looks a hell of a lot like a disjunction scorer   If we truly need a different impl, we should maybe still think it thru because of stuff like setMinCompetitiveScore() method, which would make no sense except for that case. I do like that in your patch AssertingScorer checks all that stuff, but there it is a bit confusing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16203829\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16203829&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16203829\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16203829_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203829_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T16:44:43+0000\'\u003e13\\/Oct\\/17 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eindexsearcher already knows if scores are needed (e.g. from the Sort), but there is no way to tell it that approximate total hit count is acceptable. If we can do that, then I think we can make the early termination case really easy for the sorted case, index order case, and also this maxscore case.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1 We need to add a new \u003ctt\u003eboolean needsTotalHits\u003c\\/tt\u003e to the \u003ctt\u003esearch(Query, int)\u003c\\/tt\u003e and \u003ctt\u003esearch(Query, int, Sort)\u003c\\/tt\u003e methods.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ewe do? \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e I\'m just asking because the new scorer here looks a hell of a lot like a disjunction scorer\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWell it is a disjunction. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e Our regular disjunction scorer maintains a single heap and only looks at the \'top\' element and callso \u003ctt\u003eupdateTop\u003c\\/tt\u003e after calls to \u003ctt\u003enextDoc\u003c\\/tt\u003e or \u003ctt\u003eadvance\u003c\\/tt\u003e. If you want to be able to call \u003ctt\u003eadvance()\u003c\\/tt\u003e sometimes on low-scoring clauses even if only \u003ctt\u003enextDoc()\u003c\\/tt\u003e was called on the disjunction, you need to give it the ability to leave some scorers behind, as long as the sum of the max scores of scorers that are behind and scorers that are positioned on the current candidate is not greater than the minimum competitive score (otherwise you might be missing matches). This means you need to move scorers between at least 2 data-structures. In practice, we actually use 3 of them so that we can also easily differenciate scorers that are on the current candidate from scorers that are too advanced. Moving scorers between those data-structures has some overhead. For instance here is what I get when I benchmark the MaxScoreScorer against master\'s DisjunctionSumScorer (BS1 is disabled in both cases):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                    TaskQPS baseline      StdDev   QPS patch      StdDev                Pct diff\\r\\n   HighTermDayOfYearSort       33.34      (7.3%)       16.55      (2.6%)  -50.4% ( -56% -  -43%)\\r\\n              OrHighHigh       21.91      (4.1%)       12.36      (1.7%)  -43.6% ( -47% -  -39%)\\r\\n               OrHighLow       48.08      (4.0%)       29.27      (2.4%)  -39.1% ( -43% -  -34%)\\r\\n               OrHighMed       60.66      (4.0%)       39.32      (2.5%)  -35.2% ( -40% -  -29%)\\r\\n                  Fuzzy2      117.30      (7.1%)      101.36      (7.5%)  -13.6% ( -26% -    1%)\\r\\n                  Fuzzy1      238.83     (10.7%)      212.80      (7.3%)  -10.9% ( -26% -    7%)\\r\\n            OrHighNotLow       70.64      (3.4%)       66.82      (2.0%)   -5.4% ( -10% -    0%)\\r\\n            OrHighNotMed       65.59      (3.0%)       62.63      (1.6%)   -4.5% (  -8% -    0%)\\r\\n           OrNotHighHigh       34.55      (2.3%)       33.24      (1.1%)   -3.8% (  -6% -    0%)\\r\\n           OrHighNotHigh       48.98      (2.4%)       47.17      (1.4%)   -3.7% (  -7% -    0%)\\r\\n            OrNotHighMed      107.24      (2.1%)      103.40      (1.1%)   -3.6% (  -6% -    0%)\\r\\n                  IntNRQ       26.26     (11.5%)       25.64     (12.3%)   -2.3% ( -23% -   24%)\\r\\n              AndHighLow      879.33      (3.7%)      860.16      (3.3%)   -2.2% (  -8% -    4%)\\r\\n              AndHighMed      168.90      (1.7%)      165.48      (1.3%)   -2.0% (  -4% -    1%)\\r\\n              HighPhrase       20.08      (2.8%)       19.69      (2.7%)   -2.0% (  -7% -    3%)\\r\\n         MedSloppyPhrase       15.44      (1.7%)       15.15      (1.8%)   -1.9% (  -5% -    1%)\\r\\n             LowSpanNear       44.70      (2.1%)       43.88      (1.9%)   -1.8% (  -5% -    2%)\\r\\n               MedPhrase       52.07      (3.2%)       51.16      (3.1%)   -1.7% (  -7% -    4%)\\r\\n         LowSloppyPhrase      150.90      (1.5%)      148.62      (1.5%)   -1.5% (  -4% -    1%)\\r\\n            OrNotHighLow     1174.47      (3.6%)     1157.52      (4.1%)   -1.4% (  -8% -    6%)\\r\\n            HighSpanNear       38.46      (3.0%)       37.92      (2.4%)   -1.4% (  -6% -    4%)\\r\\n        HighSloppyPhrase       28.13      (2.4%)       27.76      (2.5%)   -1.3% (  -6% -    3%)\\r\\n               LowPhrase      131.67      (1.6%)      130.37      (2.0%)   -1.0% (  -4% -    2%)\\r\\n             MedSpanNear       54.75      (3.4%)       54.22      (3.0%)   -1.0% (  -7% -    5%)\\r\\n                Wildcard       41.58      (5.1%)       41.23      (5.2%)   -0.8% ( -10% -    9%)\\r\\n             AndHighHigh       71.08      (1.5%)       70.61      (1.3%)   -0.7% (  -3% -    2%)\\r\\n                 Prefix3       88.11      (6.4%)       87.57      (7.5%)   -0.6% ( -13% -   14%)\\r\\n                 MedTerm      235.73      (1.4%)      235.35      (3.7%)   -0.2% (  -5% -    4%)\\r\\n                HighTerm      144.06      (1.3%)      143.93      (4.2%)   -0.1% (  -5% -    5%)\\r\\n                 LowTerm      711.49      (4.2%)      718.15      (4.7%)    0.9% (  -7% -   10%)\\r\\n                 Respell      203.69      (8.6%)      206.72      (7.0%)    1.5% ( -12% -   18%)\\r\\n       HighTermMonthSort      196.30      (5.2%)      222.54      (8.2%)   13.4% (   0% -   28%)\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI do like that in your patch AssertingScorer checks all that stuff, but there it is a bit confusing.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCan you elaborate on what you find confusing? This looks similar to how you should not call \u003ctt\u003eScore.score()\u003c\\/tt\u003e if you passed \u003ctt\u003eneedsScores=false\u003c\\/tt\u003e to me?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16203829_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16203829_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T16:44:43+0000\'\u003e13\\/Oct\\/17 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     indexsearcher already knows if scores are needed (e.g. from the Sort), but there is no way to tell it that approximate total hit count is acceptable. If we can do that, then I think we can make the early termination case really easy for the sorted case, index order case, and also this maxscore case.  \\n\\n +1 We need to add a new  boolean needsTotalHits  to the  search(Query, int)  and  search(Query, int, Sort)  methods. \\n\\n  we do?  &#91;...&#93;  I\'m just asking because the new scorer here looks a hell of a lot like a disjunction scorer  \\n\\n Well it is a disjunction.   Our regular disjunction scorer maintains a single heap and only looks at the \'top\' element and callso  updateTop  after calls to  nextDoc  or  advance . If you want to be able to call  advance()  sometimes on low-scoring clauses even if only  nextDoc()  was called on the disjunction, you need to give it the ability to leave some scorers behind, as long as the sum of the max scores of scorers that are behind and scorers that are positioned on the current candidate is not greater than the minimum competitive score (otherwise you might be missing matches). This means you need to move scorers between at least 2 data-structures. In practice, we actually use 3 of them so that we can also easily differenciate scorers that are on the current candidate from scorers that are too advanced. Moving scorers between those data-structures has some overhead. For instance here is what I get when I benchmark the MaxScoreScorer against master\'s DisjunctionSumScorer (BS1 is disabled in both cases): \\n\\n  \\n                     TaskQPS baseline      StdDev   QPS patch      StdDev                Pct diff\\r\\n   HighTermDayOfYearSort       33.34      (7.3%)       16.55      (2.6%)  -50.4% ( -56% -  -43%)\\r\\n              OrHighHigh       21.91      (4.1%)       12.36      (1.7%)  -43.6% ( -47% -  -39%)\\r\\n               OrHighLow       48.08      (4.0%)       29.27      (2.4%)  -39.1% ( -43% -  -34%)\\r\\n               OrHighMed       60.66      (4.0%)       39.32      (2.5%)  -35.2% ( -40% -  -29%)\\r\\n                  Fuzzy2      117.30      (7.1%)      101.36      (7.5%)  -13.6% ( -26% -    1%)\\r\\n                  Fuzzy1      238.83     (10.7%)      212.80      (7.3%)  -10.9% ( -26% -    7%)\\r\\n            OrHighNotLow       70.64      (3.4%)       66.82      (2.0%)   -5.4% ( -10% -    0%)\\r\\n            OrHighNotMed       65.59      (3.0%)       62.63      (1.6%)   -4.5% (  -8% -    0%)\\r\\n           OrNotHighHigh       34.55      (2.3%)       33.24      (1.1%)   -3.8% (  -6% -    0%)\\r\\n           OrHighNotHigh       48.98      (2.4%)       47.17      (1.4%)   -3.7% (  -7% -    0%)\\r\\n            OrNotHighMed      107.24      (2.1%)      103.40      (1.1%)   -3.6% (  -6% -    0%)\\r\\n                  IntNRQ       26.26     (11.5%)       25.64     (12.3%)   -2.3% ( -23% -   24%)\\r\\n              AndHighLow      879.33      (3.7%)      860.16      (3.3%)   -2.2% (  -8% -    4%)\\r\\n              AndHighMed      168.90      (1.7%)      165.48      (1.3%)   -2.0% (  -4% -    1%)\\r\\n              HighPhrase       20.08      (2.8%)       19.69      (2.7%)   -2.0% (  -7% -    3%)\\r\\n         MedSloppyPhrase       15.44      (1.7%)       15.15      (1.8%)   -1.9% (  -5% -    1%)\\r\\n             LowSpanNear       44.70      (2.1%)       43.88      (1.9%)   -1.8% (  -5% -    2%)\\r\\n               MedPhrase       52.07      (3.2%)       51.16      (3.1%)   -1.7% (  -7% -    4%)\\r\\n         LowSloppyPhrase      150.90      (1.5%)      148.62      (1.5%)   -1.5% (  -4% -    1%)\\r\\n            OrNotHighLow     1174.47      (3.6%)     1157.52      (4.1%)   -1.4% (  -8% -    6%)\\r\\n            HighSpanNear       38.46      (3.0%)       37.92      (2.4%)   -1.4% (  -6% -    4%)\\r\\n        HighSloppyPhrase       28.13      (2.4%)       27.76      (2.5%)   -1.3% (  -6% -    3%)\\r\\n               LowPhrase      131.67      (1.6%)      130.37      (2.0%)   -1.0% (  -4% -    2%)\\r\\n             MedSpanNear       54.75      (3.4%)       54.22      (3.0%)   -1.0% (  -7% -    5%)\\r\\n                Wildcard       41.58      (5.1%)       41.23      (5.2%)   -0.8% ( -10% -    9%)\\r\\n             AndHighHigh       71.08      (1.5%)       70.61      (1.3%)   -0.7% (  -3% -    2%)\\r\\n                 Prefix3       88.11      (6.4%)       87.57      (7.5%)   -0.6% ( -13% -   14%)\\r\\n                 MedTerm      235.73      (1.4%)      235.35      (3.7%)   -0.2% (  -5% -    4%)\\r\\n                HighTerm      144.06      (1.3%)      143.93      (4.2%)   -0.1% (  -5% -    5%)\\r\\n                 LowTerm      711.49      (4.2%)      718.15      (4.7%)    0.9% (  -7% -   10%)\\r\\n                 Respell      203.69      (8.6%)      206.72      (7.0%)    1.5% ( -12% -   18%)\\r\\n       HighTermMonthSort      196.30      (5.2%)      222.54      (8.2%)   13.4% (   0% -   28%)\\r\\n \\n  \\n\\n  I do like that in your patch AssertingScorer checks all that stuff, but there it is a bit confusing.  \\n\\n Can you elaborate on what you find confusing? This looks similar to how you should not call  Score.score()  if you passed  needsScores=false  to me?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16204134\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16204134&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16204134\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16204134_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16204134_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 20:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T20:24:42+0000\'\u003e13\\/Oct\\/17 20:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the benchmarking! It is unfortunate we have to make the api more complicated \\/ specialize disjunctions even more, but seems like the right tradeoff i suppose.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eCan you elaborate on what you find confusing? This looks similar to how you should not call Score.score() if you passed needsScores=false to me?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s exactly it, i think we should try to avoid situations like that. its basically the opposite of type-safety, and the more of these conditionals \\/ \\\"methods you should not call\\\" that we add, the more confusing it should get. That\'s why i\'m still mulling what we can do to keep scorers simpler...\u003c\\/p\u003e\\n\\n\u003cp\u003ebut for now, to move along, I think we have some basic idea of what to do to fix indexsearcher (a boolean about whether exact total hits are needed, for various purposes), but yeah lets keep it separate from what we do about createWeight. For the latter maybe an explicit boolean for maxScore is the simplest for now, and we can see where it goes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16204134_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16204134_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/17 20:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-13T20:24:42+0000\'\u003e13\\/Oct\\/17 20:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the benchmarking! It is unfortunate we have to make the api more complicated \\/ specialize disjunctions even more, but seems like the right tradeoff i suppose. \\n\\n \\n Can you elaborate on what you find confusing? This looks similar to how you should not call Score.score() if you passed needsScores=false to me?  \\n\\n That\'s exactly it, i think we should try to avoid situations like that. its basically the opposite of type-safety, and the more of these conditionals \\/ \\\"methods you should not call\\\" that we add, the more confusing it should get. That\'s why i\'m still mulling what we can do to keep scorers simpler... \\n\\n but for now, to move along, I think we have some basic idea of what to do to fix indexsearcher (a boolean about whether exact total hits are needed, for various purposes), but yeah lets keep it separate from what we do about createWeight. For the latter maybe an explicit boolean for maxScore is the simplest for now, and we can see where it goes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16213939\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16213939&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16213939\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16213939_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16213939_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/17 14:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-21T14:33:37+0000\'\u003e21\\/Oct\\/17 14:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eStore more metadata in order to be able to compute better higher bounds for the scores, like the maximum term frequency. Maybe even allow similarity-specific stats?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003emaximum term frequency may be a reasonable idea. Its imperfect but its simple, can be re-computed on merge, validated by CheckIndex, etc. The downside is that per-term stats are still fairly costly i think for blocktree, so would the performance benefits be worth it? I do like that it\'d require no additional storage for an \u003ctt\u003eomitTF\u003c\\/tt\u003e field since it is 1 there by definition.\u003c\\/p\u003e\\n\\n\u003cp\u003efor phrases it could still work too (just take min or max across all the terms in the phrase and pass to sim as a bad approximation). So instead of:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\r\\n\\/** Return the maximum score that \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e scorer may produce.\\r\\n  * {@code \u003cspan class=\\\"code-object\\\"\u003eFloat\u003c\\/span\u003e.POSITIVE_INFINITY} is a fine \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e value \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e scores are not bounded. *\\/\\r\\n\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003efloat\u003c\\/span\u003e maxScore();\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003ewe\'d have\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\r\\n\\/** Return the maximum score that \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e scorer may produce.\\r\\n  * {@code \u003cspan class=\\\"code-object\\\"\u003eFloat\u003c\\/span\u003e.POSITIVE_INFINITY} is a fine \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e value \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e scores are not bounded.\\r\\n  * @param maxFreq maximum possible frequency value\\r\\n  *\\/\\r\\n\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003efloat\u003c\\/span\u003e maxScore(\u003cspan class=\\\"code-object\\\"\u003efloat\u003c\\/span\u003e maxFreq);\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI wonder how much it would improve your performance for BM25 though? I think we shouldn\'t add such a stat unless it really helps our defaults due to the costly nature of such statistics (not just cpu\\/storage, but api complexity, codec requirements, etc). On the side, by my math (just playing around with numbers), its still not enough to make the optimization potent for ClassicSimilarity, which may be the worst-case here \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003eTheoretically it\'d be simple to independently expose the min value for field\'s norm to get even better (similarity could pull that itself from its LeafReader), but it\'d be so fragile: messy data such as a single very short doc for the field will effectively negate that opto for the entire field. Alternatively storing min norm\'s value per-term might do it, once written it does not change so can be easily merged, cross-verified with norm\'s value in CheckIndex, etc, but its another thing to benchmark and compare the cost.\u003c\\/p\u003e\\n\\n\u003cp\u003eAllowing the similarity to store its own stuff seems impractical for a number of reasons: for example we couldn\'t get any better for BM25 without breaking incremental and distributed search (avgFieldLength unknown until runtime).\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother way to put it: with the current patch the Similarity has all the raw statistics it needs to compute its maxScore, except that norm and tf values are left unbounded, so i\'d rather see those raw statistics stored if we want to improve their maxScore functions. As attractive as it sounds to combine them up-front for the best possible performance, I think its not practical given the features we support.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16213939_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16213939_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/17 14:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-21T14:33:37+0000\'\u003e21\\/Oct\\/17 14:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Store more metadata in order to be able to compute better higher bounds for the scores, like the maximum term frequency. Maybe even allow similarity-specific stats?  \\n\\n maximum term frequency may be a reasonable idea. Its imperfect but its simple, can be re-computed on merge, validated by CheckIndex, etc. The downside is that per-term stats are still fairly costly i think for blocktree, so would the performance benefits be worth it? I do like that it\'d require no additional storage for an  omitTF  field since it is 1 there by definition. \\n\\n for phrases it could still work too (just take min or max across all the terms in the phrase and pass to sim as a bad approximation). So instead of: \\n  \\n \\r\\n\\/** Return the maximum score that  this  scorer may produce.\\r\\n  * {@code  Float .POSITIVE_INFINITY} is a fine  return  value  if  scores are not bounded. *\\/\\r\\n public   abstract   float  maxScore();\\r\\n \\n  \\n we\'d have \\n  \\n \\r\\n\\/** Return the maximum score that  this  scorer may produce.\\r\\n  * {@code  Float .POSITIVE_INFINITY} is a fine  return  value  if  scores are not bounded.\\r\\n  * @param maxFreq maximum possible frequency value\\r\\n  *\\/\\r\\n public   abstract   float  maxScore( float  maxFreq);\\r\\n \\n  \\n\\n I wonder how much it would improve your performance for BM25 though? I think we shouldn\'t add such a stat unless it really helps our defaults due to the costly nature of such statistics (not just cpu\\/storage, but api complexity, codec requirements, etc). On the side, by my math (just playing around with numbers), its still not enough to make the optimization potent for ClassicSimilarity, which may be the worst-case here    \\n\\n Theoretically it\'d be simple to independently expose the min value for field\'s norm to get even better (similarity could pull that itself from its LeafReader), but it\'d be so fragile: messy data such as a single very short doc for the field will effectively negate that opto for the entire field. Alternatively storing min norm\'s value per-term might do it, once written it does not change so can be easily merged, cross-verified with norm\'s value in CheckIndex, etc, but its another thing to benchmark and compare the cost. \\n\\n Allowing the similarity to store its own stuff seems impractical for a number of reasons: for example we couldn\'t get any better for BM25 without breaking incremental and distributed search (avgFieldLength unknown until runtime). \\n\\n Another way to put it: with the current patch the Similarity has all the raw statistics it needs to compute its maxScore, except that norm and tf values are left unbounded, so i\'d rather see those raw statistics stored if we want to improve their maxScore functions. As attractive as it sounds to combine them up-front for the best possible performance, I think its not practical given the features we support.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16213972\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16213972&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16213972\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16213972_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16213972_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/17 15:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-21T15:37:22+0000\'\u003e21\\/Oct\\/17 15:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlso what does the patch look like if Scorer.maxScore() is abstract instead of defaulting to +Infinity? I think it should be the same for Similarity. It is a little trappy, for example in the current patch you can\'t see that it is missing for things such as phrase scorers (but should work fine if done the same way as TermScorer). We know there are queryparsers forming disjunctions with these kind of subs and it might be able to help, presuming we can refine the algorithm a bit more.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16213972_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16213972_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/17 15:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-21T15:37:22+0000\'\u003e21\\/Oct\\/17 15:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Also what does the patch look like if Scorer.maxScore() is abstract instead of defaulting to +Infinity? I think it should be the same for Similarity. It is a little trappy, for example in the current patch you can\'t see that it is missing for things such as phrase scorers (but should work fine if done the same way as TermScorer). We know there are queryparsers forming disjunctions with these kind of subs and it might be able to help, presuming we can refine the algorithm a bit more.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16214433\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16214433&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16214433\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16214433_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16214433_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Oct\\/17 20:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-22T20:11:22+0000\'\u003e22\\/Oct\\/17 20:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAgreed, we should make sure that eg. SynonymQuey exposes a max score.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16214433_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16214433_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Oct\\/17 20:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-22T20:11:22+0000\'\u003e22\\/Oct\\/17 20:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Agreed, we should make sure that eg. SynonymQuey exposes a max score.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16215213\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16215213&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16215213\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16215213_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16215213_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/17 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-23T14:29:20+0000\'\u003e23\\/Oct\\/17 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGiven how large the patch already is, would you be ok to delay exploring with maxFreq and minNorm, and looking into it in follow-up issues?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16215213_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16215213_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/17 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-23T14:29:20+0000\'\u003e23\\/Oct\\/17 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Given how large the patch already is, would you be ok to delay exploring with maxFreq and minNorm, and looking into it in follow-up issues?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16215224\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16215224&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16215224\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16215224_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16215224_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/17 14:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-23T14:36:55+0000\'\u003e23\\/Oct\\/17 14:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes but can we change the API on SimScorer to maxScore(freq)? We can improve already just by looking if the field omits TF (just pass 1), otherwise we pass Integer.MAX_VALUE.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am also happy to factor this part of the patch (just the similarity api) out to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-7997\\\" title=\\\"More sanity testing of similarities\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-7997\\\"\u003e\u003cdel\u003eLUCENE-7997\u003c\\/del\u003e\u003c\\/a\u003e and add tests for it and discover any potential problems.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16215224_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16215224_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/17 14:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-23T14:36:55+0000\'\u003e23\\/Oct\\/17 14:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes but can we change the API on SimScorer to maxScore(freq)? We can improve already just by looking if the field omits TF (just pass 1), otherwise we pass Integer.MAX_VALUE. \\n\\n I am also happy to factor this part of the patch (just the similarity api) out to   LUCENE-7997   and add tests for it and discover any potential problems.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16215238\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16215238&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16215238\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16215238_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16215238_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/17 14:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-23T14:48:26+0000\'\u003e23\\/Oct\\/17 14:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll fix it at the same time as I make maxScore abstract on Scorer.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16215238_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16215238_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/17 14:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-23T14:48:26+0000\'\u003e23\\/Oct\\/17 14:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll fix it at the same time as I make maxScore abstract on Scorer.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16215244\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16215244&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16215244\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16215244_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16215244_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/17 14:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-23T14:50:46+0000\'\u003e23\\/Oct\\/17 14:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think we can also refine the upperbound to \u003ctt\u003eMath.min(Integer.MAX_VALUE, 1 + totalTermFreq - docFreq)\u003c\\/tt\u003e today as well.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16215244_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16215244_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/17 14:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-23T14:50:46+0000\'\u003e23\\/Oct\\/17 14:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think we can also refine the upperbound to  Math.min(Integer.MAX_VALUE, 1 + totalTermFreq - docFreq)  today as well.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16216542\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16216542&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16216542\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16216542_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216542_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 08:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T08:43:05+0000\'\u003e24\\/Oct\\/17 08:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is an updated patch:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eScorer.maxScore() is now abstract\u003c\\/li\u003e\\n\\t\u003cli\u003eSimScorer.maxScore takes a float maxFreq that can be used to better bound the max score (but nothing smart is done about it yet, I\'d like to reserve it to follow-ups)\u003c\\/li\u003e\\n\\t\u003cli\u003eTopDocs.totalHits is no longer -1 when needsTotalHitCount is false, it is now an approximation.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16216542_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216542_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 08:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T08:43:05+0000\'\u003e24\\/Oct\\/17 08:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is an updated patch: \\n \\n\\t Scorer.maxScore() is now abstract \\n\\t SimScorer.maxScore takes a float maxFreq that can be used to better bound the max score (but nothing smart is done about it yet, I\'d like to reserve it to follow-ups) \\n\\t TopDocs.totalHits is no longer -1 when needsTotalHitCount is false, it is now an approximation. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16216744\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16216744&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16216744\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16216744_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216744_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 11:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T11:46:26+0000\'\u003e24\\/Oct\\/17 11:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan we add this comment to DisjunctionMaxScorer (and not just leave at infinity):\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e\\/\\/ TODO: implement but be careful about floating-point errors.\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eCan we fix \u003ctt\u003emaxFreq\u003c\\/tt\u003e calculation. Currently it is: \u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e\\/\\/ TODO: store the max term freq?\\r\\nif (ttf == -1) {\\r\\n  return Integer.MAX_VALUE;\\r\\n} else {\\r\\n  return ttf - df + 1;\\r\\n}\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eIt should be:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e\\/\\/ TODO: store the max term freq?\\r\\nif (ttf == -1) {\\r\\n \\/\\/ omitTFAP field, tf values are implicitly 1. \\r\\n \\/\\/ note: it seems cleaner to check IndexOptions instead of looking at -1? \\r\\n  return 1;\\r\\n} else {\\r\\n  return Math.min(Integer.MAX_VALUE, ttf - df + 1);\\r\\n}\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI only partially reviewed the patch... will look at it again tonight.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16216744_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216744_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 11:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T11:46:26+0000\'\u003e24\\/Oct\\/17 11:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can we add this comment to DisjunctionMaxScorer (and not just leave at infinity): \\n  \\n \\/\\/ TODO: implement but be careful about floating-point errors.\\r\\n \\n  \\n\\n Can we fix  maxFreq  calculation. Currently it is:  \\n  \\n \\/\\/ TODO: store the max term freq?\\r\\nif (ttf == -1) {\\r\\n  return Integer.MAX_VALUE;\\r\\n} else {\\r\\n  return ttf - df + 1;\\r\\n}\\r\\n \\n  \\n It should be: \\n  \\n \\/\\/ TODO: store the max term freq?\\r\\nif (ttf == -1) {\\r\\n \\/\\/ omitTFAP field, tf values are implicitly 1. \\r\\n \\/\\/ note: it seems cleaner to check IndexOptions instead of looking at -1? \\r\\n  return 1;\\r\\n} else {\\r\\n  return Math.min(Integer.MAX_VALUE, ttf - df + 1);\\r\\n}\\r\\n \\n  \\n\\n I only partially reviewed the patch... will look at it again tonight.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16216902\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16216902&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16216902\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16216902_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216902_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 13:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T13:32:26+0000\'\u003e24\\/Oct\\/17 13:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003e\\/\\/ omitTFAP field, tf values are implicitly 1. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI thought codecs could also deliberately not store ttf even if term frequencies are enabled? At least this is my understanding from the following sentence of \u003ctt\u003eTermsEnum.totalTermFreq\u003c\\/tt\u003e\'s javadocs: \u003ctt\u003eThis will be -1 if the codec doesn\'t support this measure.\u003c\\/tt\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16216902_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216902_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 13:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T13:32:26+0000\'\u003e24\\/Oct\\/17 13:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     \\/\\/ omitTFAP field, tf values are implicitly 1.   \\n\\n I thought codecs could also deliberately not store ttf even if term frequencies are enabled? At least this is my understanding from the following sentence of  TermsEnum.totalTermFreq \'s javadocs:  This will be -1 if the codec doesn\'t support this measure. .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16216916\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16216916&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16216916\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16216916_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216916_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 13:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T13:39:22+0000\'\u003e24\\/Oct\\/17 13:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell that\'s why i wrote the \\\"note: \\\" \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eTechnically the better code would be:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\r\\n\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (indexOptions = DOCS_ONLY) {\\r\\n  \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e 1; \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ tf values are omitted\\r\\n\u003c\\/span\u003e}\\r\\n...\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eAnd yes when frequencies are present, according to the docs its allowed to return -1 here, but that was solely motivated by PreFlexCodec: (Lucene 3.x indexes). What actually returns -1 here for this case? \u003c\\/p\u003e\\n\\n\u003cp\u003eWe will never have maxScore working as long as we have such complexity: lets remove the problem. I faced this same issue in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-7997\\\" title=\\\"More sanity testing of similarities\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-7997\\\"\u003e\u003cdel\u003eLUCENE-7997\u003c\\/del\u003e\u003c\\/a\u003e and i think its easier to just enforce that docCount and sumDocFreq are always present, and that sumTotalTermFreq, and totalTermFreq are always present when term freqs are stored.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16216916_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216916_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 13:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T13:39:22+0000\'\u003e24\\/Oct\\/17 13:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well that\'s why i wrote the \\\"note: \\\"   \\n\\n Technically the better code would be: \\n  \\n \\r\\n if  (indexOptions = DOCS_ONLY) {\\r\\n   return  1;  \\/\\/ tf values are omitted\\r\\n }\\r\\n...\\r\\n \\n  \\n\\n And yes when frequencies are present, according to the docs its allowed to return -1 here, but that was solely motivated by PreFlexCodec: (Lucene 3.x indexes). What actually returns -1 here for this case?  \\n\\n We will never have maxScore working as long as we have such complexity: lets remove the problem. I faced this same issue in   LUCENE-7997   and i think its easier to just enforce that docCount and sumDocFreq are always present, and that sumTotalTermFreq, and totalTermFreq are always present when term freqs are stored.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16216925\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16216925&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16216925\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16216925_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216925_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 13:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T13:47:10+0000\'\u003e24\\/Oct\\/17 13:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI changed the unreasonable fix version to set proper expectations, this isn\'t something we can introduce in a minor release, the underlying changes (e.g. to similarity) are heavy and we need to simplify stuff \\/ do it correctly to prevent a mess.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_16216925_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16216925_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Oct\\/17 13:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-24T13:47:10+0000\'\u003e24\\/Oct\\/17 13:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I changed the unreasonable fix version to set proper expectations, this isn\'t something we can introduce in a minor release, the underlying changes (e.g. to similarity) are heavy and we need to simplify stuff \\/ do it correctly to prevent a mess.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16272886\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16272886&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16272886\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16272886_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16272886_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/17 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-11-30T16:19:35+0000\'\u003e30\\/Nov\\/17 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch that applies Robert\'s feedback and simplifies things a bit by assuming that scores are positive for instance (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-7996\\\" title=\\\"Should we require positive scores?\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-7996\\\"\u003e\u003cdel\u003eLUCENE-7996\u003c\\/del\u003e\u003c\\/a\u003e).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_16272886_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16272886_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Nov\\/17 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-11-30T16:19:35+0000\'\u003e30\\/Nov\\/17 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch that applies Robert\'s feedback and simplifies things a bit by assuming that scores are positive for instance (  LUCENE-7996  ).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16282738\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16282738&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16282738\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_16282738_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16282738_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/17 23:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-12-07T23:48:23+0000\'\u003e07\\/Dec\\/17 23:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMore Solr tests than usual are failing after the \u003ctt\u003e4fc5a872d\u003c\\/tt\u003e commit on this issue, e.g. \u003ctt\u003eTestHashQParserPlugin.testHashPartition\u003c\\/tt\u003e, which fails for me with any seed.  From \u003ca href=\\\"https:\\/\\/builds.apache.org\\/job\\/Lucene-Solr-Tests-master\\/2210\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/builds.apache.org\\/job\\/Lucene-Solr-Tests-master\\/2210\\/\u003c\\/a\u003e:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eChecking out Revision 5448274f26191a9882aa5c3020e3cbdcbf93551c (refs\\/remotes\\/origin\\/master)\\r\\n[...]\\r\\n   [junit4]   2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestHashQParserPlugin -Dtests.method=testHashPartition -Dtests.seed=B372ECC8951DB18F -Dtests.multiplier=2 -Dtests.slow=true -Dtests.locale=cs -Dtests.timezone=Asia\\/Jayapura -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\\r\\n   [junit4] ERROR   3.01s J0 | TestHashQParserPlugin.testHashPartition &lt;&lt;&lt;\\r\\n   [junit4]    &gt; Throwable #1: java.lang.UnsupportedOperationException: Query  does not implement createWeight\\r\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([B372ECC8951DB18F:62CFCD2DAE7708E4]:0)\\r\\n   [junit4]    &gt; \\tat org.apache.lucene.search.Query.createWeight(Query.java:66)\\r\\n   [junit4]    &gt; \\tat org.apache.lucene.search.IndexSearcher.createWeight(IndexSearcher.java:734)\\r\\n   [junit4]    &gt; \\tat org.apache.lucene.search.IndexSearcher.createNormalizedWeight(IndexSearcher.java:724)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.SolrIndexSearcher.getProcessedFilter(SolrIndexSearcher.java:1062)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.SolrIndexSearcher.getDocListNC(SolrIndexSearcher.java:1540)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1416)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.SolrIndexSearcher.search(SolrIndexSearcher.java:583)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.handler.component.QueryComponent.doProcessUngroupedSearch(QueryComponent.java:1435)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:375)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:295)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:177)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2503)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.util.TestHarness.query(TestHarness.java:337)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.util.TestHarness.query(TestHarness.java:319)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.TestHashQParserPlugin.testHashPartition(TestHashQParserPlugin.java:89)\\r\\n   [junit4]    &gt; \\tat java.lang.Thread.run(Thread.java:748)\\r\\n[...]\\r\\n   [junit4]   2&gt; NOTE: test params are: codec=Lucene70, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@68e611ad), locale=cs, timezone=Asia\\/Jayapura\\r\\n   [junit4]   2&gt; NOTE: Linux 3.13.0-88-generic amd64\\/Oracle Corporation 1.8.0_144 (64-bit)\\/cpus=4,threads=1,free=284221600,total=403177472\\r\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \\n\\n\u003cp\u003eMy browser says that \u003ctt\u003edoes not implement createWeight\u003c\\/tt\u003e occurs 48 times in the \u003ca href=\\\"https:\\/\\/builds.apache.org\\/job\\/Lucene-Solr-Tests-master\\/2210\\/consoleText\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/builds.apache.org\\/job\\/Lucene-Solr-Tests-master\\/2210\\/consoleText\u003c\\/a\u003e, so this is a problem for several tests.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steve_rowe\\\" id=\\\"commentauthor_16282738_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steve_rowe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steve_rowe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Steve Rowe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16282738_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/17 23:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-12-07T23:48:23+0000\'\u003e07\\/Dec\\/17 23:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    More Solr tests than usual are failing after the  4fc5a872d  commit on this issue, e.g.  TestHashQParserPlugin.testHashPartition , which fails for me with any seed.  From  https:\\/\\/builds.apache.org\\/job\\/Lucene-Solr-Tests-master\\/2210\\/ : \\n\\n  \\n Checking out Revision 5448274f26191a9882aa5c3020e3cbdcbf93551c (refs\\/remotes\\/origin\\/master)\\r\\n[...]\\r\\n   [junit4]   2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestHashQParserPlugin -Dtests.method=testHashPartition -Dtests.seed=B372ECC8951DB18F -Dtests.multiplier=2 -Dtests.slow=true -Dtests.locale=cs -Dtests.timezone=Asia\\/Jayapura -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\\r\\n   [junit4] ERROR   3.01s J0 | TestHashQParserPlugin.testHashPartition &lt;&lt;&lt;\\r\\n   [junit4]    &gt; Throwable #1: java.lang.UnsupportedOperationException: Query  does not implement createWeight\\r\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([B372ECC8951DB18F:62CFCD2DAE7708E4]:0)\\r\\n   [junit4]    &gt; \\tat org.apache.lucene.search.Query.createWeight(Query.java:66)\\r\\n   [junit4]    &gt; \\tat org.apache.lucene.search.IndexSearcher.createWeight(IndexSearcher.java:734)\\r\\n   [junit4]    &gt; \\tat org.apache.lucene.search.IndexSearcher.createNormalizedWeight(IndexSearcher.java:724)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.SolrIndexSearcher.getProcessedFilter(SolrIndexSearcher.java:1062)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.SolrIndexSearcher.getDocListNC(SolrIndexSearcher.java:1540)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1416)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.SolrIndexSearcher.search(SolrIndexSearcher.java:583)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.handler.component.QueryComponent.doProcessUngroupedSearch(QueryComponent.java:1435)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:375)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:295)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:177)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2503)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.util.TestHarness.query(TestHarness.java:337)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.util.TestHarness.query(TestHarness.java:319)\\r\\n   [junit4]    &gt; \\tat org.apache.solr.search.TestHashQParserPlugin.testHashPartition(TestHashQParserPlugin.java:89)\\r\\n   [junit4]    &gt; \\tat java.lang.Thread.run(Thread.java:748)\\r\\n[...]\\r\\n   [junit4]   2&gt; NOTE: test params are: codec=Lucene70, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@68e611ad), locale=cs, timezone=Asia\\/Jayapura\\r\\n   [junit4]   2&gt; NOTE: Linux 3.13.0-88-generic amd64\\/Oracle Corporation 1.8.0_144 (64-bit)\\/cpus=4,threads=1,free=284221600,total=403177472\\r\\n \\n   \\n\\n My browser says that  does not implement createWeight  occurs 48 times in the  https:\\/\\/builds.apache.org\\/job\\/Lucene-Solr-Tests-master\\/2210\\/consoleText , so this is a problem for several tests.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16283172\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4100?focusedCommentId=16283172&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16283172\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_16283172_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16283172_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/17 07:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-12-08T07:50:36+0000\'\u003e08\\/Dec\\/17 07:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 0e1d6682d6ca66590e279ee0c4ccce745f2accd6 in lucene-solr\'s branch refs\\/heads\\/master from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\" class=\\\"user-hover\\\" rel=\\\"jpountz\\\"\u003eAdrien Grand\u003c\\/a\u003e\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=0e1d668\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=0e1d668\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4100\\\" title=\\\"Maxscore - Efficient Scoring\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4100\\\"\u003e\u003cdel\u003eLUCENE-4100\u003c\\/del\u003e\u003c\\/a\u003e: Fix more queries to implement the new updated createWeight API.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_16283172_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16283172_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/17 07:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-12-08T07:50:36+0000\'\u003e08\\/Dec\\/17 07:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 0e1d6682d6ca66590e279ee0c4ccce745f2accd6 in lucene-solr\'s branch refs\\/heads\\/master from  Adrien Grand  \\n[  https:\\/\\/git-wip-us.apache.org\\/repos\\/asf?p=lucene-solr.git;h=0e1d668  ] \\n\\n   LUCENE-4100  : Fix more queries to implement the new updated createWeight API.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516204153040"> 
    <input type="hidden" title="jira.request.server.time" value="300"> 
    <input type="hidden" title="jira.request.id" value="949x7747892x7"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="7"> 
    <input type="hidden" title="db.reads.time.in.ms" value="23"> 
    <input type="hidden" title="db.conns.time.in.ms" value="28"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 949x7747892x7
	          REQUEST TIMESTAMP : [17/Jan/2018:15:49:13 +0000]
	               REQUEST TIME : 0.3000
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 7

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=29, elapsedTotal=23981865, elapsedMin=290977, elapsedMax=7306651, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=33, elapsedTotal=28718281, elapsedMin=328317, elapsedMax=7345048, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>