<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|d86e3c5b0fef1fced6ac4e4ffe9468ebf071ee90|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"2f8512edd71b7d\"";
WRM._unparsedData["project-id"]="12310230";
WRM._unparsedData["project-key"]="\"SOLR\"";
WRM._unparsedData["project-name"]="\"Solr\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310230";
WRM._unparsedData["projectKey"]="\"SOLR\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="SOLR-9555"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[SOLR-9555] Leader incorrectly publishes state for replica when it puts replica into LIR. - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[SOLR-9555] Leader incorrectly publishes state for replica when it puts replica into LIR. - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/SOLR" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-9555">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310230" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Solr'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310230&amp;avatarId=22151"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/SOLR">Solr</a></li>
                 <li><a class="issue-link" data-issue-key="SOLR-9555" href="/jira/browse/SOLR-9555" id="key-val" rel="13007388">SOLR-9555</a></li>
                </ol>
                <h1 id="summary-val">Leader incorrectly publishes state for replica when it puts replica into LIR.</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-9555"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/SOLR-9555/SOLR-9555.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/SOLR-9555/SOLR-9555.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/SOLR-9555/SOLR-9555.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/SOLR-9555/SOLR-9555.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+%22master+%288.0%29%22" title="master (8.0) Current unstable dev">master (8.0)</a>, <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+7.3" title="7.3 Minor release after 7.2">7.3</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Security Level:</strong> 
                   <span id="security-val" class="value"> <span class="note">Public</span> (Default Security Level. Issues are Public) </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-13007388-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>See <a href="https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/17888/consoleFull" class="external-link" rel="nofollow">https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/17888/consoleFull</a> for an example</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/SOLR-9555?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/SOLR-9555?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/SOLR-9555?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/SOLR-9555?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12878186" data-issue-id="13007388" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12878186/lir-9555-problem.png" draggable="true" data-downloadurl="image/png:lir-9555-problem.png:https://issues.apache.org/jira/secure/attachment/12878186/lir-9555-problem.png" file-preview-id="12878186" file-preview-title="lir-9555-problem.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12878186/lir-9555-problem.png" title="Latest  20/Jul/17 14:45 - Mano Kovacs" draggable="true" data-downloadurl="image/png:lir-9555-problem.png:https://issues.apache.org/jira/secure/attachment/12878186/lir-9555-problem.png" file-preview-id="12878186" file-preview-title="lir-9555-problem.png" file-preview-type="image">lir-9555-problem.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-07-20T14:45:33.161Z">20/Jul/17 14:45</time>
                   </dd>
                   <dd class="attachment-size">
                    29 kB
                   </dd>
                   <dd class="attachment-author">
                    Mano Kovacs
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12865224" data-issue-id="13007388" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12865224/SOLR-9555.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-9555.patch:https://issues.apache.org/jira/secure/attachment/12865224/SOLR-9555.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12865224/SOLR-9555.patch" title="Latest  26/Apr/17 22:07 - Mike Drob" draggable="true" data-downloadurl="text/x-patch:SOLR-9555.patch:https://issues.apache.org/jira/secure/attachment/12865224/SOLR-9555.patch">SOLR-9555.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-04-26T22:07:56.494Z">26/Apr/17 22:07</time>
                   </dd>
                   <dd class="attachment-size">
                    61 kB
                   </dd>
                   <dd class="attachment-author">
                    Mike Drob
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12864979" data-issue-id="13007388" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12864979/SOLR-9555.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-9555.patch:https://issues.apache.org/jira/secure/attachment/12864979/SOLR-9555.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12864979/SOLR-9555.patch" title=" 25/Apr/17 17:15 - Mike Drob" draggable="true" data-downloadurl="text/x-patch:SOLR-9555.patch:https://issues.apache.org/jira/secure/attachment/12864979/SOLR-9555.patch">SOLR-9555.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-04-25T17:15:04.915Z">25/Apr/17 17:15</time>
                   </dd>
                   <dd class="attachment-size">
                    61 kB
                   </dd>
                   <dd class="attachment-author">
                    Mike Drob
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12864368" data-issue-id="13007388" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12864368/SOLR-9555.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-9555.patch:https://issues.apache.org/jira/secure/attachment/12864368/SOLR-9555.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12864368/SOLR-9555.patch" title=" 20/Apr/17 21:42 - Mike Drob" draggable="true" data-downloadurl="text/x-patch:SOLR-9555.patch:https://issues.apache.org/jira/secure/attachment/12864368/SOLR-9555.patch">SOLR-9555.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-04-20T21:42:50.440Z">20/Apr/17 21:42</time>
                   </dd>
                   <dd class="attachment-size">
                    60 kB
                   </dd>
                   <dd class="attachment-author">
                    Mike Drob
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12853386" data-issue-id="13007388" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12853386/SOLR-9555-WIP.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-9555-WIP.patch:https://issues.apache.org/jira/secure/attachment/12853386/SOLR-9555-WIP.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12853386/SOLR-9555-WIP.patch" title="Latest  17/Feb/17 23:46 - Mike Drob" draggable="true" data-downloadurl="text/x-patch:SOLR-9555-WIP.patch:https://issues.apache.org/jira/secure/attachment/12853386/SOLR-9555-WIP.patch">SOLR-9555-WIP.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-02-17T23:46:54.523Z">17/Feb/17 23:46</time>
                   </dd>
                   <dd class="attachment-size">
                    34 kB
                   </dd>
                   <dd class="attachment-author">
                    Mike Drob
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12863689" data-issue-id="13007388" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12863689/SOLR-9555-WIP-2.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-9555-WIP-2.patch:https://issues.apache.org/jira/secure/attachment/12863689/SOLR-9555-WIP-2.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12863689/SOLR-9555-WIP-2.patch" title="Latest  17/Apr/17 21:59 - Mike Drob" draggable="true" data-downloadurl="text/x-patch:SOLR-9555-WIP-2.patch:https://issues.apache.org/jira/secure/attachment/12863689/SOLR-9555-WIP-2.patch">SOLR-9555-WIP-2.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-04-17T21:59:03.289Z">17/Apr/17 21:59</time>
                   </dd>
                   <dd class="attachment-size">
                    53 kB
                   </dd>
                   <dd class="attachment-author">
                    Mike Drob
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12863903" data-issue-id="13007388" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12863903/SOLR-9555-WIP-3.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-9555-WIP-3.patch:https://issues.apache.org/jira/secure/attachment/12863903/SOLR-9555-WIP-3.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12863903/SOLR-9555-WIP-3.patch" title="Latest  18/Apr/17 22:48 - Mike Drob" draggable="true" data-downloadurl="text/x-patch:SOLR-9555-WIP-3.patch:https://issues.apache.org/jira/secure/attachment/12863903/SOLR-9555-WIP-3.patch">SOLR-9555-WIP-3.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2017-04-18T22:48:31.159Z">18/Apr/17 22:48</time>
                   </dd>
                   <dd class="attachment-size">
                    55 kB
                   </dd>
                   <dd class="attachment-author">
                    Mike Drob
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="depends upon">
                   depends upon
                  </dt> 
                  <dd id="internal-13065208_10001"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-10525: Stacked recovery requests do no cancel an in progress recovery first."> <a href="/jira/browse/SOLR-10525" data-issue-key="SOLR-10525" class="issue-link link-title resolution">SOLR-10525</a> <span class="link-summary">Stacked recovery requests do no cancel an in progress recovery first.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-13031665_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-9913: LIR should continue on SocketTimeoutException"> <a href="/jira/browse/SOLR-9913" data-issue-key="SOLR-9913" class="issue-link link-title">SOLR-9913</a> <span class="link-summary">LIR should continue on SocketTimeoutException</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-13039198_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/images/icons/issuetypes/requirement.png" width="16" height="16" title="Test - A new unit, integration or system test." alt="Test - A new unit, integration or system test."> <span title="SOLR-10071: The Nightly test LeaderInitiatedRecoveryOnShardRestartTest appears to be too fragile."> <a href="/jira/browse/SOLR-10071" data-issue-key="SOLR-10071" class="issue-link link-title">SOLR-10071</a> <span class="link-summary">The Nightly test LeaderInitiatedRecoveryOnShardRestartTest appears to be too fragile.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-13042328_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/images/icons/issuetypes/requirement.png" width="16" height="16" title="Test - A new unit, integration or system test." alt="Test - A new unit, integration or system test."> <span title="SOLR-10126: PeerSyncReplicationTest is a flakey test."> <a href="/jira/browse/SOLR-10126" data-issue-key="SOLR-10126" class="issue-link link-title resolution">SOLR-10126</a> <span class="link-summary">PeerSyncReplicationTest is a flakey test.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-13032996_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-9945: LIR should check the node is recovering before bring it down"> <a href="/jira/browse/SOLR-9945" data-issue-key="SOLR-9945" class="issue-link link-title resolution">SOLR-9945</a> <span class="link-summary">LIR should check the node is recovering before bring it down</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_caomanhdat" rel="caomanhdat" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Cao Manh Dat&quot;,&quot;emailAddress&quot;:&quot;caomanhdat317@gmail.com&quot;,&quot;username&quot;:&quot;caomanhdat&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="caomanhdat"></span></span> Cao Manh Dat </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_romseygeek" rel="romseygeek" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Alan Woodward&quot;,&quot;emailAddress&quot;:&quot;alan.woodward@romseysoftware.co.uk&quot;,&quot;username&quot;:&quot;romseygeek&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="romseygeek"></span></span> Alan Woodward </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">12</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="24/Sep/16 19:19"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-09-24T19:19:35+0000">24/Sep/16 19:19</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="29/Jan/18 09:00"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2018-01-29T09:00:40+0000">29/Jan/18 09:00</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="29/Jan/18 09:00"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2018-01-29T09:00:40+0000">29/Jan/18 09:00</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-9555?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/SOLR-9555?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-15519503\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15519503&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15519503\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15519503_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15519503_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/16 19:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-09-24T19:25:14+0000\'\u003e24\\/Sep\\/16 19:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe race looks something like this:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eA node goes down, and then restarts\u003c\\/li\u003e\\n\\t\u003cli\u003eThe leader tries to send a document to the starting node, and gets a 503 \'not ready yet\'\u003c\\/li\u003e\\n\\t\u003cli\u003eThe node publishes its state as RECOVERING\u003c\\/li\u003e\\n\\t\u003cli\u003eThe leader\'s LIR thread publishes the recovering node\'s state as DOWN\u003c\\/li\u003e\\n\\t\u003cli\u003eThe node sends a PREPRECOVERY request to the leader\u003c\\/li\u003e\\n\\t\u003cli\u003eThe leader waits for the node\'s state to be RECOVERING, but as it\'s just been set as DOWN by the LIR thread, everything hangs\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI \u003cb\u003ethink\u003c\\/b\u003e the fix is for the LIR thread to only set the node\'s state as DOWN if it\'s current state is ACTIVE, using ZK versions to check that the leader\'s state is up-to-date, but I\'d like to get comments from people who know this bit of the code better - \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\" class=\\\"user-hover\\\" rel=\\\"shalinmangar\\\"\u003eShalin Shekhar Mangar\u003c\\/a\u003e \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=thelabdude\\\" class=\\\"user-hover\\\" rel=\\\"thelabdude\\\"\u003eTimothy Potter\u003c\\/a\u003e does this look right to you?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15519503_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15519503_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/16 19:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-09-24T19:25:14+0000\'\u003e24\\/Sep\\/16 19:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The race looks something like this: \\n \\n\\t A node goes down, and then restarts \\n\\t The leader tries to send a document to the starting node, and gets a 503 \'not ready yet\' \\n\\t The node publishes its state as RECOVERING \\n\\t The leader\'s LIR thread publishes the recovering node\'s state as DOWN \\n\\t The node sends a PREPRECOVERY request to the leader \\n\\t The leader waits for the node\'s state to be RECOVERING, but as it\'s just been set as DOWN by the LIR thread, everything hangs \\n \\n\\n\\n I  think  the fix is for the LIR thread to only set the node\'s state as DOWN if it\'s current state is ACTIVE, using ZK versions to check that the leader\'s state is up-to-date, but I\'d like to get comments from people who know this bit of the code better -  Shalin Shekhar Mangar   Timothy Potter  does this look right to you?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15555452\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15555452&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15555452\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15555452_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15555452_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Oct\\/16 15:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-10-07T15:55:21+0000\'\u003e07\\/Oct\\/16 15:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnother instance of this:\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/jenkins.thetaphi.de\\/job\\/Lucene-Solr-master-Windows\\/6164\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/jenkins.thetaphi.de\\/job\\/Lucene-Solr-master-Windows\\/6164\\/\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15555452_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15555452_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Oct\\/16 15:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2016-10-07T15:55:21+0000\'\u003e07\\/Oct\\/16 15:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Another instance of this: \\n https:\\/\\/jenkins.thetaphi.de\\/job\\/Lucene-Solr-master-Windows\\/6164\\/               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15826417\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15826417&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15826417\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15826417_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15826417_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/17 17:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-17T17:20:53+0000\'\u003e17\\/Jan\\/17 17:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is causing occasional issues in PeerSyncReplicationTest as well - here\'s another example: \u003ca href=\\\"https:\\/\\/jenkins.thetaphi.de\\/job\\/Lucene-Solr-master-MacOSX\\/3785\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/jenkins.thetaphi.de\\/job\\/Lucene-Solr-master-MacOSX\\/3785\\/\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ePing \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\" class=\\\"user-hover\\\" rel=\\\"shalinmangar\\\"\u003eShalin Shekhar Mangar\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15826417_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15826417_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/17 17:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-17T17:20:53+0000\'\u003e17\\/Jan\\/17 17:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is causing occasional issues in PeerSyncReplicationTest as well - here\'s another example:  https:\\/\\/jenkins.thetaphi.de\\/job\\/Lucene-Solr-master-MacOSX\\/3785\\/  \\n\\n Ping  Shalin Shekhar Mangar               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15827013\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15827013&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15827013\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"praste\\\" id=\\\"commentauthor_15827013_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=praste\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"praste\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Pushkar Raste\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15827013_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/17 23:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-17T23:12:44+0000\'\u003e17\\/Jan\\/17 23:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI assume this would happen in the prod deployment (outside of the test itself) as well. \u003c\\/p\u003e\\n\\n\u003cp\u003eDoes the \u003ctt\u003ePeerSyncReplicationTest.waitTillNodesActive\u003c\\/tt\u003e method looks good or method itself has some bug? \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"praste\\\" id=\\\"commentauthor_15827013_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=praste\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"praste\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Pushkar Raste\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15827013_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/17 23:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-17T23:12:44+0000\'\u003e17\\/Jan\\/17 23:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I assume this would happen in the prod deployment (outside of the test itself) as well.  \\n\\n Does the  PeerSyncReplicationTest.waitTillNodesActive  method looks good or method itself has some bug?               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15827382\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15827382&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15827382\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15827382_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15827382_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 03:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T03:41:18+0000\'\u003e18\\/Jan\\/17 03:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve seen this same thing happen on a prod cluster. However, in my case, the problem corrected itself after 180 seconds when the leader\'s wait timed out and the whole process started again. Agree that the fix is to only set DOWN if current state is ACTIVE. I can try to put together a patch later this week if nobody else is already working on it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15827382_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15827382_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 03:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T03:41:18+0000\'\u003e18\\/Jan\\/17 03:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve seen this same thing happen on a prod cluster. However, in my case, the problem corrected itself after 180 seconds when the leader\'s wait timed out and the whole process started again. Agree that the fix is to only set DOWN if current state is ACTIVE. I can try to put together a patch later this week if nobody else is already working on it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15827656\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15827656&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15827656\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_15827656_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15827656_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 08:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T08:53:28+0000\'\u003e18\\/Jan\\/17 08:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis issue seems related to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-9945\\\" title=\\\"LIR should check the node is recovering before bring it down\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-9945\\\"\u003e\u003cdel\u003eSOLR-9945\u003c\\/del\u003e\u003c\\/a\u003e. \u003cbr\\/\u003e\\nAs I discussed with \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\" class=\\\"user-hover\\\" rel=\\\"shalinmangar\\\"\u003eShalin Shekhar Mangar\u003c\\/a\u003e, \u003c\\/p\u003e\\n\\n\u003cp\u003eIn \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-9945\\\" title=\\\"LIR should check the node is recovering before bring it down\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-9945\\\"\u003e\u003cdel\u003eSOLR-9945\u003c\\/del\u003e\u003c\\/a\u003e, the reason that leader can not send the update to replica because the underlying socket is closed on replica side, so the leader will put replica into LIR state.\u003cbr\\/\u003e\\nI don\'t think we should fix the problem by \\\"only set DOWN if the current state is ACTIVE\\\" , because we did not send the update to the replica, so the replica won\'t have that update, we should put the replica into LIR, it\'s a right thing to do. I think we should fix the problem by \\\"close\\\" the underlying socket based on ZK events.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_15827656_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15827656_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 08:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T08:53:28+0000\'\u003e18\\/Jan\\/17 08:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This issue seems related to   SOLR-9945  .  \\nAs I discussed with  Shalin Shekhar Mangar ,  \\n\\n In   SOLR-9945  , the reason that leader can not send the update to replica because the underlying socket is closed on replica side, so the leader will put replica into LIR state. \\nI don\'t think we should fix the problem by \\\"only set DOWN if the current state is ACTIVE\\\" , because we did not send the update to the replica, so the replica won\'t have that update, we should put the replica into LIR, it\'s a right thing to do. I think we should fix the problem by \\\"close\\\" the underlying socket based on ZK events.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15828351\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15828351&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15828351\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15828351_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15828351_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 16:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T16:22:33+0000\'\u003e18\\/Jan\\/17 16:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMike, Pushkar: Yes, this will happen in production, but will correct itself after the 180 seconds.  That\'s long enough to timeout the test though, and I think it\'s still worth addressing.  Patches are welcome \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eDat: We won\'t be losing any updates, because the replica is already in recovery; the problem is that we have two different places writing state into zookeeper, and they\'re racing with each other.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15828351_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15828351_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 16:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T16:22:33+0000\'\u003e18\\/Jan\\/17 16:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mike, Pushkar: Yes, this will happen in production, but will correct itself after the 180 seconds.  That\'s long enough to timeout the test though, and I think it\'s still worth addressing.  Patches are welcome   \\n\\n Dat: We won\'t be losing any updates, because the replica is already in recovery; the problem is that we have two different places writing state into zookeeper, and they\'re racing with each other.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15828380\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15828380&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15828380\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"praste\\\" id=\\\"commentauthor_15828380_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=praste\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"praste\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Pushkar Raste\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15828380_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 16:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T16:41:04+0000\'\u003e18\\/Jan\\/17 16:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan\'t we just timeout in the test to let\'s say 200\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"praste\\\" id=\\\"commentauthor_15828380_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=praste\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"praste\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Pushkar Raste\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15828380_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 16:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T16:41:04+0000\'\u003e18\\/Jan\\/17 16:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can\'t we just timeout in the test to let\'s say 200              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15828949\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15828949&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15828949\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_15828949_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15828949_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T23:15:45+0000\'\u003e18\\/Jan\\/17 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Cao Manh Dat - 19\\/Jan\\/17 00:37\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\" class=\\\"user-hover\\\" rel=\\\"romseygeek\\\"\u003eAlan Woodward\u003c\\/a\u003e: In basically the reason for a leader put a replica into LIR state is \\\"it failed to send an update to the replica\\\". FYI: \\\"leader won\'t send an update to the replica if the state of replica is down\\\". So there are two possible case here\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ebefore sending update, the state of replica is active, then the replica go down right after, so the update will be failed to send to the replica.\u003c\\/li\u003e\\n\\t\u003cli\u003ebefore sending update, the state of replica is recovery, but the underlying socket to replica is closed because the replica have just restarted, so the update will be failed to send to the replica.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIn the second case, although the replica already in recovery state, putting the replica into LIR is a right thing to do. Because the buffering log doesn\'t contain the failed update. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_15828949_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15828949_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/17 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-18T23:15:45+0000\'\u003e18\\/Jan\\/17 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Cao Manh Dat - 19\\/Jan\\/17 00:37\\\"\u003eedited\u003c\\/span\u003e                    Alan Woodward : In basically the reason for a leader put a replica into LIR state is \\\"it failed to send an update to the replica\\\". FYI: \\\"leader won\'t send an update to the replica if the state of replica is down\\\". So there are two possible case here \\n \\n\\t before sending update, the state of replica is active, then the replica go down right after, so the update will be failed to send to the replica. \\n\\t before sending update, the state of replica is recovery, but the underlying socket to replica is closed because the replica have just restarted, so the update will be failed to send to the replica. \\n \\n\\n\\n In the second case, although the replica already in recovery state, putting the replica into LIR is a right thing to do. Because the buffering log doesn\'t contain the failed update.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15829955\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15829955&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15829955\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15829955_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15829955_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 13:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T13:46:49+0000\'\u003e19\\/Jan\\/17 13:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree with Dat that \\\"only set DOWN if current state is ACTIVE\\\" is the wrong solution because it has the potential to lose updates. Recovery process is guaranteed to bring a replica up to date only if all updates after a hard commit make it to the replica\'s buffered log. Whether the state of the replica is already RECOVERING or not makes no difference. If the leader is not able to send an update then that guarantee cannot be made and therefore it is safest to restart the recovery process.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15829955_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15829955_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 13:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T13:46:49+0000\'\u003e19\\/Jan\\/17 13:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree with Dat that \\\"only set DOWN if current state is ACTIVE\\\" is the wrong solution because it has the potential to lose updates. Recovery process is guaranteed to bring a replica up to date only if all updates after a hard commit make it to the replica\'s buffered log. Whether the state of the replica is already RECOVERING or not makes no difference. If the leader is not able to send an update then that guarantee cannot be made and therefore it is safest to restart the recovery process.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15830047\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15830047&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15830047\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15830047_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830047_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 14:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T14:44:42+0000\'\u003e19\\/Jan\\/17 14:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\" class=\\\"user-hover\\\" rel=\\\"caomanhdat\\\"\u003eCao Manh Dat\u003c\\/a\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\" class=\\\"user-hover\\\" rel=\\\"shalinmangar\\\"\u003eShalin Shekhar Mangar\u003c\\/a\u003e You guys know this code better than me, so I\'ll defer to you \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  I\'m not sure how to resolve the race, though - how do we know in PrerecoveryOp that a node has been put into LIR, and so we should stop waiting for it?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"romseygeek\\\" id=\\\"commentauthor_15830047_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=romseygeek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"romseygeek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Alan Woodward\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830047_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 14:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T14:44:42+0000\'\u003e19\\/Jan\\/17 14:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Cao Manh Dat  Shalin Shekhar Mangar  You guys know this code better than me, so I\'ll defer to you    I\'m not sure how to resolve the race, though - how do we know in PrerecoveryOp that a node has been put into LIR, and so we should stop waiting for it?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15830065\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15830065&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15830065\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830065_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830065_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 14:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T14:58:13+0000\'\u003e19\\/Jan\\/17 14:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI haven\'t examined this closely, but it was a mistake to implement LIR where the leader can publish state for a replica. We have needed to fix that for some time. A replica should only ever publish its own state. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830065_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830065_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 14:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T14:58:13+0000\'\u003e19\\/Jan\\/17 14:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I haven\'t examined this closely, but it was a mistake to implement LIR where the leader can publish state for a replica. We have needed to fix that for some time. A replica should only ever publish its own state.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15830078\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15830078&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15830078\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830078_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830078_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T15:08:45+0000\'\u003e19\\/Jan\\/17 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eComment was short because I was on my phone. Anyway, it\'s always a been a bug the leader even tries to do this.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe way this should work is that replicas should set a watch on ZK LIR nodes so they are notified when put into LIR - so that if they can speak to ZK but are partitioned from the leader, they set themselves to not ACTIVE. In the SolrCloud design, no replica or leader should ever publish state for another replica or leader. Either the leader can talk to replica and puts it into recovery, or it cannot and so communicates to it through ZK. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830078_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830078_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T15:08:45+0000\'\u003e19\\/Jan\\/17 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Comment was short because I was on my phone. Anyway, it\'s always a been a bug the leader even tries to do this. \\n\\n The way this should work is that replicas should set a watch on ZK LIR nodes so they are notified when put into LIR - so that if they can speak to ZK but are partitioned from the leader, they set themselves to not ACTIVE. In the SolrCloud design, no replica or leader should ever publish state for another replica or leader. Either the leader can talk to replica and puts it into recovery, or it cannot and so communicates to it through ZK.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15830080\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15830080&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15830080\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830080_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830080_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 15:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T15:09:11+0000\'\u003e19\\/Jan\\/17 15:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003e\\\"only set DOWN if current state is ACTIVE\\\"\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAnd yeah, this is also generally an anti pattern in the SolrCloud design.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830080_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830080_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 15:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T15:09:11+0000\'\u003e19\\/Jan\\/17 15:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     \\\"only set DOWN if current state is ACTIVE\\\"  \\n\\n And yeah, this is also generally an anti pattern in the SolrCloud design.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15830086\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15830086&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15830086\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830086_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830086_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 15:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T15:18:07+0000\'\u003e19\\/Jan\\/17 15:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhether the state of the replica is already RECOVERING or not makes no difference. If the leader is not able to send an update then that guarantee cannot be made and therefore it is safest to restart the recovery process.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAnd this is correct too. Everytime an update fails from leader to replica we have to ensure a new recovery starts. This is why recoveries used to be able to stack up and had to unwind, though we now at least short circuit stack ups.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830086_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830086_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 15:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T15:18:07+0000\'\u003e19\\/Jan\\/17 15:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Whether the state of the replica is already RECOVERING or not makes no difference. If the leader is not able to send an update then that guarantee cannot be made and therefore it is safest to restart the recovery process.  \\n\\n And this is correct too. Everytime an update fails from leader to replica we have to ensure a new recovery starts. This is why recoveries used to be able to stack up and had to unwind, though we now at least short circuit stack ups.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15830288\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15830288&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15830288\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830288_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830288_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 17:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T17:22:19+0000\'\u003e19\\/Jan\\/17 17:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eA replica should only ever publish its own state.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eTo be more precise, in normal mode of operation, this is true. You can imagine a further improvement in line with another JIRA we have that enables a replica to try and publish itself as DOWN if sees local resource issues. You can imagine a case where the replica might maintain it\'s ZK connection but not be operational. In this case a leader might recognize that and take hard core action like publishing DOWN for that replica. It should only do this as an emergency action though, after it\'s clear the replica still appears up but is useless or detrimental. In this common path for LIR, we should only be trying to communicate directly and through ZooKeeper and do no false publishing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15830288_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15830288_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/17 17:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-19T17:22:19+0000\'\u003e19\\/Jan\\/17 17:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     A replica should only ever publish its own state.  \\n\\n To be more precise, in normal mode of operation, this is true. You can imagine a further improvement in line with another JIRA we have that enables a replica to try and publish itself as DOWN if sees local resource issues. You can imagine a case where the replica might maintain it\'s ZK connection but not be operational. In this case a leader might recognize that and take hard core action like publishing DOWN for that replica. It should only do this as an emergency action though, after it\'s clear the replica still appears up but is useless or detrimental. In this common path for LIR, we should only be trying to communicate directly and through ZooKeeper and do no false publishing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15836870\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15836870&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15836870\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15836870_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15836870_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jan\\/17 23:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-24T23:51:19+0000\'\u003e24\\/Jan\\/17 23:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been thinking about this a bunch and have some observations.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe already have special nodes for LIR. It looks like these are currently only checked during leader election (or more generally, core load). If we instead have replicas watch for this at all times, then we wouldn\'t need to forcefully publish a down state, we could publish a down LIR state. Does this model move the race instead of eliminating it though? Alan\'s sequence would look like:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eA node goes down, and then restarts\u003c\\/li\u003e\\n\\t\u003cli\u003eThe leader tries to send a document to the starting node, and gets a 503 \'not ready yet\'\u003c\\/li\u003e\\n\\t\u003cli\u003eThe node publishes its state as RECOVERING\u003c\\/li\u003e\\n\\t\u003cli\u003eThe leader\'s LIR thread publishes the recovery node\'s LIR state as DOWN\u003c\\/li\u003e\\n\\t\u003cli\u003eThe node sends a PREPRECOVERY request to the leader\u003c\\/li\u003e\\n\\t\u003cli\u003eThe leader waits for the node\'s state to be RECOVERING, which it already is, and can proceed.\u003c\\/li\u003e\\n\\t\u003cli\u003eAt some point (possibly already happened) node sees new LIR state and abandons current recovery and starts a new one.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIn the case where we get an error during recovery, the recovering replica would know to restart recovery process, so that works too.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe would also need to keep the Active state in the LIR path instead of deleting it so that there is a node we that replicas can set a watcher on.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe potential downside here is that we end up keeping two copies of the state, but I think it\'s ok? One is what the replica thinks it is, and one is what the leader thinks it is. I\'ll keep thinking about this more, but I wonder if there\'s a way to condense all these operations down to one znode safely.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15836870_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15836870_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jan\\/17 23:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-24T23:51:19+0000\'\u003e24\\/Jan\\/17 23:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve been thinking about this a bunch and have some observations. \\n\\n We already have special nodes for LIR. It looks like these are currently only checked during leader election (or more generally, core load). If we instead have replicas watch for this at all times, then we wouldn\'t need to forcefully publish a down state, we could publish a down LIR state. Does this model move the race instead of eliminating it though? Alan\'s sequence would look like: \\n \\n\\t A node goes down, and then restarts \\n\\t The leader tries to send a document to the starting node, and gets a 503 \'not ready yet\' \\n\\t The node publishes its state as RECOVERING \\n\\t The leader\'s LIR thread publishes the recovery node\'s LIR state as DOWN \\n\\t The node sends a PREPRECOVERY request to the leader \\n\\t The leader waits for the node\'s state to be RECOVERING, which it already is, and can proceed. \\n\\t At some point (possibly already happened) node sees new LIR state and abandons current recovery and starts a new one. \\n \\n\\n\\n In the case where we get an error during recovery, the recovering replica would know to restart recovery process, so that works too. \\n\\n We would also need to keep the Active state in the LIR path instead of deleting it so that there is a node we that replicas can set a watcher on. \\n\\n The potential downside here is that we end up keeping two copies of the state, but I think it\'s ok? One is what the replica thinks it is, and one is what the leader thinks it is. I\'ll keep thinking about this more, but I wonder if there\'s a way to condense all these operations down to one znode safely.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15836899\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15836899&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15836899\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15836899_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15836899_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/17 00:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-25T00:08:56+0000\'\u003e25\\/Jan\\/17 00:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe potential downside here is that we end up keeping two copies of the state, but I think it\'s ok? One is what the replica thinks it is, and one is what the leader thinks it is\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m not sure if we really have to end up doing that. We already are communicating in ZK in a way that the replica can see itself it needs to enter recovery. I think we just need a strategy for the replica to have watches that alert it the leader has put it in LIR. The first time it notices this, it can be sure to go into recovery - it may even be better to only do that and remove the code that has the leader ask the replica to go into recovery on each failure. I think we can do that by pre creating some base LIR nodes and then watch it\'s children or something along those lines. Each LIR node in ZK could have a unique version so that we could tell if a new LIR request came in while responding to one (so start recovery over).\u003c\\/p\u003e\\n\\n\u003cp\u003eWe should assume the replica can simply be alerted to mark itself as down when it sees it\'s been marked on LIR. If its too messed up to do that, it should lose it\'s zk connection, and if not, I think that\'s a corner case that needs an alternate solution.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15836899_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15836899_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/17 00:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-01-25T00:08:56+0000\'\u003e25\\/Jan\\/17 00:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The potential downside here is that we end up keeping two copies of the state, but I think it\'s ok? One is what the replica thinks it is, and one is what the leader thinks it is  \\n\\n I\'m not sure if we really have to end up doing that. We already are communicating in ZK in a way that the replica can see itself it needs to enter recovery. I think we just need a strategy for the replica to have watches that alert it the leader has put it in LIR. The first time it notices this, it can be sure to go into recovery - it may even be better to only do that and remove the code that has the leader ask the replica to go into recovery on each failure. I think we can do that by pre creating some base LIR nodes and then watch it\'s children or something along those lines. Each LIR node in ZK could have a unique version so that we could tell if a new LIR request came in while responding to one (so start recovery over). \\n\\n We should assume the replica can simply be alerted to mark itself as down when it sees it\'s been marked on LIR. If its too messed up to do that, it should lose it\'s zk connection, and if not, I think that\'s a corner case that needs an alternate solution.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15872751\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15872751&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15872751\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15872751_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15872751_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/17 23:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-02-17T23:46:54+0000\'\u003e17\\/Feb\\/17 23:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s a work in progress patch. The rough outline of the changes is:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhen publishing an active state, also publish an Active into the LIR znode and put a watch on that. If the leader overwrites this as down, start recovery.\\n\\t\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\\t\u003cli\u003eI tried to have a check here to ensure that nodes can only publish themselves as active, but I got messed up on the logic. Not sure if it\'s necessary for correctness, but felt like a good safegaurd.\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eLeader no longer needs to send a request recovery command directly to the replica. The ZK watch should handle this.\u003c\\/li\u003e\\n\\t\u003cli\u003eLeader no longer publishes the node\'s state. The node will update this itself when it starts the recovery process.\\n\\t\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\\t\u003cli\u003eThis means that there is a period of time after the leader has encountered the first error and before the node puts itself into recovery that the leader may try to send additional updates and get additional errors. Might need a flag to mark the node as dead locally or something like that.\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eI\'ve got about 5 test failures here, and I put an \u003ctt\u003e@Ignore\u003c\\/tt\u003e on the TestLeaderInitiatedRecoveryThread class because the whole internals of that are changing. I think I somehow broke leader election with this change set, so any help would be appreciated.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15872751_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15872751_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/17 23:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-02-17T23:46:54+0000\'\u003e17\\/Feb\\/17 23:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s a work in progress patch. The rough outline of the changes is: \\n \\n\\t When publishing an active state, also publish an Active into the LIR znode and put a watch on that. If the leader overwrites this as down, start recovery.\\n\\t \\n\\t\\t I tried to have a check here to ensure that nodes can only publish themselves as active, but I got messed up on the logic. Not sure if it\'s necessary for correctness, but felt like a good safegaurd. \\n\\t \\n\\t \\n\\t Leader no longer needs to send a request recovery command directly to the replica. The ZK watch should handle this. \\n\\t Leader no longer publishes the node\'s state. The node will update this itself when it starts the recovery process.\\n\\t \\n\\t\\t This means that there is a period of time after the leader has encountered the first error and before the node puts itself into recovery that the leader may try to send additional updates and get additional errors. Might need a flag to mark the node as dead locally or something like that. \\n\\t \\n\\t \\n \\n\\n\\n\\n I\'ve got about 5 test failures here, and I put an  @Ignore  on the TestLeaderInitiatedRecoveryThread class because the whole internals of that are changing. I think I somehow broke leader election with this change set, so any help would be appreciated.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15888501\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15888501&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15888501\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15888501_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15888501_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/17 17:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-02-28T17:27:46+0000\'\u003e28\\/Feb\\/17 17:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is a great start Mike, I\'ll take a look. One thing I have been thinking about is perhaps queuing up LIR publishes to ZK for a second or 2 rather than hitting it for every update. You can index thousands of documents per second and they can fail by the thousands, so it would be nice to have a little throttle on ZK communication.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMight need a flag to mark the node as dead locally or something like that.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t know that it\'s critical, because this would always be a problem to a lesser degree anyway, but this is probably a good idea. I don\'t know how tricky it ends up being, but seems like we could locally mark the state as down until we notice it\'s state change in the clusterstate.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15888501_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15888501_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/17 17:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-02-28T17:27:46+0000\'\u003e28\\/Feb\\/17 17:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is a great start Mike, I\'ll take a look. One thing I have been thinking about is perhaps queuing up LIR publishes to ZK for a second or 2 rather than hitting it for every update. You can index thousands of documents per second and they can fail by the thousands, so it would be nice to have a little throttle on ZK communication. \\n\\n  Might need a flag to mark the node as dead locally or something like that.  \\n\\n I don\'t know that it\'s critical, because this would always be a problem to a lesser degree anyway, but this is probably a good idea. I don\'t know how tricky it ends up being, but seems like we could locally mark the state as down until we notice it\'s state change in the clusterstate.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15964649\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15964649&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15964649\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_15964649_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15964649_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Apr\\/17 17:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-11T17:09:15+0000\'\u003e11\\/Apr\\/17 17:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m looking at the patch and It seems that \u003ctt\u003eForceLeaderTest\u003c\\/tt\u003e is failed with the patch. The reason for that problem is when we close SocketProxy for none leader node, these nodes can still talk to the leader node ( I think this is big problem for our jetty proxy stuff, right? ), so if they being putted into lir down, they still can run recovery successfully and become active. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_15964649_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15964649_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Apr\\/17 17:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-11T17:09:15+0000\'\u003e11\\/Apr\\/17 17:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m looking at the patch and It seems that  ForceLeaderTest  is failed with the patch. The reason for that problem is when we close SocketProxy for none leader node, these nodes can still talk to the leader node ( I think this is big problem for our jetty proxy stuff, right? ), so if they being putted into lir down, they still can run recovery successfully and become active.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969118\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969118&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969118\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15969118_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969118_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 15:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T15:04:58+0000\'\u003e14\\/Apr\\/17 15:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\" class=\\\"user-hover\\\" rel=\\\"caomanhdat\\\"\u003eCao Manh Dat\u003c\\/a\u003e - yea, ForceLeaderTest was one of the ones that was failing for me. A node still able to recover when it shouldn\'t would make sense, but I don\'t really understand how the proxy stuff works enough to debug it or know how to fix it. Is the right path to rip the proxy stuff out and kill nodes some other way?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15969118_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969118_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 15:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T15:04:58+0000\'\u003e14\\/Apr\\/17 15:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Cao Manh Dat  - yea, ForceLeaderTest was one of the ones that was failing for me. A node still able to recover when it shouldn\'t would make sense, but I don\'t really understand how the proxy stuff works enough to debug it or know how to fix it. Is the right path to rip the proxy stuff out and kill nodes some other way?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969127\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969127&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969127\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969127_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969127_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T15:16:46+0000\'\u003e14\\/Apr\\/17 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 14\\/Apr\\/17 15:17\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI think this is big problem for our jetty proxy stuff, right?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI guess it depends on the test. \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=thelabdude\\\" class=\\\"user-hover\\\" rel=\\\"thelabdude\\\"\u003eTimothy Potter\u003c\\/a\u003e], any thoughts on this comment?\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not sure we want to rip the proxy stuff out just yet, but we do want to look into \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\" class=\\\"user-hover\\\" rel=\\\"caomanhdat\\\"\u003eCao Manh Dat\u003c\\/a\u003e\'s comment and perhaps see if we can improve things if we need to.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969127_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969127_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T15:16:46+0000\'\u003e14\\/Apr\\/17 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 14\\/Apr\\/17 15:17\\\"\u003eedited\u003c\\/span\u003e                    I think this is big problem for our jetty proxy stuff, right?  \\n\\n I guess it depends on the test.  Timothy Potter ], any thoughts on this comment? \\n\\n I\'m not sure we want to rip the proxy stuff out just yet, but we do want to look into  Cao Manh Dat \'s comment and perhaps see if we can improve things if we need to.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969139\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969139&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969139\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969139_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969139_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 15:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T15:23:06+0000\'\u003e14\\/Apr\\/17 15:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy first thought would be to guess that ForceLeaderTest is just using the proxy stuff incorrectly. Turning off the proxy for a jetty cuts off communication to that jetty (to the port that jetty is listening on), not also \'from\' that jetty was my understanding.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969139_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969139_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 15:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T15:23:06+0000\'\u003e14\\/Apr\\/17 15:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My first thought would be to guess that ForceLeaderTest is just using the proxy stuff incorrectly. Turning off the proxy for a jetty cuts off communication to that jetty (to the port that jetty is listening on), not also \'from\' that jetty was my understanding.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969172\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969172&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969172\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15969172_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969172_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 15:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T15:44:15+0000\'\u003e14\\/Apr\\/17 15:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI guess I was unclear. I meant to rip the proxy stuff out \u003cem\u003efrom this test\u003c\\/em\u003e. I\'m sure it\'s fine (and necessary) elsewhere.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15969172_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969172_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 15:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T15:44:15+0000\'\u003e14\\/Apr\\/17 15:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I guess I was unclear. I meant to rip the proxy stuff out  from this test . I\'m sure it\'s fine (and necessary) elsewhere.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969203\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969203&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969203\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969203_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969203_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T16:03:29+0000\'\u003e14\\/Apr\\/17 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI suppose that depends on if it\'s the same as removing force leader test coverage. We want to maintain it if we can - whether that means using the proxy, changing we use it, or changing the test. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969203_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969203_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T16:03:29+0000\'\u003e14\\/Apr\\/17 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I suppose that depends on if it\'s the same as removing force leader test coverage. We want to maintain it if we can - whether that means using the proxy, changing we use it, or changing the test.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969221\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969221&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969221\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969221_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969221_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 16:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T16:16:34+0000\'\u003e14\\/Apr\\/17 16:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMaybe we can just close the leader proxy before we index the docs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969221_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969221_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 16:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T16:16:34+0000\'\u003e14\\/Apr\\/17 16:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Maybe we can just close the leader proxy before we index the docs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969334\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969334&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969334\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969334_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969334_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 17:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T17:54:52+0000\'\u003e14\\/Apr\\/17 17:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003emore precisely, if the issue is as stated, it would seem the problem is that we stop the replicas from being able to receive requests, then we index 2 docs, then we kill the leader and close it\'s proxy. That is where there seems to be room for a replica to recover from the leader. If we do getProxyForReplica(leader).close() when we close the replica proxies, that should prevent any replica from being able to recover from it even before we kill the leader jetty. Doesn\'t seem like it would have any negative consequences either on first look. It\'s not like the test expects a replica to still be able to talk to the leader during this point, right?\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ ok, now introduce a network partition between the leader and both replicas\\n\u003c\\/span\u003e    log.info(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Closing proxies \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e the non-leader replicas...\\\"\u003c\\/span\u003e);\\n    \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (SocketProxy proxy : nonLeaderProxies)\\n      proxy.close();\\n\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ indexing during a partition\\n\u003c\\/span\u003e    log.info(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Sending a doc during the network partition...\\\"\u003c\\/span\u003e);\\n    sendDoc(2);\\n\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Wait a little\\n\u003c\\/span\u003e    \u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.sleep(2000);\\n\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Kill the leader\\n\u003c\\/span\u003e    log.info(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Killing leader \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e shard1 of \\\"\u003c\\/span\u003e + collectionName + \u003cspan class=\\\"code-quote\\\"\u003e\\\" on node \\\"\u003c\\/span\u003e + leader.getNodeName() + \\\"\\\");\\n    JettySolrRunner leaderJetty = getJettyOnPort(getReplicaPort(leader));\\n    getProxyForReplica(leader).close();\\n    leaderJetty.stop();\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969334_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969334_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 17:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T17:54:52+0000\'\u003e14\\/Apr\\/17 17:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    more precisely, if the issue is as stated, it would seem the problem is that we stop the replicas from being able to receive requests, then we index 2 docs, then we kill the leader and close it\'s proxy. That is where there seems to be room for a replica to recover from the leader. If we do getProxyForReplica(leader).close() when we close the replica proxies, that should prevent any replica from being able to recover from it even before we kill the leader jetty. Doesn\'t seem like it would have any negative consequences either on first look. It\'s not like the test expects a replica to still be able to talk to the leader during this point, right? \\n\\n  \\n      \\/\\/ ok, now introduce a network partition between the leader and both replicas\\n     log.info( \\\"Closing proxies  for  the non-leader replicas...\\\" );\\n     for  (SocketProxy proxy : nonLeaderProxies)\\n      proxy.close();\\n\\n     \\/\\/ indexing during a partition\\n     log.info( \\\"Sending a doc during the network partition...\\\" );\\n    sendDoc(2);\\n\\n     \\/\\/ Wait a little\\n      Thread .sleep(2000);\\n\\n     \\/\\/ Kill the leader\\n     log.info( \\\"Killing leader  for  shard1 of \\\"  + collectionName +  \\\" on node \\\"  + leader.getNodeName() + \\\"\\\");\\n    JettySolrRunner leaderJetty = getJettyOnPort(getReplicaPort(leader));\\n    getProxyForReplica(leader).close();\\n    leaderJetty.stop();\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969337\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969337&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969337\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969337_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969337_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T17:56:12+0000\'\u003e14\\/Apr\\/17 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eInstead we would do:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ ok, now introduce a network partition between the leader and both replicas\\n\u003c\\/span\u003e    log.info(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Closing proxies \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e the non-leader replicas...\\\"\u003c\\/span\u003e);\\n    \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (SocketProxy proxy : nonLeaderProxies)\\n      proxy.close();\\n\\n    JettySolrRunner leaderJetty = getJettyOnPort(getReplicaPort(leader));\\n    getProxyForReplica(leader).close();\\n\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ indexing during a partition\\n\u003c\\/span\u003e    log.info(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Sending a doc during the network partition...\\\"\u003c\\/span\u003e);\\n    sendDoc(2);\\n\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Wait a little\\n\u003c\\/span\u003e    \u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.sleep(2000);\\n\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Kill the leader\\n\u003c\\/span\u003e    log.info(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Killing leader \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e shard1 of \\\"\u003c\\/span\u003e + collectionName + \u003cspan class=\\\"code-quote\\\"\u003e\\\" on node \\\"\u003c\\/span\u003e + leader.getNodeName() + \\\"\\\");\\n    leaderJetty.stop();\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969337_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969337_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/17 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-14T17:56:12+0000\'\u003e14\\/Apr\\/17 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Instead we would do: \\n\\n  \\n      \\/\\/ ok, now introduce a network partition between the leader and both replicas\\n     log.info( \\\"Closing proxies  for  the non-leader replicas...\\\" );\\n     for  (SocketProxy proxy : nonLeaderProxies)\\n      proxy.close();\\n\\n    JettySolrRunner leaderJetty = getJettyOnPort(getReplicaPort(leader));\\n    getProxyForReplica(leader).close();\\n\\n     \\/\\/ indexing during a partition\\n     log.info( \\\"Sending a doc during the network partition...\\\" );\\n    sendDoc(2);\\n\\n     \\/\\/ Wait a little\\n      Thread .sleep(2000);\\n\\n     \\/\\/ Kill the leader\\n     log.info( \\\"Killing leader  for  shard1 of \\\"  + collectionName +  \\\" on node \\\"  + leader.getNodeName() + \\\"\\\");\\n    leaderJetty.stop();\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969818\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969818&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969818\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969818_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969818_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Apr\\/17 05:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-15T05:22:34+0000\'\u003e15\\/Apr\\/17 05:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe would probably also have to be sure and index directly to the leader if that is not the current behavior.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969818_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969818_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Apr\\/17 05:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-15T05:22:34+0000\'\u003e15\\/Apr\\/17 05:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We would probably also have to be sure and index directly to the leader if that is not the current behavior.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15969819\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15969819&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15969819\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969819_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969819_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Apr\\/17 05:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-15T05:26:40+0000\'\u003e15\\/Apr\\/17 05:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnd I suppose to hit the leader we would have to hit the actual leader jetty port. I assume that is still possible? Have not looked into it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15969819_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15969819_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Apr\\/17 05:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-15T05:26:40+0000\'\u003e15\\/Apr\\/17 05:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    And I suppose to hit the leader we would have to hit the actual leader jetty port. I assume that is still possible? Have not looked into it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15971711\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15971711&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15971711\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15971711_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15971711_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Apr\\/17 21:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-17T21:59:03+0000\'\u003e17\\/Apr\\/17 21:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eContinuing to work on this. I think I\'ve actually made progress on the design part of it, but I feel like I\'m backsliding on the implementation.\u003c\\/p\u003e\\n\\n\u003cp\u003eSummary of changes:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eRemoves LIRThread\u003c\\/li\u003e\\n\\t\u003cli\u003eMoves LIR down notification entirely to ZK\u003c\\/li\u003e\\n\\t\u003cli\u003eEach core sets a watch on LIR node when publishing self as active to be aware of LIR state changes.\u003c\\/li\u003e\\n\\t\u003cli\u003eEach leader sets a watch on LIR when publishing follower into LIR to know when it has started to recover and can start sending updates again.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15971711_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15971711_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Apr\\/17 21:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-17T21:59:03+0000\'\u003e17\\/Apr\\/17 21:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Continuing to work on this. I think I\'ve actually made progress on the design part of it, but I feel like I\'m backsliding on the implementation. \\n\\n Summary of changes: \\n \\n\\t Removes LIRThread \\n\\t Moves LIR down notification entirely to ZK \\n\\t Each core sets a watch on LIR node when publishing self as active to be aware of LIR state changes. \\n\\t Each leader sets a watch on LIR when publishing follower into LIR to know when it has started to recover and can start sending updates again. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15973650\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15973650&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15973650\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15973650_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15973650_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Apr\\/17 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-18T22:48:31+0000\'\u003e18\\/Apr\\/17 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooking at the \u003ctt\u003eForceLeaderTest\u003c\\/tt\u003e code snippet that you posted, \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e, I don\'t think we can reorder to kill the leader first. We close the followers\' connections, and then need to send a doc so that it can fail to distribute and that is what triggers the LIR. So I get the impression that closing a proxy only prevents inbound connections, not outbound connections, which is why the followers are able to recover gracefully. Interestingly, removing the 2 second sleep allows the test to pass for me, and I can\'t see how it invalidates the premises under test here.\u003c\\/p\u003e\\n\\n\u003cp\u003eIntermittently, \u003ctt\u003eForceLeaderTest::testReplicasInLIRNoLeader\u003c\\/tt\u003e will still fail for me, and I haven\'t figured that one out yet since I haven\'t caught it with a reproducible seed yet.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve had a few more other test failures in the total suite, but I think this patch is getting close to finished.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15973650_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15973650_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Apr\\/17 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-18T22:48:31+0000\'\u003e18\\/Apr\\/17 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looking at the  ForceLeaderTest  code snippet that you posted,  Mark Miller , I don\'t think we can reorder to kill the leader first. We close the followers\' connections, and then need to send a doc so that it can fail to distribute and that is what triggers the LIR. So I get the impression that closing a proxy only prevents inbound connections, not outbound connections, which is why the followers are able to recover gracefully. Interestingly, removing the 2 second sleep allows the test to pass for me, and I can\'t see how it invalidates the premises under test here. \\n\\n Intermittently,  ForceLeaderTest::testReplicasInLIRNoLeader  will still fail for me, and I haven\'t figured that one out yet since I haven\'t caught it with a reproducible seed yet. \\n\\n I\'ve had a few more other test failures in the total suite, but I think this patch is getting close to finished.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15974803\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15974803&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15974803\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15974803_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15974803_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/17 14:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-19T14:40:34+0000\'\u003e19\\/Apr\\/17 14:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 19\\/Apr\\/17 14:45\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWe close the followers\' connections, and then need to send a doc so that it can fail to distribute and that is what triggers the LIR.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis comment applies to that: And I suppose to hit the leader we would have to hit the actual leader jetty port (there should be the proxy port, and the legit jetty port). I assume that is still possible? Have not looked into it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15974803_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15974803_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/17 14:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-19T14:40:34+0000\'\u003e19\\/Apr\\/17 14:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 19\\/Apr\\/17 14:45\\\"\u003eedited\u003c\\/span\u003e                    We close the followers\' connections, and then need to send a doc so that it can fail to distribute and that is what triggers the LIR.  \\n\\n This comment applies to that: And I suppose to hit the leader we would have to hit the actual leader jetty port (there should be the proxy port, and the legit jetty port). I assume that is still possible? Have not looked into it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15974808\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15974808&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15974808\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15974808_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15974808_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/17 14:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-19T14:43:51+0000\'\u003e19\\/Apr\\/17 14:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 19\\/Apr\\/17 14:44\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eSo I get the impression that closing a proxy only prevents inbound connections, not outbound connections, which is why the followers are able to recover gracefully. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes, the idea of the proxy is simple afaik. It pipes from one port to another, and so lets you cut off the connection or play other weird games if you want. The is the port jetty listens out, there is no interaction with outbound connections. That is why the ForceLeaderTest is not written correctly. I think you can write it correctly as I describe above though with a few simple changes.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eInterestingly, removing the 2 second sleep allows the test to pass for me, and I can\'t see how it invalidates the premises under test here.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t know that it invalidates anything, it just is a little flakey and failure prone to count on something like this, especially with all the env and gc events and parallel tests we run. We want rock solid.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15974808_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15974808_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/17 14:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-19T14:43:51+0000\'\u003e19\\/Apr\\/17 14:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 19\\/Apr\\/17 14:44\\\"\u003eedited\u003c\\/span\u003e                    So I get the impression that closing a proxy only prevents inbound connections, not outbound connections, which is why the followers are able to recover gracefully.   \\n\\n Yes, the idea of the proxy is simple afaik. It pipes from one port to another, and so lets you cut off the connection or play other weird games if you want. The is the port jetty listens out, there is no interaction with outbound connections. That is why the ForceLeaderTest is not written correctly. I think you can write it correctly as I describe above though with a few simple changes. \\n\\n  Interestingly, removing the 2 second sleep allows the test to pass for me, and I can\'t see how it invalidates the premises under test here.  \\n\\n I don\'t know that it invalidates anything, it just is a little flakey and failure prone to count on something like this, especially with all the env and gc events and parallel tests we run. We want rock solid.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15974813\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15974813&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15974813\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15974813_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15974813_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/17 14:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-19T14:48:29+0000\'\u003e19\\/Apr\\/17 14:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf everything else is in order though, I can try and tackle that test before commit. I\'m pretty sure we can bypass the proxy to send updates to the leader. There are a lot of things we might want to test like this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15974813_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15974813_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Apr\\/17 14:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-19T14:48:29+0000\'\u003e19\\/Apr\\/17 14:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If everything else is in order though, I can try and tackle that test before commit. I\'m pretty sure we can bypass the proxy to send updates to the leader. There are a lot of things we might want to test like this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15977597\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15977597&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15977597\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15977597_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15977597_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/17 21:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-20T21:42:50+0000\'\u003e20\\/Apr\\/17 21:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis one is pretty close, give it a look and let me know what y\'all think. Depends on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-10525\\\" title=\\\"Stacked recovery requests do no cancel an in progress recovery first.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-10525\\\"\u003e\u003cdel\u003eSOLR-10525\u003c\\/del\u003e\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003ecc: \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\" class=\\\"user-hover\\\" rel=\\\"caomanhdat\\\"\u003eCao Manh Dat\u003c\\/a\u003e, \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\" class=\\\"user-hover\\\" rel=\\\"shalinmangar\\\"\u003eShalin Shekhar Mangar\u003c\\/a\u003e, \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15977597_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15977597_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/17 21:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-20T21:42:50+0000\'\u003e20\\/Apr\\/17 21:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This one is pretty close, give it a look and let me know what y\'all think. Depends on   SOLR-10525  . \\n\\n cc:  Cao Manh Dat ,  Shalin Shekhar Mangar ,  Mark Miller               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15979840\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15979840&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15979840\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15979840_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15979840_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Apr\\/17 09:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-22T09:46:25+0000\'\u003e22\\/Apr\\/17 09:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Mike, I\'ll review it on Monday.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shalinmangar\\\" id=\\\"commentauthor_15979840_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shalinmangar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shalinmangar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shalin Shekhar Mangar\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15979840_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Apr\\/17 09:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-22T09:46:25+0000\'\u003e22\\/Apr\\/17 09:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Mike, I\'ll review it on Monday.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15980740\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15980740&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15980740\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15980740_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15980740_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 05:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T05:27:58+0000\'\u003e24\\/Apr\\/17 05:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI commented a bit more about this in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-10525\\\" title=\\\"Stacked recovery requests do no cancel an in progress recovery first.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-10525\\\"\u003e\u003cdel\u003eSOLR-10525\u003c\\/del\u003e\u003c\\/a\u003e, but the gist is, I think we should take this opportunity to stop trying to do LIR per update. We don\'t want update volume to be in control of how much chatter this generates any longer. What we really need is to simply trigger something that says, let the replica know it needs to enter recovery, and send that to ZK at some throttled rate that has a chatter \\/ delay tradeoff that we control. Even if we allowed this once or twice per second or something, thats drastically better than the 1000\'s per second you can hit now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15980740_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15980740_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 05:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T05:27:58+0000\'\u003e24\\/Apr\\/17 05:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I commented a bit more about this in   SOLR-10525  , but the gist is, I think we should take this opportunity to stop trying to do LIR per update. We don\'t want update volume to be in control of how much chatter this generates any longer. What we really need is to simply trigger something that says, let the replica know it needs to enter recovery, and send that to ZK at some throttled rate that has a chatter \\/ delay tradeoff that we control. Even if we allowed this once or twice per second or something, thats drastically better than the 1000\'s per second you can hit now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15980742\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15980742&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15980742\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15980742_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15980742_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 05:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T05:32:18+0000\'\u003e24\\/Apr\\/17 05:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe can open a new issue on that realistically if we don\'t want to tackle it right away though.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll spend some time with the latest patch tomorrow.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15980742_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15980742_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 05:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T05:32:18+0000\'\u003e24\\/Apr\\/17 05:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We can open a new issue on that realistically if we don\'t want to tackle it right away though. \\n\\n I\'ll spend some time with the latest patch tomorrow.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15981298\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15981298&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15981298\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15981298_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15981298_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 14:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T14:57:31+0000\'\u003e24\\/Apr\\/17 14:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI think we should take this opportunity to stop trying to do LIR per update\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eMy patch kind of does this.\u003c\\/p\u003e\\n\\n\u003cp\u003eBefore, we would locally mark a follower as in LIR after a failed update. Then when the LIR thread successfully sent a recovery request, we would unmark it, after which we start sending more updates (to buffer) and if those fail more requests. This could lead to a lot of recovery requests stacking up, hence the need to discard them at the follower.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith my patch, we still locally mark a replica as in LIR. However, we won\'t unmark it until we see that it has ack\'d the LIR update in ZK and updated itself to \'recovering\'. I don\'t know how fast this process can be, maybe it can still be 1000s per second. I imagine that going through ZK and having to wait long enough to actually start a recovery necessarily makes it slower.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf it\'s still bad, we can add a configurable 100ms sleep to the start of any recovery. In actual use, it shouldn\'t affect things too much since the rest of the recovery will be much longer, but it would be enough to throttle things.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15981298_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15981298_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 14:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T14:57:31+0000\'\u003e24\\/Apr\\/17 14:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I think we should take this opportunity to stop trying to do LIR per update  \\n My patch kind of does this. \\n\\n Before, we would locally mark a follower as in LIR after a failed update. Then when the LIR thread successfully sent a recovery request, we would unmark it, after which we start sending more updates (to buffer) and if those fail more requests. This could lead to a lot of recovery requests stacking up, hence the need to discard them at the follower. \\n\\n With my patch, we still locally mark a replica as in LIR. However, we won\'t unmark it until we see that it has ack\'d the LIR update in ZK and updated itself to \'recovering\'. I don\'t know how fast this process can be, maybe it can still be 1000s per second. I imagine that going through ZK and having to wait long enough to actually start a recovery necessarily makes it slower. \\n\\n If it\'s still bad, we can add a configurable 100ms sleep to the start of any recovery. In actual use, it shouldn\'t affect things too much since the rest of the recovery will be much longer, but it would be enough to throttle things.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15981460\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15981460&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15981460\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15981460_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15981460_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T16:28:21+0000\'\u003e24\\/Apr\\/17 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooking at my patch again, I can\'t tell if there is a really subtle bug going on with the ZK watches or not. When setting the LIR state to down, we will add a watch that will notify us when the LIR state changes next and if it\'s no longer down (i.e. recovering) then we can un-blacklist the follower for updates. However, if it\'s still down when we get that request (or down again, I guess?) then we won\'t get any notifications the next time it actually changes state to recovering. Except whatever set the second down state should have also set a new watch, so I think we\'re still fine. Would appreciate somebody taking a close look at this though.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, it\'s possible that we might need to call \u003ctt\u003ereplicasInLeaderInitiatedRecovery.remove(znodePath);\u003c\\/tt\u003e when we get a prep recovery request instead?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15981460_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15981460_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T16:28:21+0000\'\u003e24\\/Apr\\/17 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looking at my patch again, I can\'t tell if there is a really subtle bug going on with the ZK watches or not. When setting the LIR state to down, we will add a watch that will notify us when the LIR state changes next and if it\'s no longer down (i.e. recovering) then we can un-blacklist the follower for updates. However, if it\'s still down when we get that request (or down again, I guess?) then we won\'t get any notifications the next time it actually changes state to recovering. Except whatever set the second down state should have also set a new watch, so I think we\'re still fine. Would appreciate somebody taking a close look at this though. \\n\\n Also, it\'s possible that we might need to call  replicasInLeaderInitiatedRecovery.remove(znodePath);  when we get a prep recovery request instead?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15981615\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15981615&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15981615\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15981615_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15981615_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 18:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T18:22:37+0000\'\u003e24\\/Apr\\/17 18:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehaven\'t caught up on your comments yet, but FYI, I\'ve been seeing consistent fails during ant test on the force leader test. Either threads leaking due to some resource leak and recently the following NPE:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e   [junit4]   2&gt; NOTE: reproduce with: ant test  -Dtestcase=ForceLeaderTest -Dtests.method=testReplicasInLIRNoLeader -Dtests.seed=AE8388F349DFBDA7 -Dtests.slow=true -Dtests.locale=ms -Dtests.timezone=AET -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\\n   [junit4] ERROR   21.2s J1 | ForceLeaderTest.testReplicasInLIRNoLeader &lt;&lt;&lt;\\n   [junit4]    &gt; Throwable #1: java.lang.NullPointerException\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([AE8388F349DFBDA7:4814BC33705D44C6]:0)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:1182)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:1073)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.AbstractFullDistribZkTestBase.sendDocsWithRetry(AbstractFullDistribZkTestBase.java:749)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.ForceLeaderTest.putNonLeadersIntoLIR(ForceLeaderTest.java:359)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.ForceLeaderTest.testReplicasInLIRNoLeader(ForceLeaderTest.java:97)\\n   [junit4]    &gt; \\tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:985)\\n   [junit4]    &gt; \\tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:960)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15981615_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15981615_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 18:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T18:22:37+0000\'\u003e24\\/Apr\\/17 18:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    haven\'t caught up on your comments yet, but FYI, I\'ve been seeing consistent fails during ant test on the force leader test. Either threads leaking due to some resource leak and recently the following NPE: \\n\\n  \\n    [junit4]   2&gt; NOTE: reproduce with: ant test  -Dtestcase=ForceLeaderTest -Dtests.method=testReplicasInLIRNoLeader -Dtests.seed=AE8388F349DFBDA7 -Dtests.slow=true -Dtests.locale=ms -Dtests.timezone=AET -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\\n   [junit4] ERROR   21.2s J1 | ForceLeaderTest.testReplicasInLIRNoLeader &lt;&lt;&lt;\\n   [junit4]    &gt; Throwable #1: java.lang.NullPointerException\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([AE8388F349DFBDA7:4814BC33705D44C6]:0)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:1182)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:1073)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.AbstractFullDistribZkTestBase.sendDocsWithRetry(AbstractFullDistribZkTestBase.java:749)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.ForceLeaderTest.putNonLeadersIntoLIR(ForceLeaderTest.java:359)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.ForceLeaderTest.testReplicasInLIRNoLeader(ForceLeaderTest.java:97)\\n   [junit4]    &gt; \\tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:985)\\n   [junit4]    &gt; \\tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:960)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15981644\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15981644&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15981644\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15981644_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15981644_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 18:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T18:38:30+0000\'\u003e24\\/Apr\\/17 18:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf it\'s still bad,\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAh, ok, if you throttle with the watch implementation, that is an improvement. I don\'t think we want the per failed update call to ZK either though. We never really should have had per update communication like this, to ZK or the replica. It looked like we still did that, but I\'m still going through the patch. Have been focusing more on testing initially.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15981644_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15981644_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/17 18:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-24T18:38:30+0000\'\u003e24\\/Apr\\/17 18:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If it\'s still bad,  \\n\\n Ah, ok, if you throttle with the watch implementation, that is an improvement. I don\'t think we want the per failed update call to ZK either though. We never really should have had per update communication like this, to ZK or the replica. It looked like we still did that, but I\'m still going through the patch. Have been focusing more on testing initially.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15983273\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15983273&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15983273\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15983273_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15983273_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/17 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-25T17:15:04+0000\'\u003e25\\/Apr\\/17 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mike Drob - 25\\/Apr\\/17 18:50\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s a patch that fixes the resource leak. I\'m still getting a different kind of failure now, that doesn\'t reproduce for me. It shouldn\'t be happening at all since the previous two asserts check for each of the docs individually, so I don\'t understand how they could be missing on the next query. Going to need help on figuring out what\'s wrong here.\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe related to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-10562\\\" title=\\\"TestSolrCLIRunExample failures indicating documents just indexed are not all searchable.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-10562\\\"\u003eSOLR-10562\u003c\\/a\u003e, since there is a difference between using RTG or not after a commit.\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e  2&gt; NOTE: reproduce with: ant test  -Dtestcase=ForceLeaderTest -Dtests.method=testReplicasInLIRNoLeader -Dtests.seed=B6BDBFC48B148FB6 -Dtests.slow=true -Dtests.locale=en -Dtests.timezone=Europe\\/Belgrade -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\\n[11:25:21.677] FAILURE 45.6s | ForceLeaderTest.testReplicasInLIRNoLeader &lt;&lt;&lt;\\n   &gt; Throwable #1: java.lang.AssertionError: Expected only 2 documents in the index expected:&lt;2&gt; but was:&lt;0&gt;\\n   &gt;    at __randomizedtesting.SeedInfo.seed([B6BDBFC48B148FB6:502A8B04B29676D7]:0)\\n   &gt;    at org.junit.Assert.fail(Assert.java:93)\\n   &gt;    at org.junit.Assert.failNotEquals(Assert.java:647)\\n   &gt;    at org.junit.Assert.assertEquals(Assert.java:128)\\n   &gt;    at org.junit.Assert.assertEquals(Assert.java:472)\\n   &gt;    at org.apache.solr.cloud.ForceLeaderTest.testReplicasInLIRNoLeader(ForceLeaderTest.java:152)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eEdit: When I say \\\"doesn\'t reproduce\\\" I mean that rerunning with the same seed doesn\'t cause it to always fail, but running \u003ctt\u003eant test\u003c\\/tt\u003e will get a failure maybe 20% of the time.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15983273_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15983273_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/17 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-25T17:15:04+0000\'\u003e25\\/Apr\\/17 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mike Drob - 25\\/Apr\\/17 18:50\\\"\u003eedited\u003c\\/span\u003e                   Here\'s a patch that fixes the resource leak. I\'m still getting a different kind of failure now, that doesn\'t reproduce for me. It shouldn\'t be happening at all since the previous two asserts check for each of the docs individually, so I don\'t understand how they could be missing on the next query. Going to need help on figuring out what\'s wrong here. \\n\\n Maybe related to  SOLR-10562 , since there is a difference between using RTG or not after a commit. \\n\\n  \\n   2&gt; NOTE: reproduce with: ant test  -Dtestcase=ForceLeaderTest -Dtests.method=testReplicasInLIRNoLeader -Dtests.seed=B6BDBFC48B148FB6 -Dtests.slow=true -Dtests.locale=en -Dtests.timezone=Europe\\/Belgrade -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\\n[11:25:21.677] FAILURE 45.6s | ForceLeaderTest.testReplicasInLIRNoLeader &lt;&lt;&lt;\\n   &gt; Throwable #1: java.lang.AssertionError: Expected only 2 documents in the index expected:&lt;2&gt; but was:&lt;0&gt;\\n   &gt;    at __randomizedtesting.SeedInfo.seed([B6BDBFC48B148FB6:502A8B04B29676D7]:0)\\n   &gt;    at org.junit.Assert.fail(Assert.java:93)\\n   &gt;    at org.junit.Assert.failNotEquals(Assert.java:647)\\n   &gt;    at org.junit.Assert.assertEquals(Assert.java:128)\\n   &gt;    at org.junit.Assert.assertEquals(Assert.java:472)\\n   &gt;    at org.apache.solr.cloud.ForceLeaderTest.testReplicasInLIRNoLeader(ForceLeaderTest.java:152)\\n \\n  \\n\\n Edit: When I say \\\"doesn\'t reproduce\\\" I mean that rerunning with the same seed doesn\'t cause it to always fail, but running  ant test  will get a failure maybe 20% of the time.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15985465\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15985465&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15985465\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15985465_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15985465_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/17 19:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-26T19:55:26+0000\'\u003e26\\/Apr\\/17 19:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNoticed that on that check if it hits the follower it gets 2 docs, and if it hits the leader it gets 0. This seems pretty consistent. Adding a 10s sleep like suggested in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-10562\\\" title=\\\"TestSolrCLIRunExample failures indicating documents just indexed are not all searchable.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-10562\\\"\u003eSOLR-10562\u003c\\/a\u003e doesn\'t fix the problem. Based on this, it feels like it \u003cem\u003eshould\u003c\\/em\u003e fail 50% of the time, but I\'m definitely not seeing that.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe good news is that that is the only failure I\'m seeing in \u003ctt\u003esolr\\/core\u003c\\/tt\u003e tests now, so I\'m hoping it\'s a test issue and not a code issue for me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15985465_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15985465_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/17 19:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-26T19:55:26+0000\'\u003e26\\/Apr\\/17 19:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Noticed that on that check if it hits the follower it gets 2 docs, and if it hits the leader it gets 0. This seems pretty consistent. Adding a 10s sleep like suggested in  SOLR-10562  doesn\'t fix the problem. Based on this, it feels like it  should  fail 50% of the time, but I\'m definitely not seeing that. \\n\\n The good news is that that is the only failure I\'m seeing in  solr\\/core  tests now, so I\'m hoping it\'s a test issue and not a code issue for me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15985645\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15985645&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15985645\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15985645_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15985645_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/17 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-26T22:07:56+0000\'\u003e26\\/Apr\\/17 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCleans up patch to pass \u003ctt\u003eant precommit\u003c\\/tt\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mdrob\\\" id=\\\"commentauthor_15985645_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mdrob\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Drob\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15985645_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/17 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-26T22:07:56+0000\'\u003e26\\/Apr\\/17 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Cleans up patch to pass  ant precommit               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15986760\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15986760&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15986760\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15986760_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15986760_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/17 14:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-27T14:52:39+0000\'\u003e27\\/Apr\\/17 14:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eone fail I\'ve seen:   \u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e [junit4] FAILURE 49.9s J1 | ForceLeaderTest.testReplicasInLIRNoLeader &lt;&lt;&lt;\\n   [junit4]    &gt; Throwable #1: java.lang.AssertionError: Expected only 2 documents in the index expected:&lt;2&gt; but was:&lt;0&gt;\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([3976EDCE80FD24FA:DFE1D90EB97FDD9B]:0)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.ForceLeaderTest.testReplicasInLIRNoLeader(ForceLeaderTest.java:150)\\n   [junit4]    &gt; \\tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:985)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15986760_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15986760_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/17 14:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-27T14:52:39+0000\'\u003e27\\/Apr\\/17 14:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    one fail I\'ve seen:    \\n\\n  \\n  [junit4] FAILURE 49.9s J1 | ForceLeaderTest.testReplicasInLIRNoLeader &lt;&lt;&lt;\\n   [junit4]    &gt; Throwable #1: java.lang.AssertionError: Expected only 2 documents in the index expected:&lt;2&gt; but was:&lt;0&gt;\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([3976EDCE80FD24FA:DFE1D90EB97FDD9B]:0)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.ForceLeaderTest.testReplicasInLIRNoLeader(ForceLeaderTest.java:150)\\n   [junit4]    &gt; \\tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:985)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15986849\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15986849&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15986849\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15986849_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15986849_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/17 15:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-27T15:48:55+0000\'\u003e27\\/Apr\\/17 15:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI didn\'t have the other patch in. Got one success after putting that in, I\'ll beast that test after a few more runs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15986849_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15986849_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/17 15:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-27T15:48:55+0000\'\u003e27\\/Apr\\/17 15:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I didn\'t have the other patch in. Got one success after putting that in, I\'ll beast that test after a few more runs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15986889\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15986889&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15986889\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15986889_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15986889_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/17 16:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-27T16:01:42+0000\'\u003e27\\/Apr\\/17 16:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve seen ChaosMonkeySafeLeaderTest hang once in a previous patch and with the latest. I have to see how common that is without this patch now. Some more test beasting to do on that.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15986889_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15986889_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/17 16:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-27T16:01:42+0000\'\u003e27\\/Apr\\/17 16:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve seen ChaosMonkeySafeLeaderTest hang once in a previous patch and with the latest. I have to see how common that is without this patch now. Some more test beasting to do on that.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-15987167\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=15987167&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15987167\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15987167_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15987167_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/17 18:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-27T18:00:09+0000\'\u003e27\\/Apr\\/17 18:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOkay, even with \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-10525\\\" title=\\\"Stacked recovery requests do no cancel an in progress recovery first.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-10525\\\"\u003e\u003cdel\u003eSOLR-10525\u003c\\/del\u003e\u003c\\/a\u003e, I did hit that same fail. I\'ll try and debug it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_15987167_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_15987167_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Apr\\/17 18:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-04-27T18:00:09+0000\'\u003e27\\/Apr\\/17 18:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Okay, even with   SOLR-10525  , I did hit that same fail. I\'ll try and debug it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16094781\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=16094781&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16094781\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"manokovacs\\\" id=\\\"commentauthor_16094781_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=manokovacs\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"manokovacs\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mano Kovacs\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16094781_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jul\\/17 14:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-07-20T14:46:08+0000\'\u003e20\\/Jul\\/17 14:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching explanation diagram of the first problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"manokovacs\\\" id=\\\"commentauthor_16094781_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=manokovacs\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"manokovacs\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mano Kovacs\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16094781_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jul\\/17 14:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-07-20T14:46:08+0000\'\u003e20\\/Jul\\/17 14:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching explanation diagram of the first problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16138255\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=16138255&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16138255\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_16138255_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16138255_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/17 11:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-08-23T11:53:11+0000\'\u003e23\\/Aug\\/17 11:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGreat work \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\" class=\\\"user-hover\\\" rel=\\\"mdrob\\\"\u003eMike Drob\u003c\\/a\u003e, but there are one thing that I concern about your direction. \u003cbr\\/\u003e\\nFirstly, There are one requirement for LIR implementation is : the replica that miss the update, should not allowed to serve query requests.\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eIn current implementation, Leader will publish the replica as DOWN, so all clients will know that and stop query that replica. ( low latency )\u003c\\/li\u003e\\n\\t\u003cli\u003eIn your implementation, Leader only publish LIR state of that replica as DOWN, so all clients will keep query that replica, until the replica acknowledge the change in LIR node then publish it self as DOWN ( high latency  )\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eSecondly, Now we have 2 nodes update state of a replica which is considered as bad practice. With your implementation, we have 2 nodes update lir state of a replica, will we have race condition bug in the future?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_16138255_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16138255_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/17 11:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-08-23T11:53:11+0000\'\u003e23\\/Aug\\/17 11:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Great work  Mike Drob , but there are one thing that I concern about your direction.  \\nFirstly, There are one requirement for LIR implementation is : the replica that miss the update, should not allowed to serve query requests. \\n \\n\\t In current implementation, Leader will publish the replica as DOWN, so all clients will know that and stop query that replica. ( low latency ) \\n\\t In your implementation, Leader only publish LIR state of that replica as DOWN, so all clients will keep query that replica, until the replica acknowledge the change in LIR node then publish it self as DOWN ( high latency  ) \\n \\n\\n\\n Secondly, Now we have 2 nodes update state of a replica which is considered as bad practice. With your implementation, we have 2 nodes update lir state of a replica, will we have race condition bug in the future?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16187552\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=16187552&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16187552\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_16187552_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16187552_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Oct\\/17 22:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-01T22:04:41+0000\'\u003e01\\/Oct\\/17 22:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMust have hit the \\\"assign to me\\\" link by accident.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_16187552_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16187552_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Oct\\/17 22:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-10-01T22:04:41+0000\'\u003e01\\/Oct\\/17 22:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Must have hit the \\\"assign to me\\\" link by accident.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16282965\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=16282965&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16282965\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_16282965_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16282965_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/17 03:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-12-08T03:12:06+0000\'\u003e08\\/Dec\\/17 03:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=mdrob\\\" class=\\\"user-hover\\\" rel=\\\"mdrob\\\"\u003eMike Drob\u003c\\/a\u003e \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e  please take a look at my recent patch for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-11702\\\" title=\\\"Redesign current LIR implementation\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-11702\\\"\u003e\u003cdel\u003eSOLR-11702\u003c\\/del\u003e\u003c\\/a\u003e. I think that is the safer\\/better way to solve this problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_16282965_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16282965_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/17 03:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2017-12-08T03:12:06+0000\'\u003e08\\/Dec\\/17 03:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Mike Drob   Mark Miller   please take a look at my recent patch for   SOLR-11702  . I think that is the safer\\/better way to solve this problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-16343098\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-9555?focusedCommentId=16343098&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16343098\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_16343098_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16343098_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jan\\/18 09:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2018-01-29T09:00:40+0000\'\u003e29\\/Jan\\/18 09:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFixed by \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-11702\\\" title=\\\"Redesign current LIR implementation\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-11702\\\"\u003e\u003cdel\u003eSOLR-11702\u003c\\/del\u003e\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"caomanhdat\\\" id=\\\"commentauthor_16343098_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=caomanhdat\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"caomanhdat\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Cao Manh Dat\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_16343098_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jan\\/18 09:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2018-01-29T09:00:40+0000\'\u003e29\\/Jan\\/18 09:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fixed by   SOLR-11702                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310230";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310230&amp;avatarId=22151\\\" alt=\\\"Solr\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\"\u003eSolr\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520342425259"> 
    <input type="hidden" title="jira.request.server.time" value="272"> 
    <input type="hidden" title="jira.request.id" value="800x97516738x3"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="53"> 
    <input type="hidden" title="db.conns.time.in.ms" value="62"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 800x97516738x3
	          REQUEST TIMESTAMP : [06/Mar/2018:13:20:25 +0000]
	               REQUEST TIME : 0.2720
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=47, elapsedTotal=53409092, elapsedMin=579178, elapsedMax=15667662, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=51, elapsedTotal=62078119, elapsedMin=620344, elapsedMax=15699047, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>