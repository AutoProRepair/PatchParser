<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|253deffe1db0a3fd4429596e868545d2517c9ee3|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"9e5125c7ebddf3\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-2755"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-2755] Some improvements to CMS - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-2755] Some improvements to CMS - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2755">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-2755" href="/jira/browse/LUCENE-2755" id="key-val" rel="12479704">LUCENE-2755</a></li>
                </ol>
                <h1 id="summary-val">Some improvements to CMS</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2755"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-2755/LUCENE-2755.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-2755/LUCENE-2755.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-2755/LUCENE-2755.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-2755/LUCENE-2755.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/minor.svg" title="Minor - Minor loss of function, or other problem where easy workaround is present." width="16"> Minor </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+3.1" title="3.1 Major release after 3.x">3.1</a>, <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.0-ALPHA" title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12479704-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span>, 
                        <span>Patch Available</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>While running optimize on a large index, I've noticed several things that got me to read CMS code more carefully, and find these issues:</p> 
                  <ul> 
                   <li>CMS may hold onto a merge if maxMergeCount is hit. That results in the MergeThreads taking merges from the IndexWriter until they are exhausted, and only then that blocked merge will run. I think it's unnecessary that that merge will be blocked.</li> 
                  </ul> 
                  <ul> 
                   <li>CMS sorts merges by segments size, doc-based and not bytes-based. Since the default MP is LogByteSizeMP, and I hardly believe people care about doc-based size segments anymore, I think we should switch the default impl. There are two ways to make it extensible, if we want: 
                    <ul> 
                     <li>Have an overridable member/method in CMS that you can extend and override - easy.</li> 
                     <li>Have OneMerge be comparable and let the MP determine the order (e.g. by bytes, docs, calibrate deletes etc.). Better, but will need to tap into several places in the code, so more risky and complicated.</li> 
                    </ul> </li> 
                  </ul> 
                  <p>On the go, I'd like to add some documentation to CMS - it's not very easy to read and follow.</p> 
                  <p>I'll work on a patch.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-2755?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-2755?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-2755?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-2755?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12468539" data-issue-id="12479704" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468539/LUCENE-2755.patch" draggable="true" data-downloadurl="text/plain:LUCENE-2755.patch:https://issues.apache.org/jira/secure/attachment/12468539/LUCENE-2755.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468539/LUCENE-2755.patch" title="Latest  17/Jan/11 09:01 - Shai Erera" draggable="true" data-downloadurl="text/plain:LUCENE-2755.patch:https://issues.apache.org/jira/secure/attachment/12468539/LUCENE-2755.patch">LUCENE-2755.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-17T09:01:16.871Z">17/Jan/11 09:01</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Shai Erera
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_shaie" rel="shaie" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Shai Erera&quot;,&quot;emailAddress&quot;:&quot;serera@gmail.com&quot;,&quot;username&quot;:&quot;shaie&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="shaie"></span></span> Shai Erera </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_shaie" rel="shaie" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Shai Erera&quot;,&quot;emailAddress&quot;:&quot;serera@gmail.com&quot;,&quot;username&quot;:&quot;shaie&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="shaie"></span></span> Shai Erera </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="11/Nov/10 13:45"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2010-11-11T13:45:45+0000">11/Nov/10 13:45</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="30/Mar/11 15:49"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-03-30T15:49:51+0000">30/Mar/11 15:49</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="18/Jan/11 23:31"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-01-18T23:31:45+0000">18/Jan/11 23:31</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2755?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2755?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12931015\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12931015&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931015\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12931015_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931015_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 14:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T14:04:30+0000\'\u003e11\\/Nov\\/10 14:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eCMS sorts merges by segments size, doc-based and not bytes-based. Since the default MP is LogByteSizeMP, and I hardly believe people care about doc-based size segments anymore, I think we should switch the default impl.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s probably a good idea.\u003cbr\\/\u003e\\nWe should also scale this by the number of deleted docs... so if a segment has 10,000 documents, is 10MB in size, and has 2000 deleted documents, then we should consider it as 8MB for the purposes of selecting to merge?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12931015_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931015_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 14:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T14:04:30+0000\'\u003e11\\/Nov\\/10 14:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     CMS sorts merges by segments size, doc-based and not bytes-based. Since the default MP is LogByteSizeMP, and I hardly believe people care about doc-based size segments anymore, I think we should switch the default impl.  \\n\\n That\'s probably a good idea. \\nWe should also scale this by the number of deleted docs... so if a segment has 10,000 documents, is 10MB in size, and has 2000 deleted documents, then we should consider it as 8MB for the purposes of selecting to merge?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931086\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12931086&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931086\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12931086_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931086_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 17:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T17:11:03+0000\'\u003e11\\/Nov\\/10 17:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRight! Hence why I wrote it is best determined by MP. LogMP already does it by default (can be disabled).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12931086_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931086_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 17:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T17:11:03+0000\'\u003e11\\/Nov\\/10 17:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Right! Hence why I wrote it is best determined by MP. LogMP already does it by default (can be disabled).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931468\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12931468&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931468\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12931468_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931468_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/10 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-12T17:52:25+0000\'\u003e12\\/Nov\\/10 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, so not calling IndexWriter.getNextMerge() before we know we can register that merge is problematic. The reason is we want to know if there is a next merge before we check if it can be registered. If not, the method returns immediately. Otherwise, we\'ll wait until any merge can be registered, just to discover there are no more merge.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo one solution can be to add to IW a hasMerges() and in CMS wait for room to become available only if there are merges.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother solution is to do a larger change to CMS and introduce an ExecutorService - this has been raised in the past, so perhaps it\'s time to finally do it? By using a blocking queue, we don\'t need to implement any waiting logic - Java will do it for us.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe downside of that is that I\'m not sure we can control which of the merges runs and which isn\'t. Perhaps we can hack this through - I\'ll need to start the process to tell for sure. This feature is important - today CMS guarantees the smaller merges run first - so it might be that a larger merge was registered before a smaller merge, and we\'d still want to execute the smaller one before the larger.\u003c\\/p\u003e\\n\\n\u003cp\u003eA third solution would be to not do anything and keep things as they are - namely let some merge be held by CMS until it can be executed.\u003c\\/p\u003e\\n\\n\u003cp\u003eJust summarizing my thoughts for now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12931468_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931468_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/10 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-12T17:52:25+0000\'\u003e12\\/Nov\\/10 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, so not calling IndexWriter.getNextMerge() before we know we can register that merge is problematic. The reason is we want to know if there is a next merge before we check if it can be registered. If not, the method returns immediately. Otherwise, we\'ll wait until any merge can be registered, just to discover there are no more merge. \\n\\n So one solution can be to add to IW a hasMerges() and in CMS wait for room to become available only if there are merges. \\n\\n Another solution is to do a larger change to CMS and introduce an ExecutorService - this has been raised in the past, so perhaps it\'s time to finally do it? By using a blocking queue, we don\'t need to implement any waiting logic - Java will do it for us. \\n\\n The downside of that is that I\'m not sure we can control which of the merges runs and which isn\'t. Perhaps we can hack this through - I\'ll need to start the process to tell for sure. This feature is important - today CMS guarantees the smaller merges run first - so it might be that a larger merge was registered before a smaller merge, and we\'d still want to execute the smaller one before the larger. \\n\\n A third solution would be to not do anything and keep things as they are - namely let some merge be held by CMS until it can be executed. \\n\\n Just summarizing my thoughts for now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931796\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12931796&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931796\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12931796_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931796_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Nov\\/10 09:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-14T09:25:04+0000\'\u003e14\\/Nov\\/10 09:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve looked into integrating an ExecutorService and I think it can really simplify things, as long as we can let go of CMS sorting merges by their size. And I think - why should it? What if we make it to MP\'s decision? Namely, if you care about which merges run first, have your MP sort them the way you want, before you return them. If we make OneMerge comparable, that should be a very trivial extension one has to make to MP (extend MP, override the methods, call super.method() and then sort accordingly).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we do that, then SMS and CMS will work the same - execute the merges in the order returned by MP, only CMS will do so in parallel and SMS will do so synchronously. By reading that you can already see that later (in a separate issue), we can let go of SMS entirely - it will be a single-threaded ExecutorService, w\\/ an implementation to wait until the work competes (unlike CMS which returns immediately). But that\'s for another day.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat do you think?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12931796_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931796_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Nov\\/10 09:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-14T09:25:04+0000\'\u003e14\\/Nov\\/10 09:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve looked into integrating an ExecutorService and I think it can really simplify things, as long as we can let go of CMS sorting merges by their size. And I think - why should it? What if we make it to MP\'s decision? Namely, if you care about which merges run first, have your MP sort them the way you want, before you return them. If we make OneMerge comparable, that should be a very trivial extension one has to make to MP (extend MP, override the methods, call super.method() and then sort accordingly). \\n\\n If we do that, then SMS and CMS will work the same - execute the merges in the order returned by MP, only CMS will do so in parallel and SMS will do so synchronously. By reading that you can already see that later (in a separate issue), we can let go of SMS entirely - it will be a single-threaded ExecutorService, w\\/ an implementation to wait until the work competes (unlike CMS which returns immediately). But that\'s for another day. \\n\\n What do you think?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931809\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12931809&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931809\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12931809_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931809_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Nov\\/10 11:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-14T11:10:02+0000\'\u003e14\\/Nov\\/10 11:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCutting over to ExecutorService and letting MergePolicy dictate how OneMerge compares sounds great!\u003c\\/p\u003e\\n\\n\u003cp\u003eWill CMS still have the ability to pause running big merges in order to let smaller ones complete?  Seems like these changes should still allow that to work correctly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12931809_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931809_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Nov\\/10 11:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-14T11:10:02+0000\'\u003e14\\/Nov\\/10 11:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Cutting over to ExecutorService and letting MergePolicy dictate how OneMerge compares sounds great! \\n\\n Will CMS still have the ability to pause running big merges in order to let smaller ones complete?  Seems like these changes should still allow that to work correctly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931916\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12931916&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931916\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12931916_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931916_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Nov\\/10 23:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-14T23:07:58+0000\'\u003e14\\/Nov\\/10 23:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIs there any reason at all to be concerned with merge execution order (not even starting about pausing)? Sounds like a fat bit of overengineering.\u003cbr\\/\u003e\\nMerging (with CMS) happens outside of index\\/search loop anyway so whatever the order, you\'re not affecting latencies.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12931916_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931916_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Nov\\/10 23:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-14T23:07:58+0000\'\u003e14\\/Nov\\/10 23:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Is there any reason at all to be concerned with merge execution order (not even starting about pausing)? Sounds like a fat bit of overengineering. \\nMerging (with CMS) happens outside of index\\/search loop anyway so whatever the order, you\'re not affecting latencies.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932072\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932072&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932072\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932072_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932072_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 15:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T15:07:23+0000\'\u003e15\\/Nov\\/10 15:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe problem with ThreadPoolExecutor is that its submit() doesn\'t block on the queue, even if you pass a bounded ArrayBlockingQueue (which is really silly IMO). I was hoping we can super simplify CMS logic by letting a BlockingQueue throttle the number of merges we \'register\' before CMS itself waits, and the ExecutorService instead of the MergeThreads and their management.\u003c\\/p\u003e\\n\\n\u003cp\u003eUnfortunately this does not look to be the case. Here is an alternative solution which looks a nice workaround: \u003ca href=\\\"http:\\/\\/stackoverflow.com\\/questions\\/2001086\\/how-to-make-threadpoolexecutors-submit-method-block-if-it-is-saturated\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/stackoverflow.com\\/questions\\/2001086\\/how-to-make-threadpoolexecutors-submit-method-block-if-it-is-saturated\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe idea is to block the call to ExecutorService.execute() through a Semaphore. In that case, I think it\'s safe to not use a blocking queue at all, because the throttling will be handled by the Semaphore.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother alternative is to use a CallerRunsPolicy as the rejection policy, which has many disadvantages (such as potentially starving the other threads if the caller gets to execute the heavy task, or risking running the tasks by N+1 threads etc.).\u003c\\/p\u003e\\n\\n\u003cp\u003eEarwin - if we make OneMerge comparable, we give any MP the freedom to decide the order merges will run. In my case it is important because I\'m getting a certain time frame to run index optimization, and prefer to reduce as many segments as possible, therefore I choose to run the smaller merges first. I think it\'s a reasonable decision anyway as a default, because even if you call close(false) (not waiting for merges), then it\'s better if some merges have already finished and committed, thereby you\'re making forward progress all the time, vs. if you run merges in arbitrary order you mind not finish any merge.\u003c\\/p\u003e\\n\\n\u003cp\u003eI agree though that in some situations apps won\'t care, in which case sorting by merge size will be as good as random ordering.\u003c\\/p\u003e\\n\\n\u003cp\u003ePausing large merges is something that I consider less important though, but I don\'t want to break back-compat behavior. IMO if a merge started - let it finish. You don\'t know how much work it has completed, how much work is left, and how much work does the \'smaller\' merge has (what if say it\'s smaller by 1 byte\\/doc?). In different situations the best decision might be different, therefore IMO we shouldn\'t pause threads - rather let the MP decide up front the order of the merges (if it wants to) and then execute them in that order.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932072_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932072_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 15:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T15:07:23+0000\'\u003e15\\/Nov\\/10 15:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The problem with ThreadPoolExecutor is that its submit() doesn\'t block on the queue, even if you pass a bounded ArrayBlockingQueue (which is really silly IMO). I was hoping we can super simplify CMS logic by letting a BlockingQueue throttle the number of merges we \'register\' before CMS itself waits, and the ExecutorService instead of the MergeThreads and their management. \\n\\n Unfortunately this does not look to be the case. Here is an alternative solution which looks a nice workaround:  http:\\/\\/stackoverflow.com\\/questions\\/2001086\\/how-to-make-threadpoolexecutors-submit-method-block-if-it-is-saturated . \\n\\n The idea is to block the call to ExecutorService.execute() through a Semaphore. In that case, I think it\'s safe to not use a blocking queue at all, because the throttling will be handled by the Semaphore. \\n\\n Another alternative is to use a CallerRunsPolicy as the rejection policy, which has many disadvantages (such as potentially starving the other threads if the caller gets to execute the heavy task, or risking running the tasks by N+1 threads etc.). \\n\\n Earwin - if we make OneMerge comparable, we give any MP the freedom to decide the order merges will run. In my case it is important because I\'m getting a certain time frame to run index optimization, and prefer to reduce as many segments as possible, therefore I choose to run the smaller merges first. I think it\'s a reasonable decision anyway as a default, because even if you call close(false) (not waiting for merges), then it\'s better if some merges have already finished and committed, thereby you\'re making forward progress all the time, vs. if you run merges in arbitrary order you mind not finish any merge. \\n\\n I agree though that in some situations apps won\'t care, in which case sorting by merge size will be as good as random ordering. \\n\\n Pausing large merges is something that I consider less important though, but I don\'t want to break back-compat behavior. IMO if a merge started - let it finish. You don\'t know how much work it has completed, how much work is left, and how much work does the \'smaller\' merge has (what if say it\'s smaller by 1 byte\\/doc?). In different situations the best decision might be different, therefore IMO we shouldn\'t pause threads - rather let the MP decide up front the order of the merges (if it wants to) and then execute them in that order.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932124\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932124&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932124\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932124_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932124_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 17:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T17:55:45+0000\'\u003e15\\/Nov\\/10 17:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhatever solution for block-on-add you employ, I think it is important to implement it as an Executor. I think, people can benefit from threading policy being pluggable.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not against sorting merges, it\'s so simple, even if useless. Though maybe it\'s better to use Comparator, so you can redefine the order? Pausing large merges is another issue - that\'s a freakload of complexity for zero gain.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother issue to ponder - what about slightly uncluttering IW &lt;-&gt; MS interaction?\u003cbr\\/\u003e\\nWe drop IW.getNextMerge, MS.merge(IW), and replace them with MS.scheduleMerge(MP.OM), so instead of IW asking MS to pull all merges from itself, it simply pushes them.\u003cbr\\/\u003e\\nAlso, let\'s kill this weeeird IW.mergeInit that is called from CMS, but not SMS \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eBut oh, well. With introduction of executors, and SMS being folded as a special case of CMS, we might as well drop MS completely and move what little code is left straight to IW, which will now accept an executor.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932124_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932124_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 17:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T17:55:45+0000\'\u003e15\\/Nov\\/10 17:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Whatever solution for block-on-add you employ, I think it is important to implement it as an Executor. I think, people can benefit from threading policy being pluggable. \\n\\n I\'m not against sorting merges, it\'s so simple, even if useless. Though maybe it\'s better to use Comparator, so you can redefine the order? Pausing large merges is another issue - that\'s a freakload of complexity for zero gain. \\n\\n Another issue to ponder - what about slightly uncluttering IW &lt;-&gt; MS interaction? \\nWe drop IW.getNextMerge, MS.merge(IW), and replace them with MS.scheduleMerge(MP.OM), so instead of IW asking MS to pull all merges from itself, it simply pushes them. \\nAlso, let\'s kill this weeeird IW.mergeInit that is called from CMS, but not SMS   \\n\\n\\n But oh, well. With introduction of executors, and SMS being folded as a special case of CMS, we might as well drop MS completely and move what little code is left straight to IW, which will now accept an executor.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932162\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932162&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932162\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12932162_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932162_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 19:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T19:36:33+0000\'\u003e15\\/Nov\\/10 19:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWe drop IW.getNextMerge, MS.merge(IW), and replace them with MS.scheduleMerge(MP.OM), so instead of IW asking MS to pull all merges from itself, it simply pushes them.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat sounds like a great simplification!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'m not against sorting merges, it\'s so simple, even if useless. Though maybe it\'s better to use Comparator, so you can redefine the order? Pausing large merges is another issue - that\'s a freakload of complexity for zero gain.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ePausing large merges is (unfortunately) important for full use of available concurrency.  Otherwise, when a laaarge merge is taking place, it causes to to fully stop your indexing threads unnecessarily.  Turn on infoStream when building a large index and you\'ll see...\u003c\\/p\u003e\\n\\n\u003cp\u003eAn OS CPU scheduler will lower the priority of long-running CPU hogging processes, for the same reason (so that newly started CPU hog processes that are short running get nearly 100% of the CPU so they finish fast).  It\'s just that we don\'t have the \\\"freedom\\\" to allow an unbounded number of merges that we must \\\"approximate\\\" this by explicitly pausing the long running merges.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAlso, let\'s kill this weeeird IW.mergeInit that is called from CMS, but not SMS\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere was some reason why this needed to be called by CMS but not SMS but I can\'t remember why.  (It\'s re-called by IW.merge in case the MS didn\'t already call it).  But it\'d be great to not call it from CMS if it\'s not necessary... I can\'t remember the reason.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWith introduction of executors, and SMS being folded as a special case of CMS, we might as well drop MS completely and move what little code is left straight to IW, which will now accept an executor.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s tempting... but people use MSs eg to schedule big merges at different times.  I don\'t think we should outright drop MS.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12932162_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932162_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 19:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T19:36:33+0000\'\u003e15\\/Nov\\/10 19:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     We drop IW.getNextMerge, MS.merge(IW), and replace them with MS.scheduleMerge(MP.OM), so instead of IW asking MS to pull all merges from itself, it simply pushes them.  \\n\\n That sounds like a great simplification! \\n\\n  I\'m not against sorting merges, it\'s so simple, even if useless. Though maybe it\'s better to use Comparator, so you can redefine the order? Pausing large merges is another issue - that\'s a freakload of complexity for zero gain.  \\n\\n Pausing large merges is (unfortunately) important for full use of available concurrency.  Otherwise, when a laaarge merge is taking place, it causes to to fully stop your indexing threads unnecessarily.  Turn on infoStream when building a large index and you\'ll see... \\n\\n An OS CPU scheduler will lower the priority of long-running CPU hogging processes, for the same reason (so that newly started CPU hog processes that are short running get nearly 100% of the CPU so they finish fast).  It\'s just that we don\'t have the \\\"freedom\\\" to allow an unbounded number of merges that we must \\\"approximate\\\" this by explicitly pausing the long running merges. \\n\\n  Also, let\'s kill this weeeird IW.mergeInit that is called from CMS, but not SMS  \\n\\n There was some reason why this needed to be called by CMS but not SMS but I can\'t remember why.  (It\'s re-called by IW.merge in case the MS didn\'t already call it).  But it\'d be great to not call it from CMS if it\'s not necessary... I can\'t remember the reason. \\n\\n  With introduction of executors, and SMS being folded as a special case of CMS, we might as well drop MS completely and move what little code is left straight to IW, which will now accept an executor.  \\n\\n That\'s tempting... but people use MSs eg to schedule big merges at different times.  I don\'t think we should outright drop MS.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932182\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932182&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932182\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12932182_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932182_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 20:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T20:33:30+0000\'\u003e15\\/Nov\\/10 20:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA good feature for Solr could be the ability to via an HTTP call kick-off pending large merges.  They could then be scheduled via a cron job and based on other factors, such as whether or not other indexing tasks are running.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12932182_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932182_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 20:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T20:33:30+0000\'\u003e15\\/Nov\\/10 20:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A good feature for Solr could be the ability to via an HTTP call kick-off pending large merges.  They could then be scheduled via a cron job and based on other factors, such as whether or not other indexing tasks are running.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932200\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932200&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932200\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932200_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932200_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 21:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T21:09:55+0000\'\u003e15\\/Nov\\/10 21:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThere was some reason why this needed to be called by CMS but not SMS but I can\'t remember why.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThat has something to do with assigning new segment names, if you believe the comments.\u003cbr\\/\u003e\\nBut IW.mergeInit does a freakload of other stuff! I think assigning names can happen in a separate place, before OneMerge is submitted to MS.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eOtherwise, when a laaarge merge is taking place, it causes to to fully stop your indexing threads unnecessarily\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI still think this can be mitigated in more appropriate ways. Like allocating big enough pending merges queue to wait until the long one finishes.\u003cbr\\/\u003e\\nIndexing threads push merges into the queue (with CMS) and don\'t block.\u003cbr\\/\u003e\\nPlus to that, you can use nice policies like BalancedSegmentMergePolicy, that prevent UBER-merges from occuring at all.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThat\'s tempting... but people use MSs eg to schedule big merges at different times. I don\'t think we should outright drop MS.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThat exact use case is totally wrong. MergePolicy decides which merges should run NOW, MergeScheduler executes them.\u003cbr\\/\u003e\\nIf a certain big merge should run only within some specific timeframe, MergePolicy should not return it when asked for eligible merges.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn your sample, when decision-making is smeared across classes, the merges created by MP and deferred by MS are stale when their\u003cbr\\/\u003e\\ntime comes. If asked now, MP would include some additional segments in the merge that MS stalled around for ages.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor a glance of things done relatively right, take a look at BSMP - it has setPartialExpunge method, that alters its\u003cbr\\/\u003e\\nbehaviour to include some expensive housecleaning. It is supposed you do setPartialExpunge(true) at the beginning of your quiet period, and\u003cbr\\/\u003e\\nsetPartialExpunge(false) when it ends.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eA good feature for Solr could be the ability to via an HTTP call kick-off pending large merges.  They could then be scheduled via a cron job and based on other factors, such as whether or not other indexing tasks are running.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eSame argument here. The place for such decisions is MergePolicy.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932200_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932200_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 21:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T21:09:55+0000\'\u003e15\\/Nov\\/10 21:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     There was some reason why this needed to be called by CMS but not SMS but I can\'t remember why.  \\n That has something to do with assigning new segment names, if you believe the comments. \\nBut IW.mergeInit does a freakload of other stuff! I think assigning names can happen in a separate place, before OneMerge is submitted to MS. \\n\\n  Otherwise, when a laaarge merge is taking place, it causes to to fully stop your indexing threads unnecessarily  \\n I still think this can be mitigated in more appropriate ways. Like allocating big enough pending merges queue to wait until the long one finishes. \\nIndexing threads push merges into the queue (with CMS) and don\'t block. \\nPlus to that, you can use nice policies like BalancedSegmentMergePolicy, that prevent UBER-merges from occuring at all. \\n\\n  That\'s tempting... but people use MSs eg to schedule big merges at different times. I don\'t think we should outright drop MS.  \\n That exact use case is totally wrong. MergePolicy decides which merges should run NOW, MergeScheduler executes them. \\nIf a certain big merge should run only within some specific timeframe, MergePolicy should not return it when asked for eligible merges. \\n\\n In your sample, when decision-making is smeared across classes, the merges created by MP and deferred by MS are stale when their \\ntime comes. If asked now, MP would include some additional segments in the merge that MS stalled around for ages. \\n\\n For a glance of things done relatively right, take a look at BSMP - it has setPartialExpunge method, that alters its \\nbehaviour to include some expensive housecleaning. It is supposed you do setPartialExpunge(true) at the beginning of your quiet period, and \\nsetPartialExpunge(false) when it ends. \\n\\n  A good feature for Solr could be the ability to via an HTTP call kick-off pending large merges.  They could then be scheduled via a cron job and based on other factors, such as whether or not other indexing tasks are running.  \\n Same argument here. The place for such decisions is MergePolicy.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932234\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932234&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932234\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12932234_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932234_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 22:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T22:29:44+0000\'\u003e15\\/Nov\\/10 22:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eThat has something to do with assigning new segment names, if you believe the comments.\u003cbr\\/\u003e\\nBut IW.mergeInit does a freakload of other stuff! I think assigning names can happen in a separate place, before OneMerge is submitted to MS.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf indeed that\'s all then I agree, let\'s just assign the name up front and then CMS need not call mergeInit.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eOtherwise, when a laaarge merge is taking place, it causes to to fully stop your indexing threads unnecessarily\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI still think this can be mitigated in more appropriate ways. Like allocating big enough pending merges queue to wait until the long one finishes.\u003cbr\\/\u003e\\nIndexing threads push merges into the queue (with CMS) and don\'t block.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBut then you accumulate too many tiny merges, while waiting for the big one to finish?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ePlus to that, you can use nice policies like BalancedSegmentMergePolicy, that prevent UBER-merges from occuring at all.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMaybe we should move BSMP to core and make it the default?\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I don\'t fully understand how it chooses merges.  EG does it pick lopsided merges (where the segments differ substantially in size), as long as they are \\\"small\\\" segments?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eMergePolicy decides which merges should run NOW, MergeScheduler executes them.\u003cbr\\/\u003e\\nIf a certain big merge should run only within some specific timeframe, MergePolicy should not return it when asked for eligible merges.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree there is ambiguity here, which is not good.  It is tempting to nuke MergeScheduler (absorb CMS into IW, w\\/ SMS a special case) and define MergePolicy to only return merges which should run right now... that would be a nice simplification.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12932234_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932234_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 22:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T22:29:44+0000\'\u003e15\\/Nov\\/10 22:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n That has something to do with assigning new segment names, if you believe the comments. \\nBut IW.mergeInit does a freakload of other stuff! I think assigning names can happen in a separate place, before OneMerge is submitted to MS.  \\n\\n If indeed that\'s all then I agree, let\'s just assign the name up front and then CMS need not call mergeInit. \\n\\n \\n  Otherwise, when a laaarge merge is taking place, it causes to to fully stop your indexing threads unnecessarily  \\n\\n I still think this can be mitigated in more appropriate ways. Like allocating big enough pending merges queue to wait until the long one finishes. \\nIndexing threads push merges into the queue (with CMS) and don\'t block.  \\n\\n But then you accumulate too many tiny merges, while waiting for the big one to finish? \\n\\n  Plus to that, you can use nice policies like BalancedSegmentMergePolicy, that prevent UBER-merges from occuring at all.  \\n\\n Maybe we should move BSMP to core and make it the default? \\n\\n But I don\'t fully understand how it chooses merges.  EG does it pick lopsided merges (where the segments differ substantially in size), as long as they are \\\"small\\\" segments? \\n\\n \\n MergePolicy decides which merges should run NOW, MergeScheduler executes them. \\nIf a certain big merge should run only within some specific timeframe, MergePolicy should not return it when asked for eligible merges.  \\n\\n I agree there is ambiguity here, which is not good.  It is tempting to nuke MergeScheduler (absorb CMS into IW, w\\/ SMS a special case) and define MergePolicy to only return merges which should run right now... that would be a nice simplification.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932266\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932266&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932266\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932266_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932266_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T23:54:42+0000\'\u003e15\\/Nov\\/10 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eBut then you accumulate too many tiny merges, while waiting for the big one to finish?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYou say this, as if it was something terribly wrong. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nBig merges aren\'t heffalumps, they don\'t usually stalk IW in droves. Big merge ends sooner or later, and tiny ones go out in a flash.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMaybe we should move BSMP to core and make it the default?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eDunno. The index you end up with is larger than with LogWhateverMP.\u003cbr\\/\u003e\\nBut you get a nice benefit of having roughly equal-sized big segments, which is cool for running collection in parallel.\u003cbr\\/\u003e\\nEveryone has his own requirements.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBut I don\'t fully understand how it chooses merges. EG does it pick lopsided merges (where the segments differ substantially in size), as long as they are \\\"small\\\" segments?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eDocs say small-sized segments are treated as with LogByteSizeMP.\u003c\\/p\u003e\\n\\n\\n\\n\u003cp\u003eAnother thought I had looking through the code. We have seriously inefficient \\\"merge conflict\\\" resolution algorithm on our hands.\u003cbr\\/\u003e\\nWe just damn drop all new merges that have segments in common with the merges already queued (but not yet running!!).\u003cbr\\/\u003e\\nWhat does that mean?\u003c\\/p\u003e\\n\\n\u003cp\u003eImagine we\'re producing a slew of mini-segments with decent speed and our MergeScheduler is lagging behind:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003enew seg1\u003c\\/li\u003e\\n\\t\u003cli\u003enew seg2\u003c\\/li\u003e\\n\\t\u003cli\u003equeue merge seg1+seg2\u003c\\/li\u003e\\n\\t\u003cli\u003estart merge seg1+seg2\u003c\\/li\u003e\\n\\t\u003cli\u003enew seg3\u003c\\/li\u003e\\n\\t\u003cli\u003enew seg4\u003c\\/li\u003e\\n\\t\u003cli\u003equeue merge seg3+seg4\u003c\\/li\u003e\\n\\t\u003cli\u003enew seg5\u003c\\/li\u003e\\n\\t\u003cli\u003eFAIL queue merge seg3+seg4+seg5\u003c\\/li\u003e\\n\\t\u003cli\u003enew seg6\u003c\\/li\u003e\\n\\t\u003cli\u003eFAIL queue merge seg3+seg4+seg5+seg6\u003c\\/li\u003e\\n\\t\u003cli\u003efinish merge seg1+seg2\u003c\\/li\u003e\\n\\t\u003cli\u003estart merge seg3+seg4\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eBy that point we should really start merging of all four last segments (maybe together with the result of seg1+seg2).\u003cbr\\/\u003e\\nBut in reality we\'ll merge seg3+seg4, than seg5+seg6 and then all of three merge results together (provided no new mini-segments are added).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we throw large merges into the loop (whether pausable or not) the situation is amplified.\u003c\\/p\u003e\\n\\n\u003cp\u003eUgly solution - when MP suggests a merge that is a strict superset of a queued, but not yet running merge - drop the old one, use the new.\u003cbr\\/\u003e\\nBetter solution - instead of asking MP for all the merges it deems reasonable on current index, we only ask it for \\\"most important\\\" one.\u003cbr\\/\u003e\\nAnd we do it each time MS has an open slot for execution. This way each merge happening is the best merge possible at that moment.\u003c\\/p\u003e\\n\\n\u003cp\u003ePlease, correct my wrongs, if any.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932266_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932266_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T23:54:42+0000\'\u003e15\\/Nov\\/10 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     But then you accumulate too many tiny merges, while waiting for the big one to finish?  \\n You say this, as if it was something terribly wrong.   \\nBig merges aren\'t heffalumps, they don\'t usually stalk IW in droves. Big merge ends sooner or later, and tiny ones go out in a flash. \\n\\n  Maybe we should move BSMP to core and make it the default?  \\n Dunno. The index you end up with is larger than with LogWhateverMP. \\nBut you get a nice benefit of having roughly equal-sized big segments, which is cool for running collection in parallel. \\nEveryone has his own requirements. \\n\\n  But I don\'t fully understand how it chooses merges. EG does it pick lopsided merges (where the segments differ substantially in size), as long as they are \\\"small\\\" segments?  \\n Docs say small-sized segments are treated as with LogByteSizeMP. \\n\\n\\n\\n Another thought I had looking through the code. We have seriously inefficient \\\"merge conflict\\\" resolution algorithm on our hands. \\nWe just damn drop all new merges that have segments in common with the merges already queued (but not yet running!!). \\nWhat does that mean? \\n\\n Imagine we\'re producing a slew of mini-segments with decent speed and our MergeScheduler is lagging behind: \\n \\n\\t new seg1 \\n\\t new seg2 \\n\\t queue merge seg1+seg2 \\n\\t start merge seg1+seg2 \\n\\t new seg3 \\n\\t new seg4 \\n\\t queue merge seg3+seg4 \\n\\t new seg5 \\n\\t FAIL queue merge seg3+seg4+seg5 \\n\\t new seg6 \\n\\t FAIL queue merge seg3+seg4+seg5+seg6 \\n\\t finish merge seg1+seg2 \\n\\t start merge seg3+seg4 \\n \\n\\n\\n By that point we should really start merging of all four last segments (maybe together with the result of seg1+seg2). \\nBut in reality we\'ll merge seg3+seg4, than seg5+seg6 and then all of three merge results together (provided no new mini-segments are added). \\n\\n If we throw large merges into the loop (whether pausable or not) the situation is amplified. \\n\\n Ugly solution - when MP suggests a merge that is a strict superset of a queued, but not yet running merge - drop the old one, use the new. \\nBetter solution - instead of asking MP for all the merges it deems reasonable on current index, we only ask it for \\\"most important\\\" one. \\nAnd we do it each time MS has an open slot for execution. This way each merge happening is the best merge possible at that moment. \\n\\n Please, correct my wrongs, if any.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932356\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932356&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932356\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932356_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932356_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 07:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T07:00:32+0000\'\u003e16\\/Nov\\/10 07:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have to say I totally agree w\\/ Earwin - in my mind, the MP should be the one deciding what merges to run, and in what order, the MS should be the one executing them. Hack, we should really call MS a MergeExecutor, since it doesn\'t really schedule anything, just does what it\'s told, based on the execution policy (parallel or blocking).\u003c\\/p\u003e\\n\\n\u003cp\u003eIn my app, it\'s the MP which decides which merges to run, based on their sizes, time of the day and allotted time to run. I expect MS to faithfully do what it\'s told and don\'t play tricks on me (like pausing merges I\'ve asked it to run), \'cause otherwise I\'ll need to write a MS too.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother question that was brought up here is who should register the merges. Today there are two entities - one is the MS which repeatedly calls IW.getNextMerge() and in the CMS case, MergeThread does so too. The disadvantage of that is that IW.getNextMerge() (and mergeInit()) is called from two places, but the advantage is that it allows executing all of MP merges, even if they come in several rounds. Example, you have 4 segs of level 0 and 3 segs of level 1 (mergeFactor=4). MP returns a single merge (4 segs level 0), and IW.getNextMerge() returns null \'cause there are no merges left). However, after completing this merge, if asked, MP will return a follow on merge of 4 segs level 1. That will be picked up by the MergeThread that calls IW.getNextMerge().\u003c\\/p\u003e\\n\\n\u003cp\u003eThe thing is - the second round of merges may only be detected by MP after most if not all of the merges from the previous round ended. Therefore, if we dim that functionality important (and I do), we must have the MergeThreads query MP as well.\u003c\\/p\u003e\\n\\n\u003cp\u003eAbout mergeInit, I took a look too and discovered a 140 lines method, so I doubt it does only \\\"new segment name registration\\\". But perhaps I\'m wrong and those are redundant 140 lines ...\u003c\\/p\u003e\\n\\n\u003cp\u003eI think that having a MS entity (or MergeExecutor) is important - it still gives an app the ability to override things if it wants to. Also, putting the MS code inside IW will only add code to it, and I think that we should really start refactoring it down to smaller, more readable and focused, pieces. So I\'m against adding more logic to it. For 3x we can choose to improve things internally, or leave them as they are. For 4.0 I\'d suggest we do the following:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eCreate a new MergeExecutor entity receives an Executor(Service?) to run with, but also defaults to one (like CMS is today). That replaces CMS.\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eYou can control the number of threads it runs with (1 for almost-SMS-like behavior and more for CMS).\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eWe create a BlockingMergeExecutor, which regardless of how many threads you allow it to run with, blocks until all merges finish.\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eThat is an improved SMS - I\'ve always thought that blocking until merges finish is not related to how many threads you\'d like to execute merges with. E.g., if you set CMS\'s # threads to 1, you get a sort of an SMS behavior, only the call is non-blocking.\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eWe define MP as the one responsible for returning the merges in the order it wants, and provide the necessary support by making OneMerge comparable (Earwin, MP can still sort by using a custom Comparator, we only provide a default comparison method for merges). That definition will be mostly in javadocs.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932356_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932356_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 07:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T07:00:32+0000\'\u003e16\\/Nov\\/10 07:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have to say I totally agree w\\/ Earwin - in my mind, the MP should be the one deciding what merges to run, and in what order, the MS should be the one executing them. Hack, we should really call MS a MergeExecutor, since it doesn\'t really schedule anything, just does what it\'s told, based on the execution policy (parallel or blocking). \\n\\n In my app, it\'s the MP which decides which merges to run, based on their sizes, time of the day and allotted time to run. I expect MS to faithfully do what it\'s told and don\'t play tricks on me (like pausing merges I\'ve asked it to run), \'cause otherwise I\'ll need to write a MS too. \\n\\n Another question that was brought up here is who should register the merges. Today there are two entities - one is the MS which repeatedly calls IW.getNextMerge() and in the CMS case, MergeThread does so too. The disadvantage of that is that IW.getNextMerge() (and mergeInit()) is called from two places, but the advantage is that it allows executing all of MP merges, even if they come in several rounds. Example, you have 4 segs of level 0 and 3 segs of level 1 (mergeFactor=4). MP returns a single merge (4 segs level 0), and IW.getNextMerge() returns null \'cause there are no merges left). However, after completing this merge, if asked, MP will return a follow on merge of 4 segs level 1. That will be picked up by the MergeThread that calls IW.getNextMerge(). \\n\\n The thing is - the second round of merges may only be detected by MP after most if not all of the merges from the previous round ended. Therefore, if we dim that functionality important (and I do), we must have the MergeThreads query MP as well. \\n\\n About mergeInit, I took a look too and discovered a 140 lines method, so I doubt it does only \\\"new segment name registration\\\". But perhaps I\'m wrong and those are redundant 140 lines ... \\n\\n I think that having a MS entity (or MergeExecutor) is important - it still gives an app the ability to override things if it wants to. Also, putting the MS code inside IW will only add code to it, and I think that we should really start refactoring it down to smaller, more readable and focused, pieces. So I\'m against adding more logic to it. For 3x we can choose to improve things internally, or leave them as they are. For 4.0 I\'d suggest we do the following: \\n \\n\\t Create a new MergeExecutor entity receives an Executor(Service?) to run with, but also defaults to one (like CMS is today). That replaces CMS.\\n\\t \\n\\t\\t You can control the number of threads it runs with (1 for almost-SMS-like behavior and more for CMS). \\n\\t \\n\\t \\n\\t We create a BlockingMergeExecutor, which regardless of how many threads you allow it to run with, blocks until all merges finish.\\n\\t \\n\\t\\t That is an improved SMS - I\'ve always thought that blocking until merges finish is not related to how many threads you\'d like to execute merges with. E.g., if you set CMS\'s # threads to 1, you get a sort of an SMS behavior, only the call is non-blocking. \\n\\t \\n\\t \\n\\t We define MP as the one responsible for returning the merges in the order it wants, and provide the necessary support by making OneMerge comparable (Earwin, MP can still sort by using a custom Comparator, we only provide a default comparison method for merges). That definition will be mostly in javadocs. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932479\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932479&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932479\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12932479_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932479_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 14:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T14:36:22+0000\'\u003e16\\/Nov\\/10 14:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eBut then you accumulate too many tiny merges, while waiting for the big one to finish?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYou say this, as if it was something terribly wrong. \u003cbr\\/\u003e\\nBig merges aren\'t heffalumps, they don\'t usually stalk IW in droves. Big merge ends sooner or later, and tiny ones go out in a flash.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIn fact there is something wrong: without us explicitly scheduling the\u003cbr\\/\u003e\\nrunning merges (ie setting thread priorities, stopping the big merges\u003cbr\\/\u003e\\nwhen there are too many small ones), CMS will pause the incoming\u003cbr\\/\u003e\\nthreads.\u003c\\/p\u003e\\n\\n\u003cp\u003eI first saw this happen when testing our NRT reopen perf (which is\u003cbr\\/\u003e\\nmerge intensive).  Normally the turnaround is very fast (eg 5 msec)\u003cbr\\/\u003e\\nbut if you\'re at your max merge count then CMS will stall you and the\u003cbr\\/\u003e\\nturnaround time easily becomes seconds, which is awful.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s like an OS that refuses to schedule your \\\"ls\\\" command because\u003cbr\\/\u003e\\nthere\'s still some long running process...\u003c\\/p\u003e\\n\\n\u003cp\u003eCMS\'s explicit thread scheduling fixes that problem &#8211; a big merge no\u003cbr\\/\u003e\\nlonger causes seconds of delay in opening a new NRT reader.  That is,\u003cbr\\/\u003e\\nas long as net\\/net you\'ve allocated enough CPUs (maxThreadCount) to do\u003cbr\\/\u003e\\nthe merging.  If merging is too slow vs indexing rate + reopen rate\u003cbr\\/\u003e\\nthen there\'s no hope: at some point reopen must be blocked (it\'s\u003cbr\\/\u003e\\na zero sum game).\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the ideal world the OS\\/JRE would do a better job scheduling, ie\u003cbr\\/\u003e\\nrealize that there are looong running threads and down prioritize them\u003cbr\\/\u003e\\n(like the OS does to processes), but in practice it\'s nowhere close to\u003cbr\\/\u003e\\ndoing this right for our use case, so I don\'t see a choice here.  If\u003cbr\\/\u003e\\nwe want to keep our fast NRT reopen time, we have to manually schedule\u003cbr\\/\u003e\\nour merge threads.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eMaybe we should move BSMP to core and make it the default?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eDunno. The index you end up with is larger than with LogWhateverMP.\u003cbr\\/\u003e\\nBut you get a nice benefit of having roughly equal-sized big segments, which is cool for running collection in parallel.\u003cbr\\/\u003e\\nEveryone has his own requirements.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eFair enough...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eBut I don\'t fully understand how it chooses merges. EG does it pick lopsided merges (where the segments differ substantially in size), as long as they are \\\"small\\\" segments?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eDocs say small-sized segments are treated as with LogByteSizeMP.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm... but then how does this differ from setting a maxMergeMB\\/Docs?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWe have seriously inefficient \\\"merge conflict\\\" resolution algorithm on our hands.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYou\'re right!  Though, I think this typically isn\'t a problem for\u003cbr\\/\u003e\\nLogMP since it doesn\'t normally pick future merges that conflict with\u003cbr\\/\u003e\\npast ones.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso the problem is bounded by how long the merge takes to finish.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I agree we should try to fix this... other MPs could conceivably\u003cbr\\/\u003e\\ndo this.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eUgly solution - when MP suggests a merge that is a strict superset of a queued, but not yet running merge - drop the old one, use the new.\u003cbr\\/\u003e\\nBetter solution - instead of asking MP for all the merges it deems reasonable on current index, we only ask it for \\\"most important\\\" one.\u003cbr\\/\u003e\\nAnd we do it each time MS has an open slot for execution. This way each merge happening is the best merge possible at that moment.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis seems dangerous: what\'s an \\\"important\\\" merge?\u003c\\/p\u003e\\n\\n\u003cp\u003eHow about, instead, we let MP return all eligible merges (like it does\u003cbr\\/\u003e\\ntoday) but then we replace all previously buffered but not yet running\u003cbr\\/\u003e\\nmerges w\\/ the new merges it returned?  Hmm but this would probably\u003cbr\\/\u003e\\nrequire giving it access to the buffered-but-not-yet-running merge\u003cbr\\/\u003e\\nset...\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eAbout mergeInit, I took a look too and discovered a 140 lines method, so I doubt it does only \\\"new segment name registration\\\". But perhaps I\'m wrong and those are redundant 140 lines ...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRight &#8211; it\'s doing lots of stuff.  But the question was whether CMS\u003cbr\\/\u003e\\nreally must be calling it itself vs leaving IW.merge to call it as SMS\u003cbr\\/\u003e\\ndoes.  Ideally only IW.merge should call it (and it becomes private),\u003cbr\\/\u003e\\nwhich if we take the name assignment out \\\"earlier\\\" seems feasible.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12932479_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932479_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 14:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T14:36:22+0000\'\u003e16\\/Nov\\/10 14:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n  But then you accumulate too many tiny merges, while waiting for the big one to finish?  \\n\\n You say this, as if it was something terribly wrong.  \\nBig merges aren\'t heffalumps, they don\'t usually stalk IW in droves. Big merge ends sooner or later, and tiny ones go out in a flash.  \\n\\n In fact there is something wrong: without us explicitly scheduling the \\nrunning merges (ie setting thread priorities, stopping the big merges \\nwhen there are too many small ones), CMS will pause the incoming \\nthreads. \\n\\n I first saw this happen when testing our NRT reopen perf (which is \\nmerge intensive).  Normally the turnaround is very fast (eg 5 msec) \\nbut if you\'re at your max merge count then CMS will stall you and the \\nturnaround time easily becomes seconds, which is awful. \\n\\n It\'s like an OS that refuses to schedule your \\\"ls\\\" command because \\nthere\'s still some long running process... \\n\\n CMS\'s explicit thread scheduling fixes that problem &#8211; a big merge no \\nlonger causes seconds of delay in opening a new NRT reader.  That is, \\nas long as net\\/net you\'ve allocated enough CPUs (maxThreadCount) to do \\nthe merging.  If merging is too slow vs indexing rate + reopen rate \\nthen there\'s no hope: at some point reopen must be blocked (it\'s \\na zero sum game). \\n\\n In the ideal world the OS\\/JRE would do a better job scheduling, ie \\nrealize that there are looong running threads and down prioritize them \\n(like the OS does to processes), but in practice it\'s nowhere close to \\ndoing this right for our use case, so I don\'t see a choice here.  If \\nwe want to keep our fast NRT reopen time, we have to manually schedule \\nour merge threads. \\n\\n \\n  Maybe we should move BSMP to core and make it the default?  \\n\\n Dunno. The index you end up with is larger than with LogWhateverMP. \\nBut you get a nice benefit of having roughly equal-sized big segments, which is cool for running collection in parallel. \\nEveryone has his own requirements.  \\n\\n Fair enough... \\n\\n \\n  But I don\'t fully understand how it chooses merges. EG does it pick lopsided merges (where the segments differ substantially in size), as long as they are \\\"small\\\" segments?  \\n\\n Docs say small-sized segments are treated as with LogByteSizeMP.  \\n\\n Hmm... but then how does this differ from setting a maxMergeMB\\/Docs? \\n\\n  We have seriously inefficient \\\"merge conflict\\\" resolution algorithm on our hands.  \\n\\n You\'re right!  Though, I think this typically isn\'t a problem for \\nLogMP since it doesn\'t normally pick future merges that conflict with \\npast ones. \\n\\n Also the problem is bounded by how long the merge takes to finish. \\n\\n But I agree we should try to fix this... other MPs could conceivably \\ndo this. \\n\\n \\n Ugly solution - when MP suggests a merge that is a strict superset of a queued, but not yet running merge - drop the old one, use the new. \\nBetter solution - instead of asking MP for all the merges it deems reasonable on current index, we only ask it for \\\"most important\\\" one. \\nAnd we do it each time MS has an open slot for execution. This way each merge happening is the best merge possible at that moment.  \\n\\n This seems dangerous: what\'s an \\\"important\\\" merge? \\n\\n How about, instead, we let MP return all eligible merges (like it does \\ntoday) but then we replace all previously buffered but not yet running \\nmerges w\\/ the new merges it returned?  Hmm but this would probably \\nrequire giving it access to the buffered-but-not-yet-running merge \\nset... \\n\\n\\n  About mergeInit, I took a look too and discovered a 140 lines method, so I doubt it does only \\\"new segment name registration\\\". But perhaps I\'m wrong and those are redundant 140 lines ...  \\n\\n Right &#8211; it\'s doing lots of stuff.  But the question was whether CMS \\nreally must be calling it itself vs leaving IW.merge to call it as SMS \\ndoes.  Ideally only IW.merge should call it (and it becomes private), \\nwhich if we take the name assignment out \\\"earlier\\\" seems feasible.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932486\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932486&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932486\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932486_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932486_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 14:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T14:56:32+0000\'\u003e16\\/Nov\\/10 14:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIdeally only IW.merge should call it (and it becomes private),\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI wouldn\'t make it private. If I remember correctly, the Parallel Index overrode that method to synchronize merges across all parallels.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ebut if you\'re at your max merge count then CMS will stall you and the turnaround time easily becomes seconds, which is awful.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBut Mike, if you hit your maxMergeCount with large merges, then you won\'t run tiny merges at all. It\'s only if you have room to run any merges, that this \'pausing\' actually helps. I trust you when you say you\'ve observed that not pausing those merges hurt performance, but I wonder in real life, how often does that happen, and whether we should incorporate that in our code. If it\'s a rare case, then perhaps apps that hit it should use another MS which pauses its threads?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932486_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932486_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 14:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T14:56:32+0000\'\u003e16\\/Nov\\/10 14:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Ideally only IW.merge should call it (and it becomes private),  \\n\\n I wouldn\'t make it private. If I remember correctly, the Parallel Index overrode that method to synchronize merges across all parallels. \\n\\n  but if you\'re at your max merge count then CMS will stall you and the turnaround time easily becomes seconds, which is awful.  \\n\\n But Mike, if you hit your maxMergeCount with large merges, then you won\'t run tiny merges at all. It\'s only if you have room to run any merges, that this \'pausing\' actually helps. I trust you when you say you\'ve observed that not pausing those merges hurt performance, but I wonder in real life, how often does that happen, and whether we should incorporate that in our code. If it\'s a rare case, then perhaps apps that hit it should use another MS which pauses its threads?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932539\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932539&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932539\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12932539_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932539_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 17:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T17:08:24+0000\'\u003e16\\/Nov\\/10 17:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eIdeally only IW.merge should call it (and it becomes private),\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI wouldn\'t make it private. If I remember correctly, the Parallel Index overrode that method to synchronize merges across all parallels.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAhh OK.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBut Mike, if you hit your maxMergeCount with large merges, then you won\'t run tiny merges at all.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSure, but that\'s uncommon.  Ie, large merges don\'t happen very\u003cbr\\/\u003e\\nfrequently.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIt\'s only if you have room to run any merges, that this \'pausing\' actually helps. I trust you when you say you\'ve observed that not pausing those merges hurt performance, but I wonder in real life, how often does that happen, and whether we should incorporate that in our code. If it\'s a rare case, then perhaps apps that hit it should use another MS which pauses its threads?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRemember it\'s not just pausing.  We also set thread priorities so that\u003cbr\\/\u003e\\nsmaller merges run with higher priority, and, all merges run with\u003cbr\\/\u003e\\nhigher priority than the indexing threads (by default).\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think this is rare because eventually (assuming your index is\u003cbr\\/\u003e\\nbig enough) you\'ll hit a large merge and then you can fairly easily\u003cbr\\/\u003e\\nsee the merges stack up.  I\'ve seen merges stack up in the non-NRT\u003cbr\\/\u003e\\ncase too.  Without this explicit thread scheduling we do, that large\u003cbr\\/\u003e\\nmerge can easily kill your NRT reopens, ie take many seconds to get a\u003cbr\\/\u003e\\nnew reader.  This is non-graceful degradation because at first NRT\u003cbr\\/\u003e\\nreopen time looks great but then as your index grows and you hit a\u003cbr\\/\u003e\\nlarge merge, suddenly it\'s many seconds.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf your app has costly merges (eg you store fields, term vectors, and\u003cbr\\/\u003e\\nyou use dynamic fields which means the stores cannot be bulk merged),\u003cbr\\/\u003e\\nand you\'re not on an SSD, and your OS is memory starved so it can\'t do\u003cbr\\/\u003e\\nas much readahead as it should be doing, your merges become far more\u003cbr\\/\u003e\\ncostly.  Worse, the default merge thread count (3) may in fact be too high\u003cbr\\/\u003e\\nfor most machines even with 4 or more cores.  There are many variables...\u003c\\/p\u003e\\n\\n\u003cp\u003eThe scheduling can only do so much, of course.  Ie it enables us to\u003cbr\\/\u003e\\nsoak up the \\\"spare\\\" CPU cycles in between medium, little merges to let\u003cbr\\/\u003e\\nthe bit merge make progress.  But if those spare cycles aren\'t enough\u003cbr\\/\u003e\\nthen inevitably the best scheduling will still have to eventually\u003cbr\\/\u003e\\npause your reopens.\u003c\\/p\u003e\\n\\n\u003cp\u003eStill I think the other improvements we\'ve talked about here would be\u003cbr\\/\u003e\\ngreat steps forward.  It\'s just that we still need to explicitly\u003cbr\\/\u003e\\nschedule the merge threads.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12932539_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932539_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 17:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T17:08:24+0000\'\u003e16\\/Nov\\/10 17:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n \\n  Ideally only IW.merge should call it (and it becomes private),  \\n\\n I wouldn\'t make it private. If I remember correctly, the Parallel Index overrode that method to synchronize merges across all parallels.  \\n\\n Ahh OK. \\n\\n  But Mike, if you hit your maxMergeCount with large merges, then you won\'t run tiny merges at all.  \\n\\n Sure, but that\'s uncommon.  Ie, large merges don\'t happen very \\nfrequently. \\n\\n  It\'s only if you have room to run any merges, that this \'pausing\' actually helps. I trust you when you say you\'ve observed that not pausing those merges hurt performance, but I wonder in real life, how often does that happen, and whether we should incorporate that in our code. If it\'s a rare case, then perhaps apps that hit it should use another MS which pauses its threads?  \\n\\n Remember it\'s not just pausing.  We also set thread priorities so that \\nsmaller merges run with higher priority, and, all merges run with \\nhigher priority than the indexing threads (by default). \\n\\n I don\'t think this is rare because eventually (assuming your index is \\nbig enough) you\'ll hit a large merge and then you can fairly easily \\nsee the merges stack up.  I\'ve seen merges stack up in the non-NRT \\ncase too.  Without this explicit thread scheduling we do, that large \\nmerge can easily kill your NRT reopens, ie take many seconds to get a \\nnew reader.  This is non-graceful degradation because at first NRT \\nreopen time looks great but then as your index grows and you hit a \\nlarge merge, suddenly it\'s many seconds. \\n\\n If your app has costly merges (eg you store fields, term vectors, and \\nyou use dynamic fields which means the stores cannot be bulk merged), \\nand you\'re not on an SSD, and your OS is memory starved so it can\'t do \\nas much readahead as it should be doing, your merges become far more \\ncostly.  Worse, the default merge thread count (3) may in fact be too high \\nfor most machines even with 4 or more cores.  There are many variables... \\n\\n The scheduling can only do so much, of course.  Ie it enables us to \\nsoak up the \\\"spare\\\" CPU cycles in between medium, little merges to let \\nthe bit merge make progress.  But if those spare cycles aren\'t enough \\nthen inevitably the best scheduling will still have to eventually \\npause your reopens. \\n\\n Still I think the other improvements we\'ve talked about here would be \\ngreat steps forward.  It\'s just that we still need to explicitly \\nschedule the merge threads.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932561\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932561&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932561\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932561_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932561_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 17:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T17:53:42+0000\'\u003e16\\/Nov\\/10 17:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eShai:\u003c\\/p\u003e\\n\u003cblockquote\u003e\u003cp\u003eThe thing is - the second round of merges may only be detected by MP after most if not all of the merges from the previous round ended. Therefore, if we dim that functionality important (and I do), we must have the MergeThreads query MP as well.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eDon\'t turn things upside down. MergeThreads are best hidden from view inside Executor, we just feed it chunks of work in the order we want it to be done. It\'s quite enough to have a single place that queries MP and feeds Executor.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAbout mergeInit, I took a look too and discovered a 140 lines method, so I doubt it does only \\\"new segment name registration\\\". But perhaps I\'m wrong and those are redundant 140 lines ...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThese are not redundant. But only a small number of them really need to be executed when a merge is added to CMS, everything else can wait until merge actually starts.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI think that having a MS entity (or MergeExecutor) is important - it still gives an app the ability to override things if it wants to.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eTentatively agree on this.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAlso, putting the MS code inside IW will only add code to it, \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eBut this is not true, with all the cruft thrown away, remaining code size is likely on par with current that invokes MS from within IW.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWe define MP as the one responsible for returning the merges in the order it wants, and provide the necessary support by making OneMerge comparable\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYou contradict yourself here. If we make OneMerge comparable, we define order in its compareTo() method. MP can no longer return the merges in the order it wants. I suggest there\'s no Comparable, and MP does the sort itself and returns an ordered list of merges. Better yet - it returns only the first one of them, on each request.\u003c\\/p\u003e\\n\\n\\n\\n\u003cp\u003eMike:\u003c\\/p\u003e\\n\u003cblockquote\u003e\u003cp\u003eIn fact there is something wrong: without us explicitly scheduling the running merges (ie setting thread priorities, stopping the big merges when there are too many small ones), CMS will pause the incoming threads.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWhy?? Indexing threads can drop merges into a queue, and forget about them. The blocking happens only if you explicitly want to use the same thread for merging, or if merging threads are lagging - in such a case you\'re in for troubles anyway.\u003cbr\\/\u003e\\nAll further analogies with OS scheduling are broken because we\'re not running \\\"ls\\\", we\'re running background jobs, and don\'t really care which of them blocks which.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eDocs say small-sized segments are treated as with LogByteSizeMP.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eHmm... but then how does this differ from setting a maxMergeMB\\/Docs?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eBSMP doesn\'t keep your segments under certain size like maxMergeMB does. It ensures you have exactly N \'large\' segments. How large they are - depends on total size of the index.\u003cbr\\/\u003e\\nIt also limits the maximum count of \'small\' segments, the size distribution for them is the same as with LBSMP.\u003cbr\\/\u003e\\nI think the \u003ca href=\\\"http:\\/\\/code.google.com\\/p\\/zoie\\/wiki\\/ZoieMergePolicy\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003edocs\u003c\\/a\u003e are pretty good.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eThis seems dangerous: what\'s an \\\"important\\\" merge?\u003c\\/p\u003e\\n\\n\u003cp\u003eHow about, instead, we let MP return all eligible merges (like it does\u003cbr\\/\u003e\\ntoday) but then we replace all previously buffered but not yet running\u003cbr\\/\u003e\\nmerges w\\/ the new merges it returned? Hmm but this would probably\u003cbr\\/\u003e\\nrequire giving it access to the buffered-but-not-yet-running merge\u003cbr\\/\u003e\\nset...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWe already decided that merges should be sorted? And MP gives us a bunch of them. Sort the bunch, pick the first one - that\'s your \\\"important\\\" merge.\u003cbr\\/\u003e\\nBy calling this MP.giveMeNextImportantMerge() method repeatedly we free ourselves from tons of bookkeeping you just mentioned.\u003c\\/p\u003e\\n\\n\u003cp\u003eHo-ho-ho! In fact, we don\'t need any queues, any buffering, no hard link between indexing and merging - no nothing at all \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nHere\'s my proposal cleaned up and reiterated:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eMP has a single method - getNextMerge() (I\'m not taking optimize and friends into account now)\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eFor current policies this method works as described before - MP decides on a list of eligible merges, sorts them by some criteria (i.e. smaller merges come first) and returns the first.\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eMS repeatedly polls MP for merges (in one or more threads) and executes them.\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eIf getNextMerge() returns null, MS goes to sleep - null signifies that from MP\'s perspective index is already in ideal state.\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eWhen some index-changing events occur, eg - indexing thread adds some docs and creates a new segment, MS is woken up and resumes polling\\/merging.\u003c\\/li\u003e\\n\\t\\t\u003cli\u003erinse, repeat\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eIn CMS-like scenario, indexing and merging threads are completely decoupled and even lack queues that could overflow. So if some lesser merges have to wait for the big one - that\'s not going to bite you at all.\u003c\\/li\u003e\\n\\t\u003cli\u003eIn SMS-like scenario, polling happens within indexing thread, and everything works as it does now.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eStill I think the other improvements we\'ve talked about here would be great steps forward.\u003cbr\\/\u003e\\nIt\'s just that we still need to explicitly schedule the merge threads.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eAs I just described - we don\'t have to \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nAnd if you really want to preserve that monster of pausing and priority control (largely broken for java anyway), forget about Executors - they don\'t support this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932561_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932561_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 17:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T17:53:42+0000\'\u003e16\\/Nov\\/10 17:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Shai: \\n  The thing is - the second round of merges may only be detected by MP after most if not all of the merges from the previous round ended. Therefore, if we dim that functionality important (and I do), we must have the MergeThreads query MP as well.  \\n Don\'t turn things upside down. MergeThreads are best hidden from view inside Executor, we just feed it chunks of work in the order we want it to be done. It\'s quite enough to have a single place that queries MP and feeds Executor. \\n\\n  About mergeInit, I took a look too and discovered a 140 lines method, so I doubt it does only \\\"new segment name registration\\\". But perhaps I\'m wrong and those are redundant 140 lines ...  \\n These are not redundant. But only a small number of them really need to be executed when a merge is added to CMS, everything else can wait until merge actually starts. \\n\\n  I think that having a MS entity (or MergeExecutor) is important - it still gives an app the ability to override things if it wants to.  \\n Tentatively agree on this. \\n\\n  Also, putting the MS code inside IW will only add code to it,   \\n But this is not true, with all the cruft thrown away, remaining code size is likely on par with current that invokes MS from within IW. \\n\\n  We define MP as the one responsible for returning the merges in the order it wants, and provide the necessary support by making OneMerge comparable  \\n You contradict yourself here. If we make OneMerge comparable, we define order in its compareTo() method. MP can no longer return the merges in the order it wants. I suggest there\'s no Comparable, and MP does the sort itself and returns an ordered list of merges. Better yet - it returns only the first one of them, on each request. \\n\\n\\n\\n Mike: \\n  In fact there is something wrong: without us explicitly scheduling the running merges (ie setting thread priorities, stopping the big merges when there are too many small ones), CMS will pause the incoming threads.  \\n Why?? Indexing threads can drop merges into a queue, and forget about them. The blocking happens only if you explicitly want to use the same thread for merging, or if merging threads are lagging - in such a case you\'re in for troubles anyway. \\nAll further analogies with OS scheduling are broken because we\'re not running \\\"ls\\\", we\'re running background jobs, and don\'t really care which of them blocks which. \\n\\n \\n  Docs say small-sized segments are treated as with LogByteSizeMP.  \\n Hmm... but then how does this differ from setting a maxMergeMB\\/Docs?  \\n BSMP doesn\'t keep your segments under certain size like maxMergeMB does. It ensures you have exactly N \'large\' segments. How large they are - depends on total size of the index. \\nIt also limits the maximum count of \'small\' segments, the size distribution for them is the same as with LBSMP. \\nI think the  docs  are pretty good. \\n\\n \\n This seems dangerous: what\'s an \\\"important\\\" merge? \\n\\n How about, instead, we let MP return all eligible merges (like it does \\ntoday) but then we replace all previously buffered but not yet running \\nmerges w\\/ the new merges it returned? Hmm but this would probably \\nrequire giving it access to the buffered-but-not-yet-running merge \\nset...  \\n We already decided that merges should be sorted? And MP gives us a bunch of them. Sort the bunch, pick the first one - that\'s your \\\"important\\\" merge. \\nBy calling this MP.giveMeNextImportantMerge() method repeatedly we free ourselves from tons of bookkeeping you just mentioned. \\n\\n Ho-ho-ho! In fact, we don\'t need any queues, any buffering, no hard link between indexing and merging - no nothing at all   \\nHere\'s my proposal cleaned up and reiterated: \\n\\n \\n\\t MP has a single method - getNextMerge() (I\'m not taking optimize and friends into account now)\\n\\t \\n\\t\\t For current policies this method works as described before - MP decides on a list of eligible merges, sorts them by some criteria (i.e. smaller merges come first) and returns the first. \\n\\t \\n\\t \\n\\t MS repeatedly polls MP for merges (in one or more threads) and executes them.\\n\\t \\n\\t\\t If getNextMerge() returns null, MS goes to sleep - null signifies that from MP\'s perspective index is already in ideal state. \\n\\t\\t When some index-changing events occur, eg - indexing thread adds some docs and creates a new segment, MS is woken up and resumes polling\\/merging. \\n\\t\\t rinse, repeat \\n\\t \\n\\t \\n\\t In CMS-like scenario, indexing and merging threads are completely decoupled and even lack queues that could overflow. So if some lesser merges have to wait for the big one - that\'s not going to bite you at all. \\n\\t In SMS-like scenario, polling happens within indexing thread, and everything works as it does now. \\n \\n\\n\\n \\n Still I think the other improvements we\'ve talked about here would be great steps forward. \\nIt\'s just that we still need to explicitly schedule the merge threads.  \\n As I just described - we don\'t have to   \\nAnd if you really want to preserve that monster of pausing and priority control (largely broken for java anyway), forget about Executors - they don\'t support this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932599\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932599&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932599\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12932599_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932599_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 18:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T18:52:43+0000\'\u003e16\\/Nov\\/10 18:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003elarge merge can easily kill your NRT reopens\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhen RT is implemented, these small segments (that require merging) go\u003cbr\\/\u003e\\naway because we\'ll be flushing relatively medium sized segments the size\u003cbr\\/\u003e\\nof the RAM buffer.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'d prefer to have more control of large merges from an external process\u003cbr\\/\u003e\\nso that they may be scheduled according to application demand, ie, during\u003cbr\\/\u003e\\nnon-peak hours. This is actually what I\'ve implemented in production using\u003cbr\\/\u003e\\nthings like optimize num segments = 5 and\\/or expunge deletes during the\u003cbr\\/\u003e\\nearly morning hours. However the external control is doable today using an\u003cbr\\/\u003e\\nexisting merge policy such as LogByteSizeMergePolicy, where during the day\u003cbr\\/\u003e\\nfor example, the maximum segment size could be lower, and in the early\u003cbr\\/\u003e\\nmorning, it\'d be set to something much higher, or nullified altogether. \u003c\\/p\u003e\\n\\n\u003cp\u003eAlso the problems associated with merge interleaving only affects systems\u003cbr\\/\u003e\\nthat are not using replication because the merging is occurring on an\u003cbr\\/\u003e\\nindex-only server. The newly merged files are transferred over as is, and\u003cbr\\/\u003e\\nthat\'s something that can easily be interleaved with other IO processes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12932599_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932599_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Nov\\/10 18:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-16T18:52:43+0000\'\u003e16\\/Nov\\/10 18:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     large merge can easily kill your NRT reopens  \\n\\n When RT is implemented, these small segments (that require merging) go \\naway because we\'ll be flushing relatively medium sized segments the size \\nof the RAM buffer. \\n\\n I\'d prefer to have more control of large merges from an external process \\nso that they may be scheduled according to application demand, ie, during \\nnon-peak hours. This is actually what I\'ve implemented in production using \\nthings like optimize num segments = 5 and\\/or expunge deletes during the \\nearly morning hours. However the external control is doable today using an \\nexisting merge policy such as LogByteSizeMergePolicy, where during the day \\nfor example, the maximum segment size could be lower, and in the early \\nmorning, it\'d be set to something much higher, or nullified altogether.  \\n\\n Also the problems associated with merge interleaving only affects systems \\nthat are not using replication because the merging is occurring on an \\nindex-only server. The newly merged files are transferred over as is, and \\nthat\'s something that can easily be interleaved with other IO processes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932807\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932807&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932807\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932807_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932807_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Nov\\/10 04:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-17T04:20:44+0000\'\u003e17\\/Nov\\/10 04:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eYou contradict yourself here. If we make OneMerge comparable, we define order in its compareTo() method. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think it\'s convenient to have OneMerge comparable somehow. But we can have MP sort them using its own Comparator. By making them Comparable I intended to say \'this is the default order\' - but we can have a DefaultComparator instead.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we proceed w\\/ your proposal, that is basically the MS\\/ME polling MP, and not IW doing so, how would IW know about the running merges and pending ones? Today IW tracks those two lists so that if you need to abort merges, it knows which ones to abort.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe can workaround aborting the running merges by introducing a MS.abort()-like method. But what about MP? Now the lists are divided between too entities (MP and MS), and aborting a MP does not make sense (doable, but I don\'t think it belongs there). Maybe we can have MS.abort() poll MP for next merges until it returns null, and throwing all the returned ones away - that can be done. Aborting an Executor is easy, and I think can be faster than our current way of doing so.\u003c\\/p\u003e\\n\\n\u003cp\u003eI would still love to see the merge code (as much as possible) going away from IW. This may not be doable now, but could be in the future, if we factor out a SegmentsMerger\\/IndexMerger entity which encapsulates the merge execution and policy inside. But this is for another day.\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW, MS.merge() takes an IW, as if you could call merge() w\\/ two IW instances and things will work ok. It does in SMS but doesn\'t in CMS. Should we, in the scope of this issue, make IW a required settable parameter on MS, like we do w\\/ MP?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932807_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932807_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Nov\\/10 04:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-17T04:20:44+0000\'\u003e17\\/Nov\\/10 04:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     You contradict yourself here. If we make OneMerge comparable, we define order in its compareTo() method.   \\n\\n I think it\'s convenient to have OneMerge comparable somehow. But we can have MP sort them using its own Comparator. By making them Comparable I intended to say \'this is the default order\' - but we can have a DefaultComparator instead. \\n\\n If we proceed w\\/ your proposal, that is basically the MS\\/ME polling MP, and not IW doing so, how would IW know about the running merges and pending ones? Today IW tracks those two lists so that if you need to abort merges, it knows which ones to abort. \\n\\n We can workaround aborting the running merges by introducing a MS.abort()-like method. But what about MP? Now the lists are divided between too entities (MP and MS), and aborting a MP does not make sense (doable, but I don\'t think it belongs there). Maybe we can have MS.abort() poll MP for next merges until it returns null, and throwing all the returned ones away - that can be done. Aborting an Executor is easy, and I think can be faster than our current way of doing so. \\n\\n I would still love to see the merge code (as much as possible) going away from IW. This may not be doable now, but could be in the future, if we factor out a SegmentsMerger\\/IndexMerger entity which encapsulates the merge execution and policy inside. But this is for another day. \\n\\n BTW, MS.merge() takes an IW, as if you could call merge() w\\/ two IW instances and things will work ok. It does in SMS but doesn\'t in CMS. Should we, in the scope of this issue, make IW a required settable parameter on MS, like we do w\\/ MP?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932864\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932864&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932864\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932864_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932864_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Nov\\/10 08:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-17T08:52:36+0000\'\u003e17\\/Nov\\/10 08:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eIf we proceed w\\/ your proposal, that is basically the MS\\/ME polling MP, and not IW doing so, how would IW know about the running merges and pending ones? Today IW tracks those two lists so that if you need to abort merges, it knows which ones to abort.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe can workaround aborting the running merges by introducing a MS.abort()-like method. But what about MP? Now the lists are divided between too entities (MP and MS), and aborting a MP does not make sense (doable, but I don\'t think it belongs there). \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThere are no lists at all with my approach. At least no \\\"pending\\\" list, that one gets recalculated each time we poll MP and it never gets out, neither gets stored inside.\u003cbr\\/\u003e\\nThere\'s a kind of implicit \\\"in flight\\\" list - MS has the knowledge of its threads that are currently doing things. And if you want to go around aborting things, MS is probably the right place to do this.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMaybe we can have MS.abort() poll MP for next merges until it returns null, and throwing all the returned ones away - that can be done.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eSo, just I said - that\'s not needed. MP is empty, it has no state.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eShould we, in the scope of this issue, make IW a required settable parameter on MS, like we do w\\/ MP?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eFor the love of God, no. I\'d like to see it removed from MP too.\u003cbr\\/\u003e\\nIt\'s only natural to pass the same instance of Policy or Scheduler to different Writers, so they have the same behaviour and share Scheduler resources (insanely important if you have fifteen indexes like I do and don\'t want them to rape hardware with fifteen simultaneous merges).\u003cbr\\/\u003e\\nIt is against the nature to pass Writer to Policy. Does the Policy need to write anything on its own, when it decides to? No. It should advice, not act.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12932864_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932864_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Nov\\/10 08:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-17T08:52:36+0000\'\u003e17\\/Nov\\/10 08:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n If we proceed w\\/ your proposal, that is basically the MS\\/ME polling MP, and not IW doing so, how would IW know about the running merges and pending ones? Today IW tracks those two lists so that if you need to abort merges, it knows which ones to abort. \\n\\n We can workaround aborting the running merges by introducing a MS.abort()-like method. But what about MP? Now the lists are divided between too entities (MP and MS), and aborting a MP does not make sense (doable, but I don\'t think it belongs there).   \\n There are no lists at all with my approach. At least no \\\"pending\\\" list, that one gets recalculated each time we poll MP and it never gets out, neither gets stored inside. \\nThere\'s a kind of implicit \\\"in flight\\\" list - MS has the knowledge of its threads that are currently doing things. And if you want to go around aborting things, MS is probably the right place to do this. \\n\\n  Maybe we can have MS.abort() poll MP for next merges until it returns null, and throwing all the returned ones away - that can be done.  \\n So, just I said - that\'s not needed. MP is empty, it has no state. \\n\\n  Should we, in the scope of this issue, make IW a required settable parameter on MS, like we do w\\/ MP?  \\n For the love of God, no. I\'d like to see it removed from MP too. \\nIt\'s only natural to pass the same instance of Policy or Scheduler to different Writers, so they have the same behaviour and share Scheduler resources (insanely important if you have fifteen indexes like I do and don\'t want them to rape hardware with fifteen simultaneous merges). \\nIt is against the nature to pass Writer to Policy. Does the Policy need to write anything on its own, when it decides to? No. It should advice, not act.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932982\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12932982&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932982\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932982_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932982_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Nov\\/10 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-17T15:17:24+0000\'\u003e17\\/Nov\\/10 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eEarwin, the way CMS currently handles the writer instance makes it entirely not thread-safe. If you e.g. pass different writers to merge(), the class member changes, and MTs will start merging other segments, and in the worse case attempt to merge segments of a different writer.\u003c\\/p\u003e\\n\\n\u003cp\u003eI myself thinks it\'s ok to have a MP and MS per writer, but I don\'t have too strong feelings for\\/against it - so if we want to allow this, we should fix CMS.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs for the other comments, I\'ll need to check more closely what IW does w\\/ those merges - as it checks all sorts of things (e.g. whether it\'s an optimize merge or not, see one of the latest bugs Mike resolved). So getting it entirely outside of IndexWriter and into MP\\/MS is risky - at least, I don\'t understand the code well enough (yet) to say whether it\'s doable at all and if we don\'t miss something.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12932982_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932982_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Nov\\/10 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-17T15:17:24+0000\'\u003e17\\/Nov\\/10 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Earwin, the way CMS currently handles the writer instance makes it entirely not thread-safe. If you e.g. pass different writers to merge(), the class member changes, and MTs will start merging other segments, and in the worse case attempt to merge segments of a different writer. \\n\\n I myself thinks it\'s ok to have a MP and MS per writer, but I don\'t have too strong feelings for\\/against it - so if we want to allow this, we should fix CMS. \\n\\n As for the other comments, I\'ll need to check more closely what IW does w\\/ those merges - as it checks all sorts of things (e.g. whether it\'s an optimize merge or not, see one of the latest bugs Mike resolved). So getting it entirely outside of IndexWriter and into MP\\/MS is risky - at least, I don\'t understand the code well enough (yet) to say whether it\'s doable at all and if we don\'t miss something.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12935327\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12935327&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12935327\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12935327_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12935327_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Nov\\/10 14:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-24T14:03:30+0000\'\u003e24\\/Nov\\/10 14:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThere are several points addressed by this issue:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eRefactor IW, MS and MP so that MS pulls merges directly from MP, instead from IW.\u003c\\/li\u003e\\n\\t\u003cli\u003eRewrite CMS to take advantage of ThreadPoolExecutor instead of managing the threads on its own, in addition to using a blocking queue instead of us coding the blocking directly.\u003c\\/li\u003e\\n\\t\u003cli\u003eOne should be able to reuse CMS across several IndexWriters, which is not possible today, to e.g., allow one controlling the total # of merges happening in the JVM.\u003c\\/li\u003e\\n\\t\u003cli\u003eMerges should be sorted by their size in bytes and not by their # of docs &#8211; or actually, merges should be sorted by a criteria the MP determines.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAll the while maintaining the following requirements, in no particular order:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eMergeThreads\' priority needs to be controllable - this is the current behavior of CMS that we\'d like to keep.\u003c\\/li\u003e\\n\\t\u003cli\u003eWhen there are too many merges to execute, small ones should be preferred to large ones, and we need the ability to pause large merges in favor of small ones.\u003c\\/li\u003e\\n\\t\u003cli\u003eThe user needs to be able to control:\\n\\t\u003col\u003e\\n\\t\\t\u003cli\u003eThe max number of running merges\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eThe max number of merges, above which scheduling more merges should be blocked.\u003c\\/li\u003e\\n\\t\u003c\\/ol\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eWe should keep the sync() API, which lets the user wait for all scheduled merges to complete.\u003c\\/li\u003e\\n\\t\u003cli\u003eThe MP needs to be aware of the type of merges that are requested (regular, optimize, expunge).\u003c\\/li\u003e\\n\\t\u003cli\u003eThe user should be able to fast-close the index, aborting all merges (running and pending).\u003c\\/li\u003e\\n\\t\u003cli\u003eIf there are cascading merges (i.e., a result of several other merges), they should all be executed following the call to MS.merge() &#8211; that is, it could be that CMS itself, or its MergeThreads will encounter merges not returned by MP at first, but as a subsequent round due to changes done to the index.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAfter investigating the code and going over the proposed plan, I feel that we cannot accomplish all that we\'d like to do, given the above requirements. And just to be clear, those are not \u003cb\u003eany\u003c\\/b\u003e application requirements, but the default ones we\'d like Lucene to offer OOtB. One can still write a MS\\/MP which doesn\'t guarantee all that.\u003c\\/p\u003e\\n\\n\u003cp\u003eUsing ThreadPoolExecutor looks like will only complicate CMS instead of simplifying it:\u003c\\/p\u003e\\n\u003col\u003e\\n\\t\u003cli\u003eBecause of all the requirements I\'ve listed above, we\'d need to trick TPE into starting more threads than we intend to run, while we pause some of them.\u003c\\/li\u003e\\n\\t\u003cli\u003eIn order to set threads\' priorities, we need to write our own ThreadFactory to pass to TPE, and inside it keep track of the allocated Threads and those that still run, so that we can control their priority.\u003c\\/li\u003e\\n\\t\u003cli\u003eThere\'s no trivial way to impl sync(), as TPE does not provide API we can rely on (e.g. checking when all threads are done). There are ways to impl that, using Semaphore (see next bullet).\u003c\\/li\u003e\\n\\t\u003cli\u003eIn order to block the app on too many merges being scheduled, we\'d need to use a Semaphore, because even if we use a BlockingQueue w\\/ TPE, the submit() call won\'t block, but simply reject the item.\u003c\\/li\u003e\\n\\t\u003cli\u003eIn order to execute cascading merges as well, we\'d need the TPE threads (or the Runnable we submit) to poll getNextMerge() until null is returned. This breaks the concepts of Executors, where a task is submitted, done and that\'s it. I wouldn\'t mind if we did it still though.\u003c\\/li\u003e\\n\u003c\\/ol\u003e\\n\\n\\n\u003cp\u003eAll of these make me think that TPE, at this point at least, is not suitable for CMS. While it\'s doable, it\'s not going to make CMS code any simpler. And it looks more as if we\'ll enforce TPE in CMS, than it is really useful.\u003c\\/p\u003e\\n\\n\u003cp\u003eRefactoring IW, MS and MP seems to not simplify anything, really:\u003c\\/p\u003e\\n\u003col\u003e\\n\\t\u003cli\u003eWe\'d still need IW telling MP which merges are needed (optimize, regular or expunge), so the three findMergesForXYZ will need to remain.\u003c\\/li\u003e\\n\\t\u003cli\u003eThe proposal will add a getNextMerge() to MP, instead of IW, which IMO will only complicate matters for MP implementers. E.g., what should MP do if findRegularMerges was called, then getNext() was called and then findOptimizeMerges is called? It\'s not a critical decision we leave in the MP developers, but IMO it\'s unnecessary. Today MP is a stateless object - it receives SegmentInfos and returns a MergeSpec. It doesn\'t need to \'remember\' anything. But if we move the getNextMerge() to it, we make it stateful, for no good reasons\u003c\\/li\u003e\\n\\t\u003cli\u003eWe don\'t really take IW outside the loop really - it would still need to instruct MP which merges to \'prepare\', so that MS can take.\u003c\\/li\u003e\\n\\t\u003cli\u003eWe\'d need to introduce an abort\\/cancel() API on MS, which adds another responsibility for MS, but doesn\'t remove much from IW.\u003c\\/li\u003e\\n\u003c\\/ol\u003e\\n\\n\\n\u003cp\u003eAll in all, I don\'t think this refactoring simplifies IW-MS-MP communication a lot or allows custom MS and MPs have more control over what\'s going on. IW, as the mediator, is nothing but the mediator, which happens to know (as it should) which merges finish and if the state of the index changed, ask MP for more merges. That that it keeps track of pending and running merges, to me, is not a big deal. In fact, due to IW.waitForMerges() it either must continue to keep track of pending\\/running merges, or we add a sync() API to every MS.\u003c\\/p\u003e\\n\\n\u003cp\u003eFixing CMS to allow sharing across multiple IndexWriter instances is important IMO, so I\'ll look into fixing it. To allow for MP dependent sort, I suggest we add to MP a getMergesComparator and use it in CMS. The default (to not break back-compat) can be ByDocsComparator and we override it in the existing MPs.\u003c\\/p\u003e\\n\\n\u003cp\u003eI must say that the more I went over the details, the more I was convinced that the proposals made will change the current API for no great benefits. But I may have looked too deeply into the impl, that I lost the ability to think about it \'from above\' - so I\'d appreciate if someone can go over what I wrote and offer comments \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12935327_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12935327_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Nov\\/10 14:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-24T14:03:30+0000\'\u003e24\\/Nov\\/10 14:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    There are several points addressed by this issue: \\n \\n\\t Refactor IW, MS and MP so that MS pulls merges directly from MP, instead from IW. \\n\\t Rewrite CMS to take advantage of ThreadPoolExecutor instead of managing the threads on its own, in addition to using a blocking queue instead of us coding the blocking directly. \\n\\t One should be able to reuse CMS across several IndexWriters, which is not possible today, to e.g., allow one controlling the total # of merges happening in the JVM. \\n\\t Merges should be sorted by their size in bytes and not by their # of docs &#8211; or actually, merges should be sorted by a criteria the MP determines. \\n \\n\\n\\n All the while maintaining the following requirements, in no particular order: \\n \\n\\t MergeThreads\' priority needs to be controllable - this is the current behavior of CMS that we\'d like to keep. \\n\\t When there are too many merges to execute, small ones should be preferred to large ones, and we need the ability to pause large merges in favor of small ones. \\n\\t The user needs to be able to control:\\n\\t \\n\\t\\t The max number of running merges \\n\\t\\t The max number of merges, above which scheduling more merges should be blocked. \\n\\t \\n\\t \\n\\t We should keep the sync() API, which lets the user wait for all scheduled merges to complete. \\n\\t The MP needs to be aware of the type of merges that are requested (regular, optimize, expunge). \\n\\t The user should be able to fast-close the index, aborting all merges (running and pending). \\n\\t If there are cascading merges (i.e., a result of several other merges), they should all be executed following the call to MS.merge() &#8211; that is, it could be that CMS itself, or its MergeThreads will encounter merges not returned by MP at first, but as a subsequent round due to changes done to the index. \\n \\n\\n\\n After investigating the code and going over the proposed plan, I feel that we cannot accomplish all that we\'d like to do, given the above requirements. And just to be clear, those are not  any  application requirements, but the default ones we\'d like Lucene to offer OOtB. One can still write a MS\\/MP which doesn\'t guarantee all that. \\n\\n Using ThreadPoolExecutor looks like will only complicate CMS instead of simplifying it: \\n \\n\\t Because of all the requirements I\'ve listed above, we\'d need to trick TPE into starting more threads than we intend to run, while we pause some of them. \\n\\t In order to set threads\' priorities, we need to write our own ThreadFactory to pass to TPE, and inside it keep track of the allocated Threads and those that still run, so that we can control their priority. \\n\\t There\'s no trivial way to impl sync(), as TPE does not provide API we can rely on (e.g. checking when all threads are done). There are ways to impl that, using Semaphore (see next bullet). \\n\\t In order to block the app on too many merges being scheduled, we\'d need to use a Semaphore, because even if we use a BlockingQueue w\\/ TPE, the submit() call won\'t block, but simply reject the item. \\n\\t In order to execute cascading merges as well, we\'d need the TPE threads (or the Runnable we submit) to poll getNextMerge() until null is returned. This breaks the concepts of Executors, where a task is submitted, done and that\'s it. I wouldn\'t mind if we did it still though. \\n \\n\\n\\n All of these make me think that TPE, at this point at least, is not suitable for CMS. While it\'s doable, it\'s not going to make CMS code any simpler. And it looks more as if we\'ll enforce TPE in CMS, than it is really useful. \\n\\n Refactoring IW, MS and MP seems to not simplify anything, really: \\n \\n\\t We\'d still need IW telling MP which merges are needed (optimize, regular or expunge), so the three findMergesForXYZ will need to remain. \\n\\t The proposal will add a getNextMerge() to MP, instead of IW, which IMO will only complicate matters for MP implementers. E.g., what should MP do if findRegularMerges was called, then getNext() was called and then findOptimizeMerges is called? It\'s not a critical decision we leave in the MP developers, but IMO it\'s unnecessary. Today MP is a stateless object - it receives SegmentInfos and returns a MergeSpec. It doesn\'t need to \'remember\' anything. But if we move the getNextMerge() to it, we make it stateful, for no good reasons \\n\\t We don\'t really take IW outside the loop really - it would still need to instruct MP which merges to \'prepare\', so that MS can take. \\n\\t We\'d need to introduce an abort\\/cancel() API on MS, which adds another responsibility for MS, but doesn\'t remove much from IW. \\n \\n\\n\\n All in all, I don\'t think this refactoring simplifies IW-MS-MP communication a lot or allows custom MS and MPs have more control over what\'s going on. IW, as the mediator, is nothing but the mediator, which happens to know (as it should) which merges finish and if the state of the index changed, ask MP for more merges. That that it keeps track of pending and running merges, to me, is not a big deal. In fact, due to IW.waitForMerges() it either must continue to keep track of pending\\/running merges, or we add a sync() API to every MS. \\n\\n Fixing CMS to allow sharing across multiple IndexWriter instances is important IMO, so I\'ll look into fixing it. To allow for MP dependent sort, I suggest we add to MP a getMergesComparator and use it in CMS. The default (to not break back-compat) can be ByDocsComparator and we override it in the existing MPs. \\n\\n I must say that the more I went over the details, the more I was convinced that the proposals made will change the current API for no great benefits. But I may have looked too deeply into the impl, that I lost the ability to think about it \'from above\' - so I\'d appreciate if someone can go over what I wrote and offer comments  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12935400\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12935400&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12935400\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12935400_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12935400_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Nov\\/10 17:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-24T17:08:56+0000\'\u003e24\\/Nov\\/10 17:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eRefactor IW, MS and MP so that MS pulls merges directly from MP, instead from IW.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eDirectly or through IW - this is not important. Important point is pulling merges one-by-one, when you have the resources to execute them.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eRewrite CMS to take advantage of ThreadPoolExecutor instead of managing the threads on its own, in addition to using a blocking queue instead of us coding the blocking directly.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eUsing ThreadPoolExecutor looks like will only complicate CMS instead of simplifying it:\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI ended up with same conclusion, while taking my first stabs. But for different reasons.\u003cbr\\/\u003e\\nThe philosphy of Executors is that you schedule (push) a number of tasks, and then some magic black box runs them for you, resolving threading issues itself.\u003cbr\\/\u003e\\nMy suggestion requires pulling tasks when computing resources become available, and that doesn\'t map on scheduling model at all.\u003cbr\\/\u003e\\nAll priority\\/pausing\\/breaking issues are largely irrelevant.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMergeThreads\' priority needs to be controllable, and we need the ability to pause large merges in favor of small ones\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThese, and the likes - are not requirements.\u003cbr\\/\u003e\\nThese are but one of the possible solutions to our real requirements, which look like\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003edon\'t run out of file handles on fast indexation\u003c\\/li\u003e\\n\\t\u003cli\u003edon\'t degrade search performance and NRT turnaround\u003c\\/li\u003e\\n\\t\u003cli\u003edon\'t kill the disk with too much random IOs.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eIf there are cascading merges (i.e., a result of several other merges), they should all be executed following the call to MS.merge() - that is, it could be that CMS itself, or its MergeThreads will encounter merges not returned by MP at first, but as a subsequent round due to changes done to the index.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThis is trivially solved with my pulling model. We pull until nothing is left. Period. Instead of getting batches of merges from MP and then reconciling them with reality we do the same operation over and over again, until MP is satisfied - very simple.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThe proposal will add a getNextMerge() to MP, instead of IW, which IMO will only complicate matters for MP implementers. E.g., what should MP do if findRegularMerges was called, then getNext() was called and then findOptimizeMerges is called? It\'s not a critical decision we leave in the MP developers, but IMO it\'s unnecessary. Today MP is a stateless object - it receives SegmentInfos and returns a MergeSpec. It doesn\'t need to \'remember\' anything. But if we move the getNextMerge() to it, we make it stateful, for no good reasons\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eWe don\'t really take IW outside the loop really - it would still need to instruct MP which merges to \'prepare\', so that MS can take.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThere will be, most probably, getNext(Normal\\/Optimize\\/Expunge)Merge() methods. findWhatever methods will be removed, noone needs to call them, so - no state, no \'preparations\'.\u003cbr\\/\u003e\\nMP will recieve SegmentInfos and return OneMerge.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eTo allow for MP dependent sort, I suggest we add to MP a getMergesComparator and use it in CMS.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eMP should return merges sorted, that\'s all. Why do you need to expose its Comparator or whatever it uses for sorting?\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eWhatever I didn\'t mention from your post - I either missed, or agree with \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nI think I\'ll stop trying to explain it in Jira comments. It took great time discussing everything with Mike over IRC, and here it\'ll take ages.\u003cbr\\/\u003e\\nThe proper route is to take a handful of dirt and sticks and slap together some working code to illustrate my point. And that\'s what I\'m gonna do.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12935400_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12935400_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Nov\\/10 17:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-24T17:08:56+0000\'\u003e24\\/Nov\\/10 17:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Refactor IW, MS and MP so that MS pulls merges directly from MP, instead from IW.  \\n Directly or through IW - this is not important. Important point is pulling merges one-by-one, when you have the resources to execute them. \\n\\n  Rewrite CMS to take advantage of ThreadPoolExecutor instead of managing the threads on its own, in addition to using a blocking queue instead of us coding the blocking directly.  \\n  Using ThreadPoolExecutor looks like will only complicate CMS instead of simplifying it:  \\n I ended up with same conclusion, while taking my first stabs. But for different reasons. \\nThe philosphy of Executors is that you schedule (push) a number of tasks, and then some magic black box runs them for you, resolving threading issues itself. \\nMy suggestion requires pulling tasks when computing resources become available, and that doesn\'t map on scheduling model at all. \\nAll priority\\/pausing\\/breaking issues are largely irrelevant. \\n\\n  MergeThreads\' priority needs to be controllable, and we need the ability to pause large merges in favor of small ones  \\n These, and the likes - are not requirements. \\nThese are but one of the possible solutions to our real requirements, which look like \\n \\n\\t don\'t run out of file handles on fast indexation \\n\\t don\'t degrade search performance and NRT turnaround \\n\\t don\'t kill the disk with too much random IOs. \\n \\n\\n\\n  If there are cascading merges (i.e., a result of several other merges), they should all be executed following the call to MS.merge() - that is, it could be that CMS itself, or its MergeThreads will encounter merges not returned by MP at first, but as a subsequent round due to changes done to the index.  \\n This is trivially solved with my pulling model. We pull until nothing is left. Period. Instead of getting batches of merges from MP and then reconciling them with reality we do the same operation over and over again, until MP is satisfied - very simple. \\n\\n  The proposal will add a getNextMerge() to MP, instead of IW, which IMO will only complicate matters for MP implementers. E.g., what should MP do if findRegularMerges was called, then getNext() was called and then findOptimizeMerges is called? It\'s not a critical decision we leave in the MP developers, but IMO it\'s unnecessary. Today MP is a stateless object - it receives SegmentInfos and returns a MergeSpec. It doesn\'t need to \'remember\' anything. But if we move the getNextMerge() to it, we make it stateful, for no good reasons  \\n  We don\'t really take IW outside the loop really - it would still need to instruct MP which merges to \'prepare\', so that MS can take.  \\n There will be, most probably, getNext(Normal\\/Optimize\\/Expunge)Merge() methods. findWhatever methods will be removed, noone needs to call them, so - no state, no \'preparations\'. \\nMP will recieve SegmentInfos and return OneMerge. \\n\\n  To allow for MP dependent sort, I suggest we add to MP a getMergesComparator and use it in CMS.  \\n MP should return merges sorted, that\'s all. Why do you need to expose its Comparator or whatever it uses for sorting? \\n\\n\\n Whatever I didn\'t mention from your post - I either missed, or agree with   \\nI think I\'ll stop trying to explain it in Jira comments. It took great time discussing everything with Mike over IRC, and here it\'ll take ages. \\nThe proper route is to take a handful of dirt and sticks and slap together some working code to illustrate my point. And that\'s what I\'m gonna do.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12966029\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12966029&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12966029\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12966029_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12966029_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Dec\\/10 09:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-02T09:11:12+0000\'\u003e02\\/Dec\\/10 09:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGetting rid of the IndexWriter member in CMS is not trivial w\\/o API change. The IndexWriter member is used for verbosing purposes, which is accessed by some public\\/protected API, like sync() and doMerge(). So on 3x it\'d mean to deprecate methods, which IMO does not justify it. On trunk it\'s easier.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn the other hand, we can consider two things:\u003c\\/p\u003e\\n\u003col\u003e\\n\\t\u003cli\u003eMake IndexWriter ThreadLocal &#8211; the thread who calls merge() will own its ThreadLocal, and if different threads index to different indexes, then it should work. But it won\'t help in case the indexing threads are taken from a pool.\u003c\\/li\u003e\\n\\t\u003cli\u003eThink whether we want CMS to be shareable across several IndexWriters at all. I haven\'t heard that requirement coming up on the list, and definitely if someone attempted to do it, things would break, so I guess no one really does it. Therefore maybe we should leave it to the users to develop something like that on their own, and maybe even contribute back. A MS which might even be simplified by not implementing all of CMS functionality today (controlling threads\' priority, pause merge threads etc.).\u003c\\/li\u003e\\n\u003c\\/ol\u003e\\n\\n\\n\u003cp\u003ebq, The proper route is to take a handful of dirt and sticks and slap together some working code to illustrate my point. And that\'s what I\'m gonna do.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'d be great if you will do that ! Sometimes it\'s indeed easier to fight over a concrete example then theoretical \\\"can and can\'t work\\\" arguments.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMP will recieve SegmentInfos and return OneMerge.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eFrom whom will it receive it? In the case of cascading merges, the merge threads need to continuously pull MP for getNextMerge(MergeType), but they don\'t have the global picture IW holds about the existing segments (SegmentInfos). Also, IW keeps track of the segments that existed when you first called optimize() and doesn\'t allow the cascading merges to include segments that didn\'t exist at the time. Who will do that accounting now?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12966029_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12966029_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Dec\\/10 09:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-02T09:11:12+0000\'\u003e02\\/Dec\\/10 09:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Getting rid of the IndexWriter member in CMS is not trivial w\\/o API change. The IndexWriter member is used for verbosing purposes, which is accessed by some public\\/protected API, like sync() and doMerge(). So on 3x it\'d mean to deprecate methods, which IMO does not justify it. On trunk it\'s easier. \\n\\n On the other hand, we can consider two things: \\n \\n\\t Make IndexWriter ThreadLocal &#8211; the thread who calls merge() will own its ThreadLocal, and if different threads index to different indexes, then it should work. But it won\'t help in case the indexing threads are taken from a pool. \\n\\t Think whether we want CMS to be shareable across several IndexWriters at all. I haven\'t heard that requirement coming up on the list, and definitely if someone attempted to do it, things would break, so I guess no one really does it. Therefore maybe we should leave it to the users to develop something like that on their own, and maybe even contribute back. A MS which might even be simplified by not implementing all of CMS functionality today (controlling threads\' priority, pause merge threads etc.). \\n \\n\\n\\n bq, The proper route is to take a handful of dirt and sticks and slap together some working code to illustrate my point. And that\'s what I\'m gonna do. \\n\\n It\'d be great if you will do that ! Sometimes it\'s indeed easier to fight over a concrete example then theoretical \\\"can and can\'t work\\\" arguments. \\n\\n  MP will recieve SegmentInfos and return OneMerge.  \\n\\n From whom will it receive it? In the case of cascading merges, the merge threads need to continuously pull MP for getNextMerge(MergeType), but they don\'t have the global picture IW holds about the existing segments (SegmentInfos). Also, IW keeps track of the segments that existed when you first called optimize() and doesn\'t allow the cascading merges to include segments that didn\'t exist at the time. Who will do that accounting now?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12982531\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12982531&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12982531\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12982531_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982531_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/11 09:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-17T09:01:16+0000\'\u003e17\\/Jan\\/11 09:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch includes some formatting changes and documentation addition. I\'m not sure if eventually we will be able to refactor the whole MP-MS-IW interaction like we said. Earwin, if you still want to work on it, the I can keep the issue open and mark it 3.2 (unless you want to give it a try in 3.1).\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd I think those tiny mods\\/formatting are worth checking in, because they at least add some documentation to CMS.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12982531_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982531_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/11 09:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-17T09:01:16+0000\'\u003e17\\/Jan\\/11 09:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch includes some formatting changes and documentation addition. I\'m not sure if eventually we will be able to refactor the whole MP-MS-IW interaction like we said. Earwin, if you still want to work on it, the I can keep the issue open and mark it 3.2 (unless you want to give it a try in 3.1). \\n\\n And I think those tiny mods\\/formatting are worth checking in, because they at least add some documentation to CMS.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12982564\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12982564&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12982564\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12982564_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982564_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/11 09:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-17T09:46:24+0000\'\u003e17\\/Jan\\/11 09:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eif you still want to work on it, the I can keep the issue open and mark it 3.2 (unless you want to give it a try in 3.1). \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI\'ll start another later, so please, go on.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"earwin\\\" id=\\\"commentauthor_12982564_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=earwin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"earwin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Earwin Burrfoot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982564_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/11 09:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-17T09:46:24+0000\'\u003e17\\/Jan\\/11 09:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     if you still want to work on it, the I can keep the issue open and mark it 3.2 (unless you want to give it a try in 3.1).   \\n I\'ll start another later, so please, go on.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12982621\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12982621&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12982621\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12982621_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982621_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/11 12:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-17T12:49:53+0000\'\u003e17\\/Jan\\/11 12:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted revision 1059904 (3x).\u003cbr\\/\u003e\\nCommitted revision 1059905 (trunk).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12982621_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982621_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/11 12:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-17T12:49:53+0000\'\u003e17\\/Jan\\/11 12:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed revision 1059904 (3x). \\nCommitted revision 1059905 (trunk).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12983240\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12983240&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12983240\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12983240_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983240_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/11 16:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-18T16:05:55+0000\'\u003e18\\/Jan\\/11 16:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe cosmetic change committed here accidentally reverted part of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2820\\\" title=\\\"CMS fails to cleanly stop threads\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2820\\\"\u003e\u003cdel\u003eLUCENE-2820\u003c\\/del\u003e\u003c\\/a\u003e, which now causes CMS to deadlock!  Specifically the change in mergeThreadCount()...\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll fix shortly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12983240_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983240_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/11 16:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-18T16:05:55+0000\'\u003e18\\/Jan\\/11 16:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The cosmetic change committed here accidentally reverted part of   LUCENE-2820  , which now causes CMS to deadlock!  Specifically the change in mergeThreadCount()... \\n\\n I\'ll fix shortly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12983359\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12983359&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12983359\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12983359_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983359_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/11 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-18T20:19:08+0000\'\u003e18\\/Jan\\/11 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMike, fyi it looks like we are hung again in hudson:\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/hudson.apache.org\\/hudson\\/job\\/Lucene-Solr-tests-only-3.x\\/3866\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/hudson.apache.org\\/hudson\\/job\\/Lucene-Solr-tests-only-3.x\\/3866\\/\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eNot sure if its the same deadlock you found.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12983359_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983359_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/11 20:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-18T20:19:08+0000\'\u003e18\\/Jan\\/11 20:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mike, fyi it looks like we are hung again in hudson: \\n https:\\/\\/hudson.apache.org\\/hudson\\/job\\/Lucene-Solr-tests-only-3.x\\/3866\\/  \\n\\n Not sure if its the same deadlock you found.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12983361\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12983361&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12983361\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12983361_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983361_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/11 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-18T20:20:52+0000\'\u003e18\\/Jan\\/11 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am reopening just so we don\'t miss fixing the deadlock... its hung in the same exact part of the tests as earlier\u003cbr\\/\u003e\\ntoday so I think its somehow related...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12983361_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983361_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/11 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-18T20:20:52+0000\'\u003e18\\/Jan\\/11 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am reopening just so we don\'t miss fixing the deadlock... its hung in the same exact part of the tests as earlier \\ntoday so I think its somehow related...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12983439\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=12983439&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12983439\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12983439_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983439_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/11 23:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-18T23:31:45+0000\'\u003e18\\/Jan\\/11 23:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003esorry, hudson just slowed to a crawl apparently... it wasn\'t hung.\u003c\\/p\u003e\\n\\n\u003cp\u003ewhen i looked at its console it seemed stuck in the same place... but wasn\'t.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12983439_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983439_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jan\\/11 23:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-18T23:31:45+0000\'\u003e18\\/Jan\\/11 23:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    sorry, hudson just slowed to a crawl apparently... it wasn\'t hung. \\n\\n when i looked at its console it seemed stuck in the same place... but wasn\'t.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13013277\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2755?focusedCommentId=13013277&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13013277\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gsingers\\\" id=\\\"commentauthor_13013277_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gsingers\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gsingers\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Grant Ingersoll\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13013277_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/11 15:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-30T15:49:51+0000\'\u003e30\\/Mar\\/11 15:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBulk close for 3.1\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gsingers\\\" id=\\\"commentauthor_13013277_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gsingers\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gsingers\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Grant Ingersoll\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13013277_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/11 15:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-30T15:49:51+0000\'\u003e30\\/Mar\\/11 15:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Bulk close for 3.1              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516203230937"> 
    <input type="hidden" title="jira.request.server.time" value="625"> 
    <input type="hidden" title="jira.request.id" value="933x7708809x2"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="3"> 
    <input type="hidden" title="db.reads.time.in.ms" value="37"> 
    <input type="hidden" title="db.conns.time.in.ms" value="47"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 933x7708809x2
	          REQUEST TIMESTAMP : [17/Jan/2018:15:33:50 +0000]
	               REQUEST TIME : 0.6250
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 3

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=18, elapsedTotal=37862335, elapsedMin=888421, elapsedMax=13479852, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=22, elapsedTotal=47455403, elapsedMin=980611, elapsedMax=13588822, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>