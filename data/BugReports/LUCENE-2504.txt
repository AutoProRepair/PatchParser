<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|2f713a02e7ac39e0aece275dc13a8c65146be39d|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"c9e3ac74cb4ec9\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-2504"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-2504] sorting performance regression - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-2504] sorting performance regression - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2504">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-2504" href="/jira/browse/LUCENE-2504" id="key-val" rel="12467414">LUCENE-2504</a></li>
                </ol>
                <h1 id="summary-val">sorting performance regression</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2504"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-2504/LUCENE-2504.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-2504/LUCENE-2504.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-2504/LUCENE-2504.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-2504/LUCENE-2504.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.0-ALPHA" title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Fsearch%22" title="core/search issues with search code">core/search</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12467414-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>sorting can be much slower on trunk than branch_3x</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-2504?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-2504?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-2504?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-2504?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12454593" data-issue-id="12467414" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12454593/LUCENE-2504_SortMissingLast.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2504_SortMissingLast.patch:https://issues.apache.org/jira/secure/attachment/12454593/LUCENE-2504_SortMissingLast.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12454593/LUCENE-2504_SortMissingLast.patch" title="Latest  14/Sep/10 21:26 - Yonik Seeley" draggable="true" data-downloadurl="text/x-patch:LUCENE-2504_SortMissingLast.patch:https://issues.apache.org/jira/secure/attachment/12454593/LUCENE-2504_SortMissingLast.patch">LUCENE-2504_SortMissingLast.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-14T21:26:07.628Z">14/Sep/10 21:26</time>
                   </dd>
                   <dd class="attachment-size">
                    11 kB
                   </dd>
                   <dd class="attachment-author">
                    Yonik Seeley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12454551" data-issue-id="12467414" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12454551/LUCENE-2504.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2504.patch:https://issues.apache.org/jira/secure/attachment/12454551/LUCENE-2504.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12454551/LUCENE-2504.patch" title="Latest  14/Sep/10 16:44 - Yonik Seeley" draggable="true" data-downloadurl="text/x-patch:LUCENE-2504.patch:https://issues.apache.org/jira/secure/attachment/12454551/LUCENE-2504.patch">LUCENE-2504.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-14T16:44:09.536Z">14/Sep/10 16:44</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Yonik Seeley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12454464" data-issue-id="12467414" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12454464/LUCENE-2504.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2504.patch:https://issues.apache.org/jira/secure/attachment/12454464/LUCENE-2504.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12454464/LUCENE-2504.patch" title=" 13/Sep/10 18:37 - Yonik Seeley" draggable="true" data-downloadurl="text/x-patch:LUCENE-2504.patch:https://issues.apache.org/jira/secure/attachment/12454464/LUCENE-2504.patch">LUCENE-2504.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-13T18:37:02.523Z">13/Sep/10 18:37</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Yonik Seeley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12453588" data-issue-id="12467414" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12453588/LUCENE-2504.patch" draggable="true" data-downloadurl="text/plain:LUCENE-2504.patch:https://issues.apache.org/jira/secure/attachment/12453588/LUCENE-2504.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12453588/LUCENE-2504.patch" title=" 01/Sep/10 12:20 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-2504.patch:https://issues.apache.org/jira/secure/attachment/12453588/LUCENE-2504.patch">LUCENE-2504.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-01T12:20:36.976Z">01/Sep/10 12:20</time>
                   </dd>
                   <dd class="attachment-size">
                    26 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12449178" data-issue-id="12467414" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12449178/LUCENE-2504.zip" draggable="true" data-downloadurl="application/zip:LUCENE-2504.zip:https://issues.apache.org/jira/secure/attachment/12449178/LUCENE-2504.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-zip" title="Zip Archive"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12449178/LUCENE-2504.zip" title="Latest  10/Jul/10 23:17 - Michael McCandless" draggable="true" data-downloadurl="application/zip:LUCENE-2504.zip:https://issues.apache.org/jira/secure/attachment/12449178/LUCENE-2504.zip">LUCENE-2504.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-07-10T23:17:18.104Z">10/Jul/10 23:17</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10453"></span></span> Unassigned </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_yseeley@gmail.com" rel="yseeley@gmail.com" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Yonik Seeley&quot;,&quot;emailAddress&quot;:&quot;yseeley@gmail.com&quot;,&quot;username&quot;:&quot;yseeley@gmail.com&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="yseeley@gmail.com"></span></span> Yonik Seeley </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">2</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="19/Jun/10 19:43"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2010-06-19T19:43:17+0000">19/Jun/10 19:43</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="10/May/13 10:43"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-05-10T10:43:01+0000">10/May/13 10:43</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="18/Sep/12 18:47"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-09-18T18:47:13+0000">18/Sep/12 18:47</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2504?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2504?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12880539\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12880539&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880539\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12880539_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880539_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 19:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T19:57:58+0000\'\u003e19\\/Jun\\/10 19:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll dig.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12880539_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880539_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 19:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T19:57:58+0000\'\u003e19\\/Jun\\/10 19:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll dig.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12880540\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12880540&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880540\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12880540_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880540_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 20:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T20:05:57+0000\'\u003e19\\/Jun\\/10 20:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy guess is that this is caused by \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2380\\\" title=\\\"Add FieldCache.getTermBytes, to load term data as byte[]\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2380\\\"\u003e\u003cdel\u003eLUCENE-2380\u003c\\/del\u003e\u003c\\/a\u003e, but I opened a separate issue since I\'m not sure.\u003cbr\\/\u003e\\nThis is the same type of JVM performance issues reported by Mike in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2143\\\" title=\\\"Understand why NRT performance is affected by flush frequency\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2143\\\"\u003e\u003cdel\u003eLUCENE-2143\u003c\\/del\u003e\u003c\\/a\u003e and myself in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2380\\\" title=\\\"Add FieldCache.getTermBytes, to load term data as byte[]\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2380\\\"\u003e\u003cdel\u003eLUCENE-2380\u003c\\/del\u003e\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eSetup:\u003cbr\\/\u003e\\n  Same test index I used to test faceting: 10M doc index with 5 fields:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ef100000_s:  a single valued string field with 100,000 unique values\u003c\\/li\u003e\\n\\t\u003cli\u003ef10000_s:   a single valued field with 10,000 unique values\u003c\\/li\u003e\\n\\t\u003cli\u003ef1000_s:   a single valued field with 1000 unique values\u003c\\/li\u003e\\n\\t\u003cli\u003ef100_s:   a single valued field with 100 unique values\u003c\\/li\u003e\\n\\t\u003cli\u003ef10_s:   a single valued field with 10 unique values\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eURLs I tested against Solr are of the form:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;rows=1&amp;sort=f100000_s+asc\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;rows=1&amp;sort=f100000_s+asc\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ebranch_3x\u003cbr\\/\u003e\\n----------------------------------------------------------\u003cbr\\/\u003e\\n f100000_s sort only: 101 ms\u003cbr\\/\u003e\\nsort against random field: 101 ms\u003c\\/p\u003e\\n\\n\u003cp\u003etrunk:\u003cbr\\/\u003e\\n----------------------------------------------------------\u003cbr\\/\u003e\\n f100000_s sort only: 111 ms\u003cbr\\/\u003e\\nsort against random field: 158 ms\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is not due to garbage collection or cache effects.  After you sort against a mix of fields, the performance is worse forever... you can go back to sorting against  f100000_s only, and the performance never recovers.\u003c\\/p\u003e\\n\\n\u003cp\u003eSystem: Ubuntu on Phenom II 4x3.0GHz, Java 1.6_20\u003c\\/p\u003e\\n\\n\u003cp\u003eSo my guess is that this is caused by the ord lookup going through PagedBytes, and the JVM not optimizing away the indirection when there is a mix of implementations.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12880540_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880540_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 20:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T20:05:57+0000\'\u003e19\\/Jun\\/10 20:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My guess is that this is caused by   LUCENE-2380  , but I opened a separate issue since I\'m not sure. \\nThis is the same type of JVM performance issues reported by Mike in   LUCENE-2143   and myself in   LUCENE-2380  . \\n\\n Setup: \\n  Same test index I used to test faceting: 10M doc index with 5 fields: \\n \\n\\t f100000_s:  a single valued string field with 100,000 unique values \\n\\t f10000_s:   a single valued field with 10,000 unique values \\n\\t f1000_s:   a single valued field with 1000 unique values \\n\\t f100_s:   a single valued field with 100 unique values \\n\\t f10_s:   a single valued field with 10 unique values \\n \\n\\n\\n URLs I tested against Solr are of the form: \\n http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;rows=1&amp;sort=f100000_s+asc  \\n\\n branch_3x \\n---------------------------------------------------------- \\n f100000_s sort only: 101 ms \\nsort against random field: 101 ms \\n\\n trunk: \\n---------------------------------------------------------- \\n f100000_s sort only: 111 ms \\nsort against random field: 158 ms \\n\\n This is not due to garbage collection or cache effects.  After you sort against a mix of fields, the performance is worse forever... you can go back to sorting against  f100000_s only, and the performance never recovers. \\n\\n System: Ubuntu on Phenom II 4x3.0GHz, Java 1.6_20 \\n\\n So my guess is that this is caused by the ord lookup going through PagedBytes, and the JVM not optimizing away the indirection when there is a mix of implementations.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12880541\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12880541&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880541\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12880541_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880541_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 20:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T20:11:50+0000\'\u003e19\\/Jun\\/10 20:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMore numbers:  Ubuntu, Java 1.7.0-ea-b98 (64 bit):\u003cbr\\/\u003e\\nf100000_s sort only: 126 ms\u003cbr\\/\u003e\\nsort against random field: 175 ms\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12880541_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880541_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 20:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T20:11:50+0000\'\u003e19\\/Jun\\/10 20:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    More numbers:  Ubuntu, Java 1.7.0-ea-b98 (64 bit): \\nf100000_s sort only: 126 ms \\nsort against random field: 175 ms              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12880542\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12880542&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880542\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12880542_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880542_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 20:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T20:18:22+0000\'\u003e19\\/Jun\\/10 20:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMore numbers: Windows 7:\u003cbr\\/\u003e\\njava version \\\"1.6.0_17\\\"\u003cbr\\/\u003e\\nJava(TM) SE Runtime Environment (build 1.6.0_17-b04)\u003cbr\\/\u003e\\nJava HotSpot(TM) 64-Bit Server VM (build 14.3-b01, mixed mode)\u003c\\/p\u003e\\n\\n\u003cp\u003ef100000_s sort only: 115 ms\u003cbr\\/\u003e\\nsort against random field: 162 ms \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12880542_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880542_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 20:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T20:18:22+0000\'\u003e19\\/Jun\\/10 20:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    More numbers: Windows 7: \\njava version \\\"1.6.0_17\\\" \\nJava(TM) SE Runtime Environment (build 1.6.0_17-b04) \\nJava HotSpot(TM) 64-Bit Server VM (build 14.3-b01, mixed mode) \\n\\n f100000_s sort only: 115 ms \\nsort against random field: 162 ms               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12881225\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12881225&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12881225\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12881225_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881225_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T15:16:15+0000\'\u003e22\\/Jun\\/10 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmmm, the way FieldComparator \\/ FieldComparatorSource work now, it doesn\'t seem possible to specialize based on the underlying native array type.  In order to do this, a new FieldComparator would need to be returned for each segment.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne possibility: modify setNextReader to return a FieldComparator?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12881225_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881225_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T15:16:15+0000\'\u003e22\\/Jun\\/10 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmmm, the way FieldComparator \\/ FieldComparatorSource work now, it doesn\'t seem possible to specialize based on the underlying native array type.  In order to do this, a new FieldComparator would need to be returned for each segment. \\n\\n One possibility: modify setNextReader to return a FieldComparator?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12881251\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12881251&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12881251\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12881251_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881251_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 17:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T17:09:44+0000\'\u003e22\\/Jun\\/10 17:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eOne possibility: modify setNextReader to return a FieldComparator?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eDo you mean Collector\'s setNextReader()? That doesn\'t make sense. Most Collectors don\'t deal w\\/ FieldComparators at all ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12881251_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881251_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 17:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T17:09:44+0000\'\u003e22\\/Jun\\/10 17:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     One possibility: modify setNextReader to return a FieldComparator?  \\n\\n Do you mean Collector\'s setNextReader()? That doesn\'t make sense. Most Collectors don\'t deal w\\/ FieldComparators at all ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12881277\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12881277&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12881277\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12881277_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881277_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T18:13:08+0000\'\u003e22\\/Jun\\/10 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eDo you mean Collector\'s setNextReader()? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eNo, FieldComparator.setNextReader()\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12881277_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881277_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 18:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T18:13:08+0000\'\u003e22\\/Jun\\/10 18:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Do you mean Collector\'s setNextReader()?   \\n No, FieldComparator.setNextReader()              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12881281\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12881281&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12881281\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12881281_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881281_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 18:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T18:20:54+0000\'\u003e22\\/Jun\\/10 18:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAhh ok. That makes sense then \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12881281_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881281_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 18:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T18:20:54+0000\'\u003e22\\/Jun\\/10 18:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ahh ok. That makes sense then  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12887111\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12887111&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12887111\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12887111_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12887111_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jul\\/10 23:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-10T23:17:18+0000\'\u003e10\\/Jul\\/10 23:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eDigging into this, finally...\u003c\\/p\u003e\\n\\n\u003cp\u003eTo try to make a somewhat more realistic search test, I created a\u003cbr\\/\u003e\\nstandalone test (attached zip file), which runs different query types\u003cbr\\/\u003e\\n(term, phrase, OR of 2 terms, AND of 2 terms, prefix, phrase) sorting\u003cbr\\/\u003e\\nby score or by a string field (with increasing numbers of unique\u003cbr\\/\u003e\\nvalues: country (~250 values I think), and then\u003cbr\\/\u003e\\nunique10\\/100\\/1K\\/10K\\/100K\\/1M)).  I derive the unique fields by taking\u003cbr\\/\u003e\\nfirst N unique titles from wikipedia; the country field comes from the\u003cbr\\/\u003e\\nSortableSingleDocSource in contrib\\/benchmark.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt runs with 2 threads (machine has 2 cores), and each thread first\u003cbr\\/\u003e\\nshuffles the queries privately but deterministically, so that each\u003cbr\\/\u003e\\nmatching thread in the trunk &amp; 3x tests are running query+sort in same\u003cbr\\/\u003e\\norder.\u003c\\/p\u003e\\n\\n\u003cp\u003eI then created a Wikipedia index with first 5M docs, one optimized and\u003cbr\\/\u003e\\none not optimized (13 segments) and with 5% docs deleted, on trunk and\u003cbr\\/\u003e\\n3x.\u003c\\/p\u003e\\n\\n\u003cp\u003eI sweep through all query+sorts 23 times (getting top 10 hits for\u003cbr\\/\u003e\\neach), using 2 threads, measuring wall clock time each time.  I\u003cbr\\/\u003e\\ndiscard first 3 results for each query+sort, and then take fastest\u003cbr\\/\u003e\\ntime of the remaining 20.\u003c\\/p\u003e\\n\\n\u003cp\u003eJava is 1.6.0_17; I run with -server -Xmx1g -Xms1g (machine has 3G\u003cbr\\/\u003e\\nRAM); OS is Linux CentOS 5.5.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cb\u003eNOTE\u003c\\/b\u003e: these results include the patch from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2504\\\" title=\\\"sorting performance regression\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2504\\\"\u003e\u003cdel\u003eLUCENE-2504\u003c\\/del\u003e\u003c\\/a\u003e, for both\u003cbr\\/\u003e\\ntrunk &amp; 3.x!\u003c\\/p\u003e\\n\\n\u003cp\u003eResults (pctg change in query time, going from 3x -&gt; trunk) on\u003cbr\\/\u003e\\noptimized index:\u003c\\/p\u003e\\n\\n\u003cp\u003eResults on optimized index:\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003eQuery\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003ecountry\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique10\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique100\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique1K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique10K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique100K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique1M\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003escore\u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e&lt;all&gt;\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e40.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e40.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e41.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e40.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e40.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e+united +states\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e0.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\\\"united states\\\"\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e8.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e8.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e8.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e8.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e8.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e9.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e9.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e8.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003estates\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e20.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e20.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e20.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e22.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e22.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunite*\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e9.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunited states\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eResults on unoptimized index (w\\/ 5% deletions):\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003eQuery\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003ecountry\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique10\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique100\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique1K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique10K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique100K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique1M\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003escore\u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e&lt;all&gt;\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e25.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e25.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e24.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e27.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e26.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e27.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e27.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e+united +states\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\\\"united states\\\"\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e13.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e13.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e13.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e13.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e13.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e14.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e13.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e14.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003estates\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e13.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e14.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e14.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e15.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e15.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e18.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e18.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunite*\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunited states\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e0.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eUnfortunately, the tests have highish variance (up to maybe +\\/- 10%),\u003cbr\\/\u003e\\nI think thanks to hotspot\'s unpredictability (\\\"java ghosts\\\").  EG if I\u003cbr\\/\u003e\\nchange the order in which the queries are run, the results change\u003cbr\\/\u003e\\nquite a bit.  If I run the exact same test, results change alot.  This\u003cbr\\/\u003e\\nof course makes conclusions nearly impossible... but still some rough\u003cbr\\/\u003e\\nobservations:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eTrunk is definitely slower when sorting by field; sorting by\u003cbr\\/\u003e\\n    score is roughly the same perf.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFor some reason, the unoptimized index generally takes less perf\u003cbr\\/\u003e\\n    hit than the optimized index... odd.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eCurious that phrase query is faster across the board... not sure\u003cbr\\/\u003e\\n    why.  Maybe my recent optos to PhraseQuery somehow favor flex?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003ePerf loss is in proportion to how \\\"easy\\\" the query is\u003cbr\\/\u003e\\n    (AllDocsQuery is the worst; TermQuery next), which makes sense\u003cbr\\/\u003e\\n    since the slowdown is in collection.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eEven though the results are noisy... I still think we should try to\u003cbr\\/\u003e\\nspecialize direct access to the native array for doc-&gt;ord lookup.\u003cbr\\/\u003e\\nI\'ll work on that next...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12887111_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12887111_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jul\\/10 23:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-10T23:17:18+0000\'\u003e10\\/Jul\\/10 23:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Digging into this, finally... \\n\\n To try to make a somewhat more realistic search test, I created a \\nstandalone test (attached zip file), which runs different query types \\n(term, phrase, OR of 2 terms, AND of 2 terms, prefix, phrase) sorting \\nby score or by a string field (with increasing numbers of unique \\nvalues: country (~250 values I think), and then \\nunique10\\/100\\/1K\\/10K\\/100K\\/1M)).  I derive the unique fields by taking \\nfirst N unique titles from wikipedia; the country field comes from the \\nSortableSingleDocSource in contrib\\/benchmark. \\n\\n It runs with 2 threads (machine has 2 cores), and each thread first \\nshuffles the queries privately but deterministically, so that each \\nmatching thread in the trunk &amp; 3x tests are running query+sort in same \\norder. \\n\\n I then created a Wikipedia index with first 5M docs, one optimized and \\none not optimized (13 segments) and with 5% docs deleted, on trunk and \\n3x. \\n\\n I sweep through all query+sorts 23 times (getting top 10 hits for \\neach), using 2 threads, measuring wall clock time each time.  I \\ndiscard first 3 results for each query+sort, and then take fastest \\ntime of the remaining 20. \\n\\n Java is 1.6.0_17; I run with -server -Xmx1g -Xms1g (machine has 3G \\nRAM); OS is Linux CentOS 5.5. \\n\\n  NOTE : these results include the patch from   LUCENE-2504  , for both \\ntrunk &amp; 3.x! \\n\\n Results (pctg change in query time, going from 3x -&gt; trunk) on \\noptimized index: \\n\\n Results on optimized index: \\n\\n \\n  \\n \\n Query \\n country \\n unique10 \\n unique100 \\n unique1K \\n unique10K \\n unique100K \\n unique1M \\n score \\n \\n \\n &lt;all&gt; \\n  40.5%  \\n  40.6%  \\n  41.0%  \\n  40.5%  \\n  40.7%  \\n  1.6%  \\n  1.8%  \\n  2.8%  \\n \\n \\n +united +states \\n  6.1%  \\n  6.0%  \\n  6.0%  \\n  6.6%  \\n  6.3%  \\n  0.4%  \\n  1.4%  \\n  1.7%  \\n \\n \\n \\\"united states\\\" \\n  8.4%  \\n  8.5%  \\n  8.2%  \\n  8.1%  \\n  8.1%  \\n  9.2%  \\n  9.3%  \\n  8.7%  \\n \\n \\n states \\n  20.3%  \\n  20.4%  \\n  20.9%  \\n  22.5%  \\n  22.5%  \\n  8.0%  \\n  8.1%  \\n  0.1%  \\n \\n \\n unite* \\n  8.1%  \\n  8.3%  \\n  8.3%  \\n  8.6%  \\n  9.0%  \\n  2.8%  \\n  0.8%  \\n  1.2%  \\n \\n \\n united states \\n  1.3%  \\n  1.9%  \\n  2.5%  \\n  1.8%  \\n  2.2%  \\n  2.3%  \\n  1.3%  \\n  2.2%  \\n \\n  \\n \\n\\n\\n Results on unoptimized index (w\\/ 5% deletions): \\n\\n \\n  \\n \\n Query \\n country \\n unique10 \\n unique100 \\n unique1K \\n unique10K \\n unique100K \\n unique1M \\n score \\n \\n \\n &lt;all&gt; \\n  25.1%  \\n  25.8%  \\n  24.9%  \\n  27.2%  \\n  26.3%  \\n  27.4%  \\n  27.3%  \\n  1.4%  \\n \\n \\n +united +states \\n  7.8%  \\n  7.6%  \\n  7.5%  \\n  7.8%  \\n  7.6%  \\n  8.6%  \\n  8.9%  \\n  6.5%  \\n \\n \\n \\\"united states\\\" \\n  13.4%  \\n  13.7%  \\n  13.6%  \\n  13.8%  \\n  13.4%  \\n  14.1%  \\n  13.6%  \\n  14.8%  \\n \\n \\n states \\n  13.6%  \\n  14.3%  \\n  14.2%  \\n  15.5%  \\n  15.5%  \\n  18.6%  \\n  18.8%  \\n  1.7%  \\n \\n \\n unite* \\n  5.8%  \\n  5.3%  \\n  5.0%  \\n  5.7%  \\n  5.3%  \\n  6.9%  \\n  6.9%  \\n  2.4%  \\n \\n \\n united states \\n  2.3%  \\n  2.6%  \\n  1.4%  \\n  1.9%  \\n  2.5%  \\n  4.9%  \\n  6.6%  \\n  0.1%  \\n \\n  \\n \\n\\n\\n Unfortunately, the tests have highish variance (up to maybe +\\/- 10%), \\nI think thanks to hotspot\'s unpredictability (\\\"java ghosts\\\").  EG if I \\nchange the order in which the queries are run, the results change \\nquite a bit.  If I run the exact same test, results change alot.  This \\nof course makes conclusions nearly impossible... but still some rough \\nobservations: \\n\\n \\n\\t Trunk is definitely slower when sorting by field; sorting by \\n    score is roughly the same perf. \\n \\n\\n\\n \\n\\t For some reason, the unoptimized index generally takes less perf \\n    hit than the optimized index... odd. \\n \\n\\n\\n \\n\\t Curious that phrase query is faster across the board... not sure \\n    why.  Maybe my recent optos to PhraseQuery somehow favor flex? \\n \\n\\n\\n \\n\\t Perf loss is in proportion to how \\\"easy\\\" the query is \\n    (AllDocsQuery is the worst; TermQuery next), which makes sense \\n    since the slowdown is in collection. \\n \\n\\n\\n Even though the results are noisy... I still think we should try to \\nspecialize direct access to the native array for doc-&gt;ord lookup. \\nI\'ll work on that next...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12905008\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12905008&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12905008\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12905008_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12905008_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/10 12:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-01T12:20:37+0000\'\u003e01\\/Sep\\/10 12:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I implemented Yonik\'s suggestion here: the comparator may now\u003cbr\\/\u003e\\nreturn a new segment-specific FieldComparator on each call to\u003cbr\\/\u003e\\n.setNextReader.  I fixed all FieldComparators to simply \\\"return this\\\",\u003cbr\\/\u003e\\nexcept for the TermOrdValComparator which returns a comparator\u003cbr\\/\u003e\\nspecialized to the bit-width of the packed ints doc-&gt;ord mapping for\u003cbr\\/\u003e\\nthe fixed-array (8, 16, 32) cases.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is all quite silly: we are only doing this to \\\"game\\\" hotspot into\u003cbr\\/\u003e\\nproperly inlining\\/compiling what is in fact an array lookup, just\u003cbr\\/\u003e\\ncurrently hidden behind method calls in the packed ints impls.  We\u003cbr\\/\u003e\\nreally \\\"shouldn\'t have to\\\" do this custom source code specialization.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd, I think a more general framework for source-code specialization\u003cbr\\/\u003e\\nis a cleaner way to minimize hotspot unpredictability (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-1594\\\" title=\\\"Use source code specialization to maximize search performance\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-1594\\\"\u003e\u003cdel\u003eLUCENE-1594\u003c\\/del\u003e\u003c\\/a\u003e),\u003cbr\\/\u003e\\nin the future.  Maybe once we cutover to that, we can remove these\u003cbr\\/\u003e\\ncases of custom specialization in Lucene\'s core (the 12 private\u003cbr\\/\u003e\\ninner Collector impls in TopFieldCollector is another example).\u003c\\/p\u003e\\n\\n\u003cp\u003eHere are the results, comparing 3.x perf to trunk w\\/ the attached\u003cbr\\/\u003e\\npatch &#8211; all runs include the pending \u003cspan class=\\\"error\\\"\u003e&#91;separate&#93;\u003c\\/span\u003e fix on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2631\\\" title=\\\"Fix small perf issues with String\\/TermOrdValComparator\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2631\\\"\u003e\u003cdel\u003eLUCENE-2631\u003c\\/del\u003e\u003c\\/a\u003e:\u003c\\/p\u003e\\n\\n\u003cp\u003eOptimized index:\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003eQuery\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003ecountry\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique10\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique100\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique1K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique10K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique100K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique1M\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003escore\u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e&lt;all&gt;\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e9.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e10.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e+united +states\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e0.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e0.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\\\"united states\\\"\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e5.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e5.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e5.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e5.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e5.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e4.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e6.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e7.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003estates\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e3.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunite*\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e3.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e3.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunited states\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e0.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e0.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e3.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\\n\u003cp\u003eMulti-segment index (5% deletions):\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003eQuery\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003ecountry\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique10\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique100\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique1K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique10K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique100K\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eunique1M\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003escore\u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e&lt;all&gt;\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e10.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e10.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e10.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e9.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e9.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e10.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e10.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e5.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e+united +states\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\\\"united states\\\"\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e4.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e4.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e4.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e3.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e4.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e4.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e3.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e4.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003estates\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e8.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e6.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e7.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e9.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e9.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunite*\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e5.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e3.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e0.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunited states\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e2.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e3.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e3.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e4.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e3.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e1.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eSo... this fix does make up much of the difference; we still seem to\u003cbr\\/\u003e\\nbe a bit (single digits) slower, but, I think this is acceptable given\u003cbr\\/\u003e\\nthe massive reduction in RAM required for the FieldCache entry.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12905008_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12905008_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/10 12:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-01T12:20:37+0000\'\u003e01\\/Sep\\/10 12:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I implemented Yonik\'s suggestion here: the comparator may now \\nreturn a new segment-specific FieldComparator on each call to \\n.setNextReader.  I fixed all FieldComparators to simply \\\"return this\\\", \\nexcept for the TermOrdValComparator which returns a comparator \\nspecialized to the bit-width of the packed ints doc-&gt;ord mapping for \\nthe fixed-array (8, 16, 32) cases. \\n\\n This is all quite silly: we are only doing this to \\\"game\\\" hotspot into \\nproperly inlining\\/compiling what is in fact an array lookup, just \\ncurrently hidden behind method calls in the packed ints impls.  We \\nreally \\\"shouldn\'t have to\\\" do this custom source code specialization. \\n\\n And, I think a more general framework for source-code specialization \\nis a cleaner way to minimize hotspot unpredictability (  LUCENE-1594  ), \\nin the future.  Maybe once we cutover to that, we can remove these \\ncases of custom specialization in Lucene\'s core (the 12 private \\ninner Collector impls in TopFieldCollector is another example). \\n\\n Here are the results, comparing 3.x perf to trunk w\\/ the attached \\npatch &#8211; all runs include the pending  &#91;separate&#93;  fix on   LUCENE-2631  : \\n\\n Optimized index: \\n\\n \\n  \\n \\n Query \\n country \\n unique10 \\n unique100 \\n unique1K \\n unique10K \\n unique100K \\n unique1M \\n score \\n \\n \\n &lt;all&gt; \\n  8.5%  \\n  8.5%  \\n  8.4%  \\n  8.7%  \\n  8.7%  \\n  8.4%  \\n  9.4%  \\n  10.7%  \\n \\n \\n +united +states \\n  1.8%  \\n  0.6%  \\n  0.3%  \\n  0.4%  \\n  0.9%  \\n  0.7%  \\n  2.1%  \\n  2.9%  \\n \\n \\n \\\"united states\\\" \\n  5.2%  \\n  5.5%  \\n  5.7%  \\n  5.2%  \\n  5.2%  \\n  4.8%  \\n  6.9%  \\n  7.1%  \\n \\n \\n states \\n  4.6%  \\n  4.8%  \\n  4.1%  \\n  5.2%  \\n  5.1%  \\n  7.0%  \\n  3.8%  \\n  1.8%  \\n \\n \\n unite* \\n  2.0%  \\n  1.7%  \\n  3.0%  \\n  2.6%  \\n  2.4%  \\n  5.7%  \\n  6.0%  \\n  3.0%  \\n \\n \\n united states \\n  0.5%  \\n  0.4%  \\n  2.8%  \\n  2.6%  \\n  3.1%  \\n  2.1%  \\n  1.1%  \\n  2.0%  \\n \\n  \\n \\n\\n\\n\\n Multi-segment index (5% deletions): \\n\\n \\n  \\n \\n Query \\n country \\n unique10 \\n unique100 \\n unique1K \\n unique10K \\n unique100K \\n unique1M \\n score \\n \\n \\n &lt;all&gt; \\n  10.0%  \\n  10.2%  \\n  10.1%  \\n  9.4%  \\n  9.4%  \\n  10.1%  \\n  10.0%  \\n  5.1%  \\n \\n \\n +united +states \\n  7.2%  \\n  7.5%  \\n  7.7%  \\n  8.5%  \\n  8.4%  \\n  7.1%  \\n  5.4%  \\n  1.9%  \\n \\n \\n \\\"united states\\\" \\n  4.5%  \\n  4.2%  \\n  4.0%  \\n  3.8%  \\n  4.5%  \\n  4.3%  \\n  3.7%  \\n  4.2%  \\n \\n \\n states \\n  6.5%  \\n  8.6%  \\n  7.3%  \\n  6.9%  \\n  7.5%  \\n  9.4%  \\n  9.9%  \\n  1.3%  \\n \\n \\n unite* \\n  4.5%  \\n  5.3%  \\n  4.3%  \\n  3.9%  \\n  4.5%  \\n  4.7%  \\n  4.7%  \\n  0.4%  \\n \\n \\n united states \\n  4.6%  \\n  2.4%  \\n  3.2%  \\n  3.4%  \\n  1.9%  \\n  4.8%  \\n  3.3%  \\n  1.9%  \\n \\n  \\n \\n\\n\\n So... this fix does make up much of the difference; we still seem to \\nbe a bit (single digits) slower, but, I think this is acceptable given \\nthe massive reduction in RAM required for the FieldCache entry.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908251\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908251&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908251\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908251_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908251_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Sep\\/10 00:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-11T00:16:23+0000\'\u003e11\\/Sep\\/10 00:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGreat!  Hopefully I\'ll get a change to test it out shortly on my system too.\u003cbr\\/\u003e\\nI just committed 2 places that the new returned comparator was ignored.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908251_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908251_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Sep\\/10 00:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-11T00:16:23+0000\'\u003e11\\/Sep\\/10 00:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Great!  Hopefully I\'ll get a change to test it out shortly on my system too. \\nI just committed 2 places that the new returned comparator was ignored.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908255\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908255&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908255\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12908255_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908255_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Sep\\/10 00:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-11T00:45:05+0000\'\u003e11\\/Sep\\/10 00:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI just committed 2 places that the new returned comparator was ignored.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eUrgh &#8211; thanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12908255_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908255_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Sep\\/10 00:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-11T00:45:05+0000\'\u003e11\\/Sep\\/10 00:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I just committed 2 places that the new returned comparator was ignored.  \\n\\n Urgh &#8211; thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908336\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908336&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908336\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908336_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908336_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Sep\\/10 16:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-11T16:29:16+0000\'\u003e11\\/Sep\\/10 16:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThis is all quite silly: we are only doing this to \\\"game\\\" hotspot into properly inlining\\/compiling what is in fact an array lookup, just currently hidden behind method calls in the packed ints impls. We really \\\"shouldn\'t have to\\\" do this custom source code specialization.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah, but this is the way hotspot currently works, and I don\'t know if there are any plans to change it.\u003cbr\\/\u003e\\nHotspot can be pretty aggressive at inlining, but then it deoptimizes when it turns out that the inline is no longer valid (because of a different implementation).\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s something worth keeping in mind for the rest of Lucene too - bothin benchmarking and design. Multiple implementations used from a single spot will not be inlined (if multiple implementations are actually used in the same run).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908336_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908336_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Sep\\/10 16:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-11T16:29:16+0000\'\u003e11\\/Sep\\/10 16:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     This is all quite silly: we are only doing this to \\\"game\\\" hotspot into properly inlining\\/compiling what is in fact an array lookup, just currently hidden behind method calls in the packed ints impls. We really \\\"shouldn\'t have to\\\" do this custom source code specialization.  \\n\\n Yeah, but this is the way hotspot currently works, and I don\'t know if there are any plans to change it. \\nHotspot can be pretty aggressive at inlining, but then it deoptimizes when it turns out that the inline is no longer valid (because of a different implementation). \\n\\n It\'s something worth keeping in mind for the rest of Lucene too - bothin benchmarking and design. Multiple implementations used from a single spot will not be inlined (if multiple implementations are actually used in the same run).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908357\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908357&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908357\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908357_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908357_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Sep\\/10 19:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-11T19:25:22+0000\'\u003e11\\/Sep\\/10 19:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m still seeing bad degredations in solr - I think it\'s because the default way for solr to sort strings is with MissingLastOrdComparator, which isn\'t specialized. I\'ll try and work up a patch based on Mike\'s work.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908357_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908357_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Sep\\/10 19:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-11T19:25:22+0000\'\u003e11\\/Sep\\/10 19:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m still seeing bad degredations in solr - I think it\'s because the default way for solr to sort strings is with MissingLastOrdComparator, which isn\'t specialized. I\'ll try and work up a patch based on Mike\'s work.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908519\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908519&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908519\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908519_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908519_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/10 18:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-12T18:25:23+0000\'\u003e12\\/Sep\\/10 18:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmmm, turns out the sorting bug I just checked in (r996332) has been around a bit longer than I thought - since field cache was converted to bytes on 6\\/3\\/2010 (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2380\\\" title=\\\"Add FieldCache.getTermBytes, to load term data as byte[]\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2380\\\"\u003e\u003cdel\u003eLUCENE-2380\u003c\\/del\u003e\u003c\\/a\u003e).\u003c\\/p\u003e\\n\\n\u003cp\u003eSo anyone using trunk since then and sorting on string fields with null values may want to upgrade.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908519_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908519_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/10 18:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-12T18:25:23+0000\'\u003e12\\/Sep\\/10 18:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmmm, turns out the sorting bug I just checked in (r996332) has been around a bit longer than I thought - since field cache was converted to bytes on 6\\/3\\/2010 (  LUCENE-2380  ). \\n\\n So anyone using trunk since then and sorting on string fields with null values may want to upgrade.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908909\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908909&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908909\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908909_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908909_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 18:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T18:37:02+0000\'\u003e13\\/Sep\\/10 18:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, here\'s  a patch for solr\'s sort missing last.\u003cbr\\/\u003e\\nMedian response time in my tests drops from 160 to 102 ms.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908909_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908909_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 18:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T18:37:02+0000\'\u003e13\\/Sep\\/10 18:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, here\'s  a patch for solr\'s sort missing last. \\nMedian response time in my tests drops from 160 to 102 ms.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908918\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908918&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908918\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12908918_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908918_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 18:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T18:48:23+0000\'\u003e13\\/Sep\\/10 18:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003esilly question, what does the bigString do?\u003c\\/p\u003e\\n\\n\u003cp\u003e(just wondering if it should be U+10FFFF,U+10FFFF,... now that we use utf-8 order, depending what it does)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12908918_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908918_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 18:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T18:48:23+0000\'\u003e13\\/Sep\\/10 18:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    silly question, what does the bigString do? \\n\\n (just wondering if it should be U+10FFFF,U+10FFFF,... now that we use utf-8 order, depending what it does)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908934\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908934&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908934\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908934_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908934_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:08:13+0000\'\u003e13\\/Sep\\/10 19:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003esilly question, what does the bigString do? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt\'s actually not currently used by Solr.... but it\'s basically to use as a proxy for a null if you want the Comparables returned by value() to match the sort order the Comparator actually used.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e(just wondering if it should be U+10FFFF,U+10FFFF,... now that we use utf-8 order, depending what it does)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMaybe... if it is supposed to be just a string (I know that\'s the name, but maybe it should be called bigTerm I guess).  All of our terms are currently UTF8 - but I don\'t know if that will last?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908934_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908934_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:08:13+0000\'\u003e13\\/Sep\\/10 19:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     silly question, what does the bigString do?   \\n\\n It\'s actually not currently used by Solr.... but it\'s basically to use as a proxy for a null if you want the Comparables returned by value() to match the sort order the Comparator actually used. \\n\\n  (just wondering if it should be U+10FFFF,U+10FFFF,... now that we use utf-8 order, depending what it does)  \\n\\n Maybe... if it is supposed to be just a string (I know that\'s the name, but maybe it should be called bigTerm I guess).  All of our terms are currently UTF8 - but I don\'t know if that will last?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908947\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908947&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908947\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12908947_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908947_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:17:36+0000\'\u003e13\\/Sep\\/10 19:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eMaybe... if it is supposed to be just a string (I know that\'s the name, but maybe it should be called bigTerm I guess). All of our terms are currently UTF8 - but I don\'t know if that will last?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ewell you are right, for example collated terms for Locale-sensitive sort will hopefully use full byte range soon... \u003c\\/p\u003e\\n\\n\u003cp\u003ewe can always safely use bytes of 0xff i think?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12908947_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908947_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:17:36+0000\'\u003e13\\/Sep\\/10 19:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Maybe... if it is supposed to be just a string (I know that\'s the name, but maybe it should be called bigTerm I guess). All of our terms are currently UTF8 - but I don\'t know if that will last?  \\n\\n well you are right, for example collated terms for Locale-sensitive sort will hopefully use full byte range soon...  \\n\\n we can always safely use bytes of 0xff i think?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908953\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908953&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908953\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908953_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908953_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:23:47+0000\'\u003e13\\/Sep\\/10 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ewe can always safely use bytes of 0xff i think?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYep, should be fine.  Is there an upper bound on how long collated terms can be?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908953_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908953_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:23:47+0000\'\u003e13\\/Sep\\/10 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     we can always safely use bytes of 0xff i think?  \\n\\n Yep, should be fine.  Is there an upper bound on how long collated terms can be?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908956\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908956&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908956\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12908956_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908956_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:29:17+0000\'\u003e13\\/Sep\\/10 19:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eYep, should be fine. Is there an upper bound on how long collated terms can be?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere isn\'t, but...\u003c\\/p\u003e\\n\\n\u003cp\u003eI can\'t promise (but i\'ll verify), i think actually a single 0xff might do, for the major encodings.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eits invalid in utf-8\u003c\\/li\u003e\\n\\t\u003cli\u003eits technically valid, but unused (reset byte) in bocu-1\u003c\\/li\u003e\\n\\t\u003cli\u003ecollation keys i understand are a modified bocu, likely unused there too.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eso its like a NaN sentinel, if someone is doing something very wierd, maybe it wont work,\u003cbr\\/\u003e\\nbut in general, i think it will work. ill check.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12908956_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908956_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:29:17+0000\'\u003e13\\/Sep\\/10 19:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Yep, should be fine. Is there an upper bound on how long collated terms can be?  \\n\\n There isn\'t, but... \\n\\n I can\'t promise (but i\'ll verify), i think actually a single 0xff might do, for the major encodings. \\n\\n \\n\\t its invalid in utf-8 \\n\\t its technically valid, but unused (reset byte) in bocu-1 \\n\\t collation keys i understand are a modified bocu, likely unused there too. \\n \\n\\n\\n so its like a NaN sentinel, if someone is doing something very wierd, maybe it wont work, \\nbut in general, i think it will work. ill check.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908963\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908963&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908963\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908963_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908963_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:43:06+0000\'\u003e13\\/Sep\\/10 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, I\'ve changed bigString to bigTerm and used 10 0xff bytes (to account for possible binary encoding of 8 byte numerics + other stuff like tags that trie encoding uses).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12908963_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908963_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:43:06+0000\'\u003e13\\/Sep\\/10 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, I\'ve changed bigString to bigTerm and used 10 0xff bytes (to account for possible binary encoding of 8 byte numerics + other stuff like tags that trie encoding uses).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12908965\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12908965&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12908965\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12908965_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908965_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:49:53+0000\'\u003e13\\/Sep\\/10 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCool thanks (unfortunately i ran a bunch of collators and encountered what looks like 0xff bytes)\u003cbr\\/\u003e\\nI think this will help.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12908965_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12908965_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/10 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-13T19:49:53+0000\'\u003e13\\/Sep\\/10 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Cool thanks (unfortunately i ran a bunch of collators and encountered what looks like 0xff bytes) \\nI think this will help.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909098\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909098&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909098\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dsmiley\\\" id=\\\"commentauthor_12909098_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dsmiley\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dsmiley\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e David Smiley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909098_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 02:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T02:54:35+0000\'\u003e14\\/Sep\\/10 02:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYonik, just curious, how do you know what HotSpot is doing?  Empirically based on performance numbers?  HotSpot code or documentation that spells out exactly when it inlines?  Or is there some tool or diagnostic capability to learn this information?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dsmiley\\\" id=\\\"commentauthor_12909098_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dsmiley\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dsmiley\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e David Smiley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909098_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 02:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T02:54:35+0000\'\u003e14\\/Sep\\/10 02:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yonik, just curious, how do you know what HotSpot is doing?  Empirically based on performance numbers?  HotSpot code or documentation that spells out exactly when it inlines?  Or is there some tool or diagnostic capability to learn this information?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909107\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909107&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909107\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909107_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909107_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 04:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T04:04:27+0000\'\u003e14\\/Sep\\/10 04:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eYonik, just curious, how do you know what HotSpot is doing? Empirically based on performance numbers?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah - it\'s a best guess based on what I see when performance testing, and matching that up with what I\'ve read in the past.\u003cbr\\/\u003e\\nAs far as deoptmization is concerned, it\'s mentioned here: \u003ca href=\\\"http:\\/\\/java.sun.com\\/products\\/hotspot\\/whitepaper.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/java.sun.com\\/products\\/hotspot\\/whitepaper.html\u003c\\/a\u003e, but I haven\'t read much elsewhere.\u003c\\/p\u003e\\n\\n\u003cp\u003eSpecific to this issue, the whole optimization\\/deoptimization issue is extremely complex.\u003cbr\\/\u003e\\nRecall that I reported this: \\\"Median response time in my tests drops from 160 to 102 ms.\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eFor simplicity, there are some details I left out:\u003cbr\\/\u003e\\nThose numbers were for randomly sorting on different fields (hopefully the most realistic scenario).\u003cbr\\/\u003e\\nIf you test differently, the results are far different.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe first and second test runs measured median time sorting on a single field 100 times in a row, then moving to the next field.\u003c\\/p\u003e\\n\\n\u003cp\u003eTrunk before patch:\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunique terms in field\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003emedian sort time in ms (first run)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003esecond run\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e105\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e168\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e105\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e169\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e106\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e164\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e127\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e163\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e165\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e197\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eTrunk after patch:\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunique terms in field\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003emedian sort time in ms (first run)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003esecond run\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e85\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e130\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e92\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e129\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e92\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e126\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e116\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e127\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e117\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003ebranch_3x\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunique terms in field\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003emedian sort time in ms (first run)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003esecond run\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e102\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e102\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e102\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e103\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e101\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e103\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e103\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e103\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e118\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e118\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eSo, it seems by running in batches (sorting on the same field over and over), we cause hotspot to overspecialize somehow, and then when we switch things up the resulting deoptimization puts us in a permanently worse condition).  branch_3x does not suffer from that, but trunk still does due to the increased amount of indirection.  I imagine the differences are also due to the boundaries that the compiler tries to inline\\/specialize for a certain class.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt certainly complicates performance testing, and we need to keep a sharp eye on how we actually test potential improvements.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909107_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909107_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 04:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T04:04:27+0000\'\u003e14\\/Sep\\/10 04:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Yonik, just curious, how do you know what HotSpot is doing? Empirically based on performance numbers?  \\n\\n Yeah - it\'s a best guess based on what I see when performance testing, and matching that up with what I\'ve read in the past. \\nAs far as deoptmization is concerned, it\'s mentioned here:  http:\\/\\/java.sun.com\\/products\\/hotspot\\/whitepaper.html , but I haven\'t read much elsewhere. \\n\\n Specific to this issue, the whole optimization\\/deoptimization issue is extremely complex. \\nRecall that I reported this: \\\"Median response time in my tests drops from 160 to 102 ms.\\\" \\n\\n For simplicity, there are some details I left out: \\nThose numbers were for randomly sorting on different fields (hopefully the most realistic scenario). \\nIf you test differently, the results are far different. \\n\\n The first and second test runs measured median time sorting on a single field 100 times in a row, then moving to the next field. \\n\\n Trunk before patch: \\n \\n  \\n \\n unique terms in field \\n median sort time in ms (first run) \\n second run \\n \\n \\n 100000 \\n 105 \\n 168 \\n \\n \\n 10000 \\n 105 \\n 169 \\n \\n \\n 1000 \\n 106 \\n 164 \\n \\n \\n 100 \\n 127 \\n 163 \\n \\n \\n 10 \\n 165 \\n 197 \\n \\n  \\n \\n\\n\\n Trunk after patch: \\n \\n  \\n \\n unique terms in field \\n median sort time in ms (first run) \\n second run \\n \\n \\n 100000 \\n 85 \\n 130 \\n \\n \\n 10000 \\n 92 \\n 129 \\n \\n \\n 1000 \\n 92 \\n 126 \\n \\n \\n 100 \\n 116 \\n 127 \\n \\n \\n 10 \\n 117 \\n 128 \\n \\n  \\n \\n\\n\\n branch_3x \\n \\n  \\n \\n unique terms in field \\n median sort time in ms (first run) \\n second run \\n \\n \\n 100000 \\n 102 \\n 102 \\n \\n \\n 10000 \\n 102 \\n 103 \\n \\n \\n 1000 \\n 101 \\n 103 \\n \\n \\n 100 \\n 103 \\n 103 \\n \\n \\n 10 \\n 118 \\n 118 \\n \\n  \\n \\n\\n\\n So, it seems by running in batches (sorting on the same field over and over), we cause hotspot to overspecialize somehow, and then when we switch things up the resulting deoptimization puts us in a permanently worse condition).  branch_3x does not suffer from that, but trunk still does due to the increased amount of indirection.  I imagine the differences are also due to the boundaries that the compiler tries to inline\\/specialize for a certain class. \\n\\n It certainly complicates performance testing, and we need to keep a sharp eye on how we actually test potential improvements.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909177\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909177&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909177\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12909177_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909177_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 10:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T10:19:52+0000\'\u003e14\\/Sep\\/10 10:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe fickleness of the hotspot compiler is just awful, and, frankely\u003cbr\\/\u003e\\nunacceptable.  Java (Oracle) really needs to do something to address\u003cbr\\/\u003e\\nthis.\u003c\\/p\u003e\\n\\n\u003cp\u003eEG, see my post here:\u003c\\/p\u003e\\n\\n\u003cp\u003e  \u003ca href=\\\"http:\\/\\/forums.sun.com\\/thread.jspa?threadID=5420631\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/forums.sun.com\\/thread.jspa?threadID=5420631\u003c\\/a\u003e  \u003c\\/p\u003e\\n\\n\u003cp\u003eIn that standalone test, I can get drastically different search\u003cbr\\/\u003e\\nperformance depending on what code runs first.  Hotspot gets itself\u003cbr\\/\u003e\\ninto a state where it\'s \\\"stuck\\\" and is not able to re-optimize for the\u003cbr\\/\u003e\\ncode that\'s running.  When I disassembled the methods hotspot had\u003cbr\\/\u003e\\ncompiled, one thing I found was that readVInt (the hottest of hot in\u003cbr\\/\u003e\\nLucene today) was compiled very differently depending on what code ran\u003cbr\\/\u003e\\nfirst!\u003c\\/p\u003e\\n\\n\u003cp\u003eThe changes we\'ve had to make to Lucene\\/Solr in this issue to\u003cbr\\/\u003e\\nworkaround hotspot are here are horrible &#8211; we\'ve introduced ugly code\u003cbr\\/\u003e\\ndup specializations so that hotspot properly detects given method\u003cbr\\/\u003e\\ncalls are in fact just an array lookup.  We\'ve made similar\u003cbr\\/\u003e\\nspecializations elsewhere in Lucene...\u003c\\/p\u003e\\n\\n\u003cp\u003eWeirdly, I\'ve found that running java with -Xbatch gives far more\u003cbr\\/\u003e\\nrepeatable results.  This is bizarre because that option forces\u003cbr\\/\u003e\\ncompilation to run in the foreground; it\'s not supposed to alter which\u003cbr\\/\u003e\\nmethods hotspot chooses to optimize, and, how much (I think?).  Though\u003cbr\\/\u003e\\nmaybe because threads are paused awaiting compilation it alters\u003cbr\\/\u003e\\nhotspots targets?  However, -Xbatch doesn\'t always give the fastest\u003cbr\\/\u003e\\nresults.\u003c\\/p\u003e\\n\\n\u003cp\u003eNot that we have a choice here... but I\'ve often wondered whether .NET\u003cbr\\/\u003e\\nhas this same hotspot fickleness problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this is a severe and growing problem for Lucene going forward\u003cbr\\/\u003e\\n&#8211; our search performance is crucial and we can\'t risk hotspot\u003cbr\\/\u003e\\nrandomly, substantially slowing things down by alot.  We\'re unable\u003cbr\\/\u003e\\nto do true performance tuning when hospot \\\"noise\\\" easily dwarfs the\u003cbr\\/\u003e\\neffects we\'re trying to measure.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the only viable option going forward is to create a search\u003cbr\\/\u003e\\nframework that\'s able to generate its own specialized java code.  We\'d\u003cbr\\/\u003e\\nuse this, statically, to generate pieces of the search executation\u003cbr\\/\u003e\\npath that we think are common enough to warrent up-front specialization,\u003cbr\\/\u003e\\nbut also expose it dynamically so apps can \\\"optimize\\\" for their query\u003cbr\\/\u003e\\npaths, either statically (pre-built\\/compiled in their apps) or\u003cbr\\/\u003e\\ndynamically (like how a JSP rewrites to java code and is then\u003cbr\\/\u003e\\ncompiled).  Of course we\'d still retain the non-specialized code, as a\u003cbr\\/\u003e\\nfallback to handle those cases the specializer can\'t yet cover, or,\u003cbr\\/\u003e\\nfor apps where the net bytecode must be kept smallish.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn theory such a search autogen framework could also generate into\u003cbr\\/\u003e\\nC\\/C++, enabling us to choose a good point to wrap the result with JNI\u003cbr\\/\u003e\\n(eg, TopDocsCollector.topDocs), which\'d be wonderful as it\'d fully\u003cbr\\/\u003e\\nsidestep the hotspot fickleness.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12909177_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909177_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 10:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T10:19:52+0000\'\u003e14\\/Sep\\/10 10:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The fickleness of the hotspot compiler is just awful, and, frankely \\nunacceptable.  Java (Oracle) really needs to do something to address \\nthis. \\n\\n EG, see my post here: \\n\\n    http:\\/\\/forums.sun.com\\/thread.jspa?threadID=5420631    \\n\\n In that standalone test, I can get drastically different search \\nperformance depending on what code runs first.  Hotspot gets itself \\ninto a state where it\'s \\\"stuck\\\" and is not able to re-optimize for the \\ncode that\'s running.  When I disassembled the methods hotspot had \\ncompiled, one thing I found was that readVInt (the hottest of hot in \\nLucene today) was compiled very differently depending on what code ran \\nfirst! \\n\\n The changes we\'ve had to make to Lucene\\/Solr in this issue to \\nworkaround hotspot are here are horrible &#8211; we\'ve introduced ugly code \\ndup specializations so that hotspot properly detects given method \\ncalls are in fact just an array lookup.  We\'ve made similar \\nspecializations elsewhere in Lucene... \\n\\n Weirdly, I\'ve found that running java with -Xbatch gives far more \\nrepeatable results.  This is bizarre because that option forces \\ncompilation to run in the foreground; it\'s not supposed to alter which \\nmethods hotspot chooses to optimize, and, how much (I think?).  Though \\nmaybe because threads are paused awaiting compilation it alters \\nhotspots targets?  However, -Xbatch doesn\'t always give the fastest \\nresults. \\n\\n Not that we have a choice here... but I\'ve often wondered whether .NET \\nhas this same hotspot fickleness problem. \\n\\n I think this is a severe and growing problem for Lucene going forward \\n&#8211; our search performance is crucial and we can\'t risk hotspot \\nrandomly, substantially slowing things down by alot.  We\'re unable \\nto do true performance tuning when hospot \\\"noise\\\" easily dwarfs the \\neffects we\'re trying to measure. \\n\\n I think the only viable option going forward is to create a search \\nframework that\'s able to generate its own specialized java code.  We\'d \\nuse this, statically, to generate pieces of the search executation \\npath that we think are common enough to warrent up-front specialization, \\nbut also expose it dynamically so apps can \\\"optimize\\\" for their query \\npaths, either statically (pre-built\\/compiled in their apps) or \\ndynamically (like how a JSP rewrites to java code and is then \\ncompiled).  Of course we\'d still retain the non-specialized code, as a \\nfallback to handle those cases the specializer can\'t yet cover, or, \\nfor apps where the net bytecode must be kept smallish. \\n\\n In theory such a search autogen framework could also generate into \\nC\\/C++, enabling us to choose a good point to wrap the result with JNI \\n(eg, TopDocsCollector.topDocs), which\'d be wonderful as it\'d fully \\nsidestep the hotspot fickleness.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909214\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909214&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909214\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12909214_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909214_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 12:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T12:25:19+0000\'\u003e14\\/Sep\\/10 12:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eJava (Oracle) really needs to do something to address this.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think we all owe it to ourselves to stop equating java with Sun\\/Oracle, if Java \u003cbr\\/\u003e\\nstays with Oracle its pretty obvious the language (is) will die anyway.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI think this is a severe and growing problem for Lucene going forward\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eour search performance is crucial and we can\'t risk hotspot\u003cbr\\/\u003e\\nrandomly, substantially slowing things down by alot.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhile I agree at the moment we should make efforts to work around issues like this,\u003cbr\\/\u003e\\nI don\'t think we should jump the gun and make real design\\/architectural\u003cbr\\/\u003e\\nchoices based on Oracle bugs.\u003c\\/p\u003e\\n\\n\u003cp\u003eEspecially for trunk, by the time we release Lucene 4.0 some other company\u003cbr\\/\u003e\\nwill probably \\\"own\\\" Java anyway.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eNot that we have a choice here... but I\'ve often wondered whether .NET\u003cbr\\/\u003e\\nhas this same hotspot fickleness problem\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e.NET is not a choice but generating C\\/C++ code is?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12909214_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909214_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 12:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T12:25:19+0000\'\u003e14\\/Sep\\/10 12:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Java (Oracle) really needs to do something to address this.  \\n\\n I think we all owe it to ourselves to stop equating java with Sun\\/Oracle, if Java  \\nstays with Oracle its pretty obvious the language (is) will die anyway. \\n\\n \\n I think this is a severe and growing problem for Lucene going forward \\n \\n\\t our search performance is crucial and we can\'t risk hotspot \\nrandomly, substantially slowing things down by alot. \\n \\n \\n\\n While I agree at the moment we should make efforts to work around issues like this, \\nI don\'t think we should jump the gun and make real design\\/architectural \\nchoices based on Oracle bugs. \\n\\n Especially for trunk, by the time we release Lucene 4.0 some other company \\nwill probably \\\"own\\\" Java anyway. \\n\\n \\n Not that we have a choice here... but I\'ve often wondered whether .NET \\nhas this same hotspot fickleness problem  \\n\\n .NET is not a choice but generating C\\/C++ code is? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909230\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909230&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909230\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12909230_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909230_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 13:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T13:22:37+0000\'\u003e14\\/Sep\\/10 13:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI think we all owe it to ourselves to stop equating java with Sun\\/Oracle, if Java stays with Oracle its pretty obvious the language (is) will die anyway.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI agree with robert that we should stop comparing against sun jvms all the time and turn everything upside-down specializing code here and there or go one step further and generate C++ code. Dude who is gonna maintain the compatibility to Java-Only environments? I could imagine that we have something which is super special purpose like mike did with DirectNIOFSDirectory  to work around unexposed methods like fadvice. \u003c\\/p\u003e\\n\\n\u003cp\u003eI think that code specializations of very \\\"hot\\\" part of lucene are ok and we should follow that way like we did at some places but it already make things very complicated to follow. Without the knowledge of a committer or a person actively following that development it is extremely difficult to comprehend design decisions.\u003c\\/p\u003e\\n\\n\u003cp\u003eI would rather like the idea to put effort in stuff like harmony and make code we can control perform better that introducing a preprocessor which generates code for a JVM owned by a company. Would it make way more sense to push OSS JVMs than spending lots of time on investigating on .NET as an alternative or C\\/C++ code generator? Before I would go the C++ path I\'d rather use Java to host a C core like lucy which brings you as close as it gets to the machine. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eEG, see my post here:\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003einteresting papers - seems we are touching the limits of Java though.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12909230_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909230_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 13:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T13:22:37+0000\'\u003e14\\/Sep\\/10 13:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I think we all owe it to ourselves to stop equating java with Sun\\/Oracle, if Java stays with Oracle its pretty obvious the language (is) will die anyway.  \\n I agree with robert that we should stop comparing against sun jvms all the time and turn everything upside-down specializing code here and there or go one step further and generate C++ code. Dude who is gonna maintain the compatibility to Java-Only environments? I could imagine that we have something which is super special purpose like mike did with DirectNIOFSDirectory  to work around unexposed methods like fadvice.  \\n\\n I think that code specializations of very \\\"hot\\\" part of lucene are ok and we should follow that way like we did at some places but it already make things very complicated to follow. Without the knowledge of a committer or a person actively following that development it is extremely difficult to comprehend design decisions. \\n\\n I would rather like the idea to put effort in stuff like harmony and make code we can control perform better that introducing a preprocessor which generates code for a JVM owned by a company. Would it make way more sense to push OSS JVMs than spending lots of time on investigating on .NET as an alternative or C\\/C++ code generator? Before I would go the C++ path I\'d rather use Java to host a C core like lucy which brings you as close as it gets to the machine.  \\n\\n  EG, see my post here:  \\n\\n interesting papers - seems we are touching the limits of Java though. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909272\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909272&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909272\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909272_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909272_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 14:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T14:50:04+0000\'\u003e14\\/Sep\\/10 14:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooks like we\'re not using the correct comparators everywhere.\u003cbr\\/\u003e\\nI was trying a slightly different way to implement sort-missing-last, and my first comparator only implements setNextReader(), but I\'m now getting many UnsupportedOperationExceptions (i.e. the search process is using older comparators after calling setNextReader())\u003c\\/p\u003e\\n\\n\u003cp\u003eOne culprit is OneComparatorNonScoringCollector, and another is OneComparatorFieldValueHitQueue I think.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909272_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909272_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 14:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T14:50:04+0000\'\u003e14\\/Sep\\/10 14:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looks like we\'re not using the correct comparators everywhere. \\nI was trying a slightly different way to implement sort-missing-last, and my first comparator only implements setNextReader(), but I\'m now getting many UnsupportedOperationExceptions (i.e. the search process is using older comparators after calling setNextReader()) \\n\\n One culprit is OneComparatorNonScoringCollector, and another is OneComparatorFieldValueHitQueue I think.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909312\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909312&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909312\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12909312_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909312_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 16:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T16:32:21+0000\'\u003e14\\/Sep\\/10 16:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI\'m now getting many UnsupportedOperationExceptions (i.e. the search process is using older comparators after calling setNextReader())\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s no good!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eOne culprit is OneComparatorNonScoringCollector, and another is OneComparatorFieldValueHitQueue I think.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm I don\'t see the problem &#8211; eg OneComparatorNonScoringCollector saves the returned comparator from comparator.setNextReader.\u003c\\/p\u003e\\n\\n\u003cp\u003eCan you post the full exc?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12909312_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909312_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 16:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T16:32:21+0000\'\u003e14\\/Sep\\/10 16:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I\'m now getting many UnsupportedOperationExceptions (i.e. the search process is using older comparators after calling setNextReader())  \\n\\n That\'s no good! \\n\\n  One culprit is OneComparatorNonScoringCollector, and another is OneComparatorFieldValueHitQueue I think.  \\n\\n Hmm I don\'t see the problem &#8211; eg OneComparatorNonScoringCollector saves the returned comparator from comparator.setNextReader. \\n\\n Can you post the full exc?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909319\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909319&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909319\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909319_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909319_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T16:44:09+0000\'\u003e14\\/Sep\\/10 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a draft patch that seems to fix the issue (the ones I can find at least).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eHmm I don\'t see the problem - eg OneComparatorNonScoringCollector saves the returned comparator from comparator.setNextReader.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes, but FieldValueHitQueue has it\'s own list of comparators that never get updated.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909319_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909319_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T16:44:09+0000\'\u003e14\\/Sep\\/10 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a draft patch that seems to fix the issue (the ones I can find at least). \\n\\n  Hmm I don\'t see the problem - eg OneComparatorNonScoringCollector saves the returned comparator from comparator.setNextReader.  \\n\\n Yes, but FieldValueHitQueue has it\'s own list of comparators that never get updated.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909337\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909337&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909337\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12909337_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909337_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 17:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T17:10:58+0000\'\u003e14\\/Sep\\/10 17:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI think we all owe it to ourselves to stop equating java with Oracle, if Java \u003cbr\\/\u003e\\nstays with Oracle its pretty obvious the language (is) will die anyway.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah I agree.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe open question is whether this hotspot fickleness is particular to\u003cbr\\/\u003e\\nOracle\'s java impl, or, is somehow endemic to bytecode VMs (.NET\u003cbr\\/\u003e\\nincluded).  It\'s really a hard, complex problem (JIT compilation from\u003cbr\\/\u003e\\nbytecode based on runtime data), so it wouldn\'t surprise me if it\'s\u003cbr\\/\u003e\\nthe latter, to varying degrees.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e.NET is not a choice but generating C\\/C++ code is?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAs far as I know it\'s much easier to invoke C\\/C++ from java, than .NET\u003cbr\\/\u003e\\nfrom java.  C\\/C++ is also more portable than .NET, I think?  (There is\u003cbr\\/\u003e\\nMono &#8211; how mature is it by now?).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI don\'t think we should jump the gun and make real design\\/architectural\u003cbr\\/\u003e\\nchoices based on Oracle bugs.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI expect source code spec will also buy sizable perf gains\u003cbr\\/\u003e\\nirrespective of hotspot fickleness, and in non-Oracle java impls.\u003cbr\\/\u003e\\nGenerating a dedicated class, with one method doing all searching and\u003cbr\\/\u003e\\ncollecting, removes all kinds of barriers to the JIT compiler.  It\u003cbr\\/\u003e\\nmakes its job far easier.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI agree with robert that we should stop comparing against sun jvms all the time and turn everything upside-down specializing code here and there or go one step further and generate C++ code. Dude who is gonna maintain the compatibility to Java-Only environments?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf we manage to pursue specialized code gen, it\'ll be a loooong time\u003cbr\\/\u003e\\ncoming!  My point about C\\/C++ is that if we do somehow manage to get a\u003cbr\\/\u003e\\nworking code gen framework online (for Java), the added cost to make\u003cbr\\/\u003e\\nit also target C\\/C++ will be \\\"relatively\\\" small.  Ie, it\'s nearly \\\"for\u003cbr\\/\u003e\\nfree\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we were do to this, that would not mean we\'d abandon java, of\u003cbr\\/\u003e\\ncourse &#8211; the framework would fully support \\\"pure java\\\" as well.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI think that code specializations of very \\\"hot\\\" part of lucene are ok and we should follow that way like we did at some places but it already make things very complicated to follow. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYou mean manual specialization right (like this issue)?\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I think we will have to keep manually specializing, going\u003cbr\\/\u003e\\nforward, until we can have code generator that\u003cbr\\/\u003e\\ndoes it more cleanly...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWould it make way more sense to push OSS JVMs than spending lots of time on investigating on .NET as an alternative or C\\/C++ code generator?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think we should do both.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBefore I would go the C++ path I\'d rather use Java to host a C core like lucy which brings you as close as it gets to the machine.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think this (a Java wrapper for Lucy) is a great idea &#8211; we should explore that, too.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003einteresting papers - seems we are touching the limits of Java though.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWell that\'s the big question &#8211; limits of Java or limit\'s of Sun\\/Oracle\'s impl.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks like harmony has a ways to go on absolute performance: I just\u003cbr\\/\u003e\\nran a very quick benchmark (TermQuery search on 10 M multi-segment\u003cbr\\/\u003e\\nwiki index w\\/ a 50% random filter) and Oracle java 1.6.0_21 gets 15.6\u003cbr\\/\u003e\\nQPS while Harmony 1.5.0-r946978 gets 9.5 QPS (Harmony 1.6.0-r946981\u003cbr\\/\u003e\\nalso gets 9.5 QPS).  I just ran java -server -Xms2g -Xmx2g; it\'s\u003cbr\\/\u003e\\npossible by tuning Harmony (it has many awesome looking command-line\u003cbr\\/\u003e\\nargs!) it\'d get faster...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12909337_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909337_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 17:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T17:10:58+0000\'\u003e14\\/Sep\\/10 17:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I think we all owe it to ourselves to stop equating java with Oracle, if Java  \\nstays with Oracle its pretty obvious the language (is) will die anyway.  \\n\\n Yeah I agree. \\n\\n The open question is whether this hotspot fickleness is particular to \\nOracle\'s java impl, or, is somehow endemic to bytecode VMs (.NET \\nincluded).  It\'s really a hard, complex problem (JIT compilation from \\nbytecode based on runtime data), so it wouldn\'t surprise me if it\'s \\nthe latter, to varying degrees. \\n\\n  .NET is not a choice but generating C\\/C++ code is?  \\n\\n As far as I know it\'s much easier to invoke C\\/C++ from java, than .NET \\nfrom java.  C\\/C++ is also more portable than .NET, I think?  (There is \\nMono &#8211; how mature is it by now?). \\n\\n \\n I don\'t think we should jump the gun and make real design\\/architectural \\nchoices based on Oracle bugs.  \\n\\n I expect source code spec will also buy sizable perf gains \\nirrespective of hotspot fickleness, and in non-Oracle java impls. \\nGenerating a dedicated class, with one method doing all searching and \\ncollecting, removes all kinds of barriers to the JIT compiler.  It \\nmakes its job far easier. \\n\\n  I agree with robert that we should stop comparing against sun jvms all the time and turn everything upside-down specializing code here and there or go one step further and generate C++ code. Dude who is gonna maintain the compatibility to Java-Only environments?  \\n\\n If we manage to pursue specialized code gen, it\'ll be a loooong time \\ncoming!  My point about C\\/C++ is that if we do somehow manage to get a \\nworking code gen framework online (for Java), the added cost to make \\nit also target C\\/C++ will be \\\"relatively\\\" small.  Ie, it\'s nearly \\\"for \\nfree\\\". \\n\\n If we were do to this, that would not mean we\'d abandon java, of \\ncourse &#8211; the framework would fully support \\\"pure java\\\" as well. \\n\\n  I think that code specializations of very \\\"hot\\\" part of lucene are ok and we should follow that way like we did at some places but it already make things very complicated to follow.   \\n\\n You mean manual specialization right (like this issue)? \\n\\n Yes, I think we will have to keep manually specializing, going \\nforward, until we can have code generator that \\ndoes it more cleanly... \\n\\n  Would it make way more sense to push OSS JVMs than spending lots of time on investigating on .NET as an alternative or C\\/C++ code generator?  \\n\\n I think we should do both. \\n\\n  Before I would go the C++ path I\'d rather use Java to host a C core like lucy which brings you as close as it gets to the machine.  \\n\\n I think this (a Java wrapper for Lucy) is a great idea &#8211; we should explore that, too. \\n\\n  interesting papers - seems we are touching the limits of Java though.  \\n\\n Well that\'s the big question &#8211; limits of Java or limit\'s of Sun\\/Oracle\'s impl. \\n\\n It looks like harmony has a ways to go on absolute performance: I just \\nran a very quick benchmark (TermQuery search on 10 M multi-segment \\nwiki index w\\/ a 50% random filter) and Oracle java 1.6.0_21 gets 15.6 \\nQPS while Harmony 1.5.0-r946978 gets 9.5 QPS (Harmony 1.6.0-r946981 \\nalso gets 9.5 QPS).  I just ran java -server -Xms2g -Xmx2g; it\'s \\npossible by tuning Harmony (it has many awesome looking command-line \\nargs!) it\'d get faster...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909339\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909339&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909339\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12909339_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909339_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 17:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T17:13:29+0000\'\u003e14\\/Sep\\/10 17:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eYes, but FieldValueHitQueue has it\'s own list of comparators that never get updated.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eUgh, yes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12909339_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909339_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 17:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T17:13:29+0000\'\u003e14\\/Sep\\/10 17:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Yes, but FieldValueHitQueue has it\'s own list of comparators that never get updated.  \\n\\n Ugh, yes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909407\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909407&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909407\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909407_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909407_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 19:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T19:40:45+0000\'\u003e14\\/Sep\\/10 19:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 15\\/Sep\\/10 13:00\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe open question is whether this hotspot fickleness is particular to Oracle\'s java impl, or, is somehow endemic to bytecode VMs (.NET included).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI tried IBM\'s latest Java6 (SR8 FP1, 20100624)\u003cbr\\/\u003e\\nIt seems to have some of the same pitfalls as Oracle\'s JVM, just different.\u003cbr\\/\u003e\\nThe first run does not differ from the second run in the same JVM as it does with Oracle, but the first run itself has much more variation.  The worst case is worse, and just like the Oracle JVM, it gets stuck in it\'s worst case.\u003c\\/p\u003e\\n\\n\u003cp\u003eEach run (of the complete set of fields) in a separate JVM since two runs in the same JVM didn\'t really differ as they did in the oracle JVM.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003ebranch_3x:\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunique terms in field\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003emedian sort time of 100 sorts in ms\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e129\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e130\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e109\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e98\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e135\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e123\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e127\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e127\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e98\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e135\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e129\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e130\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e130\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e98\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e130\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e136\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e133\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e133\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e130\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e132\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e139\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e150\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e153\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e153\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e154\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e122\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e153\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e159\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003etrunk:\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunique terms in field\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003emedian sort time of 100 sorts in ms\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003eanother run\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e217\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e81\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e383\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e99\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e79\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e78\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e215\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e254\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e73\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e346\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e101\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e106\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e108\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e267\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1000\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e253\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e74\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e347\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e99\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e107\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e108\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e258\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e253\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e107\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e394\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e98\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e107\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e102\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e255\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e251\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e107\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e388\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e99\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e106\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e98\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e257\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eThe second way of testing is to completely mix fields (no serial correlation between what field is sorted on).  This is the test that is very predictable with the Oracle JVM, but I still see wide variability with the IBM JVM.  Here is the list of different runs for the IBM JVM (ms):\u003c\\/p\u003e\\n\\n\u003cp\u003ebranch_3x\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e129\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e123\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e120\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e128\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e100\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e95\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e74\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e130\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e91\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e120\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003etrunk\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e106\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e89\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e168\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e116\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e155\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e119\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e108\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e118\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e112\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e169\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e165\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eTo my eye, it looks like we have more variability in trunk, due to increased use of abstractions?\u003c\\/p\u003e\\n\\n\u003cp\u003eedit: corrected the table description - all times in this message are for the IBM JVM.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909407_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909407_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 19:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T19:40:45+0000\'\u003e14\\/Sep\\/10 19:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 15\\/Sep\\/10 13:00\\\"\u003eedited\u003c\\/span\u003e                    The open question is whether this hotspot fickleness is particular to Oracle\'s java impl, or, is somehow endemic to bytecode VMs (.NET included).  \\n\\n I tried IBM\'s latest Java6 (SR8 FP1, 20100624) \\nIt seems to have some of the same pitfalls as Oracle\'s JVM, just different. \\nThe first run does not differ from the second run in the same JVM as it does with Oracle, but the first run itself has much more variation.  The worst case is worse, and just like the Oracle JVM, it gets stuck in it\'s worst case. \\n\\n Each run (of the complete set of fields) in a separate JVM since two runs in the same JVM didn\'t really differ as they did in the oracle JVM. \\n\\n\\n branch_3x: \\n \\n  \\n \\n unique terms in field \\n median sort time of 100 sorts in ms \\n another run \\n another run \\n another run \\n another run \\n another run \\n another run \\n \\n \\n 100000 \\n 129 \\n 128 \\n 130 \\n 109 \\n 98 \\n 128 \\n 135 \\n \\n \\n 10000 \\n 128 \\n 123 \\n 127 \\n 127 \\n 98 \\n 128 \\n 135 \\n \\n \\n 1000 \\n 129 \\n 130 \\n 130 \\n 128 \\n 98 \\n 130 \\n 136 \\n \\n \\n 100 \\n 128 \\n 133 \\n 133 \\n 130 \\n 100 \\n 132 \\n 139 \\n \\n \\n 10 \\n 150 \\n 153 \\n 153 \\n 154 \\n 122 \\n 153 \\n 159 \\n \\n  \\n \\n\\n\\n trunk: \\n \\n  \\n \\n unique terms in field \\n median sort time of 100 sorts in ms \\n another run \\n another run \\n another run \\n another run \\n another run \\n another run \\n \\n \\n 100000 \\n 217 \\n 81 \\n 383 \\n 99 \\n 79 \\n 78 \\n 215 \\n \\n \\n 10000 \\n 254 \\n 73 \\n 346 \\n 101 \\n 106 \\n 108 \\n 267 \\n \\n \\n 1000 \\n 253 \\n 74 \\n 347 \\n 99 \\n 107 \\n 108 \\n 258 \\n \\n \\n 100 \\n 253 \\n 107 \\n 394 \\n 98 \\n 107 \\n 102 \\n 255 \\n \\n \\n 10 \\n 251 \\n 107 \\n 388 \\n 99 \\n 106 \\n 98 \\n 257 \\n \\n  \\n \\n\\n\\n The second way of testing is to completely mix fields (no serial correlation between what field is sorted on).  This is the test that is very predictable with the Oracle JVM, but I still see wide variability with the IBM JVM.  Here is the list of different runs for the IBM JVM (ms): \\n\\n branch_3x \\n \\n  \\n \\n 128 \\n 129 \\n 123 \\n 120 \\n 128 \\n 100 \\n 95 \\n 74 \\n 130 \\n 91 \\n 120 \\n \\n  \\n \\n\\n\\n trunk \\n \\n  \\n \\n 106 \\n 89 \\n 168 \\n 116 \\n 155 \\n 119 \\n 108 \\n 118 \\n 112 \\n 169 \\n 165 \\n \\n  \\n \\n\\n\\n To my eye, it looks like we have more variability in trunk, due to increased use of abstractions? \\n\\n edit: corrected the table description - all times in this message are for the IBM JVM.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909456\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909456&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909456\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909456_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909456_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 21:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T21:09:02+0000\'\u003e14\\/Sep\\/10 21:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, I\'ve committed the fix to always use the latest generation field comparator.\u003cbr\\/\u003e\\nNot sure if this is the best way to handle - but at least it\'s correct now and we can improve more later.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909456_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909456_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 21:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T21:09:02+0000\'\u003e14\\/Sep\\/10 21:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, I\'ve committed the fix to always use the latest generation field comparator. \\nNot sure if this is the best way to handle - but at least it\'s correct now and we can improve more later.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12909462\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=12909462&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12909462\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909462_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909462_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 21:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T21:26:07+0000\'\u003e14\\/Sep\\/10 21:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis was a simple attempt to try and simplify the comparators.   Static classes are used instead of inner classes.  Unfortunately, it didn\'t help the JVMs from getting stuck in badly optimized code (it was a long shot for that), but it does result in a consistent 4% speedup.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks as simple as the previous version to my eye, so I\'ll commit if there are no objections.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12909462_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12909462_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/10 21:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-14T21:26:07+0000\'\u003e14\\/Sep\\/10 21:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This was a simple attempt to try and simplify the comparators.   Static classes are used instead of inner classes.  Unfortunately, it didn\'t help the JVMs from getting stuck in badly optimized code (it was a long shot for that), but it does result in a consistent 4% speedup. \\n\\n It looks as simple as the previous version to my eye, so I\'ll commit if there are no objections.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13281794\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=13281794&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13281794\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13281794_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13281794_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/May\\/12 18:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-23T18:44:48+0000\'\u003e23\\/May\\/12 18:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eyonik, I see a bunch of commits on this issue, can we resolve this?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13281794_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13281794_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/May\\/12 18:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-23T18:44:48+0000\'\u003e23\\/May\\/12 18:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    yonik, I see a bunch of commits on this issue, can we resolve this?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13412315\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=13412315&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13412315\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13412315_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13412315_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 23:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T23:03:47+0000\'\u003e11\\/Jul\\/12 23:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebulk cleanup of 4.0-ALPHA \\/ 4.0 Jira versioning. all bulk edited issues have hoss20120711-bulk-40-change in a comment\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13412315_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13412315_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 23:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T23:03:47+0000\'\u003e11\\/Jul\\/12 23:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bulk cleanup of 4.0-ALPHA \\/ 4.0 Jira versioning. all bulk edited issues have hoss20120711-bulk-40-change in a comment              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13429706\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2504?focusedCommentId=13429706&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13429706\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13429706_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13429706_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/12 03:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-07T03:41:25+0000\'\u003e07\\/Aug\\/12 03:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ermuir20120906-bulk-40-change\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13429706_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13429706_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/12 03:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-07T03:41:25+0000\'\u003e07\\/Aug\\/12 03:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    rmuir20120906-bulk-40-change              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520244030469"> 
    <input type="hidden" title="jira.request.server.time" value="247"> 
    <input type="hidden" title="jira.request.id" value="600x94561702x6"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="6"> 
    <input type="hidden" title="db.reads.time.in.ms" value="30"> 
    <input type="hidden" title="db.conns.time.in.ms" value="36"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 600x94561702x6
	          REQUEST TIMESTAMP : [05/Mar/2018:10:00:30 +0000]
	               REQUEST TIME : 0.2470
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 6

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=25, elapsedTotal=30623113, elapsedMin=434150, elapsedMax=12556234, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=29, elapsedTotal=36112377, elapsedMin=455783, elapsedMax=12579047, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>