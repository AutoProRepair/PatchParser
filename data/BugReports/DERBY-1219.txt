<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|ceec4dd5f55bb08b7df8872f15570938906b364b|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"f53bfcbd831e44\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-1219"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-1219] jdbcapi/checkDataSource.java and jdbcapi/checkDataSource30.java hang intermittently with client - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-1219] jdbcapi/checkDataSource.java and jdbcapi/checkDataSource30.java hang intermittently with client - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-1219">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-1219" href="/jira/browse/DERBY-1219" id="key-val" rel="12332120">DERBY-1219</a></li>
                </ol>
                <h1 id="summary-val">jdbcapi/checkDataSource.java and jdbcapi/checkDataSource30.java hang intermittently with client</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-1219"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-1219/DERBY-1219.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-1219/DERBY-1219.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-1219/DERBY-1219.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-1219/DERBY-1219.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/minor.svg" title="Minor - Minor loss of function, or other problem where easy workaround is present." width="16"> Minor </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.2.1.6 ">10.2.1.6</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.2.1.6" title="10.2.1.6 ">10.2.1.6</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+%22Network+Client%22" title="Network Client ">Network Client</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+%22Network+Server%22" title="Network Server ">Network Server</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12332120-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     More often on jdk 1.5 or jdk 1.6 but hangs on jdk 1.4.2 as well 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>The tests checkDataSource.java and checkDataSource30.java <br> hang intermittently especially with jdk 1.5.</p> 
                  <p>Attached is the test run output and traces when the server is started separately.</p> 
                  <p>1) Enable checkDataSource30.java by taking it out of functionTests/suites/DerbyNetClient.exclude.</p> 
                  <p>2) Run the test with client.<br> java -Dij.exceptionTrace=true -Dkeepfiles=true -Dframework=DerbyNetClient org.apache.derbyTesting.functionTests.harness.RunTest jdbcapi/checkDataSource30.java</p> 
                  <p>Attachements:<br> testfiles_after_hang.zip - Test directory.</p> 
                  <p> traces_on_hang.txt - Server side traces obtained by starting the server separately before running the test.</p> 
                  <p>I wish I had time to work on this right now as I would really like to see this valuable test in the suite, but hopefully someone else will pick it up.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-1219?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-1219?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-1219?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-1219?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326213" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326213/client_stack_trace_050306.txt" draggable="true" data-downloadurl="text/plain:client_stack_trace_050306.txt:https://issues.apache.org/jira/secure/attachment/12326213/client_stack_trace_050306.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326213/client_stack_trace_050306.txt" title="Latest  04/May/06 02:41 - Deepa Remesh" draggable="true" data-downloadurl="text/plain:client_stack_trace_050306.txt:https://issues.apache.org/jira/secure/attachment/12326213/client_stack_trace_050306.txt">client_stack_trace_050306.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-04T02:41:33.000Z">04/May/06 02:41</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Deepa Remesh
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12331939" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12331939/derby-1219-enable-tests.diff" draggable="true" data-downloadurl="text/x-diff:derby-1219-enable-tests.diff:https://issues.apache.org/jira/secure/attachment/12331939/derby-1219-enable-tests.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12331939/derby-1219-enable-tests.diff" title="Latest  16/May/06 05:44 - Deepa Remesh" draggable="true" data-downloadurl="text/x-diff:derby-1219-enable-tests.diff:https://issues.apache.org/jira/secure/attachment/12331939/derby-1219-enable-tests.diff">derby-1219-enable-tests.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-16T05:44:09.000Z">16/May/06 05:44</time>
                   </dd>
                   <dd class="attachment-size">
                    22 kB
                   </dd>
                   <dd class="attachment-author">
                    Deepa Remesh
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12331940" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12331940/derby-1219-enable-tests.status" draggable="true" data-downloadurl="application/octet-stream:derby-1219-enable-tests.status:https://issues.apache.org/jira/secure/attachment/12331940/derby-1219-enable-tests.status"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12331940/derby-1219-enable-tests.status" title="Latest  16/May/06 05:44 - Deepa Remesh" draggable="true" data-downloadurl="application/octet-stream:derby-1219-enable-tests.status:https://issues.apache.org/jira/secure/attachment/12331940/derby-1219-enable-tests.status">derby-1219-enable-tests.status</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-16T05:44:09.000Z">16/May/06 05:44</time>
                   </dd>
                   <dd class="attachment-size">
                    0.5 kB
                   </dd>
                   <dd class="attachment-author">
                    Deepa Remesh
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326249" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326249/drda_traces_050206.zip" draggable="true" data-downloadurl="application/zip:drda_traces_050206.zip:https://issues.apache.org/jira/secure/attachment/12326249/drda_traces_050206.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-zip" title="Zip Archive"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326249/drda_traces_050206.zip" title="Latest  04/May/06 21:49 - Deepa Remesh" draggable="true" data-downloadurl="application/zip:drda_traces_050206.zip:https://issues.apache.org/jira/secure/attachment/12326249/drda_traces_050206.zip">drda_traces_050206.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-04T21:49:20.000Z">04/May/06 21:49</time>
                   </dd>
                   <dd class="attachment-size">
                    89 kB
                   </dd>
                   <dd class="attachment-author">
                    Deepa Remesh
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326360" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326360/interrupt.diff" draggable="true" data-downloadurl="application/octet-stream:interrupt.diff:https://issues.apache.org/jira/secure/attachment/12326360/interrupt.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326360/interrupt.diff" title="Latest  07/May/06 22:31 - Bryan Pendleton" draggable="true" data-downloadurl="application/octet-stream:interrupt.diff:https://issues.apache.org/jira/secure/attachment/12326360/interrupt.diff">interrupt.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-07T22:31:54.000Z">07/May/06 22:31</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326498" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326498/no-sessions-for-closed-threads.diff" draggable="true" data-downloadurl="application/octet-stream:no-sessions-for-closed-threads.diff:https://issues.apache.org/jira/secure/attachment/12326498/no-sessions-for-closed-threads.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326498/no-sessions-for-closed-threads.diff" title="Latest  10/May/06 11:30 - Bryan Pendleton" draggable="true" data-downloadurl="application/octet-stream:no-sessions-for-closed-threads.diff:https://issues.apache.org/jira/secure/attachment/12326498/no-sessions-for-closed-threads.diff">no-sessions-for-closed-threads.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-10T11:30:51.000Z">10/May/06 11:30</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326214" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326214/server_stack_trace_050306.txt" draggable="true" data-downloadurl="text/plain:server_stack_trace_050306.txt:https://issues.apache.org/jira/secure/attachment/12326214/server_stack_trace_050306.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326214/server_stack_trace_050306.txt" title="Latest  04/May/06 02:41 - Deepa Remesh" draggable="true" data-downloadurl="text/plain:server_stack_trace_050306.txt:https://issues.apache.org/jira/secure/attachment/12326214/server_stack_trace_050306.txt">server_stack_trace_050306.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-04T02:41:33.000Z">04/May/06 02:41</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Deepa Remesh
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326359" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326359/skipThreads.diff" draggable="true" data-downloadurl="application/octet-stream:skipThreads.diff:https://issues.apache.org/jira/secure/attachment/12326359/skipThreads.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326359/skipThreads.diff" title="Latest  07/May/06 22:31 - Bryan Pendleton" draggable="true" data-downloadurl="application/octet-stream:skipThreads.diff:https://issues.apache.org/jira/secure/attachment/12326359/skipThreads.diff">skipThreads.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-07T22:31:54.000Z">07/May/06 22:31</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Bryan Pendleton
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12325329" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12325329/testfiles_afterhang.zip" draggable="true" data-downloadurl="application/zip:testfiles_afterhang.zip:https://issues.apache.org/jira/secure/attachment/12325329/testfiles_afterhang.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-zip" title="Zip Archive"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12325329/testfiles_afterhang.zip" title="Latest  14/Apr/06 10:12 - Kathey Marsden" draggable="true" data-downloadurl="application/zip:testfiles_afterhang.zip:https://issues.apache.org/jira/secure/attachment/12325329/testfiles_afterhang.zip">testfiles_afterhang.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-04-14T10:12:37.000Z">14/Apr/06 10:12</time>
                   </dd>
                   <dd class="attachment-size">
                    67 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12325330" data-issue-id="12332120" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12325330/traces_on_hang.txt" draggable="true" data-downloadurl="text/plain:traces_on_hang.txt:https://issues.apache.org/jira/secure/attachment/12325330/traces_on_hang.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12325330/traces_on_hang.txt" title="Latest  14/Apr/06 10:15 - Kathey Marsden" draggable="true" data-downloadurl="text/plain:traces_on_hang.txt:https://issues.apache.org/jira/secure/attachment/12325330/traces_on_hang.txt">traces_on_hang.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-04-14T10:15:27.000Z">14/Apr/06 10:15</time>
                   </dd>
                   <dd class="attachment-size">
                    14 kB
                   </dd>
                   <dd class="attachment-author">
                    Kathey Marsden
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_deepa" rel="deepa" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=34050&quot;,&quot;displayName&quot;:&quot;Deepa Remesh&quot;,&quot;emailAddress&quot;:&quot;dremesh@gmail.com&quot;,&quot;username&quot;:&quot;deepa&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=34050" alt="deepa"></span></span> Deepa Remesh </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_kmarsden" rel="kmarsden" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Kathey Marsden&quot;,&quot;emailAddress&quot;:&quot;kmarsdenderby@sbcglobal.net&quot;,&quot;username&quot;:&quot;kmarsden&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="kmarsden"></span></span> Kathey Marsden </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="14/Apr/06 10:11"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2006-04-14T10:11:22+0000">14/Apr/06 10:11</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="01/Jul/09 00:13"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2009-07-01T00:13:01+0000">01/Jul/09 00:13</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="16/May/06 06:36"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2006-05-16T06:36:41+0000">16/May/06 06:36</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-1219?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-1219?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12374454\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12374454&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12374454\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12374454_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12374454_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/06 10:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-14T10:12:37+0000\'\u003e14\\/Apr\\/06 10:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003etest output after hang.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12374454_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12374454_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/06 10:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-14T10:12:37+0000\'\u003e14\\/Apr\\/06 10:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    test output after hang.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12374456\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12374456&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12374456\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12374456_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12374456_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/06 10:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-14T10:15:27+0000\'\u003e14\\/Apr\\/06 10:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eserver side stack traces on hang.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12374456_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12374456_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/06 10:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-14T10:15:27+0000\'\u003e14\\/Apr\\/06 10:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    server side stack traces on hang.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12376347\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12376347&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12376347\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12376347_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12376347_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/06 04:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-26T04:55:54+0000\'\u003e26\\/Apr\\/06 04:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1148\\\" title=\\\"Client XA getTransactionIsolation()   does not return the correct isolation level when rejoining a global transaction\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1148\\\"\u003e\u003cdel\u003eDERBY-1148\u003c\\/del\u003e\u003c\\/a\u003e, I was trying to run checkDataSource test with client to repro the issue. I am getting the hang reported by Kathey almost all the time. So I looked into the hang and narrowed it down to this - The hang is occuring in ClientDataSource.getConnection method at this line: return ClientDriver.getFactory().newNetConnection((NetLogWriter) dncLogWriter, user, password, this, -1, false); \u003cbr\\/\u003e\\nIt looks like it is hanging in the method NetConnection.flowServerAttributesAndKeyExchange. I tried to capture server traces but running few times with trace on did not produce the hang for me. I\'ll be working with this test some more and will update if I get any info. If anyone else gets any clues as to what could be wrong, please post it.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12376347_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12376347_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/06 04:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-26T04:55:54+0000\'\u003e26\\/Apr\\/06 04:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For   DERBY-1148  , I was trying to run checkDataSource test with client to repro the issue. I am getting the hang reported by Kathey almost all the time. So I looked into the hang and narrowed it down to this - The hang is occuring in ClientDataSource.getConnection method at this line: return ClientDriver.getFactory().newNetConnection((NetLogWriter) dncLogWriter, user, password, this, -1, false);  \\nIt looks like it is hanging in the method NetConnection.flowServerAttributesAndKeyExchange. I tried to capture server traces but running few times with trace on did not produce the hang for me. I\'ll be working with this test some more and will update if I get any info. If anyone else gets any clues as to what could be wrong, please post it. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377616\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12377616&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377616\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12377616_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377616_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 02:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T02:41:33+0000\'\u003e04\\/May\\/06 02:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI talked to Kathey about this issue on IRC and she suggested trying this test outside the harness. I could repro it outside the harness too and I am attaching the stack traces from the client and the server (client_stack_trace_050306.txt, server_stack_trace_050306.txt) . From the trace and from the debugging I did with a few print statements, I think this is what is happening in the test:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFor getting a new connection, client sends EXCSAT and ACCSEC to the server. Then, client waits for the response from the server for these commands. In all the test runs, I found the hang always happens in this request from the client sent as part of getConnection method.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAt the server, it tries to read the data from the client and does not get any data in DDMReader.fill. So the server thinks the client has disconnected and ends the connection thread.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eClient does not get back any response as server has ended the connection thread. Thus the client is blocked trying to read the input stream.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI have not yet figured out the reason for this miscommunication between server and client. I would appreciate if someone can also go through the traces and confirm my analysis is correct.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12377616_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377616_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 02:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T02:41:33+0000\'\u003e04\\/May\\/06 02:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I talked to Kathey about this issue on IRC and she suggested trying this test outside the harness. I could repro it outside the harness too and I am attaching the stack traces from the client and the server (client_stack_trace_050306.txt, server_stack_trace_050306.txt) . From the trace and from the debugging I did with a few print statements, I think this is what is happening in the test: \\n\\n \\n\\t For getting a new connection, client sends EXCSAT and ACCSEC to the server. Then, client waits for the response from the server for these commands. In all the test runs, I found the hang always happens in this request from the client sent as part of getConnection method. \\n \\n\\n\\n \\n\\t At the server, it tries to read the data from the client and does not get any data in DDMReader.fill. So the server thinks the client has disconnected and ends the connection thread. \\n \\n\\n\\n \\n\\t Client does not get back any response as server has ended the connection thread. Thus the client is blocked trying to read the input stream. \\n \\n\\n\\n I have not yet figured out the reason for this miscommunication between server and client. I would appreciate if someone can also go through the traces and confirm my analysis is correct.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377671\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12377671&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377671\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12377671_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377671_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 08:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T08:05:01+0000\'\u003e04\\/May\\/06 08:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Deepa,\u003c\\/p\u003e\\n\\n\u003cp\u003eCan you get the DRDA trace files for the hang? I.e., set traceDirectory on the client and derby.drda.traceAll on the server, as described in the Protocol Tracing section of  \u003ca href=\\\"http:\\/\\/wiki.apache.org\\/db-derby\\/ProtocolDebuggingTips\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/wiki.apache.org\\/db-derby\\/ProtocolDebuggingTips\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12377671_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377671_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 08:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T08:05:01+0000\'\u003e04\\/May\\/06 08:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Deepa, \\n\\n Can you get the DRDA trace files for the hang? I.e., set traceDirectory on the client and derby.drda.traceAll on the server, as described in the Protocol Tracing section of   http:\\/\\/wiki.apache.org\\/db-derby\\/ProtocolDebuggingTips               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377814\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12377814&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377814\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12377814_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377814_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 21:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T21:49:20+0000\'\u003e04\\/May\\/06 21:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Bryan. I am glad that you are looking at this issue. Hopefully we can narrow this down quickly with your DRDA expertise. I am attaching the client and server DRDA traces that I had captured previously when I ran the test inside the harness. You may find some traces which start with \\\"\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1219\\\" title=\\\"jdbcapi\\/checkDataSource.java and jdbcapi\\/checkDataSource30.java hang intermittently with client\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1219\\\"\u003e\u003cdel\u003eDERBY-1219\u003c\\/del\u003e\u003c\\/a\u003e\\\" which I had added for some debugging. Please ignore these. If needed, I can try to capture fresh traces and upload them.\u003c\\/p\u003e\\n\\n\u003cp\u003eI had let the test run for a long time. At the end of the test I killed network server and this accounts for the last DisconnectException seen in client_trace.txt_sds_1. To me, it looked like the client was hanging after sending EXCSAT and ACCSEC whereas network server was idle. \u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12377814_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377814_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 21:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T21:49:20+0000\'\u003e04\\/May\\/06 21:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Bryan. I am glad that you are looking at this issue. Hopefully we can narrow this down quickly with your DRDA expertise. I am attaching the client and server DRDA traces that I had captured previously when I ran the test inside the harness. You may find some traces which start with \\\"  DERBY-1219  \\\" which I had added for some debugging. Please ignore these. If needed, I can try to capture fresh traces and upload them. \\n\\n I had let the test run for a long time. At the end of the test I killed network server and this accounts for the last DisconnectException seen in client_trace.txt_sds_1. To me, it looked like the client was hanging after sending EXCSAT and ACCSEC whereas network server was idle.  \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378038\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378038&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378038\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378038_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378038_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 21:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T21:03:16+0000\'\u003e05\\/May\\/06 21:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Deepa, nothing obvious has jumped out at me yet, but I will keep looking. Three questions:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) You said you were able to reproduce this outside the harness; can you post a brief description of the steps, so that I can experiment with the code in my environment?\u003cbr\\/\u003e\\n2) Were you running with sane=true, or sane=false? If sane=false, can you try sane=true?\u003cbr\\/\u003e\\n3) You mentioned that the server does not get any data in DDMReader.fill, and thinks the client has disconnected. Can you expand on how you came to that conclusion? Were you able to see an IOException being thrown? Can you get a dump of that exception? After the exception has been thrown (i.e., during the hang), does netstat think that there is still an active TCP\\/IP connection between the client and the server?\u003c\\/p\u003e\\n\\n\u003cp\u003ethanks, bryan\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378038_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378038_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 21:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T21:03:16+0000\'\u003e05\\/May\\/06 21:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Deepa, nothing obvious has jumped out at me yet, but I will keep looking. Three questions: \\n\\n 1) You said you were able to reproduce this outside the harness; can you post a brief description of the steps, so that I can experiment with the code in my environment? \\n2) Were you running with sane=true, or sane=false? If sane=false, can you try sane=true? \\n3) You mentioned that the server does not get any data in DDMReader.fill, and thinks the client has disconnected. Can you expand on how you came to that conclusion? Were you able to see an IOException being thrown? Can you get a dump of that exception? After the exception has been thrown (i.e., during the hang), does netstat think that there is still an active TCP\\/IP connection between the client and the server? \\n\\n thanks, bryan              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378079\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378079&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378079\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378079_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378079_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/06 00:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-06T00:34:24+0000\'\u003e06\\/May\\/06 00:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Bryan,\u003c\\/p\u003e\\n\\n\u003cp\u003eHere are the answers to your questions:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) You said you were able to reproduce this outside the harness; can you post a brief description of the steps, so that I can experiment with the code in my environment?\u003c\\/p\u003e\\n\\n\u003cp\u003eTo run the test jdbcapi\\/checkDataSource.java without using the test harness, I started network server and then used the following command to run the test:  \u003cbr\\/\u003e\\njava -Dderby.system.home=C:\\\\deepa\\\\Derby\\\\derby_testing\\\\nwserver -Dframework=DerbyNetClient -Dij.database=jdbc:derby:\\/\\/localhost:1527\\/wombat;create=true org.apache.derbyTesting.functionTests.tests.jdbcapi.checkDataSource\u003c\\/p\u003e\\n\\n\u003cp\u003eThe test hangs intermittently and the place where the test hangs is in one of the getConnection methods. The hang location varies in different runs but is always in the getConnection method. I can repro it quite easily (~ 1 out of 5 runs hang) on my machine. I hope you are able to repro it too.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) Were you running with sane=true, or sane=false? If sane=false, can you try sane=true?\u003c\\/p\u003e\\n\\n\u003cp\u003eI was running with sane=true. The debug output can be seen in the derby.log in the attached zip file (drda_traces_050206.zip)\u003c\\/p\u003e\\n\\n\u003cp\u003e3) You mentioned that the server does not get any data in DDMReader.fill, and thinks the client has disconnected. Can you expand on how you came to that conclusion? Were you able to see an IOException being thrown? Can you get a dump of that exception? After the exception has been thrown (i.e., during the hang), does netstat think that there is still an active TCP\\/IP connection between the client and the server? \u003c\\/p\u003e\\n\\n\u003cp\u003eI was looking at the server debug trace from a normal run (without hang) and when the test hangs. On comparing both and also looking at the client and server traces, I found the following from the trace files:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eClient trace stops with send of EXCSAT and ACCSEC (client_trace.txt_sds_1)\u003c\\/li\u003e\\n\\t\u003cli\u003eAt the server side, I can see an empty trace file is created but cannot see the EXCSAT and ACCSEC as the last entries in any trace file (Server10.trace, Server9.trace)\u003c\\/li\u003e\\n\\t\u003cli\u003eIn the debug trace of server, the last trace is \\\"Ending connection thread\\\". I added few other traces in DDMReader.fill and DRDAConnThread.run  and found that server is actually reaching the end of the input stream (actualBytesRead == -1) without reading any data (totalBytesRead is 0) and hence calls \\\"agent.markCommunicationsFailure (\\\"DDMReader.fill()\\\", \\\"InputStream.read()\\\", \\\"insufficient data\\\", \\\"*\\\");\\\" The connection thread catches this disconnect exception and exits normally thinking the client has disconnected. The debug traces from a successful run show  that network server starts a new connection thread at this point.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eFrom the above, I thought of following possibilities:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eserver is not getting a set of data from the client. data is lost. this looks unlikely\u003c\\/li\u003e\\n\\t\u003cli\u003eserver thread is reading a wrong stream (from an already closed connection) and thinking the client does not have more data and that it has disconnected.\u003c\\/li\u003e\\n\\t\u003cli\u003esession state associated with the server thread is wrong. Instead of starting new session, server is thinking it has an active session and tries to process commands for the active session\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI am just throwing in some ideas which come to me and could be totally off here. I plan to look at this some more and will post if I find something else.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are no IOExceptions at server or client. The IO exception seen in the client trace file (client_trace.txt_sds_1) is because I killed network server after the test was hanging for a long time. This was just to reconfirm where the client is hanging. \u003c\\/p\u003e\\n\\n\u003cp\u003eIn netstat output, I can see listening and established statuses for both client and server process during the hang. \u003c\\/p\u003e\\n\\n\u003cp\u003eOuput of runtimeinfo command: \u003cbr\\/\u003e\\n&#8212; Derby Network Server Runtime Information &#8212;\u003cbr\\/\u003e\\n---------- Session Information ---------------\u003cbr\\/\u003e\\nSession # :10\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e-------------------------------------------------------------\u003c\\/p\u003e\\n\u003col\u003e\\n\\t\u003cli\u003eConnection Threads : 2\u003c\\/li\u003e\\n\\t\u003cli\u003eActive Sessions : 1\u003c\\/li\u003e\\n\\t\u003cli\u003eWaiting  Sessions : 0\u003c\\/li\u003e\\n\u003c\\/ol\u003e\\n\\n\\n\u003cp\u003eTotal Memory : 3694592  Free Memory : 2649768\u003c\\/p\u003e\\n\\n\u003cp\u003eHope this helps.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378079_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378079_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/06 00:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-06T00:34:24+0000\'\u003e06\\/May\\/06 00:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Bryan, \\n\\n Here are the answers to your questions: \\n\\n 1) You said you were able to reproduce this outside the harness; can you post a brief description of the steps, so that I can experiment with the code in my environment? \\n\\n To run the test jdbcapi\\/checkDataSource.java without using the test harness, I started network server and then used the following command to run the test:   \\njava -Dderby.system.home=C:\\\\deepa\\\\Derby\\\\derby_testing\\\\nwserver -Dframework=DerbyNetClient -Dij.database=jdbc:derby:\\/\\/localhost:1527\\/wombat;create=true org.apache.derbyTesting.functionTests.tests.jdbcapi.checkDataSource \\n\\n The test hangs intermittently and the place where the test hangs is in one of the getConnection methods. The hang location varies in different runs but is always in the getConnection method. I can repro it quite easily (~ 1 out of 5 runs hang) on my machine. I hope you are able to repro it too. \\n\\n 2) Were you running with sane=true, or sane=false? If sane=false, can you try sane=true? \\n\\n I was running with sane=true. The debug output can be seen in the derby.log in the attached zip file (drda_traces_050206.zip) \\n\\n 3) You mentioned that the server does not get any data in DDMReader.fill, and thinks the client has disconnected. Can you expand on how you came to that conclusion? Were you able to see an IOException being thrown? Can you get a dump of that exception? After the exception has been thrown (i.e., during the hang), does netstat think that there is still an active TCP\\/IP connection between the client and the server?  \\n\\n I was looking at the server debug trace from a normal run (without hang) and when the test hangs. On comparing both and also looking at the client and server traces, I found the following from the trace files: \\n \\n\\t Client trace stops with send of EXCSAT and ACCSEC (client_trace.txt_sds_1) \\n\\t At the server side, I can see an empty trace file is created but cannot see the EXCSAT and ACCSEC as the last entries in any trace file (Server10.trace, Server9.trace) \\n\\t In the debug trace of server, the last trace is \\\"Ending connection thread\\\". I added few other traces in DDMReader.fill and DRDAConnThread.run  and found that server is actually reaching the end of the input stream (actualBytesRead == -1) without reading any data (totalBytesRead is 0) and hence calls \\\"agent.markCommunicationsFailure (\\\"DDMReader.fill()\\\", \\\"InputStream.read()\\\", \\\"insufficient data\\\", \\\"*\\\");\\\" The connection thread catches this disconnect exception and exits normally thinking the client has disconnected. The debug traces from a successful run show  that network server starts a new connection thread at this point. \\n \\n\\n\\n From the above, I thought of following possibilities: \\n \\n\\t server is not getting a set of data from the client. data is lost. this looks unlikely \\n\\t server thread is reading a wrong stream (from an already closed connection) and thinking the client does not have more data and that it has disconnected. \\n\\t session state associated with the server thread is wrong. Instead of starting new session, server is thinking it has an active session and tries to process commands for the active session \\n \\n\\n\\n I am just throwing in some ideas which come to me and could be totally off here. I plan to look at this some more and will post if I find something else. \\n\\n There are no IOExceptions at server or client. The IO exception seen in the client trace file (client_trace.txt_sds_1) is because I killed network server after the test was hanging for a long time. This was just to reconfirm where the client is hanging.  \\n\\n In netstat output, I can see listening and established statuses for both client and server process during the hang.  \\n\\n Ouput of runtimeinfo command:  \\n&#8212; Derby Network Server Runtime Information &#8212; \\n---------- Session Information --------------- \\nSession # :10 \\n\\n\\n ------------------------------------------------------------- \\n \\n\\t Connection Threads : 2 \\n\\t Active Sessions : 1 \\n\\t Waiting  Sessions : 0 \\n \\n\\n\\n Total Memory : 3694592  Free Memory : 2649768 \\n\\n Hope this helps.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378175\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378175&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378175\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378175_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378175_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/06 07:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-06T07:13:32+0000\'\u003e06\\/May\\/06 07:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI forgot to mention that when I set the tracing for client, I was getting a NPE if I did not set all the ClientDataSource properties. Other option was to make a small change in client\'s LogWriter.java. I have opened \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1298\\\" title=\\\"Tracing client data source gives NPE if all data source properties are not set\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1298\\\"\u003e\u003cdel\u003eDERBY-1298\u003c\\/del\u003e\u003c\\/a\u003e for this. Just mentioning in case someone else hits the same problem when tracing the client.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378175_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378175_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/06 07:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-06T07:13:32+0000\'\u003e06\\/May\\/06 07:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I forgot to mention that when I set the tracing for client, I was getting a NPE if I did not set all the ClientDataSource properties. Other option was to make a small change in client\'s LogWriter.java. I have opened   DERBY-1298   for this. Just mentioning in case someone else hits the same problem when tracing the client.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378228\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378228&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378228\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378228_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378228_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/06 23:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-06T23:03:21+0000\'\u003e06\\/May\\/06 23:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Deepa. Thank you for the good notes. As you say:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; The test hangs intermittently and the place where the test hangs is in one of the getConnection\u003cbr\\/\u003e\\n&gt;   methods. The hang location varies in different runs but is always in the getConnection method. \u003cbr\\/\u003e\\n&gt;   I can repro it quite easily\u003c\\/p\u003e\\n\\n\u003cp\u003eI appear to be able to reproduce it quite easily, too. So that is good.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think that an interesting aspect of this test is that it creates and tears down a lot of connections\u003cbr\\/\u003e\\nin very rapid succession, and I am wondering whether there is a race condition somewhere\u003cbr\\/\u003e\\nthat is causing the code to lose track of which connection is which.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think that your analysis of the (actualBytesRead == -1) case is good, but is perhaps a red\u003cbr\\/\u003e\\nherring. I believe that this is the normal way that the server cleans up when a client\u003cbr\\/\u003e\\nconnection disconnects and goes away. So I don\'t think this is \u003cb\u003edirectly\u003c\\/b\u003e the place where things\u003cbr\\/\u003e\\nare going wrong; it\'s just evidence that the server is seeing a lot of connections come and go.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems like, at least in the cases I\'ve seen so far, the bottom line is this:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethe client believes it\'s initiated a new connection with the server\u003c\\/li\u003e\\n\\t\u003cli\u003ethe server, however, has no record of that connection, and believes it\'s cleaned up all\u003cbr\\/\u003e\\n   its connections and is idle\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eSo I think something is going wrong in the connection management code on one side or\u003cbr\\/\u003e\\nthe other.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for the great test case and set of notes; I\'ll continue to study this one some more and\u003cbr\\/\u003e\\nlet you know if I figure anything out.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378228_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378228_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/06 23:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-06T23:03:21+0000\'\u003e06\\/May\\/06 23:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Deepa. Thank you for the good notes. As you say: \\n\\n &gt; The test hangs intermittently and the place where the test hangs is in one of the getConnection \\n&gt;   methods. The hang location varies in different runs but is always in the getConnection method.  \\n&gt;   I can repro it quite easily \\n\\n I appear to be able to reproduce it quite easily, too. So that is good. \\n\\n I think that an interesting aspect of this test is that it creates and tears down a lot of connections \\nin very rapid succession, and I am wondering whether there is a race condition somewhere \\nthat is causing the code to lose track of which connection is which. \\n\\n I think that your analysis of the (actualBytesRead == -1) case is good, but is perhaps a red \\nherring. I believe that this is the normal way that the server cleans up when a client \\nconnection disconnects and goes away. So I don\'t think this is  directly  the place where things \\nare going wrong; it\'s just evidence that the server is seeing a lot of connections come and go. \\n\\n It seems like, at least in the cases I\'ve seen so far, the bottom line is this: \\n \\n\\t the client believes it\'s initiated a new connection with the server \\n\\t the server, however, has no record of that connection, and believes it\'s cleaned up all \\n   its connections and is idle \\n \\n\\n\\n So I think something is going wrong in the connection management code on one side or \\nthe other. \\n\\n Thanks for the great test case and set of notes; I\'ll continue to study this one some more and \\nlet you know if I figure anything out.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378300\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378300&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378300\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378300_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378300_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/May\\/06 22:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-07T22:31:54+0000\'\u003e07\\/May\\/06 22:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached are \\\"skipThreads.diff\\\" and \\\"interrupt.diff\\\", but before\u003cbr\\/\u003e\\nreading the diffs, please read these notes.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think I understand what is causing the hangs, and I can even make\u003cbr\\/\u003e\\nthe hangs go away. However, I don\'t think I yet understand how to\u003cbr\\/\u003e\\nreally \u003cb\u003efix\u003c\\/b\u003e the problem, so I\'m sure we\'ll want to talk about this\u003cbr\\/\u003e\\nfor a while, to see if some of the reviewers can come up with a\u003cbr\\/\u003e\\nproper solution or at least some techniques to pursue.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s what I see, and what I think it means:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) One, or maybe several, times in the test, checkDataSource causes a \u003cbr\\/\u003e\\nshutdown of the server. It has several different variants on the shutdown\u003cbr\\/\u003e\\nprocessing, but at least one of them causes the server to go through\u003cbr\\/\u003e\\nNetworkServerControlImpl.startNetworkServer() to perform a server restart.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) During the server restart processing, the Network Server restart \u003cbr\\/\u003e\\ncode iterates through all the DRDAConnThread instances and closes them. \u003cbr\\/\u003e\\nThis close() call is supposed to cause the DRDAConnThread to terminate itself.\u003c\\/p\u003e\\n\\n\u003cp\u003e3) However, all the close() call actually does is mark the thread\'s\u003cbr\\/\u003e\\n\\\"close\\\" variable as true, and depending on when the thread checks that\u003cbr\\/\u003e\\nvariable, it may or may not immediately exit. In my test runs, it is\u003cbr\\/\u003e\\noften the case that at least one of the DRDAConnThread instances is, at this\u003cbr\\/\u003e\\npoint, sitting blocked in NetworkServerControlImpl.getNextSession().\u003cbr\\/\u003e\\nCalling close() on this thread marks it as closed, but doesn\'t cause\u003cbr\\/\u003e\\nit to exit the getNextSession() wait.\u003c\\/p\u003e\\n\\n\u003cp\u003e4) A little bit later, the test program makes some new connections\u003cbr\\/\u003e\\nto the server, and one of those connections is given to the thread\u003cbr\\/\u003e\\nwhich was blocked in the getNextSession() call. The thread picks\u003cbr\\/\u003e\\nup the session and returns to the DRDAConnThread.run() main loop.\u003c\\/p\u003e\\n\\n\u003cp\u003e5) At this point, the thread notices that it has been closed, and it\u003cbr\\/\u003e\\nexits, without sending any response back to the client, and without\u003cbr\\/\u003e\\nclosing the connection to the client. This causes the hang.\u003c\\/p\u003e\\n\\n\u003cp\u003eBecause this problem involves multi-threading, and thread scheduling,\u003cbr\\/\u003e\\nthere is a bunch of non-determinate behavior, which I believe is why\u003cbr\\/\u003e\\nothers have been experiencing varied results during their tests. The\u003cbr\\/\u003e\\nbehavior of the threads is definitely unpredictable for me.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are several aspects to this scenario that puzzle me, but let\u003cbr\\/\u003e\\nme describe what I\'ve been experimenting with as a patch. I\'ve changed\u003cbr\\/\u003e\\nthe NetworkServerControlImpl restart logic so that, instead of\u003cbr\\/\u003e\\nclosing the DRDAConnThreads, it just leaves the threads alone.\u003cbr\\/\u003e\\nThis change is in \\\"skipThreads.diff\\\", and it seems to make the hangs\u003cbr\\/\u003e\\ngo away. \u003c\\/p\u003e\\n\\n\u003cp\u003eThe \\\"skipThreads.diff\\\" diff also contains some hacks to the test so\u003cbr\\/\u003e\\nthat I could run it multiple times in a row outside of the harness\u003cbr\\/\u003e\\nwithout destroying and re-creating the database each time.\u003cbr\\/\u003e\\nThose changes don\'t really belong with this diff, but I didn\'t bother\u003cbr\\/\u003e\\nto edit them out.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also experimented with a change which tried to close the threads,\u003cbr\\/\u003e\\nbut also, after closing, interrupts the threads, which\u003cbr\\/\u003e\\ncaused them to be blown out of the getNextSession loop and back to\u003cbr\\/\u003e\\nthe main run() loop, at which point the threads shut themselves down,\u003cbr\\/\u003e\\nwhich seems like the right behavior for Network Server restart. \u003c\\/p\u003e\\n\\n\u003cp\u003eI was hoping that this was the \\\"right\\\" fix, but unfortunately this\u003cbr\\/\u003e\\nchange fixed \u003cb\u003esome\u003c\\/b\u003e, but not \u003cb\u003eall\u003c\\/b\u003e, of the hangs, which was too bad.\u003cbr\\/\u003e\\nAnd I\'m nervous about adding the call to Thread.interrupt(), which is\u003cbr\\/\u003e\\nan extremely powerful call and not to be used lightly. For reviewers\u003cbr\\/\u003e\\nwho want to experiment with this change and see how it works for them,\u003cbr\\/\u003e\\nI\'ve also attached \\\"interrupt.diff\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m still disturbed by the fact that when the main run() method\u003cbr\\/\u003e\\nin DRDAConnThread noticed that it was closed, it just exited without\u003cbr\\/\u003e\\napparently sending any response back to the server or closing the\u003cbr\\/\u003e\\nsocket.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd, although my change makes the hangs go away, it does not make the\u003cbr\\/\u003e\\ncheckDataSource and checkDataSource30 tests pass. Instead, they run\u003cbr\\/\u003e\\nto completion, and get a bunch of diffs, and I\'m not sure whether my\u003cbr\\/\u003e\\nchanges caused these diffs or not.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut at this point, before I work on this much more, I\'d like to get\u003cbr\\/\u003e\\nsome feedback from the reviewers about the analysis up to this point,\u003cbr\\/\u003e\\nand the effects of this patch in their environment:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003edoes this patch cause the hangs to disappear for you?\u003c\\/li\u003e\\n\\t\u003cli\u003eif so, do the checkDataSource and checkDataSource30 tests pass for you?\u003c\\/li\u003e\\n\\t\u003cli\u003eif they fail, do the failures make sense to you?\u003c\\/li\u003e\\n\\t\u003cli\u003ewhat should we be doing with the background connection threads during\u003cbr\\/\u003e\\n   a Network Server restart?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378300_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378300_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/May\\/06 22:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-07T22:31:54+0000\'\u003e07\\/May\\/06 22:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached are \\\"skipThreads.diff\\\" and \\\"interrupt.diff\\\", but before \\nreading the diffs, please read these notes. \\n\\n I think I understand what is causing the hangs, and I can even make \\nthe hangs go away. However, I don\'t think I yet understand how to \\nreally  fix  the problem, so I\'m sure we\'ll want to talk about this \\nfor a while, to see if some of the reviewers can come up with a \\nproper solution or at least some techniques to pursue. \\n\\n Here\'s what I see, and what I think it means: \\n\\n 1) One, or maybe several, times in the test, checkDataSource causes a  \\nshutdown of the server. It has several different variants on the shutdown \\nprocessing, but at least one of them causes the server to go through \\nNetworkServerControlImpl.startNetworkServer() to perform a server restart. \\n\\n 2) During the server restart processing, the Network Server restart  \\ncode iterates through all the DRDAConnThread instances and closes them.  \\nThis close() call is supposed to cause the DRDAConnThread to terminate itself. \\n\\n 3) However, all the close() call actually does is mark the thread\'s \\n\\\"close\\\" variable as true, and depending on when the thread checks that \\nvariable, it may or may not immediately exit. In my test runs, it is \\noften the case that at least one of the DRDAConnThread instances is, at this \\npoint, sitting blocked in NetworkServerControlImpl.getNextSession(). \\nCalling close() on this thread marks it as closed, but doesn\'t cause \\nit to exit the getNextSession() wait. \\n\\n 4) A little bit later, the test program makes some new connections \\nto the server, and one of those connections is given to the thread \\nwhich was blocked in the getNextSession() call. The thread picks \\nup the session and returns to the DRDAConnThread.run() main loop. \\n\\n 5) At this point, the thread notices that it has been closed, and it \\nexits, without sending any response back to the client, and without \\nclosing the connection to the client. This causes the hang. \\n\\n Because this problem involves multi-threading, and thread scheduling, \\nthere is a bunch of non-determinate behavior, which I believe is why \\nothers have been experiencing varied results during their tests. The \\nbehavior of the threads is definitely unpredictable for me. \\n\\n There are several aspects to this scenario that puzzle me, but let \\nme describe what I\'ve been experimenting with as a patch. I\'ve changed \\nthe NetworkServerControlImpl restart logic so that, instead of \\nclosing the DRDAConnThreads, it just leaves the threads alone. \\nThis change is in \\\"skipThreads.diff\\\", and it seems to make the hangs \\ngo away.  \\n\\n The \\\"skipThreads.diff\\\" diff also contains some hacks to the test so \\nthat I could run it multiple times in a row outside of the harness \\nwithout destroying and re-creating the database each time. \\nThose changes don\'t really belong with this diff, but I didn\'t bother \\nto edit them out. \\n\\n I also experimented with a change which tried to close the threads, \\nbut also, after closing, interrupts the threads, which \\ncaused them to be blown out of the getNextSession loop and back to \\nthe main run() loop, at which point the threads shut themselves down, \\nwhich seems like the right behavior for Network Server restart.  \\n\\n I was hoping that this was the \\\"right\\\" fix, but unfortunately this \\nchange fixed  some , but not  all , of the hangs, which was too bad. \\nAnd I\'m nervous about adding the call to Thread.interrupt(), which is \\nan extremely powerful call and not to be used lightly. For reviewers \\nwho want to experiment with this change and see how it works for them, \\nI\'ve also attached \\\"interrupt.diff\\\" \\n\\n I\'m still disturbed by the fact that when the main run() method \\nin DRDAConnThread noticed that it was closed, it just exited without \\napparently sending any response back to the server or closing the \\nsocket. \\n\\n And, although my change makes the hangs go away, it does not make the \\ncheckDataSource and checkDataSource30 tests pass. Instead, they run \\nto completion, and get a bunch of diffs, and I\'m not sure whether my \\nchanges caused these diffs or not. \\n\\n But at this point, before I work on this much more, I\'d like to get \\nsome feedback from the reviewers about the analysis up to this point, \\nand the effects of this patch in their environment: \\n\\n \\n\\t does this patch cause the hangs to disappear for you? \\n\\t if so, do the checkDataSource and checkDataSource30 tests pass for you? \\n\\t if they fail, do the failures make sense to you? \\n\\t what should we be doing with the background connection threads during \\n   a Network Server restart? \\n \\n\\n\\n Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378481\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378481&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378481\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378481_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378481_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/May\\/06 01:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-09T01:01:32+0000\'\u003e09\\/May\\/06 01:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran the standalone repro with both your patches. I was not able to reproduce the hang on my machine after 25 runs with each patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for the detailed explanation of the problem. I think I was reading some overlapping traces and was misled. After reading your description, I added more traces and confirmed that the run method breaks out because it finds that the thread has been marked closed. As you said, it seems not quite okay to just break out without informing the client. Maybe, it is expected that this code can reached only after client is already informed after an exception or at end of a session. A quick look at places where close method is called seems to indicate this. \u003c\\/p\u003e\\n\\n\u003cp\u003eBoth your solutions seem to work on my machine but I am not very clear about them. About solution 1 (skipThreads.diff) , it does not seem quite right to remove the cleanup code (code to close existing threads and clear threadList). If it is okay to reuse the same threads after a restart, then it should be okay to remove this cleanup code. Even then, I think the real cause of this problem could be somewhere else. I have not looked at solution 2 as you mentioned it does not work in all cases.\u003c\\/p\u003e\\n\\n\u003cp\u003eJust sharing another thought which occurred to me after reading your descriptions. It looks like the new thread which was opened to serve the new connection gets added to threadList before the list is going to be cleaned up during restart. This causes the new thread to be closed unexpectedly when the server is restarted. I do not want to lead you down the wrong path. So I am looking at how\\/where threadList is accessed and if there could me some missing synchronizations here. I will post if I find something.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378481_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378481_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/May\\/06 01:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-09T01:01:32+0000\'\u003e09\\/May\\/06 01:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran the standalone repro with both your patches. I was not able to reproduce the hang on my machine after 25 runs with each patch. \\n\\n Thanks for the detailed explanation of the problem. I think I was reading some overlapping traces and was misled. After reading your description, I added more traces and confirmed that the run method breaks out because it finds that the thread has been marked closed. As you said, it seems not quite okay to just break out without informing the client. Maybe, it is expected that this code can reached only after client is already informed after an exception or at end of a session. A quick look at places where close method is called seems to indicate this.  \\n\\n Both your solutions seem to work on my machine but I am not very clear about them. About solution 1 (skipThreads.diff) , it does not seem quite right to remove the cleanup code (code to close existing threads and clear threadList). If it is okay to reuse the same threads after a restart, then it should be okay to remove this cleanup code. Even then, I think the real cause of this problem could be somewhere else. I have not looked at solution 2 as you mentioned it does not work in all cases. \\n\\n Just sharing another thought which occurred to me after reading your descriptions. It looks like the new thread which was opened to serve the new connection gets added to threadList before the list is going to be cleaned up during restart. This causes the new thread to be closed unexpectedly when the server is restarted. I do not want to lead you down the wrong path. So I am looking at how\\/where threadList is accessed and if there could me some missing synchronizations here. I will post if I find something.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378734\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378734&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378734\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378734_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378734_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 03:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T03:33:23+0000\'\u003e10\\/May\\/06 03:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne strategy that occurred to me is that, rather than clearing and re-using the RunQueue and the ThreadList, \u003cbr\\/\u003e\\nwe could have the restart processing set up a new RunQueue and ThreadList, and that way make a clean\u003cbr\\/\u003e\\ndistinction between old sessions and threads, versus new sessions and threads. That is, try to avoid the\u003cbr\\/\u003e\\nproblem of \\\"a new session comes in, but gets handled by an old thread which is being closed\\\", by teaching\u003cbr\\/\u003e\\nthe code how to tell the difference between old and new threads and sessions.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome sort of restart algorithm like:\u003c\\/p\u003e\\n\\n\u003cp\u003e  oldRunQueue = RunQueue\u003cbr\\/\u003e\\n  oldThreadList = ThreadList\u003cbr\\/\u003e\\n  create new RunQueue and new ThreadList\u003cbr\\/\u003e\\n  go through the old RunQueue and thread list and close and clean them up\u003c\\/p\u003e\\n\\n\u003cp\u003eThe idea being that, once we reach a certain point in Network Server restart processing, all new\u003cbr\\/\u003e\\nthreads go onto the new thread list, and all new sessions go onto the new run queue, and it\u003cbr\\/\u003e\\nshould be easier to tell the difference between old threads &amp; sessions, which have been closed\u003cbr\\/\u003e\\nand should now die, and new threads and sessions, which are allowed to start doing new work.\u003c\\/p\u003e\\n\\n\u003cp\u003eA similar, but not identical, idea would be to establish some sort of \\\"generation\\\" counter, which\u003cbr\\/\u003e\\nis incremented by one each time the Network Server restarts within a process, and instead\u003cbr\\/\u003e\\nof using the \\\"close\\\" API to shut down sessions and threads, use the idea of generations, so\u003cbr\\/\u003e\\nthat a session or thread which is in an older generation is treated as dead and gets cleaned up,\u003cbr\\/\u003e\\nwhile new generation threads can start processing new generation sessions, and if a thread\u003cbr\\/\u003e\\nand a session ever found that their generations didn\'t match, they would know that something\u003cbr\\/\u003e\\nhorrible had occurred and they could trigger a sanity check or assertion.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, just some thoughts to keep the discussion going. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378734_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378734_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 03:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T03:33:23+0000\'\u003e10\\/May\\/06 03:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One strategy that occurred to me is that, rather than clearing and re-using the RunQueue and the ThreadList,  \\nwe could have the restart processing set up a new RunQueue and ThreadList, and that way make a clean \\ndistinction between old sessions and threads, versus new sessions and threads. That is, try to avoid the \\nproblem of \\\"a new session comes in, but gets handled by an old thread which is being closed\\\", by teaching \\nthe code how to tell the difference between old and new threads and sessions. \\n\\n Some sort of restart algorithm like: \\n\\n   oldRunQueue = RunQueue \\n  oldThreadList = ThreadList \\n  create new RunQueue and new ThreadList \\n  go through the old RunQueue and thread list and close and clean them up \\n\\n The idea being that, once we reach a certain point in Network Server restart processing, all new \\nthreads go onto the new thread list, and all new sessions go onto the new run queue, and it \\nshould be easier to tell the difference between old threads &amp; sessions, which have been closed \\nand should now die, and new threads and sessions, which are allowed to start doing new work. \\n\\n A similar, but not identical, idea would be to establish some sort of \\\"generation\\\" counter, which \\nis incremented by one each time the Network Server restarts within a process, and instead \\nof using the \\\"close\\\" API to shut down sessions and threads, use the idea of generations, so \\nthat a session or thread which is in an older generation is treated as dead and gets cleaned up, \\nwhile new generation threads can start processing new generation sessions, and if a thread \\nand a session ever found that their generations didn\'t match, they would know that something \\nhorrible had occurred and they could trigger a sanity check or assertion. \\n\\n Anyway, just some thoughts to keep the discussion going.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378767\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378767&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378767\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378767_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378767_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 05:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T05:31:38+0000\'\u003e10\\/May\\/06 05:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am thinking along slightly different lines. The restart processing is doing some cleanup and reloading the driver. Should\'nt we wait for the reload to happen before we start working on the new session which comes in? In that case, we will need some logic to check if a restart is in progress before we add a new thread\\/session to the lists.\u003c\\/p\u003e\\n\\n\u003cp\u003eOr do we expect the driver to be reloaded by the time the new thread\\/session gets ready to do the real work? \u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378767_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378767_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 05:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T05:31:38+0000\'\u003e10\\/May\\/06 05:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am thinking along slightly different lines. The restart processing is doing some cleanup and reloading the driver. Should\'nt we wait for the reload to happen before we start working on the new session which comes in? In that case, we will need some logic to check if a restart is in progress before we add a new thread\\/session to the lists. \\n\\n Or do we expect the driver to be reloaded by the time the new thread\\/session gets ready to do the real work?  \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378772\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378772&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378772\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378772_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378772_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 06:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T06:00:29+0000\'\u003e10\\/May\\/06 06:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think that waiting for the reload to complete is fine, but we\'ll need to figure out a way to have a\u003cbr\\/\u003e\\npositive confirmation that the threads have received their notification and shut themselves down,\u003cbr\\/\u003e\\nsince, from a certain point of view, the essence of this bug is that calling DRDAConnThread.close()\u003cbr\\/\u003e\\nsimply asks a thread to shut itself down, but does not wait for that shutdown to actually occur.\u003c\\/p\u003e\\n\\n\u003cp\u003eSuch an algorithm would look something like:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ecall close on each thread\u003c\\/li\u003e\\n\\t\u003cli\u003ecall interrupt on each thread\u003c\\/li\u003e\\n\\t\u003cli\u003ewhile the threadlist is not empty\u003cbr\\/\u003e\\n        wait for a while\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI\'m always nervous about algorithms like this because of the need for an open-ended wait:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ehow do we know how long to wait?\u003c\\/li\u003e\\n\\t\u003cli\u003ewhat happens if we\'ve waited a long time and the threads still haven\'t shut themselves down?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe algorithms that I was proposing in my previous comment basically replace this\u003cbr\\/\u003e\\nopen-ended wait logic with a potential resource leak in the scenario where the old\u003cbr\\/\u003e\\nthreads for some reason don\'t respond to the request to shut themselves down.\u003cbr\\/\u003e\\nThat is, either we accept the risk of leaking away old threads, or we accept the risk\u003cbr\\/\u003e\\nof waiting indefinitely for old threads, (or, I suppose, we figure out some way to be\u003cbr\\/\u003e\\nVERY confident that we can shut the old threads down in a reasonable amount of time).\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378772_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378772_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 06:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T06:00:29+0000\'\u003e10\\/May\\/06 06:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think that waiting for the reload to complete is fine, but we\'ll need to figure out a way to have a \\npositive confirmation that the threads have received their notification and shut themselves down, \\nsince, from a certain point of view, the essence of this bug is that calling DRDAConnThread.close() \\nsimply asks a thread to shut itself down, but does not wait for that shutdown to actually occur. \\n\\n Such an algorithm would look something like: \\n \\n\\t call close on each thread \\n\\t call interrupt on each thread \\n\\t while the threadlist is not empty \\n        wait for a while \\n \\n\\n\\n I\'m always nervous about algorithms like this because of the need for an open-ended wait: \\n \\n\\t how do we know how long to wait? \\n\\t what happens if we\'ve waited a long time and the threads still haven\'t shut themselves down? \\n \\n\\n\\n The algorithms that I was proposing in my previous comment basically replace this \\nopen-ended wait logic with a potential resource leak in the scenario where the old \\nthreads for some reason don\'t respond to the request to shut themselves down. \\nThat is, either we accept the risk of leaking away old threads, or we accept the risk \\nof waiting indefinitely for old threads, (or, I suppose, we figure out some way to be \\nVERY confident that we can shut the old threads down in a reasonable amount of time). \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378794\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378794&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378794\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378794_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378794_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 08:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T08:07:56+0000\'\u003e10\\/May\\/06 08:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Bryan, \u003cbr\\/\u003e\\nWe seem to be thinking of the problem differently. I am just thinking aloud to explain how I understood the scenario:\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the scenario is: \u003c\\/p\u003e\\n\\n\u003cp\u003eOne of the threads have asked to restart the server and this \\\"restart\\\" includes:\u003cbr\\/\u003e\\n1. a) close all sessions in runQueue b) clear runQueue\u003cbr\\/\u003e\\n2. a) close all threads in threadList b) clear threadList \u003cbr\\/\u003e\\n3. reload the embedded driver\u003c\\/p\u003e\\n\\n\u003cp\u003e(Note: 1a and 2a are not single steps)\u003c\\/p\u003e\\n\\n\u003cp\u003eThis restart is in progress and we get a \\\"new connection\\\" from the client. We can do two things:\u003cbr\\/\u003e\\n1. queue it by adding to the runQueue list\u003cbr\\/\u003e\\nOR\u003cbr\\/\u003e\\n2. a) create a new thread for the connection b) add it to threadList c) start the new connection thread\u003c\\/p\u003e\\n\\n\u003cp\u003eIn addition to this, we can also have other connection threads which are running.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome cases I can think of which can cause hang are if we have actions overlapped as follows:\u003cbr\\/\u003e\\ncase1: restart_1a, restart_1b, new_conn_2a, new_conn_2b, restart_2a, new_conn_2c\u003cbr\\/\u003e\\ncase2: new_conn_1, restart 1a, restart 1b ...\u003c\\/p\u003e\\n\\n\u003cp\u003eIn case 1, after we have added a new connection thread to the threadList, threadList is cleared by restart thread and all threads including the new thread are marked closed. We then start the new thread (new_conn_2c) and it exits because it finds it was marked closed.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn case 2, we queue up the connection request, runQueue is cleared during restart. So we miss the request.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo me, the problem seems to be that we access the lists runQueue and threadList when a restart is in progress. \u003c\\/p\u003e\\n\\n\u003cp\u003eIn case of thread shutdown, I think the way it currently works is that we mark the thread as closed (set close = true). And next time, this thread is used, it checks if it was closed and if so it ends itself without doing anything. As the thread will not do anything else once it is marked closed, I am thinking it is okay to consider it as closed and not wait for it to actually terminate.  To me, the culprits seem to be the lists maintained by the server.\u003c\\/p\u003e\\n\\n\u003cp\u003eAny thoughts\\/comments?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378794_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378794_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 08:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T08:07:56+0000\'\u003e10\\/May\\/06 08:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Bryan,  \\nWe seem to be thinking of the problem differently. I am just thinking aloud to explain how I understood the scenario: \\n\\n I think the scenario is:  \\n\\n One of the threads have asked to restart the server and this \\\"restart\\\" includes: \\n1. a) close all sessions in runQueue b) clear runQueue \\n2. a) close all threads in threadList b) clear threadList  \\n3. reload the embedded driver \\n\\n (Note: 1a and 2a are not single steps) \\n\\n This restart is in progress and we get a \\\"new connection\\\" from the client. We can do two things: \\n1. queue it by adding to the runQueue list \\nOR \\n2. a) create a new thread for the connection b) add it to threadList c) start the new connection thread \\n\\n In addition to this, we can also have other connection threads which are running. \\n\\n Some cases I can think of which can cause hang are if we have actions overlapped as follows: \\ncase1: restart_1a, restart_1b, new_conn_2a, new_conn_2b, restart_2a, new_conn_2c \\ncase2: new_conn_1, restart 1a, restart 1b ... \\n\\n In case 1, after we have added a new connection thread to the threadList, threadList is cleared by restart thread and all threads including the new thread are marked closed. We then start the new thread (new_conn_2c) and it exits because it finds it was marked closed. \\n\\n In case 2, we queue up the connection request, runQueue is cleared during restart. So we miss the request. \\n\\n To me, the problem seems to be that we access the lists runQueue and threadList when a restart is in progress.  \\n\\n In case of thread shutdown, I think the way it currently works is that we mark the thread as closed (set close = true). And next time, this thread is used, it checks if it was closed and if so it ends itself without doing anything. As the thread will not do anything else once it is marked closed, I am thinking it is okay to consider it as closed and not wait for it to actually terminate.  To me, the culprits seem to be the lists maintained by the server. \\n\\n Any thoughts\\/comments?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378821\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378821&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378821\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378821_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378821_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 11:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T11:30:51+0000\'\u003e10\\/May\\/06 11:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Deepa,\u003cbr\\/\u003e\\nI think that your scenarios are excellent, and they definitely demonstrate the problems in this area. \u003cbr\\/\u003e\\nI think that the fun thing about a bug like this, is that there are many possible scenarios. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThe one I was concentrating on is a bit different from yours, so let me try to diagram it as follows:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) Some thread is idling, blocked in NetworkServerControlImpl.getNextSession() as called by\u003cbr\\/\u003e\\n   DRDAConnThread.run(). I think this is the standard place for a thread to block when it is idle.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) Server restart occurs, and runs straight through to completion. This results in calling close()\u003cbr\\/\u003e\\n   on the thread from point (1), and also removing that thread from the ThreadList. *But the thread\u003cbr\\/\u003e\\n   does not terminate.*\u003c\\/p\u003e\\n\\n\u003cp\u003e3) Some time later, some new connections start coming in. The first new connection, as you\u003cbr\\/\u003e\\n   point out, will create a new thread to handle the session. The next new conection, however, will\u003cbr\\/\u003e\\n   find that a thread already exists, and so it will simply put the session onto the RunQueue list.\u003c\\/p\u003e\\n\\n\u003cp\u003e4) The original thread then wakes up, grabs the session, notices that the thread has been\u003cbr\\/\u003e\\n   closed, and exits.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe point I\'m trying to make here is that no overlapping of actions is required, and the connection \u003cbr\\/\u003e\\ndoes not have to arrive during the restart. \u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to me that, once a restart happens while 1 or more threads happen to be sitting idle,\u003cbr\\/\u003e\\nblocked in their getNextSession() calls, then those threads are \\\"poisoned\\\", and there is\u003cbr\\/\u003e\\nnow a ticking time bomb in the server. At some point in the future, a session will get added\u003cbr\\/\u003e\\nto the RunQueue, and one of these \\\"poisoned\\\" (closed) threads will grab the session, and\u003cbr\\/\u003e\\nwill then terminate prematurely without processing the session.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo the only place where I differ with your analysis, I believe, is that I think it is \u003cb\u003enot\u003c\\/b\u003e okay to\u003cbr\\/\u003e\\nleave these threads out there, marked as closed, because at some point in the future the\u003cbr\\/\u003e\\nthreads will grab sessions off the run queue and fail to process them.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I think one crucial thing to ensure is that, once a thread is marked as closed, it will no \u003cbr\\/\u003e\\nlonger pick up a new session to process.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith that in mind, I\'ve experimented with yet another patch, called \\\"no-sessions-for-closed-threads.diff\\\",\u003cbr\\/\u003e\\nwhich attempts to prevent threads marked as closed from fetching sessions to process.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to resolve the hang for me, but I haven\'t exhaustively tested it. Still, I thought it\u003cbr\\/\u003e\\nshowed enough promise to attach for you to examine.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378821_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378821_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 11:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T11:30:51+0000\'\u003e10\\/May\\/06 11:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Deepa, \\nI think that your scenarios are excellent, and they definitely demonstrate the problems in this area.  \\nI think that the fun thing about a bug like this, is that there are many possible scenarios.   \\n\\n The one I was concentrating on is a bit different from yours, so let me try to diagram it as follows: \\n\\n 1) Some thread is idling, blocked in NetworkServerControlImpl.getNextSession() as called by \\n   DRDAConnThread.run(). I think this is the standard place for a thread to block when it is idle. \\n\\n 2) Server restart occurs, and runs straight through to completion. This results in calling close() \\n   on the thread from point (1), and also removing that thread from the ThreadList. *But the thread \\n   does not terminate.* \\n\\n 3) Some time later, some new connections start coming in. The first new connection, as you \\n   point out, will create a new thread to handle the session. The next new conection, however, will \\n   find that a thread already exists, and so it will simply put the session onto the RunQueue list. \\n\\n 4) The original thread then wakes up, grabs the session, notices that the thread has been \\n   closed, and exits. \\n\\n The point I\'m trying to make here is that no overlapping of actions is required, and the connection  \\ndoes not have to arrive during the restart.  \\n\\n It seems to me that, once a restart happens while 1 or more threads happen to be sitting idle, \\nblocked in their getNextSession() calls, then those threads are \\\"poisoned\\\", and there is \\nnow a ticking time bomb in the server. At some point in the future, a session will get added \\nto the RunQueue, and one of these \\\"poisoned\\\" (closed) threads will grab the session, and \\nwill then terminate prematurely without processing the session. \\n\\n So the only place where I differ with your analysis, I believe, is that I think it is  not  okay to \\nleave these threads out there, marked as closed, because at some point in the future the \\nthreads will grab sessions off the run queue and fail to process them. \\n\\n So I think one crucial thing to ensure is that, once a thread is marked as closed, it will no  \\nlonger pick up a new session to process. \\n\\n With that in mind, I\'ve experimented with yet another patch, called \\\"no-sessions-for-closed-threads.diff\\\", \\nwhich attempts to prevent threads marked as closed from fetching sessions to process. \\n\\n It seems to resolve the hang for me, but I haven\'t exhaustively tested it. Still, I thought it \\nshowed enough promise to attach for you to examine.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378938\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378938&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378938\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378938_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378938_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 22:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T22:34:25+0000\'\u003e10\\/May\\/06 22:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Bryan,\u003cbr\\/\u003e\\nI applied your new patch \'no-sessions-for-closed-threads.diff\' and ran the checkDataSource repro. However, I still get the hang intermittently on my machine. Though the hang has not gone away, I think the scenario you explain is a probable one. And as you said, the bug is quite interesting as it can have many possible scenarios.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378938_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378938_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 22:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T22:34:25+0000\'\u003e10\\/May\\/06 22:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Bryan, \\nI applied your new patch \'no-sessions-for-closed-threads.diff\' and ran the checkDataSource repro. However, I still get the hang intermittently on my machine. Though the hang has not gone away, I think the scenario you explain is a probable one. And as you said, the bug is quite interesting as it can have many possible scenarios. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378954\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378954&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378954\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378954_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378954_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/06 00:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-11T00:32:53+0000\'\u003e11\\/May\\/06 00:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePosting my observation with the patch \'no-sessions-for-closed-threads.diff\': I think this patch solves the problem of \\\"poisoned\\\" threads partially. It makes sure that a thread which has been marked closed does not get a session to work on. However, the session which came in is still hanging because there are no new threads which can pick it up. When the session came in, server had queued it so that a free thread picks it up. But the thread which picked it up was a \\\"poisoned\\\" (closed) thread. So the session is still waiting for another thread. \u003c\\/p\u003e\\n\\n\u003cp\u003eTo test that the hang will go away when a new thread gets created, I opened another connection using ij. This made the hang go away and the repro ran to the end. When the connection from ij came in, the newly created thread was able to work on the waiting session and resolve the hang.\u003c\\/p\u003e\\n\\n\u003cp\u003eBryan, I am looking at your trial patch \\\"interrupt.diff\\\" which looks like a good solution to me too. This patch made the hang go away on my machine. But you had said that it did not resolve all hangs for you. Can you please post your observations with this patch?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12378954_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378954_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/06 00:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-11T00:32:53+0000\'\u003e11\\/May\\/06 00:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Posting my observation with the patch \'no-sessions-for-closed-threads.diff\': I think this patch solves the problem of \\\"poisoned\\\" threads partially. It makes sure that a thread which has been marked closed does not get a session to work on. However, the session which came in is still hanging because there are no new threads which can pick it up. When the session came in, server had queued it so that a free thread picks it up. But the thread which picked it up was a \\\"poisoned\\\" (closed) thread. So the session is still waiting for another thread.  \\n\\n To test that the hang will go away when a new thread gets created, I opened another connection using ij. This made the hang go away and the repro ran to the end. When the connection from ij came in, the newly created thread was able to work on the waiting session and resolve the hang. \\n\\n Bryan, I am looking at your trial patch \\\"interrupt.diff\\\" which looks like a good solution to me too. This patch made the hang go away on my machine. But you had said that it did not resolve all hangs for you. Can you please post your observations with this patch?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378971\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12378971&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378971\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378971_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378971_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/06 03:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-11T03:19:56+0000\'\u003e11\\/May\\/06 03:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI will gladly work on interrupt.diff some more, and try to provide more testing details.\u003cbr\\/\u003e\\nBut I won\'t get to it until at least this weekend, sorry. Thanks very much for continuing\u003cbr\\/\u003e\\nto work on this with me; I think we\'re making some real progress here!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12378971_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378971_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/06 03:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-11T03:19:56+0000\'\u003e11\\/May\\/06 03:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I will gladly work on interrupt.diff some more, and try to provide more testing details. \\nBut I won\'t get to it until at least this weekend, sorry. Thanks very much for continuing \\nto work on this with me; I think we\'re making some real progress here!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12383400\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12383400&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12383400\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12383400_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12383400_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/May\\/06 00:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-14T00:29:08+0000\'\u003e14\\/May\\/06 00:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been trying to run this test in one of my alternate environments, and I\'d like to be able to run the server on a port other than 1527. Unfortunately, when I change the value of ij.database so that it specifies a different port number, the test runs partway, then fails with:\u003c\\/p\u003e\\n\\n\u003cp\u003ejava.sql.SQLException: java.security.PrivilegedActionException : Error connecting to server localhost on port 1,527 with message Connection refused.\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\u003cbr\\/\u003e\\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:342)\u003cbr\\/\u003e\\n        at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:191)\u003cbr\\/\u003e\\n        at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:162)\u003cbr\\/\u003e\\n        at org.apache.derbyTesting.functionTests.tests.jdbcapi.checkDataSource.runTest(checkDataSource.java:190)\u003cbr\\/\u003e\\n        at org.apache.derbyTesting.functionTests.tests.jdbcapi.checkDataSource.main(checkDataSource.java:132)\u003c\\/p\u003e\\n\\n\u003cp\u003eLine 190 of checkDataSource.java is the last line of the following snippet:\u003c\\/p\u003e\\n\\n\u003cp\u003e                DataSource dscs = TestUtil.getDataSource(attrs);\u003c\\/p\u003e\\n\\n\u003cp\u003e                if (testConnectionToString)\u003cbr\\/\u003e\\n                                checkToString(dscs);\u003c\\/p\u003e\\n\\n\u003cp\u003e                DataSource ds = dscs;\u003c\\/p\u003e\\n\\n\u003cp\u003e                checkConnection(\\\"DataSource\\\", ds.getConnection());\u003c\\/p\u003e\\n\\n\u003cp\u003eIs it possible to configure this test to run on a port other than 1527?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12383400_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12383400_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/May\\/06 00:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-14T00:29:08+0000\'\u003e14\\/May\\/06 00:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve been trying to run this test in one of my alternate environments, and I\'d like to be able to run the server on a port other than 1527. Unfortunately, when I change the value of ij.database so that it specifies a different port number, the test runs partway, then fails with: \\n\\n java.sql.SQLException: java.security.PrivilegedActionException : Error connecting to server localhost on port 1,527 with message Connection refused. \\n        at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) \\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:342) \\n        at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:191) \\n        at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:162) \\n        at org.apache.derbyTesting.functionTests.tests.jdbcapi.checkDataSource.runTest(checkDataSource.java:190) \\n        at org.apache.derbyTesting.functionTests.tests.jdbcapi.checkDataSource.main(checkDataSource.java:132) \\n\\n Line 190 of checkDataSource.java is the last line of the following snippet: \\n\\n                 DataSource dscs = TestUtil.getDataSource(attrs); \\n\\n                 if (testConnectionToString) \\n                                checkToString(dscs); \\n\\n                 DataSource ds = dscs; \\n\\n                 checkConnection(\\\"DataSource\\\", ds.getConnection()); \\n\\n Is it possible to configure this test to run on a port other than 1527?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12383402\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12383402&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12383402\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12383402_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12383402_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/May\\/06 00:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-14T00:47:53+0000\'\u003e14\\/May\\/06 00:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think the interrupt.diff patch is very close to being good, but I think there are some \u003cbr\\/\u003e\\nsynchronization issues to resolve. The interrupt.diff patch is very reliable on my\u003cbr\\/\u003e\\nWindows environment; that is, I cannot reproduce the hang with that diff in place.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn my Linux environment, however, the test still hangs with that patch. However, if\u003cbr\\/\u003e\\nI introduce even very small timing changes into the test; for example if I put a\u003cbr\\/\u003e\\nprintln statement into a critical section of the getNextSession() logic, then the\u003cbr\\/\u003e\\nhang disappears.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I think that the interrupt.diff patch can perhaps be combined with some\u003cbr\\/\u003e\\nadditional synchronization as Deepa suggested earlier, to solve some of the\u003cbr\\/\u003e\\nraces between the Network Server restart, the DRDAConnThreads calling\u003cbr\\/\u003e\\ngetNextSession, and the ClientThread logic involving creating a new session\u003cbr\\/\u003e\\nand conditionally creating a new thread.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll continue to fiddle with the configuration that I have in which I can still provoke\u003cbr\\/\u003e\\na hang, and see what I can do to understand it better.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12383402_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12383402_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/May\\/06 00:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-14T00:47:53+0000\'\u003e14\\/May\\/06 00:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think the interrupt.diff patch is very close to being good, but I think there are some  \\nsynchronization issues to resolve. The interrupt.diff patch is very reliable on my \\nWindows environment; that is, I cannot reproduce the hang with that diff in place. \\n\\n In my Linux environment, however, the test still hangs with that patch. However, if \\nI introduce even very small timing changes into the test; for example if I put a \\nprintln statement into a critical section of the getNextSession() logic, then the \\nhang disappears. \\n\\n So I think that the interrupt.diff patch can perhaps be combined with some \\nadditional synchronization as Deepa suggested earlier, to solve some of the \\nraces between the Network Server restart, the DRDAConnThreads calling \\ngetNextSession, and the ClientThread logic involving creating a new session \\nand conditionally creating a new thread. \\n\\n I\'ll continue to fiddle with the configuration that I have in which I can still provoke \\na hang, and see what I can do to understand it better.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402243\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402243&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402243\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12402243_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402243_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/May\\/06 05:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-15T05:58:05+0000\'\u003e15\\/May\\/06 05:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell, I ran a lot of experiments, but I don\'t have anything conclusive to offer. I believe that:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethe issue is intricately linked to the handling of threads and sessions during restart\u003c\\/li\u003e\\n\\t\u003cli\u003ethe hangs are because closed threads are given sessions to run, but then abandon\u003cbr\\/\u003e\\n   those sessions without running them when they discover they\'ve been closed\u003c\\/li\u003e\\n\\t\u003cli\u003ethe interrupt() call makes things better, but does not totally fix the problem. I can still\u003cbr\\/\u003e\\n   reproduce the problem on my RedHat Linux\\/ Sun JDK 1.4.2 environment.\u003c\\/li\u003e\\n\\t\u003cli\u003ebut my various attempts to try to improve on the interrupt() fix with additional changes,\u003cbr\\/\u003e\\n   only made things worse.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eUnfortunately, I\'m not going to have much more time to work on this right away, so I\'m\u003cbr\\/\u003e\\nunassigning myself in the hopes that somebody else can work on it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12402243_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402243_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/May\\/06 05:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-15T05:58:05+0000\'\u003e15\\/May\\/06 05:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well, I ran a lot of experiments, but I don\'t have anything conclusive to offer. I believe that: \\n \\n\\t the issue is intricately linked to the handling of threads and sessions during restart \\n\\t the hangs are because closed threads are given sessions to run, but then abandon \\n   those sessions without running them when they discover they\'ve been closed \\n\\t the interrupt() call makes things better, but does not totally fix the problem. I can still \\n   reproduce the problem on my RedHat Linux\\/ Sun JDK 1.4.2 environment. \\n\\t but my various attempts to try to improve on the interrupt() fix with additional changes, \\n   only made things worse. \\n \\n\\n\\n Unfortunately, I\'m not going to have much more time to work on this right away, so I\'m \\nunassigning myself in the hopes that somebody else can work on it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402353\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402353&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402353\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12402353_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402353_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 00:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T00:04:55+0000\'\u003e16\\/May\\/06 00:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Bryan for helping to identify the cause of the hang. \u003c\\/p\u003e\\n\\n\u003cp\u003eSince we now know what is causing the intermittent hang, I think we can break the issue as follows: \u003c\\/p\u003e\\n\\n\u003cp\u003e1) Open a separate code bug against network server component to solve the real hang problem and link to the details in this test issue.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) Enable the test to run with client by removing the code which shutdowns the system when we run the test using client framework. This is the code which causes the intermediate hang and it seems this code is not required to check the scenarios meant to be covered by the test.  I disabled the following shutdown code using a boolean and ran the checkDataSource tests with the client and did not get the hang so far:\u003c\\/p\u003e\\n\\n\u003cp\u003e          \\/\\/ DERBY -???? - link to new bug opened for 1) above\u003cbr\\/\u003e\\n          private static boolean hangAfterSystemShutdown = TestUtil.isDerbyNetClientFramework();\u003cbr\\/\u003e\\n                        .\u003cbr\\/\u003e\\n                        .\u003cbr\\/\u003e\\n                        .\u003cbr\\/\u003e\\n          \\/\\/ Shutdown the system only if we are not running in client framework\u003cbr\\/\u003e\\n          if(! hangAfterSystemShutdown) {\u003cbr\\/\u003e\\n\\t\\t\\ttry \u003c\\/p\u003e\\n{\\n\\t\\t\\t\\tTestUtil.getConnection(\\\"\\\",\\\"shutdown=true\\\");\\n\\t\\t\\t}\\n\u003cp\u003e catch (SQLException sqle) \u003c\\/p\u003e\\n{\\n\\t\\t\\t\\tJDBCDisplayUtil.ShowSQLException(System.out, sqle);\\n\\t\\t\\t}\\n\u003cp\u003e\\t\\t}\u003c\\/p\u003e\\n\\n\u003cp\u003eThe test has some existing diffs because of some intermediate check-ins which changed the messages\\/behaviour. I will look at these diffs and submit a patch to enable the checkDataSource tests to run with client. I think it would be good to get the test running with client so that we can keep the masters up to date and also be able to catch any regressions in this area.\u003c\\/p\u003e\\n\\n\u003cp\u003ePlease provide any comments\\/feedback.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12402353_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402353_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 00:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T00:04:55+0000\'\u003e16\\/May\\/06 00:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Bryan for helping to identify the cause of the hang.  \\n\\n Since we now know what is causing the intermittent hang, I think we can break the issue as follows:  \\n\\n 1) Open a separate code bug against network server component to solve the real hang problem and link to the details in this test issue. \\n\\n 2) Enable the test to run with client by removing the code which shutdowns the system when we run the test using client framework. This is the code which causes the intermediate hang and it seems this code is not required to check the scenarios meant to be covered by the test.  I disabled the following shutdown code using a boolean and ran the checkDataSource tests with the client and did not get the hang so far: \\n\\n           \\/\\/ DERBY -???? - link to new bug opened for 1) above \\n          private static boolean hangAfterSystemShutdown = TestUtil.isDerbyNetClientFramework(); \\n                        . \\n                        . \\n                        . \\n          \\/\\/ Shutdown the system only if we are not running in client framework \\n          if(! hangAfterSystemShutdown) { \\n\\t\\t\\ttry  \\n{\\n\\t\\t\\t\\tTestUtil.getConnection(\\\"\\\",\\\"shutdown=true\\\");\\n\\t\\t\\t}\\n  catch (SQLException sqle)  \\n{\\n\\t\\t\\t\\tJDBCDisplayUtil.ShowSQLException(System.out, sqle);\\n\\t\\t\\t}\\n \\t\\t} \\n\\n The test has some existing diffs because of some intermediate check-ins which changed the messages\\/behaviour. I will look at these diffs and submit a patch to enable the checkDataSource tests to run with client. I think it would be good to get the test running with client so that we can keep the masters up to date and also be able to catch any regressions in this area. \\n\\n Please provide any comments\\/feedback.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402400\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402400&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402400\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12402400_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402400_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 02:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T02:56:56+0000\'\u003e16\\/May\\/06 02:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe two categories of diffs seen  when running the checkDataSource test with client are: \u003c\\/p\u003e\\n\\n\u003cp\u003e&lt; DriverManager  &lt;closedstmt&gt;.execute() null - Invalid operation: statement closed\u003cbr\\/\u003e\\n11a11\u003cbr\\/\u003e\\n&gt; DriverManager  &lt;closedstmt&gt;.execute() 08003 - No current connection\u003c\\/p\u003e\\n\\n\u003cp\u003eAND\u003c\\/p\u003e\\n\\n\u003cp\u003e&lt; autocommitxastart expected \'ResultSet\' already closed.\u003cbr\\/\u003e\\n460a459\u003cbr\\/\u003e\\n&gt; autocommitxastart expected ResultSet not open.  Verify that autocommit is OFF.\u003c\\/p\u003e\\n\\n\u003cp\u003eThese diffs are message changes done as part of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-843\\\" title=\\\"Internationalize messages in SectionManager to XaException in org.apache.derby.client.am\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-843\\\"\u003e\u003cdel\u003eDERBY-843\u003c\\/del\u003e\u003c\\/a\u003e\\/\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-842\\\" title=\\\"Internationalize messages in PreparedStatement to Section in org.apache.derby.client.am\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-842\\\"\u003e\u003cdel\u003eDERBY-842\u003c\\/del\u003e\u003c\\/a\u003e. However, in the case of first diff, I see a difference in the behaviour of client and embedded driver.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn case of client driver, Statement.execute method first checks if the connection associated with the statement is closed before it checks if the statement itself was closed or not. In case of embedded driver, the check for statement closed is done before the check for connection closed. I would like to clarify if the order of the checks matter and if it does which is the correct behaviour.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12402400_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402400_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 02:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T02:56:56+0000\'\u003e16\\/May\\/06 02:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The two categories of diffs seen  when running the checkDataSource test with client are:  \\n\\n &lt; DriverManager  &lt;closedstmt&gt;.execute() null - Invalid operation: statement closed \\n11a11 \\n&gt; DriverManager  &lt;closedstmt&gt;.execute() 08003 - No current connection \\n\\n AND \\n\\n &lt; autocommitxastart expected \'ResultSet\' already closed. \\n460a459 \\n&gt; autocommitxastart expected ResultSet not open.  Verify that autocommit is OFF. \\n\\n These diffs are message changes done as part of   DERBY-843  \\/  DERBY-842  . However, in the case of first diff, I see a difference in the behaviour of client and embedded driver. \\n\\n In case of client driver, Statement.execute method first checks if the connection associated with the statement is closed before it checks if the statement itself was closed or not. In case of embedded driver, the check for statement closed is done before the check for connection closed. I would like to clarify if the order of the checks matter and if it does which is the correct behaviour.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402409\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402409&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402409\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12402409_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402409_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 03:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T03:17:45+0000\'\u003e16\\/May\\/06 03:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDeepa said ...\u003cbr\\/\u003e\\n&gt;(The shutdown)  is the code which causes the intermediate hang and it seems this code is not required &gt;to check the scenarios meant to be covered by the test.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI agree that the conditional  is a good solution for getting the test running with client, but would like to clarify that I think the shutdown is a valuable part of the test because we verify that the global transaction state is valid even aver the database has been shutdown and restarted.  Once the hang has been resolved it would be good to reenable this part of the test for client.\u003c\\/p\u003e\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12402409_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402409_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 03:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T03:17:45+0000\'\u003e16\\/May\\/06 03:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Deepa said ... \\n&gt;(The shutdown)  is the code which causes the intermediate hang and it seems this code is not required &gt;to check the scenarios meant to be covered by the test.   \\n\\n I agree that the conditional  is a good solution for getting the test running with client, but would like to clarify that I think the shutdown is a valuable part of the test because we verify that the global transaction state is valid even aver the database has been shutdown and restarted.  Once the hang has been resolved it would be good to reenable this part of the test for client. \\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402429\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402429&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402429\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12402429_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402429_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 04:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T04:51:40+0000\'\u003e16\\/May\\/06 04:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDeepa asked about these diffs:\u003cbr\\/\u003e\\n&gt;DriverManager &lt;closedstmt&gt;.execute() null - Invalid operation: statement closed\u003cbr\\/\u003e\\n11a11\u003cbr\\/\u003e\\n&gt; DriverManager &lt;closedstmt&gt;.execute() 08003 - No current connection\u003c\\/p\u003e\\n\\n\u003cp\u003eAND\u003c\\/p\u003e\\n\\n\u003cp\u003e&lt; autocommitxastart expected \'ResultSet\' already closed.\u003cbr\\/\u003e\\n460a459\u003cbr\\/\u003e\\n&gt; autocommitxastart expected ResultSet not open. Verify that autocommit is OFF.\u003c\\/p\u003e\\n\\n\u003cp\u003erelated to the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-843\\\" title=\\\"Internationalize messages in SectionManager to XaException in org.apache.derby.client.am\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-843\\\"\u003e\u003cdel\u003eDERBY-843\u003c\\/del\u003e\u003c\\/a\u003e change.  I posted a question about this to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-843\\\" title=\\\"Internationalize messages in SectionManager to XaException in org.apache.derby.client.am\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-843\\\"\u003e\u003cdel\u003eDERBY-843\u003c\\/del\u003e\u003c\\/a\u003e, but I think it makes sense to go ahead and update the master and get the test running while that issue is being resolved.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12402429_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402429_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 04:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T04:51:40+0000\'\u003e16\\/May\\/06 04:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Deepa asked about these diffs: \\n&gt;DriverManager &lt;closedstmt&gt;.execute() null - Invalid operation: statement closed \\n11a11 \\n&gt; DriverManager &lt;closedstmt&gt;.execute() 08003 - No current connection \\n\\n AND \\n\\n &lt; autocommitxastart expected \'ResultSet\' already closed. \\n460a459 \\n&gt; autocommitxastart expected ResultSet not open. Verify that autocommit is OFF. \\n\\n related to the   DERBY-843   change.  I posted a question about this to   DERBY-843  , but I think it makes sense to go ahead and update the master and get the test running while that issue is being resolved.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402442\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402442&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402442\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12402442_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402442_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 05:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T05:44:09+0000\'\u003e16\\/May\\/06 05:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching a patch \'derby-1219-enable-tests.diff\' which enables the tests jdbcapi\\/checkDataSource.java and jdbcapi\\/checkDataSource30.java to run with client.\u003c\\/p\u003e\\n\\n\u003cp\u003ePatch adds a condition to exclude a system shutdown when running with client framework. This condition has to be removed once the hang (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1326\\\" title=\\\"Network server may abandon sessions when Derby system is shutdown and this causes intermittent hangs in the client\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1326\\\"\u003e\u003cdel\u003eDERBY-1326\u003c\\/del\u003e\u003c\\/a\u003e) is resolved. Thanks Kathey for mentioning the use of shutdown in this test.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith this patch, I ran the 2 tests using embedded and client driver with Sun jdk1.4.2 on Windows XP. I ran the tests multiple times with client driver to check that the hang does not occur. I would appreciate if someone can take a look at this patch.\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12402442_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402442_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 05:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T05:44:09+0000\'\u003e16\\/May\\/06 05:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching a patch \'derby-1219-enable-tests.diff\' which enables the tests jdbcapi\\/checkDataSource.java and jdbcapi\\/checkDataSource30.java to run with client. \\n\\n Patch adds a condition to exclude a system shutdown when running with client framework. This condition has to be removed once the hang (  DERBY-1326  ) is resolved. Thanks Kathey for mentioning the use of shutdown in this test. \\n\\n With this patch, I ran the 2 tests using embedded and client driver with Sun jdk1.4.2 on Windows XP. I ran the tests multiple times with client driver to check that the hang does not occur. I would appreciate if someone can take a look at this patch. \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402450\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402450&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402450\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12402450_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402450_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 06:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T06:08:48+0000\'\u003e16\\/May\\/06 06:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran both tests multiple times on my Linux JDK 1.4.2 environment with no hangs, and tests passed\u003cbr\\/\u003e\\neach time. This particular machine was very reliable in reproducing the hang before, so I think that\'s\u003cbr\\/\u003e\\na good result, and it confirms your result.\u003c\\/p\u003e\\n\\n\u003cp\u003eI would be glad to commit this patch. Do you think there are any other details we should check first?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12402450_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402450_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 06:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T06:08:48+0000\'\u003e16\\/May\\/06 06:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran both tests multiple times on my Linux JDK 1.4.2 environment with no hangs, and tests passed \\neach time. This particular machine was very reliable in reproducing the hang before, so I think that\'s \\na good result, and it confirms your result. \\n\\n I would be glad to commit this patch. Do you think there are any other details we should check first? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402454\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402454&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402454\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12402454_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402454_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 06:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T06:26:00+0000\'\u003e16\\/May\\/06 06:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWere you asking if we need to run more tests? I think this patch changes only tests and I have run the tests with embedded and client driver. The tests are excluded with jcc driver. We also confirmed that the hang does not occur with the changed test.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"deepa\\\" id=\\\"commentauthor_12402454_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=deepa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=34050\\\" alt=\\\"deepa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Deepa Remesh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402454_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 06:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T06:26:00+0000\'\u003e16\\/May\\/06 06:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Were you asking if we need to run more tests? I think this patch changes only tests and I have run the tests with embedded and client driver. The tests are excluded with jcc driver. We also confirmed that the hang does not occur with the changed test.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12402458\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12402458&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12402458\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12402458_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402458_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 06:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T06:36:41+0000\'\u003e16\\/May\\/06 06:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI committed patch derby-1219-enable-tests.diff to subversion as revision 406776:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/svn.apache.org\\/viewcvs?rev=406776&amp;view=rev\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/svn.apache.org\\/viewcvs?rev=406776&amp;view=rev\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eIt will be nice to have this test running regularly in the client framework.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12402458_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12402458_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/06 06:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-16T06:36:41+0000\'\u003e16\\/May\\/06 06:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I committed patch derby-1219-enable-tests.diff to subversion as revision 406776: \\n http:\\/\\/svn.apache.org\\/viewcvs?rev=406776&amp;view=rev  \\n\\n It will be nice to have this test running regularly in the client framework.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12413008\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-1219?focusedCommentId=12413008&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12413008\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12413008_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12413008_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/06 04:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-24T04:50:17+0000\'\u003e24\\/May\\/06 04:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCannot reproduce hang. Thanks Deepa\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kmarsden\\\" id=\\\"commentauthor_12413008_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kmarsden\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kmarsden\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kathey Marsden\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12413008_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/06 04:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-24T04:50:17+0000\'\u003e24\\/May\\/06 04:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Cannot reproduce hang. Thanks Deepa              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520238243404"> 
    <input type="hidden" title="jira.request.server.time" value="206"> 
    <input type="hidden" title="jira.request.id" value="504x94351795x4"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="9"> 
    <input type="hidden" title="db.reads.time.in.ms" value="20"> 
    <input type="hidden" title="db.conns.time.in.ms" value="25"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 504x94351795x4
	          REQUEST TIMESTAMP : [05/Mar/2018:08:24:03 +0000]
	               REQUEST TIME : 0.2060
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 9

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=28, elapsedTotal=20557324, elapsedMin=320475, elapsedMax=6804428, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=32, elapsedTotal=25497342, elapsedMin=343945, elapsedMax=6836466, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>