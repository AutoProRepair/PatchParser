<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|cd0f67dcec73440f21cc2ef4962c46767ce46bf8|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"df94740d0a8713\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-565"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-565] Supporting deleteDocuments in IndexWriter (Code and Performance Results Provided) - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-565] Supporting deleteDocuments in IndexWriter (Code and Performance Results Provided) - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-565">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-565" href="/jira/browse/LUCENE-565" id="key-val" rel="12333383">LUCENE-565</a></li>
                </ol>
                <h1 id="summary-val">Supporting deleteDocuments in IndexWriter (Code and Performance Results Provided)</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-565"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-565/LUCENE-565.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-565/LUCENE-565.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-565/LUCENE-565.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-565/LUCENE-565.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+2.1" title="2.1 ">2.1</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12333383-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>Patch Available</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Today, applications have to open/close an IndexWriter and open/close an<br> IndexReader directly or indirectly (via IndexModifier) in order to handle a<br> mix of inserts and deletes. This performs well when inserts and deletes<br> come in fairly large batches. However, the performance can degrade<br> dramatically when inserts and deletes are interleaved in small batches.<br> This is because the ramDirectory is flushed to disk whenever an IndexWriter<br> is closed, causing a lot of small segments to be created on disk, which<br> eventually need to be merged.</p> 
                  <p>We would like to propose a small API change to eliminate this problem. We<br> are aware that this kind change has come up in discusions before. See<br> <a href="http://www.gossamer-threads.com/lists/lucene/java-dev/23049?search_string=indexwriter%20delete;#23049" class="external-link" rel="nofollow">http://www.gossamer-threads.com/lists/lucene/java-dev/23049?search_string=indexwriter%20delete;#23049</a><br> . The difference this time is that we have implemented the change and<br> tested its performance, as described below.</p> 
                  <p>API Changes<br> -----------<br> We propose adding a "deleteDocuments(Term term)" method to IndexWriter.<br> Using this method, inserts and deletes can be interleaved using the same<br> IndexWriter.</p> 
                  <p>Note that, with this change it would be very easy to add another method to<br> IndexWriter for updating documents, allowing applications to avoid a<br> separate delete and insert to update a document.</p> 
                  <p>Also note that this change can co-exist with the existing APIs for deleting<br> documents using an IndexReader. But if our proposal is accepted, we think<br> those APIs should probably be deprecated.</p> 
                  <p>Coding Changes<br> --------------<br> Coding changes are localized to IndexWriter. Internally, the new<br> deleteDocuments() method works by buffering the terms to be deleted.<br> Deletes are deferred until the ramDirectory is flushed to disk, either<br> because it becomes full or because the IndexWriter is closed. Using Java<br> synchronization, care is taken to ensure that an interleaved sequence of<br> inserts and deletes for the same document are properly serialized.</p> 
                  <p>We have attached a modified version of IndexWriter in Release 1.9.1 with<br> these changes. Only a few hundred lines of coding changes are needed. All<br> changes are commented by "CHANGE". We have also attached a modified version<br> of an example from Chapter 2.2 of Lucene in Action.</p> 
                  <p>Performance Results<br> -------------------<br> To test the performance our proposed changes, we ran some experiments using<br> the TREC WT 10G dataset. The experiments were run on a dual 2.4 Ghz Intel<br> Xeon server running Linux. The disk storage was configured as RAID0 array<br> with 5 drives. Before indexes were built, the input documents were parsed<br> to remove the HTML from them (i.e., only the text was indexed). This was<br> done to minimize the impact of parsing on performance. A simple<br> WhitespaceAnalyzer was used during index build.</p> 
                  <p>We experimented with three workloads:</p> 
                  <ul class="alternate" type="square"> 
                   <li>Insert only. 1.6M documents were inserted and the final<br> index size was 2.3GB.</li> 
                   <li>Insert/delete (big batches). The same documents were<br> inserted, but 25% were deleted. 1000 documents were<br> deleted for every 4000 inserted.</li> 
                   <li>Insert/delete (small batches). In this case, 5 documents<br> were deleted for every 20 inserted.</li> 
                  </ul> 
                  <p> current current new<br> Workload IndexWriter IndexModifier IndexWriter<br> -----------------------------------------------------------------------<br> Insert only 116 min 119 min 116 min<br> Insert/delete (big batches) – 135 min 125 min<br> Insert/delete (small batches) – 338 min 134 min</p> 
                  <p>As the experiments show, with the proposed changes, the performance<br> improved by 60% when inserts and deletes were interleaved in small batches.</p> 
                  <p>Regards,<br> Ning</p> 
                  <p>Ning Li<br> Search Technologies<br> IBM Almaden Research Center<br> 650 Harry Road<br> San Jose, CA 95120</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-565?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-565?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-565?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-565?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12350827" data-issue-id="12333383" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12350827/LUCENE-565.Feb2007.patch" draggable="true" data-downloadurl="text/plain:LUCENE-565.Feb2007.patch:https://issues.apache.org/jira/secure/attachment/12350827/LUCENE-565.Feb2007.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12350827/LUCENE-565.Feb2007.patch" title="Latest  10/Feb/07 10:07 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-565.Feb2007.patch:https://issues.apache.org/jira/secure/attachment/12350827/LUCENE-565.Feb2007.patch">LUCENE-565.Feb2007.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-02-10T10:07:44.126Z">10/Feb/07 10:07</time>
                   </dd>
                   <dd class="attachment-size">
                    60 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12349660" data-issue-id="12333383" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12349660/NewIndexModifier.Jan2007.patch" draggable="true" data-downloadurl="text/plain:NewIndexModifier.Jan2007.patch:https://issues.apache.org/jira/secure/attachment/12349660/NewIndexModifier.Jan2007.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12349660/NewIndexModifier.Jan2007.patch" title="Latest  26/Jan/07 03:26 - Ning Li" draggable="true" data-downloadurl="text/plain:NewIndexModifier.Jan2007.patch:https://issues.apache.org/jira/secure/attachment/12349660/NewIndexModifier.Jan2007.patch">NewIndexModifier.Jan2007.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-01-26T03:26:49.181Z">26/Jan/07 03:26</time>
                   </dd>
                   <dd class="attachment-size">
                    33 kB
                   </dd>
                   <dd class="attachment-author">
                    Ning Li
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12349726" data-issue-id="12333383" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12349726/NewIndexModifier.Jan2007.take2.patch" draggable="true" data-downloadurl="text/plain:NewIndexModifier.Jan2007.take2.patch:https://issues.apache.org/jira/secure/attachment/12349726/NewIndexModifier.Jan2007.take2.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12349726/NewIndexModifier.Jan2007.take2.patch" title="Latest  27/Jan/07 12:06 - Michael McCandless" draggable="true" data-downloadurl="text/plain:NewIndexModifier.Jan2007.take2.patch:https://issues.apache.org/jira/secure/attachment/12349726/NewIndexModifier.Jan2007.take2.patch">NewIndexModifier.Jan2007.take2.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-01-27T12:06:56.839Z">27/Jan/07 12:06</time>
                   </dd>
                   <dd class="attachment-size">
                    33 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12349944" data-issue-id="12333383" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12349944/NewIndexModifier.Jan2007.take3.patch" draggable="true" data-downloadurl="text/plain:NewIndexModifier.Jan2007.take3.patch:https://issues.apache.org/jira/secure/attachment/12349944/NewIndexModifier.Jan2007.take3.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12349944/NewIndexModifier.Jan2007.take3.patch" title="Latest  30/Jan/07 17:55 - Michael McCandless" draggable="true" data-downloadurl="text/plain:NewIndexModifier.Jan2007.take3.patch:https://issues.apache.org/jira/secure/attachment/12349944/NewIndexModifier.Jan2007.take3.patch">NewIndexModifier.Jan2007.take3.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-01-30T17:55:31.542Z">30/Jan/07 17:55</time>
                   </dd>
                   <dd class="attachment-size">
                    33 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12341314" data-issue-id="12333383" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12341314/NewIndexModifier.Sept21.patch" draggable="true" data-downloadurl="text/plain:NewIndexModifier.Sept21.patch:https://issues.apache.org/jira/secure/attachment/12341314/NewIndexModifier.Sept21.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12341314/NewIndexModifier.Sept21.patch" title="Latest  21/Sep/06 17:15 - Ning Li" draggable="true" data-downloadurl="text/plain:NewIndexModifier.Sept21.patch:https://issues.apache.org/jira/secure/attachment/12341314/NewIndexModifier.Sept21.patch">NewIndexModifier.Sept21.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-09-21T17:15:15.000Z">21/Sep/06 17:15</time>
                   </dd>
                   <dd class="attachment-size">
                    18 kB
                   </dd>
                   <dd class="attachment-author">
                    Ning Li
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12339629" data-issue-id="12333383" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12339629/perfres.log" draggable="true" data-downloadurl="text/plain:perfres.log:https://issues.apache.org/jira/secure/attachment/12339629/perfres.log"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12339629/perfres.log" title="Latest  26/Aug/06 01:21 - Doron Cohen" draggable="true" data-downloadurl="text/plain:perfres.log:https://issues.apache.org/jira/secure/attachment/12339629/perfres.log">perfres.log</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-08-26T01:21:29.000Z">26/Aug/06 01:21</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Doron Cohen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12339628" data-issue-id="12333383" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12339628/perf-test-res.JPG" draggable="true" data-downloadurl="image/pjpeg:perf-test-res.JPG:https://issues.apache.org/jira/secure/attachment/12339628/perf-test-res.JPG" file-preview-id="12339628" file-preview-title="perf-test-res.JPG" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12339628/perf-test-res.JPG" title="Latest  26/Aug/06 01:21 - Doron Cohen" draggable="true" data-downloadurl="image/pjpeg:perf-test-res.JPG:https://issues.apache.org/jira/secure/attachment/12339628/perf-test-res.JPG" file-preview-id="12339628" file-preview-title="perf-test-res.JPG" file-preview-type="image">perf-test-res.JPG</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-08-26T01:21:29.000Z">26/Aug/06 01:21</time>
                   </dd>
                   <dd class="attachment-size">
                    73 kB
                   </dd>
                   <dd class="attachment-author">
                    Doron Cohen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12340014" data-issue-id="12333383" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12340014/perf-test-res2.JPG" draggable="true" data-downloadurl="image/pjpeg:perf-test-res2.JPG:https://issues.apache.org/jira/secure/attachment/12340014/perf-test-res2.JPG" file-preview-id="12340014" file-preview-title="perf-test-res2.JPG" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12340014/perf-test-res2.JPG" title="Latest  01/Sep/06 05:11 - Doron Cohen" draggable="true" data-downloadurl="image/pjpeg:perf-test-res2.JPG:https://issues.apache.org/jira/secure/attachment/12340014/perf-test-res2.JPG" file-preview-id="12340014" file-preview-title="perf-test-res2.JPG" file-preview-type="image">perf-test-res2.JPG</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-09-01T05:11:43.000Z">01/Sep/06 05:11</time>
                   </dd>
                   <dd class="attachment-size">
                    103 kB
                   </dd>
                   <dd class="attachment-author">
                    Doron Cohen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12339627" data-issue-id="12333383" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12339627/TestBufferedDeletesPerf.java" draggable="true" data-downloadurl="text/plain:TestBufferedDeletesPerf.java:https://issues.apache.org/jira/secure/attachment/12339627/TestBufferedDeletesPerf.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12339627/TestBufferedDeletesPerf.java" title="Latest  26/Aug/06 01:21 - Doron Cohen" draggable="true" data-downloadurl="text/plain:TestBufferedDeletesPerf.java:https://issues.apache.org/jira/secure/attachment/12339627/TestBufferedDeletesPerf.java">TestBufferedDeletesPerf.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-08-26T01:21:29.000Z">26/Aug/06 01:21</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Doron Cohen
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="is cloned by">
                   is cloned by
                  </dt> 
                  <dd id="internal-12349945_10020"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype" width="16" height="16" title="New Feature - A new feature of the product, which has yet to be developed." alt="New Feature - A new feature of the product, which has yet to be developed."> <span title="LUCENE-672: new merge policy"> <a href="/jira/browse/LUCENE-672" data-issue-key="LUCENE-672" class="issue-link link-title resolution">LUCENE-672</a> <span class="link-summary">new merge policy</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_mikemccand" rel="mikemccand" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Michael McCandless&quot;,&quot;emailAddress&quot;:&quot;lucene@mikemccandless.com&quot;,&quot;username&quot;:&quot;mikemccand&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mikemccand"></span></span> Michael McCandless </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_ningli" rel="ningli" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Ning Li&quot;,&quot;emailAddress&quot;:&quot;ning.li.li@gmail.com&quot;,&quot;username&quot;:&quot;ningli&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="ningli"></span></span> Ning Li </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">8</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">6</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="09/May/06 06:39"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2006-05-09T06:39:35+0000">09/May/06 06:39</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="27/Feb/07 18:10"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-02-27T18:10:33+0000">27/Feb/07 18:10</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="13/Feb/07 10:56"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-02-13T10:56:09+0000">13/Feb/07 10:56</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-565?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-565?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12378557\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12378557&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378557\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12378557_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378557_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/May\\/06 09:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-09T09:24:34+0000\'\u003e09\\/May\\/06 09:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan you please attach diffs rather than complete files?  The diffs should not not contain CHANGE comments.  To generate diffs, check Lucene out of Subversion, make your changes, then, from the Lucene trunk, run something like \'svn diff &gt; my.patch\'.  New files should first be added with \'svn add\' so that they\'re included in the diff.  Thanks!\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12378557_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378557_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/May\\/06 09:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-09T09:24:34+0000\'\u003e09\\/May\\/06 09:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can you please attach diffs rather than complete files?  The diffs should not not contain CHANGE comments.  To generate diffs, check Lucene out of Subversion, make your changes, then, from the Lucene trunk, run something like \'svn diff &gt; my.patch\'.  New files should first be added with \'svn add\' so that they\'re included in the diff.  Thanks! \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378673\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12378673&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378673\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12378673_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378673_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 00:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T00:52:39+0000\'\u003e10\\/May\\/06 00:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is the diff file of IndexWriter.java.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12378673_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378673_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/May\\/06 00:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-10T00:52:39+0000\'\u003e10\\/May\\/06 00:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is the diff file of IndexWriter.java.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12419396\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12419396&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12419396\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12419396_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12419396_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Jul\\/06 10:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-06T10:25:15+0000\'\u003e06\\/Jul\\/06 10:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI took a look at the patch and it looks good to me (anyone else had a look)?\u003cbr\\/\u003e\\nUnfortunately, I couldn\'t get the patch to apply \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e$ patch -F3 &lt; IndexWriter.patch\u003cbr\\/\u003e\\n(Stripping trailing CRs from patch.)\u003cbr\\/\u003e\\npatching file IndexWriter.java\u003cbr\\/\u003e\\nHunk #1 succeeded at 58 with fuzz 1.\u003cbr\\/\u003e\\nHunk #2 succeeded at 112 (offset 2 lines).\u003cbr\\/\u003e\\nHunk #4 succeeded at 504 (offset 33 lines).\u003cbr\\/\u003e\\nHunk #6 succeeded at 605 with fuzz 2 (offset 57 lines).\u003cbr\\/\u003e\\nmissing header for unified diff at line 259 of patch\u003cbr\\/\u003e\\n(Stripping trailing CRs from patch.)\u003cbr\\/\u003e\\ncan\'t find file to patch at input line 259\u003cbr\\/\u003e\\nPerhaps you should have used the -p or --strip option?\u003cbr\\/\u003e\\nThe text leading up to this was:\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\nFile to patch: IndexWriter.java\u003cbr\\/\u003e\\npatching file IndexWriter.java\u003cbr\\/\u003e\\nHunk #1 FAILED at 802.\u003cbr\\/\u003e\\nHunk #2 succeeded at 745 with fuzz 2 (offset -131 lines).\u003cbr\\/\u003e\\n1 out of 2 hunks FAILED &#8211; saving rejects to file IndexWriter.java.rej\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eWould it be possible for you to regenerate the patch against IndexWriter in HEAD?\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, I noticed ^Ms in the patch, but I can take care of those easily (dos2unix).\u003c\\/p\u003e\\n\\n\u003cp\u003eFinally, I noticed in 2-3 places that the simple logging via \\\"infoStream\\\" variable was removed, for example:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eif (infoStream != null) infoStream.print(\\\"merging segments\\\");\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003ePerhaps this was just an oversight?\u003c\\/p\u003e\\n\\n\u003cp\u003eLooking forward to the new patch. Thanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12419396_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12419396_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Jul\\/06 10:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-06T10:25:15+0000\'\u003e06\\/Jul\\/06 10:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I took a look at the patch and it looks good to me (anyone else had a look)? \\nUnfortunately, I couldn\'t get the patch to apply   \\n\\n $ patch -F3 &lt; IndexWriter.patch \\n(Stripping trailing CRs from patch.) \\npatching file IndexWriter.java \\nHunk #1 succeeded at 58 with fuzz 1. \\nHunk #2 succeeded at 112 (offset 2 lines). \\nHunk #4 succeeded at 504 (offset 33 lines). \\nHunk #6 succeeded at 605 with fuzz 2 (offset 57 lines). \\nmissing header for unified diff at line 259 of patch \\n(Stripping trailing CRs from patch.) \\ncan\'t find file to patch at input line 259 \\nPerhaps you should have used the -p or --strip option? \\nThe text leading up to this was: \\n... \\n... \\n... \\nFile to patch: IndexWriter.java \\npatching file IndexWriter.java \\nHunk #1 FAILED at 802. \\nHunk #2 succeeded at 745 with fuzz 2 (offset -131 lines). \\n1 out of 2 hunks FAILED &#8211; saving rejects to file IndexWriter.java.rej \\n\\n\\n Would it be possible for you to regenerate the patch against IndexWriter in HEAD? \\n\\n Also, I noticed ^Ms in the patch, but I can take care of those easily (dos2unix). \\n\\n Finally, I noticed in 2-3 places that the simple logging via \\\"infoStream\\\" variable was removed, for example: \\n \\n\\t if (infoStream != null) infoStream.print(\\\"merging segments\\\"); \\n \\n\\n\\n Perhaps this was just an oversight? \\n\\n Looking forward to the new patch. Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12419580\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12419580&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12419580\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12419580_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12419580_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jul\\/06 01:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-07T01:46:45+0000\'\u003e07\\/Jul\\/06 01:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor an overview of my changes, I\'ll repeat some of what I said in\u003cbr\\/\u003e\\nmy earlier e-mail (see \u003ca href=\\\"http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/35143\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/35143\u003c\\/a\u003e),\u003cbr\\/\u003e\\nthen add more detail about specific coding changes.\u003c\\/p\u003e\\n\\n\u003cp\u003eOverview\u003cbr\\/\u003e\\n--------\u003cbr\\/\u003e\\nToday, applications have to open\\/close an IndexWriter and\u003cbr\\/\u003e\\nopen\\/close an IndexReader directly or indirectly (via IndexModifier)\u003cbr\\/\u003e\\nin order to handle a mix of inserts and deletes. This performs well\u003cbr\\/\u003e\\nwhen inserts and deletes come in fairly large batches. However, the\u003cbr\\/\u003e\\nperformance can degrade dramatically when inserts and deletes are\u003cbr\\/\u003e\\ninterleaved in small batches. This is because the ramDirectory is\u003cbr\\/\u003e\\nflushed to disk whenever an IndexWriter is closed, causing a lot of\u003cbr\\/\u003e\\nsmall segments to be created on disk, which eventually need to be\u003cbr\\/\u003e\\nmerged.\u003c\\/p\u003e\\n\\n\u003cp\u003eAPI Changes\u003cbr\\/\u003e\\n-----------\u003cbr\\/\u003e\\nWe propose adding a \\\"deleteDocuments(Term term)\\\" method to\u003cbr\\/\u003e\\nIndexWriter. Using this method, inserts and deletes can be\u003cbr\\/\u003e\\ninterleaved using the same IndexWriter.\u003c\\/p\u003e\\n\\n\u003cp\u003eCoding Changes\u003cbr\\/\u003e\\n--------------\u003cbr\\/\u003e\\nCoding changes are localized to IndexWriter. Internally, the new\u003cbr\\/\u003e\\ndeleteDocuments() method works by buffering the terms to be deleted.\u003cbr\\/\u003e\\nDeletes are deferred until the ramDirectory is flushed to disk,\u003cbr\\/\u003e\\neither because it becomes full or because the IndexWriter is closed.\u003cbr\\/\u003e\\nUsing Java synchronization, care is taken to ensure that an\u003cbr\\/\u003e\\ninterleaved sequence of inserts and deletes for the same document\u003cbr\\/\u003e\\nare properly serialized. \u003c\\/p\u003e\\n\\n\u003cp\u003eFor simplicity of explanation, let\'s assume the index resides in a\u003cbr\\/\u003e\\ndisk-based directory.\u003c\\/p\u003e\\n\\n\u003cp\u003eChanges to the IndexWriter variables:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003esegmentInfos used to store the info of all segments (on disk\u003cbr\\/\u003e\\n    or in ram). Now it only stores the info of segments on disk.\u003c\\/li\u003e\\n\\t\u003cli\u003eramSegmentInfos is a new variable which stores the info of just\u003cbr\\/\u003e\\n    ram segments.\u003c\\/li\u003e\\n\\t\u003cli\u003ebufferedDeleteTerms is a new variable which buffers delete terms\u003cbr\\/\u003e\\n    before they are applied.\u003c\\/li\u003e\\n\\t\u003cli\u003emaxBufferedDeleteTerms is similar to maxBufferedDocs. It controls\u003cbr\\/\u003e\\n    the max number of delete terms that can be buffered before they\u003cbr\\/\u003e\\n    must be flushed to disk.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eChanges to IndexWriter methods:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eaddDocument()\u003cbr\\/\u003e\\n    The info of the new ram segment is added to ramSegmentInfos.\u003c\\/li\u003e\\n\\t\u003cli\u003edeleteDocuments(), batchDeleteDocuments()\u003cbr\\/\u003e\\n    The terms are added to bufferedDeleteTerms. bufferedDeleteTerms\u003cbr\\/\u003e\\n    also records the current number of documents buffered in ram, so\u003cbr\\/\u003e\\n    the delete terms can be applied to ram segments as well as\u003cbr\\/\u003e\\n    the segments on disk.\u003c\\/li\u003e\\n\\t\u003cli\u003eflushRamSegments()\u003cbr\\/\u003e\\n    Step 1: Apply buffered delete terms to all the segments on disk.\u003cbr\\/\u003e\\n    Step 2: Merge all the ram segments into one segment on disk.\u003cbr\\/\u003e\\n    Step 3: Apply buffered delete terms to the new segment appropriately,\u003cbr\\/\u003e\\n            so that a delete term is only applied to the documents\u003cbr\\/\u003e\\n            buffered before it, but not to those buffered after it.\u003cbr\\/\u003e\\n    Step 4: Clean up and commit the change to the index (both the new\u003cbr\\/\u003e\\n            segment and the .del files if it applies).\u003c\\/li\u003e\\n\\t\u003cli\u003emaybeMergeSegments()\u003cbr\\/\u003e\\n    Before, a flush would be triggered only if enough documents were\u003cbr\\/\u003e\\n    buffered. Now a flush is triggered if enough documents are\u003cbr\\/\u003e\\n    buffered OR if enough delete terms are buffered.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12419580_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12419580_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jul\\/06 01:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-07T01:46:45+0000\'\u003e07\\/Jul\\/06 01:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For an overview of my changes, I\'ll repeat some of what I said in \\nmy earlier e-mail (see  http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/35143 ), \\nthen add more detail about specific coding changes. \\n\\n Overview \\n-------- \\nToday, applications have to open\\/close an IndexWriter and \\nopen\\/close an IndexReader directly or indirectly (via IndexModifier) \\nin order to handle a mix of inserts and deletes. This performs well \\nwhen inserts and deletes come in fairly large batches. However, the \\nperformance can degrade dramatically when inserts and deletes are \\ninterleaved in small batches. This is because the ramDirectory is \\nflushed to disk whenever an IndexWriter is closed, causing a lot of \\nsmall segments to be created on disk, which eventually need to be \\nmerged. \\n\\n API Changes \\n----------- \\nWe propose adding a \\\"deleteDocuments(Term term)\\\" method to \\nIndexWriter. Using this method, inserts and deletes can be \\ninterleaved using the same IndexWriter. \\n\\n Coding Changes \\n-------------- \\nCoding changes are localized to IndexWriter. Internally, the new \\ndeleteDocuments() method works by buffering the terms to be deleted. \\nDeletes are deferred until the ramDirectory is flushed to disk, \\neither because it becomes full or because the IndexWriter is closed. \\nUsing Java synchronization, care is taken to ensure that an \\ninterleaved sequence of inserts and deletes for the same document \\nare properly serialized.  \\n\\n For simplicity of explanation, let\'s assume the index resides in a \\ndisk-based directory. \\n\\n Changes to the IndexWriter variables: \\n \\n\\t segmentInfos used to store the info of all segments (on disk \\n    or in ram). Now it only stores the info of segments on disk. \\n\\t ramSegmentInfos is a new variable which stores the info of just \\n    ram segments. \\n\\t bufferedDeleteTerms is a new variable which buffers delete terms \\n    before they are applied. \\n\\t maxBufferedDeleteTerms is similar to maxBufferedDocs. It controls \\n    the max number of delete terms that can be buffered before they \\n    must be flushed to disk. \\n \\n\\n\\n Changes to IndexWriter methods: \\n \\n\\t addDocument() \\n    The info of the new ram segment is added to ramSegmentInfos. \\n\\t deleteDocuments(), batchDeleteDocuments() \\n    The terms are added to bufferedDeleteTerms. bufferedDeleteTerms \\n    also records the current number of documents buffered in ram, so \\n    the delete terms can be applied to ram segments as well as \\n    the segments on disk. \\n\\t flushRamSegments() \\n    Step 1: Apply buffered delete terms to all the segments on disk. \\n    Step 2: Merge all the ram segments into one segment on disk. \\n    Step 3: Apply buffered delete terms to the new segment appropriately, \\n            so that a delete term is only applied to the documents \\n            buffered before it, but not to those buffered after it. \\n    Step 4: Clean up and commit the change to the index (both the new \\n            segment and the .del files if it applies). \\n\\t maybeMergeSegments() \\n    Before, a flush would be triggered only if enough documents were \\n    buffered. Now a flush is triggered if enough documents are \\n    buffered OR if enough delete terms are buffered. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12419605\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12419605&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12419605\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12419605_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12419605_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jul\\/06 04:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-07T04:31:58+0000\'\u003e07\\/Jul\\/06 04:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for all the information about coding changes, that makes it easier to understand the diff.\u003cbr\\/\u003e\\nIdeally this will become comments in the new diff, which I can commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eYonik mentioned this in email.  It does sound like a better place for this might be in a higher level class.  IndexWriter would really not be just a writer\\/appender once delete functionality is added to it, even if it\'s the IndexReaders behind the scenes doing the work.  So if you are going to be redoing the patch, consider this.\u003c\\/p\u003e\\n\\n\u003cp\u003ePerhaps IndexModifier methods should be deprecated and it should get a new\\/your API?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12419605_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12419605_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Jul\\/06 04:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-07T04:31:58+0000\'\u003e07\\/Jul\\/06 04:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for all the information about coding changes, that makes it easier to understand the diff. \\nIdeally this will become comments in the new diff, which I can commit. \\n\\n Yonik mentioned this in email.  It does sound like a better place for this might be in a higher level class.  IndexWriter would really not be just a writer\\/appender once delete functionality is added to it, even if it\'s the IndexReaders behind the scenes doing the work.  So if you are going to be redoing the patch, consider this. \\n\\n Perhaps IndexModifier methods should be deprecated and it should get a new\\/your API?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12419942\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12419942&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12419942\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12419942_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12419942_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jul\\/06 10:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-10T10:38:37+0000\'\u003e10\\/Jul\\/06 10:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Otis,\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve attached two patch files:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eIndexWriter.July09.patch is an updated version of the old patch.\u003c\\/li\u003e\\n\\t\u003cli\u003eNewIndexModifier.July09.patch makes minimal changes to IndexWriter and puts new functionalities in a new class called NewIndexModifier. I didn\'t name it IndexModifier because the two are unrelated and I don\'t want a diff of the two.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAll unit test succeeded except the following one:\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Testcase: testIndex(org.apache.lucene.index.TestIndexModifier):\\tFAILED\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e expected:&lt;3&gt; but was:&lt;4&gt;\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e junit.framework.AssertionFailedError: expected:&lt;3&gt; but was:&lt;4&gt;\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e \\tat org.apache.lucene.index.TestIndexModifier.testIndex(TestIndexModifier.java:67)\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, the unit test has a problem, not the patch: IndexWriter\'s docCount() does not tell the actual number of documents in an index, only IndexReader\'s numDocs() does. For example, in a similar test below, where 10 documents are added, then 1 deleted, then 2 added, the last call to docCount() returns 12, not 11, with or without the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003e  public void testIndexSimple() throws IOException {\u003cbr\\/\u003e\\n    Directory ramDir = new RAMDirectory();\u003cbr\\/\u003e\\n    IndexModifier i = new IndexModifier(ramDir, new StandardAnalyzer(), true);\u003cbr\\/\u003e\\n    \\/\\/ add 10 documents initially\u003cbr\\/\u003e\\n    for (int count = 0; count &lt; 10; count++) \u003c\\/p\u003e\\n{\\n       i.addDocument(getDoc());\\n    }\\n\u003cp\u003e    i.flush();\u003cbr\\/\u003e\\n    i.optimize();\u003cbr\\/\u003e\\n    assertEquals(10, i.docCount());\u003cbr\\/\u003e\\n    i.deleteDocument(0);\u003cbr\\/\u003e\\n    i.flush();\u003cbr\\/\u003e\\n    assertEquals(9, i.docCount());\u003cbr\\/\u003e\\n    i.addDocument(getDoc());\u003cbr\\/\u003e\\n    i.addDocument(getDoc());\u003cbr\\/\u003e\\n    i.flush();\u003cbr\\/\u003e\\n    assertEquals(12, i.docCount());\u003cbr\\/\u003e\\n  }\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reason for the docCount() difference in the unit test (which does not affect the correctness of the patch) is that flushRamSegments() in the patch merges all and only the segments in ram and write to disk, whereas the original flushRamSegments() merges not only the segments in ram but \u003cb\u003esometimes\u003c\\/b\u003e also one segment from disk (see in that function the comment \\\"\\/\\/ add one FS segment?\\\").\u003c\\/p\u003e\\n\\n\u003cp\u003eRegards,\u003cbr\\/\u003e\\nNing\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12419942_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12419942_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jul\\/06 10:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-10T10:38:37+0000\'\u003e10\\/Jul\\/06 10:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Otis, \\n\\n I\'ve attached two patch files: \\n \\n\\t IndexWriter.July09.patch is an updated version of the old patch. \\n\\t NewIndexModifier.July09.patch makes minimal changes to IndexWriter and puts new functionalities in a new class called NewIndexModifier. I didn\'t name it IndexModifier because the two are unrelated and I don\'t want a diff of the two. \\n \\n\\n\\n All unit test succeeded except the following one: \\n     &#91;junit&#93;  Testcase: testIndex(org.apache.lucene.index.TestIndexModifier):\\tFAILED \\n     &#91;junit&#93;  expected:&lt;3&gt; but was:&lt;4&gt; \\n     &#91;junit&#93;  junit.framework.AssertionFailedError: expected:&lt;3&gt; but was:&lt;4&gt; \\n     &#91;junit&#93;  \\tat org.apache.lucene.index.TestIndexModifier.testIndex(TestIndexModifier.java:67) \\n\\n However, the unit test has a problem, not the patch: IndexWriter\'s docCount() does not tell the actual number of documents in an index, only IndexReader\'s numDocs() does. For example, in a similar test below, where 10 documents are added, then 1 deleted, then 2 added, the last call to docCount() returns 12, not 11, with or without the patch. \\n\\n   public void testIndexSimple() throws IOException { \\n    Directory ramDir = new RAMDirectory(); \\n    IndexModifier i = new IndexModifier(ramDir, new StandardAnalyzer(), true); \\n    \\/\\/ add 10 documents initially \\n    for (int count = 0; count &lt; 10; count++)  \\n{\\n       i.addDocument(getDoc());\\n    }\\n     i.flush(); \\n    i.optimize(); \\n    assertEquals(10, i.docCount()); \\n    i.deleteDocument(0); \\n    i.flush(); \\n    assertEquals(9, i.docCount()); \\n    i.addDocument(getDoc()); \\n    i.addDocument(getDoc()); \\n    i.flush(); \\n    assertEquals(12, i.docCount()); \\n  } \\n\\n The reason for the docCount() difference in the unit test (which does not affect the correctness of the patch) is that flushRamSegments() in the patch merges all and only the segments in ram and write to disk, whereas the original flushRamSegments() merges not only the segments in ram but  sometimes  also one segment from disk (see in that function the comment \\\"\\/\\/ add one FS segment?\\\"). \\n\\n Regards, \\nNing              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12422007\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12422007&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12422007\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12422007_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12422007_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/06 00:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-19T00:32:20+0000\'\u003e19\\/Jul\\/06 00:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHopefully, third time\'s a charm. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI rewrote IndexWriter in such a way that semantically it\'s the same as before, but it provides extension points so that delete-by-term, delete-by-query, and more functionalities can be easily supported in a subclass. NewIndexModifier is such a subclass that supports delete-by-term.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere is an overview of the changes:\u003c\\/p\u003e\\n\\n\u003cp\u003eChanges to IndexWriter\u003cbr\\/\u003e\\nChanges to IndexWriter variables:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003esegmentInfos used to store the info of all segments (on disk or in ram). Now it\u003cbr\\/\u003e\\n    only stores the info of segments on disk.\u003c\\/li\u003e\\n\\t\u003cli\u003eramSegmentInfos is a new variable which stores the info of just ram segments.\u003cbr\\/\u003e\\nChanges to IndexWriter methods:\u003c\\/li\u003e\\n\\t\u003cli\u003eaddDocument()\u003cbr\\/\u003e\\n    The info of the new ram segment is added to ramSegmentInfos.\u003c\\/li\u003e\\n\\t\u003cli\u003emaybeMergeSegments()\u003cbr\\/\u003e\\n    toFlushRamSegments() is called at the beginning to decide whether a flush should take place.\u003c\\/li\u003e\\n\\t\u003cli\u003eflushRamSegments()\u003cbr\\/\u003e\\n    doAfterFlushRamSegments() is called after all ram segments are merged and flushed to disk.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eNewIndexModifier\u003cbr\\/\u003e\\nNew variables:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ebufferedDeleteTerms is a new variable which buffers delete terms\u003cbr\\/\u003e\\n    before they are applied.\u003c\\/li\u003e\\n\\t\u003cli\u003emaxBufferedDeleteTerms is similar to maxBufferedDocs. It controls\u003cbr\\/\u003e\\n    the max number of delete terms that can be buffered before they\u003cbr\\/\u003e\\n    must be flushed to disk.\u003cbr\\/\u003e\\nOverloaded\\/new methods:\u003c\\/li\u003e\\n\\t\u003cli\u003edeleteDocuments(), batchDeleteDocuments()\u003cbr\\/\u003e\\n    The terms are added to bufferedDeleteTerms. bufferedDeleteTerms\u003cbr\\/\u003e\\n    also records the current number of documents buffered in ram,\u003cbr\\/\u003e\\n    so the delete terms can be applied to ram segments as well as\u003cbr\\/\u003e\\n    the segments on disk.\u003c\\/li\u003e\\n\\t\u003cli\u003etoFlushRamSegments()\u003cbr\\/\u003e\\n    In IndexWriter, a flush would be triggered only if enough documents were\u003cbr\\/\u003e\\n    buffered. Now a flush is triggered if enough documents are\u003cbr\\/\u003e\\n    buffered OR if enough delete terms are buffered.\u003c\\/li\u003e\\n\\t\u003cli\u003edoAfterlushRamSegments()\u003cbr\\/\u003e\\n    Step 1: Apply buffered delete terms to all the segments on disk.\u003cbr\\/\u003e\\n    Step 2: Apply buffered delete terms to the new segment appropriately,\u003cbr\\/\u003e\\n            so that a delete term is only applied to the documents\u003cbr\\/\u003e\\n            buffered before it, but not to those buffered after it.\u003cbr\\/\u003e\\n    Step 3: Clean up the buffered delete terms.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12422007_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12422007_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/06 00:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-07-19T00:32:20+0000\'\u003e19\\/Jul\\/06 00:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hopefully, third time\'s a charm.   \\n\\n I rewrote IndexWriter in such a way that semantically it\'s the same as before, but it provides extension points so that delete-by-term, delete-by-query, and more functionalities can be easily supported in a subclass. NewIndexModifier is such a subclass that supports delete-by-term. \\n\\n Here is an overview of the changes: \\n\\n Changes to IndexWriter \\nChanges to IndexWriter variables: \\n \\n\\t segmentInfos used to store the info of all segments (on disk or in ram). Now it \\n    only stores the info of segments on disk. \\n\\t ramSegmentInfos is a new variable which stores the info of just ram segments. \\nChanges to IndexWriter methods: \\n\\t addDocument() \\n    The info of the new ram segment is added to ramSegmentInfos. \\n\\t maybeMergeSegments() \\n    toFlushRamSegments() is called at the beginning to decide whether a flush should take place. \\n\\t flushRamSegments() \\n    doAfterFlushRamSegments() is called after all ram segments are merged and flushed to disk. \\n \\n\\n\\n NewIndexModifier \\nNew variables: \\n \\n\\t bufferedDeleteTerms is a new variable which buffers delete terms \\n    before they are applied. \\n\\t maxBufferedDeleteTerms is similar to maxBufferedDocs. It controls \\n    the max number of delete terms that can be buffered before they \\n    must be flushed to disk. \\nOverloaded\\/new methods: \\n\\t deleteDocuments(), batchDeleteDocuments() \\n    The terms are added to bufferedDeleteTerms. bufferedDeleteTerms \\n    also records the current number of documents buffered in ram, \\n    so the delete terms can be applied to ram segments as well as \\n    the segments on disk. \\n\\t toFlushRamSegments() \\n    In IndexWriter, a flush would be triggered only if enough documents were \\n    buffered. Now a flush is triggered if enough documents are \\n    buffered OR if enough delete terms are buffered. \\n\\t doAfterlushRamSegments() \\n    Step 1: Apply buffered delete terms to all the segments on disk. \\n    Step 2: Apply buffered delete terms to the new segment appropriately, \\n            so that a delete term is only applied to the documents \\n            buffered before it, but not to those buffered after it. \\n    Step 3: Clean up the buffered delete terms. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12428035\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12428035&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12428035\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12428035_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428035_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/06 04:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-15T04:19:35+0000\'\u003e15\\/Aug\\/06 04:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI tried out this patch (July18), and have a few comments...\u003c\\/p\u003e\\n\\n\u003cp\u003eFirst, it is nice to be able to add\\/remove documents with no need to care for switching between readers and writers, and without worrying for performance issues as result of that switching. I did not test for performance yet.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis post is quite long, so here is an outline...\u003cbr\\/\u003e\\n(1) Compile error in test code\u003cbr\\/\u003e\\n(2) Failing tests - is this patch actually fixing a bug in current flushRamSegments()?\u003cbr\\/\u003e\\n(3) Additional tests I ran\u003cbr\\/\u003e\\n(4) Javadocs remarks\u003cbr\\/\u003e\\n(5) deleteDocument(int doc) not implemented\u003cbr\\/\u003e\\n(6) flush() not implemented\u003cbr\\/\u003e\\n(7) Method name - batchDeleteDocuments(Term[]) \u003cbr\\/\u003e\\n(8) Class name and placement + What\'s Next for this patch\u003c\\/p\u003e\\n\\n\u003cp\u003e------------ (1) Compile error in test code \u003cbr\\/\u003e\\nThe new TestWriterDelete does not reflect recent name change from IndexWriter to NewIndexModifier. Easily fixed by renaming accordingly in that file.\u003c\\/p\u003e\\n\\n\u003cp\u003e------------ (2) Failing tests - does this patch also fix a bug in current flushRamSegments()?\u003cbr\\/\u003e\\n\\\"ant test\\\" has one failure: TestIndexModifier.testIndex().\u003cbr\\/\u003e\\nThis is the same issue that Ning described above. However I think it exposes a bug in current flushRamSegments(): when an index with 1 segment on disk that has 2 documents, one of which is deleted, and 1 segment in memory, is closed, this method decides to merge - prematurely - the two segments into one. This wrong behavior (if I understand things correctly) is - by \\\"mistake\\\" - causing TestIndexModifier.testIndex() to pass in the current implementation of flushRamSegments(). But this comes with the cost of too many merges. If one is interleaving adds and deletes this bug would become costly. I will post a separate question on this to the dev forum, to discuss if this is indeed a bug.\u003c\\/p\u003e\\n\\n\u003cp\u003e------------ (3) Additional tests I ran \u003cbr\\/\u003e\\nI wanted to verify that all existing functions (well, at least tested ones..) are working with the new class (NewIndexModifier). So I temporarily renamed the existing IndexWriter to IndexWriter0, and renamed NewIndexModifier to IndexWriter (now extending IndexWriter0). For compiling, now, also had to temporarily modify args from IndexWriter to IndexWriter0 in 3 classes - DocumentWriter, SegmentMerger, and also from NewIndexModifier to IndexWriter in the new TestWriteDelete. (Note again: these modifications are temporary, just for the sake of testing this new class as if it was the new IndexWriter, which it is not.) Now all the tests were using the new class instead of the original IndexWriter. \u003c\\/p\u003e\\n\\n\u003cp\u003eAll tests passed, except for TestIndexModifier.testIndex() - this is the same failure as above - so, no problem detected in new class.\u003c\\/p\u003e\\n\\n\u003cp\u003e------------ (4) Javadocs Remarks\u003cbr\\/\u003e\\nCurrent Javadocs for the new class focus on changes to the implementation. I think this description of implementation changes should be made regular Java comments (for developers), and instead should add a shorter javadoc that describes the API for users, and the implications on behavior as result of buffering deletes.\u003c\\/p\u003e\\n\\n\u003cp\u003e------------ (5) deleteDocument(int doc) not implemented\u003cbr\\/\u003e\\nOriginal IndexModifier has a delete(int docs), the new class doesn\'t. At first this seems ok, since internal doc IDs are not accessible through index writer (unlike index reader). But IndexModifier also does not provide access to doc-ids. So why was delete-by-id enabled in IndexModifier? Perhaps there\'s a good reason for it, that I fail to see - if so, it should probably be added to the new class as well. Adding this is required if the new class would eventually replace the implementation of current index modifier.\u003c\\/p\u003e\\n\\n\u003cp\u003e------------ (6) flush() not implemented\u003cbr\\/\u003e\\nOriginal IndexModifier has a flush(int docs) method, allowing to commit any pending changes. I think it would be nice to have this feature here as well, for forcing any pending changes (without caller having to modify the max-bufferred value). This would allow more control when using this class. Again, adding this is required if the new class would eventually replace the implementation of current index modifier.\u003c\\/p\u003e\\n\\n\u003cp\u003e------------ (7) Method name - batchDeleteDocuments(Term[]) \u003cbr\\/\u003e\\nI would prefer it to be called deleteDocuments(Term[]), and let Java decide which method to call. Main reason is developers would expect that methods with similar semantics are named similarly, especially when using IDEs like Eclipse, where users type \\\"i.del\\\" and the IDE lets them select from all the methods that start with \\\"del\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003e------------ (8) Class name and placement + What\'s Next for this patch\u003cbr\\/\u003e\\nPerformance test should be added for this new class. Also, I did not code review the actual code changes to IndexWriter and the code of NewIndexModifier itself.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to me that this class would be very useful for users, either as a new class or if it replaces the current implementation of IndexModifier. Latter would be possible only if the 2 missing methods mentioned above are added. In this case, the \\\"immediate delete\\\" behavior of current IndexModifier should be possible to achieve by users, by setting maxBefferedDeleteTerms to 1.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne disadvantage of this class vs. current IndexModifier is the ability to add access to further methods of IndexReader. With current IndexModifier this is very simple (though not always efficient) - just follow code template in existing methods, i.e. close writer\\/reader and open reader\\/writer as required. With the new class, exposing further methods of IndexReader would be more of a challenge. Perhaps having a multiReader on all segment readers can do. I am not sure to what extent this should be a consideration, so just bringing it up. \u003c\\/p\u003e\\n\\n\u003cp\u003eSo, If this class replaces IndexModifier - fine. If not, how about calling it BufferredIndexWriter?\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eDoron\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12428035_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428035_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/06 04:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-15T04:19:35+0000\'\u003e15\\/Aug\\/06 04:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I tried out this patch (July18), and have a few comments... \\n\\n First, it is nice to be able to add\\/remove documents with no need to care for switching between readers and writers, and without worrying for performance issues as result of that switching. I did not test for performance yet. \\n\\n This post is quite long, so here is an outline... \\n(1) Compile error in test code \\n(2) Failing tests - is this patch actually fixing a bug in current flushRamSegments()? \\n(3) Additional tests I ran \\n(4) Javadocs remarks \\n(5) deleteDocument(int doc) not implemented \\n(6) flush() not implemented \\n(7) Method name - batchDeleteDocuments(Term[])  \\n(8) Class name and placement + What\'s Next for this patch \\n\\n ------------ (1) Compile error in test code  \\nThe new TestWriterDelete does not reflect recent name change from IndexWriter to NewIndexModifier. Easily fixed by renaming accordingly in that file. \\n\\n ------------ (2) Failing tests - does this patch also fix a bug in current flushRamSegments()? \\n\\\"ant test\\\" has one failure: TestIndexModifier.testIndex(). \\nThis is the same issue that Ning described above. However I think it exposes a bug in current flushRamSegments(): when an index with 1 segment on disk that has 2 documents, one of which is deleted, and 1 segment in memory, is closed, this method decides to merge - prematurely - the two segments into one. This wrong behavior (if I understand things correctly) is - by \\\"mistake\\\" - causing TestIndexModifier.testIndex() to pass in the current implementation of flushRamSegments(). But this comes with the cost of too many merges. If one is interleaving adds and deletes this bug would become costly. I will post a separate question on this to the dev forum, to discuss if this is indeed a bug. \\n\\n ------------ (3) Additional tests I ran  \\nI wanted to verify that all existing functions (well, at least tested ones..) are working with the new class (NewIndexModifier). So I temporarily renamed the existing IndexWriter to IndexWriter0, and renamed NewIndexModifier to IndexWriter (now extending IndexWriter0). For compiling, now, also had to temporarily modify args from IndexWriter to IndexWriter0 in 3 classes - DocumentWriter, SegmentMerger, and also from NewIndexModifier to IndexWriter in the new TestWriteDelete. (Note again: these modifications are temporary, just for the sake of testing this new class as if it was the new IndexWriter, which it is not.) Now all the tests were using the new class instead of the original IndexWriter.  \\n\\n All tests passed, except for TestIndexModifier.testIndex() - this is the same failure as above - so, no problem detected in new class. \\n\\n ------------ (4) Javadocs Remarks \\nCurrent Javadocs for the new class focus on changes to the implementation. I think this description of implementation changes should be made regular Java comments (for developers), and instead should add a shorter javadoc that describes the API for users, and the implications on behavior as result of buffering deletes. \\n\\n ------------ (5) deleteDocument(int doc) not implemented \\nOriginal IndexModifier has a delete(int docs), the new class doesn\'t. At first this seems ok, since internal doc IDs are not accessible through index writer (unlike index reader). But IndexModifier also does not provide access to doc-ids. So why was delete-by-id enabled in IndexModifier? Perhaps there\'s a good reason for it, that I fail to see - if so, it should probably be added to the new class as well. Adding this is required if the new class would eventually replace the implementation of current index modifier. \\n\\n ------------ (6) flush() not implemented \\nOriginal IndexModifier has a flush(int docs) method, allowing to commit any pending changes. I think it would be nice to have this feature here as well, for forcing any pending changes (without caller having to modify the max-bufferred value). This would allow more control when using this class. Again, adding this is required if the new class would eventually replace the implementation of current index modifier. \\n\\n ------------ (7) Method name - batchDeleteDocuments(Term[])  \\nI would prefer it to be called deleteDocuments(Term[]), and let Java decide which method to call. Main reason is developers would expect that methods with similar semantics are named similarly, especially when using IDEs like Eclipse, where users type \\\"i.del\\\" and the IDE lets them select from all the methods that start with \\\"del\\\". \\n\\n ------------ (8) Class name and placement + What\'s Next for this patch \\nPerformance test should be added for this new class. Also, I did not code review the actual code changes to IndexWriter and the code of NewIndexModifier itself. \\n\\n It seems to me that this class would be very useful for users, either as a new class or if it replaces the current implementation of IndexModifier. Latter would be possible only if the 2 missing methods mentioned above are added. In this case, the \\\"immediate delete\\\" behavior of current IndexModifier should be possible to achieve by users, by setting maxBefferedDeleteTerms to 1. \\n\\n One disadvantage of this class vs. current IndexModifier is the ability to add access to further methods of IndexReader. With current IndexModifier this is very simple (though not always efficient) - just follow code template in existing methods, i.e. close writer\\/reader and open reader\\/writer as required. With the new class, exposing further methods of IndexReader would be more of a challenge. Perhaps having a multiReader on all segment readers can do. I am not sure to what extent this should be a consideration, so just bringing it up.  \\n\\n So, If this class replaces IndexModifier - fine. If not, how about calling it BufferredIndexWriter? \\n\\n \\n\\t Doron \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429780\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12429780&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429780\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12429780_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429780_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/06 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-22T19:00:37+0000\'\u003e22\\/Aug\\/06 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI tested just the IndexWriter from this code base, it does not seem to work.  NewIndexModifier does work.  I simply used IndexWriter to create several documents and then search for them.  Nothing came back even though it seems something was written to disk.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12429780_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429780_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/06 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-22T19:00:37+0000\'\u003e22\\/Aug\\/06 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I tested just the IndexWriter from this code base, it does not seem to work.  NewIndexModifier does work.  I simply used IndexWriter to create several documents and then search for them.  Nothing came back even though it seems something was written to disk.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12430128\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12430128&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12430128\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ninglili\\\" id=\\\"commentauthor_12430128_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ninglili\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ninglili\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12430128_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/06 22:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-23T22:42:08+0000\'\u003e23\\/Aug\\/06 22:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Yes I am including this patch as it is very useful for increasing\u003cbr\\/\u003e\\n&gt; the efficiency of updates as you described.  I will be conducting\u003cbr\\/\u003e\\n&gt; more tests and will post any results.  Yes a patch for IndexWriter\u003cbr\\/\u003e\\n&gt; will be useful so that the entirety of this build will work.\u003cbr\\/\u003e\\n&gt; Thanks!\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve attached a patch that works with the current code. The\u003cbr\\/\u003e\\nimplementation of IndexWriter and NewIndexModifier is the same as\u003cbr\\/\u003e\\nthe last patch. I removed the \\\"singleDocSegmentsCount\\\" optimization\u003cbr\\/\u003e\\nfrom this patch since my IndexWriter checks singleDocSegmentsCount\u003cbr\\/\u003e\\nby simply calling ramSegmentInfos.size().\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch had evolved with the help of many good discussions\u003cbr\\/\u003e\\n(thanks!) since it came out in May. Here is the current state of\u003cbr\\/\u003e\\nthe patch:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThis patch aims at enabling users to do inserts and general\u003cbr\\/\u003e\\n    deletes (delete-by-term, and later delete-by-query) without\u003cbr\\/\u003e\\n    switching between writers and readers.\u003c\\/li\u003e\\n\\t\u003cli\u003eThe goal is achieved by rewritting IndexWriter in such a way\u003cbr\\/\u003e\\n    that semantically it\'s the same as before, but it provides\u003cbr\\/\u003e\\n    extension points so that delete-by-term, delete-by-query, and\u003cbr\\/\u003e\\n    more functionalities can be easily supported in a subclass.\u003c\\/li\u003e\\n\\t\u003cli\u003eNewIndexModifier extends IndexWriter and supports delete-by-term\u003cbr\\/\u003e\\n    by simply overriding two methods: toFlushRamSegment() which\u003cbr\\/\u003e\\n    decides if a flush should happen, and doAfterFlushRamSegments()\u003cbr\\/\u003e\\n    which does proper work after a flush is done.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eSuggestions are welcome! Especially those that may help it get\u003cbr\\/\u003e\\ncommitted. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ninglili\\\" id=\\\"commentauthor_12430128_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ninglili\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ninglili\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12430128_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/06 22:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-23T22:42:08+0000\'\u003e23\\/Aug\\/06 22:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Yes I am including this patch as it is very useful for increasing \\n&gt; the efficiency of updates as you described.  I will be conducting \\n&gt; more tests and will post any results.  Yes a patch for IndexWriter \\n&gt; will be useful so that the entirety of this build will work. \\n&gt; Thanks! \\n\\n I\'ve attached a patch that works with the current code. The \\nimplementation of IndexWriter and NewIndexModifier is the same as \\nthe last patch. I removed the \\\"singleDocSegmentsCount\\\" optimization \\nfrom this patch since my IndexWriter checks singleDocSegmentsCount \\nby simply calling ramSegmentInfos.size(). \\n\\n This patch had evolved with the help of many good discussions \\n(thanks!) since it came out in May. Here is the current state of \\nthe patch: \\n \\n\\t This patch aims at enabling users to do inserts and general \\n    deletes (delete-by-term, and later delete-by-query) without \\n    switching between writers and readers. \\n\\t The goal is achieved by rewritting IndexWriter in such a way \\n    that semantically it\'s the same as before, but it provides \\n    extension points so that delete-by-term, delete-by-query, and \\n    more functionalities can be easily supported in a subclass. \\n\\t NewIndexModifier extends IndexWriter and supports delete-by-term \\n    by simply overriding two methods: toFlushRamSegment() which \\n    decides if a flush should happen, and doAfterFlushRamSegments() \\n    which does proper work after a flush is done. \\n \\n\\n\\n Suggestions are welcome! Especially those that may help it get \\ncommitted.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12430130\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12430130&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12430130\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ninglili\\\" id=\\\"commentauthor_12430130_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ninglili\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ninglili\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12430130_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/06 22:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-23T22:43:58+0000\'\u003e23\\/Aug\\/06 22:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDoron, thank you very much for the review! I want to briefly comment\u003cbr\\/\u003e\\non one of your comments:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; (5) deleteDocument(int doc) not implemented\u003c\\/p\u003e\\n\\n\u003cp\u003eI deliberately left that one out. This is because document ids are\u003cbr\\/\u003e\\nchanging as documents are deleted and segments are merged. Users\u003cbr\\/\u003e\\ndon\'t know exactly when segments are merged thus ids are changed\u003cbr\\/\u003e\\nwhen using IndexModifier. Thus I don\'t think it should be supported\u003cbr\\/\u003e\\nin IndexModifier at all.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ninglili\\\" id=\\\"commentauthor_12430130_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ninglili\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ninglili\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12430130_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/06 22:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-23T22:43:58+0000\'\u003e23\\/Aug\\/06 22:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Doron, thank you very much for the review! I want to briefly comment \\non one of your comments: \\n\\n &gt; (5) deleteDocument(int doc) not implemented \\n\\n I deliberately left that one out. This is because document ids are \\nchanging as documents are deleted and segments are merged. Users \\ndon\'t know exactly when segments are merged thus ids are changed \\nwhen using IndexModifier. Thus I don\'t think it should be supported \\nin IndexModifier at all.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12430361\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12430361&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12430361\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12430361_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12430361_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/06 23:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-24T23:42:37+0000\'\u003e24\\/Aug\\/06 23:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis IndexWriter seems to work.  Thanks.  Great work!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12430361_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12430361_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/06 23:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-24T23:42:37+0000\'\u003e24\\/Aug\\/06 23:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This IndexWriter seems to work.  Thanks.  Great work!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12430679\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12430679&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12430679\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12430679_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12430679_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Aug\\/06 01:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-26T01:21:29+0000\'\u003e26\\/Aug\\/06 01:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran a performance test for interleaved adds and removes - and compared between IndexModifier and NewIndexModifier. \u003c\\/p\u003e\\n\\n\u003cp\u003eFew setups were tested, with a few combinations of \\\"consecutive adds before a delete takes place\\\", maxBufferredDocs, and \\\"number of total test iterations\\\", where each iteration does the conseutive adds and then does the deletes.\u003c\\/p\u003e\\n\\n\u003cp\u003eEach setup ran in this order - orig indexModifier, new one, orig, new one, and the best time out of the two runs was used.\u003c\\/p\u003e\\n\\n\u003cp\u003eResults indicate that NewIndexModifier is far faster for most setups. \u003c\\/p\u003e\\n\\n\u003cp\u003eAttached is the performance test, the performance results, and the log of the run. The performance test is written as a Junit test, and it fails in case the original IndexModfier is faster than the new one by more than 1 second (smaller than 1 sec difference is considered noise). \u003c\\/p\u003e\\n\\n\u003cp\u003eTest was run on XP (SP1) with IBM JDK 1.5.\u003c\\/p\u003e\\n\\n\u003cp\u003eTest was first failing with \\\"access denied\\\" errors due to what seems to be an XP issue. So in order to run this test on XP (and probably other Windows platforms) the patch from \u003ca href=\\\"http:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-665\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-665\u003c\\/a\u003e should be applied first.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt is interesting to notice that in addition to preformance gain, NewIndexModifier seems less sensitive to \\\"access denied\\\" XP problems, because it closes\\/reopens readers and writers less frequently, and indeed, at least in my runs, these errors had to be bypassed (by the \\\"retry\\\" patch) only for the current index-modifier. \u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eDoron\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12430679_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12430679_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Aug\\/06 01:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-26T01:21:29+0000\'\u003e26\\/Aug\\/06 01:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran a performance test for interleaved adds and removes - and compared between IndexModifier and NewIndexModifier.  \\n\\n Few setups were tested, with a few combinations of \\\"consecutive adds before a delete takes place\\\", maxBufferredDocs, and \\\"number of total test iterations\\\", where each iteration does the conseutive adds and then does the deletes. \\n\\n Each setup ran in this order - orig indexModifier, new one, orig, new one, and the best time out of the two runs was used. \\n\\n Results indicate that NewIndexModifier is far faster for most setups.  \\n\\n Attached is the performance test, the performance results, and the log of the run. The performance test is written as a Junit test, and it fails in case the original IndexModfier is faster than the new one by more than 1 second (smaller than 1 sec difference is considered noise).  \\n\\n Test was run on XP (SP1) with IBM JDK 1.5. \\n\\n Test was first failing with \\\"access denied\\\" errors due to what seems to be an XP issue. So in order to run this test on XP (and probably other Windows platforms) the patch from  http:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-665  should be applied first. \\n\\n It is interesting to notice that in addition to preformance gain, NewIndexModifier seems less sensitive to \\\"access denied\\\" XP problems, because it closes\\/reopens readers and writers less frequently, and indeed, at least in my runs, these errors had to be bypassed (by the \\\"retry\\\" patch) only for the current index-modifier.  \\n\\n \\n\\t Doron \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12431342\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12431342&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12431342\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431342_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431342_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/06 19:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-29T19:55:25+0000\'\u003e29\\/Aug\\/06 19:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt seems this writer works, but then some mysterious happens to the index and the searcher can no longer read it.  I am using this in conjunction with Solr.  The index files look ok, however a search will return nothing.  I have seen this repeatedly over about 1 weeks time.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431342_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431342_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/06 19:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-29T19:55:25+0000\'\u003e29\\/Aug\\/06 19:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It seems this writer works, but then some mysterious happens to the index and the searcher can no longer read it.  I am using this in conjunction with Solr.  The index files look ok, however a search will return nothing.  I have seen this repeatedly over about 1 weeks time.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12431354\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12431354&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12431354\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12431354_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431354_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/06 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-29T20:20:37+0000\'\u003e29\\/Aug\\/06 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIs it that results that were returned are suddenly (say after updates) not returned anymore (indicating something bad happened to existing index)?\u003c\\/p\u003e\\n\\n\u003cp\u003eOr is it that the search does not reflect recent changes? \u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t remember how often Solr closes and re-opens the writer\\/modifier...  with this patch a delete does not immediately cause a \\\"flush to disk\\\" - so flushes are controlled by closing the NewIndexModifier (and re-opening, since there no flush() method) and by the limits for max-bufferred-docs and max-bufferred-deletes. If this seems relevant to your case, what limits are in effect?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12431354_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431354_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/06 20:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-29T20:20:37+0000\'\u003e29\\/Aug\\/06 20:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Is it that results that were returned are suddenly (say after updates) not returned anymore (indicating something bad happened to existing index)? \\n\\n Or is it that the search does not reflect recent changes?  \\n\\n I don\'t remember how often Solr closes and re-opens the writer\\/modifier...  with this patch a delete does not immediately cause a \\\"flush to disk\\\" - so flushes are controlled by closing the NewIndexModifier (and re-opening, since there no flush() method) and by the limits for max-bufferred-docs and max-bufferred-deletes. If this seems relevant to your case, what limits are in effect?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12431400\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12431400&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12431400\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431400_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431400_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/06 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-29T22:48:22+0000\'\u003e29\\/Aug\\/06 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI started to flush the deletes after making them, which opens a new NewIndexModifier afterwards.  I still see the same thing.  I am starting off by deleting all documents by matching on a Term that all of them have.  Commit (reopen), then perform a batch addDocuments.  Then when a search is executed nothing is returned, and after an optimize the index goes down to 1K.  Seems like some peculiarity in NewIndexModifier.  Seems like the new documents are deleted even after they are added.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431400_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431400_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Aug\\/06 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-29T22:48:22+0000\'\u003e29\\/Aug\\/06 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I started to flush the deletes after making them, which opens a new NewIndexModifier afterwards.  I still see the same thing.  I am starting off by deleting all documents by matching on a Term that all of them have.  Commit (reopen), then perform a batch addDocuments.  Then when a search is executed nothing is returned, and after an optimize the index goes down to 1K.  Seems like some peculiarity in NewIndexModifier.  Seems like the new documents are deleted even after they are added.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12431419\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12431419&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12431419\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12431419_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431419_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Aug\\/06 00:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-30T00:16:21+0000\'\u003e30\\/Aug\\/06 00:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust to make sure on the scenario - are you - \u003cbr\\/\u003e\\n(1) using NewIndexModifier at all, or \u003cbr\\/\u003e\\n(2) just letting Solr use this IndexWriter (with the code changes introduced to ebable NewIndexModifier) instead of the Lucene\'s svn-head (or cetrain release) IndexModifier. \u003c\\/p\u003e\\n\\n\u003cp\u003eAs is, Solr would not use NewIndexModifier or IndexModifier at all. \u003c\\/p\u003e\\n\\n\u003cp\u003eFor case (2) above the bufferred deletes logic is not in effect at all. \u003c\\/p\u003e\\n\\n\u003cp\u003eI wonder if it possibe to re-create this with a simple Lucene stand-alone (test) program rather than with Solr - it would be easier to analyze.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12431419_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431419_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Aug\\/06 00:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-30T00:16:21+0000\'\u003e30\\/Aug\\/06 00:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just to make sure on the scenario - are you -  \\n(1) using NewIndexModifier at all, or  \\n(2) just letting Solr use this IndexWriter (with the code changes introduced to ebable NewIndexModifier) instead of the Lucene\'s svn-head (or cetrain release) IndexModifier.  \\n\\n As is, Solr would not use NewIndexModifier or IndexModifier at all.  \\n\\n For case (2) above the bufferred deletes logic is not in effect at all.  \\n\\n I wonder if it possibe to re-create this with a simple Lucene stand-alone (test) program rather than with Solr - it would be easier to analyze.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12431423\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12431423&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12431423\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431423_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431423_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Aug\\/06 00:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-30T00:19:55+0000\'\u003e30\\/Aug\\/06 00:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGood points... I\'ve actually used both NewIndexModifier and the parent.  I\'ve tried writing a new UpdateHandler, and incorporating the new IndexWriter into DirectUpdateHandler2.  I will create a non-Solr reproduction of the issue.  I guess it has something to do with ths doc ids being reused and so the new documents that are added are also marked as deleted as the number of documents would match almost exactly after the rebuild.  I am not an expert in regards to that aspect of Lucene.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431423_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431423_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Aug\\/06 00:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-30T00:19:55+0000\'\u003e30\\/Aug\\/06 00:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Good points... I\'ve actually used both NewIndexModifier and the parent.  I\'ve tried writing a new UpdateHandler, and incorporating the new IndexWriter into DirectUpdateHandler2.  I will create a non-Solr reproduction of the issue.  I guess it has something to do with ths doc ids being reused and so the new documents that are added are also marked as deleted as the number of documents would match almost exactly after the rebuild.  I am not an expert in regards to that aspect of Lucene.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12431475\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12431475&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12431475\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431475_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431475_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Aug\\/06 05:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-30T05:40:27+0000\'\u003e30\\/Aug\\/06 05:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHaving trouble reproducing this.  Probably something in the other code.  Thanks for the help and the patch, I feel more confident in it now.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431475_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431475_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Aug\\/06 05:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-30T05:40:27+0000\'\u003e30\\/Aug\\/06 05:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Having trouble reproducing this.  Probably something in the other code.  Thanks for the help and the patch, I feel more confident in it now.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12431757\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12431757&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12431757\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431757_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431757_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Aug\\/06 00:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-31T00:24:24+0000\'\u003e31\\/Aug\\/06 00:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI figured out the problem, the Solr DirectUpdateHandler2 expects to delete only a certain number of documents specifically the oldest first in some cases by using TermDocs and deleting by the doc id.  NewIndexModifier deletes at the level of the SegmentReader however.  Any good way to do this?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonhusong\\\" id=\\\"commentauthor_12431757_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonhusong\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonhusong\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12431757_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Aug\\/06 00:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-31T00:24:24+0000\'\u003e31\\/Aug\\/06 00:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I figured out the problem, the Solr DirectUpdateHandler2 expects to delete only a certain number of documents specifically the oldest first in some cases by using TermDocs and deleting by the doc id.  NewIndexModifier deletes at the level of the SegmentReader however.  Any good way to do this?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12432046\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12432046&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12432046\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12432046_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12432046_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/06 05:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-01T05:11:43+0000\'\u003e01\\/Sep\\/06 05:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated performance test results - perf-test-res2.JPG - in avarage, the new code is  \u003cb\u003e9\u003c\\/b\u003e  times faster!\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat have changed? - in previous test I forgot to set max-buffered-deletes. \u003c\\/p\u003e\\n\\n\u003cp\u003eAfter fixing so, I removed the test cases with max-buffer of 5,000 and up, because they consumed too much memory, and added more practical (I think) cases of 2000 and 3000. \u003c\\/p\u003e\\n\\n\u003cp\u003eHere is a textual summary of the data in the attached image:\u003c\\/p\u003e\\n\\n\u003cp\u003emax buf add\\/del         10          10       100      1000     2000      3000\u003cbr\\/\u003e\\niterations                       1          10        100       100      200          300\u003cbr\\/\u003e\\nadds\\/iteration             10          10         10          10       10              10\u003cbr\\/\u003e\\ndels\\/iteration                 5            5           5            5        5                  5\u003cbr\\/\u003e\\norig time (sec)           0.13      0.86        9.57      8.88    22.74      44.01\u003cbr\\/\u003e\\nnew  time (sec)          0.20      0.95       1.74      1.30    2.16          3.08\u003cbr\\/\u003e\\nImprovement (sec)    -0.07    -0.09      7.83      7.58    20.58      40.94\u003cbr\\/\u003e\\nImprovement  (%)     -55%     -11%      82%      85%      90%      93%\u003c\\/p\u003e\\n\\n\u003cp\u003eNote: for the first two cases new code is slower by 11% and 55%, but this is a very short test case, - the absolute difference here is less than 100ms, comparing to the other cases, where the difference is measured in seconds and 10\'s of seconds.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12432046_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12432046_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/06 05:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-01T05:11:43+0000\'\u003e01\\/Sep\\/06 05:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated performance test results - perf-test-res2.JPG - in avarage, the new code is   9   times faster! \\n\\n What have changed? - in previous test I forgot to set max-buffered-deletes.  \\n\\n After fixing so, I removed the test cases with max-buffer of 5,000 and up, because they consumed too much memory, and added more practical (I think) cases of 2000 and 3000.  \\n\\n Here is a textual summary of the data in the attached image: \\n\\n max buf add\\/del         10          10       100      1000     2000      3000 \\niterations                       1          10        100       100      200          300 \\nadds\\/iteration             10          10         10          10       10              10 \\ndels\\/iteration                 5            5           5            5        5                  5 \\norig time (sec)           0.13      0.86        9.57      8.88    22.74      44.01 \\nnew  time (sec)          0.20      0.95       1.74      1.30    2.16          3.08 \\nImprovement (sec)    -0.07    -0.09      7.83      7.58    20.58      40.94 \\nImprovement  (%)     -55%     -11%      82%      85%      90%      93% \\n\\n Note: for the first two cases new code is slower by 11% and 55%, but this is a very short test case, - the absolute difference here is less than 100ms, comparing to the other cases, where the difference is measured in seconds and 10\'s of seconds.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12432155\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12432155&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12432155\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12432155_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12432155_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/06 14:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-01T14:57:55+0000\'\u003e01\\/Sep\\/06 14:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; the new code is \u003cb\u003e9\u003c\\/b\u003e times faster! \u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s a bit apples-and-oranges \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  I don\'t think people use IndexModifier when they need performance... they buffer things and do them in batches.\u003c\\/p\u003e\\n\\n\u003cp\u003eIMO, performance of \u003cb\u003eexisting\u003c\\/b\u003e code using IndexWriter is more important, and what I would be interested in.  Say indexing 10000 documents to a RamDirectory with default settings (no deletes at all).  I haven\'t had a chance to review the new code, so I don\'t know if it\'s something to worry about or not.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12432155_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12432155_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/06 14:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-01T14:57:55+0000\'\u003e01\\/Sep\\/06 14:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; the new code is  9  times faster!  \\n\\n That\'s a bit apples-and-oranges    I don\'t think people use IndexModifier when they need performance... they buffer things and do them in batches. \\n\\n IMO, performance of  existing  code using IndexWriter is more important, and what I would be interested in.  Say indexing 10000 documents to a RamDirectory with default settings (no deletes at all).  I haven\'t had a chance to review the new code, so I don\'t know if it\'s something to worry about or not. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12432164\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12432164&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12432164\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12432164_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12432164_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/06 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-01T15:34:11+0000\'\u003e01\\/Sep\\/06 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI believe this patch probably also changes the merge behavior.\u003cbr\\/\u003e\\nI think we need to discuss what exactly the new merge behavior is, if it\'s OK, what we think the index invariants should be (no more than x segments of y size, etc), and I\'d like to see some code to test those invariants.\u003c\\/p\u003e\\n\\n\u003cp\u003eKeep in mind the difficulty of getting the last IndexWriter patch correct (and that was a very minor patch to keep track of the number of buffered docs!)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12432164_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12432164_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/06 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-01T15:34:11+0000\'\u003e01\\/Sep\\/06 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I believe this patch probably also changes the merge behavior. \\nI think we need to discuss what exactly the new merge behavior is, if it\'s OK, what we think the index invariants should be (no more than x segments of y size, etc), and I\'d like to see some code to test those invariants. \\n\\n Keep in mind the difficulty of getting the last IndexWriter patch correct (and that was a very minor patch to keep track of the number of buffered docs!)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12432216\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12432216&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12432216\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12432216_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12432216_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/06 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-01T19:49:21+0000\'\u003e01\\/Sep\\/06 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree - I also suspected it might change the merge behavior (and also had reflections from the repeated trials to have that simple Indexwriter buffered-docs patch correct...\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e. \u003c\\/p\u003e\\n\\n\u003cp\u003eGuess I just wanted to get a feeling if there is interest to include this patch before I delve into it too much - and the perf test was meant to see for my self if it really helps. I was a bit surprised that it speeds 9 times in an interleaving add\\/delete scenario. Guess this by itself now justifies delving into this patch, analyzing merge behavior as you suggest - will do - I think idealy should try this patch not to modify the merge behavior.\u003c\\/p\u003e\\n\\n\u003cp\u003eAbout the test - l was trying to test what I thought is a realistic use scenario (max-buf, etc.) - I have a fixed version of the perf test that is easier to modify for different scenarios - can upload it here if there is interest.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12432216_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12432216_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/06 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-01T19:49:21+0000\'\u003e01\\/Sep\\/06 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree - I also suspected it might change the merge behavior (and also had reflections from the repeated trials to have that simple Indexwriter buffered-docs patch correct... .  \\n\\n Guess I just wanted to get a feeling if there is interest to include this patch before I delve into it too much - and the perf test was meant to see for my self if it really helps. I was a bit surprised that it speeds 9 times in an interleaving add\\/delete scenario. Guess this by itself now justifies delving into this patch, analyzing merge behavior as you suggest - will do - I think idealy should try this patch not to modify the merge behavior. \\n\\n About the test - l was trying to test what I thought is a realistic use scenario (max-buf, etc.) - I have a fixed version of the perf test that is easier to modify for different scenarios - can upload it here if there is interest. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12433463\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12433463&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12433463\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ninglili\\\" id=\\\"commentauthor_12433463_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ninglili\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ninglili\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12433463_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/06 17:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-08T17:55:36+0000\'\u003e08\\/Sep\\/06 17:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch features the new more robust merge policy. Reference on the new policy is at \u003ca href=\\\"http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/35147\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/35147\u003c\\/a\u003e\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThe patch passes all the tests except that one in TestIndexModifier (see an earlier comment on this issue).\u003c\\/li\u003e\\n\\t\u003cli\u003eSince the test itself has a problem, it is fixed (one line change) and the patch passes the fixed test.\u003c\\/li\u003e\\n\\t\u003cli\u003eA new test call TestIndexWriterMergePolicy is included which shows the robustness of the new merge policy.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eThe following is a detailed description of the new merge policy and its properties.\u003c\\/p\u003e\\n\\n\u003cp\u003e Overview of merge policy:\u003c\\/p\u003e\\n\\n\u003cp\u003e A flush is triggered either by close() or by the number of ram segments\u003cbr\\/\u003e\\n reaching maxBufferedDocs. After a disk segment is created by the flush,\u003cbr\\/\u003e\\n further merges may be triggered.\u003c\\/p\u003e\\n\\n\u003cp\u003e LowerBound and upperBound set the limits on the doc count of a segment\u003cbr\\/\u003e\\n which may be merged. Initially, lowerBound is set to 0 and upperBound\u003cbr\\/\u003e\\n to maxBufferedDocs. Starting from the rightmost* segment whose doc count\u003cbr\\/\u003e\\n &gt; lowerBound and &lt;= upperBound, count the number of consecutive segments\u003cbr\\/\u003e\\n whose doc count &lt;= upperBound.\u003c\\/p\u003e\\n\\n\u003cp\u003e Case 1: number of worthy segments &lt; mergeFactor, no merge, done.\u003cbr\\/\u003e\\n Case 2: number of worthy segments == mergeFactor, merge these segments.\u003cbr\\/\u003e\\n         If the doc count of the merged segment &lt;= upperBound, done.\u003cbr\\/\u003e\\n         Otherwise, set lowerBound to upperBound, and multiply upperBound\u003cbr\\/\u003e\\n         by mergeFactor, go through the process again.\u003cbr\\/\u003e\\n Case 3: number of worthy segments &gt; mergeFactor (in the case mergeFactor\u003cbr\\/\u003e\\n         M changes), merge the leftmost* M segments. If the doc count of\u003cbr\\/\u003e\\n         the merged segment &lt;= upperBound, consider the merged segment for\u003cbr\\/\u003e\\n         further merges on this same level. Merge the now leftmost* M\u003cbr\\/\u003e\\n         segments, and so on, until number of worthy segments &lt; mergeFactor.\u003cbr\\/\u003e\\n         If the doc count of all the merged segments &lt;= upperBound, done.\u003cbr\\/\u003e\\n         Otherwise, set lowerBound to upperBound, and multiply upperBound\u003cbr\\/\u003e\\n         by mergeFactor, go through the process again.\u003cbr\\/\u003e\\n Note that case 2 can be considerd as a special case of case 3.\u003c\\/p\u003e\\n\\n\u003cp\u003e This merge policy guarantees two invariants if M does not change and\u003cbr\\/\u003e\\n segment doc count is not reaching maxMergeDocs:\u003cbr\\/\u003e\\n B for maxBufferedDocs, f\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/thumbs_down.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e defined as ceil(log_M(ceil(n\\/B)))\u003cbr\\/\u003e\\n      1: If i (left*) and i+1 (right*) are two consecutive segments of doc\u003cbr\\/\u003e\\n         counts x and y, then f\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/error.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e &gt;= f\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/thumbs_up.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003cbr\\/\u003e\\n      2: The number of committed segments on the same level (f\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/thumbs_down.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e) &lt;= M.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ninglili\\\" id=\\\"commentauthor_12433463_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ninglili\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ninglili\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12433463_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Sep\\/06 17:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-08T17:55:36+0000\'\u003e08\\/Sep\\/06 17:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch features the new more robust merge policy. Reference on the new policy is at  http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/35147  \\n \\n\\t The patch passes all the tests except that one in TestIndexModifier (see an earlier comment on this issue). \\n\\t Since the test itself has a problem, it is fixed (one line change) and the patch passes the fixed test. \\n\\t A new test call TestIndexWriterMergePolicy is included which shows the robustness of the new merge policy. \\n \\n\\n\\n\\n The following is a detailed description of the new merge policy and its properties. \\n\\n  Overview of merge policy: \\n\\n  A flush is triggered either by close() or by the number of ram segments \\n reaching maxBufferedDocs. After a disk segment is created by the flush, \\n further merges may be triggered. \\n\\n  LowerBound and upperBound set the limits on the doc count of a segment \\n which may be merged. Initially, lowerBound is set to 0 and upperBound \\n to maxBufferedDocs. Starting from the rightmost* segment whose doc count \\n &gt; lowerBound and &lt;= upperBound, count the number of consecutive segments \\n whose doc count &lt;= upperBound. \\n\\n  Case 1: number of worthy segments &lt; mergeFactor, no merge, done. \\n Case 2: number of worthy segments == mergeFactor, merge these segments. \\n         If the doc count of the merged segment &lt;= upperBound, done. \\n         Otherwise, set lowerBound to upperBound, and multiply upperBound \\n         by mergeFactor, go through the process again. \\n Case 3: number of worthy segments &gt; mergeFactor (in the case mergeFactor \\n         M changes), merge the leftmost* M segments. If the doc count of \\n         the merged segment &lt;= upperBound, consider the merged segment for \\n         further merges on this same level. Merge the now leftmost* M \\n         segments, and so on, until number of worthy segments &lt; mergeFactor. \\n         If the doc count of all the merged segments &lt;= upperBound, done. \\n         Otherwise, set lowerBound to upperBound, and multiply upperBound \\n         by mergeFactor, go through the process again. \\n Note that case 2 can be considerd as a special case of case 3. \\n\\n  This merge policy guarantees two invariants if M does not change and \\n segment doc count is not reaching maxMergeDocs: \\n B for maxBufferedDocs, f  defined as ceil(log_M(ceil(n\\/B))) \\n      1: If i (left*) and i+1 (right*) are two consecutive segments of doc \\n         counts x and y, then f  &gt;= f . \\n      2: The number of committed segments on the same level (f ) &lt;= M.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12434041\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12434041&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12434041\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12434041_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12434041_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/06 02:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-12T02:27:45+0000\'\u003e12\\/Sep\\/06 02:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for separating out the new merge policy Ning!  I\'m reviewing the patch now...\u003cbr\\/\u003e\\nAssuming everything looks good (it does so far), I\'m inclined to commit it.  I\'m just giving a heads up to other lucene developers as this is a change in behavior to core lucene.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the new merge policy is a positive change because:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eflushing all ram segments separately from disk segments allows more efficient implementations of combination reader\\/writers (like buffered deletes) because docids won\'t change from the flush alone (a merge is needed to change ids)\u003c\\/li\u003e\\n\\t\u003cli\u003eflushing all buffered docs together leaves more optimization possibilities... something other than single-doc segments could be used to buffer in-mem docs in the future.\u003c\\/li\u003e\\n\\t\u003cli\u003eincreases indexing performance in the presence of deleted documents or partially full segments (merges are minimized while the number of segments are maximized).\u003c\\/li\u003e\\n\\t\u003cli\u003efixes worst-case behavior that can cause the number of segments to grow too large (way more than mergefactor)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAre there any concerns?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12434041_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12434041_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/06 02:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-12T02:27:45+0000\'\u003e12\\/Sep\\/06 02:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for separating out the new merge policy Ning!  I\'m reviewing the patch now... \\nAssuming everything looks good (it does so far), I\'m inclined to commit it.  I\'m just giving a heads up to other lucene developers as this is a change in behavior to core lucene. \\n\\n I think the new merge policy is a positive change because: \\n \\n\\t flushing all ram segments separately from disk segments allows more efficient implementations of combination reader\\/writers (like buffered deletes) because docids won\'t change from the flush alone (a merge is needed to change ids) \\n\\t flushing all buffered docs together leaves more optimization possibilities... something other than single-doc segments could be used to buffer in-mem docs in the future. \\n\\t increases indexing performance in the presence of deleted documents or partially full segments (merges are minimized while the number of segments are maximized). \\n\\t fixes worst-case behavior that can cause the number of segments to grow too large (way more than mergefactor) \\n \\n\\n\\n Are there any concerns?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12434751\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12434751&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12434751\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12434751_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12434751_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/06 17:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-14T17:50:06+0000\'\u003e14\\/Sep\\/06 17:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI also did a quick indexing performance test w\\/ Solr:\u003c\\/p\u003e\\n\\n\u003cp\u003emaxBufferedDocs=100, mergeFactor=4, did 100K random overwriting adds in batches of 75 (75 docs added, dups deleted).\u003cbr\\/\u003e\\nIt was 12% faster with this new merge policy.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12434751_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12434751_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Sep\\/06 17:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-14T17:50:06+0000\'\u003e14\\/Sep\\/06 17:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I also did a quick indexing performance test w\\/ Solr: \\n\\n maxBufferedDocs=100, mergeFactor=4, did 100K random overwriting adds in batches of 75 (75 docs added, dups deleted). \\nIt was 12% faster with this new merge policy.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12436585\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12436585&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12436585\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ninglili\\\" id=\\\"commentauthor_12436585_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ninglili\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ninglili\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12436585_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Sep\\/06 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-21T17:15:15+0000\'\u003e21\\/Sep\\/06 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is to update the delete-support patch after the commit of the new merge policy.\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eVery few changes to IndexWriter.\u003c\\/li\u003e\\n\\t\u003cli\u003eThe patch passes all tests.\u003c\\/li\u003e\\n\\t\u003cli\u003eA new test call TestNewIndexModifierDelete is added to show different scenarios when using delete methods in NewIndexModifier.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ninglili\\\" id=\\\"commentauthor_12436585_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ninglili\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ninglili\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12436585_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Sep\\/06 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-09-21T17:15:15+0000\'\u003e21\\/Sep\\/06 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is to update the delete-support patch after the commit of the new merge policy. \\n \\n\\t Very few changes to IndexWriter. \\n\\t The patch passes all tests. \\n\\t A new test call TestNewIndexModifierDelete is added to show different scenarios when using delete methods in NewIndexModifier. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12447657\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12447657&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12447657\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli@us.ibm.com\\\" id=\\\"commentauthor_12447657_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli%40us.ibm.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli@us.ibm.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12447657_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Nov\\/06 06:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-11-07T06:22:40+0000\'\u003e07\\/Nov\\/06 06:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003e   [[ Old comment, sent by email on Thu, 6 Jul 2006 07:53:35 -0700 ]]\u003c\\/p\u003e\\n\\n\u003cp\u003eHi Otis,\u003c\\/p\u003e\\n\\n\u003cp\u003eI will regenerate the patch and add more comments. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eRegards,\u003cbr\\/\u003e\\nNing\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\u003cp\u003e             \\\"Otis Gospodnetic                                             \u003cbr\\/\u003e\\n             (JIRA)\\\"                                                       \u003cbr\\/\u003e\\n             &lt;jira@apache.org&gt;                                          To \u003cbr\\/\u003e\\n                                       ningli@almaden.ibm.com              \u003cbr\\/\u003e\\n             07\\/05\\/2006 11:25                                           cc \u003cbr\\/\u003e\\n             PM                                                            \u003cbr\\/\u003e\\n                                                                   Subject \u003cbr\\/\u003e\\n                                       \u003cspan class=\\\"error\\\"\u003e&#91;jira&#93;\u003c\\/span\u003e Commented: (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565\\\" title=\\\"Supporting deleteDocuments in IndexWriter (Code and Performance Results Provided)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-565\\\"\u003e\u003cdel\u003eLUCENE-565\u003c\\/del\u003e\u003c\\/a\u003e)      \u003cbr\\/\u003e\\n                                       Supporting deleteDocuments in       \u003cbr\\/\u003e\\n                                       IndexWriter (Code and Performance   \u003cbr\\/\u003e\\n                                       Results Provided)                   \u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\u003cp\u003e    [\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565?page=comments#action_12419396\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565?page=comments#action_12419396\u003c\\/a\u003e\u003cbr\\/\u003e\\n ]\u003c\\/p\u003e\\n\\n\u003cp\u003eOtis Gospodnetic commented on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565\\\" title=\\\"Supporting deleteDocuments in IndexWriter (Code and Performance Results Provided)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-565\\\"\u003e\u003cdel\u003eLUCENE-565\u003c\\/del\u003e\u003c\\/a\u003e:\u003cbr\\/\u003e\\n-----------------------------------------\u003c\\/p\u003e\\n\\n\u003cp\u003eI took a look at the patch and it looks good to me (anyone else had a\u003cbr\\/\u003e\\nlook)?\u003cbr\\/\u003e\\nUnfortunately, I couldn\'t get the patch to apply \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e$ patch -F3 &lt; IndexWriter.patch\u003cbr\\/\u003e\\n(Stripping trailing CRs from patch.)\u003cbr\\/\u003e\\npatching file IndexWriter.java\u003cbr\\/\u003e\\nHunk #1 succeeded at 58 with fuzz 1.\u003cbr\\/\u003e\\nHunk #2 succeeded at 112 (offset 2 lines).\u003cbr\\/\u003e\\nHunk #4 succeeded at 504 (offset 33 lines).\u003cbr\\/\u003e\\nHunk #6 succeeded at 605 with fuzz 2 (offset 57 lines).\u003cbr\\/\u003e\\nmissing header for unified diff at line 259 of patch\u003cbr\\/\u003e\\n(Stripping trailing CRs from patch.)\u003cbr\\/\u003e\\ncan\'t find file to patch at input line 259\u003cbr\\/\u003e\\nPerhaps you should have used the -p or --strip option?\u003cbr\\/\u003e\\nThe text leading up to this was:\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\nFile to patch: IndexWriter.java\u003cbr\\/\u003e\\npatching file IndexWriter.java\u003cbr\\/\u003e\\nHunk #1 FAILED at 802.\u003cbr\\/\u003e\\nHunk #2 succeeded at 745 with fuzz 2 (offset -131 lines).\u003cbr\\/\u003e\\n1 out of 2 hunks FAILED &#8211; saving rejects to file IndexWriter.java.rej\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eWould it be possible for you to regenerate the patch against IndexWriter in\u003cbr\\/\u003e\\nHEAD?\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, I noticed ^Ms in the patch, but I can take care of those easily\u003cbr\\/\u003e\\n(dos2unix).\u003c\\/p\u003e\\n\\n\u003cp\u003eFinally, I noticed in 2-3 places that the simple logging via \\\"infoStream\\\"\u003cbr\\/\u003e\\nvariable was removed, for example:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eif (infoStream != null) infoStream.print(\\\"merging segments\\\");\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003ePerhaps this was just an oversight?\u003c\\/p\u003e\\n\\n\u003cp\u003eLooking forward to the new patch. Thanks!\u003c\\/p\u003e\\n\\n\u003cp\u003eProvided)\u003cbr\\/\u003e\\n---------------------------------------------------------------------------------\u003c\\/p\u003e\\n\\n\\n\u003cp\u003ea\u003cbr\\/\u003e\\nIndexWriter\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/23049?search_string=indexwriter%20delete;#23049\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/23049?search_string=indexwriter%20delete;#23049\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eto\u003cbr\\/\u003e\\ndeleting\u003cbr\\/\u003e\\nversion\u003cbr\\/\u003e\\nusing\u003cbr\\/\u003e\\nbatches.\u003c\\/p\u003e\\n\\n\u003cp\u003e&#8211;\u003cbr\\/\u003e\\nThis message is automatically generated by JIRA.\u003cbr\\/\u003e\\n-\u003cbr\\/\u003e\\nIf you think it was sent incorrectly contact one of the administrators:\u003cbr\\/\u003e\\n   \u003ca href=\\\"http:\\/\\/issues.apache.org\\/jira\\/secure\\/Administrators.jspa\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/issues.apache.org\\/jira\\/secure\\/Administrators.jspa\u003c\\/a\u003e\u003cbr\\/\u003e\\n-\u003cbr\\/\u003e\\nFor more information on JIRA, see:\u003cbr\\/\u003e\\n   \u003ca href=\\\"http:\\/\\/www.atlassian.com\\/software\\/jira\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.atlassian.com\\/software\\/jira\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli@us.ibm.com\\\" id=\\\"commentauthor_12447657_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli%40us.ibm.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli@us.ibm.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12447657_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Nov\\/06 06:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-11-07T06:22:40+0000\'\u003e07\\/Nov\\/06 06:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n    [[ Old comment, sent by email on Thu, 6 Jul 2006 07:53:35 -0700 ]] \\n\\n Hi Otis, \\n\\n I will regenerate the patch and add more comments.   \\n\\n Regards, \\nNing \\n\\n\\n\\n\\n\\n              \\\"Otis Gospodnetic                                              \\n             (JIRA)\\\"                                                        \\n             &lt;jira@apache.org&gt;                                          To  \\n                                       ningli@almaden.ibm.com               \\n             07\\/05\\/2006 11:25                                           cc  \\n             PM                                                             \\n                                                                   Subject  \\n                                        &#91;jira&#93;  Commented: (  LUCENE-565  )       \\n                                       Supporting deleteDocuments in        \\n                                       IndexWriter (Code and Performance    \\n                                       Results Provided)                    \\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n     [ \\n http:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565?page=comments#action_12419396  \\n ] \\n\\n Otis Gospodnetic commented on   LUCENE-565  : \\n----------------------------------------- \\n\\n I took a look at the patch and it looks good to me (anyone else had a \\nlook)? \\nUnfortunately, I couldn\'t get the patch to apply   \\n\\n $ patch -F3 &lt; IndexWriter.patch \\n(Stripping trailing CRs from patch.) \\npatching file IndexWriter.java \\nHunk #1 succeeded at 58 with fuzz 1. \\nHunk #2 succeeded at 112 (offset 2 lines). \\nHunk #4 succeeded at 504 (offset 33 lines). \\nHunk #6 succeeded at 605 with fuzz 2 (offset 57 lines). \\nmissing header for unified diff at line 259 of patch \\n(Stripping trailing CRs from patch.) \\ncan\'t find file to patch at input line 259 \\nPerhaps you should have used the -p or --strip option? \\nThe text leading up to this was: \\n... \\n... \\n... \\nFile to patch: IndexWriter.java \\npatching file IndexWriter.java \\nHunk #1 FAILED at 802. \\nHunk #2 succeeded at 745 with fuzz 2 (offset -131 lines). \\n1 out of 2 hunks FAILED &#8211; saving rejects to file IndexWriter.java.rej \\n\\n\\n Would it be possible for you to regenerate the patch against IndexWriter in \\nHEAD? \\n\\n Also, I noticed ^Ms in the patch, but I can take care of those easily \\n(dos2unix). \\n\\n Finally, I noticed in 2-3 places that the simple logging via \\\"infoStream\\\" \\nvariable was removed, for example: \\n \\n\\t if (infoStream != null) infoStream.print(\\\"merging segments\\\"); \\n \\n\\n\\n Perhaps this was just an oversight? \\n\\n Looking forward to the new patch. Thanks! \\n\\n Provided) \\n--------------------------------------------------------------------------------- \\n\\n\\n a \\nIndexWriter \\n http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/23049?search_string=indexwriter%20delete;#23049  \\n\\n to \\ndeleting \\nversion \\nusing \\nbatches. \\n\\n &#8211; \\nThis message is automatically generated by JIRA. \\n- \\nIf you think it was sent incorrectly contact one of the administrators: \\n    http:\\/\\/issues.apache.org\\/jira\\/secure\\/Administrators.jspa  \\n- \\nFor more information on JIRA, see: \\n    http:\\/\\/www.atlassian.com\\/software\\/jira               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12452039\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12452039&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12452039\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12452039_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12452039_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/06 20:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-11-22T20:28:50+0000\'\u003e22\\/Nov\\/06 20:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWith the recent commits to IndexWriter, this patch no longer applies cleanly. The 5 votes for this issue encourages\u003cbr\\/\u003e\\nme to submit yet another patch. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e But before I do that, I\'d like to briefly describe the design again and welcome all\u003cbr\\/\u003e\\nsuggestions that help improve it and help get it committed. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the new merge policy committed, the change to IndexWriter is minimal: three zero-or-one-line functions are\u003cbr\\/\u003e\\nadded and used.\u003cbr\\/\u003e\\n  1 timeToFlushRam(): return true if number of ram segments &gt;= maxBufferedDocs and used in maybeFlushRamSegments()\u003cbr\\/\u003e\\n  2 anythingToFlushRam(): return true if number of ram segments &gt; 0 and used in flushRamSegments()\u003cbr\\/\u003e\\n  3 doAfterFlushRamSegments(): do nothing and called in mergeSegments() if the merge is on ram segments\u003c\\/p\u003e\\n\\n\u003cp\u003eThe new IndexModifier is a subclass of IndexWriter and only overwrites the three functions described above.\u003cbr\\/\u003e\\n  1 timeToFlushRam(): return true if number of ram segments &gt;= maxBufferedDocs OR if number of buffered\u003cbr\\/\u003e\\n     deletes &gt;= maxBufferedDeletes\u003cbr\\/\u003e\\n  2 anythingToFlushRam(): return true if number of ram segments &gt; 0 OR if number of buffered deletes &gt; 0\u003cbr\\/\u003e\\n  3 doAfterFlushRamSegments(): properly flush buffered deletes\u003c\\/p\u003e\\n\\n\u003cp\u003eThe new IndexModifier supports all APIs from the current IndexModifier except one: deleteDocument(int doc).\u003cbr\\/\u003e\\nI had commented on this before:  \\\"I deliberately left that one out. This is because document ids are changing\u003cbr\\/\u003e\\nas documents are deleted and segments are merged. Users don\'t know exactly when segments are merged\u003cbr\\/\u003e\\nthus ids are changed when using IndexModifier.\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eThis behaviour is true for both the new IndexModifier and the current IndexModifier. If this is preventing this\u003cbr\\/\u003e\\npatch from getting accepted, I\'m willing to add this, but I will detail this in the Java doc so users of this function\u003cbr\\/\u003e\\nare aware of this behaviour.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12452039_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12452039_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Nov\\/06 20:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-11-22T20:28:50+0000\'\u003e22\\/Nov\\/06 20:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    With the recent commits to IndexWriter, this patch no longer applies cleanly. The 5 votes for this issue encourages \\nme to submit yet another patch.   But before I do that, I\'d like to briefly describe the design again and welcome all \\nsuggestions that help improve it and help get it committed.   \\n\\n With the new merge policy committed, the change to IndexWriter is minimal: three zero-or-one-line functions are \\nadded and used. \\n  1 timeToFlushRam(): return true if number of ram segments &gt;= maxBufferedDocs and used in maybeFlushRamSegments() \\n  2 anythingToFlushRam(): return true if number of ram segments &gt; 0 and used in flushRamSegments() \\n  3 doAfterFlushRamSegments(): do nothing and called in mergeSegments() if the merge is on ram segments \\n\\n The new IndexModifier is a subclass of IndexWriter and only overwrites the three functions described above. \\n  1 timeToFlushRam(): return true if number of ram segments &gt;= maxBufferedDocs OR if number of buffered \\n     deletes &gt;= maxBufferedDeletes \\n  2 anythingToFlushRam(): return true if number of ram segments &gt; 0 OR if number of buffered deletes &gt; 0 \\n  3 doAfterFlushRamSegments(): properly flush buffered deletes \\n\\n The new IndexModifier supports all APIs from the current IndexModifier except one: deleteDocument(int doc). \\nI had commented on this before:  \\\"I deliberately left that one out. This is because document ids are changing \\nas documents are deleted and segments are merged. Users don\'t know exactly when segments are merged \\nthus ids are changed when using IndexModifier.\\\" \\n\\n This behaviour is true for both the new IndexModifier and the current IndexModifier. If this is preventing this \\npatch from getting accepted, I\'m willing to add this, but I will detail this in the Java doc so users of this function \\nare aware of this behaviour.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12456887\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12456887&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12456887\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12456887_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12456887_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/06 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-08T15:50:04+0000\'\u003e08\\/Dec\\/06 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat are the reasons to not add the NewIndexModifier to Lucene? This issue has already 6 votes, so it seems to be very popular amongst users (there is only one issue that has more votes). I can say that I\'m using it for a couple of months already, it works flawlessly and made my life a lot easier \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003eI think the main objections were that too many changes to IndexWriter were made in the earliest versions of this patch, but with the new merge policy committed, most of the new code is in the new class NewIndexModifier whereas the changes to IndexWriter are minimal. \u003c\\/p\u003e\\n\\n\u003cp\u003eSo I would like to encourage committer(s) to take another look, I think this would be a nice feature for the next Lucene release.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12456887_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12456887_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/06 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-08T15:50:04+0000\'\u003e08\\/Dec\\/06 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What are the reasons to not add the NewIndexModifier to Lucene? This issue has already 6 votes, so it seems to be very popular amongst users (there is only one issue that has more votes). I can say that I\'m using it for a couple of months already, it works flawlessly and made my life a lot easier    \\n\\n I think the main objections were that too many changes to IndexWriter were made in the earliest versions of this patch, but with the new merge policy committed, most of the new code is in the new class NewIndexModifier whereas the changes to IndexWriter are minimal.  \\n\\n So I would like to encourage committer(s) to take another look, I think this would be a nice feature for the next Lucene release.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12457582\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12457582&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12457582\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457582_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457582_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 05:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T05:20:41+0000\'\u003e12\\/Dec\\/06 05:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLack of committer time... I\'ve been busy enough that I\'ve shied away from complexity and gravitated toward issues that I can handle in a single bite.  I\'m on PTO until the end of the year, so I expect my time to be more compressed.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo minimize the number of reader open\\/closes on large persistent segments, I think the ability to apply deletes only before a merge is important.  That might add a 4th method: doBeforeMerge()\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would be nice to not have to continually open and close readers on segments that aren\'t involved in a merge.  Is there a way to do this?\u003c\\/p\u003e\\n\\n\u003cp\u003eNing, please do produce another patch to the latest trunk (but you might want to wait until after \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-702\\\" title=\\\"Disk full during addIndexes(Directory[]) can corrupt index\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-702\\\"\u003e\u003cdel\u003eLUCENE-702\u003c\\/del\u003e\u003c\\/a\u003e is sorted out.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457582_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457582_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 05:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T05:20:41+0000\'\u003e12\\/Dec\\/06 05:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Lack of committer time... I\'ve been busy enough that I\'ve shied away from complexity and gravitated toward issues that I can handle in a single bite.  I\'m on PTO until the end of the year, so I expect my time to be more compressed. \\n\\n To minimize the number of reader open\\/closes on large persistent segments, I think the ability to apply deletes only before a merge is important.  That might add a 4th method: doBeforeMerge() \\n\\n It would be nice to not have to continually open and close readers on segments that aren\'t involved in a merge.  Is there a way to do this? \\n\\n Ning, please do produce another patch to the latest trunk (but you might want to wait until after   LUCENE-702   is sorted out.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12457758\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12457758&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12457758\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457758_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457758_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 15:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T15:10:01+0000\'\u003e12\\/Dec\\/06 15:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; It would be nice to not have to continually open and close readers on segments\u003cbr\\/\u003e\\n&gt;  that aren\'t involved in a merge. Is there a way to do this? \u003c\\/p\u003e\\n\\n\u003cp\u003eHmmm, and what about segments that are involved in a merge?\u003cbr\\/\u003e\\nI assume it\'s a different reader that is used for deleting docs than used for merging, but it doesn\'t have to be...\u003c\\/p\u003e\\n\\n\u003cp\u003eIf SegmentInfos had a cached reader, that seems like it would solve both problems.\u003cbr\\/\u003e\\nI haven\'t thought about it enough to figure out how doable it is though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457758_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457758_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 15:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T15:10:01+0000\'\u003e12\\/Dec\\/06 15:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; It would be nice to not have to continually open and close readers on segments \\n&gt;  that aren\'t involved in a merge. Is there a way to do this?  \\n\\n Hmmm, and what about segments that are involved in a merge? \\nI assume it\'s a different reader that is used for deleting docs than used for merging, but it doesn\'t have to be... \\n\\n If SegmentInfos had a cached reader, that seems like it would solve both problems. \\nI haven\'t thought about it enough to figure out how doable it is though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12457764\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12457764&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12457764\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12457764_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457764_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T15:17:53+0000\'\u003e12\\/Dec\\/06 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; If SegmentInfos had a cached reader, that seems like it would solve both problems.\u003cbr\\/\u003e\\n&gt; I haven\'t thought about it enough to figure out how doable it is though.\u003c\\/p\u003e\\n\\n\u003cp\u003eGood idea!  I think this could also be used by reopen (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-743\\\" title=\\\"IndexReader.reopen()\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-743\\\"\u003e\u003cdel\u003eLUCENE-743\u003c\\/del\u003e\u003c\\/a\u003e ) to re-use readers.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12457764_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457764_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T15:17:53+0000\'\u003e12\\/Dec\\/06 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; If SegmentInfos had a cached reader, that seems like it would solve both problems. \\n&gt; I haven\'t thought about it enough to figure out how doable it is though. \\n\\n Good idea!  I think this could also be used by reopen (  LUCENE-743   ) to re-use readers.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12457789\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12457789&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12457789\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457789_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457789_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T16:44:55+0000\'\u003e12\\/Dec\\/06 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Good idea! I think this could also be used by reopen (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-743\\\" title=\\\"IndexReader.reopen()\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-743\\\"\u003e\u003cdel\u003eLUCENE-743\u003c\\/del\u003e\u003c\\/a\u003e ) to re-use readers.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, although  reopen() needs more support than what would be needed for this though (namely reference counting).\u003cbr\\/\u003e\\nOne thing to probably watch out for is to avoid making the single-doc ram segments more expensive.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457789_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457789_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T16:44:55+0000\'\u003e12\\/Dec\\/06 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Good idea! I think this could also be used by reopen (  LUCENE-743   ) to re-use readers. \\n\\n Yes, although  reopen() needs more support than what would be needed for this though (namely reference counting). \\nOne thing to probably watch out for is to avoid making the single-doc ram segments more expensive.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12457833\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12457833&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12457833\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457833_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457833_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 18:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T18:36:02+0000\'\u003e12\\/Dec\\/06 18:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOn 12\\/12\\/06, Ning Li &lt;ning.li.li@gmail.com&gt; wrote:\u003cbr\\/\u003e\\n&gt; &gt; To minimize the number of reader open\\/closes on large persistent segments, I think the ability to apply deletes only before a merge is important.  That might add a 4th method: doBeforeMerge()\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt; I\'m not sure I get this. Buffered deletes are only applied(flushed)\u003cbr\\/\u003e\\n&gt; during ram flush. No buffered deletes are applied in the merges of\u003cbr\\/\u003e\\n&gt; on-disk segments.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat is important is to be able to apply deletes before any ids change.\u003cbr\\/\u003e\\nYou could do it after every new lowest-level segment is written to the index (the flush), \u003cb\u003eor\u003c\\/b\u003e you could choose to do it before a merge of the lowest level on-disk segments.  If none of the lowest level segments have deletes, you could even defer the deletes until after all the lowest-level segments have been merged.  This makes the deletes more efficient since it goes from O(mergeFactor * log(maxBufferedDocs)) to O(log(mergeFactor*maxBufferedDocs))\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we can\'t reuse IndexReaders, this becomes more important.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne could perhaps choose to defer deletes until a segment with deleted docs is involved in a merge.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; &gt; It would be nice to not have to continually open and close readers on segments that aren\'t involved in a merge.  Is there a way to do this?\u003cbr\\/\u003e\\n&gt; &gt; If SegmentInfos had a cached reader, that seems like it would solve both problems.\u003cbr\\/\u003e\\n&gt; &gt; I haven\'t thought about it enough to figure out how doable it is though.\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt; This is a good idea! One concern, however, is that caching readers\u003cbr\\/\u003e\\n&gt; will cause a larger memory footprint. Is it acceptable?\u003c\\/p\u003e\\n\\n\u003cp\u003eAs I said, I haven\'t had time to think about it at all, but at the lowest level of reuse, it wouldn\'t increase the footprint at all in the event that deletes are deferred until a merge:\u003c\\/p\u003e\\n\\n\u003cp\u003eThe specific scenario I\'m thinking of is instead of\u003cbr\\/\u003e\\n  doAfterFlushRamSegments()\u003cbr\\/\u003e\\n    open readers\u003cbr\\/\u003e\\n    delete docs\u003cbr\\/\u003e\\n    close readers\u003cbr\\/\u003e\\n  segmentMerger()\u003cbr\\/\u003e\\n    open readers\u003cbr\\/\u003e\\n    merge segments\u003cbr\\/\u003e\\n    close readers\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would be:\u003cbr\\/\u003e\\n  doAfterFlushRamSegments()\u003cbr\\/\u003e\\n    open readers\u003cbr\\/\u003e\\n    delete docs\u003cbr\\/\u003e\\n  segmentMerger()\u003cbr\\/\u003e\\n    merge segments\u003cbr\\/\u003e\\n    close readers\u003c\\/p\u003e\\n\\n\u003cp\u003eThis cutting out an additional open-close cycle.\u003cbr\\/\u003e\\nYou are right that other forms of reader caching could increase the footprint, but it\'s nice to have the option of trading some memory for performance.\u003c\\/p\u003e\\n\\n\u003cp\u003eYet another strategy a subclass of IndexWriter could choose is to only apply deletes to segments actually involved in a merge.  Then the bigger segments in the index wouldn\'t continually have an reader opened and closed on them.... it could all be deferred until a close, or until there are too many deletes buffered.\u003c\\/p\u003e\\n\\n\u003cp\u003eOf course NewIndexModifier doesn\'t have to impliment all these options to start with, but it would be nice if the extension hooks in IndexWriter could support them.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhew, this is why I was slow to get involved in this again \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457833_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457833_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 18:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T18:36:02+0000\'\u003e12\\/Dec\\/06 18:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    On 12\\/12\\/06, Ning Li &lt;ning.li.li@gmail.com&gt; wrote: \\n&gt; &gt; To minimize the number of reader open\\/closes on large persistent segments, I think the ability to apply deletes only before a merge is important.  That might add a 4th method: doBeforeMerge() \\n&gt;  \\n&gt; I\'m not sure I get this. Buffered deletes are only applied(flushed) \\n&gt; during ram flush. No buffered deletes are applied in the merges of \\n&gt; on-disk segments. \\n\\n What is important is to be able to apply deletes before any ids change. \\nYou could do it after every new lowest-level segment is written to the index (the flush),  or  you could choose to do it before a merge of the lowest level on-disk segments.  If none of the lowest level segments have deletes, you could even defer the deletes until after all the lowest-level segments have been merged.  This makes the deletes more efficient since it goes from O(mergeFactor * log(maxBufferedDocs)) to O(log(mergeFactor*maxBufferedDocs)) \\n\\n If we can\'t reuse IndexReaders, this becomes more important. \\n\\n One could perhaps choose to defer deletes until a segment with deleted docs is involved in a merge. \\n\\n &gt; &gt; It would be nice to not have to continually open and close readers on segments that aren\'t involved in a merge.  Is there a way to do this? \\n&gt; &gt; If SegmentInfos had a cached reader, that seems like it would solve both problems. \\n&gt; &gt; I haven\'t thought about it enough to figure out how doable it is though. \\n&gt;  \\n&gt; This is a good idea! One concern, however, is that caching readers \\n&gt; will cause a larger memory footprint. Is it acceptable? \\n\\n As I said, I haven\'t had time to think about it at all, but at the lowest level of reuse, it wouldn\'t increase the footprint at all in the event that deletes are deferred until a merge: \\n\\n The specific scenario I\'m thinking of is instead of \\n  doAfterFlushRamSegments() \\n    open readers \\n    delete docs \\n    close readers \\n  segmentMerger() \\n    open readers \\n    merge segments \\n    close readers \\n\\n It would be: \\n  doAfterFlushRamSegments() \\n    open readers \\n    delete docs \\n  segmentMerger() \\n    merge segments \\n    close readers \\n\\n This cutting out an additional open-close cycle. \\nYou are right that other forms of reader caching could increase the footprint, but it\'s nice to have the option of trading some memory for performance. \\n\\n Yet another strategy a subclass of IndexWriter could choose is to only apply deletes to segments actually involved in a merge.  Then the bigger segments in the index wouldn\'t continually have an reader opened and closed on them.... it could all be deferred until a close, or until there are too many deletes buffered. \\n\\n Of course NewIndexModifier doesn\'t have to impliment all these options to start with, but it would be nice if the extension hooks in IndexWriter could support them. \\n\\n Whew, this is why I was slow to get involved in this again                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12457865\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12457865&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12457865\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12457865_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457865_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 20:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T20:30:55+0000\'\u003e12\\/Dec\\/06 20:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; \u003cb\u003eor\u003c\\/b\u003e you could choose to do it before a merge of the lowest level on-disk\u003cbr\\/\u003e\\n&gt; segments.  If none of the lowest level segments have deletes, you could\u003cbr\\/\u003e\\n&gt; even defer the deletes until after all the lowest-level segments have been\u003cbr\\/\u003e\\n&gt; merged.  This makes the deletes more efficient since it goes from\u003cbr\\/\u003e\\n&gt; O(mergeFactor * log(maxBufferedDocs)) to O(log(mergeFactor*maxBufferedDocs))\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think I like this semantics, though. With the semantics in the patch,\u003cbr\\/\u003e\\nan update can be easily supported. With this semantics, an insert is flushed\u003cbr\\/\u003e\\nyet a delete before the insert may or may not have been flushed.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; You are right that other forms of reader caching could increase the footprint,\u003cbr\\/\u003e\\n&gt; but it\'s nice to have the option of trading some memory for performance.\u003c\\/p\u003e\\n\\n\u003cp\u003eAgree. It\'d be nice to cache all readers... \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks again for your comments. Enjoy your PTO!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12457865_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457865_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 20:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T20:30:55+0000\'\u003e12\\/Dec\\/06 20:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt;  or  you could choose to do it before a merge of the lowest level on-disk \\n&gt; segments.  If none of the lowest level segments have deletes, you could \\n&gt; even defer the deletes until after all the lowest-level segments have been \\n&gt; merged.  This makes the deletes more efficient since it goes from \\n&gt; O(mergeFactor * log(maxBufferedDocs)) to O(log(mergeFactor*maxBufferedDocs)) \\n\\n I don\'t think I like this semantics, though. With the semantics in the patch, \\nan update can be easily supported. With this semantics, an insert is flushed \\nyet a delete before the insert may or may not have been flushed. \\n\\n &gt; You are right that other forms of reader caching could increase the footprint, \\n&gt; but it\'s nice to have the option of trading some memory for performance. \\n\\n Agree. It\'d be nice to cache all readers...   \\n\\n Thanks again for your comments. Enjoy your PTO!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12457885\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12457885&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12457885\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457885_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457885_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 21:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T21:29:38+0000\'\u003e12\\/Dec\\/06 21:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmmm, I see your point... If deletes are deferred, a different reader could go and open the index and see the additions but not the deletions.\u003c\\/p\u003e\\n\\n\u003cp\u003eCan the same thing happen with your patch (with a smaller window), or are deletes applied between writing the new segment and writing the new segments file that references it?  (hard to tell from current diff in isolation)\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, it\'s less of a problem if opening a new reader is coordinated with the writing.  That still does leave the crash scenario though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12457885_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12457885_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Dec\\/06 21:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-12T21:29:38+0000\'\u003e12\\/Dec\\/06 21:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmmm, I see your point... If deletes are deferred, a different reader could go and open the index and see the additions but not the deletions. \\n\\n Can the same thing happen with your patch (with a smaller window), or are deletes applied between writing the new segment and writing the new segments file that references it?  (hard to tell from current diff in isolation) \\n\\n Anyway, it\'s less of a problem if opening a new reader is coordinated with the writing.  That still does leave the crash scenario though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12458158\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12458158&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12458158\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12458158_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458158_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T15:34:00+0000\'\u003e13\\/Dec\\/06 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Can the same thing happen with your patch (with a smaller window), or are deletes applied between writing the new segment and writing the new segments file that references it?  (hard to tell from current diff in isolation)\u003c\\/p\u003e\\n\\n\u003cp\u003eNo, it does not happen with the patch, no matter what the window size is.\u003cbr\\/\u003e\\nThis is because results of flushing ram - both inserts and deletes - are committed in the same transaction.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12458158_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458158_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T15:34:00+0000\'\u003e13\\/Dec\\/06 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Can the same thing happen with your patch (with a smaller window), or are deletes applied between writing the new segment and writing the new segments file that references it?  (hard to tell from current diff in isolation) \\n\\n No, it does not happen with the patch, no matter what the window size is. \\nThis is because results of flushing ram - both inserts and deletes - are committed in the same transaction.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12458170\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12458170&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12458170\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12458170_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458170_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 16:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T16:01:22+0000\'\u003e13\\/Dec\\/06 16:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; both inserts and deletes - are committed in the same transaction.\u003c\\/p\u003e\\n\\n\u003cp\u003eOK, cool.  I agree that\'s the ideal default behavior.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12458170_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458170_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 16:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T16:01:22+0000\'\u003e13\\/Dec\\/06 16:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; both inserts and deletes - are committed in the same transaction. \\n\\n OK, cool.  I agree that\'s the ideal default behavior.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12458174\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12458174&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12458174\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12458174_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458174_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T16:07:15+0000\'\u003e13\\/Dec\\/06 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMinor question... in the places that you use Vector, is there a reason you aren\'t using ArrayList?\u003cbr\\/\u003e\\nAnd in methods that pass a Vector, that could be changed to a List .\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12458174_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458174_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T16:07:15+0000\'\u003e13\\/Dec\\/06 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Minor question... in the places that you use Vector, is there a reason you aren\'t using ArrayList? \\nAnd in methods that pass a Vector, that could be changed to a List .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12458205\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12458205&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12458205\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12458205_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458205_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T17:34:49+0000\'\u003e13\\/Dec\\/06 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; Minor question... in the places that you use Vector, is there a reason you aren\'t using ArrayList? \u003cbr\\/\u003e\\n&gt; And in methods that pass a Vector, that could be changed to a List . \u003c\\/p\u003e\\n\\n\u003cp\u003eArrayList and List can be used, respectively.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12458205_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458205_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T17:34:49+0000\'\u003e13\\/Dec\\/06 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; Minor question... in the places that you use Vector, is there a reason you aren\'t using ArrayList?  \\n&gt; And in methods that pass a Vector, that could be changed to a List .  \\n\\n ArrayList and List can be used, respectively.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12459482\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12459482&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12459482\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"paul.elschot@xs4all.nl\\\" id=\\\"commentauthor_12459482_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=paul.elschot%40xs4all.nl\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"paul.elschot@xs4all.nl\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Elschot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459482_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/06 22:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-18T22:18:48+0000\'\u003e18\\/Dec\\/06 22:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'d like to give this a try over the upcoming holidays.\u003cbr\\/\u003e\\nWould it be possible to post a single patch?\u003cbr\\/\u003e\\nA single patch can be made by locally svn add\'ing all new files\u003cbr\\/\u003e\\nand then doing an svn diff on all files involved from the top directory.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegards,\u003cbr\\/\u003e\\nPaul Elschot\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"paul.elschot@xs4all.nl\\\" id=\\\"commentauthor_12459482_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=paul.elschot%40xs4all.nl\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"paul.elschot@xs4all.nl\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Elschot\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459482_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/06 22:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-18T22:18:48+0000\'\u003e18\\/Dec\\/06 22:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'d like to give this a try over the upcoming holidays. \\nWould it be possible to post a single patch? \\nA single patch can be made by locally svn add\'ing all new files \\nand then doing an svn diff on all files involved from the top directory. \\n\\n Regards, \\nPaul Elschot              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12459490\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12459490&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12459490\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12459490_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459490_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/06 22:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-18T22:59:31+0000\'\u003e18\\/Dec\\/06 22:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMany versions of the patch were submitted as new code was committed to IndexWriter.java. For each version, all changes made were included in a single patch file.\u003c\\/p\u003e\\n\\n\u003cp\u003eI removed all but the latest version of the patch. Even this one is outdated by the commit of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-701\\\" title=\\\"Lock-less commits\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-701\\\"\u003e\u003cdel\u003eLUCENE-701\u003c\\/del\u003e\u003c\\/a\u003e (lock-less commits). I was waiting for the commit of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-702\\\" title=\\\"Disk full during addIndexes(Directory[]) can corrupt index\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-702\\\"\u003e\u003cdel\u003eLUCENE-702\u003c\\/del\u003e\u003c\\/a\u003e before submitting another patch. \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-702\\\" title=\\\"Disk full during addIndexes(Directory[]) can corrupt index\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-702\\\"\u003e\u003cdel\u003eLUCENE-702\u003c\\/del\u003e\u003c\\/a\u003e was committed this morning. So I\'ll submit an up-to-date patch over the holidays.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn 12\\/18\\/06, Paul Elschot (JIRA) &lt;jira@apache.org&gt; wrote:\u003cbr\\/\u003e\\n&gt; I\'d like to give this a try over the upcoming holidays. \u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s great! We can discuss\\/compare the designs then. Or, we can discuss\\/compare the designs before submitting new patches.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12459490_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459490_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/06 22:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-18T22:59:31+0000\'\u003e18\\/Dec\\/06 22:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Many versions of the patch were submitted as new code was committed to IndexWriter.java. For each version, all changes made were included in a single patch file. \\n\\n I removed all but the latest version of the patch. Even this one is outdated by the commit of   LUCENE-701   (lock-less commits). I was waiting for the commit of   LUCENE-702   before submitting another patch.   LUCENE-702   was committed this morning. So I\'ll submit an up-to-date patch over the holidays. \\n\\n On 12\\/18\\/06, Paul Elschot (JIRA) &lt;jira@apache.org&gt; wrote: \\n&gt; I\'d like to give this a try over the upcoming holidays.  \\n\\n That\'s great! We can discuss\\/compare the designs then. Or, we can discuss\\/compare the designs before submitting new patches.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12459506\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12459506&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12459506\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12459506_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459506_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/06 00:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-19T00:47:40+0000\'\u003e19\\/Dec\\/06 00:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is the design overview. Minor changes were made because of lock-less commits.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the current IndexWriter, newly added documents are buffered in ram in the form of one-doc segments.\u003cbr\\/\u003e\\nWhen a flush is triggered, all ram documents are merged into a single segment and written to disk.\u003cbr\\/\u003e\\nFurther merges of disk segments may be triggered.\u003c\\/p\u003e\\n\\n\u003cp\u003eNewIndexModifier extends IndexWriter and supports document deletion in addition to document addition.\u003cbr\\/\u003e\\nNewIndexModifier not only buffers newly added documents in ram, but also buffers deletes in ram.\u003cbr\\/\u003e\\nThe following describes what happens when a flush is triggered:\u003c\\/p\u003e\\n\\n\u003cp\u003e  1 merge ram documents into one segment and written to disk\u003cbr\\/\u003e\\n    do not commit - segmentInfos is updated in memory, but not written to disk\u003c\\/p\u003e\\n\\n\u003cp\u003e  2 for each disk segment to which a delete may apply\u003cbr\\/\u003e\\n      open reader\u003cbr\\/\u003e\\n      delete docs*, write new .delN file (* Care is taken to ensure that an interleaved sequence of\u003cbr\\/\u003e\\n        inserts and deletes for the same document are properly serialized.)\u003cbr\\/\u003e\\n      close reader, but do not commit - segmentInfos is updated in memory, but not written to disk\u003c\\/p\u003e\\n\\n\u003cp\u003e  3 commit - write new segments_N to disk\u003c\\/p\u003e\\n\\n\u003cp\u003eFurther merges for disk segments work the same as before.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eAs an option, we can cache readers to minimize the number of reader opens\\/closes. In other words,\u003cbr\\/\u003e\\nwe can trade memory for better performance. The design would be modified as follows:\u003c\\/p\u003e\\n\\n\u003cp\u003e  1 same as above\u003c\\/p\u003e\\n\\n\u003cp\u003e  2 for each disk segment to which a delete may apply\u003cbr\\/\u003e\\n      open reader and cache it if not already opened\\/cached\u003cbr\\/\u003e\\n      delete docs*, write new .delN file\u003c\\/p\u003e\\n\\n\u003cp\u003e  3 commit - write new segments_N to disk\u003c\\/p\u003e\\n\\n\u003cp\u003eThe logic for disk segment merge changes accordingly: open reader if not already opened\\/cached;\u003cbr\\/\u003e\\nafter a merge is complete, close readers for the segments that have been merged.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12459506_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459506_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/06 00:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-19T00:47:40+0000\'\u003e19\\/Dec\\/06 00:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is the design overview. Minor changes were made because of lock-less commits. \\n\\n In the current IndexWriter, newly added documents are buffered in ram in the form of one-doc segments. \\nWhen a flush is triggered, all ram documents are merged into a single segment and written to disk. \\nFurther merges of disk segments may be triggered. \\n\\n NewIndexModifier extends IndexWriter and supports document deletion in addition to document addition. \\nNewIndexModifier not only buffers newly added documents in ram, but also buffers deletes in ram. \\nThe following describes what happens when a flush is triggered: \\n\\n   1 merge ram documents into one segment and written to disk \\n    do not commit - segmentInfos is updated in memory, but not written to disk \\n\\n   2 for each disk segment to which a delete may apply \\n      open reader \\n      delete docs*, write new .delN file (* Care is taken to ensure that an interleaved sequence of \\n        inserts and deletes for the same document are properly serialized.) \\n      close reader, but do not commit - segmentInfos is updated in memory, but not written to disk \\n\\n   3 commit - write new segments_N to disk \\n\\n Further merges for disk segments work the same as before. \\n\\n\\n As an option, we can cache readers to minimize the number of reader opens\\/closes. In other words, \\nwe can trade memory for better performance. The design would be modified as follows: \\n\\n   1 same as above \\n\\n   2 for each disk segment to which a delete may apply \\n      open reader and cache it if not already opened\\/cached \\n      delete docs*, write new .delN file \\n\\n   3 commit - write new segments_N to disk \\n\\n The logic for disk segment merge changes accordingly: open reader if not already opened\\/cached; \\nafter a merge is complete, close readers for the segments that have been merged.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12466189\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12466189&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12466189\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jkassis\\\" id=\\\"commentauthor_12466189_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jkassis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jkassis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jeremy F. Kassis\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12466189_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/07 00:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-20T00:33:06+0000\'\u003e20\\/Jan\\/07 00:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHappy New Year everyone. I\'m personally very excited about this improvement to Lucene. It really begins to open Lucene up to service highly mutable data, important for the application I\'m developing. Following the thread, it looks like quite a few people have favorably reviewed the patch. Perhaps it\'s time for a blessing and commit? \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jkassis\\\" id=\\\"commentauthor_12466189_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jkassis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jkassis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jeremy F. Kassis\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12466189_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/07 00:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-20T00:33:06+0000\'\u003e20\\/Jan\\/07 00:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Happy New Year everyone. I\'m personally very excited about this improvement to Lucene. It really begins to open Lucene up to service highly mutable data, important for the application I\'m developing. Following the thread, it looks like quite a few people have favorably reviewed the patch. Perhaps it\'s time for a blessing and commit?               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12467733\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12467733&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12467733\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12467733_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12467733_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jan\\/07 03:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-26T03:26:49+0000\'\u003e26\\/Jan\\/07 03:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe patch is updated because of the code committed to IndexWriter since the last patch. The high-level design is the same as before. See comments on 18\\/Dec\\/06.\u003c\\/p\u003e\\n\\n\u003cp\u003eCare has been taken to make sure if writer\\/modifier tries to commit but hits disk full that writer\\/modifier remains consistent and usable. A test case is added to TestNewIndexModifierDelete to test this.\u003c\\/p\u003e\\n\\n\u003cp\u003eAll tests pass.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ningli\\\" id=\\\"commentauthor_12467733_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ningli\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ningli\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ning Li\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12467733_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jan\\/07 03:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-26T03:26:49+0000\'\u003e26\\/Jan\\/07 03:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The patch is updated because of the code committed to IndexWriter since the last patch. The high-level design is the same as before. See comments on 18\\/Dec\\/06. \\n\\n Care has been taken to make sure if writer\\/modifier tries to commit but hits disk full that writer\\/modifier remains consistent and usable. A test case is added to TestNewIndexModifierDelete to test this. \\n\\n All tests pass.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12468012\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12468012&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12468012\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12468012_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468012_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/07 12:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-27T12:06:56+0000\'\u003e27\\/Jan\\/07 12:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eThanks for redoing the patch Ning!  I like the added test case for\u003cbr\\/\u003e\\ndisk full.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve reviewed this and it looks great.  I fixed a few small typos and\u003cbr\\/\u003e\\nwhitespace issues (looks like a line-wrapper had jumped in at some\u003cbr\\/\u003e\\npoint) and attached NewIndexModifier.Jan2007.take2.patch\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this is the only issue holding up a Lucene 2.1 release (so\u003cbr\\/\u003e\\nfar?).  Yonik (or anyone) do you have any objections \\/ questions about\u003cbr\\/\u003e\\nthis patch?  It\'s basically unchanged from before, just modified to\u003cbr\\/\u003e\\naccommodate recent fixes to IndexWriter.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12468012_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468012_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/07 12:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-27T12:06:56+0000\'\u003e27\\/Jan\\/07 12:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Thanks for redoing the patch Ning!  I like the added test case for \\ndisk full. \\n\\n I\'ve reviewed this and it looks great.  I fixed a few small typos and \\nwhitespace issues (looks like a line-wrapper had jumped in at some \\npoint) and attached NewIndexModifier.Jan2007.take2.patch \\n\\n I think this is the only issue holding up a Lucene 2.1 release (so \\nfar?).  Yonik (or anyone) do you have any objections \\/ questions about \\nthis patch?  It\'s basically unchanged from before, just modified to \\naccommodate recent fixes to IndexWriter.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12468371\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12468371&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12468371\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12468371_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468371_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jan\\/07 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-29T19:03:39+0000\'\u003e29\\/Jan\\/07 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI just reviewed this, and it looks good to me.\u003cbr\\/\u003e\\nI like how you managed to enable parallel analysis in updateDocument() too.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12468371_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468371_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jan\\/07 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-29T19:03:39+0000\'\u003e29\\/Jan\\/07 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I just reviewed this, and it looks good to me. \\nI like how you managed to enable parallel analysis in updateDocument() too.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12468617\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12468617&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12468617\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12468617_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468617_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jan\\/07 13:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-30T13:57:02+0000\'\u003e30\\/Jan\\/07 13:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI tried the new patch out and everything looks good to me. One comment though: The public method NewIndexModifier.flush() just calls the public method flushRamSegments(). It might be confusing to have two public methods that do exactly the same?\u003c\\/p\u003e\\n\\n\u003cp\u003eBesides this minor question I\'m all for committing this patch. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12468617_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468617_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jan\\/07 13:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-30T13:57:02+0000\'\u003e30\\/Jan\\/07 13:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I tried the new patch out and everything looks good to me. One comment though: The public method NewIndexModifier.flush() just calls the public method flushRamSegments(). It might be confusing to have two public methods that do exactly the same? \\n\\n Besides this minor question I\'m all for committing this patch.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12468640\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12468640&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12468640\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12468640_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468640_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jan\\/07 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-30T15:17:38+0000\'\u003e30\\/Jan\\/07 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe flush() was added to better match the current IndexModifier, based\u003cbr\\/\u003e\\non feedback (bullet 6) above:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565#action_12428035\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565#action_12428035\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eActually, back when that feedback was given, flushRamSegments() was\u003cbr\\/\u003e\\nstill private.  I agree it\'s awkward now to have two separate methods\u003cbr\\/\u003e\\nthat do the same thing.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, I prefer \\\"flush\\\" over \\\"flushRamSegments\\\" because flush() is more\u003cbr\\/\u003e\\ngeneric so it reveals less about how the IndexWriter makes use of its\u003cbr\\/\u003e\\nRAM and leaves freedom in the future to have more interesting use of\u003cbr\\/\u003e\\nRAM (like KinoSearch as one example).\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I think the right fix would be to add a public IndexWriter.flush()\u003cbr\\/\u003e\\nthat just calls flushRamSegments, and then make flushRamSegments\u003cbr\\/\u003e\\nprivate again, then remove the flush() method from NewIndexModifier?\u003cbr\\/\u003e\\n(The public flushRamSegments() has not yet been released so making it\u003cbr\\/\u003e\\nprivate again before we release 2.1 is OK).\u003c\\/p\u003e\\n\\n\u003cp\u003eAny objections to this approach?  I will re-work the last patch &amp;\u003cbr\\/\u003e\\nattach it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12468640_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468640_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jan\\/07 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-30T15:17:38+0000\'\u003e30\\/Jan\\/07 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The flush() was added to better match the current IndexModifier, based \\non feedback (bullet 6) above: \\n\\n      https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565#action_12428035  \\n\\n Actually, back when that feedback was given, flushRamSegments() was \\nstill private.  I agree it\'s awkward now to have two separate methods \\nthat do the same thing. \\n\\n But, I prefer \\\"flush\\\" over \\\"flushRamSegments\\\" because flush() is more \\ngeneric so it reveals less about how the IndexWriter makes use of its \\nRAM and leaves freedom in the future to have more interesting use of \\nRAM (like KinoSearch as one example). \\n\\n So I think the right fix would be to add a public IndexWriter.flush() \\nthat just calls flushRamSegments, and then make flushRamSegments \\nprivate again, then remove the flush() method from NewIndexModifier? \\n(The public flushRamSegments() has not yet been released so making it \\nprivate again before we release 2.1 is OK). \\n\\n Any objections to this approach?  I will re-work the last patch &amp; \\nattach it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12468687\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12468687&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12468687\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12468687_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468687_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jan\\/07 16:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-30T16:59:38+0000\'\u003e30\\/Jan\\/07 16:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the explanation, Mike. I\'d prefer flush() too and the changes you suggest look good to me!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12468687_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468687_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jan\\/07 16:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-30T16:59:38+0000\'\u003e30\\/Jan\\/07 16:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the explanation, Mike. I\'d prefer flush() too and the changes you suggest look good to me!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12468714\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12468714&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12468714\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12468714_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468714_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jan\\/07 17:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-30T17:55:31+0000\'\u003e30\\/Jan\\/07 17:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I\'ve attached NewIndexModifier.Jan2007.take3.patch with that approach.\u003c\\/p\u003e\\n\\n\u003cp\u003eI plan on committing this in the next day or two if there are no more questions\\/feedback....\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you Ning for this great addition, and for persisting through this long process!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12468714_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12468714_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jan\\/07 17:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-30T17:55:31+0000\'\u003e30\\/Jan\\/07 17:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I\'ve attached NewIndexModifier.Jan2007.take3.patch with that approach. \\n\\n I plan on committing this in the next day or two if there are no more questions\\/feedback.... \\n\\n Thank you Ning for this great addition, and for persisting through this long process!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12469408\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12469408&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12469408\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12469408_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12469408_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/07 10:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-01T10:58:01+0000\'\u003e01\\/Feb\\/07 10:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI just committed this.\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you Ning.  Keep the patches coming!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12469408_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12469408_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/07 10:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-01T10:58:01+0000\'\u003e01\\/Feb\\/07 10:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I just committed this. \\n\\n Thank you Ning.  Keep the patches coming!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12471844\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12471844&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12471844\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12471844_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12471844_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/07 22:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-09T22:05:57+0000\'\u003e09\\/Feb\\/07 22:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eReopening based on recent discussions on java-dev:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \u003ca href=\\\"http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/45099\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/45099\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12471844_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12471844_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/07 22:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-09T22:05:57+0000\'\u003e09\\/Feb\\/07 22:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Reopening based on recent discussions on java-dev: \\n\\n      http:\\/\\/www.gossamer-threads.com\\/lists\\/lucene\\/java-dev\\/45099               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12471980\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12471980&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12471980\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12471980_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12471980_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/07 10:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-10T10:07:44+0000\'\u003e10\\/Feb\\/07 10:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I moved NewIndexModifier\'s methods into IndexWriter and did some\u003cbr\\/\u003e\\nsmall refactoring, tightening up protections, fixed javadocs,\u003cbr\\/\u003e\\nindentation, etc.  NewIndexModifier is now removed.\u003c\\/p\u003e\\n\\n\u003cp\u003eI like this solution much better!\u003c\\/p\u003e\\n\\n\u003cp\u003eI also increased the default number of deleted terms before a flush is\u003cbr\\/\u003e\\ntriggered from 10 to 1000.  These buffered terms use very little\u003cbr\\/\u003e\\nmemory so I think it makes sense to have a larger default?\u003c\\/p\u003e\\n\\n\u003cp\u003eSo, this adds these public methods to IndexWriter:\u003c\\/p\u003e\\n\\n\u003cp\u003e  public void updateDocument(Term term, Document doc, Analyzer analyzer)\u003cbr\\/\u003e\\n  public void updateDocument(Term term, Document doc)\u003cbr\\/\u003e\\n  public synchronized void deleteDocuments(Term[] terms)\u003cbr\\/\u003e\\n  public synchronized void deleteDocuments(Term term)\u003cbr\\/\u003e\\n  public void setMaxBufferedDeleteTerms(int maxBufferedDeleteTerms)\u003cbr\\/\u003e\\n  public int getMaxBufferedDeleteTerms()\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd this public field:\u003c\\/p\u003e\\n\\n\u003cp\u003e  public final static int DEFAULT_MAX_BUFFERED_DELETE_TERMS = 10;\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eOn the extensions points, we had previously added these 4:\u003c\\/p\u003e\\n\\n\u003cp\u003e  protected void doAfterFlushRamSegments(boolean flushedRamSegments)\u003cbr\\/\u003e\\n  protected boolean timeToFlushRam()\u003cbr\\/\u003e\\n  protected boolean anythingToFlushRam()\u003cbr\\/\u003e\\n  protected boolean onlyRamDocsToFlush()\u003c\\/p\u003e\\n\\n\u003cp\u003eI would propose that instead we add only the first one above, but\u003cbr\\/\u003e\\nrename it to \\\"doAfterFlush()\\\".  This is basically a callback that a\u003cbr\\/\u003e\\nsubclass could use to do its own thing after a flush but before a\u003cbr\\/\u003e\\ncommit.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut then I don\'t think we should add any of the others.  The\u003cbr\\/\u003e\\n\\\"timeToFlushRam()\\\" callback isn\'t really needed now that we have a\u003cbr\\/\u003e\\npublic \\\"flush()\\\" method.  And the other two are very specific to how\u003cbr\\/\u003e\\nIndexWriter implements RAM buffering\\/flushing and so unless\\/until we\u003cbr\\/\u003e\\ncan think of a use case that needs these I\'m inclined to not include\u003cbr\\/\u003e\\nthem?\u003c\\/p\u003e\\n\\n\u003cp\u003eYonik, is there something in Solr that would need these last 2\u003cbr\\/\u003e\\ncallbacks?\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve attached the patch (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-565\\\" title=\\\"Supporting deleteDocuments in IndexWriter (Code and Performance Results Provided)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-565\\\"\u003e\u003cdel\u003eLUCENE-565\u003c\\/del\u003e\u003c\\/a\u003e.Feb2007.patch) with these\u003cbr\\/\u003e\\nchanges!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12471980_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12471980_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/07 10:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-10T10:07:44+0000\'\u003e10\\/Feb\\/07 10:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I moved NewIndexModifier\'s methods into IndexWriter and did some \\nsmall refactoring, tightening up protections, fixed javadocs, \\nindentation, etc.  NewIndexModifier is now removed. \\n\\n I like this solution much better! \\n\\n I also increased the default number of deleted terms before a flush is \\ntriggered from 10 to 1000.  These buffered terms use very little \\nmemory so I think it makes sense to have a larger default? \\n\\n So, this adds these public methods to IndexWriter: \\n\\n   public void updateDocument(Term term, Document doc, Analyzer analyzer) \\n  public void updateDocument(Term term, Document doc) \\n  public synchronized void deleteDocuments(Term[] terms) \\n  public synchronized void deleteDocuments(Term term) \\n  public void setMaxBufferedDeleteTerms(int maxBufferedDeleteTerms) \\n  public int getMaxBufferedDeleteTerms() \\n\\n And this public field: \\n\\n   public final static int DEFAULT_MAX_BUFFERED_DELETE_TERMS = 10; \\n\\n\\n On the extensions points, we had previously added these 4: \\n\\n   protected void doAfterFlushRamSegments(boolean flushedRamSegments) \\n  protected boolean timeToFlushRam() \\n  protected boolean anythingToFlushRam() \\n  protected boolean onlyRamDocsToFlush() \\n\\n I would propose that instead we add only the first one above, but \\nrename it to \\\"doAfterFlush()\\\".  This is basically a callback that a \\nsubclass could use to do its own thing after a flush but before a \\ncommit. \\n\\n But then I don\'t think we should add any of the others.  The \\n\\\"timeToFlushRam()\\\" callback isn\'t really needed now that we have a \\npublic \\\"flush()\\\" method.  And the other two are very specific to how \\nIndexWriter implements RAM buffering\\/flushing and so unless\\/until we \\ncan think of a use case that needs these I\'m inclined to not include \\nthem? \\n\\n Yonik, is there something in Solr that would need these last 2 \\ncallbacks? \\n\\n I\'ve attached the patch (  LUCENE-565  .Feb2007.patch) with these \\nchanges!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12472499\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12472499&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12472499\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12472499_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12472499_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Feb\\/07 01:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-13T01:53:24+0000\'\u003e13\\/Feb\\/07 01:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I moved NewIndexModifier\'s methods into IndexWriter and did some\u003cbr\\/\u003e\\nsmall refactoring, tightening up protections, \u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I would propose that instead we add only the first one above, but rename it to \\\"doAfterFlush()\\\". \u003c\\/p\u003e\\n\\n\u003cp\u003eYes, that sounds fine.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe problem is that we wouldn\'t be able to take advantage of the hook because of the \\\"tightening up protections\\\".  Access to the segments is key.\u003c\\/p\u003e\\n\\n\u003cp\u003e+  private SegmentInfos segmentInfos = new SegmentInfos();       \\/\\/ the segments\u003cbr\\/\u003e\\n+  private SegmentInfos ramSegmentInfos = new SegmentInfos();    \\/\\/ the segments in ramDirectory\u003cbr\\/\u003e\\n+  final private SegmentInfo buildSingleDocSegment(Document doc, Analyzer analyzer)\u003c\\/p\u003e\\n\\n\u003cp\u003eSo instead of changing these to private, how about package protected?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12472499_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12472499_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Feb\\/07 01:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-13T01:53:24+0000\'\u003e13\\/Feb\\/07 01:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I moved NewIndexModifier\'s methods into IndexWriter and did some \\nsmall refactoring, tightening up protections,  \\n\\n &gt; I would propose that instead we add only the first one above, but rename it to \\\"doAfterFlush()\\\".  \\n\\n Yes, that sounds fine. \\n\\n The problem is that we wouldn\'t be able to take advantage of the hook because of the \\\"tightening up protections\\\".  Access to the segments is key. \\n\\n +  private SegmentInfos segmentInfos = new SegmentInfos();       \\/\\/ the segments \\n+  private SegmentInfos ramSegmentInfos = new SegmentInfos();    \\/\\/ the segments in ramDirectory \\n+  final private SegmentInfo buildSingleDocSegment(Document doc, Analyzer analyzer) \\n\\n So instead of changing these to private, how about package protected? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12472610\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12472610&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12472610\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12472610_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12472610_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Feb\\/07 10:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-13T10:26:11+0000\'\u003e13\\/Feb\\/07 10:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, got it.  I will change those 3 to package protection and then commit.  Thanks Yonik.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12472610_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12472610_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Feb\\/07 10:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-13T10:26:11+0000\'\u003e13\\/Feb\\/07 10:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, got it.  I will change those 3 to package protection and then commit.  Thanks Yonik.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12476258\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-565?focusedCommentId=12476258&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12476258\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476258_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476258_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T18:10:33+0000\'\u003e27\\/Feb\\/07 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eClosing all issues that were resolved for 2.1.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476258_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476258_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T18:10:33+0000\'\u003e27\\/Feb\\/07 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Closing all issues that were resolved for 2.1.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520242386935"> 
    <input type="hidden" title="jira.request.server.time" value="344"> 
    <input type="hidden" title="jira.request.id" value="573x94503054x4"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="5"> 
    <input type="hidden" title="db.reads.time.in.ms" value="40"> 
    <input type="hidden" title="db.conns.time.in.ms" value="49"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 573x94503054x4
	          REQUEST TIMESTAMP : [05/Mar/2018:09:33:06 +0000]
	               REQUEST TIME : 0.3440
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 5

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=24, elapsedTotal=40693895, elapsedMin=624172, elapsedMax=11149073, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=28, elapsedTotal=49194409, elapsedMin=650946, elapsedMax=11196212, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>