<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|3600b6d344ffd1799210addeed31a02f300cbc1f|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"7233de2469db2e\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-1821"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-1821] Weight.scorer() not passed doc offset for "sub reader" - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-1821] Weight.scorer() not passed doc offset for &quot;sub reader&quot; - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loading…
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-1821">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-1821" href="/jira/browse/LUCENE-1821" id="key-val" rel="12433377">LUCENE-1821</a></li>
                </ol>
                <h1 id="summary-val">Weight.scorer() not passed doc offset for "sub reader"</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-1821"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-1821/LUCENE-1821.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-1821/LUCENE-1821.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-1821/LUCENE-1821.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-1821/LUCENE-1821.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="2.9 Last release (barring major bugs) before migrating to 3.0 and JDK 1.5">2.9</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.0-ALPHA" title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Fsearch%22" title="core/search issues with search code">core/search</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12433377-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Now that searching is done on a per segment basis, there is no way for a Scorer to know the "actual" doc id for the document's it matches (only the relative doc offset into the segment)</p> 
                  <p>If using caches in your scorer that are based on the "entire" index (all segments), there is now no way to index into them properly from inside a Scorer because the scorer is not passed the needed offset to calculate the "real" docid</p> 
                  <p>suggest having Weight.scorer() method also take a integer for the doc offset</p> 
                  <p>Abstract Weight class should have a constructor that takes this offset as well as a method to get the offset<br> All Weights that have "sub" weights must pass this offset down to created "sub" weights</p> 
                  <p>Details on workaround:<br> In order to work around this, you must do the following:</p> 
                  <ul> 
                   <li>Subclass IndexSearcher</li> 
                   <li>Add "int getIndexReaderBase(IndexReader)" method to your subclass</li> 
                   <li>during Weight creation, the Weight must hold onto a reference to the passed in Searcher (casted to your sub class)</li> 
                   <li>during Scorer creation, the Scorer must be passed the result of YourSearcher.getIndexReaderBase(reader)</li> 
                   <li>Scorer can now rebase any collected docids using this offset</li> 
                  </ul> 
                  <p>Example implementation of getIndexReaderBase():</p> 
                  <div class="code panel" style="border-width: 1px;">
                   <div class="codeContent panelContent"> 
                    <pre class="code-java"><span class="code-comment">// NOTE: more efficient implementation can be done <span class="code-keyword">if</span> you cache the result <span class="code-keyword">if</span> gatherSubReaders in your constructor
</span><span class="code-keyword">public</span> <span class="code-object">int</span> getIndexReaderBase(IndexReader reader) {
  <span class="code-keyword">if</span> (reader == getReader()) {
    <span class="code-keyword">return</span> 0;
  } <span class="code-keyword">else</span> {
    List readers = <span class="code-keyword">new</span> ArrayList();
    gatherSubReaders(readers);
    Iterator iter = readers.iterator();
    <span class="code-object">int</span> maxDoc = 0;
    <span class="code-keyword">while</span> (iter.hasNext()) {
      IndexReader r = (IndexReader)iter.next();
      <span class="code-keyword">if</span> (r == reader) {
        <span class="code-keyword">return</span> maxDoc;
      } 
      maxDoc += r.maxDoc();
    } 
  }
  <span class="code-keyword">return</span> -1; <span class="code-comment">// reader not in searcher
</span>}
</pre> 
                   </div>
                  </div> 
                  <p>Notes:</p> 
                  <ul> 
                   <li>This workaround makes it so you cannot serialize your custom Weight implementation</li> 
                  </ul> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-1821?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-1821?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-1821?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-1821?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12417016" data-issue-id="12433377" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12417016/LUCENE-1821.patch" draggable="true" data-downloadurl="text/plain:LUCENE-1821.patch:https://issues.apache.org/jira/secure/attachment/12417016/LUCENE-1821.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12417016/LUCENE-1821.patch" title="Latest  19/Aug/09 13:07 - Tim Smith" draggable="true" data-downloadurl="text/plain:LUCENE-1821.patch:https://issues.apache.org/jira/secure/attachment/12417016/LUCENE-1821.patch">LUCENE-1821.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-08-19T13:07:40.424Z">19/Aug/09 13:07</time>
                   </dd>
                   <dd class="attachment-size">
                    0.9 kB
                   </dd>
                   <dd class="attachment-author">
                    Tim Smith
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_simonw" rel="simonw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Simon Willnauer&quot;,&quot;emailAddress&quot;:&quot;simonw@apache.org&quot;,&quot;username&quot;:&quot;simonw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="simonw"></span></span> Simon Willnauer </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_tsmith" rel="tsmith" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Tim Smith&quot;,&quot;emailAddress&quot;:&quot;tsmith@attivio.com&quot;,&quot;username&quot;:&quot;tsmith&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="tsmith"></span></span> Tim Smith </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="18/Aug/09 20:59"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2009-08-18T20:59:42+0000">18/Aug/09 20:59</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="10/May/13 10:43"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-05-10T10:43:48+0000">10/May/13 10:43</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="14/Jan/11 18:12"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-01-14T18:12:53+0000">14/Jan/11 18:12</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1821?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-1821?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12744711\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744711&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744711\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744711_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744711_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:06:54+0000\'\u003e18\\/Aug\\/09 21:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003esince Weight.explain() is passed the \\\"sub reader\\\", it also should be passed the offset in order to calculate the \\\"real\\\" docid\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744711_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744711_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:06:54+0000\'\u003e18\\/Aug\\/09 21:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    since Weight.explain() is passed the \\\"sub reader\\\", it also should be passed the offset in order to calculate the \\\"real\\\" docid              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744715\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744715&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744715\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744715_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744715_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:07:57+0000\'\u003e18\\/Aug\\/09 21:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think we would prefer that you didn\'t cache by multi-reader. We want to encourage cache by segment.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn my mind, I don\'t think we should try and squeeze this into 2.9. We can see if anyone disagrees.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744715_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744715_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:07:57+0000\'\u003e18\\/Aug\\/09 21:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think we would prefer that you didn\'t cache by multi-reader. We want to encourage cache by segment. \\n\\n In my mind, I don\'t think we should try and squeeze this into 2.9. We can see if anyone disagrees.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744716\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744716&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744716\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744716_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744716_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:09:17+0000\'\u003e18\\/Aug\\/09 21:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor the explain case, if Searcher had the following method, the base offset would not have to be passed in (could be inferred):\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e getIndexReaderBase(IndexReader reader);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744716_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744716_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:09:17+0000\'\u003e18\\/Aug\\/09 21:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For the explain case, if Searcher had the following method, the base offset would not have to be passed in (could be inferred): \\n  \\n  public   int  getIndexReaderBase(IndexReader reader);\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744718\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744718&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744718\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744718_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744718_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:11:14+0000\'\u003e18\\/Aug\\/09 21:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have a really crazy cache that for performance and memory reasons has to be based on the Multi-Reader (and this is very important in my application)\u003c\\/p\u003e\\n\\n\u003cp\u003elooking closer at the per segment searching, i cannot upgrade to 2.9 (which i really want to do) because of this\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744718_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744718_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:11:14+0000\'\u003e18\\/Aug\\/09 21:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have a really crazy cache that for performance and memory reasons has to be based on the Multi-Reader (and this is very important in my application) \\n\\n looking closer at the per segment searching, i cannot upgrade to 2.9 (which i really want to do) because of this              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744719\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744719&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744719\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744719_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744719_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:11:17+0000\'\u003e18\\/Aug\\/09 21:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan you give a use example? What are you caching in the Scorer index wide? It really seems you should be doing it per segment ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744719_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744719_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:11:17+0000\'\u003e18\\/Aug\\/09 21:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can you give a use example? What are you caching in the Scorer index wide? It really seems you should be doing it per segment ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744721\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744721&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744721\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744721_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744721_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:16:06+0000\'\u003e18\\/Aug\\/09 21:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m caching an \\\"index\\\" into the terms for the document (Think of the \\\"StringIndex\\\" without the String[])\u003cbr\\/\u003e\\nall i care about is that integer index value\u003c\\/p\u003e\\n\\n\u003cp\u003ebreaking this out into a per segment cache would then require me to also store along with the int[] index array a String[] \u003cbr\\/\u003e\\nthis then gets really slow and nasty when trying to run through the required algorithms to use the cache for my application\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744721_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744721_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:16:06+0000\'\u003e18\\/Aug\\/09 21:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m caching an \\\"index\\\" into the terms for the document (Think of the \\\"StringIndex\\\" without the String[]) \\nall i care about is that integer index value \\n\\n breaking this out into a per segment cache would then require me to also store along with the int[] index array a String[]  \\nthis then gets really slow and nasty when trying to run through the required algorithms to use the cache for my application              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744732\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744732&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744732\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744732_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744732_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:25:07+0000\'\u003e18\\/Aug\\/09 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think i found a workaround (to allow me to upgrade)\u003c\\/p\u003e\\n\\n\u003cp\u003eI already subclass IndexSearcher, so i could just add the following method (and use this instead of regular search())\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e void mySearch(Weight weight, Collector collector) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n    collector.setNextReader(reader, 0);\\n    Scorer scorer = weight.scorer(reader, !collector.acceptsDocsOutOfOrder(), \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (scorer != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n      scorer.score(collector);\\n    }\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003ehowever, this prevents me from being able to take full advantage of per segment caching (which i really want to use for all my other caches)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744732_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744732_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:25:07+0000\'\u003e18\\/Aug\\/09 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think i found a workaround (to allow me to upgrade) \\n\\n I already subclass IndexSearcher, so i could just add the following method (and use this instead of regular search()) \\n  \\n    public  void mySearch(Weight weight, Collector collector)  throws  IOException {\\n    collector.setNextReader(reader, 0);\\n    Scorer scorer = weight.scorer(reader, !collector.acceptsDocsOutOfOrder(),  true );\\n     if  (scorer !=  null ) {\\n      scorer.score(collector);\\n    }\\n  }\\n \\n  \\n\\n however, this prevents me from being able to take full advantage of per segment caching (which i really want to use for all my other caches)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744742\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744742&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744742\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744742_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744742_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:53:24+0000\'\u003e18\\/Aug\\/09 21:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ebreaking this out into a per segment cache would then require me to also store along with the int[] index array a String[] \u003cbr\\/\u003e\\nthis then gets really slow and nasty when trying to run through the required algorithms to use the cache for my application \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhy is this? You must be keying this to the multi reader now right? Why cannot you not do the same thing keyed to the sub reader?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744742_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744742_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:53:24+0000\'\u003e18\\/Aug\\/09 21:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     breaking this out into a per segment cache would then require me to also store along with the int[] index array a String[]  \\nthis then gets really slow and nasty when trying to run through the required algorithms to use the cache for my application   \\n\\n Why is this? You must be keying this to the multi reader now right? Why cannot you not do the same thing keyed to the sub reader?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744746\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744746&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744746\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744746_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744746_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:58:43+0000\'\u003e18\\/Aug\\/09 21:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThought about it a bit more\u003c\\/p\u003e\\n\\n\u003cp\u003eall i really need is the following method added to Searcher\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e getIndexReaderBase(IndexReader);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eif this doesn\'t go into 2.9, i should be able to add this method to my subclass of IndexSearcher (so i wouldn\'t put this as blocker status for me anymore)\u003c\\/p\u003e\\n\\n\u003cp\u003eas long as Searcher has getIndexReaderBase(), i can have my Weight hold onto the Searcher it was created with and when the scorer is created off it, i can lookup the base offset based on the IndexReader passed in\u003c\\/p\u003e\\n\\n\u003cp\u003ei can work up a patch for this in the morning if desired\u003c\\/p\u003e\\n\\n\u003cp\u003ealso, there should be a big old warning in the change log about MultiReader based cache used in a Weight\\/Scorer being broken (not sure if there\'s a warning specifically about this in there)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744746_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744746_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 21:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T21:58:43+0000\'\u003e18\\/Aug\\/09 21:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thought about it a bit more \\n\\n all i really need is the following method added to Searcher \\n  \\n   public   int  getIndexReaderBase(IndexReader);\\n \\n  \\n\\n if this doesn\'t go into 2.9, i should be able to add this method to my subclass of IndexSearcher (so i wouldn\'t put this as blocker status for me anymore) \\n\\n as long as Searcher has getIndexReaderBase(), i can have my Weight hold onto the Searcher it was created with and when the scorer is created off it, i can lookup the base offset based on the IndexReader passed in \\n\\n i can work up a patch for this in the morning if desired \\n\\n also, there should be a big old warning in the change log about MultiReader based cache used in a Weight\\/Scorer being broken (not sure if there\'s a warning specifically about this in there)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744747\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744747&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744747\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744747_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744747_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 22:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T22:01:58+0000\'\u003e18\\/Aug\\/09 22:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ethe int[] index array is used as a \\\"perfect\\\" hash function in order to be able to map all documents sharing the same value, so the int[] index from each sub reader can have different hash values for the same term (Thats why the string sorting in 2.9 is real nasty, because it can\'t just compare the ord values any more (unless you\'re lucky and you\'re comparing docs from the same reader)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744747_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744747_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 22:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T22:01:58+0000\'\u003e18\\/Aug\\/09 22:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    the int[] index array is used as a \\\"perfect\\\" hash function in order to be able to map all documents sharing the same value, so the int[] index from each sub reader can have different hash values for the same term (Thats why the string sorting in 2.9 is real nasty, because it can\'t just compare the ord values any more (unless you\'re lucky and you\'re comparing docs from the same reader)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744755\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744755&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744755\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744755_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744755_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 22:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T22:23:41+0000\'\u003e18\\/Aug\\/09 22:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'d go with your solution then - I\'d hate to expose doc base stuff on Searcher or in Scorer (I\'m not a big fan of gatherSubReaders being protected either).\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, \u003cb\u003ewe\u003c\\/b\u003e can\'t put Searcher on a Weight - it needs to be serializable (though you can if you don\'t need to count on that).\u003c\\/p\u003e\\n\\n\u003cp\u003eWhere do you suggest we should place a warning that we havn\'t? I don\'t think we ever intended to support the use of external ids.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think your use case is fairly special, and I\'m not sure we should expose per segment stuff where we don\'t have to.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt is an interesting use case though - maybe someone else will chime in.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744755_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744755_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 22:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T22:23:41+0000\'\u003e18\\/Aug\\/09 22:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'d go with your solution then - I\'d hate to expose doc base stuff on Searcher or in Scorer (I\'m not a big fan of gatherSubReaders being protected either). \\n\\n Also,  we  can\'t put Searcher on a Weight - it needs to be serializable (though you can if you don\'t need to count on that). \\n\\n Where do you suggest we should place a warning that we havn\'t? I don\'t think we ever intended to support the use of external ids. \\n\\n I think your use case is fairly special, and I\'m not sure we should expose per segment stuff where we don\'t have to. \\n\\n It is an interesting use case though - maybe someone else will chime in.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744759\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744759&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744759\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744759_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744759_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 22:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T22:35:33+0000\'\u003e18\\/Aug\\/09 22:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll prepare a patch in the morning (unless someone beats me to it) and look over the changelog then to suggest some more disclaimers (if what\'s there isn\'t sufficient)\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t hold the contract that Weight be serializable (so i\'m safe there)\u003c\\/p\u003e\\n\\n\u003cp\u003ei agree that per-segment is the way to go in general and should be as tight as possible (as long as i can get my mits on the \\\"sub readers\\\")\u003c\\/p\u003e\\n\\n\u003cp\u003ebut there are use cases that still require looking at the index as a whole as well\u003cbr\\/\u003e\\nespecially if you need to know the number of unique terms for a field, or otherwise need documents in one segment to be aware of documents in other segments (i could probably come up a bunch more use cases there)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744759_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744759_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 22:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T22:35:33+0000\'\u003e18\\/Aug\\/09 22:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll prepare a patch in the morning (unless someone beats me to it) and look over the changelog then to suggest some more disclaimers (if what\'s there isn\'t sufficient) \\n\\n I don\'t hold the contract that Weight be serializable (so i\'m safe there) \\n\\n i agree that per-segment is the way to go in general and should be as tight as possible (as long as i can get my mits on the \\\"sub readers\\\") \\n\\n but there are use cases that still require looking at the index as a whole as well \\nespecially if you need to know the number of unique terms for a field, or otherwise need documents in one segment to be aware of documents in other segments (i could probably come up a bunch more use cases there)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744771\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744771&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744771\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744771_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744771_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 23:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T23:01:52+0000\'\u003e18\\/Aug\\/09 23:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYou should pull that info from a top level reader and somehow pass it to your scorer through your query impl or something than.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe are working very hard to make search per segment and discourage non per segment use - it doesn\'t seem like you want to be consulting the entire index on every call to scorer. Passing the base around does not help you with looking at the whole index either - just in terms of doc ids - which we don\'t support externally - and you are essentially caching them externally. The document ids should be purely internal - I don\'t think we want to support documents in one segment being aware of docs in another segment either.\u003c\\/p\u003e\\n\\n\u003cp\u003ecreateWeight on Query gives you the opportunity to grab stuff your Scorer may need top level (off the Searcher).\u003c\\/p\u003e\\n\\n\u003cp\u003eYou could also make a new Query each time that takes a top level IndexReader and uses it.\u003c\\/p\u003e\\n\\n\u003cp\u003eYou can also override IndexSearcher (as you have) and work around things there.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744771_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744771_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/09 23:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-18T23:01:52+0000\'\u003e18\\/Aug\\/09 23:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    You should pull that info from a top level reader and somehow pass it to your scorer through your query impl or something than. \\n\\n We are working very hard to make search per segment and discourage non per segment use - it doesn\'t seem like you want to be consulting the entire index on every call to scorer. Passing the base around does not help you with looking at the whole index either - just in terms of doc ids - which we don\'t support externally - and you are essentially caching them externally. The document ids should be purely internal - I don\'t think we want to support documents in one segment being aware of docs in another segment either. \\n\\n createWeight on Query gives you the opportunity to grab stuff your Scorer may need top level (off the Searcher). \\n\\n You could also make a new Query each time that takes a top level IndexReader and uses it. \\n\\n You can also override IndexSearcher (as you have) and work around things there. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744793\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744793&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744793\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744793_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744793_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 00:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T00:11:16+0000\'\u003e19\\/Aug\\/09 00:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy current plan of attack for this use case will be to:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003epull the cache using the MultiReader at createWeight() time (index into cache will be MultiReader docid)\u003c\\/li\u003e\\n\\t\u003cli\u003epull the base offset for the IndexReader at scorer() creation time (will need to add the getIndexReaderBase() method to my searcher to do so)\u003c\\/li\u003e\\n\\t\u003cli\u003ewhen the scorer needs to hit the cache, it\'ll add the base to the scorer\'s docid to get the key for the cache lookup\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI should be able to do this easily enough with a customized IndexSearcher (subclass)\u003c\\/p\u003e\\n\\n\u003cp\u003ethere are use cases where documents from one segment need to be aware of documents from other segments\u003cbr\\/\u003e\\nsorting is such a use case (this is just done at the Collector level, so there are more hooks to do the needed base offset stuff)\u003cbr\\/\u003e\\nduplicate removal is another such use case (only return the first document for docs sharing a field value)\u003c\\/p\u003e\\n\\n\u003cp\u003eboth these use cases can be done at the Collector level, however Duplicate Removal could potentially be done at the Query level in order to perform duplicate removal at any location in the query matching\u003cbr\\/\u003e\\nalso, efficient duplicate removal for a String field would require the int[] ord index in order to reduce overall memory requirements\u003cbr\\/\u003e\\nUsing the int[] ord index allows using a BitSet for the hash set required to mark if a document for a specified value has been encountered (would need a HashSet&lt;String&gt; otherwise (ugh))\u003c\\/p\u003e\\n\\n\u003cp\u003emy particular use case must be done at the query level in order to have full boolean query support, and the ability to layer multiple queries with all combinations of AND\\/OR\\/NOT, and any other query operators, and sadly i have yet to come up with any way to create a cache on a per segment level (without creating the cache at the MultiReader level)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744793_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744793_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 00:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T00:11:16+0000\'\u003e19\\/Aug\\/09 00:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My current plan of attack for this use case will be to: \\n \\n\\t pull the cache using the MultiReader at createWeight() time (index into cache will be MultiReader docid) \\n\\t pull the base offset for the IndexReader at scorer() creation time (will need to add the getIndexReaderBase() method to my searcher to do so) \\n\\t when the scorer needs to hit the cache, it\'ll add the base to the scorer\'s docid to get the key for the cache lookup \\n \\n\\n\\n I should be able to do this easily enough with a customized IndexSearcher (subclass) \\n\\n there are use cases where documents from one segment need to be aware of documents from other segments \\nsorting is such a use case (this is just done at the Collector level, so there are more hooks to do the needed base offset stuff) \\nduplicate removal is another such use case (only return the first document for docs sharing a field value) \\n\\n both these use cases can be done at the Collector level, however Duplicate Removal could potentially be done at the Query level in order to perform duplicate removal at any location in the query matching \\nalso, efficient duplicate removal for a String field would require the int[] ord index in order to reduce overall memory requirements \\nUsing the int[] ord index allows using a BitSet for the hash set required to mark if a document for a specified value has been encountered (would need a HashSet&lt;String&gt; otherwise (ugh)) \\n\\n my particular use case must be done at the query level in order to have full boolean query support, and the ability to layer multiple queries with all combinations of AND\\/OR\\/NOT, and any other query operators, and sadly i have yet to come up with any way to create a cache on a per segment level (without creating the cache at the MultiReader level)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744812\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744812&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744812\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744812_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744812_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 00:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T00:54:19+0000\'\u003e19\\/Aug\\/09 00:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSorting is internal. To allow this switch to per segment we implemented a new HitCollector that can collect from multiple readers - sorting across multiple segments still needed to be supported, and custom comparators still needed to be supported. All of the ids are manged internally though - when I say internally, I mean within Lucene. If you implement a custom FieldComparator, you are still respecting Lucene\'s internal id usage. We map priority queue values so that they can be compared with the values in a different Reader, but again, all of the ids are managed internally. All caching and everything is still done per segment. All FieldCaches are per Reader and per segment.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe goal is to move all caches to the segment level in Lucene - we don\'t want to encourage users to cache per multi-reader by providing API help to do so.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you need index wide stats, you use the Weight.\u003c\\/p\u003e\\n\\n\u003cp\u003eYou are trying to use the internal ids externally - you are caching from external id to ord - its really not something I think we intend to support. The fact that we don\'t support it is why we were able to make this change. The FieldCache is the caching mechanism that Lucene supports with internal ids - and it supports it per segment.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744812_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744812_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 00:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T00:54:19+0000\'\u003e19\\/Aug\\/09 00:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Sorting is internal. To allow this switch to per segment we implemented a new HitCollector that can collect from multiple readers - sorting across multiple segments still needed to be supported, and custom comparators still needed to be supported. All of the ids are manged internally though - when I say internally, I mean within Lucene. If you implement a custom FieldComparator, you are still respecting Lucene\'s internal id usage. We map priority queue values so that they can be compared with the values in a different Reader, but again, all of the ids are managed internally. All caching and everything is still done per segment. All FieldCaches are per Reader and per segment. \\n\\n The goal is to move all caches to the segment level in Lucene - we don\'t want to encourage users to cache per multi-reader by providing API help to do so. \\n\\n If you need index wide stats, you use the Weight. \\n\\n You are trying to use the internal ids externally - you are caching from external id to ord - its really not something I think we intend to support. The fact that we don\'t support it is why we were able to make this change. The FieldCache is the caching mechanism that Lucene supports with internal ids - and it supports it per segment.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744824\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744824&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744824\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12744824_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744824_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 01:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T01:10:07+0000\'\u003e19\\/Aug\\/09 01:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eyou are caching from external id to ord - its really not something I think we intend to support. The fact that we don\'t support it is why we were able to make this change. The FieldCache is the caching mechanism that Lucene supports with internal ids - and it supports it per segment.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think Tim\'s got a valid point though about wanting an ordinal value across the entire index ... he\'s not using external ids, he\'s using the internal lucene docIds, and wants to know the ordinal value of a field for each doc across the entire index &#8211; as he said, he\'s essentially using a FieldCache.StringIndex he just doesn\'t care about the String[] part.\u003c\\/p\u003e\\n\\n\u003cp\u003eSolr had\\/has the same problem with some of the function queries that wanted ordinal values (or the min\\/max field value for the whole index) that i think yonik just punted on and fetched the outermost field cache anyway ... we just weren\'t using it inside the Weight class, so we didn\'t encounter the specified problem Tim did.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_12744824_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744824_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 01:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T01:10:07+0000\'\u003e19\\/Aug\\/09 01:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     you are caching from external id to ord - its really not something I think we intend to support. The fact that we don\'t support it is why we were able to make this change. The FieldCache is the caching mechanism that Lucene supports with internal ids - and it supports it per segment.  \\n\\n I think Tim\'s got a valid point though about wanting an ordinal value across the entire index ... he\'s not using external ids, he\'s using the internal lucene docIds, and wants to know the ordinal value of a field for each doc across the entire index &#8211; as he said, he\'s essentially using a FieldCache.StringIndex he just doesn\'t care about the String[] part. \\n\\n Solr had\\/has the same problem with some of the function queries that wanted ordinal values (or the min\\/max field value for the whole index) that i think yonik just punted on and fetched the outermost field cache anyway ... we just weren\'t using it inside the Weight class, so we didn\'t encounter the specified problem Tim did.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744827\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744827&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744827\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744827_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744827_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 01:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T01:29:11+0000\'\u003e19\\/Aug\\/09 01:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI think Tim\'s got a valid point though about wanting an ordinal value across the entire index ...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t disagree about wanting them at all. Hes using them for a neat purpose. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ehe\'s not using external ids, he\'s using the internal lucene docIds\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf he were respecting the internal ids, you wouldn\'t need to calculate the multi-reader id. Hes essentially caching the multi-reader ids - thats the same as using a filter that always allows doc 0 to pass - its using the internal ids externally. To use the ids correctly, you get a reader and an id space that starts at 0 for that reader. If you want to use the whole reader, you should work with the multi-reader. You can use the multi-reader without breaking it apart here as well if you need to.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think its a slippery slope - we start having to support both the segment ids, plus the multi-reader ids. And as we work on real-time, we will have to count on users caching that way - I think its better to try and work all of our support towards per segment.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll leave it for smarter people to discuss for now - but I don\'t think its the right path. He can essentially do what he needs without built in support, and personally I think thats the way to go. I think its great that right now, other than the sorting\\/hitcollector, things don\'t know about the sub reader breakout.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744827_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744827_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 01:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T01:29:11+0000\'\u003e19\\/Aug\\/09 01:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I think Tim\'s got a valid point though about wanting an ordinal value across the entire index ...  \\n\\n I don\'t disagree about wanting them at all. Hes using them for a neat purpose.  \\n\\n  he\'s not using external ids, he\'s using the internal lucene docIds  \\n\\n If he were respecting the internal ids, you wouldn\'t need to calculate the multi-reader id. Hes essentially caching the multi-reader ids - thats the same as using a filter that always allows doc 0 to pass - its using the internal ids externally. To use the ids correctly, you get a reader and an id space that starts at 0 for that reader. If you want to use the whole reader, you should work with the multi-reader. You can use the multi-reader without breaking it apart here as well if you need to. \\n\\n I think its a slippery slope - we start having to support both the segment ids, plus the multi-reader ids. And as we work on real-time, we will have to count on users caching that way - I think its better to try and work all of our support towards per segment. \\n\\n I\'ll leave it for smarter people to discuss for now - but I don\'t think its the right path. He can essentially do what he needs without built in support, and personally I think thats the way to go. I think its great that right now, other than the sorting\\/hitcollector, things don\'t know about the sub reader breakout.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744833\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744833&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744833\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744833_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744833_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 01:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T01:46:00+0000\'\u003e19\\/Aug\\/09 01:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe goal is to move all caches to the segment level in Lucene - we don\'t want to encourage users to cache per multi-reader by providing API help to do so.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI agree that this is the goal, and that using per segment caches should be the encouraged route for field caching needs. \u003cbr\\/\u003e\\nI plan to update the vast majority of the caches i use to be loaded on a per segment basis once i switch to 2.9 to take advantage of this.\u003cbr\\/\u003e\\nBut it should still be possible for advanced users to do caching on the multireader level. This may require porting upon subsequent versions of lucene (as i\'m seeing i will have to for 2.9), however this should remain possible\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIf you need index wide stats, you use the Weight.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI\'m currently using weight to get this cache on the multireader level, however with 2.9 i will have to jump through some more hoops in order to be able to use this cache on each sub reader\'s scorer\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eYou are trying to use the internal ids externally\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eAll my usage of \\\"internal\\\" docids occurs inside Weight, Scorer, and HitCollector implementations. I don\'t see how this is really \\\"external\\\" as it is using published interfaces. Its just that the interpretation of these interfaces changed for 2.9 (i have no problem with this as long as i can port from 2.4 with minimal to moderate effort). The reason they were able to change was only because no implementations provided by vanilla lucene or in contrib required the \\\"whollistic\\\" view of the index\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThe FieldCache is the caching mechanism that Lucene supports with internal ids - and it supports it per segment.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThe FieldCache mechanism did not meet all my needs with regards to schema\\/retention policy\\/etc, so i have been doing caching in my own code base for quite some time. While the FieldCache usage should be encouraged, it should not be required of advanced users. It should be acceptable for advanced users to feel some pain on upgrading, but there should be a rather clear path for doing so (without a loss of functionality, and ideally without requiring custom patches on top of a released version of lucene)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eSorting is internal.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWhile sorting is provided by lucene APIs, there is nothing (and should be nothing) stopping someone from performing sorting on their own terms via the Collector interface and their own priority queues\\/API\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744833_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744833_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 01:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T01:46:00+0000\'\u003e19\\/Aug\\/09 01:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The goal is to move all caches to the segment level in Lucene - we don\'t want to encourage users to cache per multi-reader by providing API help to do so.  \\n I agree that this is the goal, and that using per segment caches should be the encouraged route for field caching needs.  \\nI plan to update the vast majority of the caches i use to be loaded on a per segment basis once i switch to 2.9 to take advantage of this. \\nBut it should still be possible for advanced users to do caching on the multireader level. This may require porting upon subsequent versions of lucene (as i\'m seeing i will have to for 2.9), however this should remain possible \\n\\n  If you need index wide stats, you use the Weight.  \\n I\'m currently using weight to get this cache on the multireader level, however with 2.9 i will have to jump through some more hoops in order to be able to use this cache on each sub reader\'s scorer \\n\\n  You are trying to use the internal ids externally  \\n All my usage of \\\"internal\\\" docids occurs inside Weight, Scorer, and HitCollector implementations. I don\'t see how this is really \\\"external\\\" as it is using published interfaces. Its just that the interpretation of these interfaces changed for 2.9 (i have no problem with this as long as i can port from 2.4 with minimal to moderate effort). The reason they were able to change was only because no implementations provided by vanilla lucene or in contrib required the \\\"whollistic\\\" view of the index \\n\\n  The FieldCache is the caching mechanism that Lucene supports with internal ids - and it supports it per segment.  \\n The FieldCache mechanism did not meet all my needs with regards to schema\\/retention policy\\/etc, so i have been doing caching in my own code base for quite some time. While the FieldCache usage should be encouraged, it should not be required of advanced users. It should be acceptable for advanced users to feel some pain on upgrading, but there should be a rather clear path for doing so (without a loss of functionality, and ideally without requiring custom patches on top of a released version of lucene) \\n\\n  Sorting is internal.  \\n While sorting is provided by lucene APIs, there is nothing (and should be nothing) stopping someone from performing sorting on their own terms via the Collector interface and their own priority queues\\/API \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744847\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744847&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744847\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744847_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744847_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 02:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T02:25:51+0000\'\u003e19\\/Aug\\/09 02:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe \\\"internal\\\" vs \\\"external\\\" is kind of confusing made up terms - my fault really.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen I think of using the ids \'internally\' I\'m thinking that you are taking the index reader and making no assumptions. You just use the single reader and its id space. You can use those ids to get values, and you can map from those ids to values.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe assumption being made here is that you can load up ords for every doc and that these ords will be comparable in a way that every document id across the whole index maps to the same ord if it has the same value for a field. Nothing in the API promised that to my knowledge - it just happened to be a happy side effect. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWhile sorting is provided by lucene APIs, there is nothing (and should be nothing) stopping someone from performing sorting on their own terms via the Collector interface and their own priority queues\\/API\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIndeed - just like there is nothing stopping you from continuing to use a MultiReader for this functionality.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat I mean by sorting is internal is that we specifically support comparing ords\\/values across readers. I think we would prefer that you don\'t count on ids coming from the top reader or a sub reader in other cases. We don\'t promise one way or another. We just give a reader and say work with this reader.\u003c\\/p\u003e\\n\\n\u003cp\u003eExperts can generally jump around that if they need to - Solr does a bit of this - or you can choose to continue using Multi-Readers.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not saying we should make it impossible for you to do this - but I don\'t think we should open a path for scorers to reconstruct multi-reader virtual ids. I don\'t think a Scorer should know or care why type of IndexReader it is working with.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744847_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744847_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 02:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T02:25:51+0000\'\u003e19\\/Aug\\/09 02:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The \\\"internal\\\" vs \\\"external\\\" is kind of confusing made up terms - my fault really. \\n\\n When I think of using the ids \'internally\' I\'m thinking that you are taking the index reader and making no assumptions. You just use the single reader and its id space. You can use those ids to get values, and you can map from those ids to values. \\n\\n The assumption being made here is that you can load up ords for every doc and that these ords will be comparable in a way that every document id across the whole index maps to the same ord if it has the same value for a field. Nothing in the API promised that to my knowledge - it just happened to be a happy side effect.  \\n\\n  While sorting is provided by lucene APIs, there is nothing (and should be nothing) stopping someone from performing sorting on their own terms via the Collector interface and their own priority queues\\/API  \\n\\n Indeed - just like there is nothing stopping you from continuing to use a MultiReader for this functionality. \\n\\n What I mean by sorting is internal is that we specifically support comparing ords\\/values across readers. I think we would prefer that you don\'t count on ids coming from the top reader or a sub reader in other cases. We don\'t promise one way or another. We just give a reader and say work with this reader. \\n\\n Experts can generally jump around that if they need to - Solr does a bit of this - or you can choose to continue using Multi-Readers. \\n\\n I\'m not saying we should make it impossible for you to do this - but I don\'t think we should open a path for scorers to reconstruct multi-reader virtual ids. I don\'t think a Scorer should know or care why type of IndexReader it is working with.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744853\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744853&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744853\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744853_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744853_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 03:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T03:08:56+0000\'\u003e19\\/Aug\\/09 03:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ehe\'s not using external ids, he\'s using the internal lucene docIds\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eLet me try a response to this one once more:\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you try and make a filter that always matches docs 0-10, you could have made a filter that just sets bits 0-10. You are technically using \'internal\' lucene doc ids. \u003c\\/p\u003e\\n\\n\u003cp\u003eWith the new per segment search though, you will find that you match the first 10 docs in every segment, not just the first 10 docs in the multi-reader virtual id space. This is what I call using the internal doc ids externally. You are counting on a single id space covering the whole index for the reader. This was never promised though. So just like this type of filter was not \u003cb\u003ereally\u003c\\/b\u003e supported and no longer works - this method of relying on the IndexReader to support one id space across the whole index no longer works as well. The Searcher supports the whole index, but a given IndexReader was never promised to do so. We could have passed base doc ids to the filters so that they could reconstruct the multi-reader virtual ids, and then just actually match docs 0-10 - but thats exactly the opposite of what we are trying to achieve. We switched to per segment to get away from that.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744853_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744853_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 03:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T03:08:56+0000\'\u003e19\\/Aug\\/09 03:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     he\'s not using external ids, he\'s using the internal lucene docIds  \\n\\n Let me try a response to this one once more: \\n\\n If you try and make a filter that always matches docs 0-10, you could have made a filter that just sets bits 0-10. You are technically using \'internal\' lucene doc ids.  \\n\\n With the new per segment search though, you will find that you match the first 10 docs in every segment, not just the first 10 docs in the multi-reader virtual id space. This is what I call using the internal doc ids externally. You are counting on a single id space covering the whole index for the reader. This was never promised though. So just like this type of filter was not  really  supported and no longer works - this method of relying on the IndexReader to support one id space across the whole index no longer works as well. The Searcher supports the whole index, but a given IndexReader was never promised to do so. We could have passed base doc ids to the filters so that they could reconstruct the multi-reader virtual ids, and then just actually match docs 0-10 - but thats exactly the opposite of what we are trying to achieve. We switched to per segment to get away from that.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744854\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744854&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744854\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744854_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744854_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 03:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T03:11:08+0000\'\u003e19\\/Aug\\/09 03:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI\'m not saying we should make it impossible for you to do this - but I don\'t think we should open a path for scorers to reconstruct multi-reader virtual ids. I don\'t think a Scorer should know or care why type of IndexReader it is working with.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ei disagree with that, i think the APIs should make it clear whether you are working with a sub reader or a top level reader\u003cbr\\/\u003e\\nif a Scorer is given an IndexReader, it should have the same ability to reconstruct the \\\"client facing\\\" docid in the same manner as the Collector interface provides in order to provide a consistent interface between Collectors and Scorers\u003cbr\\/\u003e\\nThis reconstruction should be documented as \\\"advanced\\\", however it should still be available\u003c\\/p\u003e\\n\\n\u003cp\u003eWhereever an IndexReader is exposed in API calls, it should be possible to walk the IndexReader\'s parent IndexReaders until you get the top level reader in order to have the full context of that IndexReader. This walking should only be done at \\\"init\\\" time (Scorer construction\\/Collector setScorer(), and so on depending on need of the application, but it should be possible (ideally without doing nasty things))\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744854_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744854_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 03:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T03:11:08+0000\'\u003e19\\/Aug\\/09 03:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I\'m not saying we should make it impossible for you to do this - but I don\'t think we should open a path for scorers to reconstruct multi-reader virtual ids. I don\'t think a Scorer should know or care why type of IndexReader it is working with.  \\n\\n i disagree with that, i think the APIs should make it clear whether you are working with a sub reader or a top level reader \\nif a Scorer is given an IndexReader, it should have the same ability to reconstruct the \\\"client facing\\\" docid in the same manner as the Collector interface provides in order to provide a consistent interface between Collectors and Scorers \\nThis reconstruction should be documented as \\\"advanced\\\", however it should still be available \\n\\n Whereever an IndexReader is exposed in API calls, it should be possible to walk the IndexReader\'s parent IndexReaders until you get the top level reader in order to have the full context of that IndexReader. This walking should only be done at \\\"init\\\" time (Scorer construction\\/Collector setScorer(), and so on depending on need of the application, but it should be possible (ideally without doing nasty things))              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744855\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744855&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744855\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744855_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744855_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 03:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T03:17:17+0000\'\u003e19\\/Aug\\/09 03:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eon \\\"internal lucene ids\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eright now (2.4) i always know what docids map to what IndexReader (always the top level)\u003cbr\\/\u003e\\ni don\'t have a problem breaking that assumption, as long as i have the context to map docids between spaces (sub reader to top level and back (mabye even a couple more levels in between))  \u003c\\/p\u003e\\n\\n\u003cp\u003eI opened this ticket soley because in the Scorer API there is no presented way to actually do this mapping between spaces (short of the \\\"hacks\\\" i discussed way above)\u003cbr\\/\u003e\\nI have no problem whatsoever in the changing of what \\\"space\\\" docids exist in, as long as i can get to and from the top level to this space\u003cbr\\/\u003e\\nI also have no problem if how to do this mapping changes between releases (as long as its documented)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12744855_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744855_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 03:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T03:17:17+0000\'\u003e19\\/Aug\\/09 03:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    on \\\"internal lucene ids\\\" \\n\\n right now (2.4) i always know what docids map to what IndexReader (always the top level) \\ni don\'t have a problem breaking that assumption, as long as i have the context to map docids between spaces (sub reader to top level and back (mabye even a couple more levels in between))   \\n\\n I opened this ticket soley because in the Scorer API there is no presented way to actually do this mapping between spaces (short of the \\\"hacks\\\" i discussed way above) \\nI have no problem whatsoever in the changing of what \\\"space\\\" docids exist in, as long as i can get to and from the top level to this space \\nI also have no problem if how to do this mapping changes between releases (as long as its documented)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744857\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744857&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744857\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744857_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744857_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 03:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T03:30:05+0000\'\u003e19\\/Aug\\/09 03:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYou may get furthers with others than me Tim, so don\'t get too, too caught up with me. McCandless is still on vacation for one, and he may have ideas other than mine (and certainly better ideas even if they are not other) - others may still jump in too. The two of us did the majority of the per segment work though. Yonik has also fought through a lot of this type of stuff with Solr - I\'m sure he has some stance on this stuff.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWhereever an IndexReader is exposed in API calls, it should be possible to walk the IndexReader\'s parent IndexReaders until you get the top level reader in order to have the full context of that IndexReader\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSolr now works this way to get around some of the per segment issues. I\'m not sure if it makes sense to support that fully in Lucene or not. Perhaps so. Too late for me to properly think though - time for bed.\u003c\\/p\u003e\\n\\n\u003cp\u003eAny downsides I wonder ...\u003c\\/p\u003e\\n\\n\u003cp\u003eI think my main issue is that it will encourage people to work per top level reader and it will force us to take that into account ...\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12744857_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744857_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 03:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T03:30:05+0000\'\u003e19\\/Aug\\/09 03:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    You may get furthers with others than me Tim, so don\'t get too, too caught up with me. McCandless is still on vacation for one, and he may have ideas other than mine (and certainly better ideas even if they are not other) - others may still jump in too. The two of us did the majority of the per segment work though. Yonik has also fought through a lot of this type of stuff with Solr - I\'m sure he has some stance on this stuff. \\n\\n  Whereever an IndexReader is exposed in API calls, it should be possible to walk the IndexReader\'s parent IndexReaders until you get the top level reader in order to have the full context of that IndexReader  \\n\\n Solr now works this way to get around some of the per segment issues. I\'m not sure if it makes sense to support that fully in Lucene or not. Perhaps so. Too late for me to properly think though - time for bed. \\n\\n Any downsides I wonder ... \\n\\n I think my main issue is that it will encourage people to work per top level reader and it will force us to take that into account ... \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12744970\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12744970&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12744970\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12744970_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744970_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 09:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T09:45:24+0000\'\u003e19\\/Aug\\/09 09:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eBTW contrib\\/spatial has exactly this same problem.  It currently\u003cbr\\/\u003e\\nbuilds up a cache, keyed on the \\\"top\\\" (MultiReader\'s) docID, of the\u003cbr\\/\u003e\\nprecise distance computed by its precise distance filters, to then be\u003cbr\\/\u003e\\nused during sorting.  Right now it simply computes its own docBase and\u003cbr\\/\u003e\\nincrements it every time getDocIdSet() is called (which is messy).\u003cbr\\/\u003e\\nThough I think it could (and should) switch to a per-segment cache.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am torn.  On the one hand we don\'t want to encourage apps to be\u003cbr\\/\u003e\\nusing \\\"top docIDs\\\" anywhere \\\"down low\\\" (eg Weight\\/Scorer).  We\'d like\u003cbr\\/\u003e\\nall such per-segment swtiching to happen \\\"up high\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eBut on the other hand, this is quite a sudden change, and most\u003cbr\\/\u003e\\nadvanced apps will be using the top docIDs by definition (since\u003cbr\\/\u003e\\nper-segment docIDs only becomes an \u003cspan class=\\\"error\\\"\u003e&#91;easy&#93;\u003c\\/span\u003e option in 2.9), so it\'d be\u003cbr\\/\u003e\\nmore friendly to offer up a cleaner migration path for such apps where\u003cbr\\/\u003e\\nWeight\\/Scorer is told its docBase.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd, having to migrate an ord index from \\\"top\\\" to \\\"sub\\\" docIDs is\u003cbr\\/\u003e\\ntruly a nightmare, having gone through that with Mark in getting\u003cbr\\/\u003e\\nString sorting to work per segment!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12744970_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12744970_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 09:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T09:45:24+0000\'\u003e19\\/Aug\\/09 09:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n BTW contrib\\/spatial has exactly this same problem.  It currently \\nbuilds up a cache, keyed on the \\\"top\\\" (MultiReader\'s) docID, of the \\nprecise distance computed by its precise distance filters, to then be \\nused during sorting.  Right now it simply computes its own docBase and \\nincrements it every time getDocIdSet() is called (which is messy). \\nThough I think it could (and should) switch to a per-segment cache. \\n\\n I am torn.  On the one hand we don\'t want to encourage apps to be \\nusing \\\"top docIDs\\\" anywhere \\\"down low\\\" (eg Weight\\/Scorer).  We\'d like \\nall such per-segment swtiching to happen \\\"up high\\\". \\n\\n But on the other hand, this is quite a sudden change, and most \\nadvanced apps will be using the top docIDs by definition (since \\nper-segment docIDs only becomes an  &#91;easy&#93;  option in 2.9), so it\'d be \\nmore friendly to offer up a cleaner migration path for such apps where \\nWeight\\/Scorer is told its docBase. \\n\\n And, having to migrate an ord index from \\\"top\\\" to \\\"sub\\\" docIDs is \\ntruly a nightmare, having gone through that with Mark in getting \\nString sorting to work per segment!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745036\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745036&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745036\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745036_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745036_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 12:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T12:46:32+0000\'\u003e19\\/Aug\\/09 12:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eConcerning the changelog, i feel the below should be added to the \\\"Changes in runtime behavior\\\" section (it\'s kinda specified in \\\"New features\\\", however\u003cbr\\/\u003e\\nit is also a rather substantial change in the runtime behavior and should be called out explicitly there)\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e 13. LUCENE-1483: When searching over multiple segments, a \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Scorer is created \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e each segment. \\n        The Weight is created only once \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e the top level searcher. Each Scorer is passed the per-segment IndexReader.\\n        This will result in docids in the Scorer being internal to the per-segment IndexReader and there is currently no way\\n         to rebase these docids to the top level IndexReader. This results in any caches\\/filters that use docids over the top \\n         IndexReader to be broken.\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745036_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745036_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 12:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T12:46:32+0000\'\u003e19\\/Aug\\/09 12:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Concerning the changelog, i feel the below should be added to the \\\"Changes in runtime behavior\\\" section (it\'s kinda specified in \\\"New features\\\", however \\nit is also a rather substantial change in the runtime behavior and should be called out explicitly there) \\n\\n  \\n  13. LUCENE-1483: When searching over multiple segments, a  new  Scorer is created  for  each segment. \\n        The Weight is created only once  for  the top level searcher. Each Scorer is passed the per-segment IndexReader.\\n        This will result in docids in the Scorer being internal to the per-segment IndexReader and there is currently no way\\n         to rebase these docids to the top level IndexReader. This results in any caches\\/filters that use docids over the top \\n         IndexReader to be broken.\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745039\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745039&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745039\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745039_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745039_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 12:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T12:55:37+0000\'\u003e19\\/Aug\\/09 12:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think thats a good idea. I think that last sentence needs a bit of work. Here is another attempt that I am still not quite happy with:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e13. LUCENE-1483: When searching over multiple segments, a \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Scorer is created \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e each segment. \\n        The Weight is created only once \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e the top level searcher. Each Scorer is passed the per-segment IndexReader.\\n        This will result in docids in the Scorer being internal to the per-segment IndexReader and there is currently no way\\n         to rebase these docids to the top level IndexReader. This will likely \u003cspan class=\\\"code-keyword\\\"\u003ebreak\u003c\\/span\u003e any caches\\/filters in Scorers that rely on docids from the top \\n         level IndexReader eg \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e you rely on the IndexReader to contain every doc id in the index.\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745039_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745039_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 12:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T12:55:37+0000\'\u003e19\\/Aug\\/09 12:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think thats a good idea. I think that last sentence needs a bit of work. Here is another attempt that I am still not quite happy with: \\n\\n  \\n 13. LUCENE-1483: When searching over multiple segments, a  new  Scorer is created  for  each segment. \\n        The Weight is created only once  for  the top level searcher. Each Scorer is passed the per-segment IndexReader.\\n        This will result in docids in the Scorer being internal to the per-segment IndexReader and there is currently no way\\n         to rebase these docids to the top level IndexReader. This will likely  break  any caches\\/filters in Scorers that rely on docids from the top \\n         level IndexReader eg  if  you rely on the IndexReader to contain every doc id in the index. \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745041\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745041&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745041\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745041_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745041_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 13:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T13:03:37+0000\'\u003e19\\/Aug\\/09 13:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne more pass\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e13. LUCENE-1483: When searching over multiple segments, a \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Scorer is created \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e each segment. \\n        The Weight is created only once \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e the top level searcher. Each Scorer is passed the per-segment IndexReader.\\n        This will result in docids in the Scorer being internal to the per-segment IndexReader. If a custom Scorer implementation \\n         uses any caches\\/filters based on the top level IndexReader\\/Searcher, it will need to be updated to use caches\\/filters on a \\n         per segment basis. There is currently no way provided to rebase the docids in the Scorer to the top level IndexReader.\\n         See LUCENE-1821 \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e discussion on workarounds \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745041_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745041_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 13:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T13:03:37+0000\'\u003e19\\/Aug\\/09 13:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One more pass \\n\\n  \\n 13. LUCENE-1483: When searching over multiple segments, a  new  Scorer is created  for  each segment. \\n        The Weight is created only once  for  the top level searcher. Each Scorer is passed the per-segment IndexReader.\\n        This will result in docids in the Scorer being internal to the per-segment IndexReader. If a custom Scorer implementation \\n         uses any caches\\/filters based on the top level IndexReader\\/Searcher, it will need to be updated to use caches\\/filters on a \\n         per segment basis. There is currently no way provided to rebase the docids in the Scorer to the top level IndexReader.\\n         See LUCENE-1821  for  discussion on workarounds  for   this .\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745043\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745043&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745043\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745043_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745043_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 13:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T13:07:40+0000\'\u003e19\\/Aug\\/09 13:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s a patch that adds getIndexReaderBase(IndexReader reader) to IndexSearcher\u003c\\/p\u003e\\n\\n\u003cp\u003esadly, this cannot be easily added to MultiSearcher as well as it uses \\\"Searchables\\\", which would require adding this method to the Searchable interface\u003cbr\\/\u003e\\nI could work up another patch that adds this method to the Searchable interface, however that has some back-compat concerns\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745043_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745043_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 13:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T13:07:40+0000\'\u003e19\\/Aug\\/09 13:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s a patch that adds getIndexReaderBase(IndexReader reader) to IndexSearcher \\n\\n sadly, this cannot be easily added to MultiSearcher as well as it uses \\\"Searchables\\\", which would require adding this method to the Searchable interface \\nI could work up another patch that adds this method to the Searchable interface, however that has some back-compat concerns              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745044\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745044&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745044\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745044_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745044_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 13:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T13:08:32+0000\'\u003e19\\/Aug\\/09 13:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooks great!\u003c\\/p\u003e\\n\\n\u003cp\u003eI still almost want to say rely on though:\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003euses any caches\\/filters based on the top level IndexReader\\/Searcher\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003euses any caches\\/filters that rely on being based on the top level IndexReader\\/Searcher\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNo? It seems like you could be based on a top level reader before, but not rely on the fact that it was a top level ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745044_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745044_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 13:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T13:08:32+0000\'\u003e19\\/Aug\\/09 13:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looks great! \\n\\n I still almost want to say rely on though: \\n\\n  uses any caches\\/filters based on the top level IndexReader\\/Searcher  \\n\\n  uses any caches\\/filters that rely on being based on the top level IndexReader\\/Searcher  \\n\\n No? It seems like you could be based on a top level reader before, but not rely on the fact that it was a top level ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745045\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745045&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745045\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745045_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745045_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 13:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T13:10:38+0000\'\u003e19\\/Aug\\/09 13:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\\\"rely on\\\" it is\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745045_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745045_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/09 13:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-19T13:10:38+0000\'\u003e19\\/Aug\\/09 13:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\\"rely on\\\" it is              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745367\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745367&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745367\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12745367_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745367_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 09:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T09:57:40+0000\'\u003e20\\/Aug\\/09 09:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think we should in fact add this API to 2.9?  It can ease the transition for users doing expert stuff w\\/ Lucene today.  The current patch looks reasonable, but we should mark it as expert and note that one should switch one\'s app logic to be per-segment whenever possible, instead of operating in the composite reader\'s docID space.  We should also note that it\'s O(N) CPU cost, ie, you should not call it for every hit (for example), but rather once per-segment and then hold onto that base.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12745367_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745367_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 09:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T09:57:40+0000\'\u003e20\\/Aug\\/09 09:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think we should in fact add this API to 2.9?  It can ease the transition for users doing expert stuff w\\/ Lucene today.  The current patch looks reasonable, but we should mark it as expert and note that one should switch one\'s app logic to be per-segment whenever possible, instead of operating in the composite reader\'s docID space.  We should also note that it\'s O(N) CPU cost, ie, you should not call it for every hit (for example), but rather once per-segment and then hold onto that base.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745416\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745416&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745416\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745416_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745416_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 12:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T12:05:17+0000\'\u003e20\\/Aug\\/09 12:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt would also be nice if the top level Searcher were pased in to Weight.scorer() (like in Weight.explain())\u003cbr\\/\u003e\\nthat way custom Weight implementations won\'t need to hold onto the Searcher at Weight creation time (thats a bigger patch though)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745416_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745416_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 12:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T12:05:17+0000\'\u003e20\\/Aug\\/09 12:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It would also be nice if the top level Searcher were pased in to Weight.scorer() (like in Weight.explain()) \\nthat way custom Weight implementations won\'t need to hold onto the Searcher at Weight creation time (thats a bigger patch though)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745418\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745418&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745418\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745418_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745418_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 12:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T12:08:29+0000\'\u003e20\\/Aug\\/09 12:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIt can ease the transition for users doing expert stuff w\\/ Lucene today\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think it only helps if you counted on the reader having every doc id in it?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt needs more than the current patch I think - we can\'t rely on people being able to plant a Searcher on the Weight ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745418_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745418_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 12:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T12:08:29+0000\'\u003e20\\/Aug\\/09 12:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     It can ease the transition for users doing expert stuff w\\/ Lucene today  \\n\\n I think it only helps if you counted on the reader having every doc id in it? \\n\\n It needs more than the current patch I think - we can\'t rely on people being able to plant a Searcher on the Weight ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745423\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745423&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745423\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745423_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745423_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 12:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T12:27:15+0000\'\u003e20\\/Aug\\/09 12:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI can work up another patch where the Searcher is passed into Weight.scorer() as well if that is an acceptable approach (this method was already changed alot in 2.9 anyway)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745423_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745423_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 12:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T12:27:15+0000\'\u003e20\\/Aug\\/09 12:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I can work up another patch where the Searcher is passed into Weight.scorer() as well if that is an acceptable approach (this method was already changed alot in 2.9 anyway)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745430\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745430&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745430\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745430_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745430_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 12:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T12:52:54+0000\'\u003e20\\/Aug\\/09 12:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m still not sold on this - these use cases don\'t work with MultiSearcher either right? I think thats part of this not being officially supported before either ...\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd passing the Searcher doesn\'t quite work right either - thats already kind of a bug with explain - you get the searcher with the doc - not a searcher that covers the whole multisearcher space.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745430_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745430_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 12:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T12:52:54+0000\'\u003e20\\/Aug\\/09 12:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m still not sold on this - these use cases don\'t work with MultiSearcher either right? I think thats part of this not being officially supported before either ... \\n\\n And passing the Searcher doesn\'t quite work right either - thats already kind of a bug with explain - you get the searcher with the doc - not a searcher that covers the whole multisearcher space.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745436\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745436&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745436\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745436_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745436_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 13:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T13:06:03+0000\'\u003e20\\/Aug\\/09 13:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003etrue, MultiSearcher does kink things up some (and the Searcher abstract class in general)\u003c\\/p\u003e\\n\\n\u003cp\u003epersonally, this is not a problem for me (don\'t use MultiSearcher (not yet at least)), and i\'m happy with being passed the IndexSearcher instance that directly contains the IndexReader i\'m being passed\u003c\\/p\u003e\\n\\n\u003cp\u003eThe contract could be marked that the Searcher provided is the direct container of the IndexReader also passed\u003cbr\\/\u003e\\nat which point, both explain() and scorer() would be \\\"accurate\\\" in terms of this\u003c\\/p\u003e\\n\\n\u003cp\u003eI would almost like to see something different passed in instead of a Searcher\\/IndexReader pair\u003c\\/p\u003e\\n\\n\u003cp\u003ei would actually like to see a \\\"SearchContext\\\" sort of object passed in\u003cbr\\/\u003e\\nthis would represent the whole \\\"tree\\\" of Searchers\\/IndexReaders\u003cbr\\/\u003e\\nthis would allow access to the MultiSearcher, the direct IndexSearcher, and the sub IndexReader (which should actually be used for the scoring) (as well as any other Searcher\'s in the call stack) \u003cbr\\/\u003e\\nthis SearchContext could also pass in the \\\"topScorer\\/allowDocsInOrder\\\" flags (but that would be more difficult as scorers have subscorers that need to sometimes be created with different flags for these), but this SearchContext could be used to pass more information throughout the Scorer API in general from the top level (like - always use constant score queries where possible, use scoring algorithm X, Y, or Z, and so on)\u003c\\/p\u003e\\n\\n\u003cp\u003eobviously this would impact the API of Searcher a good deal as it would have to maintain this stack as sub Searcher\'s search() methods are called)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745436_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745436_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 13:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T13:06:03+0000\'\u003e20\\/Aug\\/09 13:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    true, MultiSearcher does kink things up some (and the Searcher abstract class in general) \\n\\n personally, this is not a problem for me (don\'t use MultiSearcher (not yet at least)), and i\'m happy with being passed the IndexSearcher instance that directly contains the IndexReader i\'m being passed \\n\\n The contract could be marked that the Searcher provided is the direct container of the IndexReader also passed \\nat which point, both explain() and scorer() would be \\\"accurate\\\" in terms of this \\n\\n I would almost like to see something different passed in instead of a Searcher\\/IndexReader pair \\n\\n i would actually like to see a \\\"SearchContext\\\" sort of object passed in \\nthis would represent the whole \\\"tree\\\" of Searchers\\/IndexReaders \\nthis would allow access to the MultiSearcher, the direct IndexSearcher, and the sub IndexReader (which should actually be used for the scoring) (as well as any other Searcher\'s in the call stack)  \\nthis SearchContext could also pass in the \\\"topScorer\\/allowDocsInOrder\\\" flags (but that would be more difficult as scorers have subscorers that need to sometimes be created with different flags for these), but this SearchContext could be used to pass more information throughout the Scorer API in general from the top level (like - always use constant score queries where possible, use scoring algorithm X, Y, or Z, and so on) \\n\\n obviously this would impact the API of Searcher a good deal as it would have to maintain this stack as sub Searcher\'s search() methods are called)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745686\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745686&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745686\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745686_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745686_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 21:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T21:56:52+0000\'\u003e20\\/Aug\\/09 21:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMarking as fix for 2.9 so this gets looked over real good prior to 2.9 going out (even if it is punted)\u003c\\/p\u003e\\n\\n\u003cp\u003ei believe i can workaround this (still integrating 2.9 into my app, and i haven\'t got to per-field caching stuff yet)\u003c\\/p\u003e\\n\\n\u003cp\u003eIn order to get my app to work with 2.9 (without any major mods), i had to add the following to my IndexSearcher subclass:\u003cbr\\/\u003e\\nNOTE: i never use Filter (thats why this skips it over)\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  @Override\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e void search(Weight weight, Filter filter, Collector collector) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Need to work on the top level reader \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e now\\n\u003c\\/span\u003e    collector.setNextReader(reader, 0);\\n    \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Scorer scorer = weight.scorer(reader, !collector.acceptsDocsOutOfOrder(), \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (scorer != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n      scorer.score(collector);\\n    }\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745686_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745686_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/09 21:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-20T21:56:52+0000\'\u003e20\\/Aug\\/09 21:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Marking as fix for 2.9 so this gets looked over real good prior to 2.9 going out (even if it is punted) \\n\\n i believe i can workaround this (still integrating 2.9 into my app, and i haven\'t got to per-field caching stuff yet) \\n\\n In order to get my app to work with 2.9 (without any major mods), i had to add the following to my IndexSearcher subclass: \\nNOTE: i never use Filter (thats why this skips it over) \\n  \\n   @Override\\n   public  void search(Weight weight, Filter filter, Collector collector)  throws  IOException {\\n     \\/\\/ Need to work on the top level reader  for  now\\n     collector.setNextReader(reader, 0);\\n     final  Scorer scorer = weight.scorer(reader, !collector.acceptsDocsOutOfOrder(),  true );\\n     if  (scorer !=  null ) {\\n      scorer.score(collector);\\n    }\\n  }\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745735\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745735&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745735\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745735_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745735_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 00:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T00:13:15+0000\'\u003e21\\/Aug\\/09 00:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m still not a fan of giving access to the upper readers.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think I could go for having the offset available with the appropriate warnings.\u003c\\/p\u003e\\n\\n\u003cp\u003eI tried this out, and after adjusting all scorer, explains to carry the offset as well, I ended up with one spot left:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e DocIdSet getDocIdSet(\u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e IndexReader reader) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n    \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Weight weight = query.weight(\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e IndexSearcher(reader));\\n    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e DocIdSet() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e DocIdSetIterator iterator() \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e weight.scorer(reader, docBase?, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e, \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e);\\n      }\\n    };\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eTrouble - in these cases, how do you pass the doc base? Its too much breakage to pass it with the reader \u003cb\u003eeverywhere\u003c\\/b\u003e. You almost want a class that holds the reader ref and the docBase, but you still break apis all over. You could deprecate everything, but then you can\'t count on getting a good offset (would have to guess 0? ).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745735_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745735_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 00:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T00:13:15+0000\'\u003e21\\/Aug\\/09 00:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m still not a fan of giving access to the upper readers. \\n\\n I think I could go for having the offset available with the appropriate warnings. \\n\\n I tried this out, and after adjusting all scorer, explains to carry the offset as well, I ended up with one spot left: \\n\\n  \\n    public  DocIdSet getDocIdSet( final  IndexReader reader)  throws  IOException {\\n     final  Weight weight = query.weight( new  IndexSearcher(reader));\\n     return   new  DocIdSet() {\\n       public  DocIdSetIterator iterator()  throws  IOException {\\n         return  weight.scorer(reader, docBase?,  true ,  false );\\n      }\\n    };\\n  }\\n \\n  \\n\\n Trouble - in these cases, how do you pass the doc base? Its too much breakage to pass it with the reader  everywhere . You almost want a class that holds the reader ref and the docBase, but you still break apis all over. You could deprecate everything, but then you can\'t count on getting a good offset (would have to guess 0? ).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745754\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745754&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745754\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745754_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745754_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 00:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T00:55:12+0000\'\u003e21\\/Aug\\/09 00:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ein the case of the getDocIdSet() method, i would say you should pass \\\"0\\\" for the docBase\u003cbr\\/\u003e\\nThis is because in this case, you are asking for DocIdSet in the context of \u003cb\u003ereader\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ehowevever, this method is actually also a bit broken now with per segment searching\u003cbr\\/\u003e\\nwhat if \u003cb\u003ereader\u003c\\/b\u003e is a MultiReader\u003cbr\\/\u003e\\nThis could now incur the \\\"double ram usage\\\" penalty refered to in that \\\"explain()\\\" ticket i recall seeing last week\u003cbr\\/\u003e\\nIf  \u003cb\u003equery\u003c\\/b\u003e has any ValueSource based queries, it\'ll result in getting the ValueSource in the context of the MultiReader (if i\'m not mistaken)\u003cbr\\/\u003e\\nSo, this method in particular should probably be rewritten to return a DocIdSetIterator that will step through each segment in \\\"reader\\\" in turn\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745754_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745754_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 00:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T00:55:12+0000\'\u003e21\\/Aug\\/09 00:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    in the case of the getDocIdSet() method, i would say you should pass \\\"0\\\" for the docBase \\nThis is because in this case, you are asking for DocIdSet in the context of  reader  \\n\\n howevever, this method is actually also a bit broken now with per segment searching \\nwhat if  reader  is a MultiReader \\nThis could now incur the \\\"double ram usage\\\" penalty refered to in that \\\"explain()\\\" ticket i recall seeing last week \\nIf   query  has any ValueSource based queries, it\'ll result in getting the ValueSource in the context of the MultiReader (if i\'m not mistaken) \\nSo, this method in particular should probably be rewritten to return a DocIdSetIterator that will step through each segment in \\\"reader\\\" in turn              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745756\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745756&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745756\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745756_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745756_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 01:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T01:03:43+0000\'\u003e21\\/Aug\\/09 01:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 21\\/Aug\\/09 01:12\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003ehowevever, this method is actually also a bit broken now with per segment searching\u003cbr\\/\u003e\\nwhat if reader is a MultiReader\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRight - there are many places where this could be the case - your still free to use multi-readers, though we encourage you to switch. We provide a cool cache sanity checker to help you find these cases, and evaluate whether or not you can make the switch. \u003cb\u003eedit\u003c\\/b\u003e I know this doesn\'t help with filters - there was an issue that helped address that I think though - worked on by Hoss and Mike McCandless - not sure if that helps here or if this was overlooked or what though - I\'ll have to go skim that issue again. \u003cb\u003eedit\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you just pass 0, many times it will be wrong. Why shouldn\'t this have access to a doc id cache as well? We always ask for everything in the context of the Reader given. I think thats the issue. Lucene just never officially supported this use case - we can\'t with MultiSearcher, Searchable, Remote - the API doesn\'t work with the idea that you can count on all the doc ids from a Reader. You were taking advantage of the implementation and your limited use of the full API - but its never been part of the API IMHO.\u003c\\/p\u003e\\n\\n\u003cp\u003ePerhaps we could one day change things - RMI hasn\'t really worked out in comparison to other methods large scale (supposedly very chatty - though I have been told very large installations have been built with it ) - we have already factored it into contrib. But this still doesn\'t fit the current model\\/API, and if we address it, it will take longer than 2.9 to do right IMO.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745756_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745756_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 01:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T01:03:43+0000\'\u003e21\\/Aug\\/09 01:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 21\\/Aug\\/09 01:12\\\"\u003eedited\u003c\\/span\u003e                   \\n howevever, this method is actually also a bit broken now with per segment searching \\nwhat if reader is a MultiReader  \\n\\n Right - there are many places where this could be the case - your still free to use multi-readers, though we encourage you to switch. We provide a cool cache sanity checker to help you find these cases, and evaluate whether or not you can make the switch.  edit  I know this doesn\'t help with filters - there was an issue that helped address that I think though - worked on by Hoss and Mike McCandless - not sure if that helps here or if this was overlooked or what though - I\'ll have to go skim that issue again.  edit  \\n\\n If you just pass 0, many times it will be wrong. Why shouldn\'t this have access to a doc id cache as well? We always ask for everything in the context of the Reader given. I think thats the issue. Lucene just never officially supported this use case - we can\'t with MultiSearcher, Searchable, Remote - the API doesn\'t work with the idea that you can count on all the doc ids from a Reader. You were taking advantage of the implementation and your limited use of the full API - but its never been part of the API IMHO. \\n\\n Perhaps we could one day change things - RMI hasn\'t really worked out in comparison to other methods large scale (supposedly very chatty - though I have been told very large installations have been built with it ) - we have already factored it into contrib. But this still doesn\'t fit the current model\\/API, and if we address it, it will take longer than 2.9 to do right IMO.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745911\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745911&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745911\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12745911_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745911_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 11:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T11:41:40+0000\'\u003e21\\/Aug\\/09 11:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK... pondering this some more, and on seeing just how much change\u003cbr\\/\u003e\\nwould be required, I\'m now nervous about making deep changes to\u003cbr\\/\u003e\\nLucene\'s scoring\\/filtering APIS (Weight.scorer, Filter.getDocIdSet) to\u003cbr\\/\u003e\\nenable access to top readers and\\/or a sub-readers doc base.\u003c\\/p\u003e\\n\\n\u003cp\u003eAll of Lucene\'s core &amp; contrib now operates \\\"context free\\\"\u003cbr\\/\u003e\\n(per-segment), where each reader need not know its \\\"context\\\" in the\u003cbr\\/\u003e\\nfull searcher tree, and I think we should strongly encourage external\u003cbr\\/\u003e\\nusage of these APIs to switch to context free as well.  Since there\u003cbr\\/\u003e\\nare workarounds possible (accessing sub-readers via IndexSearcher),\u003cbr\\/\u003e\\nexternal apps that have problems making the switch can use these\u003cbr\\/\u003e\\nworkarounds?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12745911_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745911_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 11:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T11:41:40+0000\'\u003e21\\/Aug\\/09 11:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK... pondering this some more, and on seeing just how much change \\nwould be required, I\'m now nervous about making deep changes to \\nLucene\'s scoring\\/filtering APIS (Weight.scorer, Filter.getDocIdSet) to \\nenable access to top readers and\\/or a sub-readers doc base. \\n\\n All of Lucene\'s core &amp; contrib now operates \\\"context free\\\" \\n(per-segment), where each reader need not know its \\\"context\\\" in the \\nfull searcher tree, and I think we should strongly encourage external \\nusage of these APIs to switch to context free as well.  Since there \\nare workarounds possible (accessing sub-readers via IndexSearcher), \\nexternal apps that have problems making the switch can use these \\nworkarounds?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745941\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745941&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745941\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745941_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745941_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 12:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T12:35:38+0000\'\u003e21\\/Aug\\/09 12:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m OK with having to jump through some hoops in order to get back to the \\\"full index\\\" context\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would be nice if this was more facilitated by lucene\'s API (IMO, this would be best handled by adding a Searcher as the first arg to Weight.scorer(), as then a Weight will not need to hold on to this (breaking serializable))\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are definitely plenty of use cases that take advantage of the \\\"whole\\\" index (one created by IndexWriter), so this ability should not be removed\u003cbr\\/\u003e\\nI have at least 3 in my application alone (and they are all very important)\u003c\\/p\u003e\\n\\n\u003cp\u003eYou get tradeoffs working \\\"Per-Segment\\\" vs \\\"Per-MultiReader\\\" when it comes to caching in general\u003cbr\\/\u003e\\ngoing per-segment means caches load faster, and load less frequently, however this causes algorithms working with the caches to be slower (depending on algorithm and cache type)\u003c\\/p\u003e\\n\\n\u003cp\u003efor static boosting from a field value (ValueSource), it makes no difference\u003cbr\\/\u003e\\nfor numeric sorting, it makes no difference \u003c\\/p\u003e\\n\\n\u003cp\u003efor string sorting, it makes a big difference - you now have to do a bunch of String.equals() calls, where you didn\'t have to in 2.4 (just used the ord index)\u003cbr\\/\u003e\\nGiven this reason, you should really be able to do string sorting 2 ways\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eusing per segment field cache (commit time\\/first query faster, sort time slower)\u003c\\/li\u003e\\n\\t\u003cli\u003eusing multi-reader field cache (commit time\\/first query slower, sort time faster)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThis same argument also goes for features like faceting (not provided by lucene, but is provided by applications like solr, and my application). Using a per-segment cache will cause some significant performance loss when performing faceting, as it requires creating the facets for each segment, and then merging them (this results in a good deal of extra object overhead\\/memory overhead\\/more work where faceting on the multi-reader does not see this)\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the end, it should be up to the application developer to choose what strategy works best for them, and their application (fast commits\\/fast cache loading may take a back seat to fast query execution)\u003c\\/p\u003e\\n\\n\u003cp\u003eIn general, i find there is a tradeoff between commit time and query time. The more you speed up commit time, the slower query time gets, and vice versa\u003cbr\\/\u003e\\nI just want\\/need the ability to choose\u003c\\/p\u003e\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745941_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745941_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 12:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T12:35:38+0000\'\u003e21\\/Aug\\/09 12:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m OK with having to jump through some hoops in order to get back to the \\\"full index\\\" context \\n\\n It would be nice if this was more facilitated by lucene\'s API (IMO, this would be best handled by adding a Searcher as the first arg to Weight.scorer(), as then a Weight will not need to hold on to this (breaking serializable)) \\n\\n There are definitely plenty of use cases that take advantage of the \\\"whole\\\" index (one created by IndexWriter), so this ability should not be removed \\nI have at least 3 in my application alone (and they are all very important) \\n\\n You get tradeoffs working \\\"Per-Segment\\\" vs \\\"Per-MultiReader\\\" when it comes to caching in general \\ngoing per-segment means caches load faster, and load less frequently, however this causes algorithms working with the caches to be slower (depending on algorithm and cache type) \\n\\n for static boosting from a field value (ValueSource), it makes no difference \\nfor numeric sorting, it makes no difference  \\n\\n for string sorting, it makes a big difference - you now have to do a bunch of String.equals() calls, where you didn\'t have to in 2.4 (just used the ord index) \\nGiven this reason, you should really be able to do string sorting 2 ways \\n \\n\\t using per segment field cache (commit time\\/first query faster, sort time slower) \\n\\t using multi-reader field cache (commit time\\/first query slower, sort time faster) \\n \\n\\n\\n This same argument also goes for features like faceting (not provided by lucene, but is provided by applications like solr, and my application). Using a per-segment cache will cause some significant performance loss when performing faceting, as it requires creating the facets for each segment, and then merging them (this results in a good deal of extra object overhead\\/memory overhead\\/more work where faceting on the multi-reader does not see this) \\n\\n In the end, it should be up to the application developer to choose what strategy works best for them, and their application (fast commits\\/fast cache loading may take a back seat to fast query execution) \\n\\n In general, i find there is a tradeoff between commit time and query time. The more you speed up commit time, the slower query time gets, and vice versa \\nI just want\\/need the ability to choose \\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745948\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745948&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745948\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745948_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745948_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 12:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T12:48:08+0000\'\u003e21\\/Aug\\/09 12:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI\'m OK with having to jump through some hoops in order to get back to the \\\"full index\\\" context\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYou never officially had the full index context - only because you jettison a large part of the API did you have it.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ethis would be best handled by adding a Searcher as the first arg to Weight.scorer()\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe current API would not support this without back compat breaks up the wazoo - the MultiSearcher can be on the client - its not available on the server. Passing just the local Searcher does not jive with the API.\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003efor string sorting, it makes a big difference - you now have to do a bunch of String.equals() calls, where you didn\'t have to in 2.4 (just used the ord index)\u003cbr\\/\u003e\\nGiven this reason, you should really be able to do string sorting 2 ways\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis is only valid for those short circuiting the API and ignoring MultiSearcher and its affects on the API. As a project, we can\'t and shouldn\'t support this type of thing unless we can make it work with MultiSearcher or eventually pull MultiSearcher.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIn the end, it should be up to the application developer to choose what strategy works best for them, and their application (fast commits\\/fast cache loading may take a back seat to fast query execution)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYou can pick, but we have to be true to the API or change it (not easy with our back compat policies)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745948_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745948_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 12:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T12:48:08+0000\'\u003e21\\/Aug\\/09 12:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I\'m OK with having to jump through some hoops in order to get back to the \\\"full index\\\" context  \\n\\n You never officially had the full index context - only because you jettison a large part of the API did you have it. \\n\\n  this would be best handled by adding a Searcher as the first arg to Weight.scorer()  \\n\\n The current API would not support this without back compat breaks up the wazoo - the MultiSearcher can be on the client - its not available on the server. Passing just the local Searcher does not jive with the API. \\n\\n\\n  for string sorting, it makes a big difference - you now have to do a bunch of String.equals() calls, where you didn\'t have to in 2.4 (just used the ord index) \\nGiven this reason, you should really be able to do string sorting 2 ways  \\n\\n This is only valid for those short circuiting the API and ignoring MultiSearcher and its affects on the API. As a project, we can\'t and shouldn\'t support this type of thing unless we can make it work with MultiSearcher or eventually pull MultiSearcher. \\n\\n  In the end, it should be up to the application developer to choose what strategy works best for them, and their application (fast commits\\/fast cache loading may take a back seat to fast query execution)  \\n\\n You can pick, but we have to be true to the API or change it (not easy with our back compat policies)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745951\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745951&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745951\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745951_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745951_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 12:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T12:55:55+0000\'\u003e21\\/Aug\\/09 12:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe Searcher being passed to explain is also really a break - I almost think we should pull it.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe put it in because a break was already introduced when someone tried to add stats for the whole context in TermWeight - that wasn\'t legal though.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo prevent further spread, I actually think we need to pull that searcher and that extra explain info in TermWeight.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745951_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745951_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 12:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T12:55:55+0000\'\u003e21\\/Aug\\/09 12:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The Searcher being passed to explain is also really a break - I almost think we should pull it. \\n\\n We put it in because a break was already introduced when someone tried to add stats for the whole context in TermWeight - that wasn\'t legal though. \\n\\n To prevent further spread, I actually think we need to pull that searcher and that extra explain info in TermWeight.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745960\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745960&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745960\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745960_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745960_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 13:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T13:15:32+0000\'\u003e21\\/Aug\\/09 13:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eYou never officially had the full index context\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eOfficially, i didn\'t \\\"not\\\" have the full index context either (it was undefined at best, but was clear from both lucene code and my use of the API that i did have the full index context)\u003c\\/p\u003e\\n\\n\u003cp\u003eWhenever i do a search, i always explicitly know what context i\'m searching in (its always an IndexSearcher context)\u003cbr\\/\u003e\\nfurther, whenever i pass an IndexReader to any method (to create a cache\\/etc), i explicitly know what context i\'m dealing with in order to know what the docids used mean\u003cbr\\/\u003e\\nas the application developer, i have full control over what i pass into the lucene API and where, and know the context of passing that in (javadoc should just be fully clear on how what goes in is used (if not already) (i always have the option to not use a utility class\\/method provided by lucene if it does not have the proper context semantics i need (and can write my own that does)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThe current API would not support this without back compat breaks up the wazoo\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ei kinda see what you mean here, but then how is it ok to pass an IndexReader to this method by the same right\u003cbr\\/\u003e\\nit seems like it should be ok to pass the IndexSearcher (the direct context for the IndexReader) for the IndexReader in question to Weight.scorer() if its ok to pass the IndexReader (the scorer() method\'s interface was already changed between 2.4 and 2.9 (adding allowDocsInOrder and topScorer))\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eYou can pick, but we have to be true to the API or change it (not easy with our back compat policies)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ebe fair, 2.9 has a lot of back compat breaks, both in API and runtime behavior (i had tons of compile errors when i dropped 2.9 in, as well as some other hacks i had to add in (at least temporarily) in order to get 2.9 to work due to run time changes (primarily this per segment search stuff))\u003c\\/p\u003e\\n\\n\u003cp\u003eI have no problem with back compat breaks in general (only took me about a day to absorb 2.9 initially (still working on fully taking advantage of new features and getting rid of deprecated class use)) The only requirement i would put on a back compat break is that it have a workaround to get back the the previous versions behavior (in this case have it possible to remap the docids to the \\\"IndexSearcher\\\" context inside the scorer)\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745960_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745960_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 13:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T13:15:32+0000\'\u003e21\\/Aug\\/09 13:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     You never officially had the full index context  \\n Officially, i didn\'t \\\"not\\\" have the full index context either (it was undefined at best, but was clear from both lucene code and my use of the API that i did have the full index context) \\n\\n Whenever i do a search, i always explicitly know what context i\'m searching in (its always an IndexSearcher context) \\nfurther, whenever i pass an IndexReader to any method (to create a cache\\/etc), i explicitly know what context i\'m dealing with in order to know what the docids used mean \\nas the application developer, i have full control over what i pass into the lucene API and where, and know the context of passing that in (javadoc should just be fully clear on how what goes in is used (if not already) (i always have the option to not use a utility class\\/method provided by lucene if it does not have the proper context semantics i need (and can write my own that does) \\n\\n  The current API would not support this without back compat breaks up the wazoo  \\n i kinda see what you mean here, but then how is it ok to pass an IndexReader to this method by the same right \\nit seems like it should be ok to pass the IndexSearcher (the direct context for the IndexReader) for the IndexReader in question to Weight.scorer() if its ok to pass the IndexReader (the scorer() method\'s interface was already changed between 2.4 and 2.9 (adding allowDocsInOrder and topScorer)) \\n\\n  You can pick, but we have to be true to the API or change it (not easy with our back compat policies)  \\n be fair, 2.9 has a lot of back compat breaks, both in API and runtime behavior (i had tons of compile errors when i dropped 2.9 in, as well as some other hacks i had to add in (at least temporarily) in order to get 2.9 to work due to run time changes (primarily this per segment search stuff)) \\n\\n I have no problem with back compat breaks in general (only took me about a day to absorb 2.9 initially (still working on fully taking advantage of new features and getting rid of deprecated class use)) The only requirement i would put on a back compat break is that it have a workaround to get back the the previous versions behavior (in this case have it possible to remap the docids to the \\\"IndexSearcher\\\" context inside the scorer) \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745963\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745963&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745963\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745963_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745963_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 13:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T13:26:39+0000\'\u003e21\\/Aug\\/09 13:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 21\\/Aug\\/09 13:27\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003e(it was undefined at best, but was clear from both lucene code and my use of the API that i did have the full index context)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt was an implementation detail. If you look at MultiSearcher, Searchable, Searcher and how the API is put together, you can see we don\'t support that type of thing. I think its fairly clear after a little thought.\u003c\\/p\u003e\\n\\n\u003cp\u003eYou can limit your API\'s to handle just IndexSearchers, but as a project, we cannot.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eit seems like it should be ok to pass the IndexSearcher (the direct context for the IndexReader) \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMultiSearcher and Searchable make this impossible IMO. We would be playing to those that don\'t fully use the API, and thats a mistake in my opinion. At best, we would have to shift the whole API.\u003c\\/p\u003e\\n\\n\u003cp\u003eIts okay to pass the Reader because its a contextless Reader. There is no value in also passing a contextless Searcher IMO - especially when its an arbitrary different context. We have to live up to the current API - your throwing MultiSearcher, Searchable, Remote out the window.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ebe fair, 2.9 has a lot of back compat breaks,\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOh I\'m fair, I know that for sure - though I do like to argue way to much for my own good. All of these back compat breaks were painful to stomach \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e But we reached each one under special circumstances - usually our own early incompetence \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e We technically are not allowed to just break things though. We break to fix what we already accidentally broke, or we break when we screwed up earlier and we are in between a rock and a hard place now - or we break when something else is broke anyway, so lets do more \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e This was the release of the break for sure. We don\'t necessarily want this to happen every release though, and its our responsibility to strive towards our back compat policy (listed on the wiki).\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not talking about a break in adding a Searcher - that would be fine - back compat is already broken there - but unless we can pass a MultiSearcher there over a remove RMI call, its a break of the whole API IMO.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745963_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745963_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 13:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T13:26:39+0000\'\u003e21\\/Aug\\/09 13:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 21\\/Aug\\/09 13:27\\\"\u003eedited\u003c\\/span\u003e                    (it was undefined at best, but was clear from both lucene code and my use of the API that i did have the full index context)  \\n\\n It was an implementation detail. If you look at MultiSearcher, Searchable, Searcher and how the API is put together, you can see we don\'t support that type of thing. I think its fairly clear after a little thought. \\n\\n You can limit your API\'s to handle just IndexSearchers, but as a project, we cannot. \\n\\n  it seems like it should be ok to pass the IndexSearcher (the direct context for the IndexReader)   \\n\\n MultiSearcher and Searchable make this impossible IMO. We would be playing to those that don\'t fully use the API, and thats a mistake in my opinion. At best, we would have to shift the whole API. \\n\\n Its okay to pass the Reader because its a contextless Reader. There is no value in also passing a contextless Searcher IMO - especially when its an arbitrary different context. We have to live up to the current API - your throwing MultiSearcher, Searchable, Remote out the window. \\n\\n  be fair, 2.9 has a lot of back compat breaks,  \\n\\n Oh I\'m fair, I know that for sure - though I do like to argue way to much for my own good. All of these back compat breaks were painful to stomach   But we reached each one under special circumstances - usually our own early incompetence   We technically are not allowed to just break things though. We break to fix what we already accidentally broke, or we break when we screwed up earlier and we are in between a rock and a hard place now - or we break when something else is broke anyway, so lets do more   This was the release of the break for sure. We don\'t necessarily want this to happen every release though, and its our responsibility to strive towards our back compat policy (listed on the wiki). \\n\\n I\'m not talking about a break in adding a Searcher - that would be fine - back compat is already broken there - but unless we can pass a MultiSearcher there over a remove RMI call, its a break of the whole API IMO.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745977\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745977&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745977\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745977_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745977_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 13:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T13:58:19+0000\'\u003e21\\/Aug\\/09 13:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eIt was an implementation detail. If you look at MultiSearcher, Searchable, Searcher and how the API is put together, you can see we don\'t support that type of thing. I think its fairly clear after a little thought.\u003c\\/p\u003e\\n\\n\u003cp\u003eYou can limit your API\'s to handle just IndexSearchers, but as a project, we cannot.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI totally understand your resistance here.  I get that i\'m really utilizing advanced lucene concepts at very low levels (and these are subject to some changes that i will have to absorb with new versions)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIts okay to pass the Reader because its a contextless Reader. There is no value in also passing a contextless Searcher\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ewell, when you pass the Searcher that contains Reader, the Reader is no longer contextless.\u003cbr\\/\u003e\\nalso, the context of the Searcher can be fairly well defined (its a \\\"leaf\\\" Searcher. the one that actually called Weight.scorer())\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, looking a bit more at MultiSearcher semantics, sorting requires this \\\"leaf\\\" Searcher context in order to work already\u003cbr\\/\u003e\\nMultiSearcher just takes the top docs from each underlaying Searchable, adjusts the docids to the MultiSearcher Context, and sends them through another priority queue\u003cbr\\/\u003e\\nSo, this \\\"leaf\\\" Searcher context concept is required by sorting already. \u003cbr\\/\u003e\\nI just want my Scorer to be given this \\\"leaf\\\" context as well\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, since it is a \\\"leaf\\\" context, the Weight.scorer() method could have the following interface:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\/**\\n * @param searcher The IndexSearcher that contains reader.\\n *\\/\\n\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e Scorer scorer(IndexSearcher searcher, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e allowDocsInOrder, \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e topScorer);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003ethen, with the patch i posted, i could call:\u003cbr\\/\u003e\\nsearcher.getIndexReaderBase(reader) \u003cbr\\/\u003e\\nand i\'m all set\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745977_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745977_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 13:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T13:58:19+0000\'\u003e21\\/Aug\\/09 13:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n It was an implementation detail. If you look at MultiSearcher, Searchable, Searcher and how the API is put together, you can see we don\'t support that type of thing. I think its fairly clear after a little thought. \\n\\n You can limit your API\'s to handle just IndexSearchers, but as a project, we cannot.  \\n I totally understand your resistance here.  I get that i\'m really utilizing advanced lucene concepts at very low levels (and these are subject to some changes that i will have to absorb with new versions) \\n\\n  Its okay to pass the Reader because its a contextless Reader. There is no value in also passing a contextless Searcher  \\n well, when you pass the Searcher that contains Reader, the Reader is no longer contextless. \\nalso, the context of the Searcher can be fairly well defined (its a \\\"leaf\\\" Searcher. the one that actually called Weight.scorer()) \\n\\n Also, looking a bit more at MultiSearcher semantics, sorting requires this \\\"leaf\\\" Searcher context in order to work already \\nMultiSearcher just takes the top docs from each underlaying Searchable, adjusts the docids to the MultiSearcher Context, and sends them through another priority queue \\nSo, this \\\"leaf\\\" Searcher context concept is required by sorting already.  \\nI just want my Scorer to be given this \\\"leaf\\\" context as well \\n\\n Also, since it is a \\\"leaf\\\" context, the Weight.scorer() method could have the following interface: \\n  \\n \\/**\\n * @param searcher The IndexSearcher that contains reader.\\n *\\/\\n public  Scorer scorer(IndexSearcher searcher, IndexReader reader,  boolean  allowDocsInOrder,  boolean  topScorer);\\n \\n  \\n\\n then, with the patch i posted, i could call: \\nsearcher.getIndexReaderBase(reader)  \\nand i\'m all set \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745979\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745979&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745979\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745979_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745979_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:00:04+0000\'\u003e21\\/Aug\\/09 14:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNOTE: if the leaf IndexSearcher were to be passed to scorer(), it would also have to be passed to explain()\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745979_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745979_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:00:04+0000\'\u003e21\\/Aug\\/09 14:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    NOTE: if the leaf IndexSearcher were to be passed to scorer(), it would also have to be passed to explain()              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745985\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745985&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745985\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745985_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745985_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:09:49+0000\'\u003e21\\/Aug\\/09 14:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 21\\/Aug\\/09 14:14\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI certainly think IndexSearcher makes a lot more sense than Searchable or Searcher there - it somewhat handles the whole API break thing - your clearly limiting to an IndexSearcher, so its compatible with the current API and can be clearly explained with javadoc - I still worry about pushing the API towards things that leave MultiSearcher\\/Remote out in the cold on features. They are technically first class citizens. I think some expert warnings could sell me anyway though.\u003c\\/p\u003e\\n\\n\u003cp\u003eI still have a problem with this though:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e DocIdSet getDocIdSet(\u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e IndexReader reader) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n    \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Weight weight = query.weight(\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e IndexSearcher(reader));\\n    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e DocIdSet() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e DocIdSetIterator iterator() \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e weight.scorer(reader, docBase?, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e, \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e);\\n      }\\n    };\\n  }\\n\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThat scorer call should get the right IndexSearcher and I don\'t see how it can without breaking back compat on this method and passing an IndexSearcher too.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eedit *\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAnd even if we fix this here, what about outside code doing the same thing? They won\'t get the right IndexSearcher.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745985_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745985_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:09:49+0000\'\u003e21\\/Aug\\/09 14:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 21\\/Aug\\/09 14:14\\\"\u003eedited\u003c\\/span\u003e                   I certainly think IndexSearcher makes a lot more sense than Searchable or Searcher there - it somewhat handles the whole API break thing - your clearly limiting to an IndexSearcher, so its compatible with the current API and can be clearly explained with javadoc - I still worry about pushing the API towards things that leave MultiSearcher\\/Remote out in the cold on features. They are technically first class citizens. I think some expert warnings could sell me anyway though. \\n\\n I still have a problem with this though: \\n\\n  \\n  public  DocIdSet getDocIdSet( final  IndexReader reader)  throws  IOException {\\n     final  Weight weight = query.weight( new  IndexSearcher(reader));\\n     return   new  DocIdSet() {\\n       public  DocIdSetIterator iterator()  throws  IOException {\\n         return  weight.scorer(reader, docBase?,  true ,  false );\\n      }\\n    };\\n  }\\n\\n \\n  \\n\\n That scorer call should get the right IndexSearcher and I don\'t see how it can without breaking back compat on this method and passing an IndexSearcher too. \\n\\n \\n\\t edit * \\n \\n\\n\\n And even if we fix this here, what about outside code doing the same thing? They won\'t get the right IndexSearcher.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745986\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745986&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745986\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745986_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745986_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:13:00+0000\'\u003e21\\/Aug\\/09 14:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eclearly explained with javadoc\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe need something along the lines of - you cannot count on this IndexSearcher to cover the whole index unless you control the use of your application to ensure that - its possible that this IndexSearcher will only correspond to one sub-index of multiple being used in the context of one large index.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745986_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745986_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:13:00+0000\'\u003e21\\/Aug\\/09 14:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     clearly explained with javadoc  \\n\\n We need something along the lines of - you cannot count on this IndexSearcher to cover the whole index unless you control the use of your application to ensure that - its possible that this IndexSearcher will only correspond to one sub-index of multiple being used in the context of one large index.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745988\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745988&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745988\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745988_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745988_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:15:22+0000\'\u003e21\\/Aug\\/09 14:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehere\'s what you can do:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-comment\\\"\u003e\\/** @deprecated use {@link getDocIdSet(IndexSearcher, IndexReader)} *\\/\u003c\\/span\u003e\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e DocIdSet getDocIdSet(\u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e IndexReader reader) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e getDocIdSet(\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e IndexSearcher(reader), reader);\\n  }\\n\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e DocIdSet getDocIdSet(\u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e IndexSearcher searcher, \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e IndexReader reader) {\\n    \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Weight weight = query.weight(searcher);\\n    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e DocIdSet() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e DocIdSetIterator iterator() \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e weight.scorer(searcher, reader, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e, \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e);\\n      }\\n    };\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eand yeah, i\'m all for tons warnings in javadoc explicitly defining the contracts\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745988_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745988_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:15:22+0000\'\u003e21\\/Aug\\/09 14:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    here\'s what you can do: \\n\\n  \\n    \\/** @deprecated use {@link getDocIdSet(IndexSearcher, IndexReader)} *\\/ \\n   public  DocIdSet getDocIdSet( final  IndexReader reader)  throws  IOException {\\n     return  getDocIdSet( new  IndexSearcher(reader), reader);\\n  }\\n\\n   public  DocIdSet getDocIdSet( final  IndexSearcher searcher,  final  IndexReader reader) {\\n     final  Weight weight = query.weight(searcher);\\n     return   new  DocIdSet() {\\n       public  DocIdSetIterator iterator()  throws  IOException {\\n         return  weight.scorer(searcher, reader,  true ,  false );\\n      }\\n    };\\n  }\\n \\n  \\n\\n and yeah, i\'m all for tons warnings in javadoc explicitly defining the contracts              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745989\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745989&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745989\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745989_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745989_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:20:03+0000\'\u003e21\\/Aug\\/09 14:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t think thats fully back compat - though it covers a lot of ground.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745989_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745989_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:20:03+0000\'\u003e21\\/Aug\\/09 14:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t think thats fully back compat - though it covers a lot of ground.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745991\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745991&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745991\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745991_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745991_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:28:44+0000\'\u003e21\\/Aug\\/09 14:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ewhat class is this getDocIdSet method on (lacking the context of where its used)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12745991_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745991_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:28:44+0000\'\u003e21\\/Aug\\/09 14:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    what class is this getDocIdSet method on (lacking the context of where its used)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12745997\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12745997&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12745997\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745997_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745997_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:46:22+0000\'\u003e21\\/Aug\\/09 14:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIts org.apache.lucene.search.QueryWrapperFilter. And technically we have to account for subclasses and combinations and anything possible.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis being the release of the break, who knows though. I can\'t reasonably see releasing without notes indicating that you \u003cb\u003emust\u003c\\/b\u003e recompile. And while we want to limit how much work must be done (we also consider the likely impact), this would be the time to skirt through.\u003c\\/p\u003e\\n\\n\u003cp\u003ePretty much depends on what McCandless weighs in with I guess - unless a new spectator pops up.\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003egetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.QueryWrapperFilter\\n\\tbits(IndexReader) : BitSet - org.apache.lucene.search.BooleanFilterTest.getOldBitSetFilter(...).\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Filter() {...}\\n\\tConstantScorer(Similarity, IndexReader, Weight) - org.apache.lucene.search.ConstantScoreQuery.ConstantScorer\\n\\texplain(Searcher, IndexReader, \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e) : Explanation - org.apache.lucene.search.FilteredQuery.createWeight(...).\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Weight() {...}\\n\\tgetDISI(ArrayList, \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e, IndexReader) : DocIdSetIterator - org.apache.lucene.search.BooleanFilter\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.BooleanFilter (3 matches)\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.CachingWrapperFilter\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.CachingWrapperFilterHelper\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.RemoteCachingWrapperFilter\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.RemoteCachingWrapperFilterHelper\\n\\tscorer(IndexReader, \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e, \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e) : Scorer - org.apache.lucene.search.FilteredQuery.createWeight(...).\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Weight() {...}\\n\\tsearchWithFilter(IndexReader, Weight, Filter, Collector) : void - org.apache.lucene.search.IndexSearcher\\n\\ttstFilterCard(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e, \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e, Filter) : void - org.apache.lucene.search.BooleanFilterTest\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12745997_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12745997_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 14:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T14:46:22+0000\'\u003e21\\/Aug\\/09 14:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Its org.apache.lucene.search.QueryWrapperFilter. And technically we have to account for subclasses and combinations and anything possible. \\n\\n This being the release of the break, who knows though. I can\'t reasonably see releasing without notes indicating that you  must  recompile. And while we want to limit how much work must be done (we also consider the likely impact), this would be the time to skirt through. \\n\\n Pretty much depends on what McCandless weighs in with I guess - unless a new spectator pops up. \\n  \\n getDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.QueryWrapperFilter\\n\\tbits(IndexReader) : BitSet - org.apache.lucene.search.BooleanFilterTest.getOldBitSetFilter(...). new  Filter() {...}\\n\\tConstantScorer(Similarity, IndexReader, Weight) - org.apache.lucene.search.ConstantScoreQuery.ConstantScorer\\n\\texplain(Searcher, IndexReader,  int ) : Explanation - org.apache.lucene.search.FilteredQuery.createWeight(...). new  Weight() {...}\\n\\tgetDISI(ArrayList,  int , IndexReader) : DocIdSetIterator - org.apache.lucene.search.BooleanFilter\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.BooleanFilter (3 matches)\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.CachingWrapperFilter\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.CachingWrapperFilterHelper\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.RemoteCachingWrapperFilter\\n\\tgetDocIdSet(IndexReader) : DocIdSet - org.apache.lucene.search.RemoteCachingWrapperFilterHelper\\n\\tscorer(IndexReader,  boolean ,  boolean ) : Scorer - org.apache.lucene.search.FilteredQuery.createWeight(...). new  Weight() {...}\\n\\tsearchWithFilter(IndexReader, Weight, Filter, Collector) : void - org.apache.lucene.search.IndexSearcher\\n\\ttstFilterCard( String ,  int , Filter) : void - org.apache.lucene.search.BooleanFilterTest\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746004\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746004&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746004\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746004_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746004_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T15:02:25+0000\'\u003e21\\/Aug\\/09 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooks like Filter should have another method added getDocIdSet(IndexSearcher searcher, IndexReader reader) (deprecating getDocIdSet(IndexReader))\u003c\\/p\u003e\\n\\n\u003cp\u003enew method would call old method by default (with little harm done in general)\u003cbr\\/\u003e\\nIndexSearcher would call the new getDocIdSet() variant\u003cbr\\/\u003e\\nQueryWrapperFilter would be updated to implement getDocIdSet(IndexSearcher, IndexReader) (with old method wrapping IndexReader with an IndexSearcher)\u003cbr\\/\u003e\\nThis would actually be cleaner for QueryWrapperFilter, as it wouldn\'t have to create a new IndexSearcher on every call\u003c\\/p\u003e\\n\\n\u003cp\u003ei definitely see that this is potentially more painful than the changes to the scorer() method (question is how many people implement custom Filters?)\u003c\\/p\u003e\\n\\n\u003cp\u003ePersonally, i don\'t use Filter, so any changes here don\'t impact me, but to the best of my knowledge, i\'m not the only one using lucene \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746004_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746004_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T15:02:25+0000\'\u003e21\\/Aug\\/09 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looks like Filter should have another method added getDocIdSet(IndexSearcher searcher, IndexReader reader) (deprecating getDocIdSet(IndexReader)) \\n\\n new method would call old method by default (with little harm done in general) \\nIndexSearcher would call the new getDocIdSet() variant \\nQueryWrapperFilter would be updated to implement getDocIdSet(IndexSearcher, IndexReader) (with old method wrapping IndexReader with an IndexSearcher) \\nThis would actually be cleaner for QueryWrapperFilter, as it wouldn\'t have to create a new IndexSearcher on every call \\n\\n i definitely see that this is potentially more painful than the changes to the scorer() method (question is how many people implement custom Filters?) \\n\\n Personally, i don\'t use Filter, so any changes here don\'t impact me, but to the best of my knowledge, i\'m not the only one using lucene                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746263\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746263&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746263\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746263_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746263_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 21:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T21:59:13+0000\'\u003e21\\/Aug\\/09 21:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI started integrating the per-segment searching (removed my hack that was doing searching on MultiReader)\u003c\\/p\u003e\\n\\n\u003cp\u003eIn order to get my query implementations to work, i had to hold onto my Searcher in the Weight constructor and add getIndexReaderBase() method to my IndexSearcher implementation, and this seems to be working well\u003c\\/p\u003e\\n\\n\u003cp\u003eI had 3 query implementations that were affected:\u003cbr\\/\u003e\\none used a cache that will be easy to create per segment (will have this use a per segment cache as soon as i can)\u003cbr\\/\u003e\\none used an int[] ord index (the underlaying cache cannot be made per segment)\u003cbr\\/\u003e\\none used a cached DocIdSet created over the top level MultiReader (should be able to have a DocIdSet per Segment reader here, but this will take some more thinking (source of the matching docids is from a separate index), will also need to know which sub docidset to use based on which IndexReader is passed to scorer() - shouldn\'t be any big deal)\u003c\\/p\u003e\\n\\n\u003cp\u003ei\'m a bit concerned that i may not be testing \\\"multi-segment\\\" searching quite properly right now though since i think most of my indexes being tested only have one segment.\u003cbr\\/\u003e\\nOn that topic, if i create a subclass of LogByteSizeMergePolicy and return null from findMerges() and findMergesToExpungeDeletes() will this guarantee that segments will only be merged if i explicitly optimize? In which case, i can just pepper in some commits as i add documents to guarantee that i have more than 1 segment.\u003c\\/p\u003e\\n\\n\u003cp\u003eOverall, i am really liking the per-segment stuff, and the Collector API in general \u003cbr\\/\u003e\\nits already made it possible to optimize a good deal of things away (like calling Scorer.score() for docs that end up getting filtered away), however i hit some deoptimization due to some of the crazy stuff i had to do to make those 3 query implementations work, but this should only really be isolated to one of the implementations (and i can hopefully reoptimize those cases anyway)\u003c\\/p\u003e\\n\\n\u003cp\u003eI would still like to see IndexSearcher passed to Weight.scorer(), and the getIndexReaderBase() method added to IndexSearcher\u003cbr\\/\u003e\\nThis will clean up my current \\\"hacks\\\" to map docids \u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746263_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746263_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 21:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T21:59:13+0000\'\u003e21\\/Aug\\/09 21:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I started integrating the per-segment searching (removed my hack that was doing searching on MultiReader) \\n\\n In order to get my query implementations to work, i had to hold onto my Searcher in the Weight constructor and add getIndexReaderBase() method to my IndexSearcher implementation, and this seems to be working well \\n\\n I had 3 query implementations that were affected: \\none used a cache that will be easy to create per segment (will have this use a per segment cache as soon as i can) \\none used an int[] ord index (the underlaying cache cannot be made per segment) \\none used a cached DocIdSet created over the top level MultiReader (should be able to have a DocIdSet per Segment reader here, but this will take some more thinking (source of the matching docids is from a separate index), will also need to know which sub docidset to use based on which IndexReader is passed to scorer() - shouldn\'t be any big deal) \\n\\n i\'m a bit concerned that i may not be testing \\\"multi-segment\\\" searching quite properly right now though since i think most of my indexes being tested only have one segment. \\nOn that topic, if i create a subclass of LogByteSizeMergePolicy and return null from findMerges() and findMergesToExpungeDeletes() will this guarantee that segments will only be merged if i explicitly optimize? In which case, i can just pepper in some commits as i add documents to guarantee that i have more than 1 segment. \\n\\n Overall, i am really liking the per-segment stuff, and the Collector API in general  \\nits already made it possible to optimize a good deal of things away (like calling Scorer.score() for docs that end up getting filtered away), however i hit some deoptimization due to some of the crazy stuff i had to do to make those 3 query implementations work, but this should only really be isolated to one of the implementations (and i can hopefully reoptimize those cases anyway) \\n\\n I would still like to see IndexSearcher passed to Weight.scorer(), and the getIndexReaderBase() method added to IndexSearcher \\nThis will clean up my current \\\"hacks\\\" to map docids  \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746278\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746278&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746278\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12746278_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746278_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T22:07:26+0000\'\u003e21\\/Aug\\/09 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ei\'m a bit concerned that i may not be testing \\\"multi-segment\\\" searching quite properly right now though since i think most of my indexes being tested only have one segment.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYup - went through this in Solr.  I ended up changing the test config to use LogByteSizeMergePolicy  and maxBufferedDocs=10.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12746278_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746278_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T22:07:26+0000\'\u003e21\\/Aug\\/09 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     i\'m a bit concerned that i may not be testing \\\"multi-segment\\\" searching quite properly right now though since i think most of my indexes being tested only have one segment.  \\n\\n Yup - went through this in Solr.  I ended up changing the test config to use LogByteSizeMergePolicy  and maxBufferedDocs=10.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746291\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746291&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746291\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746291_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746291_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 22:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T22:18:33+0000\'\u003e21\\/Aug\\/09 22:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 21\\/Aug\\/09 22:21\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLucene also use maxBufferedDocs to make sure there are multiple segments in some tests -\u003c\\/p\u003e\\n\\n\u003cp\u003eTim\'s idea here is nice too though - you still see some merging that way - with a mergepolicy that just returns null you can easily pick the exact number of segments by issuing commits mod whatever. (*edit you just have to set maxBufferedDocs to Integer.max)\u003c\\/p\u003e\\n\\n\u003cp\u003eThe mergepolicy impl is easy enough - anon class generated by eclipse will work out of the box.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746291_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746291_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/09 22:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-21T22:18:33+0000\'\u003e21\\/Aug\\/09 22:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 21\\/Aug\\/09 22:21\\\"\u003eedited\u003c\\/span\u003e                   Lucene also use maxBufferedDocs to make sure there are multiple segments in some tests - \\n\\n Tim\'s idea here is nice too though - you still see some merging that way - with a mergepolicy that just returns null you can easily pick the exact number of segments by issuing commits mod whatever. (*edit you just have to set maxBufferedDocs to Integer.max) \\n\\n The mergepolicy impl is easy enough - anon class generated by eclipse will work out of the box.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746513\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746513&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746513\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746513_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746513_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/09 21:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-22T21:42:06+0000\'\u003e22\\/Aug\\/09 21:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 22\\/Aug\\/09 21:46\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eLooks like Filter should have another method added getDocIdSet(IndexSearcher searcher, IndexReader reader) (deprecating getDocIdSet(IndexReader))\u003cbr\\/\u003e\\nnew method would call old method by default (with little harm done in general) \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIts the corner cases. Someone\'s class calls the deprecated method directly - someone is using that, plus a new class that overrides the none deprecated method - which never gets called, cause the other code is calling the dep method directly. Technically, everything has to be covered (Depending on how consensus goes anyway ... always depending ...). Its a pain in the butt just thinking about it. \u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cb\u003eedit\u003c\\/b\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eIn your example deprecation this is actually the opposite - someone calls the new code directly, but other code you are using overrides the deprecated code. The override is now not called.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746513_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746513_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/09 21:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-22T21:42:06+0000\'\u003e22\\/Aug\\/09 21:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 22\\/Aug\\/09 21:46\\\"\u003eedited\u003c\\/span\u003e                    Looks like Filter should have another method added getDocIdSet(IndexSearcher searcher, IndexReader reader) (deprecating getDocIdSet(IndexReader)) \\nnew method would call old method by default (with little harm done in general)   \\n\\n Its the corner cases. Someone\'s class calls the deprecated method directly - someone is using that, plus a new class that overrides the none deprecated method - which never gets called, cause the other code is calling the dep method directly. Technically, everything has to be covered (Depending on how consensus goes anyway ... always depending ...). Its a pain in the butt just thinking about it.  \\n\\n  edit  \\n\\n In your example deprecation this is actually the opposite - someone calls the new code directly, but other code you are using overrides the deprecated code. The override is now not called.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746600\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746600&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746600\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746600_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746600_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 13:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T13:17:35+0000\'\u003e23\\/Aug\\/09 13:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ewell, you could go the route similar to the 2.4 TokenStream api (next() vs next(Token))\u003c\\/p\u003e\\n\\n\u003cp\u003ehave Filter.getDocIdSet(IndexSearcher, IndexReader) call Filter.getDocIdSet(IndexReader), and vice versa by default\u003cbr\\/\u003e\\none method or the other would be required to be overridden\u003c\\/p\u003e\\n\\n\u003cp\u003egetDocIdSet(IndexReader) would be deprecated (and removed in 3.0)\u003c\\/p\u003e\\n\\n\u003cp\u003eSince the deprecated method would be removed in 3.0, and since noone would probably be depending on these new semantics right away this should work\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, in general, QueryWrapperFilter performs a bit worse now in 2.9\u003cbr\\/\u003e\\nthis is because it creates an IndexSearcher for every query it wraps (which results in doing \\\"gatherSubReaders\\\" and creating the offsets anew each time getDocIdSet(IndexReader) is called\u003cbr\\/\u003e\\nso, the new method with the IndexSearcher also passed in is much better for evaluating these Filters\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746600_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746600_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 13:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T13:17:35+0000\'\u003e23\\/Aug\\/09 13:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    well, you could go the route similar to the 2.4 TokenStream api (next() vs next(Token)) \\n\\n have Filter.getDocIdSet(IndexSearcher, IndexReader) call Filter.getDocIdSet(IndexReader), and vice versa by default \\none method or the other would be required to be overridden \\n\\n getDocIdSet(IndexReader) would be deprecated (and removed in 3.0) \\n\\n Since the deprecated method would be removed in 3.0, and since noone would probably be depending on these new semantics right away this should work \\n\\n Also, in general, QueryWrapperFilter performs a bit worse now in 2.9 \\nthis is because it creates an IndexSearcher for every query it wraps (which results in doing \\\"gatherSubReaders\\\" and creating the offsets anew each time getDocIdSet(IndexReader) is called \\nso, the new method with the IndexSearcher also passed in is much better for evaluating these Filters              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746607\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746607&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746607\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746607_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746607_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 14:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T14:31:04+0000\'\u003e23\\/Aug\\/09 14:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYou want to weigh in again Mike ? You still have the same stance as your last comment?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746607_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746607_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 14:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T14:31:04+0000\'\u003e23\\/Aug\\/09 14:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    You want to weigh in again Mike ? You still have the same stance as your last comment?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746608\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746608&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746608\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746608_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746608_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 14:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T14:34:30+0000\'\u003e23\\/Aug\\/09 14:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ewell, you could go the route similar to the 2.4 TokenStream api (next() vs next(Token))\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ethats a tough bunch of code to decide to spread ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746608_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746608_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 14:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T14:34:30+0000\'\u003e23\\/Aug\\/09 14:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     well, you could go the route similar to the 2.4 TokenStream api (next() vs next(Token))  \\n\\n thats a tough bunch of code to decide to spread ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746613\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746613&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746613\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746613_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746613_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T15:00:30+0000\'\u003e23\\/Aug\\/09 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ethats a tough bunch of code to decide to spread ...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eat least it\'ll be able to go away real soon with 3.0\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746613_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746613_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T15:00:30+0000\'\u003e23\\/Aug\\/09 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     thats a tough bunch of code to decide to spread ...  \\n at least it\'ll be able to go away real soon with 3.0              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746617\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746617&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746617\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746617_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746617_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T15:19:00+0000\'\u003e23\\/Aug\\/09 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eYou want to weigh in again Mike ? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI do!  I\'m trying desperately to catch up over here \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746617_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746617_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T15:19:00+0000\'\u003e23\\/Aug\\/09 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     You want to weigh in again Mike ?   \\n\\n I do!  I\'m trying desperately to catch up over here                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746623\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746623&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746623\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746623_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746623_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 15:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T15:55:21+0000\'\u003e23\\/Aug\\/09 15:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTim, one option might be to subclass DirectoryReader (though, it\'s package protected now, and, you\'d need to make your own \\\"open\\\" to return your subclass), and override getSequentialSubReaders to return null?  Then Lucene would treat it as an atomic reader.  Could that work?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746623_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746623_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 15:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T15:55:21+0000\'\u003e23\\/Aug\\/09 15:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Tim, one option might be to subclass DirectoryReader (though, it\'s package protected now, and, you\'d need to make your own \\\"open\\\" to return your subclass), and override getSequentialSubReaders to return null?  Then Lucene would treat it as an atomic reader.  Could that work?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746625\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746625&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746625\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746625_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746625_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:02:44+0000\'\u003e23\\/Aug\\/09 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003efor string sorting, it makes a big difference - you now have to do a bunch of String.equals() calls, where you didn\'t have to in 2.4 (just used the ord index)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe actually went through a number of iterations on this, on the first cutover to per-segment collection, and eventually arrived at a decent comparator (StringOrdValComparator) that operates per segment.  Have you tested performance of this comparator?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746625_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746625_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:02:44+0000\'\u003e23\\/Aug\\/09 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     for string sorting, it makes a big difference - you now have to do a bunch of String.equals() calls, where you didn\'t have to in 2.4 (just used the ord index)  \\n\\n We actually went through a number of iterations on this, on the first cutover to per-segment collection, and eventually arrived at a decent comparator (StringOrdValComparator) that operates per segment.  Have you tested performance of this comparator?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746630\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746630&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746630\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12746630_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746630_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:27:47+0000\'\u003e23\\/Aug\\/09 16:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eFilter.getDocIdSet(IndexSearcher, IndexReader).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis suggests that one needs an IndexSearcher to get the ids matching a filter.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12746630_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746630_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:27:47+0000\'\u003e23\\/Aug\\/09 16:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Filter.getDocIdSet(IndexSearcher, IndexReader).  \\n\\n This suggests that one needs an IndexSearcher to get the ids matching a filter.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746633\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746633&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746633\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746633_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746633_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:48:08+0000\'\u003e23\\/Aug\\/09 16:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eone used an int[] ord index (the underlaying cache cannot be made per segment)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCould you compute the top-level ords, but then break it up\u003cbr\\/\u003e\\nper-segment?  Ie, create your own map of IndexReader -&gt; offset into\u003cbr\\/\u003e\\nthat large ord array?  This would make it \\\"virtually\\\" per-segment, but\u003cbr\\/\u003e\\nallow you to continue computing at the top level.\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW another option is to simply accumulate your own docBase, by adding\u003cbr\\/\u003e\\nup the maxDoc() every time an IndexReader is passed to your\u003cbr\\/\u003e\\nWeight.scorer().  EG this is what contrib\\/spatial is now doing.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis isn\'t a long-term solution, since the order in which Lucene\u003cbr\\/\u003e\\nvisits the readers isn\'t in general guaranteed, but it will work for\u003cbr\\/\u003e\\n2.9 and buy time to figure out how to switch scoring to per-segment.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746633_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746633_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:48:08+0000\'\u003e23\\/Aug\\/09 16:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     one used an int[] ord index (the underlaying cache cannot be made per segment)  \\n\\n Could you compute the top-level ords, but then break it up \\nper-segment?  Ie, create your own map of IndexReader -&gt; offset into \\nthat large ord array?  This would make it \\\"virtually\\\" per-segment, but \\nallow you to continue computing at the top level. \\n\\n BTW another option is to simply accumulate your own docBase, by adding \\nup the maxDoc() every time an IndexReader is passed to your \\nWeight.scorer().  EG this is what contrib\\/spatial is now doing. \\n\\n This isn\'t a long-term solution, since the order in which Lucene \\nvisits the readers isn\'t in general guaranteed, but it will work for \\n2.9 and buy time to figure out how to switch scoring to per-segment.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746634\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746634&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746634\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746634_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746634_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:52:14+0000\'\u003e23\\/Aug\\/09 16:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eUsing a per-segment cache will cause some significant performance loss when performing faceting, as it requires creating the facets for each segment, and then merging them (this results in a good deal of extra object overhead\\/memory overhead\\/more work where faceting on the multi-reader does not see this)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis is a good point... Yonik, how \u003cspan class=\\\"error\\\"\u003e&#91;in general!&#93;\u003c\\/span\u003e is Solr handling the cutover to per-segment, for faceting?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746634_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746634_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:52:14+0000\'\u003e23\\/Aug\\/09 16:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Using a per-segment cache will cause some significant performance loss when performing faceting, as it requires creating the facets for each segment, and then merging them (this results in a good deal of extra object overhead\\/memory overhead\\/more work where faceting on the multi-reader does not see this)  \\n\\n This is a good point... Yonik, how  &#91;in general!&#93;  is Solr handling the cutover to per-segment, for faceting?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746635\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746635&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746635\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746635_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746635_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:57:18+0000\'\u003e23\\/Aug\\/09 16:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eone used a cached DocIdSet created over the top level MultiReader (should be able to have a DocIdSet per Segment reader here, but this will take some more thinking (source of the matching docids is from a separate index), will also need to know which sub docidset to use based on which IndexReader is passed to scorer() - shouldn\'t be any big deal)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think, similarly, you could continue to create the top-level\u003cbr\\/\u003e\\nDocIdSet, but then make a new DocIdSet that presents one segment\'s\u003cbr\\/\u003e\\n\\\"slice\\\" out of this top-level DocIdSet.  Then, pre-build the mapping\u003cbr\\/\u003e\\nof IndexReader -&gt; docBase like above, then when scorer() is called in\u003cbr\\/\u003e\\nyour custom query, just return the \\\"virtual\\\" per-segment DocIdSet.\u003cbr\\/\u003e\\nWould this work?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746635_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746635_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:57:18+0000\'\u003e23\\/Aug\\/09 16:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     one used a cached DocIdSet created over the top level MultiReader (should be able to have a DocIdSet per Segment reader here, but this will take some more thinking (source of the matching docids is from a separate index), will also need to know which sub docidset to use based on which IndexReader is passed to scorer() - shouldn\'t be any big deal)  \\n\\n I think, similarly, you could continue to create the top-level \\nDocIdSet, but then make a new DocIdSet that presents one segment\'s \\n\\\"slice\\\" out of this top-level DocIdSet.  Then, pre-build the mapping \\nof IndexReader -&gt; docBase like above, then when scorer() is called in \\nyour custom query, just return the \\\"virtual\\\" per-segment DocIdSet. \\nWould this work?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746636\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746636&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746636\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746636_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746636_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:58:58+0000\'\u003e23\\/Aug\\/09 16:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNet\\/net, I\'m still nervous about pushing down \\\"full context\\\" plus\u003cbr\\/\u003e\\n\\\"context free\\\" searcher\\/reader deep into Lucene\'s general searching\u003cbr\\/\u003e\\n(scorer\\/filter) APIs.  I think these APIs should remain fully\u003cbr\\/\u003e\\ncontext-free (even IndexSearcher still makes me nervous).\u003c\\/p\u003e\\n\\n\u003cp\u003eIn some sense, Multi\\/RemoteSearcher keep us honest, in that they force\u003cbr\\/\u003e\\nus to clearly separate out \\\"stuff that has the luxury of full context\\\"\u003cbr\\/\u003e\\n(to be done on construction of Weight) from \\\"the heavy lifting that\u003cbr\\/\u003e\\nmust be context free since it may not have access to the top searcher\\\"\u003cbr\\/\u003e\\n(scorer(), getDocIdSet()).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746636_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746636_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 16:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T16:58:58+0000\'\u003e23\\/Aug\\/09 16:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Net\\/net, I\'m still nervous about pushing down \\\"full context\\\" plus \\n\\\"context free\\\" searcher\\/reader deep into Lucene\'s general searching \\n(scorer\\/filter) APIs.  I think these APIs should remain fully \\ncontext-free (even IndexSearcher still makes me nervous). \\n\\n In some sense, Multi\\/RemoteSearcher keep us honest, in that they force \\nus to clearly separate out \\\"stuff that has the luxury of full context\\\" \\n(to be done on construction of Weight) from \\\"the heavy lifting that \\nmust be context free since it may not have access to the top searcher\\\" \\n(scorer(), getDocIdSet()).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746639\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746639&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746639\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746639_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746639_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 17:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T17:05:34+0000\'\u003e23\\/Aug\\/09 17:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCool - I don\'t like it much either.\u003c\\/p\u003e\\n\\n\u003cp\u003eI say we push this issue from 2.9 for now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746639_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746639_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 17:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T17:05:34+0000\'\u003e23\\/Aug\\/09 17:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Cool - I don\'t like it much either. \\n\\n I say we push this issue from 2.9 for now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746643\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746643&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746643\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746643_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746643_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 17:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T17:37:42+0000\'\u003e23\\/Aug\\/09 17:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLot of new comments to respond to \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nwill try to cover them all\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003edecent comparator (StringOrdValComparator) that operates per segment.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eStill, the StringOrdValComparator will have to break down and call String.equals() whenever it compars docs in different IndexReaders\u003cbr\\/\u003e\\nIt also has to do more maintenance in general than would be needed for just a StringOrd comparator that would have a cache across all IndexReaders\u003cbr\\/\u003e\\nWhile the StringOrdValComparator may be faster in 2.9 than string sorting in 2.4, its not as fast as it could be if the cache was created on the IndexSearcher level\u003cbr\\/\u003e\\nI looked at the new string sorting stuff last week, and it looks pretty smart to reduce the number of String.equals() calls needed, but this adds extra complexity and will still be reduced to String.equals() calls, which will translate to slower sorting than could be possible\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eone option might be to subclass DirectoryReader \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe idea of this is to disable per segment searching?\u003cbr\\/\u003e\\nI don\'t actually want to do that. I want to use per segment searching functionality to take advantage of caches on per segment basis where possible, and map docs to the IndexSearcher context when i can\'t do per segment caching.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eCould you compute the top-level ords, but then break it up per-segment?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think i see what your getting at here, and i\'ve already thought of this as a potential solution. The cache will always need to be created at the top most level, but it will be pre-broken out into a per-segment cache whose context is the top level IndexSearcher\\/MultiReader. The biggest problem here is the complexity of actually creating such a cache, which i\'m sure will translate to this cache loading slower (hard to say how much slower without implementing)\u003cbr\\/\u003e\\nI do plan to try this approach, but i expect this will be at least a week or two out from now.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve currently updated my code for this to work per-segment by adding the docBase when performing the lookup into this cache (which is per-IndexSearcher)\u003cbr\\/\u003e\\nI did this using my getIndexReaderBase() funciton i added to my subclass of IndexSearcher during Scorer construction time (I can live with this, however i would like to see getIndexReaderBase() added to IndexSearcher, and the IndexSearcher passed to Weight.scorer() so i don\'t need to hold onto my IndexSearcher subclass in my Weight implementation)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ejust return the \\\"virtual\\\" per-segment DocIdSet.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThats what i\'m doing now. I use the docid base for the IndexReader, along with its maxDoc to have the Scorer represent a virtual slice for just the segment in question\u003cbr\\/\u003e\\nThe only real problem here is that during Scorer initialization for this i have to call fullDocIdSetIter.advance(docBase) in the Scorer constructor. If advance(int) for the DocIdSet in question is O(N), this adds an extra penalty per segment that did not exist before\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ehis isn\'t a long-term solution, since the order in which Lucene visits the readers isn\'t in general guaranteed,\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ethat\'s where IndexSearcher.getIndexReaderBase(IndexReader) comes into play. If you call this in your scorer to get the docBase, it doesn\'t matter what order the segments are searched in (as it\'ll always return the proper base (in the context of the IndexSearcher that is))\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eHere\'s another potential thought (very rough, haven\'t consulted code to see how feasible this is):\u003cbr\\/\u003e\\nwhat if Similarity had a method called getDocIdBase(IndexReader)\u003cbr\\/\u003e\\nthen, the searcher implementation could wrap the provided Similarity to provide the proper calculation\u003cbr\\/\u003e\\nSimilarity is always already passed through this chain of Weight creation and is passed into the Scorer\u003cbr\\/\u003e\\nObviously, a Query Implementation can completely drop the passing of the Searcher\'s similarity and drop in its own (but this would mean it doesn\'t care about getting these docid bases)\u003cbr\\/\u003e\\nI think this approach would potentially resolve all MultiSearcher difficulties\u003c\\/p\u003e\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746643_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746643_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 17:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T17:37:42+0000\'\u003e23\\/Aug\\/09 17:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Lot of new comments to respond to   \\nwill try to cover them all \\n\\n  decent comparator (StringOrdValComparator) that operates per segment.  \\n\\n Still, the StringOrdValComparator will have to break down and call String.equals() whenever it compars docs in different IndexReaders \\nIt also has to do more maintenance in general than would be needed for just a StringOrd comparator that would have a cache across all IndexReaders \\nWhile the StringOrdValComparator may be faster in 2.9 than string sorting in 2.4, its not as fast as it could be if the cache was created on the IndexSearcher level \\nI looked at the new string sorting stuff last week, and it looks pretty smart to reduce the number of String.equals() calls needed, but this adds extra complexity and will still be reduced to String.equals() calls, which will translate to slower sorting than could be possible \\n\\n  one option might be to subclass DirectoryReader   \\n\\n The idea of this is to disable per segment searching? \\nI don\'t actually want to do that. I want to use per segment searching functionality to take advantage of caches on per segment basis where possible, and map docs to the IndexSearcher context when i can\'t do per segment caching. \\n\\n  Could you compute the top-level ords, but then break it up per-segment?  \\n\\n I think i see what your getting at here, and i\'ve already thought of this as a potential solution. The cache will always need to be created at the top most level, but it will be pre-broken out into a per-segment cache whose context is the top level IndexSearcher\\/MultiReader. The biggest problem here is the complexity of actually creating such a cache, which i\'m sure will translate to this cache loading slower (hard to say how much slower without implementing) \\nI do plan to try this approach, but i expect this will be at least a week or two out from now. \\n\\n I\'ve currently updated my code for this to work per-segment by adding the docBase when performing the lookup into this cache (which is per-IndexSearcher) \\nI did this using my getIndexReaderBase() funciton i added to my subclass of IndexSearcher during Scorer construction time (I can live with this, however i would like to see getIndexReaderBase() added to IndexSearcher, and the IndexSearcher passed to Weight.scorer() so i don\'t need to hold onto my IndexSearcher subclass in my Weight implementation) \\n\\n  just return the \\\"virtual\\\" per-segment DocIdSet.  \\n\\n Thats what i\'m doing now. I use the docid base for the IndexReader, along with its maxDoc to have the Scorer represent a virtual slice for just the segment in question \\nThe only real problem here is that during Scorer initialization for this i have to call fullDocIdSetIter.advance(docBase) in the Scorer constructor. If advance(int) for the DocIdSet in question is O(N), this adds an extra penalty per segment that did not exist before \\n\\n  his isn\'t a long-term solution, since the order in which Lucene visits the readers isn\'t in general guaranteed,  \\n\\n that\'s where IndexSearcher.getIndexReaderBase(IndexReader) comes into play. If you call this in your scorer to get the docBase, it doesn\'t matter what order the segments are searched in (as it\'ll always return the proper base (in the context of the IndexSearcher that is)) \\n\\n\\n Here\'s another potential thought (very rough, haven\'t consulted code to see how feasible this is): \\nwhat if Similarity had a method called getDocIdBase(IndexReader) \\nthen, the searcher implementation could wrap the provided Similarity to provide the proper calculation \\nSimilarity is always already passed through this chain of Weight creation and is passed into the Scorer \\nObviously, a Query Implementation can completely drop the passing of the Searcher\'s similarity and drop in its own (but this would mean it doesn\'t care about getting these docid bases) \\nI think this approach would potentially resolve all MultiSearcher difficulties \\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746644\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746644&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746644\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12746644_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746644_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 17:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T17:44:44+0000\'\u003e23\\/Aug\\/09 17:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThis is a good point... Yonik, how \u003cspan class=\\\"error\\\"\u003e&#91;in general!&#93;\u003c\\/span\u003e is Solr handling the cutover to per-segment, for faceting?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt doesn\'t.  Faceting is not connected to searching in Solr, and is only done at the top level IndexReader.\u003cbr\\/\u003e\\nWe obviously want to enable per-segment faceting for more NRT in the future - with the expected disadvantage that it will be somewhat slower for some types of facets.  I imagine we will keep the top-level faceting as an option because there will be tradeoffs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12746644_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746644_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 17:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T17:44:44+0000\'\u003e23\\/Aug\\/09 17:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     This is a good point... Yonik, how  &#91;in general!&#93;  is Solr handling the cutover to per-segment, for faceting?  \\n\\n It doesn\'t.  Faceting is not connected to searching in Solr, and is only done at the top level IndexReader. \\nWe obviously want to enable per-segment faceting for more NRT in the future - with the expected disadvantage that it will be somewhat slower for some types of facets.  I imagine we will keep the top-level faceting as an option because there will be tradeoffs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746645\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746645&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746645\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12746645_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746645_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 17:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T17:45:17+0000\'\u003e23\\/Aug\\/09 17:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI say we push this issue from 2.9 for now.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1 \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12746645_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746645_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 17:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T17:45:17+0000\'\u003e23\\/Aug\\/09 17:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I say we push this issue from 2.9 for now.  \\n\\n +1               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746659\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746659&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746659\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746659_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746659_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 19:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T19:10:07+0000\'\u003e23\\/Aug\\/09 19:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m going to push it out for now. Of course, feel free to argue for its re inclusion.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746659_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746659_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 19:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T19:10:07+0000\'\u003e23\\/Aug\\/09 19:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m going to push it out for now. Of course, feel free to argue for its re inclusion.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746662\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746662&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746662\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746662_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746662_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 19:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T19:29:19+0000\'\u003e23\\/Aug\\/09 19:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ecan i at least argue for it being tagged for 3.0 or 3.1 (just so it gets looked at again prior to the next releases)\u003c\\/p\u003e\\n\\n\u003cp\u003eI have workarounds for 2.9, so i\'m ok with it not getting in then (just want to make sure my use cases won\'t be made impossible in future releases)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746662_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746662_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 19:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T19:29:19+0000\'\u003e23\\/Aug\\/09 19:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    can i at least argue for it being tagged for 3.0 or 3.1 (just so it gets looked at again prior to the next releases) \\n\\n I have workarounds for 2.9, so i\'m ok with it not getting in then (just want to make sure my use cases won\'t be made impossible in future releases)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746667\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746667&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746667\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746667_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746667_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 19:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T19:51:26+0000\'\u003e23\\/Aug\\/09 19:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYeah, no problem - tag whatever you\'d like - I only went to nothing because it was the easiest default move.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the current plan (subject to change), the earliest it could be considered again is 3.1, so I\'ll move there.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746667_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746667_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 19:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T19:51:26+0000\'\u003e23\\/Aug\\/09 19:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yeah, no problem - tag whatever you\'d like - I only went to nothing because it was the easiest default move. \\n\\n With the current plan (subject to change), the earliest it could be considered again is 3.1, so I\'ll move there.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746668\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746668&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746668\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746668_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746668_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 19:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T19:58:54+0000\'\u003e23\\/Aug\\/09 19:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ewhoops - try the right thing this time\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746668_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746668_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/09 19:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-23T19:58:54+0000\'\u003e23\\/Aug\\/09 19:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    whoops - try the right thing this time              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746797\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746797&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746797\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746797_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746797_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 10:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T10:03:27+0000\'\u003e24\\/Aug\\/09 10:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003edecent comparator (StringOrdValComparator) that operates per segment.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eStill, the StringOrdValComparator will have to break down and call String.equals() whenever it compars docs in different IndexReaders\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAgreed, it will be slower than a top-level ords cache, but I\'m\u003cbr\\/\u003e\\nwondering in practice, in your case, what impact that turns out to be.\u003cbr\\/\u003e\\nAlso, since Lucene has already done this, maybe you could use its\u003cbr\\/\u003e\\nStringOrdValComparator instead of having to cutover yours to\u003cbr\\/\u003e\\nsegment-based.\u003c\\/p\u003e\\n\\n\u003cp\u003eOr, better, work up a patch for a \\\"forced\\\" top-level StringComparator\u003cbr\\/\u003e\\nfor apps that don\'t mind the slow commit time and possible risk of\u003cbr\\/\u003e\\nburning memory, in exchange for faster sorting.\u003c\\/p\u003e\\n\\n\u003cp\u003eActually sorting (during collection) already gives you the docBase so\u003cbr\\/\u003e\\nshouldn\'t your app already have the context needed for this?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eThe idea of this is to disable per segment searching?\u003cbr\\/\u003e\\nI don\'t actually want to do that. I want to use per segment searching functionality to take advantage of caches on per segment basis where possible, and map docs to the IndexSearcher context when i can\'t do per segment caching.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eCould you compute the top-level ords, but then break it up per-segment?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think i see what your getting at here, and i\'ve already thought of this as a potential solution. The cache will always need to be created at the top most level, but it will be pre-broken out into a per-segment cache whose context is the top level IndexSearcher\\/MultiReader. The biggest problem here is the complexity of actually creating such a cache, which i\'m sure will translate to this cache loading slower (hard to say how much slower without implementing)\u003cbr\\/\u003e\\nI do plan to try this approach, but i expect this will be at least a week or two out from now.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve currently updated my code for this to work per-segment by adding the docBase when performing the lookup into this cache (which is per-IndexSearcher)\u003cbr\\/\u003e\\nI did this using my getIndexReaderBase() funciton i added to my subclass of IndexSearcher during Scorer construction time (I can live with this, however i would like to see getIndexReaderBase() added to IndexSearcher, and the IndexSearcher passed to Weight.scorer() so i don\'t need to hold onto my IndexSearcher subclass in my Weight implementation)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK sounds like an at least workable solution.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003ejust return the \\\"virtual\\\" per-segment DocIdSet.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThats what i\'m doing now. I use the docid base for the IndexReader, along with its maxDoc to have the Scorer represent a virtual slice for just the segment in question\u003cbr\\/\u003e\\nThe only real problem here is that during Scorer initialization for this i have to call fullDocIdSetIter.advance(docBase) in the Scorer constructor. If advance(int) for the DocIdSet in question is O(N), this adds an extra penalty per segment that did not exist before\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm... is advance in fact costly for your DocIdSets?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eThis isn\'t a long-term solution, since the order in which Lucene visits the readers isn\'t in general guaranteed,\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ethat\'s where IndexSearcher.getIndexReaderBase(IndexReader) comes into play. If you call this in your scorer to get the docBase, it doesn\'t matter what order the segments are searched in (as it\'ll always return the proper base (in the context of the IndexSearcher that is))\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think adding that one method for 2.9 would make sense?  (Marking it\u003cbr\\/\u003e\\nexpert, subject to change).  Because... assuming your app is OK w\\/\u003cbr\\/\u003e\\nsomehow (privately, external to Lucene) having access to the top\u003cbr\\/\u003e\\nIndexSearcher via it\'s custom Weight, this one method would allow you\u003cbr\\/\u003e\\nto not have to subclass IndexSearcher.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12746797_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746797_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 10:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T10:03:27+0000\'\u003e24\\/Aug\\/09 10:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n  decent comparator (StringOrdValComparator) that operates per segment.  \\n\\n Still, the StringOrdValComparator will have to break down and call String.equals() whenever it compars docs in different IndexReaders  \\n\\n Agreed, it will be slower than a top-level ords cache, but I\'m \\nwondering in practice, in your case, what impact that turns out to be. \\nAlso, since Lucene has already done this, maybe you could use its \\nStringOrdValComparator instead of having to cutover yours to \\nsegment-based. \\n\\n Or, better, work up a patch for a \\\"forced\\\" top-level StringComparator \\nfor apps that don\'t mind the slow commit time and possible risk of \\nburning memory, in exchange for faster sorting. \\n\\n Actually sorting (during collection) already gives you the docBase so \\nshouldn\'t your app already have the context needed for this? \\n\\n \\n The idea of this is to disable per segment searching? \\nI don\'t actually want to do that. I want to use per segment searching functionality to take advantage of caches on per segment basis where possible, and map docs to the IndexSearcher context when i can\'t do per segment caching.  \\n\\n OK \\n\\n \\n  Could you compute the top-level ords, but then break it up per-segment?  \\n\\n I think i see what your getting at here, and i\'ve already thought of this as a potential solution. The cache will always need to be created at the top most level, but it will be pre-broken out into a per-segment cache whose context is the top level IndexSearcher\\/MultiReader. The biggest problem here is the complexity of actually creating such a cache, which i\'m sure will translate to this cache loading slower (hard to say how much slower without implementing) \\nI do plan to try this approach, but i expect this will be at least a week or two out from now. \\n\\n I\'ve currently updated my code for this to work per-segment by adding the docBase when performing the lookup into this cache (which is per-IndexSearcher) \\nI did this using my getIndexReaderBase() funciton i added to my subclass of IndexSearcher during Scorer construction time (I can live with this, however i would like to see getIndexReaderBase() added to IndexSearcher, and the IndexSearcher passed to Weight.scorer() so i don\'t need to hold onto my IndexSearcher subclass in my Weight implementation)  \\n\\n OK sounds like an at least workable solution. \\n\\n \\n  just return the \\\"virtual\\\" per-segment DocIdSet.  \\n\\n Thats what i\'m doing now. I use the docid base for the IndexReader, along with its maxDoc to have the Scorer represent a virtual slice for just the segment in question \\nThe only real problem here is that during Scorer initialization for this i have to call fullDocIdSetIter.advance(docBase) in the Scorer constructor. If advance(int) for the DocIdSet in question is O(N), this adds an extra penalty per segment that did not exist before  \\n\\n Hmm... is advance in fact costly for your DocIdSets? \\n\\n \\n  This isn\'t a long-term solution, since the order in which Lucene visits the readers isn\'t in general guaranteed,  \\n\\n that\'s where IndexSearcher.getIndexReaderBase(IndexReader) comes into play. If you call this in your scorer to get the docBase, it doesn\'t matter what order the segments are searched in (as it\'ll always return the proper base (in the context of the IndexSearcher that is))  \\n\\n I think adding that one method for 2.9 would make sense?  (Marking it \\nexpert, subject to change).  Because... assuming your app is OK w\\/ \\nsomehow (privately, external to Lucene) having access to the top \\nIndexSearcher via it\'s custom Weight, this one method would allow you \\nto not have to subclass IndexSearcher.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746809\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746809&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746809\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746809_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746809_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 10:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T10:44:02+0000\'\u003e24\\/Aug\\/09 10:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eActually sorting (during collection) already gives you the docBase so shouldn\'t your app already have the context needed for this?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes, i get the docbase and all during collection, so doing sorting with a top level cache will be no problem.\u003cbr\\/\u003e\\nI was mainly using sorting as an example of some of the pain caused by per-segment searching\\/caches (the Collector API makes it easy enough to do sorting\u003cbr\\/\u003e\\non the top level or per segment, so i\'m not concerned about integration here)\u003c\\/p\u003e\\n\\n\u003cp\u003eFor my app, i plan to allow sorting to be either \\\"per-segment\\\" or \\\"top-level\\\" in order to allow people to choose thier poison: faster commit\\/less memory vs faster sorting\u003cbr\\/\u003e\\nI also plan to do faceting likewise\u003cbr\\/\u003e\\ncertain features will always require a top-level cache (but those are advanced features anyway and should be expected to have impacts on commit time\\/first search time)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eHmm... is advance in fact costly for your DocIdSets?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThink how costly it would be to do advance for the SortedVInt DocIdSet (linear search over compressed values)\u003cbr\\/\u003e\\nfor a bitset, this is instantaneous, but to conserve memory, its better to use a sorted int[] (or the SortedVInt stuff 2.9 provides)\u003c\\/p\u003e\\n\\n\u003cp\u003ein the end, i plan to bucketize the collected docs per segment, so in the end this should hopefully be less of an issue\u003cbr\\/\u003e\\nnice thing about that approach is that i can have a bitset for one segment (lost of matches in this segment) and a very small int[] for a different segment based on the matches per segment. Biggest difficulty is doing the mapping to the per-segment \\\"DocIdSet\\\" (which will probably have to be slower)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ethis one method would allow you to not have to subclass IndexSearcher.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI already have to subclass index searcher (i do a lot of extra stuff)\u003cbr\\/\u003e\\nhowever, the IndexSearcher doesn\'t provide any protected access to its sub readers and doc starts, so i have to do this myself in my subclass\'s constructor (in the same way IndexSearcher is doing this\u003c\\/p\u003e\\n\\n\u003cp\u003eI would really like to see getIndexReaderBase() added to 2.9\'s IndexSearcher\u003cbr\\/\u003e\\nI would also like to see the subreaders and docstarts either made protected or given protected accessor methods (so i don\'t have to recreate the same set of sub readers (and make sure i do this the same way for future versions of lucene)\u003cbr\\/\u003e\\nWould also be nice to see a protected constructor on IndexSearcher like so:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003eprotected\u003c\\/span\u003e IndexSearcher(IndexReader reader, IndexReader[] subReaders, \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e[] docStarts) {\\n   ...\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThis would allow creating \\\"temporary\\\" IndexSearchers much faster (don\'t need to gather sub readers)\u003cbr\\/\u003e\\nThis would allow:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eeasily creating IndexSearcher that is \\\"top-level\\\" (subReaders[] would be length 1 and just contain reader)\u003c\\/li\u003e\\n\\t\u003cli\u003ecreate a \\\"temporary\\\" IndexSearcher off another IndexSearcher that contains some \\\"short lived\\\" context (i have this use case)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746809_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746809_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 10:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T10:44:02+0000\'\u003e24\\/Aug\\/09 10:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Actually sorting (during collection) already gives you the docBase so shouldn\'t your app already have the context needed for this?  \\n\\n Yes, i get the docbase and all during collection, so doing sorting with a top level cache will be no problem. \\nI was mainly using sorting as an example of some of the pain caused by per-segment searching\\/caches (the Collector API makes it easy enough to do sorting \\non the top level or per segment, so i\'m not concerned about integration here) \\n\\n For my app, i plan to allow sorting to be either \\\"per-segment\\\" or \\\"top-level\\\" in order to allow people to choose thier poison: faster commit\\/less memory vs faster sorting \\nI also plan to do faceting likewise \\ncertain features will always require a top-level cache (but those are advanced features anyway and should be expected to have impacts on commit time\\/first search time) \\n\\n  Hmm... is advance in fact costly for your DocIdSets?  \\n\\n Think how costly it would be to do advance for the SortedVInt DocIdSet (linear search over compressed values) \\nfor a bitset, this is instantaneous, but to conserve memory, its better to use a sorted int[] (or the SortedVInt stuff 2.9 provides) \\n\\n in the end, i plan to bucketize the collected docs per segment, so in the end this should hopefully be less of an issue \\nnice thing about that approach is that i can have a bitset for one segment (lost of matches in this segment) and a very small int[] for a different segment based on the matches per segment. Biggest difficulty is doing the mapping to the per-segment \\\"DocIdSet\\\" (which will probably have to be slower) \\n\\n  this one method would allow you to not have to subclass IndexSearcher.  \\n\\n I already have to subclass index searcher (i do a lot of extra stuff) \\nhowever, the IndexSearcher doesn\'t provide any protected access to its sub readers and doc starts, so i have to do this myself in my subclass\'s constructor (in the same way IndexSearcher is doing this \\n\\n I would really like to see getIndexReaderBase() added to 2.9\'s IndexSearcher \\nI would also like to see the subreaders and docstarts either made protected or given protected accessor methods (so i don\'t have to recreate the same set of sub readers (and make sure i do this the same way for future versions of lucene) \\nWould also be nice to see a protected constructor on IndexSearcher like so: \\n  \\n    protected  IndexSearcher(IndexReader reader, IndexReader[] subReaders,  int [] docStarts) {\\n   ...\\n  }\\n \\n  \\n\\n This would allow creating \\\"temporary\\\" IndexSearchers much faster (don\'t need to gather sub readers) \\nThis would allow: \\n \\n\\t easily creating IndexSearcher that is \\\"top-level\\\" (subReaders[] would be length 1 and just contain reader) \\n\\t create a \\\"temporary\\\" IndexSearcher off another IndexSearcher that contains some \\\"short lived\\\" context (i have this use case) \\n \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746838\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746838&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746838\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746838_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746838_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 12:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T12:16:43+0000\'\u003e24\\/Aug\\/09 12:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 24\\/Aug\\/09 12:18\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003efaster commit\\/less memory vs faster sorting\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHave you done any benching here? I think we actually found that even most sorting cases were faster than in 2.4.1.\u003c\\/p\u003e\\n\\n\u003cp\u003eIts a lot of poison to swallow top level - loading a field cache off a multi-segment index was dog slow. \u003cb\u003eedit\u003c\\/b\u003e (I can never remember if Yonik fix that or not - he fixed something related, or at least made it better)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746838_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746838_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 12:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T12:16:43+0000\'\u003e24\\/Aug\\/09 12:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 24\\/Aug\\/09 12:18\\\"\u003eedited\u003c\\/span\u003e                    faster commit\\/less memory vs faster sorting  \\n\\n Have you done any benching here? I think we actually found that even most sorting cases were faster than in 2.4.1. \\n\\n Its a lot of poison to swallow top level - loading a field cache off a multi-segment index was dog slow.  edit  (I can never remember if Yonik fix that or not - he fixed something related, or at least made it better)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746839\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746839&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746839\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746839_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746839_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 12:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T12:25:31+0000\'\u003e24\\/Aug\\/09 12:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eHave you done any benching here? I think we actually found that even most sorting cases were faster than in 2.4.1.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI haven\'t done any benchmarking. \u003cbr\\/\u003e\\nI\'m not arguing that 2.9 string sorting is slower than 2.4 string sorting, it may well be faster for every case.\u003cbr\\/\u003e\\nper segment searching and other improvements potentially added more gains in performance than the new string sorting added losses in performance.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, i can say rather confidently, that a large index with a bunch of segments will result in string sorting being slower when using a per segment string sort cache instead of a full index sort cache (think worst case using &#42;:&#42; query)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eloading a field cache off a multi-segment index was dog slow\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ethis is a trade off.\u003cbr\\/\u003e\\nslower cache loading in order to get faster sorting\u003cbr\\/\u003e\\ni plan to provide the ability to do both, and allow specific use cases to decide what is best for them\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746839_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746839_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 12:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T12:25:31+0000\'\u003e24\\/Aug\\/09 12:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Have you done any benching here? I think we actually found that even most sorting cases were faster than in 2.4.1.  \\n\\n I haven\'t done any benchmarking.  \\nI\'m not arguing that 2.9 string sorting is slower than 2.4 string sorting, it may well be faster for every case. \\nper segment searching and other improvements potentially added more gains in performance than the new string sorting added losses in performance. \\n\\n But, i can say rather confidently, that a large index with a bunch of segments will result in string sorting being slower when using a per segment string sort cache instead of a full index sort cache (think worst case using &#42;:&#42; query) \\n\\n  loading a field cache off a multi-segment index was dog slow  \\n this is a trade off. \\nslower cache loading in order to get faster sorting \\ni plan to provide the ability to do both, and allow specific use cases to decide what is best for them              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746840\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746840&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746840\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746840_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746840_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 12:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T12:29:05+0000\'\u003e24\\/Aug\\/09 12:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003ethis is a trade off.\u003cbr\\/\u003e\\nslower cache loading in order to get faster sorting\u003cbr\\/\u003e\\ni plan to provide the ability to do both, and allow specific use cases to decide what is best for them\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes a trade off \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e I meant it was bug slow though - as in it may take 80 seconds to load it when it should have taken 5. Unless the index was optimized. Could be fixed though - dropped off my radar now that we don\'t do it internally anymore.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12746840_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746840_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 12:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T12:29:05+0000\'\u003e24\\/Aug\\/09 12:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n this is a trade off. \\nslower cache loading in order to get faster sorting \\ni plan to provide the ability to do both, and allow specific use cases to decide what is best for them  \\n\\n Yes a trade off   I meant it was bug slow though - as in it may take 80 seconds to load it when it should have taken 5. Unless the index was optimized. Could be fixed though - dropped off my radar now that we don\'t do it internally anymore.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12746842\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12746842&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12746842\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746842_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746842_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 12:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T12:35:09+0000\'\u003e24\\/Aug\\/09 12:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI allow caches to be loaded at commit time (if configured), and recommend that frequently used caches be configured to be loaded at this time\u003cbr\\/\u003e\\nthis can result in slower commit times, but responsive queries as soon as the commit is finished\u003c\\/p\u003e\\n\\n\u003cp\u003eonce i also add the option for per-segment caching for sorting and faceting (i\'ll probably put this on by default for sorting, faceting maybe not), this will allow full tunability for the end-user\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12746842_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12746842_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Aug\\/09 12:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-08-24T12:35:09+0000\'\u003e24\\/Aug\\/09 12:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I allow caches to be loaded at commit time (if configured), and recommend that frequently used caches be configured to be loaded at this time \\nthis can result in slower commit times, but responsive queries as soon as the commit is finished \\n\\n once i also add the option for per-segment caching for sorting and faceting (i\'ll probably put this on by default for sorting, faceting maybe not), this will allow full tunability for the end-user              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12757199\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12757199&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12757199\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12757199_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12757199_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Sep\\/09 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-09-18T15:19:09+0000\'\u003e18\\/Sep\\/09 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been playing with per-segment caches for the last couple of weeks and have got everything working pretty well\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, i have to end up doing a lot of mapping between an IndexReader instance, and the \\\"index into the IndexReader[]\\\" array of the IndexSearcher\u003cbr\\/\u003e\\nthis then allows me to easily get the proper document offset where needed, and\\/or get a handle on the proper per-segment cache\\/evaluation object\\/etc\u003c\\/p\u003e\\n\\n\u003cp\u003eFor my use cases, it would be much easier if the following methods were available:\u003c\\/p\u003e\\n\\n\u003cp\u003eon Weight:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ readerId is the \u003cspan class=\\\"code-quote\\\"\u003e\\\"i\\\"\u003c\\/span\u003e in the \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e i = 0; i &lt; readers.length; ++i) in IndexSearcher\\n\u003c\\/span\u003e\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ NOTE: that readerId is at the IndexSearcher level, not the MultiSearcher level\\n\u003c\\/span\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e Scorer scorer(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e readerId, \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e inOrder, \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e topLevel);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eon Collector:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e void setNextReader(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e docBase, \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e readerId);\\n\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ NOTE: \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e isn\'t extremely needed, as its easier to get the readerId from docBase (using a cached \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e[] of docbases \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e the searcher)\u003c\\/span\u003e\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI suppose i could use the fact that these methods will always be called in order, keeping and incrementing counter, however the javadoc explicitly says that these methods may be called out of \\\"segment order\\\" to be more efficient in the future. It would therefore be very useful if these indexes were passed into these methods.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo work around this, my searcher currently has a getReaderIdForReader() method very similar to my earlier proposed getIndexReaderBase() method\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12757199_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12757199_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Sep\\/09 15:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-09-18T15:19:09+0000\'\u003e18\\/Sep\\/09 15:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve been playing with per-segment caches for the last couple of weeks and have got everything working pretty well \\n\\n However, i have to end up doing a lot of mapping between an IndexReader instance, and the \\\"index into the IndexReader[]\\\" array of the IndexSearcher \\nthis then allows me to easily get the proper document offset where needed, and\\/or get a handle on the proper per-segment cache\\/evaluation object\\/etc \\n\\n For my use cases, it would be much easier if the following methods were available: \\n\\n on Weight: \\n  \\n  \\/\\/ readerId is the  \\\"i\\\"  in the  for  ( int  i = 0; i &lt; readers.length; ++i) in IndexSearcher\\n  \\/\\/ NOTE: that readerId is at the IndexSearcher level, not the MultiSearcher level\\n  public  Scorer scorer(IndexReader reader,  int  readerId,  boolean  inOrder,  boolean  topLevel);\\n \\n  \\n\\n on Collector: \\n  \\n  public  void setNextReader(IndexReader reader,  int  docBase,  int  readerId);\\n \\/\\/ NOTE:  this  isn\'t extremely needed, as its easier to get the readerId from docBase (using a cached  int [] of docbases  for  the searcher) \\n \\n  \\n\\n I suppose i could use the fact that these methods will always be called in order, keeping and incrementing counter, however the javadoc explicitly says that these methods may be called out of \\\"segment order\\\" to be more efficient in the future. It would therefore be very useful if these indexes were passed into these methods. \\n\\n To work around this, my searcher currently has a getReaderIdForReader() method very similar to my earlier proposed getIndexReaderBase() method \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12849358\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12849358&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12849358\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12849358_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12849358_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Mar\\/10 19:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-03-24T19:01:42+0000\'\u003e24\\/Mar\\/10 19:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis would actually be solved by \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2345\\\" title=\\\"Make it possible to subclass SegmentReader\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2345\\\"\u003eLUCENE-2345\u003c\\/a\u003e for me as i would then be able to tag SegmentReaders with any additional accounting information i would need\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"tsmith\\\" id=\\\"commentauthor_12849358_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=tsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"tsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Tim Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12849358_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Mar\\/10 19:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-03-24T19:01:42+0000\'\u003e24\\/Mar\\/10 19:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This would actually be solved by  LUCENE-2345  for me as i would then be able to tag SegmentReaders with any additional accounting information i would need              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12981848\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-1821?focusedCommentId=12981848&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12981848\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12981848_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12981848_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/11 18:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-14T18:12:53+0000\'\u003e14\\/Jan\\/11 18:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is resolved by adding AtomicReaderContext in 4.0 (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2831\\\" title=\\\"Revise Weight#scorer &amp; Filter#getDocIdSet API to pass Readers context\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2831\\\"\u003e\u003cdel\u003eLUCENE-2831\u003c\\/del\u003e\u003c\\/a\u003e).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12981848_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12981848_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/11 18:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-14T18:12:53+0000\'\u003e14\\/Jan\\/11 18:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is resolved by adding AtomicReaderContext in 4.0 (  LUCENE-2831  ).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520243097684"> 
    <input type="hidden" title="jira.request.server.time" value="397"> 
    <input type="hidden" title="jira.request.id" value="584x94530863x1"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="35"> 
    <input type="hidden" title="db.conns.time.in.ms" value="44"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 584x94530863x1
	          REQUEST TIMESTAMP : [05/Mar/2018:09:44:57 +0000]
	               REQUEST TIME : 0.3970
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=21, elapsedTotal=35140541, elapsedMin=606113, elapsedMax=11231874, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=25, elapsedTotal=44718388, elapsedMin=634654, elapsedMax=11261865, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>